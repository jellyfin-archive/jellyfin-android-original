/**
 * @license
 * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
 */
// @version 0.7.5
window.WebComponents=window.WebComponents||{},function(e){var t=e.flags||{},n="webcomponents-lite.js",r=document.querySelector('script[src*="'+n+'"]');if(!t.noOpts){if(location.search.slice(1).split("&").forEach(function(e){var n,r=e.split("=");r[0]&&(n=r[0].match(/wc-(.+)/))&&(t[n[1]]=r[1]||!0)}),r)for(var o,i=0;o=r.attributes[i];i++)"src"!==o.name&&(t[o.name]=o.value||!0);if(t.log){var a=t.log.split(",");t.log={},a.forEach(function(e){t.log[e]=!0})}else t.log={}}t.shadow=t.shadow||t.shadowdom||t.polyfill,t.shadow="native"===t.shadow?!1:t.shadow||!HTMLElement.prototype.createShadowRoot,t.register&&(window.CustomElements=window.CustomElements||{flags:{}},window.CustomElements.flags.register=t.register),e.flags=t}(window.WebComponents),function(e){"use strict";function t(e){return void 0!==h[e]}function n(){s.call(this),this._isInvalid=!0}function r(e){return""==e&&n.call(this),e.toLowerCase()}function o(e){var t=e.charCodeAt(0);return t>32&&127>t&&-1==[34,35,60,62,63,96].indexOf(t)?e:encodeURIComponent(e)}function i(e){var t=e.charCodeAt(0);return t>32&&127>t&&-1==[34,35,60,62,96].indexOf(t)?e:encodeURIComponent(e)}function a(e,a,s){function c(e){b.push(e)}var d=a||"scheme start",u=0,l="",_=!1,w=!1,b=[];e:for(;(e[u-1]!=f||0==u)&&!this._isInvalid;){var g=e[u];switch(d){case"scheme start":if(!g||!m.test(g)){if(a){c("Invalid scheme.");break e}l="",d="no scheme";continue}l+=g.toLowerCase(),d="scheme";break;case"scheme":if(g&&v.test(g))l+=g.toLowerCase();else{if(":"!=g){if(a){if(f==g)break e;c("Code point not allowed in scheme: "+g);break e}l="",u=0,d="no scheme";continue}if(this._scheme=l,l="",a)break e;t(this._scheme)&&(this._isRelative=!0),d="file"==this._scheme?"relative":this._isRelative&&s&&s._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==g?(this._query="?",d="query"):"#"==g?(this._fragment="#",d="fragment"):f!=g&&"	"!=g&&"\n"!=g&&"\r"!=g&&(this._schemeData+=o(g));break;case"no scheme":if(s&&t(s._scheme)){d="relative";continue}c("Missing scheme."),n.call(this);break;case"relative or authority":if("/"!=g||"/"!=e[u+1]){c("Expected /, got: "+g),d="relative";continue}d="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=s._scheme),f==g){this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query=s._query,this._username=s._username,this._password=s._password;break e}if("/"==g||"\\"==g)"\\"==g&&c("\\ is an invalid code point."),d="relative slash";else if("?"==g)this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query="?",this._username=s._username,this._password=s._password,d="query";else{if("#"!=g){var y=e[u+1],E=e[u+2];("file"!=this._scheme||!m.test(g)||":"!=y&&"|"!=y||f!=E&&"/"!=E&&"\\"!=E&&"?"!=E&&"#"!=E)&&(this._host=s._host,this._port=s._port,this._username=s._username,this._password=s._password,this._path=s._path.slice(),this._path.pop()),d="relative path";continue}this._host=s._host,this._port=s._port,this._path=s._path.slice(),this._query=s._query,this._fragment="#",this._username=s._username,this._password=s._password,d="fragment"}break;case"relative slash":if("/"!=g&&"\\"!=g){"file"!=this._scheme&&(this._host=s._host,this._port=s._port,this._username=s._username,this._password=s._password),d="relative path";continue}"\\"==g&&c("\\ is an invalid code point."),d="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=g){c("Expected '/', got: "+g),d="authority ignore slashes";continue}d="authority second slash";break;case"authority second slash":if(d="authority ignore slashes","/"!=g){c("Expected '/', got: "+g);continue}break;case"authority ignore slashes":if("/"!=g&&"\\"!=g){d="authority";continue}c("Expected authority, got: "+g);break;case"authority":if("@"==g){_&&(c("@ already seen."),l+="%40"),_=!0;for(var L=0;L<l.length;L++){var M=l[L];if("	"!=M&&"\n"!=M&&"\r"!=M)if(":"!=M||null!==this._password){var T=o(M);null!==this._password?this._password+=T:this._username+=T}else this._password="";else c("Invalid whitespace in authority.")}l=""}else{if(f==g||"/"==g||"\\"==g||"?"==g||"#"==g){u-=l.length,l="",d="host";continue}l+=g}break;case"file host":if(f==g||"/"==g||"\\"==g||"?"==g||"#"==g){2!=l.length||!m.test(l[0])||":"!=l[1]&&"|"!=l[1]?0==l.length?d="relative path start":(this._host=r.call(this,l),l="",d="relative path start"):d="relative path";continue}"	"==g||"\n"==g||"\r"==g?c("Invalid whitespace in file host."):l+=g;break;case"host":case"hostname":if(":"!=g||w){if(f==g||"/"==g||"\\"==g||"?"==g||"#"==g){if(this._host=r.call(this,l),l="",d="relative path start",a)break e;continue}"	"!=g&&"\n"!=g&&"\r"!=g?("["==g?w=!0:"]"==g&&(w=!1),l+=g):c("Invalid code point in host/hostname: "+g)}else if(this._host=r.call(this,l),l="",d="port","hostname"==a)break e;break;case"port":if(/[0-9]/.test(g))l+=g;else{if(f==g||"/"==g||"\\"==g||"?"==g||"#"==g||a){if(""!=l){var N=parseInt(l,10);N!=h[this._scheme]&&(this._port=N+""),l=""}if(a)break e;d="relative path start";continue}"	"==g||"\n"==g||"\r"==g?c("Invalid code point in port: "+g):n.call(this)}break;case"relative path start":if("\\"==g&&c("'\\' not allowed in path."),d="relative path","/"!=g&&"\\"!=g)continue;break;case"relative path":if(f!=g&&"/"!=g&&"\\"!=g&&(a||"?"!=g&&"#"!=g))"	"!=g&&"\n"!=g&&"\r"!=g&&(l+=o(g));else{"\\"==g&&c("\\ not allowed in relative path.");var O;(O=p[l.toLowerCase()])&&(l=O),".."==l?(this._path.pop(),"/"!=g&&"\\"!=g&&this._path.push("")):"."==l&&"/"!=g&&"\\"!=g?this._path.push(""):"."!=l&&("file"==this._scheme&&0==this._path.length&&2==l.length&&m.test(l[0])&&"|"==l[1]&&(l=l[0]+":"),this._path.push(l)),l="","?"==g?(this._query="?",d="query"):"#"==g&&(this._fragment="#",d="fragment")}break;case"query":a||"#"!=g?f!=g&&"	"!=g&&"\n"!=g&&"\r"!=g&&(this._query+=i(g)):(this._fragment="#",d="fragment");break;case"fragment":f!=g&&"	"!=g&&"\n"!=g&&"\r"!=g&&(this._fragment+=g)}u++}}function s(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function c(e,t){void 0===t||t instanceof c||(t=new c(String(t))),this._url=e,s.call(this);var n=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");a.call(this,n,null,t)}var d=!1;if(!e.forceJURL)try{var u=new URL("b","http://a");u.pathname="c%20d",d="http://a/c%20d"===u.href}catch(l){}if(!d){var h=Object.create(null);h.ftp=21,h.file=0,h.gopher=70,h.http=80,h.https=443,h.ws=80,h.wss=443;var p=Object.create(null);p["%2e"]=".",p[".%2e"]="..",p["%2e."]="..",p["%2e%2e"]="..";var f=void 0,m=/[a-zA-Z]/,v=/[a-zA-Z0-9\+\-\.]/;c.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e="";return(""!=this._username||null!=this._password)&&(e=this._username+(null!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+e+this.host:"")+this.pathname+this._query+this._fragment},set href(e){s.call(this),a.call(this,e)},get protocol(){return this._scheme+":"},set protocol(e){this._isInvalid||a.call(this,e+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"host")},get hostname(){return this._host},set hostname(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"hostname")},get port(){return this._port},set port(e){!this._isInvalid&&this._isRelative&&a.call(this,e,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(e){!this._isInvalid&&this._isRelative&&(this._path=[],a.call(this,e,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(e){!this._isInvalid&&this._isRelative&&(this._query="?","?"==e[0]&&(e=e.slice(1)),a.call(this,e,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(e){this._isInvalid||(this._fragment="#","#"==e[0]&&(e=e.slice(1)),a.call(this,e,"fragment"))},get origin(){var e;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return e=this.host,e?this._scheme+"://"+e:""}};var _=e.URL;_&&(c.createObjectURL=function(e){return _.createObjectURL.apply(_,arguments)},c.revokeObjectURL=function(e){_.revokeObjectURL(e)}),e.URL=c}}(this),"undefined"==typeof WeakMap&&!function(){var e=Object.defineProperty,t=Date.now()%1e9,n=function(){this.name="__st"+(1e9*Math.random()>>>0)+(t++ +"__")};n.prototype={set:function(t,n){var r=t[this.name];return r&&r[0]===t?r[1]=n:e(t,this.name,{value:[t,n],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},"delete":function(e){var t=e[this.name];return t&&t[0]===e?(t[0]=t[1]=void 0,!0):!1},has:function(e){var t=e[this.name];return t?t[0]===e:!1}},window.WeakMap=n}(),function(e){function t(e){g.push(e),b||(b=!0,m(r))}function n(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function r(){b=!1;var e=g;g=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var n=e.takeRecords();o(e),n.length&&(e.callback_(n,e),t=!0)}),t&&r()}function o(e){e.nodes_.forEach(function(t){var n=v.get(t);n&&n.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function i(e,t){for(var n=e;n;n=n.parentNode){var r=v.get(n);if(r)for(var o=0;o<r.length;o++){var i=r[o],a=i.options;if(n===e||a.subtree){var s=t(a);s&&i.enqueue(s)}}}}function a(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++y}function s(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function c(e){var t=new s(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function d(e,t){return E=new s(e,t)}function u(e){return L?L:(L=c(E),L.oldValue=e,L)}function l(){E=L=void 0}function h(e){return e===L||e===E}function p(e,t){return e===t?e:L&&h(e)?L:null}function f(e,t,n){this.observer=e,this.target=t,this.options=n,this.transientObservedNodes=[]}var m,v=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))m=setTimeout;else if(window.setImmediate)m=window.setImmediate;else{var _=[],w=String(Math.random());window.addEventListener("message",function(e){if(e.data===w){var t=_;_=[],t.forEach(function(e){e()})}}),m=function(e){_.push(e),window.postMessage(w,"*")}}var b=!1,g=[],y=0;a.prototype={observe:function(e,t){if(e=n(e),!t.childList&&!t.attributes&&!t.characterData||t.attributeOldValue&&!t.attributes||t.attributeFilter&&t.attributeFilter.length&&!t.attributes||t.characterDataOldValue&&!t.characterData)throw new SyntaxError;var r=v.get(e);r||v.set(e,r=[]);for(var o,i=0;i<r.length;i++)if(r[i].observer===this){o=r[i],o.removeListeners(),o.options=t;break}o||(o=new f(this,e,t),r.push(o),this.nodes_.push(e)),o.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=v.get(e),n=0;n<t.length;n++){var r=t[n];if(r.observer===this){r.removeListeners(),t.splice(n,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var E,L;f.prototype={enqueue:function(e){var n=this.observer.records_,r=n.length;if(n.length>0){var o=n[r-1],i=p(o,e);if(i)return void(n[r-1]=i)}else t(this.observer);n[r]=e},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=v.get(e);t||v.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=v.get(e),n=0;n<t.length;n++)if(t[n]===this){t.splice(n,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,n=e.relatedNode.namespaceURI,r=e.target,o=new d("attributes",r);o.attributeName=t,o.attributeNamespace=n;var a=e.attrChange===MutationEvent.ADDITION?null:e.prevValue;i(r,function(e){return!e.attributes||e.attributeFilter&&e.attributeFilter.length&&-1===e.attributeFilter.indexOf(t)&&-1===e.attributeFilter.indexOf(n)?void 0:e.attributeOldValue?u(a):o});break;case"DOMCharacterDataModified":var r=e.target,o=d("characterData",r),a=e.prevValue;i(r,function(e){return e.characterData?e.characterDataOldValue?u(a):o:void 0});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var s,c,h=e.target;"DOMNodeInserted"===e.type?(s=[h],c=[]):(s=[],c=[h]);var p=h.previousSibling,f=h.nextSibling,o=d("childList",e.target.parentNode);o.addedNodes=s,o.removedNodes=c,o.previousSibling=p,o.nextSibling=f,i(e.relatedNode,function(e){return e.childList?o:void 0})}l()}},e.JsMutationObserver=a,e.MutationObserver||(e.MutationObserver=a)}(this),window.HTMLImports=window.HTMLImports||{flags:{}},function(e){function t(e,t){t=t||f,r(function(){i(e,t)},t)}function n(e){return"complete"===e.readyState||e.readyState===_}function r(e,t){if(n(t))e&&e();else{var o=function(){("complete"===t.readyState||t.readyState===_)&&(t.removeEventListener(w,o),r(e,t))};t.addEventListener(w,o)}}function o(e){e.target.__loaded=!0}function i(e,t){function n(){c==d&&e&&e({allImports:s,loadedImports:u,errorImports:l})}function r(e){o(e),u.push(this),c++,n()}function i(e){l.push(this),c++,n()}var s=t.querySelectorAll("link[rel=import]"),c=0,d=s.length,u=[],l=[];if(d)for(var h,p=0;d>p&&(h=s[p]);p++)a(h)?(c++,n()):(h.addEventListener("load",r),h.addEventListener("error",i));else n()}function a(e){return l?e.__loaded||e["import"]&&"loading"!==e["import"].readyState:e.__importParsed}function s(e){for(var t,n=0,r=e.length;r>n&&(t=e[n]);n++)c(t)&&d(t)}function c(e){return"link"===e.localName&&"import"===e.rel}function d(e){var t=e["import"];t?o({target:e}):(e.addEventListener("load",o),e.addEventListener("error",o))}var u="import",l=Boolean(u in document.createElement("link")),h=Boolean(window.ShadowDOMPolyfill),p=function(e){return h?window.ShadowDOMPolyfill.wrapIfNeeded(e):e},f=p(document),m={get:function(){var e=window.HTMLImports.currentScript||document.currentScript||("complete"!==document.readyState?document.scripts[document.scripts.length-1]:null);return p(e)},configurable:!0};Object.defineProperty(document,"_currentScript",m),Object.defineProperty(f,"_currentScript",m);var v=/Trident/.test(navigator.userAgent),_=v?"complete":"interactive",w="readystatechange";l&&(new MutationObserver(function(e){for(var t,n=0,r=e.length;r>n&&(t=e[n]);n++)t.addedNodes&&s(t.addedNodes)}).observe(document.head,{childList:!0}),function(){if("loading"===document.readyState)for(var e,t=document.querySelectorAll("link[rel=import]"),n=0,r=t.length;r>n&&(e=t[n]);n++)d(e)}()),t(function(e){window.HTMLImports.ready=!0,window.HTMLImports.readyTime=(new Date).getTime();var t=f.createEvent("CustomEvent");t.initCustomEvent("HTMLImportsLoaded",!0,!0,e),f.dispatchEvent(t)}),e.IMPORT_LINK_TYPE=u,e.useNative=l,e.rootDocument=f,e.whenReady=t,e.isIE=v}(window.HTMLImports),function(e){var t=[],n=function(e){t.push(e)},r=function(){t.forEach(function(t){t(e)})};e.addModule=n,e.initializeModules=r}(window.HTMLImports),window.HTMLImports.addModule(function(e){var t=/(url\()([^)]*)(\))/g,n=/(@import[\s]+(?!url\())([^;]*)(;)/g,r={resolveUrlsInStyle:function(e,t){var n=e.ownerDocument,r=n.createElement("a");return e.textContent=this.resolveUrlsInCssText(e.textContent,t,r),e},resolveUrlsInCssText:function(e,r,o){var i=this.replaceUrls(e,o,r,t);return i=this.replaceUrls(i,o,r,n)},replaceUrls:function(e,t,n,r){return e.replace(r,function(e,r,o,i){var a=o.replace(/["']/g,"");return n&&(a=new URL(a,n).href),t.href=a,a=t.href,r+"'"+a+"'"+i})}};e.path=r}),window.HTMLImports.addModule(function(e){var t={async:!0,ok:function(e){return e.status>=200&&e.status<300||304===e.status||0===e.status},load:function(n,r,o){var i=new XMLHttpRequest;return(e.flags.debug||e.flags.bust)&&(n+="?"+Math.random()),i.open("GET",n,t.async),i.addEventListener("readystatechange",function(e){if(4===i.readyState){var n=i.getResponseHeader("Location"),a=null;if(n)var a="/"===n.substr(0,1)?location.origin+n:n;r.call(o,!t.ok(i)&&i,i.response||i.responseText,a)}}),i.send(),i},loadDocument:function(e,t,n){this.load(e,t,n).responseType="document"}};e.xhr=t}),window.HTMLImports.addModule(function(e){var t=e.xhr,n=e.flags,r=function(e,t){this.cache={},this.onload=e,this.oncomplete=t,this.inflight=0,this.pending={}};r.prototype={addNodes:function(e){this.inflight+=e.length;for(var t,n=0,r=e.length;r>n&&(t=e[n]);n++)this.require(t);this.checkDone()},addNode:function(e){this.inflight++,this.require(e),this.checkDone()},require:function(e){var t=e.src||e.href;e.__nodeUrl=t,this.dedupe(t,e)||this.fetch(t,e)},dedupe:function(e,t){if(this.pending[e])return this.pending[e].push(t),!0;return this.cache[e]?(this.onload(e,t,this.cache[e]),this.tail(),!0):(this.pending[e]=[t],!1)},fetch:function(e,r){if(n.load&&console.log("fetch",e,r),e)if(e.match(/^data:/)){var o=e.split(","),i=o[0],a=o[1];a=i.indexOf(";base64")>-1?atob(a):decodeURIComponent(a),setTimeout(function(){this.receive(e,r,null,a)}.bind(this),0)}else{var s=function(t,n,o){this.receive(e,r,t,n,o)}.bind(this);t.load(e,s)}else setTimeout(function(){this.receive(e,r,{error:"href must be specified"},null)}.bind(this),0)},receive:function(e,t,n,r,o){this.cache[e]=r;for(var i,a=this.pending[e],s=0,c=a.length;c>s&&(i=a[s]);s++)this.onload(e,i,r,n,o),this.tail();this.pending[e]=null},tail:function(){--this.inflight,this.checkDone()},checkDone:function(){this.inflight||this.oncomplete()}},e.Loader=r}),window.HTMLImports.addModule(function(e){var t=function(e){this.addCallback=e,this.mo=new MutationObserver(this.handler.bind(this))};t.prototype={handler:function(e){for(var t,n=0,r=e.length;r>n&&(t=e[n]);n++)"childList"===t.type&&t.addedNodes.length&&this.addedNodes(t.addedNodes)},addedNodes:function(e){this.addCallback&&this.addCallback(e);for(var t,n=0,r=e.length;r>n&&(t=e[n]);n++)t.children&&t.children.length&&this.addedNodes(t.children)},observe:function(e){this.mo.observe(e,{childList:!0,subtree:!0})}},e.Observer=t}),window.HTMLImports.addModule(function(e){function t(e){return"link"===e.localName&&e.rel===u}function n(e){var t=r(e);return"data:text/javascript;charset=utf-8,"+encodeURIComponent(t)}function r(e){return e.textContent+o(e)}function o(e){var t=e.ownerDocument;t.__importedScripts=t.__importedScripts||0;var n=e.ownerDocument.baseURI,r=t.__importedScripts?"-"+t.__importedScripts:"";return t.__importedScripts++,"\n//# sourceURL="+n+r+".js\n"}function i(e){var t=e.ownerDocument.createElement("style");return t.textContent=e.textContent,a.resolveUrlsInStyle(t),t}var a=e.path,s=e.rootDocument,c=e.flags,d=e.isIE,u=e.IMPORT_LINK_TYPE,l="link[rel="+u+"]",h={documentSelectors:l,importsSelectors:[l,"link[rel=stylesheet]","style","script:not([type])",'script[type="application/javascript"]','script[type="text/javascript"]'].join(","),map:{link:"parseLink",script:"parseScript",style:"parseStyle"},dynamicElements:[],parseNext:function(){var e=this.nextToParse();e&&this.parse(e)},parse:function(e){if(this.isParsed(e))return void(c.parse&&console.log("[%s] is already parsed",e.localName));var t=this[this.map[e.localName]];t&&(this.markParsing(e),t.call(this,e))},parseDynamic:function(e,t){this.dynamicElements.push(e),t||this.parseNext()},markParsing:function(e){c.parse&&console.log("parsing",e),this.parsingElement=e},markParsingComplete:function(e){e.__importParsed=!0,this.markDynamicParsingComplete(e),e.__importElement&&(e.__importElement.__importParsed=!0,this.markDynamicParsingComplete(e.__importElement)),this.parsingElement=null,c.parse&&console.log("completed",e)},markDynamicParsingComplete:function(e){var t=this.dynamicElements.indexOf(e);t>=0&&this.dynamicElements.splice(t,1)},parseImport:function(e){if(window.HTMLImports.__importsParsingHook&&window.HTMLImports.__importsParsingHook(e),e["import"]&&(e["import"].__importParsed=!0),this.markParsingComplete(e),e.dispatchEvent(e.__resource&&!e.__error?new CustomEvent("load",{bubbles:!1}):new CustomEvent("error",{bubbles:!1})),e.__pending)for(var t;e.__pending.length;)t=e.__pending.shift(),t&&t({target:e});this.parseNext()},parseLink:function(e){t(e)?this.parseImport(e):(e.href=e.href,this.parseGeneric(e))},parseStyle:function(e){var t=e;e=i(e),t.__appliedElement=e,e.__importElement=t,this.parseGeneric(e)},parseGeneric:function(e){this.trackElement(e),this.addElementToDocument(e)},rootImportForElement:function(e){for(var t=e;t.ownerDocument.__importLink;)t=t.ownerDocument.__importLink;return t},addElementToDocument:function(e){var t=this.rootImportForElement(e.__importElement||e);t.parentNode.insertBefore(e,t)},trackElement:function(e,t){var n=this,r=function(r){t&&t(r),n.markParsingComplete(e),n.parseNext()};if(e.addEventListener("load",r),e.addEventListener("error",r),d&&"style"===e.localName){var o=!1;if(-1==e.textContent.indexOf("@import"))o=!0;else if(e.sheet){o=!0;for(var i,a=e.sheet.cssRules,s=a?a.length:0,c=0;s>c&&(i=a[c]);c++)i.type===CSSRule.IMPORT_RULE&&(o=o&&Boolean(i.styleSheet))}o&&setTimeout(function(){e.dispatchEvent(new CustomEvent("load",{bubbles:!1}))})}},parseScript:function(t){var r=document.createElement("script");r.__importElement=t,r.src=t.src?t.src:n(t),e.currentScript=t,this.trackElement(r,function(t){r.parentNode.removeChild(r),e.currentScript=null}),this.addElementToDocument(r)},nextToParse:function(){return this._mayParse=[],!this.parsingElement&&(this.nextToParseInDoc(s)||this.nextToParseDynamic())},nextToParseInDoc:function(e,n){if(e&&this._mayParse.indexOf(e)<0){this._mayParse.push(e);for(var r,o=e.querySelectorAll(this.parseSelectorsForNode(e)),i=0,a=o.length;a>i&&(r=o[i]);i++)if(!this.isParsed(r))return this.hasResource(r)?t(r)?this.nextToParseInDoc(r["import"],r):r:void 0}return n},nextToParseDynamic:function(){return this.dynamicElements[0]},parseSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===s?this.documentSelectors:this.importsSelectors},isParsed:function(e){return e.__importParsed},needsDynamicParsing:function(e){return this.dynamicElements.indexOf(e)>=0},hasResource:function(e){return t(e)&&void 0===e["import"]?!1:!0}};e.parser=h,e.IMPORT_SELECTOR=l}),window.HTMLImports.addModule(function(e){function t(e){return n(e,a)}function n(e,t){return"link"===e.localName&&e.getAttribute("rel")===t}function r(e){return!!Object.getOwnPropertyDescriptor(e,"baseURI")}function o(e,t){var n=document.implementation.createHTMLDocument(a);n._URL=t;var o=n.createElement("base");o.setAttribute("href",t),n.baseURI||r(n)||Object.defineProperty(n,"baseURI",{value:t});var i=n.createElement("meta");return i.setAttribute("charset","utf-8"),n.head.appendChild(i),n.head.appendChild(o),n.body.innerHTML=e,window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap&&HTMLTemplateElement.bootstrap(n),n}var i=e.flags,a=e.IMPORT_LINK_TYPE,s=e.IMPORT_SELECTOR,c=e.rootDocument,d=e.Loader,u=e.Observer,l=e.parser,h={documents:{},documentPreloadSelectors:s,importsPreloadSelectors:[s].join(","),loadNode:function(e){p.addNode(e)},loadSubtree:function(e){var t=this.marshalNodes(e);p.addNodes(t)},marshalNodes:function(e){return e.querySelectorAll(this.loadSelectorsForNode(e))},loadSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===c?this.documentPreloadSelectors:this.importsPreloadSelectors},loaded:function(e,n,r,a,s){if(i.load&&console.log("loaded",e,n),n.__resource=r,n.__error=a,t(n)){var c=this.documents[e];void 0===c&&(c=a?null:o(r,s||e),c&&(c.__importLink=n,this.bootDocument(c)),this.documents[e]=c),n["import"]=c}l.parseNext()},bootDocument:function(e){this.loadSubtree(e),this.observer.observe(e),l.parseNext()},loadedAll:function(){l.parseNext()}},p=new d(h.loaded.bind(h),h.loadedAll.bind(h));if(h.observer=new u,!document.baseURI){var f={get:function(){var e=document.querySelector("base");return e?e.href:window.location.href},configurable:!0};Object.defineProperty(document,"baseURI",f),Object.defineProperty(c,"baseURI",f)}e.importer=h,e.importLoader=p}),window.HTMLImports.addModule(function(e){var t=e.parser,n=e.importer,r={added:function(e){for(var r,o,i,a,s=0,c=e.length;c>s&&(a=e[s]);s++)r||(r=a.ownerDocument,o=t.isParsed(r)),i=this.shouldLoadNode(a),i&&n.loadNode(a),this.shouldParseNode(a)&&o&&t.parseDynamic(a,i)},shouldLoadNode:function(e){return 1===e.nodeType&&o.call(e,n.loadSelectorsForNode(e))},shouldParseNode:function(e){return 1===e.nodeType&&o.call(e,t.parseSelectorsForNode(e))}};n.observer.addCallback=r.added.bind(r);var o=HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector}),function(e){function t(){window.HTMLImports.importer.bootDocument(o)}var n=e.initializeModules,r=e.isIE;if(!e.useNative){r&&"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,Boolean(t.bubbles),Boolean(t.cancelable),t.detail),n.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})},n},window.CustomEvent.prototype=window.Event.prototype),n();var o=e.rootDocument;"complete"===document.readyState||"interactive"===document.readyState&&!window.attachEvent?t():document.addEventListener("DOMContentLoaded",t)}}(window.HTMLImports),window.CustomElements=window.CustomElements||{flags:{}},function(e){var t=e.flags,n=[],r=function(e){n.push(e)},o=function(){n.forEach(function(t){t(e)})};e.addModule=r,e.initializeModules=o,e.hasNative=Boolean(document.registerElement),e.useNative=!t.register&&e.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule(function(e){function t(e,t){n(e,function(e){return t(e)?!0:void r(e,t)}),r(e,t)}function n(e,t,r){var o=e.firstElementChild;if(!o)for(o=e.firstChild;o&&o.nodeType!==Node.ELEMENT_NODE;)o=o.nextSibling;for(;o;)t(o,r)!==!0&&n(o,t,r),o=o.nextElementSibling;return null}function r(e,n){for(var r=e.shadowRoot;r;)t(r,n),r=r.olderShadowRoot}function o(e,t){i(e,t,[])}function i(e,t,n){if(e=window.wrap(e),!(n.indexOf(e)>=0)){n.push(e);for(var r,o=e.querySelectorAll("link[rel="+a+"]"),s=0,c=o.length;c>s&&(r=o[s]);s++)r["import"]&&i(r["import"],t,n);t(e)}}var a=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";e.forDocumentTree=o,e.forSubtree=t}),window.CustomElements.addModule(function(e){function t(e){return n(e)||r(e)}function n(t){return e.upgrade(t)?!0:void s(t)}function r(e){g(e,function(e){return n(e)?!0:void 0})}function o(e){s(e),h(e)&&g(e,function(e){s(e)})}function i(e){M.push(e),L||(L=!0,setTimeout(a))}function a(){L=!1;for(var e,t=M,n=0,r=t.length;r>n&&(e=t[n]);n++)e();M=[]}function s(e){E?i(function(){c(e)}):c(e)}function c(e){e.__upgraded__&&(e.attachedCallback||e.detachedCallback)&&!e.__attached&&h(e)&&(e.__attached=!0,e.attachedCallback&&e.attachedCallback())}function d(e){u(e),g(e,function(e){u(e)})}function u(e){E?i(function(){l(e)}):l(e)}function l(e){e.__upgraded__&&(e.attachedCallback||e.detachedCallback)&&e.__attached&&!h(e)&&(e.__attached=!1,e.detachedCallback&&e.detachedCallback())}function h(e){for(var t=e,n=wrap(document);t;){if(t==n)return!0;t=t.parentNode||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.host}}function p(e){if(e.shadowRoot&&!e.shadowRoot.__watched){b.dom&&console.log("watching shadow-root for: ",e.localName);for(var t=e.shadowRoot;t;)v(t),t=t.olderShadowRoot}}function f(e){if(b.dom){var n=e[0];if(n&&"childList"===n.type&&n.addedNodes&&n.addedNodes){for(var r=n.addedNodes[0];r&&r!==document&&!r.host;)r=r.parentNode;var o=r&&(r.URL||r._URL||r.host&&r.host.localName)||"";o=o.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",e.length,o||"")}e.forEach(function(e){"childList"===e.type&&(T(e.addedNodes,function(e){e.localName&&t(e)}),T(e.removedNodes,function(e){e.localName&&d(e)}))}),b.dom&&console.groupEnd()}function m(e){for(e=window.wrap(e),e||(e=window.wrap(document));e.parentNode;)e=e.parentNode;var t=e.__observer;t&&(f(t.takeRecords()),a())}function v(e){if(!e.__observer){var t=new MutationObserver(f);t.observe(e,{childList:!0,subtree:!0}),e.__observer=t}}function _(e){e=window.wrap(e),b.dom&&console.group("upgradeDocument: ",e.baseURI.split("/").pop()),t(e),v(e),b.dom&&console.groupEnd()}function w(e){y(e,_)}var b=e.flags,g=e.forSubtree,y=e.forDocumentTree,E=!window.MutationObserver||window.MutationObserver===window.JsMutationObserver;e.hasPolyfillMutations=E;var L=!1,M=[],T=Array.prototype.forEach.call.bind(Array.prototype.forEach),N=Element.prototype.createShadowRoot;N&&(Element.prototype.createShadowRoot=function(){var e=N.call(this);return window.CustomElements.watchShadow(this),e}),e.watchShadow=p,e.upgradeDocumentTree=w,e.upgradeSubtree=r,e.upgradeAll=t,e.attachedNode=o,e.takeRecords=m}),window.CustomElements.addModule(function(e){function t(t){if(!t.__upgraded__&&t.nodeType===Node.ELEMENT_NODE){var r=t.getAttribute("is"),o=e.getRegisteredDefinition(r||t.localName);if(o){if(r&&o.tag==t.localName)return n(t,o);if(!r&&!o["extends"])return n(t,o)}}}function n(t,n){return a.upgrade&&console.group("upgrade:",t.localName),n.is&&t.setAttribute("is",n.is),r(t,n),t.__upgraded__=!0,i(t),e.attachedNode(t),e.upgradeSubtree(t),a.upgrade&&console.groupEnd(),t}function r(e,t){Object.__proto__?e.__proto__=t.prototype:(o(e,t.prototype,t["native"]),e.__proto__=t.prototype)}function o(e,t,n){for(var r={},o=t;o!==n&&o!==HTMLElement.prototype;){for(var i,a=Object.getOwnPropertyNames(o),s=0;i=a[s];s++)r[i]||(Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(o,i)),r[i]=1);o=Object.getPrototypeOf(o)}}function i(e){e.createdCallback&&e.createdCallback()}var a=e.flags;e.upgrade=t,e.upgradeWithDefinition=n,e.implementPrototype=r}),window.CustomElements.addModule(function(e){function t(t,r){var c=r||{};if(!t)throw new Error("document.registerElement: first argument `name` must not be empty");if(t.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(t)+"'.");if(o(t))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(t)+"'. The type name is invalid.");if(d(t))throw new Error("DuplicateDefinitionError: a type with name '"+String(t)+"' is already registered");return c.prototype||(c.prototype=Object.create(HTMLElement.prototype)),c.__name=t.toLowerCase(),c.lifecycle=c.lifecycle||{},c.ancestry=i(c["extends"]),a(c),s(c),n(c.prototype),u(c.__name,c),c.ctor=l(c),c.ctor.prototype=c.prototype,c.prototype.constructor=c.ctor,e.ready&&_(document),c.ctor}function n(e){if(!e.setAttribute._polyfilled){var t=e.setAttribute;e.setAttribute=function(e,n){r.call(this,e,n,t)};var n=e.removeAttribute;e.removeAttribute=function(e){r.call(this,e,null,n);

},e.setAttribute._polyfilled=!0}}function r(e,t,n){e=e.toLowerCase();var r=this.getAttribute(e);n.apply(this,arguments);var o=this.getAttribute(e);this.attributeChangedCallback&&o!==r&&this.attributeChangedCallback(e,r,o)}function o(e){for(var t=0;t<E.length;t++)if(e===E[t])return!0}function i(e){var t=d(e);return t?i(t["extends"]).concat([t]):[]}function a(e){for(var t,n=e["extends"],r=0;t=e.ancestry[r];r++)n=t.is&&t.tag;e.tag=n||e.__name,n&&(e.is=e.__name)}function s(e){if(!Object.__proto__){var t=HTMLElement.prototype;if(e.is){var n=document.createElement(e.tag),r=Object.getPrototypeOf(n);r===e.prototype&&(t=r)}for(var o,i=e.prototype;i&&i!==t;)o=Object.getPrototypeOf(i),i.__proto__=o,i=o;e["native"]=t}}function c(e){return b(T(e.tag),e)}function d(e){return e?L[e.toLowerCase()]:void 0}function u(e,t){L[e]=t}function l(e){return function(){return c(e)}}function h(e,t,n){return e===M?p(t,n):N(e,t)}function p(e,t){e&&(e=e.toLowerCase()),t&&(t=t.toLowerCase());var n=d(t||e);if(n){if(e==n.tag&&t==n.is)return new n.ctor;if(!t&&!n.is)return new n.ctor}var r;return t?(r=p(e),r.setAttribute("is",t),r):(r=T(e),e.indexOf("-")>=0&&g(r,HTMLElement),r)}function f(e,t){var n=e[t];e[t]=function(){var e=n.apply(this,arguments);return w(e),e}}var m,v=e.isIE11OrOlder,_=e.upgradeDocumentTree,w=e.upgradeAll,b=e.upgradeWithDefinition,g=e.implementPrototype,y=e.useNative,E=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],L={},M="http://www.w3.org/1999/xhtml",T=document.createElement.bind(document),N=document.createElementNS.bind(document);m=Object.__proto__||y?function(e,t){return e instanceof t}:function(e,t){for(var n=e;n;){if(n===t.prototype)return!0;n=n.__proto__}return!1},f(Node.prototype,"cloneNode"),f(document,"importNode"),v&&!function(){var e=document.importNode;document.importNode=function(){var t=e.apply(document,arguments);if(t.nodeType==t.DOCUMENT_FRAGMENT_NODE){var n=document.createDocumentFragment();return n.appendChild(t),n}return t}}(),document.registerElement=t,document.createElement=p,document.createElementNS=h,e.registry=L,e["instanceof"]=m,e.reservedTagList=E,e.getRegisteredDefinition=d,document.register=document.registerElement}),function(e){function t(){a(window.wrap(document)),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(e){a(wrap(e["import"]))}),window.CustomElements.ready=!0,setTimeout(function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))})}var n=e.useNative,r=e.initializeModules,o=/Trident/.test(navigator.userAgent);if(n){var i=function(){};e.watchShadow=i,e.upgrade=i,e.upgradeAll=i,e.upgradeDocumentTree=i,e.upgradeSubtree=i,e.takeRecords=i,e["instanceof"]=function(e,t){return e instanceof t}}else r();var a=e.upgradeDocumentTree;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(e){return e}),o&&"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,t){t=t||{};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,Boolean(t.bubbles),Boolean(t.cancelable),t.detail),n.preventDefault=function(){Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})},n},window.CustomEvent.prototype=window.Event.prototype),"complete"===document.readyState||e.flags.eager)t();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var s=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(s,t)}else t();e.isIE11OrOlder=o}(window.CustomElements),"undefined"==typeof HTMLTemplateElement&&!function(){var e="template";HTMLTemplateElement=function(){},HTMLTemplateElement.prototype=Object.create(HTMLElement.prototype),HTMLTemplateElement.decorate=function(e){e.content||(e.content=e.ownerDocument.createDocumentFragment());for(var t;t=e.firstChild;)e.content.appendChild(t)},HTMLTemplateElement.bootstrap=function(t){for(var n,r=t.querySelectorAll(e),o=0,i=r.length;i>o&&(n=r[o]);o++)HTMLTemplateElement.decorate(n)},window.addEventListener("DOMContentLoaded",function(){HTMLTemplateElement.bootstrap(document)});var t=document.createElement;document.createElement=function(){"use strict";var e=t.apply(document,arguments);return"template"==e.localName&&HTMLTemplateElement.decorate(e),e}}(),function(e){var t=document.createElement("style");t.textContent="body {transition: opacity ease-in 0.2s; } \nbody[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } \n";var n=document.querySelector("head");n.insertBefore(t,n.firstChild)}(window.WebComponents);
/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=lb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=mb(b);function pb(){}pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)};function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}return h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a)return I.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)
},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(ob(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(ob(c,"script"),kb),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function tb(a){var b=l,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?zb.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(n.cssHooks[a+b].set=Gb)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||tb(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?tb(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ub(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return n.map(k,Ub,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xb,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xb(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Lb=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))
},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||n.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,n.ajaxSettings),b):tc(n.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),sc(nc,k,b,v),2===t)return v;i=k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Bc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Bc(c,a[c],b,e);return d.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Dc)Dc[a]()}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(a){var b;return k.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||n.expando+"_"+cc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Ic=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=yb(k.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Mc),b&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n});

/*
* jQuery Mobile v1.4.5
* http://jquerymobile.com
*
* Copyright 2010, 2014 jQuery Foundation, Inc. and other contributors
* Released under the MIT license.
* http://jquery.org/license
*
*/

(function ( root, doc, factory ) {
	if ( typeof define === "function" && define.amd ) {
		// AMD. Register as an anonymous module.
		define( [ "jquery" ], function ( $ ) {
			factory( $, root, doc );
			return $.mobile;
		});
	} else {
		// Browser globals
		factory( root.jQuery, root, doc );
	}
}( this, document, function ( jQuery, window, document, undefined ) {/*!
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

// Script: jQuery hashchange event
//
// *Version: 1.3, Last updated: 7/21/2010*
// 
// Project Home - http://benalman.com/projects/jquery-hashchange-plugin/
// GitHub       - http://github.com/cowboy/jquery-hashchange/
// Source       - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.js
// (Minified)   - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.min.js (0.8kb gzipped)
// 
// About: License
// 
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Examples
// 
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
// 
// hashchange event - http://benalman.com/code/projects/jquery-hashchange/examples/hashchange/
// document.domain - http://benalman.com/code/projects/jquery-hashchange/examples/document_domain/
// 
// About: Support and Testing
// 
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
// 
// jQuery Versions - 1.2.6, 1.3.2, 1.4.1, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-4, Chrome 5-6, Safari 3.2-5,
//                   Opera 9.6-10.60, iPhone 3.1, Android 1.6-2.2, BlackBerry 4.6-5.
// Unit Tests      - http://benalman.com/code/projects/jquery-hashchange/unit/
// 
// About: Known issues
// 
// While this jQuery hashchange event implementation is quite stable and
// robust, there are a few unfortunate browser bugs surrounding expected
// hashchange event-based behaviors, independent of any JavaScript
// window.onhashchange abstraction. See the following examples for more
// information:
// 
// Chrome: Back Button - http://benalman.com/code/projects/jquery-hashchange/examples/bug-chrome-back-button/
// Firefox: Remote XMLHttpRequest - http://benalman.com/code/projects/jquery-hashchange/examples/bug-firefox-remote-xhr/
// WebKit: Back Button in an Iframe - http://benalman.com/code/projects/jquery-hashchange/examples/bug-webkit-hash-iframe/
// Safari: Back Button from a different domain - http://benalman.com/code/projects/jquery-hashchange/examples/bug-safari-back-from-diff-domain/
// 
// Also note that should a browser natively support the window.onhashchange 
// event, but not report that it does, the fallback polling loop will be used.
// 
// About: Release History
// 
// 1.3   - (7/21/2010) Reorganized IE6/7 Iframe code to make it more
//         "removable" for mobile-only development. Added IE6/7 document.title
//         support. Attempted to make Iframe as hidden as possible by using
//         techniques from http://www.paciellogroup.com/blog/?p=604. Added 
//         support for the "shortcut" format $(window).hashchange( fn ) and
//         $(window).hashchange() like jQuery provides for built-in events.
//         Renamed jQuery.hashchangeDelay to <jQuery.fn.hashchange.delay> and
//         lowered its default value to 50. Added <jQuery.fn.hashchange.domain>
//         and <jQuery.fn.hashchange.src> properties plus document-domain.html
//         file to address access denied issues when setting document.domain in
//         IE6/7.
// 1.2   - (2/11/2010) Fixed a bug where coming back to a page using this plugin
//         from a page on another domain would cause an error in Safari 4. Also,
//         IE6/7 Iframe is now inserted after the body (this actually works),
//         which prevents the page from scrolling when the event is first bound.
//         Event can also now be bound before DOM ready, but it won't be usable
//         before then in IE6/7.
// 1.1   - (1/21/2010) Incorporated document.documentMode test to fix IE8 bug
//         where browser version is incorrectly reported as 8.0, despite
//         inclusion of the X-UA-Compatible IE=EmulateIE7 meta tag.
// 1.0   - (1/9/2010) Initial Release. Broke out the jQuery BBQ event.special
//         window.onhashchange functionality into a separate plugin for users
//         who want just the basic event & back button support, without all the
//         extra awesomeness that BBQ provides. This plugin will be included as
//         part of jQuery BBQ, but also be available separately.

(function($,window,undefined){
  '$:nomunge'; // Used by YUI compressor.
  
  // Reused string.
  var str_hashchange = 'hashchange',
    
    // Method / object references.
    doc = document,
    fake_onhashchange,
    special = $.event.special,
    
    // Does the browser support window.onhashchange? Note that IE8 running in
    // IE7 compatibility mode reports true for 'onhashchange' in window, even
    // though the event isn't supported, so also test document.documentMode.
    doc_mode = doc.documentMode,
    supports_onhashchange = 'on' + str_hashchange in window && ( doc_mode === undefined || doc_mode > 7 );
  
  // Get location.hash (or what you'd expect location.hash to be) sans any
  // leading #. Thanks for making this necessary, Firefox!
  function get_fragment( url ) {
    url = url || location.href;
    return '#' + url.replace( /^[^#]*#?(.*)$/, '$1' );
  };
  
  // Method: jQuery.fn.hashchange
  // 
  // Bind a handler to the window.onhashchange event or trigger all bound
  // window.onhashchange event handlers. This behavior is consistent with
  // jQuery's built-in event handlers.
  // 
  // Usage:
  // 
  // > jQuery(window).hashchange( [ handler ] );
  // 
  // Arguments:
  // 
  //  handler - (Function) Optional handler to be bound to the hashchange
  //    event. This is a "shortcut" for the more verbose form:
  //    jQuery(window).bind( 'hashchange', handler ). If handler is omitted,
  //    all bound window.onhashchange event handlers will be triggered. This
  //    is a shortcut for the more verbose
  //    jQuery(window).trigger( 'hashchange' ). These forms are described in
  //    the <hashchange event> section.
  // 
  // Returns:
  // 
  //  (jQuery) The initial jQuery collection of elements.
  
  // Allow the "shortcut" format $(elem).hashchange( fn ) for binding and
  // $(elem).hashchange() for triggering, like jQuery does for built-in events.
  $.fn[ str_hashchange ] = function( fn ) {
    return fn ? this.bind( str_hashchange, fn ) : this.trigger( str_hashchange );
  };
  
  // Property: jQuery.fn.hashchange.delay
  // 
  // The numeric interval (in milliseconds) at which the <hashchange event>
  // polling loop executes. Defaults to 50.
  
  // Property: jQuery.fn.hashchange.domain
  // 
  // If you're setting document.domain in your JavaScript, and you want hash
  // history to work in IE6/7, not only must this property be set, but you must
  // also set document.domain BEFORE jQuery is loaded into the page. This
  // property is only applicable if you are supporting IE6/7 (or IE8 operating
  // in "IE7 compatibility" mode).
  // 
  // In addition, the <jQuery.fn.hashchange.src> property must be set to the
  // path of the included "document-domain.html" file, which can be renamed or
  // modified if necessary (note that the document.domain specified must be the
  // same in both your main JavaScript as well as in this file).
  // 
  // Usage:
  // 
  // jQuery.fn.hashchange.domain = document.domain;
  
  // Property: jQuery.fn.hashchange.src
  // 
  // If, for some reason, you need to specify an Iframe src file (for example,
  // when setting document.domain as in <jQuery.fn.hashchange.domain>), you can
  // do so using this property. Note that when using this property, history
  // won't be recorded in IE6/7 until the Iframe src file loads. This property
  // is only applicable if you are supporting IE6/7 (or IE8 operating in "IE7
  // compatibility" mode).
  // 
  // Usage:
  // 
  // jQuery.fn.hashchange.src = 'path/to/file.html';
  
  $.fn[ str_hashchange ].delay = 50;
  /*
  $.fn[ str_hashchange ].domain = null;
  $.fn[ str_hashchange ].src = null;
  */
  
  // Event: hashchange event
  // 
  // Fired when location.hash changes. In browsers that support it, the native
  // HTML5 window.onhashchange event is used, otherwise a polling loop is
  // initialized, running every <jQuery.fn.hashchange.delay> milliseconds to
  // see if the hash has changed. In IE6/7 (and IE8 operating in "IE7
  // compatibility" mode), a hidden Iframe is created to allow the back button
  // and hash-based history to work.
  // 
  // Usage as described in <jQuery.fn.hashchange>:
  // 
  // > // Bind an event handler.
  // > jQuery(window).hashchange( function(e) {
  // >   var hash = location.hash;
  // >   ...
  // > });
  // > 
  // > // Manually trigger the event handler.
  // > jQuery(window).hashchange();
  // 
  // A more verbose usage that allows for event namespacing:
  // 
  // > // Bind an event handler.
  // > jQuery(window).bind( 'hashchange', function(e) {
  // >   var hash = location.hash;
  // >   ...
  // > });
  // > 
  // > // Manually trigger the event handler.
  // > jQuery(window).trigger( 'hashchange' );
  // 
  // Additional Notes:
  // 
  // * The polling loop and Iframe are not created until at least one handler
  //   is actually bound to the 'hashchange' event.
  // * If you need the bound handler(s) to execute immediately, in cases where
  //   a location.hash exists on page load, via bookmark or page refresh for
  //   example, use jQuery(window).hashchange() or the more verbose 
  //   jQuery(window).trigger( 'hashchange' ).
  // * The event can be bound before DOM ready, but since it won't be usable
  //   before then in IE6/7 (due to the necessary Iframe), recommended usage is
  //   to bind it inside a DOM ready handler.
  
  // Override existing $.event.special.hashchange methods (allowing this plugin
  // to be defined after jQuery BBQ in BBQ's source code).
  special[ str_hashchange ] = $.extend( special[ str_hashchange ], {
    
    // Called only when the first 'hashchange' event is bound to window.
    setup: function() {
      // If window.onhashchange is supported natively, there's nothing to do..
      if ( supports_onhashchange ) { return false; }
      
      // Otherwise, we need to create our own. And we don't want to call this
      // until the user binds to the event, just in case they never do, since it
      // will create a polling loop and possibly even a hidden Iframe.
      $( fake_onhashchange.start );
    },
    
    // Called only when the last 'hashchange' event is unbound from window.
    teardown: function() {
      // If window.onhashchange is supported natively, there's nothing to do..
      if ( supports_onhashchange ) { return false; }
      
      // Otherwise, we need to stop ours (if possible).
      $( fake_onhashchange.stop );
    }
    
  });
  
  // fake_onhashchange does all the work of triggering the window.onhashchange
  // event for browsers that don't natively support it, including creating a
  // polling loop to watch for hash changes and in IE 6/7 creating a hidden
  // Iframe to enable back and forward.
  fake_onhashchange = (function(){
    var self = {},
      timeout_id,
      
      // Remember the initial hash so it doesn't get triggered immediately.
      last_hash = get_fragment(),
      
      fn_retval = function(val){ return val; },
      history_set = fn_retval,
      history_get = fn_retval;
    
    // Start the polling loop.
    self.start = function() {
      timeout_id || poll();
    };
    
    // Stop the polling loop.
    self.stop = function() {
      timeout_id && clearTimeout( timeout_id );
      timeout_id = undefined;
    };
    
    // This polling loop checks every $.fn.hashchange.delay milliseconds to see
    // if location.hash has changed, and triggers the 'hashchange' event on
    // window when necessary.
    function poll() {
      var hash = get_fragment(),
        history_hash = history_get( last_hash );
      
      if ( hash !== last_hash ) {
        history_set( last_hash = hash, history_hash );
        
        $(window).trigger( str_hashchange );
        
      } else if ( history_hash !== last_hash ) {
        location.href = location.href.replace( /#.*/, '' ) + history_hash;
      }
      
      timeout_id = setTimeout( poll, $.fn[ str_hashchange ].delay );
    };
    
    // vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
    // vvvvvvvvvvvvvvvvvvv REMOVE IF NOT SUPPORTING IE6/7/8 vvvvvvvvvvvvvvvvvvv
    // vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
    window.attachEvent && !window.addEventListener && !supports_onhashchange && (function(){
      // Not only do IE6/7 need the "magical" Iframe treatment, but so does IE8
      // when running in "IE7 compatibility" mode.
      
      var iframe,
        iframe_src;
      
      // When the event is bound and polling starts in IE 6/7, create a hidden
      // Iframe for history handling.
      self.start = function(){
        if ( !iframe ) {
          iframe_src = $.fn[ str_hashchange ].src;
          iframe_src = iframe_src && iframe_src + get_fragment();
          
          // Create hidden Iframe. Attempt to make Iframe as hidden as possible
          // by using techniques from http://www.paciellogroup.com/blog/?p=604.
          iframe = $('<iframe tabindex="-1" title="empty"/>').hide()
            
            // When Iframe has completely loaded, initialize the history and
            // start polling.
            .one( 'load', function(){
              iframe_src || history_set( get_fragment() );
              poll();
            })
            
            // Load Iframe src if specified, otherwise nothing.
            .attr( 'src', iframe_src || 'javascript:0' )
            
            // Append Iframe after the end of the body to prevent unnecessary
            // initial page scrolling (yes, this works).
            .insertAfter( 'body' )[0].contentWindow;
          
          // Whenever `document.title` changes, update the Iframe's title to
          // prettify the back/next history menu entries. Since IE sometimes
          // errors with "Unspecified error" the very first time this is set
          // (yes, very useful) wrap this with a try/catch block.
          doc.onpropertychange = function(){
            try {
              if ( event.propertyName === 'title' ) {
                iframe.document.title = doc.title;
              }
            } catch(e) {}
          };
          
        }
      };
      
      // Override the "stop" method since an IE6/7 Iframe was created. Even
      // if there are no longer any bound event handlers, the polling loop
      // is still necessary for back/next to work at all!
      self.stop = fn_retval;
      
      // Get history by looking at the hidden Iframe's location.hash.
      history_get = function() {
        return get_fragment( iframe.location.href );
      };
      
      // Set a new history item by opening and then closing the Iframe
      // document, *then* setting its location.hash. If document.domain has
      // been set, update that as well.
      history_set = function( hash, history_hash ) {
        var iframe_doc = iframe.document,
          domain = $.fn[ str_hashchange ].domain;
        
        if ( hash !== history_hash ) {
          // Update Iframe with any initial `document.title` that might be set.
          iframe_doc.title = doc.title;
          
          // Opening the Iframe's document after it has been closed is what
          // actually adds a history entry.
          iframe_doc.open();
          
          // Set document.domain for the Iframe document as well, if necessary.
          domain && iframe_doc.write( '\x3cscript>document.domain="' + domain + '"\x3c/script>' );
          
          iframe_doc.close();
          
          // Update the Iframe's hash, for great justice.
          iframe.location.hash = hash;
        }
      };
      
    })();
    // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    // ^^^^^^^^^^^^^^^^^^^ REMOVE IF NOT SUPPORTING IE6/7/8 ^^^^^^^^^^^^^^^^^^^
    // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    
    return self;
  })();
  
})(jQuery,this);

(function( $ ) {
	$.mobile = {};
}( jQuery ));

(function( $, window, undefined ) {
	$.extend( $.mobile, {

		// Version of the jQuery Mobile Framework
		version: "1.4.5",

		// Deprecated and no longer used in 1.4 remove in 1.5
		// Define the url parameter used for referencing widget-generated sub-pages.
		// Translates to example.html&ui-page=subpageIdentifier
		// hash segment before &ui-page= is used to make Ajax request
		subPageUrlKey: "ui-page",

		hideUrlBar: true,

		// Keepnative Selector
		keepNative: ":jqmData(role='none'), :jqmData(role='nojs')",

		// Deprecated in 1.4 remove in 1.5
		// Class assigned to page currently in view, and during transitions
		activePageClass: "ui-page-active",

		// Deprecated in 1.4 remove in 1.5
		// Class used for "active" button state, from CSS framework
		activeBtnClass: "ui-btn-active",

		// Deprecated in 1.4 remove in 1.5
		// Class used for "focus" form element state, from CSS framework
		focusClass: "ui-focus",

		// Automatically handle clicks and form submissions through Ajax, when same-domain
		ajaxEnabled: true,

		// Automatically load and show pages based on location.hash
		hashListeningEnabled: true,

		// disable to prevent jquery from bothering with links
		linkBindingEnabled: true,

		// Set default page transition - 'none' for no transitions
		defaultPageTransition: "fade",

		// Set maximum window width for transitions to apply - 'false' for no limit
		maxTransitionWidth: false,

		// Minimum scroll distance that will be remembered when returning to a page
		// Deprecated remove in 1.5
		minScrollBack: 0,

		// Set default dialog transition - 'none' for no transitions
		defaultDialogTransition: "pop",

		// Error response message - appears when an Ajax page request fails
		pageLoadErrorMessage: "Error Loading Page",

		// For error messages, which theme does the box use?
		pageLoadErrorMessageTheme: "a",

		// replace calls to window.history.back with phonegaps navigation helper
		// where it is provided on the window object
		phonegapNavigationEnabled: false,

		//automatically initialize the DOM when it's ready
		autoInitializePage: true,

		pushStateEnabled: true,

		// allows users to opt in to ignoring content by marking a parent element as
		// data-ignored
		ignoreContentEnabled: false,

		buttonMarkup: {
			hoverDelay: 200
		},

		// disable the alteration of the dynamic base tag or links in the case
		// that a dynamic base tag isn't supported
		dynamicBaseEnabled: true,

		// default the property to remove dependency on assignment in init module
		pageContainer: $(),

		//enable cross-domain page support
		allowCrossDomainPages: false,

		dialogHashKey: "&ui-state=dialog"
	});
})( jQuery, this );

(function( $, window, undefined ) {
	var nsNormalizeDict = {},
		oldFind = $.find,
		rbrace = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/,
		jqmDataRE = /:jqmData\(([^)]*)\)/g;

	$.extend( $.mobile, {

		// Namespace used framework-wide for data-attrs. Default is no namespace

		ns: "",

		// Retrieve an attribute from an element and perform some massaging of the value

		getAttribute: function( element, key ) {
			var data;

			element = element.jquery ? element[0] : element;

			if ( element && element.getAttribute ) {
				data = element.getAttribute( "data-" + $.mobile.ns + key );
			}

			// Copied from core's src/data.js:dataAttr()
			// Convert from a string to a proper data type
			try {
				data = data === "true" ? true :
					data === "false" ? false :
					data === "null" ? null :
					// Only convert to a number if it doesn't change the string
					+data + "" === data ? +data :
					rbrace.test( data ) ? JSON.parse( data ) :
					data;
			} catch( err ) {}

			return data;
		},

		// Expose our cache for testing purposes.
		nsNormalizeDict: nsNormalizeDict,

		// Take a data attribute property, prepend the namespace
		// and then camel case the attribute string. Add the result
		// to our nsNormalizeDict so we don't have to do this again.
		nsNormalize: function( prop ) {
			return nsNormalizeDict[ prop ] ||
				( nsNormalizeDict[ prop ] = $.camelCase( $.mobile.ns + prop ) );
		},

		// Find the closest javascript page element to gather settings data jsperf test
		// http://jsperf.com/single-complex-selector-vs-many-complex-selectors/edit
		// possibly naive, but it shows that the parsing overhead for *just* the page selector vs
		// the page and dialog selector is negligable. This could probably be speed up by
		// doing a similar parent node traversal to the one found in the inherited theme code above
		closestPageData: function( $target ) {
			return $target
				.closest( ":jqmData(role='page'), :jqmData(role='dialog')" )
				.data( "mobile-page" );
		}

	});

	// Mobile version of data and removeData and hasData methods
	// ensures all data is set and retrieved using jQuery Mobile's data namespace
	$.fn.jqmData = function( prop, value ) {
		var result;
		if ( typeof prop !== "undefined" ) {
			if ( prop ) {
				prop = $.mobile.nsNormalize( prop );
			}

			// undefined is permitted as an explicit input for the second param
			// in this case it returns the value and does not set it to undefined
			if ( arguments.length < 2 || value === undefined ) {
				result = this.data( prop );
			} else {
				result = this.data( prop, value );
			}
		}
		return result;
	};

	$.jqmData = function( elem, prop, value ) {
		var result;
		if ( typeof prop !== "undefined" ) {
			result = $.data( elem, prop ? $.mobile.nsNormalize( prop ) : prop, value );
		}
		return result;
	};

	$.fn.jqmRemoveData = function( prop ) {
		return this.removeData( $.mobile.nsNormalize( prop ) );
	};

	$.jqmRemoveData = function( elem, prop ) {
		return $.removeData( elem, $.mobile.nsNormalize( prop ) );
	};

	$.find = function( selector, context, ret, extra ) {
		if ( selector.indexOf( ":jqmData" ) > -1 ) {
			selector = selector.replace( jqmDataRE, "[data-" + ( $.mobile.ns || "" ) + "$1]" );
		}

		return oldFind.call( this, selector, context, ret, extra );
	};

	$.extend( $.find, oldFind );

})( jQuery, this );

/*!
 * jQuery UI Core c0ab71056b936627e8a7821f03c044aec6280a40
 * http://jqueryui.com
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */
(function( $, undefined ) {

var uuid = 0,
	runiqueId = /^ui-id-\d+$/;

// $.ui might exist from components with no dependencies, e.g., $.ui.position
$.ui = $.ui || {};

$.extend( $.ui, {
	version: "c0ab71056b936627e8a7821f03c044aec6280a40",

	keyCode: {
		BACKSPACE: 8,
		COMMA: 188,
		DELETE: 46,
		DOWN: 40,
		END: 35,
		ENTER: 13,
		ESCAPE: 27,
		HOME: 36,
		LEFT: 37,
		PAGE_DOWN: 34,
		PAGE_UP: 33,
		PERIOD: 190,
		RIGHT: 39,
		SPACE: 32,
		TAB: 9,
		UP: 38
	}
});

// plugins
$.fn.extend({
	focus: (function( orig ) {
		return function( delay, fn ) {
			return typeof delay === "number" ?
				this.each(function() {
					var elem = this;
					setTimeout(function() {
						$( elem ).focus();
						if ( fn ) {
							fn.call( elem );
						}
					}, delay );
				}) :
				orig.apply( this, arguments );
		};
	})( $.fn.focus ),

	scrollParent: function() {
		var scrollParent;
		if (($.ui.ie && (/(static|relative)/).test(this.css("position"))) || (/absolute/).test(this.css("position"))) {
			scrollParent = this.parents().filter(function() {
				return (/(relative|absolute|fixed)/).test($.css(this,"position")) && (/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));
			}).eq(0);
		} else {
			scrollParent = this.parents().filter(function() {
				return (/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));
			}).eq(0);
		}

		return ( /fixed/ ).test( this.css( "position") ) || !scrollParent.length ? $( this[ 0 ].ownerDocument || document ) : scrollParent;
	},

	uniqueId: function() {
		return this.each(function() {
			if ( !this.id ) {
				this.id = "ui-id-" + (++uuid);
			}
		});
	},

	removeUniqueId: function() {
		return this.each(function() {
			if ( runiqueId.test( this.id ) ) {
				$( this ).removeAttr( "id" );
			}
		});
	}
});

// selectors
function focusable( element, isTabIndexNotNaN ) {
	var map, mapName, img,
		nodeName = element.nodeName.toLowerCase();
	if ( "area" === nodeName ) {
		map = element.parentNode;
		mapName = map.name;
		if ( !element.href || !mapName || map.nodeName.toLowerCase() !== "map" ) {
			return false;
		}
		img = $( "img[usemap=#" + mapName + "]" )[0];
		return !!img && visible( img );
	}
	return ( /input|select|textarea|button|object/.test( nodeName ) ?
		!element.disabled :
		"a" === nodeName ?
			element.href || isTabIndexNotNaN :
			isTabIndexNotNaN) &&
		// the element and all of its ancestors must be visible
		visible( element );
}

function visible( element ) {
	return $.expr.filters.visible( element ) &&
		!$( element ).parents().addBack().filter(function() {
			return $.css( this, "visibility" ) === "hidden";
		}).length;
}

$.extend( $.expr[ ":" ], {
	data: $.expr.createPseudo ?
		$.expr.createPseudo(function( dataName ) {
			return function( elem ) {
				return !!$.data( elem, dataName );
			};
		}) :
		// support: jQuery <1.8
		function( elem, i, match ) {
			return !!$.data( elem, match[ 3 ] );
		},

	focusable: function( element ) {
		return focusable( element, !isNaN( $.attr( element, "tabindex" ) ) );
	},

	tabbable: function( element ) {
		var tabIndex = $.attr( element, "tabindex" ),
			isTabIndexNaN = isNaN( tabIndex );
		return ( isTabIndexNaN || tabIndex >= 0 ) && focusable( element, !isTabIndexNaN );
	}
});

// support: jQuery <1.8
if ( !$( "<a>" ).outerWidth( 1 ).jquery ) {
	$.each( [ "Width", "Height" ], function( i, name ) {
		var side = name === "Width" ? [ "Left", "Right" ] : [ "Top", "Bottom" ],
			type = name.toLowerCase(),
			orig = {
				innerWidth: $.fn.innerWidth,
				innerHeight: $.fn.innerHeight,
				outerWidth: $.fn.outerWidth,
				outerHeight: $.fn.outerHeight
			};

		function reduce( elem, size, border, margin ) {
			$.each( side, function() {
				size -= parseFloat( $.css( elem, "padding" + this ) ) || 0;
				if ( border ) {
					size -= parseFloat( $.css( elem, "border" + this + "Width" ) ) || 0;
				}
				if ( margin ) {
					size -= parseFloat( $.css( elem, "margin" + this ) ) || 0;
				}
			});
			return size;
		}

		$.fn[ "inner" + name ] = function( size ) {
			if ( size === undefined ) {
				return orig[ "inner" + name ].call( this );
			}

			return this.each(function() {
				$( this ).css( type, reduce( this, size ) + "px" );
			});
		};

		$.fn[ "outer" + name] = function( size, margin ) {
			if ( typeof size !== "number" ) {
				return orig[ "outer" + name ].call( this, size );
			}

			return this.each(function() {
				$( this).css( type, reduce( this, size, true, margin ) + "px" );
			});
		};
	});
}

// support: jQuery <1.8
if ( !$.fn.addBack ) {
	$.fn.addBack = function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter( selector )
		);
	};
}

// support: jQuery 1.6.1, 1.6.2 (http://bugs.jquery.com/ticket/9413)
if ( $( "<a>" ).data( "a-b", "a" ).removeData( "a-b" ).data( "a-b" ) ) {
	$.fn.removeData = (function( removeData ) {
		return function( key ) {
			if ( arguments.length ) {
				return removeData.call( this, $.camelCase( key ) );
			} else {
				return removeData.call( this );
			}
		};
	})( $.fn.removeData );
}





// deprecated
$.ui.ie = !!/msie [\w.]+/.exec( navigator.userAgent.toLowerCase() );

$.support.selectstart = "onselectstart" in document.createElement( "div" );
$.fn.extend({
	disableSelection: function() {
		return this.bind( ( $.support.selectstart ? "selectstart" : "mousedown" ) +
			".ui-disableSelection", function( event ) {
				event.preventDefault();
			});
	},

	enableSelection: function() {
		return this.unbind( ".ui-disableSelection" );
	},

	zIndex: function( zIndex ) {
		if ( zIndex !== undefined ) {
			return this.css( "zIndex", zIndex );
		}

		if ( this.length ) {
			var elem = $( this[ 0 ] ), position, value;
			while ( elem.length && elem[ 0 ] !== document ) {
				// Ignore z-index if position is set to a value where z-index is ignored by the browser
				// This makes behavior of this function consistent across browsers
				// WebKit always returns auto if the element is positioned
				position = elem.css( "position" );
				if ( position === "absolute" || position === "relative" || position === "fixed" ) {
					// IE returns 0 when zIndex is not specified
					// other browsers return a string
					// we ignore the case of nested elements with an explicit value of 0
					// <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
					value = parseInt( elem.css( "zIndex" ), 10 );
					if ( !isNaN( value ) && value !== 0 ) {
						return value;
					}
				}
				elem = elem.parent();
			}
		}

		return 0;
	}
});

// $.ui.plugin is deprecated. Use $.widget() extensions instead.
$.ui.plugin = {
	add: function( module, option, set ) {
		var i,
			proto = $.ui[ module ].prototype;
		for ( i in set ) {
			proto.plugins[ i ] = proto.plugins[ i ] || [];
			proto.plugins[ i ].push( [ option, set[ i ] ] );
		}
	},
	call: function( instance, name, args, allowDisconnected ) {
		var i,
			set = instance.plugins[ name ];

		if ( !set ) {
			return;
		}

		if ( !allowDisconnected && ( !instance.element[ 0 ].parentNode || instance.element[ 0 ].parentNode.nodeType === 11 ) ) {
			return;
		}

		for ( i = 0; i < set.length; i++ ) {
			if ( instance.options[ set[ i ][ 0 ] ] ) {
				set[ i ][ 1 ].apply( instance.element, args );
			}
		}
	}
};

})( jQuery );

(function( $, window, undefined ) {

	// Subtract the height of external toolbars from the page height, if the page does not have
	// internal toolbars of the same type. We take care to use the widget options if we find a
	// widget instance and the element's data-attributes otherwise.
	var compensateToolbars = function( page, desiredHeight ) {
		var pageParent = page.parent(),
			toolbarsAffectingHeight = [],

			// We use this function to filter fixed toolbars with option updatePagePadding set to
			// true (which is the default) from our height subtraction, because fixed toolbars with
			// option updatePagePadding set to true compensate for their presence by adding padding
			// to the active page. We want to avoid double-counting by also subtracting their
			// height from the desired page height.
			noPadders = function() {
				var theElement = $( this ),
					widgetOptions = $.mobile.toolbar && theElement.data( "mobile-toolbar" ) ?
						theElement.toolbar( "option" ) : {
							position: theElement.attr( "data-" + $.mobile.ns + "position" ),
							updatePagePadding: ( theElement.attr( "data-" + $.mobile.ns +
								"update-page-padding" ) !== false )
						};

				return !( widgetOptions.position === "fixed" &&
					widgetOptions.updatePagePadding === true );
			},
			externalHeaders = pageParent.children( ":jqmData(role='header')" ).filter( noPadders ),
			internalHeaders = page.children( ":jqmData(role='header')" ),
			externalFooters = pageParent.children( ":jqmData(role='footer')" ).filter( noPadders ),
			internalFooters = page.children( ":jqmData(role='footer')" );

		// If we have no internal headers, but we do have external headers, then their height
		// reduces the page height
		if ( internalHeaders.length === 0 && externalHeaders.length > 0 ) {
			toolbarsAffectingHeight = toolbarsAffectingHeight.concat( externalHeaders.toArray() );
		}

		// If we have no internal footers, but we do have external footers, then their height
		// reduces the page height
		if ( internalFooters.length === 0 && externalFooters.length > 0 ) {
			toolbarsAffectingHeight = toolbarsAffectingHeight.concat( externalFooters.toArray() );
		}

		$.each( toolbarsAffectingHeight, function( index, value ) {
			desiredHeight -= $( value ).outerHeight();
		});

		// Height must be at least zero
		return Math.max( 0, desiredHeight );
	};

	$.extend( $.mobile, {
		// define the window and the document objects
		window: $( window ),
		document: $( document ),

		// TODO: Remove and use $.ui.keyCode directly
		keyCode: $.ui.keyCode,

		// Place to store various widget extensions
		behaviors: {},

		// Scroll page vertically: scroll to 0 to hide iOS address bar, or pass a Y value
		silentScroll: function( ypos ) {
			if ( $.type( ypos ) !== "number" ) {
				ypos = $.mobile.defaultHomeScroll;
			}

			// prevent scrollstart and scrollstop events
			$.event.special.scrollstart.enabled = false;

			setTimeout(function() {
				window.scrollTo( 0, ypos );
				$.mobile.document.trigger( "silentscroll", { x: 0, y: ypos });
			}, 20 );

			setTimeout(function() {
				$.event.special.scrollstart.enabled = true;
			}, 150 );
		},

		getClosestBaseUrl: function( ele )	{
			// Find the closest page and extract out its url.
			var url = $( ele ).closest( ".ui-page" ).jqmData( "url" ),
				base = $.mobile.path.documentBase.hrefNoHash;

			if ( !$.mobile.dynamicBaseEnabled || !url || !$.mobile.path.isPath( url ) ) {
				url = base;
			}

			return $.mobile.path.makeUrlAbsolute( url, base );
		},
		removeActiveLinkClass: function( forceRemoval ) {
			if ( !!$.mobile.activeClickedLink &&
				( !$.mobile.activeClickedLink.closest( "." + $.mobile.activePageClass ).length ||
					forceRemoval ) ) {

				$.mobile.activeClickedLink.removeClass( $.mobile.activeBtnClass );
			}
			$.mobile.activeClickedLink = null;
		},

		// DEPRECATED in 1.4
		// Find the closest parent with a theme class on it. Note that
		// we are not using $.fn.closest() on purpose here because this
		// method gets called quite a bit and we need it to be as fast
		// as possible.
		getInheritedTheme: function( el, defaultTheme ) {
			var e = el[ 0 ],
				ltr = "",
				re = /ui-(bar|body|overlay)-([a-z])\b/,
				c, m;
			while ( e ) {
				c = e.className || "";
				if ( c && ( m = re.exec( c ) ) && ( ltr = m[ 2 ] ) ) {
					// We found a parent with a theme class
					// on it so bail from this loop.
					break;
				}

				e = e.parentNode;
			}
			// Return the theme letter we found, if none, return the
			// specified default.
			return ltr || defaultTheme || "a";
		},

		enhanceable: function( elements ) {
			return this.haveParents( elements, "enhance" );
		},

		hijackable: function( elements ) {
			return this.haveParents( elements, "ajax" );
		},

		haveParents: function( elements, attr ) {
			if ( !$.mobile.ignoreContentEnabled ) {
				return elements;
			}

			var count = elements.length,
				$newSet = $(),
				e, $element, excluded,
				i, c;

			for ( i = 0; i < count; i++ ) {
				$element = elements.eq( i );
				excluded = false;
				e = elements[ i ];

				while ( e ) {
					c = e.getAttribute ? e.getAttribute( "data-" + $.mobile.ns + attr ) : "";

					if ( c === "false" ) {
						excluded = true;
						break;
					}

					e = e.parentNode;
				}

				if ( !excluded ) {
					$newSet = $newSet.add( $element );
				}
			}

			return $newSet;
		},

		getScreenHeight: function() {
			// Native innerHeight returns more accurate value for this across platforms,
			// jQuery version is here as a normalized fallback for platforms like Symbian
			return window.innerHeight || $.mobile.window.height();
		},

		//simply set the active page's minimum height to screen height, depending on orientation
		resetActivePageHeight: function( height ) {
			var page = $( "." + $.mobile.activePageClass ),
				pageHeight = page.height(),
				pageOuterHeight = page.outerHeight( true );

			height = compensateToolbars( page,
				( typeof height === "number" ) ? height : $.mobile.getScreenHeight() );

			// Remove any previous min-height setting
			page.css( "min-height", "" );

			// Set the minimum height only if the height as determined by CSS is insufficient
			if ( page.height() < height ) {
				page.css( "min-height", height - ( pageOuterHeight - pageHeight ) );
			}
		},

		loading: function() {
			// If this is the first call to this function, instantiate a loader widget
			var loader = this.loading._widget || $( $.mobile.loader.prototype.defaultHtml ).loader(),

				// Call the appropriate method on the loader
				returnValue = loader.loader.apply( loader, arguments );

			// Make sure the loader is retained for future calls to this function.
			this.loading._widget = loader;

			return returnValue;
		}
	});

	$.addDependents = function( elem, newDependents ) {
		var $elem = $( elem ),
			dependents = $elem.jqmData( "dependents" ) || $();

		$elem.jqmData( "dependents", $( dependents ).add( newDependents ) );
	};

	// plugins
	$.fn.extend({
		removeWithDependents: function() {
			$.removeWithDependents( this );
		},

		// Enhance child elements
		enhanceWithin: function() {
			var index,
				widgetElements = {},
				keepNative = $.mobile.page.prototype.keepNativeSelector(),
				that = this;

			// Add no js class to elements
			if ( $.mobile.nojs ) {
				$.mobile.nojs( this );
			}

			// Bind links for ajax nav
			if ( $.mobile.links ) {
				$.mobile.links( this );
			}

			// Degrade inputs for styleing
			if ( $.mobile.degradeInputsWithin ) {
				$.mobile.degradeInputsWithin( this );
			}

			// Run buttonmarkup
			if ( $.fn.buttonMarkup ) {
				this.find( $.fn.buttonMarkup.initSelector ).not( keepNative )
				.jqmEnhanceable().buttonMarkup();
			}

			// Add classes for fieldContain
			if ( $.fn.fieldcontain ) {
				this.find( ":jqmData(role='fieldcontain')" ).not( keepNative )
				.jqmEnhanceable().fieldcontain();
			}

			// Enhance widgets
			$.each( $.mobile.widgets, function( name, constructor ) {

				// If initSelector not false find elements
				if ( constructor.initSelector ) {

					// Filter elements that should not be enhanced based on parents
					var elements = $.mobile.enhanceable( that.find( constructor.initSelector ) );

					// If any matching elements remain filter ones with keepNativeSelector
					if ( elements.length > 0 ) {

						// $.mobile.page.prototype.keepNativeSelector is deprecated this is just for backcompat
						// Switch to $.mobile.keepNative in 1.5 which is just a value not a function
						elements = elements.not( keepNative );
					}

					// Enhance whatever is left
					if ( elements.length > 0 ) {
						widgetElements[ constructor.prototype.widgetName ] = elements;
					}
				}
			});

			for ( index in widgetElements ) {
				widgetElements[ index ][ index ]();
			}

			return this;
		},

		addDependents: function( newDependents ) {
			$.addDependents( this, newDependents );
		},

		// note that this helper doesn't attempt to handle the callback
		// or setting of an html element's text, its only purpose is
		// to return the html encoded version of the text in all cases. (thus the name)
		getEncodedText: function() {
			return $( "<a>" ).text( this.text() ).html();
		},

		// fluent helper function for the mobile namespaced equivalent
		jqmEnhanceable: function() {
			return $.mobile.enhanceable( this );
		},

		jqmHijackable: function() {
			return $.mobile.hijackable( this );
		}
	});

	$.removeWithDependents = function( nativeElement ) {
		var element = $( nativeElement );

		( element.jqmData( "dependents" ) || $() ).remove();
		element.remove();
	};
	$.addDependents = function( nativeElement, newDependents ) {
		var element = $( nativeElement ),
			dependents = element.jqmData( "dependents" ) || $();

		element.jqmData( "dependents", $( dependents ).add( newDependents ) );
	};

	$.find.matches = function( expr, set ) {
		return $.find( expr, null, null, set );
	};

	$.find.matchesSelector = function( node, expr ) {
		return $.find( expr, null, null, [ node ] ).length > 0;
	};

})( jQuery, this );


(function( $, undefined ) {

	/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license */
	window.matchMedia = window.matchMedia || (function( doc, undefined ) {

		var bool,
			docElem = doc.documentElement,
			refNode = docElem.firstElementChild || docElem.firstChild,
			// fakeBody required for <FF4 when executed in <head>
			fakeBody = doc.createElement( "body" ),
			div = doc.createElement( "div" );

		div.id = "mq-test-1";
		div.style.cssText = "position:absolute;top:-100em";
		fakeBody.style.background = "none";
		fakeBody.appendChild(div);

		return function(q){

			div.innerHTML = "&shy;<style media=\"" + q + "\"> #mq-test-1 { width: 42px; }</style>";

			docElem.insertBefore( fakeBody, refNode );
			bool = div.offsetWidth === 42;
			docElem.removeChild( fakeBody );

			return {
				matches: bool,
				media: q
			};

		};

	}( document ));

	// $.mobile.media uses matchMedia to return a boolean.
	$.mobile.media = function( q ) {
		return window.matchMedia( q ).matches;
	};

})(jQuery);

	(function( $, undefined ) {
		var support = {
			touch: "ontouchend" in document
		};

		$.mobile.support = $.mobile.support || {};
		$.extend( $.support, support );
		$.extend( $.mobile.support, support );
	}( jQuery ));

	(function( $, undefined ) {
		$.extend( $.support, {
			orientation: "orientation" in window && "onorientationchange" in window
		});
	}( jQuery ));

(function( $, undefined ) {

// thx Modernizr
function propExists( prop ) {
	var uc_prop = prop.charAt( 0 ).toUpperCase() + prop.substr( 1 ),
		props = ( prop + " " + vendors.join( uc_prop + " " ) + uc_prop ).split( " " ),
		v;

	for ( v in props ) {
		if ( fbCSS[ props[ v ] ] !== undefined ) {
			return true;
		}
	}
}

var fakeBody = $( "<body>" ).prependTo( "html" ),
	fbCSS = fakeBody[ 0 ].style,
	vendors = [ "Webkit", "Moz", "O" ],
	webos = "palmGetResource" in window, //only used to rule out scrollTop
	operamini = window.operamini && ({}).toString.call( window.operamini ) === "[object OperaMini]",
	bb = window.blackberry && !propExists( "-webkit-transform" ), //only used to rule out box shadow, as it's filled opaque on BB 5 and lower
	nokiaLTE7_3;

// inline SVG support test
function inlineSVG() {
	// Thanks Modernizr & Erik Dahlstrom
	var w = window,
		svg = !!w.document.createElementNS && !!w.document.createElementNS( "http://www.w3.org/2000/svg", "svg" ).createSVGRect && !( w.opera && navigator.userAgent.indexOf( "Chrome" ) === -1 ),
		support = function( data ) {
			if ( !( data && svg ) ) {
				$( "html" ).addClass( "ui-nosvg" );
			}
		},
		img = new w.Image();

	img.onerror = function() {
		support( false );
	};
	img.onload = function() {
		support( img.width === 1 && img.height === 1 );
	};
	img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
}

function transform3dTest() {
	var mqProp = "transform-3d",
		// Because the `translate3d` test below throws false positives in Android:
		ret = $.mobile.media( "(-" + vendors.join( "-" + mqProp + "),(-" ) + "-" + mqProp + "),(" + mqProp + ")" ),
		el, transforms, t;

	if ( ret ) {
		return !!ret;
	}

	el = document.createElement( "div" );
	transforms = {
		// Were omitting Opera for the time being; MS uses unprefixed.
		"MozTransform": "-moz-transform",
		"transform": "transform"
	};

	fakeBody.append( el );

	for ( t in transforms ) {
		if ( el.style[ t ] !== undefined ) {
			el.style[ t ] = "translate3d( 100px, 1px, 1px )";
			ret = window.getComputedStyle( el ).getPropertyValue( transforms[ t ] );
		}
	}
	return ( !!ret && ret !== "none" );
}

// Test for dynamic-updating base tag support ( allows us to avoid href,src attr rewriting )
function baseTagTest() {
	var fauxBase = location.protocol + "//" + location.host + location.pathname + "ui-dir/",
		base = $( "head base" ),
		fauxEle = null,
		href = "",
		link, rebase;

	if ( !base.length ) {
		base = fauxEle = $( "<base>", { "href": fauxBase }).appendTo( "head" );
	} else {
		href = base.attr( "href" );
	}

	link = $( "<a href='testurl' />" ).prependTo( fakeBody );
	rebase = link[ 0 ].href;
	base[ 0 ].href = href || location.pathname;

	if ( fauxEle ) {
		fauxEle.remove();
	}
	return rebase.indexOf( fauxBase ) === 0;
}

// Thanks Modernizr
function cssPointerEventsTest() {
	var element = document.createElement( "x" ),
		documentElement = document.documentElement,
		getComputedStyle = window.getComputedStyle,
		supports;

	if ( !( "pointerEvents" in element.style ) ) {
		return false;
	}

	element.style.pointerEvents = "auto";
	element.style.pointerEvents = "x";
	documentElement.appendChild( element );
	supports = getComputedStyle &&
	getComputedStyle( element, "" ).pointerEvents === "auto";
	documentElement.removeChild( element );
	return !!supports;
}

function boundingRect() {
	var div = document.createElement( "div" );
	return typeof div.getBoundingClientRect !== "undefined";
}

// non-UA-based IE version check by James Padolsey, modified by jdalton - from http://gist.github.com/527683
// allows for inclusion of IE 6+, including Windows Mobile 7
$.extend( $.mobile, { browser: {} } );
$.mobile.browser.oldIE = (function() {
	var v = 3,
		div = document.createElement( "div" ),
		a = div.all || [];

	do {
		div.innerHTML = "<!--[if gt IE " + ( ++v ) + "]><br><![endif]-->";
	} while( a[0] );

	return v > 4 ? v : !v;
})();

function fixedPosition() {
	var w = window,
		ua = navigator.userAgent,
		platform = navigator.platform,
		// Rendering engine is Webkit, and capture major version
		wkmatch = ua.match( /AppleWebKit\/([0-9]+)/ ),
		wkversion = !!wkmatch && wkmatch[ 1 ],
		ffmatch = ua.match( /Fennec\/([0-9]+)/ ),
		ffversion = !!ffmatch && ffmatch[ 1 ],
		operammobilematch = ua.match( /Opera Mobi\/([0-9]+)/ ),
		omversion = !!operammobilematch && operammobilematch[ 1 ];

	if (
		// iOS 4.3 and older : Platform is iPhone/Pad/Touch and Webkit version is less than 534 (ios5)
		( ( platform.indexOf( "iPhone" ) > -1 || platform.indexOf( "iPad" ) > -1  || platform.indexOf( "iPod" ) > -1 ) && wkversion && wkversion < 534 ) ||
		// Opera Mini
		( w.operamini && ({}).toString.call( w.operamini ) === "[object OperaMini]" ) ||
		( operammobilematch && omversion < 7458 )	||
		//Android lte 2.1: Platform is Android and Webkit version is less than 533 (Android 2.2)
		( ua.indexOf( "Android" ) > -1 && wkversion && wkversion < 533 ) ||
		// Firefox Mobile before 6.0 -
		( ffversion && ffversion < 6 ) ||
		// WebOS less than 3
		( "palmGetResource" in window && wkversion && wkversion < 534 )	||
		// MeeGo
		( ua.indexOf( "MeeGo" ) > -1 && ua.indexOf( "NokiaBrowser/8.5.0" ) > -1 ) ) {
		return false;
	}

	return true;
}

$.extend( $.support, {
	// Note, Chrome for iOS has an extremely quirky implementation of popstate.
	// We've chosen to take the shortest path to a bug fix here for issue #5426
	// See the following link for information about the regex chosen
	// https://developers.google.com/chrome/mobile/docs/user-agent#chrome_for_ios_user-agent
	pushState: "pushState" in history &&
		"replaceState" in history &&
		// When running inside a FF iframe, calling replaceState causes an error
		!( window.navigator.userAgent.indexOf( "Firefox" ) >= 0 && window.top !== window ) &&
		( window.navigator.userAgent.search(/CriOS/) === -1 ),

	mediaquery: $.mobile.media( "only all" ),
	cssPseudoElement: !!propExists( "content" ),
	touchOverflow: !!propExists( "overflowScrolling" ),
	cssTransform3d: transform3dTest(),
	boxShadow: !!propExists( "boxShadow" ) && !bb,
	fixedPosition: fixedPosition(),
	scrollTop: ("pageXOffset" in window ||
		"scrollTop" in document.documentElement ||
		"scrollTop" in fakeBody[ 0 ]) && !webos && !operamini,

	dynamicBaseTag: baseTagTest(),
	cssPointerEvents: cssPointerEventsTest(),
	boundingRect: boundingRect(),
	inlineSVG: inlineSVG
});

fakeBody.remove();

// $.mobile.ajaxBlacklist is used to override ajaxEnabled on platforms that have known conflicts with hash history updates (BB5, Symbian)
// or that generally work better browsing in regular http for full page refreshes (Opera Mini)
// Note: This detection below is used as a last resort.
// We recommend only using these detection methods when all other more reliable/forward-looking approaches are not possible
nokiaLTE7_3 = (function() {

	var ua = window.navigator.userAgent;

	//The following is an attempt to match Nokia browsers that are running Symbian/s60, with webkit, version 7.3 or older
	return ua.indexOf( "Nokia" ) > -1 &&
			( ua.indexOf( "Symbian/3" ) > -1 || ua.indexOf( "Series60/5" ) > -1 ) &&
			ua.indexOf( "AppleWebKit" ) > -1 &&
			ua.match( /(BrowserNG|NokiaBrowser)\/7\.[0-3]/ );
})();

// Support conditions that must be met in order to proceed
// default enhanced qualifications are media query support OR IE 7+

$.mobile.gradeA = function() {
	return ( ( $.support.mediaquery && $.support.cssPseudoElement ) || $.mobile.browser.oldIE && $.mobile.browser.oldIE >= 8 ) && ( $.support.boundingRect || $.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/) !== null );
};

$.mobile.ajaxBlacklist =
			// BlackBerry browsers, pre-webkit
			window.blackberry && !window.WebKitPoint ||
			// Opera Mini
			operamini ||
			// Symbian webkits pre 7.3
			nokiaLTE7_3;

// Lastly, this workaround is the only way we've found so far to get pre 7.3 Symbian webkit devices
// to render the stylesheets when they're referenced before this script, as we'd recommend doing.
// This simply reappends the CSS in place, which for some reason makes it apply
if ( nokiaLTE7_3 ) {
	$(function() {
		$( "head link[rel='stylesheet']" ).attr( "rel", "alternate stylesheet" ).attr( "rel", "stylesheet" );
	});
}

// For ruling out shadows via css
if ( !$.support.boxShadow ) {
	$( "html" ).addClass( "ui-noboxshadow" );
}

})( jQuery );


(function( $, undefined ) {
	var $win = $.mobile.window, self,
		dummyFnToInitNavigate = function() {
		};

	$.event.special.beforenavigate = {
		setup: function() {
			$win.on( "navigate", dummyFnToInitNavigate );
		},

		teardown: function() {
			$win.off( "navigate", dummyFnToInitNavigate );
		}
	};

	$.event.special.navigate = self = {
		bound: false,

		pushStateEnabled: true,

		originalEventName: undefined,

		// If pushstate support is present and push state support is defined to
		// be true on the mobile namespace.
		isPushStateEnabled: function() {
			return $.support.pushState &&
				$.mobile.pushStateEnabled === true &&
				this.isHashChangeEnabled();
		},

		// !! assumes mobile namespace is present
		isHashChangeEnabled: function() {
			return $.mobile.hashListeningEnabled === true;
		},

		// TODO a lot of duplication between popstate and hashchange
		popstate: function( event ) {
			var newEvent = new $.Event( "navigate" ),
				beforeNavigate = new $.Event( "beforenavigate" ),
				state = event.originalEvent.state || {};

			beforeNavigate.originalEvent = event;
			$win.trigger( beforeNavigate );

			if ( beforeNavigate.isDefaultPrevented() ) {
				return;
			}

			if ( event.historyState ) {
				$.extend(state, event.historyState);
			}

			// Make sure the original event is tracked for the end
			// user to inspect incase they want to do something special
			newEvent.originalEvent = event;

			// NOTE we let the current stack unwind because any assignment to
			//      location.hash will stop the world and run this event handler. By
			//      doing this we create a similar behavior to hashchange on hash
			//      assignment
			setTimeout(function() {
				$win.trigger( newEvent, {
					state: state
				});
			}, 0);
		},

		hashchange: function( event /*, data */ ) {
			var newEvent = new $.Event( "navigate" ),
				beforeNavigate = new $.Event( "beforenavigate" );

			beforeNavigate.originalEvent = event;
			$win.trigger( beforeNavigate );

			if ( beforeNavigate.isDefaultPrevented() ) {
				return;
			}

			// Make sure the original event is tracked for the end
			// user to inspect incase they want to do something special
			newEvent.originalEvent = event;

			// Trigger the hashchange with state provided by the user
			// that altered the hash
			$win.trigger( newEvent, {
				// Users that want to fully normalize the two events
				// will need to do history management down the stack and
				// add the state to the event before this binding is fired
				// TODO consider allowing for the explicit addition of callbacks
				//      to be fired before this value is set to avoid event timing issues
				state: event.hashchangeState || {}
			});
		},

		// TODO We really only want to set this up once
		//      but I'm not clear if there's a beter way to achieve
		//      this with the jQuery special event structure
		setup: function( /* data, namespaces */ ) {
			if ( self.bound ) {
				return;
			}

			self.bound = true;

			if ( self.isPushStateEnabled() ) {
				self.originalEventName = "popstate";
				$win.bind( "popstate.navigate", self.popstate );
			} else if ( self.isHashChangeEnabled() ) {
				self.originalEventName = "hashchange";
				$win.bind( "hashchange.navigate", self.hashchange );
			}
		}
	};
})( jQuery );



	// throttled resize event
	(function( $ ) {
		$.event.special.throttledresize = {
			setup: function() {
				$( this ).bind( "resize", handler );
			},
			teardown: function() {
				$( this ).unbind( "resize", handler );
			}
		};

		var throttle = 250,
			handler = function() {
				curr = ( new Date() ).getTime();
				diff = curr - lastCall;

				if ( diff >= throttle ) {

					lastCall = curr;
					$( this ).trigger( "throttledresize" );

				} else {

					if ( heldCall ) {
						clearTimeout( heldCall );
					}

					// Promise a held call will still execute
					heldCall = setTimeout( handler, throttle - diff );
				}
			},
			lastCall = 0,
			heldCall,
			curr,
			diff;
	})( jQuery );


(function( $, window ) {
	var win = $( window ),
		event_name = "orientationchange",
		get_orientation,
		last_orientation,
		initial_orientation_is_landscape,
		initial_orientation_is_default,
		portrait_map = { "0": true, "180": true },
		ww, wh, landscape_threshold;

	// It seems that some device/browser vendors use window.orientation values 0 and 180 to
	// denote the "default" orientation. For iOS devices, and most other smart-phones tested,
	// the default orientation is always "portrait", but in some Android and RIM based tablets,
	// the default orientation is "landscape". The following code attempts to use the window
	// dimensions to figure out what the current orientation is, and then makes adjustments
	// to the to the portrait_map if necessary, so that we can properly decode the
	// window.orientation value whenever get_orientation() is called.
	//
	// Note that we used to use a media query to figure out what the orientation the browser
	// thinks it is in:
	//
	//     initial_orientation_is_landscape = $.mobile.media("all and (orientation: landscape)");
	//
	// but there was an iPhone/iPod Touch bug beginning with iOS 4.2, up through iOS 5.1,
	// where the browser *ALWAYS* applied the landscape media query. This bug does not
	// happen on iPad.

	if ( $.support.orientation ) {

		// Check the window width and height to figure out what the current orientation
		// of the device is at this moment. Note that we've initialized the portrait map
		// values to 0 and 180, *AND* we purposely check for landscape so that if we guess
		// wrong, , we default to the assumption that portrait is the default orientation.
		// We use a threshold check below because on some platforms like iOS, the iPhone
		// form-factor can report a larger width than height if the user turns on the
		// developer console. The actual threshold value is somewhat arbitrary, we just
		// need to make sure it is large enough to exclude the developer console case.

		ww = window.innerWidth || win.width();
		wh = window.innerHeight || win.height();
		landscape_threshold = 50;

		initial_orientation_is_landscape = ww > wh && ( ww - wh ) > landscape_threshold;

		// Now check to see if the current window.orientation is 0 or 180.
		initial_orientation_is_default = portrait_map[ window.orientation ];

		// If the initial orientation is landscape, but window.orientation reports 0 or 180, *OR*
		// if the initial orientation is portrait, but window.orientation reports 90 or -90, we
		// need to flip our portrait_map values because landscape is the default orientation for
		// this device/browser.
		if ( ( initial_orientation_is_landscape && initial_orientation_is_default ) || ( !initial_orientation_is_landscape && !initial_orientation_is_default ) ) {
			portrait_map = { "-90": true, "90": true };
		}
	}

	$.event.special.orientationchange = $.extend( {}, $.event.special.orientationchange, {
		setup: function() {
			// If the event is supported natively, return false so that jQuery
			// will bind to the event using DOM methods.
			if ( $.support.orientation && !$.event.special.orientationchange.disabled ) {
				return false;
			}

			// Get the current orientation to avoid initial double-triggering.
			last_orientation = get_orientation();

			// Because the orientationchange event doesn't exist, simulate the
			// event by testing window dimensions on resize.
			win.bind( "throttledresize", handler );
		},
		teardown: function() {
			// If the event is not supported natively, return false so that
			// jQuery will unbind the event using DOM methods.
			if ( $.support.orientation && !$.event.special.orientationchange.disabled ) {
				return false;
			}

			// Because the orientationchange event doesn't exist, unbind the
			// resize event handler.
			win.unbind( "throttledresize", handler );
		},
		add: function( handleObj ) {
			// Save a reference to the bound event handler.
			var old_handler = handleObj.handler;

			handleObj.handler = function( event ) {
				// Modify event object, adding the .orientation property.
				event.orientation = get_orientation();

				// Call the originally-bound event handler and return its result.
				return old_handler.apply( this, arguments );
			};
		}
	});

	// If the event is not supported natively, this handler will be bound to
	// the window resize event to simulate the orientationchange event.
	function handler() {
		// Get the current orientation.
		var orientation = get_orientation();

		if ( orientation !== last_orientation ) {
			// The orientation has changed, so trigger the orientationchange event.
			last_orientation = orientation;
			win.trigger( event_name );
		}
	}

	// Get the current page orientation. This method is exposed publicly, should it
	// be needed, as jQuery.event.special.orientationchange.orientation()
	$.event.special.orientationchange.orientation = get_orientation = function() {
		var isPortrait = true, elem = document.documentElement;

		// prefer window orientation to the calculation based on screensize as
		// the actual screen resize takes place before or after the orientation change event
		// has been fired depending on implementation (eg android 2.3 is before, iphone after).
		// More testing is required to determine if a more reliable method of determining the new screensize
		// is possible when orientationchange is fired. (eg, use media queries + element + opacity)
		if ( $.support.orientation ) {
			// if the window orientation registers as 0 or 180 degrees report
			// portrait, otherwise landscape
			isPortrait = portrait_map[ window.orientation ];
		} else {
			isPortrait = elem && elem.clientWidth / elem.clientHeight < 1.1;
		}

		return isPortrait ? "portrait" : "landscape";
	};

	$.fn[ event_name ] = function( fn ) {
		return fn ? this.bind( event_name, fn ) : this.trigger( event_name );
	};

	// jQuery < 1.8
	if ( $.attrFn ) {
		$.attrFn[ event_name ] = true;
	}

}( jQuery, this ));


// This plugin is an experiment for abstracting away the touch and mouse
// events so that developers don't have to worry about which method of input
// the device their document is loaded on supports.
//
// The idea here is to allow the developer to register listeners for the
// basic mouse events, such as mousedown, mousemove, mouseup, and click,
// and the plugin will take care of registering the correct listeners
// behind the scenes to invoke the listener at the fastest possible time
// for that device, while still retaining the order of event firing in
// the traditional mouse environment, should multiple handlers be registered
// on the same element for different events.
//
// The current version exposes the following virtual events to jQuery bind methods:
// "vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel"

(function( $, window, document, undefined ) {

var dataPropertyName = "virtualMouseBindings",
	touchTargetPropertyName = "virtualTouchID",
	virtualEventNames = "vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split( " " ),
	touchEventProps = "clientX clientY pageX pageY screenX screenY".split( " " ),
	mouseHookProps = $.event.mouseHooks ? $.event.mouseHooks.props : [],
	mouseEventProps = $.event.props.concat( mouseHookProps ),
	activeDocHandlers = {},
	resetTimerID = 0,
	startX = 0,
	startY = 0,
	didScroll = false,
	clickBlockList = [],
	blockMouseTriggers = false,
	blockTouchTriggers = false,
	eventCaptureSupported = "addEventListener" in document,
	$document = $( document ),
	nextTouchID = 1,
	lastTouchID = 0, threshold,
	i;

$.vmouse = {
	moveDistanceThreshold: 10,
	clickDistanceThreshold: 10,
	resetTimerDuration: 1500
};

function getNativeEvent( event ) {

	while ( event && typeof event.originalEvent !== "undefined" ) {
		event = event.originalEvent;
	}
	return event;
}

function createVirtualEvent( event, eventType ) {

	var t = event.type,
		oe, props, ne, prop, ct, touch, i, j, len;

	event = $.Event( event );
	event.type = eventType;

	oe = event.originalEvent;
	props = $.event.props;

	// addresses separation of $.event.props in to $.event.mouseHook.props and Issue 3280
	// https://github.com/jquery/jquery-mobile/issues/3280
	if ( t.search( /^(mouse|click)/ ) > -1 ) {
		props = mouseEventProps;
	}

	// copy original event properties over to the new event
	// this would happen if we could call $.event.fix instead of $.Event
	// but we don't have a way to force an event to be fixed multiple times
	if ( oe ) {
		for ( i = props.length, prop; i; ) {
			prop = props[ --i ];
			event[ prop ] = oe[ prop ];
		}
	}

	// make sure that if the mouse and click virtual events are generated
	// without a .which one is defined
	if ( t.search(/mouse(down|up)|click/) > -1 && !event.which ) {
		event.which = 1;
	}

	if ( t.search(/^touch/) !== -1 ) {
		ne = getNativeEvent( oe );
		t = ne.touches;
		ct = ne.changedTouches;
		touch = ( t && t.length ) ? t[0] : ( ( ct && ct.length ) ? ct[ 0 ] : undefined );

		if ( touch ) {
			for ( j = 0, len = touchEventProps.length; j < len; j++) {
				prop = touchEventProps[ j ];
				event[ prop ] = touch[ prop ];
			}
		}
	}

	return event;
}

function getVirtualBindingFlags( element ) {

	var flags = {},
		b, k;

	while ( element ) {

		b = $.data( element, dataPropertyName );

		for (  k in b ) {
			if ( b[ k ] ) {
				flags[ k ] = flags.hasVirtualBinding = true;
			}
		}
		element = element.parentNode;
	}
	return flags;
}

function getClosestElementWithVirtualBinding( element, eventType ) {
	var b;
	while ( element ) {

		b = $.data( element, dataPropertyName );

		if ( b && ( !eventType || b[ eventType ] ) ) {
			return element;
		}
		element = element.parentNode;
	}
	return null;
}

function enableTouchBindings() {
	blockTouchTriggers = false;
}

function disableTouchBindings() {
	blockTouchTriggers = true;
}

function enableMouseBindings() {
	lastTouchID = 0;
	clickBlockList.length = 0;
	blockMouseTriggers = false;

	// When mouse bindings are enabled, our
	// touch bindings are disabled.
	disableTouchBindings();
}

function disableMouseBindings() {
	// When mouse bindings are disabled, our
	// touch bindings are enabled.
	enableTouchBindings();
}

function startResetTimer() {
	clearResetTimer();
	resetTimerID = setTimeout( function() {
		resetTimerID = 0;
		enableMouseBindings();
	}, $.vmouse.resetTimerDuration );
}

function clearResetTimer() {
	if ( resetTimerID ) {
		clearTimeout( resetTimerID );
		resetTimerID = 0;
	}
}

function triggerVirtualEvent( eventType, event, flags ) {
	var ve;

	if ( ( flags && flags[ eventType ] ) ||
				( !flags && getClosestElementWithVirtualBinding( event.target, eventType ) ) ) {

		ve = createVirtualEvent( event, eventType );

		$( event.target).trigger( ve );
	}

	return ve;
}

function mouseEventCallback( event ) {
	var touchID = $.data( event.target, touchTargetPropertyName ),
		ve;

	if ( !blockMouseTriggers && ( !lastTouchID || lastTouchID !== touchID ) ) {
		ve = triggerVirtualEvent( "v" + event.type, event );
		if ( ve ) {
			if ( ve.isDefaultPrevented() ) {
				event.preventDefault();
			}
			if ( ve.isPropagationStopped() ) {
				event.stopPropagation();
			}
			if ( ve.isImmediatePropagationStopped() ) {
				event.stopImmediatePropagation();
			}
		}
	}
}

function handleTouchStart( event ) {

	var touches = getNativeEvent( event ).touches,
		target, flags, t;

	if ( touches && touches.length === 1 ) {

		target = event.target;
		flags = getVirtualBindingFlags( target );

		if ( flags.hasVirtualBinding ) {

			lastTouchID = nextTouchID++;
			$.data( target, touchTargetPropertyName, lastTouchID );

			clearResetTimer();

			disableMouseBindings();
			didScroll = false;

			t = getNativeEvent( event ).touches[ 0 ];
			startX = t.pageX;
			startY = t.pageY;

			triggerVirtualEvent( "vmouseover", event, flags );
			triggerVirtualEvent( "vmousedown", event, flags );
		}
	}
}

function handleScroll( event ) {
	if ( blockTouchTriggers ) {
		return;
	}

	if ( !didScroll ) {
		triggerVirtualEvent( "vmousecancel", event, getVirtualBindingFlags( event.target ) );
	}

	didScroll = true;
	startResetTimer();
}

function handleTouchMove( event ) {
	if ( blockTouchTriggers ) {
		return;
	}

	var t = getNativeEvent( event ).touches[ 0 ],
		didCancel = didScroll,
		moveThreshold = $.vmouse.moveDistanceThreshold,
		flags = getVirtualBindingFlags( event.target );

		didScroll = didScroll ||
			( Math.abs( t.pageX - startX ) > moveThreshold ||
				Math.abs( t.pageY - startY ) > moveThreshold );

	if ( didScroll && !didCancel ) {
		triggerVirtualEvent( "vmousecancel", event, flags );
	}

	triggerVirtualEvent( "vmousemove", event, flags );
	startResetTimer();
}

function handleTouchEnd( event ) {
	if ( blockTouchTriggers ) {
		return;
	}

	disableTouchBindings();

	var flags = getVirtualBindingFlags( event.target ),
		ve, t;
	triggerVirtualEvent( "vmouseup", event, flags );

	if ( !didScroll ) {
		ve = triggerVirtualEvent( "vclick", event, flags );
		if ( ve && ve.isDefaultPrevented() ) {
			// The target of the mouse events that follow the touchend
			// event don't necessarily match the target used during the
			// touch. This means we need to rely on coordinates for blocking
			// any click that is generated.
			t = getNativeEvent( event ).changedTouches[ 0 ];
			clickBlockList.push({
				touchID: lastTouchID,
				x: t.clientX,
				y: t.clientY
			});

			// Prevent any mouse events that follow from triggering
			// virtual event notifications.
			blockMouseTriggers = true;
		}
	}
	triggerVirtualEvent( "vmouseout", event, flags);
	didScroll = false;

	startResetTimer();
}

function hasVirtualBindings( ele ) {
	var bindings = $.data( ele, dataPropertyName ),
		k;

	if ( bindings ) {
		for ( k in bindings ) {
			if ( bindings[ k ] ) {
				return true;
			}
		}
	}
	return false;
}

function dummyMouseHandler() {}

function getSpecialEventObject( eventType ) {
	var realType = eventType.substr( 1 );

	return {
		setup: function(/* data, namespace */) {
			// If this is the first virtual mouse binding for this element,
			// add a bindings object to its data.

			if ( !hasVirtualBindings( this ) ) {
				$.data( this, dataPropertyName, {} );
			}

			// If setup is called, we know it is the first binding for this
			// eventType, so initialize the count for the eventType to zero.
			var bindings = $.data( this, dataPropertyName );
			bindings[ eventType ] = true;

			// If this is the first virtual mouse event for this type,
			// register a global handler on the document.

			activeDocHandlers[ eventType ] = ( activeDocHandlers[ eventType ] || 0 ) + 1;

			if ( activeDocHandlers[ eventType ] === 1 ) {
				$document.bind( realType, mouseEventCallback );
			}

			// Some browsers, like Opera Mini, won't dispatch mouse/click events
			// for elements unless they actually have handlers registered on them.
			// To get around this, we register dummy handlers on the elements.

			$( this ).bind( realType, dummyMouseHandler );

			// For now, if event capture is not supported, we rely on mouse handlers.
			if ( eventCaptureSupported ) {
				// If this is the first virtual mouse binding for the document,
				// register our touchstart handler on the document.

				activeDocHandlers[ "touchstart" ] = ( activeDocHandlers[ "touchstart" ] || 0) + 1;

				if ( activeDocHandlers[ "touchstart" ] === 1 ) {
					$document.bind( "touchstart", handleTouchStart )
						.bind( "touchend", handleTouchEnd )

						// On touch platforms, touching the screen and then dragging your finger
						// causes the window content to scroll after some distance threshold is
						// exceeded. On these platforms, a scroll prevents a click event from being
						// dispatched, and on some platforms, even the touchend is suppressed. To
						// mimic the suppression of the click event, we need to watch for a scroll
						// event. Unfortunately, some platforms like iOS don't dispatch scroll
						// events until *AFTER* the user lifts their finger (touchend). This means
						// we need to watch both scroll and touchmove events to figure out whether
						// or not a scroll happenens before the touchend event is fired.

						.bind( "touchmove", handleTouchMove )
						.bind( "scroll", handleScroll );
				}
			}
		},

		teardown: function(/* data, namespace */) {
			// If this is the last virtual binding for this eventType,
			// remove its global handler from the document.

			--activeDocHandlers[ eventType ];

			if ( !activeDocHandlers[ eventType ] ) {
				$document.unbind( realType, mouseEventCallback );
			}

			if ( eventCaptureSupported ) {
				// If this is the last virtual mouse binding in existence,
				// remove our document touchstart listener.

				--activeDocHandlers[ "touchstart" ];

				if ( !activeDocHandlers[ "touchstart" ] ) {
					$document.unbind( "touchstart", handleTouchStart )
						.unbind( "touchmove", handleTouchMove )
						.unbind( "touchend", handleTouchEnd )
						.unbind( "scroll", handleScroll );
				}
			}

			var $this = $( this ),
				bindings = $.data( this, dataPropertyName );

			// teardown may be called when an element was
			// removed from the DOM. If this is the case,
			// jQuery core may have already stripped the element
			// of any data bindings so we need to check it before
			// using it.
			if ( bindings ) {
				bindings[ eventType ] = false;
			}

			// Unregister the dummy event handler.

			$this.unbind( realType, dummyMouseHandler );

			// If this is the last virtual mouse binding on the
			// element, remove the binding data from the element.

			if ( !hasVirtualBindings( this ) ) {
				$this.removeData( dataPropertyName );
			}
		}
	};
}

// Expose our custom events to the jQuery bind/unbind mechanism.

for ( i = 0; i < virtualEventNames.length; i++ ) {
	$.event.special[ virtualEventNames[ i ] ] = getSpecialEventObject( virtualEventNames[ i ] );
}

// Add a capture click handler to block clicks.
// Note that we require event capture support for this so if the device
// doesn't support it, we punt for now and rely solely on mouse events.
if ( eventCaptureSupported ) {
	document.addEventListener( "click", function( e ) {
		var cnt = clickBlockList.length,
			target = e.target,
			x, y, ele, i, o, touchID;

		if ( cnt ) {
			x = e.clientX;
			y = e.clientY;
			threshold = $.vmouse.clickDistanceThreshold;

			// The idea here is to run through the clickBlockList to see if
			// the current click event is in the proximity of one of our
			// vclick events that had preventDefault() called on it. If we find
			// one, then we block the click.
			//
			// Why do we have to rely on proximity?
			//
			// Because the target of the touch event that triggered the vclick
			// can be different from the target of the click event synthesized
			// by the browser. The target of a mouse/click event that is synthesized
			// from a touch event seems to be implementation specific. For example,
			// some browsers will fire mouse/click events for a link that is near
			// a touch event, even though the target of the touchstart/touchend event
			// says the user touched outside the link. Also, it seems that with most
			// browsers, the target of the mouse/click event is not calculated until the
			// time it is dispatched, so if you replace an element that you touched
			// with another element, the target of the mouse/click will be the new
			// element underneath that point.
			//
			// Aside from proximity, we also check to see if the target and any
			// of its ancestors were the ones that blocked a click. This is necessary
			// because of the strange mouse/click target calculation done in the
			// Android 2.1 browser, where if you click on an element, and there is a
			// mouse/click handler on one of its ancestors, the target will be the
			// innermost child of the touched element, even if that child is no where
			// near the point of touch.

			ele = target;

			while ( ele ) {
				for ( i = 0; i < cnt; i++ ) {
					o = clickBlockList[ i ];
					touchID = 0;

					if ( ( ele === target && Math.abs( o.x - x ) < threshold && Math.abs( o.y - y ) < threshold ) ||
								$.data( ele, touchTargetPropertyName ) === o.touchID ) {
						// XXX: We may want to consider removing matches from the block list
						//      instead of waiting for the reset timer to fire.
						e.preventDefault();
						e.stopPropagation();
						return;
					}
				}
				ele = ele.parentNode;
			}
		}
	}, true);
}
})( jQuery, window, document );


(function( $, window, undefined ) {
	var $document = $( document ),
		supportTouch = $.mobile.support.touch,
		scrollEvent = "touchmove scroll",
		touchStartEvent = supportTouch ? "touchstart" : "mousedown",
		touchStopEvent = supportTouch ? "touchend" : "mouseup",
		touchMoveEvent = supportTouch ? "touchmove" : "mousemove";

	// setup new event shortcuts
	$.each( ( "touchstart touchmove touchend " +
		"tap taphold " +
		"swipe swipeleft swiperight " +
		"scrollstart scrollstop" ).split( " " ), function( i, name ) {

		$.fn[ name ] = function( fn ) {
			return fn ? this.bind( name, fn ) : this.trigger( name );
		};

		// jQuery < 1.8
		if ( $.attrFn ) {
			$.attrFn[ name ] = true;
		}
	});

	function triggerCustomEvent( obj, eventType, event, bubble ) {
		var originalType = event.type;
		event.type = eventType;
		if ( bubble ) {
			$.event.trigger( event, undefined, obj );
		} else {
			$.event.dispatch.call( obj, event );
		}
		event.type = originalType;
	}

	// also handles scrollstop
	$.event.special.scrollstart = {

		enabled: true,
		setup: function() {

			var thisObject = this,
				$this = $( thisObject ),
				scrolling,
				timer;

			function trigger( event, state ) {
				scrolling = state;
				triggerCustomEvent( thisObject, scrolling ? "scrollstart" : "scrollstop", event );
			}

			// iPhone triggers scroll after a small delay; use touchmove instead
			$this.bind( scrollEvent, function( event ) {

				if ( !$.event.special.scrollstart.enabled ) {
					return;
				}

				if ( !scrolling ) {
					trigger( event, true );
				}

				clearTimeout( timer );
				timer = setTimeout( function() {
					trigger( event, false );
				}, 50 );
			});
		},
		teardown: function() {
			$( this ).unbind( scrollEvent );
		}
	};

	// also handles taphold
	$.event.special.tap = {
		tapholdThreshold: 750,
		emitTapOnTaphold: true,
		setup: function() {
			var thisObject = this,
				$this = $( thisObject ),
				isTaphold = false;

			$this.bind( "vmousedown", function( event ) {
				isTaphold = false;
				if ( event.which && event.which !== 1 ) {
					return false;
				}

				var origTarget = event.target,
					timer;

				function clearTapTimer() {
					clearTimeout( timer );
				}

				function clearTapHandlers() {
					clearTapTimer();

					$this.unbind( "vclick", clickHandler )
						.unbind( "vmouseup", clearTapTimer );
					$document.unbind( "vmousecancel", clearTapHandlers );
				}

				function clickHandler( event ) {
					clearTapHandlers();

					// ONLY trigger a 'tap' event if the start target is
					// the same as the stop target.
					if ( !isTaphold && origTarget === event.target ) {
						triggerCustomEvent( thisObject, "tap", event );
					} else if ( isTaphold ) {
						event.preventDefault();
					}
				}

				$this.bind( "vmouseup", clearTapTimer )
					.bind( "vclick", clickHandler );
				$document.bind( "vmousecancel", clearTapHandlers );

				timer = setTimeout( function() {
					if ( !$.event.special.tap.emitTapOnTaphold ) {
						isTaphold = true;
					}
					triggerCustomEvent( thisObject, "taphold", $.Event( "taphold", { target: origTarget } ) );
				}, $.event.special.tap.tapholdThreshold );
			});
		},
		teardown: function() {
			$( this ).unbind( "vmousedown" ).unbind( "vclick" ).unbind( "vmouseup" );
			$document.unbind( "vmousecancel" );
		}
	};

	// Also handles swipeleft, swiperight
	$.event.special.swipe = {

		// More than this horizontal displacement, and we will suppress scrolling.
		scrollSupressionThreshold: 30,

		// More time than this, and it isn't a swipe.
		durationThreshold: 1000,

		// Swipe horizontal displacement must be more than this.
		horizontalDistanceThreshold: 30,

		// Swipe vertical displacement must be less than this.
		verticalDistanceThreshold: 30,

		getLocation: function ( event ) {
			var winPageX = window.pageXOffset,
				winPageY = window.pageYOffset,
				x = event.clientX,
				y = event.clientY;

			if ( event.pageY === 0 && Math.floor( y ) > Math.floor( event.pageY ) ||
				event.pageX === 0 && Math.floor( x ) > Math.floor( event.pageX ) ) {

				// iOS4 clientX/clientY have the value that should have been
				// in pageX/pageY. While pageX/page/ have the value 0
				x = x - winPageX;
				y = y - winPageY;
			} else if ( y < ( event.pageY - winPageY) || x < ( event.pageX - winPageX ) ) {

				// Some Android browsers have totally bogus values for clientX/Y
				// when scrolling/zooming a page. Detectable since clientX/clientY
				// should never be smaller than pageX/pageY minus page scroll
				x = event.pageX - winPageX;
				y = event.pageY - winPageY;
			}

			return {
				x: x,
				y: y
			};
		},

		start: function( event ) {
			var data = event.originalEvent.touches ?
					event.originalEvent.touches[ 0 ] : event,
				location = $.event.special.swipe.getLocation( data );
			return {
						time: ( new Date() ).getTime(),
						coords: [ location.x, location.y ],
						origin: $( event.target )
					};
		},

		stop: function( event ) {
			var data = event.originalEvent.touches ?
					event.originalEvent.touches[ 0 ] : event,
				location = $.event.special.swipe.getLocation( data );
			return {
						time: ( new Date() ).getTime(),
						coords: [ location.x, location.y ]
					};
		},

		handleSwipe: function( start, stop, thisObject, origTarget ) {
			if ( stop.time - start.time < $.event.special.swipe.durationThreshold &&
				Math.abs( start.coords[ 0 ] - stop.coords[ 0 ] ) > $.event.special.swipe.horizontalDistanceThreshold &&
				Math.abs( start.coords[ 1 ] - stop.coords[ 1 ] ) < $.event.special.swipe.verticalDistanceThreshold ) {
				var direction = start.coords[0] > stop.coords[ 0 ] ? "swipeleft" : "swiperight";

				triggerCustomEvent( thisObject, "swipe", $.Event( "swipe", { target: origTarget, swipestart: start, swipestop: stop }), true );
				triggerCustomEvent( thisObject, direction,$.Event( direction, { target: origTarget, swipestart: start, swipestop: stop } ), true );
				return true;
			}
			return false;

		},

		// This serves as a flag to ensure that at most one swipe event event is
		// in work at any given time
		eventInProgress: false,

		setup: function() {
			var events,
				thisObject = this,
				$this = $( thisObject ),
				context = {};

			// Retrieve the events data for this element and add the swipe context
			events = $.data( this, "mobile-events" );
			if ( !events ) {
				events = { length: 0 };
				$.data( this, "mobile-events", events );
			}
			events.length++;
			events.swipe = context;

			context.start = function( event ) {

				// Bail if we're already working on a swipe event
				if ( $.event.special.swipe.eventInProgress ) {
					return;
				}
				$.event.special.swipe.eventInProgress = true;

				var stop,
					start = $.event.special.swipe.start( event ),
					origTarget = event.target,
					emitted = false;

				context.move = function( event ) {
					if ( !start || event.isDefaultPrevented() ) {
						return;
					}

					stop = $.event.special.swipe.stop( event );
					if ( !emitted ) {
						emitted = $.event.special.swipe.handleSwipe( start, stop, thisObject, origTarget );
						if ( emitted ) {

							// Reset the context to make way for the next swipe event
							$.event.special.swipe.eventInProgress = false;
						}
					}
					// prevent scrolling
					if ( Math.abs( start.coords[ 0 ] - stop.coords[ 0 ] ) > $.event.special.swipe.scrollSupressionThreshold ) {
						event.preventDefault();
					}
				};

				context.stop = function() {
						emitted = true;

						// Reset the context to make way for the next swipe event
						$.event.special.swipe.eventInProgress = false;
						$document.off( touchMoveEvent, context.move );
						context.move = null;
				};

				$document.on( touchMoveEvent, context.move )
					.one( touchStopEvent, context.stop );
			};
			$this.on( touchStartEvent, context.start );
		},

		teardown: function() {
			var events, context;

			events = $.data( this, "mobile-events" );
			if ( events ) {
				context = events.swipe;
				delete events.swipe;
				events.length--;
				if ( events.length === 0 ) {
					$.removeData( this, "mobile-events" );
				}
			}

			if ( context ) {
				if ( context.start ) {
					$( this ).off( touchStartEvent, context.start );
				}
				if ( context.move ) {
					$document.off( touchMoveEvent, context.move );
				}
				if ( context.stop ) {
					$document.off( touchStopEvent, context.stop );
				}
			}
		}
	};
	$.each({
		scrollstop: "scrollstart",
		taphold: "tap",
		swipeleft: "swipe.left",
		swiperight: "swipe.right"
	}, function( event, sourceEvent ) {

		$.event.special[ event ] = {
			setup: function() {
				$( this ).bind( sourceEvent, $.noop );
			},
			teardown: function() {
				$( this ).unbind( sourceEvent );
			}
		};
	});

})( jQuery, this );

(function( $, undefined ) {
	var props = {
			"animation": {},
			"transition": {}
		},
		testElement = document.createElement( "a" ),
		vendorPrefixes = [ "", "webkit-", "moz-", "o-" ];

	$.each( [ "animation", "transition" ], function( i, test ) {

		// Get correct name for test
		var testName = ( i === 0 ) ? test + "-" + "name" : test;

		$.each( vendorPrefixes, function( j, prefix ) {
			if ( testElement.style[ $.camelCase( prefix + testName ) ] !== undefined ) {
				 props[ test ][ "prefix" ] = prefix;
				return false;
			}
		});

		// Set event and duration names for later use
		props[ test ][ "duration" ] =
			$.camelCase( props[ test ][ "prefix" ] + test + "-" + "duration" );
		props[ test ][ "event" ] =
			$.camelCase( props[ test ][ "prefix" ] + test + "-" + "end" );

		// All lower case if not a vendor prop
		if ( props[ test ][ "prefix" ] === "" ) {
			props[ test ][ "event" ] = props[ test ][ "event" ].toLowerCase();
		}
	});

	// If a valid prefix was found then the it is supported by the browser
	$.support.cssTransitions = ( props[ "transition" ][ "prefix" ] !== undefined );
	$.support.cssAnimations = ( props[ "animation" ][ "prefix" ] !== undefined );

	// Remove the testElement
	$( testElement ).remove();

	// Animation complete callback
	$.fn.animationComplete = function( callback, type, fallbackTime ) {
		var timer, duration,
			that = this,
			eventBinding = function() {

				// Clear the timer so we don't call callback twice
				clearTimeout( timer );
				callback.apply( this, arguments );
			},
			animationType = ( !type || type === "animation" ) ? "animation" : "transition";

		// Make sure selected type is supported by browser
		if ( ( $.support.cssTransitions && animationType === "transition" ) ||
			( $.support.cssAnimations && animationType === "animation" ) ) {

			// If a fallback time was not passed set one
			if ( fallbackTime === undefined ) {

				// Make sure the was not bound to document before checking .css
				if ( $( this ).context !== document ) {

					// Parse the durration since its in second multiple by 1000 for milliseconds
					// Multiply by 3 to make sure we give the animation plenty of time.
					duration = parseFloat(
						$( this ).css( props[ animationType ].duration )
					) * 3000;
				}

				// If we could not read a duration use the default
				if ( duration === 0 || duration === undefined || isNaN( duration ) ) {
					duration = $.fn.animationComplete.defaultDuration;
				}
			}

			// Sets up the fallback if event never comes
			timer = setTimeout( function() {
				$( that ).off( props[ animationType ].event, eventBinding );
				callback.apply( that );
			}, duration );

			// Bind the event
			return $( this ).one( props[ animationType ].event, eventBinding );
		} else {

			// CSS animation / transitions not supported
			// Defer execution for consistency between webkit/non webkit
			setTimeout( $.proxy( callback, this ), 0 );
			return $( this );
		}
	};

	// Allow default callback to be configured on mobileInit
	$.fn.animationComplete.defaultDuration = 1000;
})( jQuery );


// buttonMarkup is deprecated as of 1.4.0 and will be removed in 1.5.0.

(function( $, undefined ) {

// General policy: Do not access data-* attributes except during enhancement.
// In all other cases we determine the state of the button exclusively from its
// className. That's why optionsToClasses expects a full complement of options,
// and the jQuery plugin completes the set of options from the default values.

// Map classes to buttonMarkup boolean options - used in classNameToOptions()
var reverseBoolOptionMap = {
		"ui-shadow" : "shadow",
		"ui-corner-all" : "corners",
		"ui-btn-inline" : "inline",
		"ui-shadow-icon" : "iconshadow", /* TODO: Remove in 1.5 */
		"ui-mini" : "mini"
	},
	getAttrFixed = function() {
		var ret = $.mobile.getAttribute.apply( this, arguments );

		return ( ret == null ? undefined : ret );
	},
	capitalLettersRE = /[A-Z]/g;

// optionsToClasses:
// @options: A complete set of options to convert to class names.
// @existingClasses: extra classes to add to the result
//
// Converts @options to buttonMarkup classes and returns the result as an array
// that can be converted to an element's className with .join( " " ). All
// possible options must be set inside @options. Use $.fn.buttonMarkup.defaults
// to get a complete set and use $.extend to override your choice of options
// from that set.
function optionsToClasses( options, existingClasses ) {
	var classes = existingClasses ? existingClasses : [];

	// Add classes to the array - first ui-btn
	classes.push( "ui-btn" );

	// If there is a theme
	if ( options.theme ) {
		classes.push( "ui-btn-" + options.theme );
	}

	// If there's an icon, add the icon-related classes
	if ( options.icon ) {
		classes = classes.concat([
			"ui-icon-" + options.icon,
			"ui-btn-icon-" + options.iconpos
		]);
		if ( options.iconshadow ) {
			classes.push( "ui-shadow-icon" ); /* TODO: Remove in 1.5 */
		}
	}

	// Add the appropriate class for each boolean option
	if ( options.inline ) {
		classes.push( "ui-btn-inline" );
	}
	if ( options.shadow ) {
		classes.push( "ui-shadow" );
	}
	if ( options.corners ) {
		classes.push( "ui-corner-all" );
	}
	if ( options.mini ) {
		classes.push( "ui-mini" );
	}

	// Create a string from the array and return it
	return classes;
}

// classNameToOptions:
// @classes: A string containing a .className-style space-separated class list
//
// Loops over @classes and calculates an options object based on the
// buttonMarkup-related classes it finds. It records unrecognized classes in an
// array.
//
// Returns: An object containing the following items:
//
// "options": buttonMarkup options found to be present because of the
// presence/absence of corresponding classes
//
// "unknownClasses": a string containing all the non-buttonMarkup-related
// classes found in @classes
//
// "alreadyEnhanced": A boolean indicating whether the ui-btn class was among
// those found to be present
function classNameToOptions( classes ) {
	var idx, map, unknownClass,
		alreadyEnhanced = false,
		noIcon = true,
		o = {
			icon: "",
			inline: false,
			shadow: false,
			corners: false,
			iconshadow: false,
			mini: false
		},
		unknownClasses = [];

	classes = classes.split( " " );

	// Loop over the classes
	for ( idx = 0 ; idx < classes.length ; idx++ ) {

		// Assume it's an unrecognized class
		unknownClass = true;

		// Recognize boolean options from the presence of classes
		map = reverseBoolOptionMap[ classes[ idx ] ];
		if ( map !== undefined ) {
			unknownClass = false;
			o[ map ] = true;

		// Recognize the presence of an icon and establish the icon position
		} else if ( classes[ idx ].indexOf( "ui-btn-icon-" ) === 0 ) {
			unknownClass = false;
			noIcon = false;
			o.iconpos = classes[ idx ].substring( 12 );

		// Establish which icon is present
		} else if ( classes[ idx ].indexOf( "ui-icon-" ) === 0 ) {
			unknownClass = false;
			o.icon = classes[ idx ].substring( 8 );

		// Establish the theme - this recognizes one-letter theme swatch names
		} else if ( classes[ idx ].indexOf( "ui-btn-" ) === 0 && classes[ idx ].length === 8 ) {
			unknownClass = false;
			o.theme = classes[ idx ].substring( 7 );

		// Recognize that this element has already been buttonMarkup-enhanced
		} else if ( classes[ idx ] === "ui-btn" ) {
			unknownClass = false;
			alreadyEnhanced = true;
		}

		// If this class has not been recognized, add it to the list
		if ( unknownClass ) {
			unknownClasses.push( classes[ idx ] );
		}
	}

	// If a "ui-btn-icon-*" icon position class is absent there cannot be an icon
	if ( noIcon ) {
		o.icon = "";
	}

	return {
		options: o,
		unknownClasses: unknownClasses,
		alreadyEnhanced: alreadyEnhanced
	};
}

function camelCase2Hyphenated( c ) {
	return "-" + c.toLowerCase();
}

// $.fn.buttonMarkup:
// DOM: gets/sets .className
//
// @options: options to apply to the elements in the jQuery object
// @overwriteClasses: boolean indicating whether to honour existing classes
//
// Calculates the classes to apply to the elements in the jQuery object based on
// the options passed in. If @overwriteClasses is true, it sets the className
// property of each element in the jQuery object to the buttonMarkup classes
// it calculates based on the options passed in.
//
// If you wish to preserve any classes that are already present on the elements
// inside the jQuery object, including buttonMarkup-related classes that were
// added by a previous call to $.fn.buttonMarkup() or during page enhancement
// then you should omit @overwriteClasses or set it to false.
$.fn.buttonMarkup = function( options, overwriteClasses ) {
	var idx, data, el, retrievedOptions, optionKey,
		defaults = $.fn.buttonMarkup.defaults;

	for ( idx = 0 ; idx < this.length ; idx++ ) {
		el = this[ idx ];
		data = overwriteClasses ?

			// Assume this element is not enhanced and ignore its classes
			{ alreadyEnhanced: false, unknownClasses: [] } :

			// Otherwise analyze existing classes to establish existing options and
			// classes
			classNameToOptions( el.className );

		retrievedOptions = $.extend( {},

			// If the element already has the class ui-btn, then we assume that
			// it has passed through buttonMarkup before - otherwise, the options
			// returned by classNameToOptions do not correctly reflect the state of
			// the element
			( data.alreadyEnhanced ? data.options : {} ),

			// Finally, apply the options passed in
			options );

		// If this is the first call on this element, retrieve remaining options
		// from the data-attributes
		if ( !data.alreadyEnhanced ) {
			for ( optionKey in defaults ) {
				if ( retrievedOptions[ optionKey ] === undefined ) {
					retrievedOptions[ optionKey ] = getAttrFixed( el,
						optionKey.replace( capitalLettersRE, camelCase2Hyphenated )
					);
				}
			}
		}

		el.className = optionsToClasses(

			// Merge all the options and apply them as classes
			$.extend( {},

				// The defaults form the basis
				defaults,

				// Add the computed options
				retrievedOptions
			),

			// ... and re-apply any unrecognized classes that were found
			data.unknownClasses ).join( " " );
		if ( el.tagName.toLowerCase() !== "button" ) {
			el.setAttribute( "role", "button" );
		}
	}

	return this;
};

// buttonMarkup defaults. This must be a complete set, i.e., a value must be
// given here for all recognized options
$.fn.buttonMarkup.defaults = {
	icon: "",
	iconpos: "left",
	theme: null,
	inline: false,
	shadow: true,
	corners: true,
	iconshadow: false, /* TODO: Remove in 1.5. Option deprecated in 1.4. */
	mini: false
};

$.extend( $.fn.buttonMarkup, {
	initSelector: "a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button:not(:jqmData(role='navbar') button)"
});

})( jQuery );


/*!
 * jQuery UI Widget c0ab71056b936627e8a7821f03c044aec6280a40
 * http://jqueryui.com
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */
(function( $, undefined ) {

var uuid = 0,
	slice = Array.prototype.slice,
	_cleanData = $.cleanData;
$.cleanData = function( elems ) {
	for ( var i = 0, elem; (elem = elems[i]) != null; i++ ) {
		try {
			$( elem ).triggerHandler( "remove" );
		// http://bugs.jquery.com/ticket/8235
		} catch( e ) {}
	}
	_cleanData( elems );
};

$.widget = function( name, base, prototype ) {
	var fullName, existingConstructor, constructor, basePrototype,
		// proxiedPrototype allows the provided prototype to remain unmodified
		// so that it can be used as a mixin for multiple widgets (#8876)
		proxiedPrototype = {},
		namespace = name.split( "." )[ 0 ];

	name = name.split( "." )[ 1 ];
	fullName = namespace + "-" + name;

	if ( !prototype ) {
		prototype = base;
		base = $.Widget;
	}

	// create selector for plugin
	$.expr[ ":" ][ fullName.toLowerCase() ] = function( elem ) {
		return !!$.data( elem, fullName );
	};

	$[ namespace ] = $[ namespace ] || {};
	existingConstructor = $[ namespace ][ name ];
	constructor = $[ namespace ][ name ] = function( options, element ) {
		// allow instantiation without "new" keyword
		if ( !this._createWidget ) {
			return new constructor( options, element );
		}

		// allow instantiation without initializing for simple inheritance
		// must use "new" keyword (the code above always passes args)
		if ( arguments.length ) {
			this._createWidget( options, element );
		}
	};
	// extend with the existing constructor to carry over any static properties
	$.extend( constructor, existingConstructor, {
		version: prototype.version,
		// copy the object used to create the prototype in case we need to
		// redefine the widget later
		_proto: $.extend( {}, prototype ),
		// track widgets that inherit from this widget in case this widget is
		// redefined after a widget inherits from it
		_childConstructors: []
	});

	basePrototype = new base();
	// we need to make the options hash a property directly on the new instance
	// otherwise we'll modify the options hash on the prototype that we're
	// inheriting from
	basePrototype.options = $.widget.extend( {}, basePrototype.options );
	$.each( prototype, function( prop, value ) {
		if ( !$.isFunction( value ) ) {
			proxiedPrototype[ prop ] = value;
			return;
		}
		proxiedPrototype[ prop ] = (function() {
			var _super = function() {
					return base.prototype[ prop ].apply( this, arguments );
				},
				_superApply = function( args ) {
					return base.prototype[ prop ].apply( this, args );
				};
			return function() {
				var __super = this._super,
					__superApply = this._superApply,
					returnValue;

				this._super = _super;
				this._superApply = _superApply;

				returnValue = value.apply( this, arguments );

				this._super = __super;
				this._superApply = __superApply;

				return returnValue;
			};
		})();
	});
	constructor.prototype = $.widget.extend( basePrototype, {
		// TODO: remove support for widgetEventPrefix
		// always use the name + a colon as the prefix, e.g., draggable:start
		// don't prefix for widgets that aren't DOM-based
		widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name
	}, proxiedPrototype, {
		constructor: constructor,
		namespace: namespace,
		widgetName: name,
		widgetFullName: fullName
	});

	// If this widget is being redefined then we need to find all widgets that
	// are inheriting from it and redefine all of them so that they inherit from
	// the new version of this widget. We're essentially trying to replace one
	// level in the prototype chain.
	if ( existingConstructor ) {
		$.each( existingConstructor._childConstructors, function( i, child ) {
			var childPrototype = child.prototype;

			// redefine the child widget using the same prototype that was
			// originally used, but inherit from the new version of the base
			$.widget( childPrototype.namespace + "." + childPrototype.widgetName, constructor, child._proto );
		});
		// remove the list of existing child constructors from the old constructor
		// so the old child constructors can be garbage collected
		delete existingConstructor._childConstructors;
	} else {
		base._childConstructors.push( constructor );
	}

	$.widget.bridge( name, constructor );

	return constructor;
};

$.widget.extend = function( target ) {
	var input = slice.call( arguments, 1 ),
		inputIndex = 0,
		inputLength = input.length,
		key,
		value;
	for ( ; inputIndex < inputLength; inputIndex++ ) {
		for ( key in input[ inputIndex ] ) {
			value = input[ inputIndex ][ key ];
			if ( input[ inputIndex ].hasOwnProperty( key ) && value !== undefined ) {
				// Clone objects
				if ( $.isPlainObject( value ) ) {
					target[ key ] = $.isPlainObject( target[ key ] ) ?
						$.widget.extend( {}, target[ key ], value ) :
						// Don't extend strings, arrays, etc. with objects
						$.widget.extend( {}, value );
				// Copy everything else by reference
				} else {
					target[ key ] = value;
				}
			}
		}
	}
	return target;
};

$.widget.bridge = function( name, object ) {
	var fullName = object.prototype.widgetFullName || name;
	$.fn[ name ] = function( options ) {
		var isMethodCall = typeof options === "string",
			args = slice.call( arguments, 1 ),
			returnValue = this;

		// allow multiple hashes to be passed on init
		options = !isMethodCall && args.length ?
			$.widget.extend.apply( null, [ options ].concat(args) ) :
			options;

		if ( isMethodCall ) {
			this.each(function() {
				var methodValue,
					instance = $.data( this, fullName );
				if ( options === "instance" ) {
					returnValue = instance;
					return false;
				}
				if ( !instance ) {
					return $.error( "cannot call methods on " + name + " prior to initialization; " +
						"attempted to call method '" + options + "'" );
				}
				if ( !$.isFunction( instance[options] ) || options.charAt( 0 ) === "_" ) {
					return $.error( "no such method '" + options + "' for " + name + " widget instance" );
				}
				methodValue = instance[ options ].apply( instance, args );
				if ( methodValue !== instance && methodValue !== undefined ) {
					returnValue = methodValue && methodValue.jquery ?
						returnValue.pushStack( methodValue.get() ) :
						methodValue;
					return false;
				}
			});
		} else {
			this.each(function() {
				var instance = $.data( this, fullName );
				if ( instance ) {
					instance.option( options || {} )._init();
				} else {
					$.data( this, fullName, new object( options, this ) );
				}
			});
		}

		return returnValue;
	};
};

$.Widget = function( /* options, element */ ) {};
$.Widget._childConstructors = [];

$.Widget.prototype = {
	widgetName: "widget",
	widgetEventPrefix: "",
	defaultElement: "<div>",
	options: {
		disabled: false,

		// callbacks
		create: null
	},
	_createWidget: function( options, element ) {
		element = $( element || this.defaultElement || this )[ 0 ];
		this.element = $( element );
		this.uuid = uuid++;
		this.eventNamespace = "." + this.widgetName + this.uuid;
		this.options = $.widget.extend( {},
			this.options,
			this._getCreateOptions(),
			options );

		this.bindings = $();
		this.hoverable = $();
		this.focusable = $();

		if ( element !== this ) {
			$.data( element, this.widgetFullName, this );
			this._on( true, this.element, {
				remove: function( event ) {
					if ( event.target === element ) {
						this.destroy();
					}
				}
			});
			this.document = $( element.style ?
				// element within the document
				element.ownerDocument :
				// element is window or document
				element.document || element );
			this.window = $( this.document[0].defaultView || this.document[0].parentWindow );
		}

		this._create();
		this._trigger( "create", null, this._getCreateEventData() );
		this._init();
	},
	_getCreateOptions: $.noop,
	_getCreateEventData: $.noop,
	_create: $.noop,
	_init: $.noop,

	destroy: function() {
		this._destroy();
		// we can probably remove the unbind calls in 2.0
		// all event bindings should go through this._on()
		this.element
			.unbind( this.eventNamespace )
			.removeData( this.widgetFullName )
			// support: jquery <1.6.3
			// http://bugs.jquery.com/ticket/9413
			.removeData( $.camelCase( this.widgetFullName ) );
		this.widget()
			.unbind( this.eventNamespace )
			.removeAttr( "aria-disabled" )
			.removeClass(
				this.widgetFullName + "-disabled " +
				"ui-state-disabled" );

		// clean up events and states
		this.bindings.unbind( this.eventNamespace );
		this.hoverable.removeClass( "ui-state-hover" );
		this.focusable.removeClass( "ui-state-focus" );
	},
	_destroy: $.noop,

	widget: function() {
		return this.element;
	},

	option: function( key, value ) {
		var options = key,
			parts,
			curOption,
			i;

		if ( arguments.length === 0 ) {
			// don't return a reference to the internal hash
			return $.widget.extend( {}, this.options );
		}

		if ( typeof key === "string" ) {
			// handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }
			options = {};
			parts = key.split( "." );
			key = parts.shift();
			if ( parts.length ) {
				curOption = options[ key ] = $.widget.extend( {}, this.options[ key ] );
				for ( i = 0; i < parts.length - 1; i++ ) {
					curOption[ parts[ i ] ] = curOption[ parts[ i ] ] || {};
					curOption = curOption[ parts[ i ] ];
				}
				key = parts.pop();
				if ( value === undefined ) {
					return curOption[ key ] === undefined ? null : curOption[ key ];
				}
				curOption[ key ] = value;
			} else {
				if ( value === undefined ) {
					return this.options[ key ] === undefined ? null : this.options[ key ];
				}
				options[ key ] = value;
			}
		}

		this._setOptions( options );

		return this;
	},
	_setOptions: function( options ) {
		var key;

		for ( key in options ) {
			this._setOption( key, options[ key ] );
		}

		return this;
	},
	_setOption: function( key, value ) {
		this.options[ key ] = value;

		if ( key === "disabled" ) {
			this.widget()
				.toggleClass( this.widgetFullName + "-disabled", !!value );
			this.hoverable.removeClass( "ui-state-hover" );
			this.focusable.removeClass( "ui-state-focus" );
		}

		return this;
	},

	enable: function() {
		return this._setOptions({ disabled: false });
	},
	disable: function() {
		return this._setOptions({ disabled: true });
	},

	_on: function( suppressDisabledCheck, element, handlers ) {
		var delegateElement,
			instance = this;

		// no suppressDisabledCheck flag, shuffle arguments
		if ( typeof suppressDisabledCheck !== "boolean" ) {
			handlers = element;
			element = suppressDisabledCheck;
			suppressDisabledCheck = false;
		}

		// no element argument, shuffle and use this.element
		if ( !handlers ) {
			handlers = element;
			element = this.element;
			delegateElement = this.widget();
		} else {
			// accept selectors, DOM elements
			element = delegateElement = $( element );
			this.bindings = this.bindings.add( element );
		}

		$.each( handlers, function( event, handler ) {
			function handlerProxy() {
				// allow widgets to customize the disabled handling
				// - disabled as an array instead of boolean
				// - disabled class as method for disabling individual parts
				if ( !suppressDisabledCheck &&
						( instance.options.disabled === true ||
							$( this ).hasClass( "ui-state-disabled" ) ) ) {
					return;
				}
				return ( typeof handler === "string" ? instance[ handler ] : handler )
					.apply( instance, arguments );
			}

			// copy the guid so direct unbinding works
			if ( typeof handler !== "string" ) {
				handlerProxy.guid = handler.guid =
					handler.guid || handlerProxy.guid || $.guid++;
			}

			var match = event.match( /^(\w+)\s*(.*)$/ ),
				eventName = match[1] + instance.eventNamespace,
				selector = match[2];
			if ( selector ) {
				delegateElement.delegate( selector, eventName, handlerProxy );
			} else {
				element.bind( eventName, handlerProxy );
			}
		});
	},

	_off: function( element, eventName ) {
		eventName = (eventName || "").split( " " ).join( this.eventNamespace + " " ) + this.eventNamespace;
		element.unbind( eventName ).undelegate( eventName );
	},

	_delay: function( handler, delay ) {
		function handlerProxy() {
			return ( typeof handler === "string" ? instance[ handler ] : handler )
				.apply( instance, arguments );
		}
		var instance = this;
		return setTimeout( handlerProxy, delay || 0 );
	},

	_hoverable: function( element ) {
		this.hoverable = this.hoverable.add( element );
		this._on( element, {
			mouseenter: function( event ) {
				$( event.currentTarget ).addClass( "ui-state-hover" );
			},
			mouseleave: function( event ) {
				$( event.currentTarget ).removeClass( "ui-state-hover" );
			}
		});
	},

	_focusable: function( element ) {
		this.focusable = this.focusable.add( element );
		this._on( element, {
			focusin: function( event ) {
				$( event.currentTarget ).addClass( "ui-state-focus" );
			},
			focusout: function( event ) {
				$( event.currentTarget ).removeClass( "ui-state-focus" );
			}
		});
	},

	_trigger: function( type, event, data ) {
		var prop, orig,
			callback = this.options[ type ];

		data = data || {};
		event = $.Event( event );
		event.type = ( type === this.widgetEventPrefix ?
			type :
			this.widgetEventPrefix + type ).toLowerCase();
		// the original event may come from any element
		// so we need to reset the target on the new event
		event.target = this.element[ 0 ];

		// copy original event properties over to the new event
		orig = event.originalEvent;
		if ( orig ) {
			for ( prop in orig ) {
				if ( !( prop in event ) ) {
					event[ prop ] = orig[ prop ];
				}
			}
		}

		this.element.trigger( event, data );
		return !( $.isFunction( callback ) &&
			callback.apply( this.element[0], [ event ].concat( data ) ) === false ||
			event.isDefaultPrevented() );
	}
};

$.each( { show: "fadeIn", hide: "fadeOut" }, function( method, defaultEffect ) {
	$.Widget.prototype[ "_" + method ] = function( element, options, callback ) {
		if ( typeof options === "string" ) {
			options = { effect: options };
		}
		var hasOptions,
			effectName = !options ?
				method :
				options === true || typeof options === "number" ?
					defaultEffect :
					options.effect || defaultEffect;
		options = options || {};
		if ( typeof options === "number" ) {
			options = { duration: options };
		}
		hasOptions = !$.isEmptyObject( options );
		options.complete = callback;
		if ( options.delay ) {
			element.delay( options.delay );
		}
		if ( hasOptions && $.effects && $.effects.effect[ effectName ] ) {
			element[ method ]( options );
		} else if ( effectName !== method && element[ effectName ] ) {
			element[ effectName ]( options.duration, options.easing, callback );
		} else {
			element.queue(function( next ) {
				$( this )[ method ]();
				if ( callback ) {
					callback.call( element[ 0 ] );
				}
				next();
			});
		}
	};
});

})( jQuery );

(function( $, undefined ) {

var rcapitals = /[A-Z]/g,
	replaceFunction = function( c ) {
		return "-" + c.toLowerCase();
	};

$.extend( $.Widget.prototype, {
	_getCreateOptions: function() {
		var option, value,
			elem = this.element[ 0 ],
			options = {};

		//
		if ( !$.mobile.getAttribute( elem, "defaults" ) ) {
			for ( option in this.options ) {
				value = $.mobile.getAttribute( elem, option.replace( rcapitals, replaceFunction ) );

				if ( value != null ) {
					options[ option ] = value;
				}
			}
		}

		return options;
	}
});

//TODO: Remove in 1.5 for backcompat only
$.mobile.widget = $.Widget;

})( jQuery );

(function( $, undefined ) {
$.mobile.widgets = {};

var originalWidget = $.widget,

	// Record the original, non-mobileinit-modified version of $.mobile.keepNative
	// so we can later determine whether someone has modified $.mobile.keepNative
	keepNativeFactoryDefault = $.mobile.keepNative;

$.widget = (function( orig ) {
	return function() {
		var constructor = orig.apply( this, arguments ),
			name = constructor.prototype.widgetName;

		constructor.initSelector = ( ( constructor.prototype.initSelector !== undefined ) ?
			constructor.prototype.initSelector : ":jqmData(role='" + name + "')" );

		$.mobile.widgets[ name ] = constructor;

		return constructor;
	};
})( $.widget );

// Make sure $.widget still has bridge and extend methods
$.extend( $.widget, originalWidget );

// For backcompat remove in 1.5
$.mobile.document.on( "create", function( event ) {
	$( event.target ).enhanceWithin();
});

$.widget( "mobile.page", {
	options: {
		theme: "a",
		domCache: false,

		// Deprecated in 1.4 remove in 1.5
		keepNativeDefault: $.mobile.keepNative,

		// Deprecated in 1.4 remove in 1.5
		contentTheme: null,
		enhanced: false
	},

	// DEPRECATED for > 1.4
	// TODO remove at 1.5
	_createWidget: function() {
		$.Widget.prototype._createWidget.apply( this, arguments );
		this._trigger( "init" );
	},

	_create: function() {
		// If false is returned by the callbacks do not create the page
		if ( this._trigger( "beforecreate" ) === false ) {
			return false;
		}

		if ( !this.options.enhanced ) {
			this._enhance();
		}

		this._on( this.element, {
			pagebeforehide: "removeContainerBackground",
			pagebeforeshow: "_handlePageBeforeShow"
		});

		this.element.enhanceWithin();
		// Dialog widget is deprecated in 1.4 remove this in 1.5
		if ( $.mobile.getAttribute( this.element[0], "role" ) === "dialog" && $.mobile.dialog ) {
			this.element.dialog();
		}
	},

	_enhance: function () {
		var attrPrefix = "data-" + $.mobile.ns,
			self = this;

		if ( this.options.role ) {
			this.element.attr( "data-" + $.mobile.ns + "role", this.options.role );
		}

		this.element
			.attr( "tabindex", "0" )
			.addClass( "ui-page ui-page-theme-" + this.options.theme );

		// Manipulation of content os Deprecated as of 1.4 remove in 1.5
		this.element.find( "[" + attrPrefix + "role='content']" ).each( function() {
			var $this = $( this ),
				theme = this.getAttribute( attrPrefix + "theme" ) || undefined;
				self.options.contentTheme = theme || self.options.contentTheme || ( self.options.dialog && self.options.theme ) || ( self.element.jqmData("role") === "dialog" &&  self.options.theme );
				$this.addClass( "ui-content" );
				if ( self.options.contentTheme ) {
					$this.addClass( "ui-body-" + ( self.options.contentTheme ) );
				}
				// Add ARIA role
				$this.attr( "role", "main" ).addClass( "ui-content" );
		});
	},

	bindRemove: function( callback ) {
		var page = this.element;

		// when dom caching is not enabled or the page is embedded bind to remove the page on hide
		if ( !page.data( "mobile-page" ).options.domCache &&
			page.is( ":jqmData(external-page='true')" ) ) {

			// TODO use _on - that is, sort out why it doesn't work in this case
			page.bind( "pagehide.remove", callback || function( e, data ) {

				//check if this is a same page transition and if so don't remove the page
				if( !data.samePage ){
					var $this = $( this ),
						prEvent = new $.Event( "pageremove" );

					$this.trigger( prEvent );

					if ( !prEvent.isDefaultPrevented() ) {
						$this.removeWithDependents();
					}
				}
			});
		}
	},

	_setOptions: function( o ) {
		if ( o.theme !== undefined ) {
			this.element.removeClass( "ui-page-theme-" + this.options.theme ).addClass( "ui-page-theme-" + o.theme );
		}

		if ( o.contentTheme !== undefined ) {
			this.element.find( "[data-" + $.mobile.ns + "='content']" ).removeClass( "ui-body-" + this.options.contentTheme )
				.addClass( "ui-body-" + o.contentTheme );
		}
	},

	_handlePageBeforeShow: function(/* e */) {
		this.setContainerBackground();
	},
	// Deprecated in 1.4 remove in 1.5
	removeContainerBackground: function() {
		this.element.closest( ":mobile-pagecontainer" ).pagecontainer({ "theme": "none" });
	},
	// Deprecated in 1.4 remove in 1.5
	// set the page container background to the page theme
	setContainerBackground: function( theme ) {
		this.element.parent().pagecontainer( { "theme": theme || this.options.theme } );
	},
	// Deprecated in 1.4 remove in 1.5
	keepNativeSelector: function() {
		var options = this.options,
			keepNative = $.trim( options.keepNative || "" ),
			globalValue = $.trim( $.mobile.keepNative ),
			optionValue = $.trim( options.keepNativeDefault ),

			// Check if $.mobile.keepNative has changed from the factory default
			newDefault = ( keepNativeFactoryDefault === globalValue ?
				"" : globalValue ),

			// If $.mobile.keepNative has not changed, use options.keepNativeDefault
			oldDefault = ( newDefault === "" ? optionValue : "" );

		// Concatenate keepNative selectors from all sources where the value has
		// changed or, if nothing has changed, return the default
		return ( ( keepNative ? [ keepNative ] : [] )
			.concat( newDefault ? [ newDefault ] : [] )
			.concat( oldDefault ? [ oldDefault ] : [] )
			.join( ", " ) );
	}
});
})( jQuery );

(function( $, undefined ) {

$.mobile.degradeInputs = {
	color: false,
	date: false,
	datetime: false,
	"datetime-local": false,
	email: false,
	month: false,
	number: false,
	range: "number",
	search: "text",
	tel: false,
	time: false,
	url: false,
	week: false
};
// Backcompat remove in 1.5
$.mobile.page.prototype.options.degradeInputs = $.mobile.degradeInputs;

// Auto self-init widgets
$.mobile.degradeInputsWithin = function( target ) {

	target = $( target );

	// Degrade inputs to avoid poorly implemented native functionality
	target.find( "input" ).not( $.mobile.page.prototype.keepNativeSelector() ).each(function() {
		var element = $( this ),
			type = this.getAttribute( "type" ),
			optType = $.mobile.degradeInputs[ type ] || "text",
			html, hasType, findstr, repstr;

		if ( $.mobile.degradeInputs[ type ] ) {
			html = $( "<div>" ).html( element.clone() ).html();
			// In IE browsers, the type sometimes doesn't exist in the cloned markup, so we replace the closing tag instead
			hasType = html.indexOf( " type=" ) > -1;
			findstr = hasType ? /\s+type=["']?\w+['"]?/ : /\/?>/;
			repstr = " type=\"" + optType + "\" data-" + $.mobile.ns + "type=\"" + type + "\"" + ( hasType ? "" : ">" );

			element.replaceWith( html.replace( findstr, repstr ) );
		}
	});

};

})( jQuery );


(function( $, undefined ) {

// Deprecated in 1.4
$.fn.fieldcontain = function(/* options */) {
	return this.addClass( "ui-field-contain" );
};

})( jQuery );

(function( $, undefined ) {

$.fn.grid = function( options ) {
	return this.each(function() {

		var $this = $( this ),
			o = $.extend({
				grid: null
			}, options ),
			$kids = $this.children(),
			gridCols = { solo:1, a:2, b:3, c:4, d:5 },
			grid = o.grid,
			iterator,
			letter;

			if ( !grid ) {
				if ( $kids.length <= 5 ) {
					for ( letter in gridCols ) {
						if ( gridCols[ letter ] === $kids.length ) {
							grid = letter;
						}
					}
				} else {
					grid = "a";
					$this.addClass( "ui-grid-duo" );
				}
			}
			iterator = gridCols[grid];

		$this.addClass( "ui-grid-" + grid );

		$kids.filter( ":nth-child(" + iterator + "n+1)" ).addClass( "ui-block-a" );

		if ( iterator > 1 ) {
			$kids.filter( ":nth-child(" + iterator + "n+2)" ).addClass( "ui-block-b" );
		}
		if ( iterator > 2 ) {
			$kids.filter( ":nth-child(" + iterator + "n+3)" ).addClass( "ui-block-c" );
		}
		if ( iterator > 3 ) {
			$kids.filter( ":nth-child(" + iterator + "n+4)" ).addClass( "ui-block-d" );
		}
		if ( iterator > 4 ) {
			$kids.filter( ":nth-child(" + iterator + "n+5)" ).addClass( "ui-block-e" );
		}
	});
};
})( jQuery );


(function( $, undefined ) {
		var path, $base, dialogHashKey = "&ui-state=dialog";

		$.mobile.path = path = {
			uiStateKey: "&ui-state",

			// This scary looking regular expression parses an absolute URL or its relative
			// variants (protocol, site, document, query, and hash), into the various
			// components (protocol, host, path, query, fragment, etc that make up the
			// URL as well as some other commonly used sub-parts. When used with RegExp.exec()
			// or String.match, it parses the URL into a results array that looks like this:
			//
			//     [0]: http://jblas:password@mycompany.com:8080/mail/inbox?msg=1234&type=unread#msg-content
			//     [1]: http://jblas:password@mycompany.com:8080/mail/inbox?msg=1234&type=unread
			//     [2]: http://jblas:password@mycompany.com:8080/mail/inbox
			//     [3]: http://jblas:password@mycompany.com:8080
			//     [4]: http:
			//     [5]: //
			//     [6]: jblas:password@mycompany.com:8080
			//     [7]: jblas:password
			//     [8]: jblas
			//     [9]: password
			//    [10]: mycompany.com:8080
			//    [11]: mycompany.com
			//    [12]: 8080
			//    [13]: /mail/inbox
			//    [14]: /mail/
			//    [15]: inbox
			//    [16]: ?msg=1234&type=unread
			//    [17]: #msg-content
			//
			urlParseRE: /^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,

			// Abstraction to address xss (Issue #4787) by removing the authority in
			// browsers that auto-decode it. All references to location.href should be
			// replaced with a call to this method so that it can be dealt with properly here
			getLocation: function( url ) {
				var parsedUrl = this.parseUrl( url || location.href ),
					uri = url ? parsedUrl : location,

					// Make sure to parse the url or the location object for the hash because using
					// location.hash is autodecoded in firefox, the rest of the url should be from
					// the object (location unless we're testing) to avoid the inclusion of the
					// authority
					hash = parsedUrl.hash;

				// mimic the browser with an empty string when the hash is empty
				hash = hash === "#" ? "" : hash;

				return uri.protocol +
					parsedUrl.doubleSlash +
					uri.host +

					// The pathname must start with a slash if there's a protocol, because you
					// can't have a protocol followed by a relative path. Also, it's impossible to
					// calculate absolute URLs from relative ones if the absolute one doesn't have
					// a leading "/".
					( ( uri.protocol !== "" && uri.pathname.substring( 0, 1 ) !== "/" ) ?
						"/" : "" ) +
					uri.pathname +
					uri.search +
					hash;
			},

			//return the original document url
			getDocumentUrl: function( asParsedObject ) {
				return asParsedObject ? $.extend( {}, path.documentUrl ) : path.documentUrl.href;
			},

			parseLocation: function() {
				return this.parseUrl( this.getLocation() );
			},

			//Parse a URL into a structure that allows easy access to
			//all of the URL components by name.
			parseUrl: function( url ) {
				// If we're passed an object, we'll assume that it is
				// a parsed url object and just return it back to the caller.
				if ( $.type( url ) === "object" ) {
					return url;
				}

				var matches = path.urlParseRE.exec( url || "" ) || [];

					// Create an object that allows the caller to access the sub-matches
					// by name. Note that IE returns an empty string instead of undefined,
					// like all other browsers do, so we normalize everything so its consistent
					// no matter what browser we're running on.
					return {
						href:         matches[  0 ] || "",
						hrefNoHash:   matches[  1 ] || "",
						hrefNoSearch: matches[  2 ] || "",
						domain:       matches[  3 ] || "",
						protocol:     matches[  4 ] || "",
						doubleSlash:  matches[  5 ] || "",
						authority:    matches[  6 ] || "",
						username:     matches[  8 ] || "",
						password:     matches[  9 ] || "",
						host:         matches[ 10 ] || "",
						hostname:     matches[ 11 ] || "",
						port:         matches[ 12 ] || "",
						pathname:     matches[ 13 ] || "",
						directory:    matches[ 14 ] || "",
						filename:     matches[ 15 ] || "",
						search:       matches[ 16 ] || "",
						hash:         matches[ 17 ] || ""
					};
			},

			//Turn relPath into an asbolute path. absPath is
			//an optional absolute path which describes what
			//relPath is relative to.
			makePathAbsolute: function( relPath, absPath ) {
				var absStack,
					relStack,
					i, d;

				if ( relPath && relPath.charAt( 0 ) === "/" ) {
					return relPath;
				}

				relPath = relPath || "";
				absPath = absPath ? absPath.replace( /^\/|(\/[^\/]*|[^\/]+)$/g, "" ) : "";

				absStack = absPath ? absPath.split( "/" ) : [];
				relStack = relPath.split( "/" );

				for ( i = 0; i < relStack.length; i++ ) {
					d = relStack[ i ];
					switch ( d ) {
						case ".":
							break;
						case "..":
							if ( absStack.length ) {
								absStack.pop();
							}
							break;
						default:
							absStack.push( d );
							break;
					}
				}
				return "/" + absStack.join( "/" );
			},

			//Returns true if both urls have the same domain.
			isSameDomain: function( absUrl1, absUrl2 ) {
				return path.parseUrl( absUrl1 ).domain.toLowerCase() ===
					path.parseUrl( absUrl2 ).domain.toLowerCase();
			},

			//Returns true for any relative variant.
			isRelativeUrl: function( url ) {
				// All relative Url variants have one thing in common, no protocol.
				return path.parseUrl( url ).protocol === "";
			},

			//Returns true for an absolute url.
			isAbsoluteUrl: function( url ) {
				return path.parseUrl( url ).protocol !== "";
			},

			//Turn the specified realtive URL into an absolute one. This function
			//can handle all relative variants (protocol, site, document, query, fragment).
			makeUrlAbsolute: function( relUrl, absUrl ) {
				if ( !path.isRelativeUrl( relUrl ) ) {
					return relUrl;
				}

				if ( absUrl === undefined ) {
					absUrl = this.documentBase;
				}

				var relObj = path.parseUrl( relUrl ),
					absObj = path.parseUrl( absUrl ),
					protocol = relObj.protocol || absObj.protocol,
					doubleSlash = relObj.protocol ? relObj.doubleSlash : ( relObj.doubleSlash || absObj.doubleSlash ),
					authority = relObj.authority || absObj.authority,
					hasPath = relObj.pathname !== "",
					pathname = path.makePathAbsolute( relObj.pathname || absObj.filename, absObj.pathname ),
					search = relObj.search || ( !hasPath && absObj.search ) || "",
					hash = relObj.hash;

				return protocol + doubleSlash + authority + pathname + search + hash;
			},

			//Add search (aka query) params to the specified url.
			addSearchParams: function( url, params ) {
				var u = path.parseUrl( url ),
					p = ( typeof params === "object" ) ? $.param( params ) : params,
					s = u.search || "?";
				return u.hrefNoSearch + s + ( s.charAt( s.length - 1 ) !== "?" ? "&" : "" ) + p + ( u.hash || "" );
			},

			convertUrlToDataUrl: function( absUrl ) {
				var result = absUrl,
					u = path.parseUrl( absUrl );

				if ( path.isEmbeddedPage( u ) ) {
					// For embedded pages, remove the dialog hash key as in getFilePath(),
					// and remove otherwise the Data Url won't match the id of the embedded Page.
					result = u.hash
						.split( dialogHashKey )[0]
						.replace( /^#/, "" )
						.replace( /\?.*$/, "" );
				} else if ( path.isSameDomain( u, this.documentBase ) ) {
					result = u.hrefNoHash.replace( this.documentBase.domain, "" ).split( dialogHashKey )[0];
				}

				return window.decodeURIComponent( result );
			},

			//get path from current hash, or from a file path
			get: function( newPath ) {
				if ( newPath === undefined ) {
					newPath = path.parseLocation().hash;
				}
				return path.stripHash( newPath ).replace( /[^\/]*\.[^\/*]+$/, "" );
			},

			//set location hash to path
			set: function( path ) {
				location.hash = path;
			},

			//test if a given url (string) is a path
			//NOTE might be exceptionally naive
			isPath: function( url ) {
				return ( /\// ).test( url );
			},

			//return a url path with the window's location protocol/hostname/pathname removed
			clean: function( url ) {
				return url.replace( this.documentBase.domain, "" );
			},

			//just return the url without an initial #
			stripHash: function( url ) {
				return url.replace( /^#/, "" );
			},

			stripQueryParams: function( url ) {
				return url.replace( /\?.*$/, "" );
			},

			//remove the preceding hash, any query params, and dialog notations
			cleanHash: function( hash ) {
				return path.stripHash( hash.replace( /\?.*$/, "" ).replace( dialogHashKey, "" ) );
			},

			isHashValid: function( hash ) {
				return ( /^#[^#]+$/ ).test( hash );
			},

			//check whether a url is referencing the same domain, or an external domain or different protocol
			//could be mailto, etc
			isExternal: function( url ) {
				var u = path.parseUrl( url );

				return !!( u.protocol &&
					( u.domain.toLowerCase() !== this.documentUrl.domain.toLowerCase() ) );
			},

			hasProtocol: function( url ) {
				return ( /^(:?\w+:)/ ).test( url );
			},

			isEmbeddedPage: function( url ) {
				var u = path.parseUrl( url );

				//if the path is absolute, then we need to compare the url against
				//both the this.documentUrl and the documentBase. The main reason for this
				//is that links embedded within external documents will refer to the
				//application document, whereas links embedded within the application
				//document will be resolved against the document base.
				if ( u.protocol !== "" ) {
					return ( !this.isPath(u.hash) && u.hash && ( u.hrefNoHash === this.documentUrl.hrefNoHash || ( this.documentBaseDiffers && u.hrefNoHash === this.documentBase.hrefNoHash ) ) );
				}
				return ( /^#/ ).test( u.href );
			},

			squash: function( url, resolutionUrl ) {
				var href, cleanedUrl, search, stateIndex, docUrl,
					isPath = this.isPath( url ),
					uri = this.parseUrl( url ),
					preservedHash = uri.hash,
					uiState = "";

				// produce a url against which we can resolve the provided path
				if ( !resolutionUrl ) {
					if ( isPath ) {
						resolutionUrl = path.getLocation();
					} else {
						docUrl = path.getDocumentUrl( true );
						if ( path.isPath( docUrl.hash ) ) {
							resolutionUrl = path.squash( docUrl.href );
						} else {
							resolutionUrl = docUrl.href;
						}
					}
				}

				// If the url is anything but a simple string, remove any preceding hash
				// eg #foo/bar -> foo/bar
				//    #foo -> #foo
				cleanedUrl = isPath ? path.stripHash( url ) : url;

				// If the url is a full url with a hash check if the parsed hash is a path
				// if it is, strip the #, and use it otherwise continue without change
				cleanedUrl = path.isPath( uri.hash ) ? path.stripHash( uri.hash ) : cleanedUrl;

				// Split the UI State keys off the href
				stateIndex = cleanedUrl.indexOf( this.uiStateKey );

				// store the ui state keys for use
				if ( stateIndex > -1 ) {
					uiState = cleanedUrl.slice( stateIndex );
					cleanedUrl = cleanedUrl.slice( 0, stateIndex );
				}

				// make the cleanedUrl absolute relative to the resolution url
				href = path.makeUrlAbsolute( cleanedUrl, resolutionUrl );

				// grab the search from the resolved url since parsing from
				// the passed url may not yield the correct result
				search = this.parseUrl( href ).search;

				// TODO all this crap is terrible, clean it up
				if ( isPath ) {
					// reject the hash if it's a path or it's just a dialog key
					if ( path.isPath( preservedHash ) || preservedHash.replace("#", "").indexOf( this.uiStateKey ) === 0) {
						preservedHash = "";
					}

					// Append the UI State keys where it exists and it's been removed
					// from the url
					if ( uiState && preservedHash.indexOf( this.uiStateKey ) === -1) {
						preservedHash += uiState;
					}

					// make sure that pound is on the front of the hash
					if ( preservedHash.indexOf( "#" ) === -1 && preservedHash !== "" ) {
						preservedHash = "#" + preservedHash;
					}

					// reconstruct each of the pieces with the new search string and hash
					href = path.parseUrl( href );
					href = href.protocol + href.doubleSlash + href.host + href.pathname + search +
						preservedHash;
				} else {
					href += href.indexOf( "#" ) > -1 ? uiState : "#" + uiState;
				}

				return href;
			},

			isPreservableHash: function( hash ) {
				return hash.replace( "#", "" ).indexOf( this.uiStateKey ) === 0;
			},

			// Escape weird characters in the hash if it is to be used as a selector
			hashToSelector: function( hash ) {
				var hasHash = ( hash.substring( 0, 1 ) === "#" );
				if ( hasHash ) {
					hash = hash.substring( 1 );
				}
				return ( hasHash ? "#" : "" ) + hash.replace( /([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g, "\\$1" );
			},

			// return the substring of a filepath before the dialogHashKey, for making a server
			// request
			getFilePath: function( path ) {
				return path && path.split( dialogHashKey )[0];
			},

			// check if the specified url refers to the first page in the main
			// application document.
			isFirstPageUrl: function( url ) {
				// We only deal with absolute paths.
				var u = path.parseUrl( path.makeUrlAbsolute( url, this.documentBase ) ),

					// Does the url have the same path as the document?
					samePath = u.hrefNoHash === this.documentUrl.hrefNoHash ||
						( this.documentBaseDiffers &&
							u.hrefNoHash === this.documentBase.hrefNoHash ),

					// Get the first page element.
					fp = $.mobile.firstPage,

					// Get the id of the first page element if it has one.
					fpId = fp && fp[0] ? fp[0].id : undefined;

				// The url refers to the first page if the path matches the document and
				// it either has no hash value, or the hash is exactly equal to the id
				// of the first page element.
				return samePath &&
					( !u.hash ||
						u.hash === "#" ||
						( fpId && u.hash.replace( /^#/, "" ) === fpId ) );
			},

			// Some embedded browsers, like the web view in Phone Gap, allow
			// cross-domain XHR requests if the document doing the request was loaded
			// via the file:// protocol. This is usually to allow the application to
			// "phone home" and fetch app specific data. We normally let the browser
			// handle external/cross-domain urls, but if the allowCrossDomainPages
			// option is true, we will allow cross-domain http/https requests to go
			// through our page loading logic.
			isPermittedCrossDomainRequest: function( docUrl, reqUrl ) {
				return $.mobile.allowCrossDomainPages &&
					(docUrl.protocol === "file:" || docUrl.protocol === "content:") &&
					reqUrl.search( /^https?:/ ) !== -1;
			}
		};

		path.documentUrl = path.parseLocation();

		$base = $( "head" ).find( "base" );

		path.documentBase = $base.length ?
			path.parseUrl( path.makeUrlAbsolute( $base.attr( "href" ), path.documentUrl.href ) ) :
			path.documentUrl;

		path.documentBaseDiffers = (path.documentUrl.hrefNoHash !== path.documentBase.hrefNoHash);

		//return the original document base url
		path.getDocumentBase = function( asParsedObject ) {
			return asParsedObject ? $.extend( {}, path.documentBase ) : path.documentBase.href;
		};

		// DEPRECATED as of 1.4.0 - remove in 1.5.0
		$.extend( $.mobile, {

			//return the original document url
			getDocumentUrl: path.getDocumentUrl,

			//return the original document base url
			getDocumentBase: path.getDocumentBase
		});
})( jQuery );



(function( $, undefined ) {
	$.mobile.History = function( stack, index ) {
		this.stack = stack || [];
		this.activeIndex = index || 0;
	};

	$.extend($.mobile.History.prototype, {
		getActive: function() {
			return this.stack[ this.activeIndex ];
		},

		getLast: function() {
			return this.stack[ this.previousIndex ];
		},

		getNext: function() {
			return this.stack[ this.activeIndex + 1 ];
		},

		getPrev: function() {
			return this.stack[ this.activeIndex - 1 ];
		},

		// addNew is used whenever a new page is added
		add: function( url, data ) {
			data = data || {};

			//if there's forward history, wipe it
			if ( this.getNext() ) {
				this.clearForward();
			}

			// if the hash is included in the data make sure the shape
			// is consistent for comparison
			if ( data.hash && data.hash.indexOf( "#" ) === -1) {
				data.hash = "#" + data.hash;
			}

			data.url = url;
			this.stack.push( data );
			this.activeIndex = this.stack.length - 1;
		},

		//wipe urls ahead of active index
		clearForward: function() {
			this.stack = this.stack.slice( 0, this.activeIndex + 1 );
		},

		find: function( url, stack, earlyReturn ) {
			stack = stack || this.stack;

			var entry, i, length = stack.length, index;

			for ( i = 0; i < length; i++ ) {
				entry = stack[i];

				if ( decodeURIComponent(url) === decodeURIComponent(entry.url) ||
					decodeURIComponent(url) === decodeURIComponent(entry.hash) ) {
					index = i;

					if ( earlyReturn ) {
						return index;
					}
				}
			}

			return index;
		},

		closest: function( url ) {
			var closest, a = this.activeIndex;

			// First, take the slice of the history stack before the current index and search
			// for a url match. If one is found, we'll avoid avoid looking through forward history
			// NOTE the preference for backward history movement is driven by the fact that
			//      most mobile browsers only have a dedicated back button, and users rarely use
			//      the forward button in desktop browser anyhow
			closest = this.find( url, this.stack.slice(0, a) );

			// If nothing was found in backward history check forward. The `true`
			// value passed as the third parameter causes the find method to break
			// on the first match in the forward history slice. The starting index
			// of the slice must then be added to the result to get the element index
			// in the original history stack :( :(
			//
			// TODO this is hyper confusing and should be cleaned up (ugh so bad)
			if ( closest === undefined ) {
				closest = this.find( url, this.stack.slice(a), true );
				closest = closest === undefined ? closest : closest + a;
			}

			return closest;
		},

		direct: function( opts ) {
			var newActiveIndex = this.closest( opts.url ), a = this.activeIndex;

			// save new page index, null check to prevent falsey 0 result
			// record the previous index for reference
			if ( newActiveIndex !== undefined ) {
				this.activeIndex = newActiveIndex;
				this.previousIndex = a;
			}

			// invoke callbacks where appropriate
			//
			// TODO this is also convoluted and confusing
			if ( newActiveIndex < a ) {
				( opts.present || opts.back || $.noop )( this.getActive(), "back" );
			} else if ( newActiveIndex > a ) {
				( opts.present || opts.forward || $.noop )( this.getActive(), "forward" );
			} else if ( newActiveIndex === undefined && opts.missing ) {
				opts.missing( this.getActive() );
			}
		}
	});
})( jQuery );



(function( $, undefined ) {
	var path = $.mobile.path,
		initialHref = location.href;

	$.mobile.Navigator = function( history ) {
		this.history = history;
		this.ignoreInitialHashChange = true;

		$.mobile.window.bind({
			"popstate.history": $.proxy( this.popstate, this ),
			"hashchange.history": $.proxy( this.hashchange, this )
		});
	};

	$.extend($.mobile.Navigator.prototype, {
		squash: function( url, data ) {
			var state, href, hash = path.isPath(url) ? path.stripHash(url) : url;

			href = path.squash( url );

			// make sure to provide this information when it isn't explicitly set in the
			// data object that was passed to the squash method
			state = $.extend({
				hash: hash,
				url: href
			}, data);

			// replace the current url with the new href and store the state
			// Note that in some cases we might be replacing an url with the
			// same url. We do this anyways because we need to make sure that
			// all of our history entries have a state object associated with
			// them. This allows us to work around the case where $.mobile.back()
			// is called to transition from an external page to an embedded page.
			// In that particular case, a hashchange event is *NOT* generated by the browser.
			// Ensuring each history entry has a state object means that onPopState()
			// will always trigger our hashchange callback even when a hashchange event
			// is not fired.
			window.history.replaceState( state, state.title || document.title, href );

			return state;
		},

		hash: function( url, href ) {
			var parsed, loc, hash, resolved;

			// Grab the hash for recording. If the passed url is a path
			// we used the parsed version of the squashed url to reconstruct,
			// otherwise we assume it's a hash and store it directly
			parsed = path.parseUrl( url );
			loc = path.parseLocation();

			if ( loc.pathname + loc.search === parsed.pathname + parsed.search ) {
				// If the pathname and search of the passed url is identical to the current loc
				// then we must use the hash. Otherwise there will be no event
				// eg, url = "/foo/bar?baz#bang", location.href = "http://example.com/foo/bar?baz"
				hash = parsed.hash ? parsed.hash : parsed.pathname + parsed.search;
			} else if ( path.isPath(url) ) {
				resolved = path.parseUrl( href );
				// If the passed url is a path, make it domain relative and remove any trailing hash
				hash = resolved.pathname + resolved.search + (path.isPreservableHash( resolved.hash )? resolved.hash.replace( "#", "" ) : "");
			} else {
				hash = url;
			}

			return hash;
		},

		// TODO reconsider name
		go: function( url, data, noEvents ) {
			var state, href, hash, popstateEvent,
				isPopStateEvent = $.event.special.navigate.isPushStateEnabled();

			// Get the url as it would look squashed on to the current resolution url
			href = path.squash( url );

			// sort out what the hash sould be from the url
			hash = this.hash( url, href );

			// Here we prevent the next hash change or popstate event from doing any
			// history management. In the case of hashchange we don't swallow it
			// if there will be no hashchange fired (since that won't reset the value)
			// and will swallow the following hashchange
			if ( noEvents && hash !== path.stripHash(path.parseLocation().hash) ) {
				this.preventNextHashChange = noEvents;
			}

			// IMPORTANT in the case where popstate is supported the event will be triggered
			//      directly, stopping further execution - ie, interupting the flow of this
			//      method call to fire bindings at this expression. Below the navigate method
			//      there is a binding to catch this event and stop its propagation.
			//
			//      We then trigger a new popstate event on the window with a null state
			//      so that the navigate events can conclude their work properly
			//
			// if the url is a path we want to preserve the query params that are available on
			// the current url.
			this.preventHashAssignPopState = true;
			window.location.hash = hash;

			// If popstate is enabled and the browser triggers `popstate` events when the hash
			// is set (this often happens immediately in browsers like Chrome), then the
			// this flag will be set to false already. If it's a browser that does not trigger
			// a `popstate` on hash assignement or `replaceState` then we need avoid the branch
			// that swallows the event created by the popstate generated by the hash assignment
			// At the time of this writing this happens with Opera 12 and some version of IE
			this.preventHashAssignPopState = false;

			state = $.extend({
				url: href,
				hash: hash,
				title: document.title
			}, data);

			if ( isPopStateEvent ) {
				popstateEvent = new $.Event( "popstate" );
				popstateEvent.originalEvent = {
					type: "popstate",
					state: null
				};

				this.squash( url, state );

				// Trigger a new faux popstate event to replace the one that we
				// caught that was triggered by the hash setting above.
				if ( !noEvents ) {
					this.ignorePopState = true;
					$.mobile.window.trigger( popstateEvent );
				}
			}

			// record the history entry so that the information can be included
			// in hashchange event driven navigate events in a similar fashion to
			// the state that's provided by popstate
			this.history.add( state.url, state );
		},

		// This binding is intended to catch the popstate events that are fired
		// when execution of the `$.navigate` method stops at window.location.hash = url;
		// and completely prevent them from propagating. The popstate event will then be
		// retriggered after execution resumes
		//
		// TODO grab the original event here and use it for the synthetic event in the
		//      second half of the navigate execution that will follow this binding
		popstate: function( event ) {
			var hash, state;

			// Partly to support our test suite which manually alters the support
			// value to test hashchange. Partly to prevent all around weirdness
			if ( !$.event.special.navigate.isPushStateEnabled() ) {
				return;
			}

			// If this is the popstate triggered by the actual alteration of the hash
			// prevent it completely. History is tracked manually
			if ( this.preventHashAssignPopState ) {
				this.preventHashAssignPopState = false;
				event.stopImmediatePropagation();
				return;
			}

			// if this is the popstate triggered after the `replaceState` call in the go
			// method, then simply ignore it. The history entry has already been captured
			if ( this.ignorePopState ) {
				this.ignorePopState = false;
				return;
			}

			// If there is no state, and the history stack length is one were
			// probably getting the page load popstate fired by browsers like chrome
			// avoid it and set the one time flag to false.
			// TODO: Do we really need all these conditions? Comparing location hrefs
			// should be sufficient.
			if ( !event.originalEvent.state &&
				this.history.stack.length === 1 &&
				this.ignoreInitialHashChange ) {
				this.ignoreInitialHashChange = false;

				if ( location.href === initialHref ) {
					event.preventDefault();
					return;
				}
			}

			// account for direct manipulation of the hash. That is, we will receive a popstate
			// when the hash is changed by assignment, and it won't have a state associated. We
			// then need to squash the hash. See below for handling of hash assignment that
			// matches an existing history entry
			// TODO it might be better to only add to the history stack
			//      when the hash is adjacent to the active history entry
			hash = path.parseLocation().hash;
			if ( !event.originalEvent.state && hash ) {
				// squash the hash that's been assigned on the URL with replaceState
				// also grab the resulting state object for storage
				state = this.squash( hash );

				// record the new hash as an additional history entry
				// to match the browser's treatment of hash assignment
				this.history.add( state.url, state );

				// pass the newly created state information
				// along with the event
				event.historyState = state;

				// do not alter history, we've added a new history entry
				// so we know where we are
				return;
			}

			// If all else fails this is a popstate that comes from the back or forward buttons
			// make sure to set the state of our history stack properly, and record the directionality
			this.history.direct({
				url: (event.originalEvent.state || {}).url || hash,

				// When the url is either forward or backward in history include the entry
				// as data on the event object for merging as data in the navigate event
				present: function( historyEntry, direction ) {
					// make sure to create a new object to pass down as the navigate event data
					event.historyState = $.extend({}, historyEntry);
					event.historyState.direction = direction;
				}
			});
		},

		// NOTE must bind before `navigate` special event hashchange binding otherwise the
		//      navigation data won't be attached to the hashchange event in time for those
		//      bindings to attach it to the `navigate` special event
		// TODO add a check here that `hashchange.navigate` is bound already otherwise it's
		//      broken (exception?)
		hashchange: function( event ) {
			var history, hash;

			// If hashchange listening is explicitly disabled or pushstate is supported
			// avoid making use of the hashchange handler.
			if (!$.event.special.navigate.isHashChangeEnabled() ||
				$.event.special.navigate.isPushStateEnabled() ) {
				return;
			}

			// On occasion explicitly want to prevent the next hash from propogating because we only
			// with to alter the url to represent the new state do so here
			if ( this.preventNextHashChange ) {
				this.preventNextHashChange = false;
				event.stopImmediatePropagation();
				return;
			}

			history = this.history;
			hash = path.parseLocation().hash;

			// If this is a hashchange caused by the back or forward button
			// make sure to set the state of our history stack properly
			this.history.direct({
				url: hash,

				// When the url is either forward or backward in history include the entry
				// as data on the event object for merging as data in the navigate event
				present: function( historyEntry, direction ) {
					// make sure to create a new object to pass down as the navigate event data
					event.hashchangeState = $.extend({}, historyEntry);
					event.hashchangeState.direction = direction;
				},

				// When we don't find a hash in our history clearly we're aiming to go there
				// record the entry as new for future traversal
				//
				// NOTE it's not entirely clear that this is the right thing to do given that we
				//      can't know the users intention. It might be better to explicitly _not_
				//      support location.hash assignment in preference to $.navigate calls
				// TODO first arg to add should be the href, but it causes issues in identifying
				//      embeded pages
				missing: function() {
					history.add( hash, {
						hash: hash,
						title: document.title
					});
				}
			});
		}
	});
})( jQuery );



(function( $, undefined ) {
	// TODO consider queueing navigation activity until previous activities have completed
	//      so that end users don't have to think about it. Punting for now
	// TODO !! move the event bindings into callbacks on the navigate event
	$.mobile.navigate = function( url, data, noEvents ) {
		$.mobile.navigate.navigator.go( url, data, noEvents );
	};

	// expose the history on the navigate method in anticipation of full integration with
	// existing navigation functionalty that is tightly coupled to the history information
	$.mobile.navigate.history = new $.mobile.History();

	// instantiate an instance of the navigator for use within the $.navigate method
	$.mobile.navigate.navigator = new $.mobile.Navigator( $.mobile.navigate.history );

	var loc = $.mobile.path.parseLocation();
	$.mobile.navigate.history.add( loc.href, {hash: loc.hash} );
})( jQuery );



(function( $, undefined ) {

	// existing base tag?
	var baseElement = $( "head" ).children( "base" ),

	// base element management, defined depending on dynamic base tag support
	// TODO move to external widget
	base = {

		// define base element, for use in routing asset urls that are referenced
		// in Ajax-requested markup
		element: ( baseElement.length ? baseElement :
			$( "<base>", { href: $.mobile.path.documentBase.hrefNoHash } ).prependTo( $( "head" ) ) ),

		linkSelector: "[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",

		// set the generated BASE element's href to a new page's base path
		set: function( href ) {

			// we should do nothing if the user wants to manage their url base
			// manually
			if ( !$.mobile.dynamicBaseEnabled ) {
				return;
			}

			// we should use the base tag if we can manipulate it dynamically
			if ( $.support.dynamicBaseTag ) {
				base.element.attr( "href",
					$.mobile.path.makeUrlAbsolute( href, $.mobile.path.documentBase ) );
			}
		},

		rewrite: function( href, page ) {
			var newPath = $.mobile.path.get( href );

			page.find( base.linkSelector ).each(function( i, link ) {
				var thisAttr = $( link ).is( "[href]" ) ? "href" :
					$( link ).is( "[src]" ) ? "src" : "action",
				theLocation = $.mobile.path.parseLocation(),
				thisUrl = $( link ).attr( thisAttr );

				// XXX_jblas: We need to fix this so that it removes the document
				//            base URL, and then prepends with the new page URL.
				// if full path exists and is same, chop it - helps IE out
				thisUrl = thisUrl.replace( theLocation.protocol + theLocation.doubleSlash +
					theLocation.host + theLocation.pathname, "" );

				if ( !/^(\w+:|#|\/)/.test( thisUrl ) ) {
					$( link ).attr( thisAttr, newPath + thisUrl );
				}
			});
		},

		// set the generated BASE element's href to a new page's base path
		reset: function(/* href */) {
			base.element.attr( "href", $.mobile.path.documentBase.hrefNoSearch );
		}
	};

	$.mobile.base = base;

})( jQuery );



(function( $, window, undefined ) {

	// TODO remove direct references to $.mobile and properties, we should
	//      favor injection with params to the constructor
	$.mobile.Transition = function() {
		this.init.apply( this, arguments );
	};

	$.extend($.mobile.Transition.prototype, {
		toPreClass: " ui-page-pre-in",

		init: function( name, reverse, $to, $from ) {
			$.extend(this, {
				name: name,
				reverse: reverse,
				$to: $to,
				$from: $from,
				deferred: new $.Deferred()
			});
		},

		cleanFrom: function() {
			this.$from
				.removeClass( $.mobile.activePageClass + " out in reverse " + this.name )
				.height( "" );
		},

		// NOTE overridden by child object prototypes, noop'd here as defaults
		beforeDoneIn: function() {},
		beforeDoneOut: function() {},
		beforeStartOut: function() {},

		doneIn: function() {
			this.beforeDoneIn();

			this.$to.removeClass( "out in reverse " + this.name ).height( "" );

			this.toggleViewportClass();

			// In some browsers (iOS5), 3D transitions block the ability to scroll to the desired location during transition
			// This ensures we jump to that spot after the fact, if we aren't there already.
			if ( $.mobile.window.scrollTop() !== this.toScroll ) {
				this.scrollPage();
			}
			if ( !this.sequential ) {
				this.$to.addClass( $.mobile.activePageClass );
			}
			this.deferred.resolve( this.name, this.reverse, this.$to, this.$from, true );
		},

		doneOut: function( screenHeight, reverseClass, none, preventFocus ) {
			this.beforeDoneOut();
			this.startIn( screenHeight, reverseClass, none, preventFocus );
		},

		hideIn: function( callback ) {
			// Prevent flickering in phonegap container: see comments at #4024 regarding iOS
			this.$to.css( "z-index", -10 );
			callback.call( this );
			this.$to.css( "z-index", "" );
		},

		scrollPage: function() {
			// By using scrollTo instead of silentScroll, we can keep things better in order
			// Just to be precautios, disable scrollstart listening like silentScroll would
			$.event.special.scrollstart.enabled = false;
			//if we are hiding the url bar or the page was previously scrolled scroll to hide or return to position
			if ( $.mobile.hideUrlBar || this.toScroll !== $.mobile.defaultHomeScroll ) {
				window.scrollTo( 0, this.toScroll );
			}

			// reenable scrollstart listening like silentScroll would
			setTimeout( function() {
				$.event.special.scrollstart.enabled = true;
			}, 150 );
		},

		startIn: function( screenHeight, reverseClass, none, preventFocus ) {
			this.hideIn(function() {
				this.$to.addClass( $.mobile.activePageClass + this.toPreClass );

				// Send focus to page as it is now display: block
				if ( !preventFocus ) {
					$.mobile.focusPage( this.$to );
				}

				// Set to page height
				this.$to.height( screenHeight + this.toScroll );

                if ( !none ) {
                    this.scrollPage();
                }
			});

			this.$to
				.removeClass( this.toPreClass )
				.addClass( this.name + " in " + reverseClass );

			if ( !none ) {
				this.$to.animationComplete( $.proxy(function() {
					this.doneIn();
				}, this ));
			} else {
				this.doneIn();
			}

		},

		startOut: function( screenHeight, reverseClass, none ) {
			this.beforeStartOut( screenHeight, reverseClass, none );

			// Set the from page's height and start it transitioning out
			// Note: setting an explicit height helps eliminate tiling in the transitions
			this.$from
				.height( screenHeight + $.mobile.window.scrollTop() )
				.addClass( this.name + " out" + reverseClass );
		},

		toggleViewportClass: function() {
			$.mobile.pageContainer.toggleClass( "ui-mobile-viewport-transitioning viewport-" + this.name );
		},

		transition: function() {
			// NOTE many of these could be calculated/recorded in the constructor, it's my
			//      opinion that binding them as late as possible has value with regards to
			//      better transitions with fewer bugs. Ie, it's not guaranteed that the
			//      object will be created and transition will be run immediately after as
			//      it is today. So we wait until transition is invoked to gather the following
			var none,
				reverseClass = this.reverse ? " reverse" : "",
				screenHeight = $.mobile.getScreenHeight(),
				maxTransitionOverride = $.mobile.maxTransitionWidth !== false &&
					$.mobile.window.width() > $.mobile.maxTransitionWidth;

			this.toScroll = $.mobile.navigate.history.getActive().lastScroll || $.mobile.defaultHomeScroll;

			none = !$.support.cssTransitions || !$.support.cssAnimations ||
				maxTransitionOverride || !this.name || this.name === "none" ||
				Math.max( $.mobile.window.scrollTop(), this.toScroll ) >
					$.mobile.getMaxScrollForTransition();

			this.toggleViewportClass();

			if ( this.$from && !none ) {
				this.startOut( screenHeight, reverseClass, none );
			} else {
				this.doneOut( screenHeight, reverseClass, none, true );
			}

			return this.deferred.promise();
		}
	});
})( jQuery, this );


(function( $ ) {

	$.mobile.SerialTransition = function() {
		this.init.apply(this, arguments);
	};

	$.extend($.mobile.SerialTransition.prototype, $.mobile.Transition.prototype, {
		sequential: true,

		beforeDoneOut: function() {
			if ( this.$from ) {
				this.cleanFrom();
			}
		},

		beforeStartOut: function( screenHeight, reverseClass, none ) {
			this.$from.animationComplete($.proxy(function() {
				this.doneOut( screenHeight, reverseClass, none );
			}, this ));
		}
	});

})( jQuery );


(function( $ ) {

	$.mobile.ConcurrentTransition = function() {
		this.init.apply(this, arguments);
	};

	$.extend($.mobile.ConcurrentTransition.prototype, $.mobile.Transition.prototype, {
		sequential: false,

		beforeDoneIn: function() {
			if ( this.$from ) {
				this.cleanFrom();
			}
		},

		beforeStartOut: function( screenHeight, reverseClass, none ) {
			this.doneOut( screenHeight, reverseClass, none );
		}
	});

})( jQuery );


(function( $ ) {

	// generate the handlers from the above
	var defaultGetMaxScrollForTransition = function() {
		return $.mobile.getScreenHeight() * 3;
	};

	//transition handler dictionary for 3rd party transitions
	$.mobile.transitionHandlers = {
		"sequential": $.mobile.SerialTransition,
		"simultaneous": $.mobile.ConcurrentTransition
	};

	// Make our transition handler the public default.
	$.mobile.defaultTransitionHandler = $.mobile.transitionHandlers.sequential;

	$.mobile.transitionFallbacks = {};

	// If transition is defined, check if css 3D transforms are supported, and if not, if a fallback is specified
	$.mobile._maybeDegradeTransition = function( transition ) {
		if ( transition && !$.support.cssTransform3d && $.mobile.transitionFallbacks[ transition ] ) {
			transition = $.mobile.transitionFallbacks[ transition ];
		}

		return transition;
	};

	// Set the getMaxScrollForTransition to default if no implementation was set by user
	$.mobile.getMaxScrollForTransition = $.mobile.getMaxScrollForTransition || defaultGetMaxScrollForTransition;

})( jQuery );

(function( $, undefined ) {

	$.widget( "mobile.pagecontainer", {
		options: {
			theme: "a"
		},

		initSelector: false,

		_create: function() {
			this._trigger( "beforecreate" );
			this.setLastScrollEnabled = true;

			this._on( this.window, {
				// disable an scroll setting when a hashchange has been fired,
				// this only works because the recording of the scroll position
				// is delayed for 100ms after the browser might have changed the
				// position because of the hashchange
				navigate: "_disableRecordScroll",

				// bind to scrollstop for the first page, "pagechange" won't be
				// fired in that case
				scrollstop: "_delayedRecordScroll"
			});

			// TODO consider moving the navigation handler OUT of widget into
			//      some other object as glue between the navigate event and the
			//      content widget load and change methods
			this._on( this.window, { navigate: "_filterNavigateEvents" });

			// TODO move from page* events to content* events
			this._on({ pagechange: "_afterContentChange" });

			// handle initial hashchange from chrome :(
			this.window.one( "navigate", $.proxy(function() {
				this.setLastScrollEnabled = true;
			}, this));
		},

		_setOptions: function( options ) {
			if ( options.theme !== undefined && options.theme !== "none" ) {
				this.element.removeClass( "ui-overlay-" + this.options.theme )
					.addClass( "ui-overlay-" + options.theme );
			} else if ( options.theme !== undefined ) {
				this.element.removeClass( "ui-overlay-" + this.options.theme );
			}

			this._super( options );
		},

		_disableRecordScroll: function() {
			this.setLastScrollEnabled = false;
		},

		_enableRecordScroll: function() {
			this.setLastScrollEnabled = true;
		},

		// TODO consider the name here, since it's purpose specific
		_afterContentChange: function() {
			// once the page has changed, re-enable the scroll recording
			this.setLastScrollEnabled = true;

			// remove any binding that previously existed on the get scroll
			// which may or may not be different than the scroll element
			// determined for this page previously
			this._off( this.window, "scrollstop" );

			// determine and bind to the current scoll element which may be the
			// window or in the case of touch overflow the element touch overflow
			this._on( this.window, { scrollstop: "_delayedRecordScroll" });
		},

		_recordScroll: function() {
			// this barrier prevents setting the scroll value based on
			// the browser scrolling the window based on a hashchange
			if ( !this.setLastScrollEnabled ) {
				return;
			}

			var active = this._getActiveHistory(),
				currentScroll, minScroll, defaultScroll;

			if ( active ) {
				currentScroll = this._getScroll();
				minScroll = this._getMinScroll();
				defaultScroll = this._getDefaultScroll();

				// Set active page's lastScroll prop. If the location we're
				// scrolling to is less than minScrollBack, let it go.
				active.lastScroll = currentScroll < minScroll ? defaultScroll : currentScroll;
			}
		},

		_delayedRecordScroll: function() {
			setTimeout( $.proxy(this, "_recordScroll"), 100 );
		},

		_getScroll: function() {
			return this.window.scrollTop();
		},

		_getMinScroll: function() {
			return $.mobile.minScrollBack;
		},

		_getDefaultScroll: function() {
			return $.mobile.defaultHomeScroll;
		},

		_filterNavigateEvents: function( e, data ) {
			var url;

			if ( e.originalEvent && e.originalEvent.isDefaultPrevented() ) {
				return;
			}

			url = e.originalEvent.type.indexOf( "hashchange" ) > -1 ? data.state.hash : data.state.url;

			if ( !url ) {
				url = this._getHash();
			}

			if ( !url || url === "#" || url.indexOf( "#" + $.mobile.path.uiStateKey ) === 0 ) {
				url = location.href;
			}

			this._handleNavigate( url, data.state );
		},

		_getHash: function() {
			return $.mobile.path.parseLocation().hash;
		},

		// TODO active page should be managed by the container (ie, it should be a property)
		getActivePage: function() {
			return this.activePage;
		},

		// TODO the first page should be a property set during _create using the logic
		//      that currently resides in init
		_getInitialContent: function() {
			return $.mobile.firstPage;
		},

		// TODO each content container should have a history object
		_getHistory: function() {
			return $.mobile.navigate.history;
		},

		_getActiveHistory: function() {
			return this._getHistory().getActive();
		},

		// TODO the document base should be determined at creation
		_getDocumentBase: function() {
			return $.mobile.path.documentBase;
		},

		back: function() {
			this.go( -1 );
		},

		forward: function() {
			this.go( 1 );
		},

		go: function( steps ) {

			//if hashlistening is enabled use native history method
			if ( $.mobile.hashListeningEnabled ) {
				window.history.go( steps );
			} else {

				//we are not listening to the hash so handle history internally
				var activeIndex = $.mobile.navigate.history.activeIndex,
					index = activeIndex + parseInt( steps, 10 ),
					url = $.mobile.navigate.history.stack[ index ].url,
					direction = ( steps >= 1 )? "forward" : "back";

				//update the history object
				$.mobile.navigate.history.activeIndex = index;
				$.mobile.navigate.history.previousIndex = activeIndex;

				//change to the new page
				this.change( url, { direction: direction, changeHash: false, fromHashChange: true } );
			}
		},

		// TODO rename _handleDestination
		_handleDestination: function( to ) {
			var history;

			// clean the hash for comparison if it's a url
			if ( $.type(to) === "string" ) {
				to = $.mobile.path.stripHash( to );
			}

			if ( to ) {
				history = this._getHistory();

				// At this point, 'to' can be one of 3 things, a cached page
				// element from a history stack entry, an id, or site-relative /
				// absolute URL. If 'to' is an id, we need to resolve it against
				// the documentBase, not the location.href, since the hashchange
				// could've been the result of a forward/backward navigation
				// that crosses from an external page/dialog to an internal
				// page/dialog.
				//
				// TODO move check to history object or path object?
				to = !$.mobile.path.isPath( to ) ? ( $.mobile.path.makeUrlAbsolute( "#" + to, this._getDocumentBase() ) ) : to;
			}
			return to || this._getInitialContent();
		},

		_transitionFromHistory: function( direction, defaultTransition ) {
			var history = this._getHistory(),
				entry = ( direction === "back" ? history.getLast() : history.getActive() );

			return ( entry && entry.transition ) || defaultTransition;
		},

		_handleDialog: function( changePageOptions, data ) {
			var to, active, activeContent = this.getActivePage();

			// If current active page is not a dialog skip the dialog and continue
			// in the same direction
			// Note: The dialog widget is deprecated as of 1.4.0 and will be removed in 1.5.0.
			// Thus, as of 1.5.0 activeContent.data( "mobile-dialog" ) will always evaluate to
			// falsy, so the second condition in the if-statement below can be removed altogether.
			if ( activeContent && !activeContent.data( "mobile-dialog" ) ) {
				// determine if we're heading forward or backward and continue
				// accordingly past the current dialog
				if ( data.direction === "back" ) {
					this.back();
				} else {
					this.forward();
				}

				// prevent changePage call
				return false;
			} else {
				// if the current active page is a dialog and we're navigating
				// to a dialog use the dialog objected saved in the stack
				to = data.pageUrl;
				active = this._getActiveHistory();

				// make sure to set the role, transition and reversal
				// as most of this is lost by the domCache cleaning
				$.extend( changePageOptions, {
					role: active.role,
					transition: this._transitionFromHistory(
						data.direction,
						changePageOptions.transition ),
					reverse: data.direction === "back"
				});
			}

			return to;
		},

		_handleNavigate: function( url, data ) {
			//find first page via hash
			// TODO stripping the hash twice with handleUrl
			var to = $.mobile.path.stripHash( url ), history = this._getHistory(),

				// transition is false if it's the first page, undefined
				// otherwise (and may be overridden by default)
				transition = history.stack.length === 0 ? "none" :
					this._transitionFromHistory( data.direction ),

				// default options for the changPage calls made after examining
				// the current state of the page and the hash, NOTE that the
				// transition is derived from the previous history entry
				changePageOptions = {
					changeHash: false,
					fromHashChange: true,
					reverse: data.direction === "back"
				};

			$.extend( changePageOptions, data, {
				transition: transition
			});

			// TODO move to _handleDestination ?
			// If this isn't the first page, if the current url is a dialog hash
			// key, and the initial destination isn't equal to the current target
			// page, use the special dialog handling
			if ( history.activeIndex > 0 &&
				to.indexOf( $.mobile.dialogHashKey ) > -1 ) {

				to = this._handleDialog( changePageOptions, data );

				if ( to === false ) {
					return;
				}
			}

			this._changeContent( this._handleDestination( to ), changePageOptions );
		},

		_changeContent: function( to, opts ) {
			$.mobile.changePage( to, opts );
		},

		_getBase: function() {
			return $.mobile.base;
		},

		_getNs: function() {
			return $.mobile.ns;
		},

		_enhance: function( content, role ) {
			// TODO consider supporting a custom callback, and passing in
			// the settings which includes the role
			return content.page({ role: role });
		},

		_include: function( page, settings ) {
			// append to page and enhance
			page.appendTo( this.element );

			// use the page widget to enhance
			this._enhance( page, settings.role );

			// remove page on hide
			page.page( "bindRemove" );
		},

		_find: function( absUrl ) {
			// TODO consider supporting a custom callback
			var fileUrl = this._createFileUrl( absUrl ),
				dataUrl = this._createDataUrl( absUrl ),
				page, initialContent = this._getInitialContent();

			// Check to see if the page already exists in the DOM.
			// NOTE do _not_ use the :jqmData pseudo selector because parenthesis
			//      are a valid url char and it breaks on the first occurence
			page = this.element
				.children( "[data-" + this._getNs() +
					"url='" + $.mobile.path.hashToSelector( dataUrl ) + "']" );

			// If we failed to find the page, check to see if the url is a
			// reference to an embedded page. If so, it may have been dynamically
			// injected by a developer, in which case it would be lacking a
			// data-url attribute and in need of enhancement.
			if ( page.length === 0 && dataUrl && !$.mobile.path.isPath( dataUrl ) ) {
				page = this.element.children( $.mobile.path.hashToSelector("#" + dataUrl) )
					.attr( "data-" + this._getNs() + "url", dataUrl )
					.jqmData( "url", dataUrl );
			}

			// If we failed to find a page in the DOM, check the URL to see if it
			// refers to the first page in the application. Also check to make sure
			// our cached-first-page is actually in the DOM. Some user deployed
			// apps are pruning the first page from the DOM for various reasons.
			// We check for this case here because we don't want a first-page with
			// an id falling through to the non-existent embedded page error case.
			if ( page.length === 0 &&
				$.mobile.path.isFirstPageUrl( fileUrl ) &&
				initialContent &&
				initialContent.parent().length ) {
				page = $( initialContent );
			}

			return page;
		},

		_getLoader: function() {
			return $.mobile.loading();
		},

		_showLoading: function( delay, theme, msg, textonly ) {
			// This configurable timeout allows cached pages a brief
			// delay to load without showing a message
			if ( this._loadMsg ) {
				return;
			}

			this._loadMsg = setTimeout($.proxy(function() {
				this._getLoader().loader( "show", theme, msg, textonly );
				this._loadMsg = 0;
			}, this), delay );
		},

		_hideLoading: function() {
			// Stop message show timer
			clearTimeout( this._loadMsg );
			this._loadMsg = 0;

			// Hide loading message
			this._getLoader().loader( "hide" );
		},

		_showError: function() {
			// make sure to remove the current loading message
			this._hideLoading();

			// show the error message
			this._showLoading( 0, $.mobile.pageLoadErrorMessageTheme, $.mobile.pageLoadErrorMessage, true );

			// hide the error message after a delay
			// TODO configuration
			setTimeout( $.proxy(this, "_hideLoading"), 1500 );
		},

		_parse: function( html, fileUrl ) {
		    // TODO consider allowing customization of this method. It's very JQM specific
		    var page, all = $("<div></div>");

		    //workaround to allow scripts to execute when included in page divs
		    all.get(0).innerHTML = html;

		    page = all.find(":jqmData(role='page'), :jqmData(role='dialog')");

		    //if page elem couldn't be found, create one and insert the body element's contents
		    if (!page.length) {
		        page = $("<div data-" + this._getNs() + "role='page'>" +
					(html.split(/<\/?body[^>]*>/gmi)[1] || "") +
					"</div>");
		    }

		    // TODO tagging a page with external to make sure that embedded pages aren't
		    // removed by the various page handling code is bad. Having page handling code
		    // in many places is bad. Solutions post 1.0
		    page.attr("data-" + this._getNs() + "url", this._createDataUrl(fileUrl))
				.attr("data-" + this._getNs() + "external-page", true);

		    return page;
		},

		_setLoadedTitle: function( page, html ) {
			//page title regexp
			var newPageTitle = html.match( /<title[^>]*>([^<]*)/ ) && RegExp.$1;

			if ( newPageTitle && !page.jqmData("title") ) {
				newPageTitle = $( "<div>" + newPageTitle + "</div>" ).text();
				page.jqmData( "title", newPageTitle );
			}
		},

		_isRewritableBaseTag: function() {
			return $.mobile.dynamicBaseEnabled && !$.support.dynamicBaseTag;
		},

		_createDataUrl: function( absoluteUrl ) {
			return $.mobile.path.convertUrlToDataUrl( absoluteUrl );
		},

		_createFileUrl: function( absoluteUrl ) {
			return $.mobile.path.getFilePath( absoluteUrl );
		},

		_triggerWithDeprecated: function( name, data, page ) {
			var deprecatedEvent = $.Event( "page" + name ),
				newEvent = $.Event( this.widgetName + name );

			// DEPRECATED
			// trigger the old deprecated event on the page if it's provided
			( page || this.element ).trigger( deprecatedEvent, data );

			// use the widget trigger method for the new content* event
			this._trigger( name, newEvent, data );

			return {
				deprecatedEvent: deprecatedEvent,
				event: newEvent
			};
		},

		// TODO it would be nice to split this up more but everything appears to be "one off"
		//      or require ordering such that other bits are sprinkled in between parts that
		//      could be abstracted out as a group
		_loadSuccess: function( absUrl, triggerData, settings, deferred ) {
			var fileUrl = this._createFileUrl( absUrl );

			return $.proxy(function( html, textStatus, xhr ) {
				//pre-parse html to check for a data-url,
				//use it as the new fileUrl, base path, etc
				var content,

					// TODO handle dialogs again
					pageElemRegex = new RegExp( "(<[^>]+\\bdata-" + this._getNs() + "role=[\"']?page[\"']?[^>]*>)" ),

					dataUrlRegex = new RegExp( "\\bdata-" + this._getNs() + "url=[\"']?([^\"'>]*)[\"']?" );

				// data-url must be provided for the base tag so resource requests
				// can be directed to the correct url. loading into a temprorary
				// element makes these requests immediately
				if ( pageElemRegex.test( html ) &&
					RegExp.$1 &&
					dataUrlRegex.test( RegExp.$1 ) &&
					RegExp.$1 ) {
					fileUrl = $.mobile.path.getFilePath( $("<div>" + RegExp.$1 + "</div>").text() );

					// We specify that, if a data-url attribute is given on the page div, its value
					// must be given non-URL-encoded. However, in this part of the code, fileUrl is
					// assumed to be URL-encoded, so we URL-encode the retrieved value here
					fileUrl = this.window[ 0 ].encodeURIComponent( fileUrl );
				}

				//dont update the base tag if we are prefetching
				if ( settings.prefetch === undefined ) {
					this._getBase().set( fileUrl );
				}

				content = this._parse( html, fileUrl );
				var allPages = content;
			    content = content.first();
				this._setLoadedTitle( content, html );

				// Add the content reference and xhr to our triggerData.
				triggerData.xhr = xhr;
				triggerData.textStatus = textStatus;

				// DEPRECATED
				triggerData.page = content;

				triggerData.content = content;

				triggerData.toPage = content;

				// If the default behavior is prevented, stop here!
				// Note that it is the responsibility of the listener/handler
				// that called preventDefault(), to resolve/reject the
				// deferred object within the triggerData.
				if ( this._triggerWithDeprecated( "load", triggerData ).event.isDefaultPrevented() ) {
					return;
				}

				// rewrite src and href attrs to use a base url if the base tag won't work
				if ( this._isRewritableBaseTag() && content ) {
					this._getBase().rewrite( fileUrl, content );
				}

				this._include(allPages, settings);

				// Remove loading message.
				if ( settings.showLoadMsg ) {
					this._hideLoading();
				}

				deferred.resolve( absUrl, settings, content );
			}, this);
		},

		_loadDefaults: {
			type: "get",
			data: undefined,

			// DEPRECATED
			reloadPage: false,

			reload: false,

			// By default we rely on the role defined by the @data-role attribute.
			role: undefined,

			showLoadMsg: false,

			// This delay allows loads that pull from browser cache to
			// occur without showing the loading message.
			loadMsgDelay: 50
		},

		load: function( url, options ) {
			// This function uses deferred notifications to let callers
			// know when the content is done loading, or if an error has occurred.
			var deferred = ( options && options.deferred ) || $.Deferred(),

				// Examining the option "reloadPage" passed by the user is deprecated as of 1.4.0
				// and will be removed in 1.5.0.
				// Copy option "reloadPage" to "reload", but only if option "reload" is not present
				reloadOptionExtension =
					( ( options && options.reload === undefined &&
						options.reloadPage !== undefined ) ?
							{ reload: options.reloadPage } : {} ),

				// The default load options with overrides specified by the caller.
				settings = $.extend( {}, this._loadDefaults, options, reloadOptionExtension ),

				// The DOM element for the content after it has been loaded.
				content = null,

				// The absolute version of the URL passed into the function. This
				// version of the URL may contain dialog/subcontent params in it.
				absUrl = $.mobile.path.makeUrlAbsolute( url, this._findBaseWithDefault() ),
				fileUrl, dataUrl, pblEvent, triggerData;

			// If the caller provided data, and we're using "get" request,
			// append the data to the URL.
			if ( settings.data && settings.type === "get" ) {
				absUrl = $.mobile.path.addSearchParams( absUrl, settings.data );
				settings.data = undefined;
			}

			// If the caller is using a "post" request, reload must be true
			if ( settings.data && settings.type === "post" ) {
				settings.reload = true;
			}

			// The absolute version of the URL minus any dialog/subcontent params.
			// In otherwords the real URL of the content to be loaded.
			fileUrl = this._createFileUrl( absUrl );

			// The version of the Url actually stored in the data-url attribute of
			// the content. For embedded content, it is just the id of the page. For
			// content within the same domain as the document base, it is the site
			// relative path. For cross-domain content (Phone Gap only) the entire
			// absolute Url is used to load the content.
			dataUrl = this._createDataUrl( absUrl );

			content = this._find( absUrl );

			// If it isn't a reference to the first content and refers to missing
			// embedded content reject the deferred and return
			if ( content.length === 0 &&
				$.mobile.path.isEmbeddedPage(fileUrl) &&
				!$.mobile.path.isFirstPageUrl(fileUrl) ) {
				deferred.reject( absUrl, settings );
				return deferred.promise();
			}

			// Reset base to the default document base
			// TODO figure out why we doe this
			this._getBase().reset();

			// If the content we are interested in is already in the DOM,
			// and the caller did not indicate that we should force a
			// reload of the file, we are done. Resolve the deferrred so that
			// users can bind to .done on the promise
			if ( content.length && !settings.reload ) {
				this._enhance( content, settings.role );
				deferred.resolve( absUrl, settings, content );

				//if we are reloading the content make sure we update
				// the base if its not a prefetch
				if ( !settings.prefetch ) {
					this._getBase().set(url);
				}

				return deferred.promise();
			}

			triggerData = {
				url: url,
				absUrl: absUrl,
				toPage: url,
				prevPage: options ? options.fromPage : undefined,
				dataUrl: dataUrl,
				deferred: deferred,
				options: settings
			};

			// Let listeners know we're about to load content.
			pblEvent = this._triggerWithDeprecated( "beforeload", triggerData );

			// If the default behavior is prevented, stop here!
			if ( pblEvent.deprecatedEvent.isDefaultPrevented() ||
				pblEvent.event.isDefaultPrevented() ) {
				return deferred.promise();
			}

			if ( settings.showLoadMsg ) {
				this._showLoading( settings.loadMsgDelay );
			}

			// Reset base to the default document base.
			// only reset if we are not prefetching
			if ( settings.prefetch === undefined ) {
				this._getBase().reset();
			}

			if ( !( $.mobile.allowCrossDomainPages ||
				$.mobile.path.isSameDomain($.mobile.path.documentUrl, absUrl ) ) ) {
				deferred.reject( absUrl, settings );
				return deferred.promise();
			}

			// Load the new content.
			$.ajax({
				url: fileUrl,
				type: settings.type,
				data: settings.data,
				contentType: settings.contentType,
				dataType: "html",
				success: this._loadSuccess( absUrl, triggerData, settings, deferred ),
				error: this._loadError( absUrl, triggerData, settings, deferred )
			});

			return deferred.promise();
		},

		_loadError: function( absUrl, triggerData, settings, deferred ) {
			return $.proxy(function( xhr, textStatus, errorThrown ) {
				//set base back to current path
				this._getBase().set( $.mobile.path.get() );

				// Add error info to our triggerData.
				triggerData.xhr = xhr;
				triggerData.textStatus = textStatus;
				triggerData.errorThrown = errorThrown;

				// Let listeners know the page load failed.
				var plfEvent = this._triggerWithDeprecated( "loadfailed", triggerData );

				// If the default behavior is prevented, stop here!
				// Note that it is the responsibility of the listener/handler
				// that called preventDefault(), to resolve/reject the
				// deferred object within the triggerData.
				if ( plfEvent.deprecatedEvent.isDefaultPrevented() ||
					plfEvent.event.isDefaultPrevented() ) {
					return;
				}

				// Remove loading message.
				if ( settings.showLoadMsg ) {
					this._showError();
				}

				deferred.reject( absUrl, settings );
			}, this);
		},

		_getTransitionHandler: function( transition ) {
			transition = $.mobile._maybeDegradeTransition( transition );

			//find the transition handler for the specified transition. If there
			//isn't one in our transitionHandlers dictionary, use the default one.
			//call the handler immediately to kick-off the transition.
			return $.mobile.transitionHandlers[ transition ] || $.mobile.defaultTransitionHandler;
		},

		// TODO move into transition handlers?
		_triggerCssTransitionEvents: function( to, from, prefix ) {
			var samePage = false;

			prefix = prefix || "";

			// TODO decide if these events should in fact be triggered on the container
			if ( from ) {

				//Check if this is a same page transition and tell the handler in page
				if( to[0] === from[0] ){
					samePage = true;
				}

				//trigger before show/hide events
				// TODO deprecate nextPage in favor of next
				this._triggerWithDeprecated( prefix + "hide", {

					// Deprecated in 1.4 remove in 1.5
					nextPage: to,
					toPage: to,
					prevPage: from,
					samePage: samePage
				}, from );
			}

			// TODO deprecate prevPage in favor of previous
			this._triggerWithDeprecated( prefix + "show", {
				prevPage: from || $( "" ),
				toPage: to
			}, to );
		},

		// TODO make private once change has been defined in the widget
		_cssTransition: function( to, from, options ) {
			var transition = options.transition,
				reverse = options.reverse,
				deferred = options.deferred,
				TransitionHandler,
				promise;

			this._triggerCssTransitionEvents( to, from, "before" );

			// TODO put this in a binding to events *outside* the widget
			this._hideLoading();

			TransitionHandler = this._getTransitionHandler( transition );

			promise = ( new TransitionHandler( transition, reverse, to, from ) ).transition();

			promise.done( $.proxy( function() {
				this._triggerCssTransitionEvents( to, from );
			}, this ));

			// TODO temporary accomodation of argument deferred
			promise.done(function() {
				deferred.resolve.apply( deferred, arguments );
			});
		},

		_releaseTransitionLock: function() {
			//release transition lock so navigation is free again
			isPageTransitioning = false;
			if ( pageTransitionQueue.length > 0 ) {
				$.mobile.changePage.apply( null, pageTransitionQueue.pop() );
			}
		},

		_removeActiveLinkClass: function( force ) {
			//clear out the active button state
			$.mobile.removeActiveLinkClass( force );
		},

		_loadUrl: function( to, triggerData, settings ) {
			// preserve the original target as the dataUrl value will be
			// simplified eg, removing ui-state, and removing query params
			// from the hash this is so that users who want to use query
			// params have access to them in the event bindings for the page
			// life cycle See issue #5085
			settings.target = to;
			settings.deferred = $.Deferred();

			this.load( to, settings );

			settings.deferred.done($.proxy(function( url, options, content ) {
				isPageTransitioning = false;

				// store the original absolute url so that it can be provided
				// to events in the triggerData of the subsequent changePage call
				options.absUrl = triggerData.absUrl;

				this.transition( content, triggerData, options );
			}, this));

			settings.deferred.fail($.proxy(function(/* url, options */) {
				this._removeActiveLinkClass( true );
				this._releaseTransitionLock();
				this._triggerWithDeprecated( "changefailed", triggerData );
			}, this));
		},

		_triggerPageBeforeChange: function( to, triggerData, settings ) {
			var returnEvents;

			triggerData.prevPage = this.activePage;
			$.extend( triggerData, {
				toPage: to,
				options: settings
			});

			// NOTE: preserve the original target as the dataUrl value will be
			// simplified eg, removing ui-state, and removing query params from
			// the hash this is so that users who want to use query params have
			// access to them in the event bindings for the page life cycle
			// See issue #5085
			if ( $.type(to) === "string" ) {
				// if the toPage is a string simply convert it
				triggerData.absUrl = $.mobile.path.makeUrlAbsolute( to, this._findBaseWithDefault() );
			} else {
				// if the toPage is a jQuery object grab the absolute url stored
				// in the loadPage callback where it exists
				triggerData.absUrl = settings.absUrl;
			}

			// Let listeners know we're about to change the current page.
			returnEvents = this._triggerWithDeprecated( "beforechange", triggerData );

			// If the default behavior is prevented, stop here!
			if ( returnEvents.event.isDefaultPrevented() ||
				returnEvents.deprecatedEvent.isDefaultPrevented() ) {
				return false;
			}

			return true;
		},

		change: function( to, options ) {
			// If we are in the midst of a transition, queue the current request.
			// We'll call changePage() once we're done with the current transition
			// to service the request.
			if ( isPageTransitioning ) {
				pageTransitionQueue.unshift( arguments );
				return;
			}

			var settings = $.extend( {}, $.mobile.changePage.defaults, options ),
				triggerData = {};

			// Make sure we have a fromPage.
			settings.fromPage = settings.fromPage || this.activePage;

			// if the page beforechange default is prevented return early
			if ( !this._triggerPageBeforeChange(to, triggerData, settings) ) {
				return;
			}

			// We allow "pagebeforechange" observers to modify the to in
			// the trigger data to allow for redirects. Make sure our to is
			// updated. We also need to re-evaluate whether it is a string,
			// because an object can also be replaced by a string
			to = triggerData.toPage;

			// If the caller passed us a url, call loadPage()
			// to make sure it is loaded into the DOM. We'll listen
			// to the promise object it returns so we know when
			// it is done loading or if an error ocurred.
			if ( $.type(to) === "string" ) {
				// Set the isPageTransitioning flag to prevent any requests from
				// entering this method while we are in the midst of loading a page
				// or transitioning.
				isPageTransitioning = true;

				this._loadUrl( to, triggerData, settings );
			} else {
				this.transition( to, triggerData, settings );
			}
		},

		transition: function( toPage, triggerData, settings ) {
			var fromPage, url, pageUrl, fileUrl,
				active, activeIsInitialPage,
				historyDir, pageTitle, isDialog,
				alreadyThere, newPageTitle,
				params,	cssTransitionDeferred,
				beforeTransition;

			// If we are in the midst of a transition, queue the current request.
			// We'll call changePage() once we're done with the current transition
			// to service the request.
			if ( isPageTransitioning ) {
				// make sure to only queue the to and settings values so the arguments
				// work with a call to the change method
				pageTransitionQueue.unshift( [toPage, settings] );
				return;
			}

			// DEPRECATED - this call only, in favor of the before transition
			// if the page beforechange default is prevented return early
			if ( !this._triggerPageBeforeChange(toPage, triggerData, settings) ) {
				return;
			}

			triggerData.prevPage = settings.fromPage;
			// if the (content|page)beforetransition default is prevented return early
			// Note, we have to check for both the deprecated and new events
			beforeTransition = this._triggerWithDeprecated( "beforetransition", triggerData );
			if (beforeTransition.deprecatedEvent.isDefaultPrevented() ||
				beforeTransition.event.isDefaultPrevented() ) {
				return;
			}

			// Set the isPageTransitioning flag to prevent any requests from
			// entering this method while we are in the midst of loading a page
			// or transitioning.
			isPageTransitioning = true;

			// If we are going to the first-page of the application, we need to make
			// sure settings.dataUrl is set to the application document url. This allows
			// us to avoid generating a document url with an id hash in the case where the
			// first-page of the document has an id attribute specified.
			if ( toPage[ 0 ] === $.mobile.firstPage[ 0 ] && !settings.dataUrl ) {
				settings.dataUrl = $.mobile.path.documentUrl.hrefNoHash;
			}

			// The caller passed us a real page DOM element. Update our
			// internal state and then trigger a transition to the page.
			fromPage = settings.fromPage;
			url = ( settings.dataUrl && $.mobile.path.convertUrlToDataUrl(settings.dataUrl) ) ||
				toPage.jqmData( "url" );

			// The pageUrl var is usually the same as url, except when url is obscured
			// as a dialog url. pageUrl always contains the file path
			pageUrl = url;
			fileUrl = $.mobile.path.getFilePath( url );
			active = $.mobile.navigate.history.getActive();
			activeIsInitialPage = $.mobile.navigate.history.activeIndex === 0;
			historyDir = 0;
			pageTitle = document.title;
			isDialog = ( settings.role === "dialog" ||
				toPage.jqmData( "role" ) === "dialog" ) &&
				toPage.jqmData( "dialog" ) !== true;

			// By default, we prevent changePage requests when the fromPage and toPage
			// are the same element, but folks that generate content
			// manually/dynamically and reuse pages want to be able to transition to
			// the same page. To allow this, they will need to change the default
			// value of allowSamePageTransition to true, *OR*, pass it in as an
			// option when they manually call changePage(). It should be noted that
			// our default transition animations assume that the formPage and toPage
			// are different elements, so they may behave unexpectedly. It is up to
			// the developer that turns on the allowSamePageTransitiona option to
			// either turn off transition animations, or make sure that an appropriate
			// animation transition is used.
			if ( fromPage && fromPage[0] === toPage[0] &&
				!settings.allowSamePageTransition ) {

				isPageTransitioning = false;
				this._triggerWithDeprecated( "transition", triggerData );
				this._triggerWithDeprecated( "change", triggerData );

				// Even if there is no page change to be done, we should keep the
				// urlHistory in sync with the hash changes
				if ( settings.fromHashChange ) {
					$.mobile.navigate.history.direct({ url: url });
				}

				return;
			}

			// We need to make sure the page we are given has already been enhanced.
			toPage.page({ role: settings.role });

			// If the changePage request was sent from a hashChange event, check to
			// see if the page is already within the urlHistory stack. If so, we'll
			// assume the user hit the forward/back button and will try to match the
			// transition accordingly.
			if ( settings.fromHashChange ) {
				historyDir = settings.direction === "back" ? -1 : 1;
			}

			// Kill the keyboard.
			// XXX_jblas: We need to stop crawling the entire document to kill focus.
			//            Instead, we should be tracking focus with a delegate()
			//            handler so we already have the element in hand at this
			//            point.
			// Wrap this in a try/catch block since IE9 throw "Unspecified error" if
			// document.activeElement is undefined when we are in an IFrame.
			try {
				if ( document.activeElement &&
					document.activeElement.nodeName.toLowerCase() !== "body" ) {

					$( document.activeElement ).blur();
				} else {
					$( "input:focus, textarea:focus, select:focus" ).blur();
				}
			} catch( e ) {}

			// Record whether we are at a place in history where a dialog used to be -
			// if so, do not add a new history entry and do not change the hash either
			alreadyThere = false;

			// If we're displaying the page as a dialog, we don't want the url
			// for the dialog content to be used in the hash. Instead, we want
			// to append the dialogHashKey to the url of the current page.
			if ( isDialog && active ) {
				// on the initial page load active.url is undefined and in that case
				// should be an empty string. Moving the undefined -> empty string back
				// into urlHistory.addNew seemed imprudent given undefined better
				// represents the url state

				// If we are at a place in history that once belonged to a dialog, reuse
				// this state without adding to urlHistory and without modifying the
				// hash. However, if a dialog is already displayed at this point, and
				// we're about to display another dialog, then we must add another hash
				// and history entry on top so that one may navigate back to the
				// original dialog
				if ( active.url &&
					active.url.indexOf( $.mobile.dialogHashKey ) > -1 &&
					this.activePage &&
					!this.activePage.hasClass( "ui-dialog" ) &&
					$.mobile.navigate.history.activeIndex > 0 ) {

					settings.changeHash = false;
					alreadyThere = true;
				}

				// Normally, we tack on a dialog hash key, but if this is the location
				// of a stale dialog, we reuse the URL from the entry
				url = ( active.url || "" );

				// account for absolute urls instead of just relative urls use as hashes
				if ( !alreadyThere && url.indexOf("#") > -1 ) {
					url += $.mobile.dialogHashKey;
				} else {
					url += "#" + $.mobile.dialogHashKey;
				}
			}

			// if title element wasn't found, try the page div data attr too
			// If this is a deep-link or a reload ( active === undefined ) then just
			// use pageTitle
			newPageTitle = ( !active ) ? pageTitle : toPage.jqmData( "title" ) ||
				toPage.children( ":jqmData(role='header')" ).find( ".ui-title" ).text();
			if ( !!newPageTitle && pageTitle === document.title ) {
				pageTitle = newPageTitle;
			}
			if ( !toPage.jqmData( "title" ) ) {
				toPage.jqmData( "title", pageTitle );
			}

			// Make sure we have a transition defined.
			settings.transition = settings.transition ||
				( ( historyDir && !activeIsInitialPage ) ? active.transition : undefined ) ||
				( isDialog ? $.mobile.defaultDialogTransition : $.mobile.defaultPageTransition );

			//add page to history stack if it's not back or forward
			if ( !historyDir && alreadyThere ) {
				$.mobile.navigate.history.getActive().pageUrl = pageUrl;
			}

			// Set the location hash.
			if ( url && !settings.fromHashChange ) {

				// rebuilding the hash here since we loose it earlier on
				// TODO preserve the originally passed in path
				if ( !$.mobile.path.isPath( url ) && url.indexOf( "#" ) < 0 ) {
					url = "#" + url;
				}

				// TODO the property names here are just silly
				params = {
					transition: settings.transition,
					title: pageTitle,
					pageUrl: pageUrl,
					role: settings.role
				};

				if ( settings.changeHash !== false && $.mobile.hashListeningEnabled ) {
					$.mobile.navigate( this.window[ 0 ].encodeURI( url ), params, true);
				} else if ( toPage[ 0 ] !== $.mobile.firstPage[ 0 ] ) {
					$.mobile.navigate.history.add( url, params );
				}
			}

			//set page title
			document.title = pageTitle;

			//set "toPage" as activePage deprecated in 1.4 remove in 1.5
			$.mobile.activePage = toPage;

			//new way to handle activePage
			this.activePage = toPage;

			// If we're navigating back in the URL history, set reverse accordingly.
			settings.reverse = settings.reverse || historyDir < 0;

			cssTransitionDeferred = $.Deferred();

			this._cssTransition(toPage, fromPage, {
				transition: settings.transition,
				reverse: settings.reverse,
				deferred: cssTransitionDeferred
			});

			cssTransitionDeferred.done($.proxy(function( name, reverse, $to, $from, alreadyFocused ) {
				$.mobile.removeActiveLinkClass();

				//if there's a duplicateCachedPage, remove it from the DOM now that it's hidden
				if ( settings.duplicateCachedPage ) {
					settings.duplicateCachedPage.remove();
				}

				// despite visibility: hidden addresses issue #2965
				// https://github.com/jquery/jquery-mobile/issues/2965
				if ( !alreadyFocused ) {
					$.mobile.focusPage( toPage );
				}

				this._releaseTransitionLock();
				this._triggerWithDeprecated( "transition", triggerData );
				this._triggerWithDeprecated( "change", triggerData );
			}, this));
		},

		// determine the current base url
		_findBaseWithDefault: function() {
			var closestBase = ( this.activePage &&
			$.mobile.getClosestBaseUrl( this.activePage ) );
		return closestBase || $.mobile.path.documentBase.hrefNoHash;
		}
	});

	// The following handlers should be bound after mobileinit has been triggered
	// the following deferred is resolved in the init file
	$.mobile.navreadyDeferred = $.Deferred();

	//these variables make all page containers use the same queue and only navigate one at a time
	// queue to hold simultanious page transitions
	var pageTransitionQueue = [],

		// indicates whether or not page is in process of transitioning
		isPageTransitioning = false;

})( jQuery );

(function( $, undefined ) {

		// resolved on domready
	var domreadyDeferred = $.Deferred(),

		// resolved and nulled on window.load()
		loadDeferred = $.Deferred(),

		// function that resolves the above deferred
		pageIsFullyLoaded = function() {

			// Resolve and null the deferred
			loadDeferred.resolve();
			loadDeferred = null;
		},

		documentUrl = $.mobile.path.documentUrl,

		// used to track last vclicked element to make sure its value is added to form data
		$lastVClicked = null;

	/* Event Bindings - hashchange, submit, and click */
	function findClosestLink( ele )	{
		while ( ele ) {
			// Look for the closest element with a nodeName of "a".
			// Note that we are checking if we have a valid nodeName
			// before attempting to access it. This is because the
			// node we get called with could have originated from within
			// an embedded SVG document where some symbol instance elements
			// don't have nodeName defined on them, or strings are of type
			// SVGAnimatedString.
			if ( ( typeof ele.nodeName === "string" ) && ele.nodeName.toLowerCase() === "a" ) {
				break;
			}
			ele = ele.parentNode;
		}
		return ele;
	}

	$.mobile.loadPage = function( url, opts ) {
		var container;

		opts = opts || {};
		container = ( opts.pageContainer || $.mobile.pageContainer );

		// create the deferred that will be supplied to loadPage callers
		// and resolved by the content widget's load method
		opts.deferred = $.Deferred();

		// Preferring to allow exceptions for uninitialized opts.pageContainer
		// widgets so we know if we need to force init here for users
		container.pagecontainer( "load", url, opts );

		// provide the deferred
		return opts.deferred.promise();
	};

	//define vars for interal use

	/* internal utility functions */

	// NOTE Issue #4950 Android phonegap doesn't navigate back properly
	//      when a full page refresh has taken place. It appears that hashchange
	//      and replacestate history alterations work fine but we need to support
	//      both forms of history traversal in our code that uses backward history
	//      movement
	$.mobile.back = function() {
		var nav = window.navigator;

		// if the setting is on and the navigator object is
		// available use the phonegap navigation capability
		if ( this.phonegapNavigationEnabled &&
			nav &&
			nav.app &&
			nav.app.backHistory ) {
			nav.app.backHistory();
		} else {
			$.mobile.pageContainer.pagecontainer( "back" );
		}
	};

	// Direct focus to the page title, or otherwise first focusable element
	$.mobile.focusPage = function ( page ) {
		var autofocus = page.find( "[autofocus]" ),
			pageTitle = page.find( ".ui-title:eq(0)" );

		if ( autofocus.length ) {
			autofocus.focus();
			return;
		}

		if ( pageTitle.length ) {
			pageTitle.focus();
		} else{
			page.focus();
		}
	};

	// No-op implementation of transition degradation
	$.mobile._maybeDegradeTransition = $.mobile._maybeDegradeTransition || function( transition ) {
		return transition;
	};

	// Exposed $.mobile methods

	$.mobile.changePage = function( to, options ) {
		$.mobile.pageContainer.pagecontainer( "change", to, options );
	};

	$.mobile.changePage.defaults = {
		transition: undefined,
		reverse: false,
		changeHash: true,
		fromHashChange: false,
		role: undefined, // By default we rely on the role defined by the @data-role attribute.
		duplicateCachedPage: undefined,
		pageContainer: undefined,
		showLoadMsg: true, //loading message shows by default when pages are being fetched during changePage
		dataUrl: undefined,
		fromPage: undefined,
		allowSamePageTransition: false
	};

	$.mobile._registerInternalEvents = function() {
		var getAjaxFormData = function( $form, calculateOnly ) {
			var url, ret = true, formData, vclickedName, method;
			if ( !$.mobile.ajaxEnabled ||
					// test that the form is, itself, ajax false
					$form.is( ":jqmData(ajax='false')" ) ||
					// test that $.mobile.ignoreContentEnabled is set and
					// the form or one of it's parents is ajax=false
					!$form.jqmHijackable().length ||
					$form.attr( "target" ) ) {
				return false;
			}

			url = ( $lastVClicked && $lastVClicked.attr( "formaction" ) ) ||
				$form.attr( "action" );
			method = ( $form.attr( "method" ) || "get" ).toLowerCase();

			// If no action is specified, browsers default to using the
			// URL of the document containing the form. Since we dynamically
			// pull in pages from external documents, the form should submit
			// to the URL for the source document of the page containing
			// the form.
			if ( !url ) {
				// Get the @data-url for the page containing the form.
				url = $.mobile.getClosestBaseUrl( $form );

				// NOTE: If the method is "get", we need to strip off the query string
				// because it will get replaced with the new form data. See issue #5710.
				if ( method === "get" ) {
					url = $.mobile.path.parseUrl( url ).hrefNoSearch;
				}

				if ( url === $.mobile.path.documentBase.hrefNoHash ) {
					// The url we got back matches the document base,
					// which means the page must be an internal/embedded page,
					// so default to using the actual document url as a browser
					// would.
					url = documentUrl.hrefNoSearch;
				}
			}

			url = $.mobile.path.makeUrlAbsolute(  url, $.mobile.getClosestBaseUrl( $form ) );

			if ( ( $.mobile.path.isExternal( url ) && !$.mobile.path.isPermittedCrossDomainRequest( documentUrl, url ) ) ) {
				return false;
			}

			if ( !calculateOnly ) {
				formData = $form.serializeArray();

				if ( $lastVClicked && $lastVClicked[ 0 ].form === $form[ 0 ] ) {
					vclickedName = $lastVClicked.attr( "name" );
					if ( vclickedName ) {
						// Make sure the last clicked element is included in the form
						$.each( formData, function( key, value ) {
							if ( value.name === vclickedName ) {
								// Unset vclickedName - we've found it in the serialized data already
								vclickedName = "";
								return false;
							}
						});
						if ( vclickedName ) {
							formData.push( { name: vclickedName, value: $lastVClicked.attr( "value" ) } );
						}
					}
				}

				ret = {
					url: url,
					options: {
						type:		method,
						data:		$.param( formData ),
						transition:	$form.jqmData( "transition" ),
						reverse:	$form.jqmData( "direction" ) === "reverse",
						reloadPage:	true
					}
				};
			}

			return ret;
		};

		//bind to form submit events, handle with Ajax
		$.mobile.document.delegate( "form", "submit", function( event ) {
			var formData;

			if ( !event.isDefaultPrevented() ) {
				formData = getAjaxFormData( $( this ) );
				if ( formData ) {
					$.mobile.changePage( formData.url, formData.options );
					event.preventDefault();
				}
			}
		});

		//add active state on vclick
		$.mobile.document.bind( "vclick", function( event ) {
			var $btn, btnEls, target = event.target, needClosest = false;
			// if this isn't a left click we don't care. Its important to note
			// that when the virtual event is generated it will create the which attr
			if ( event.which > 1 || !$.mobile.linkBindingEnabled ) {
				return;
			}

			// Record that this element was clicked, in case we need it for correct
			// form submission during the "submit" handler above
			$lastVClicked = $( target );

			// Try to find a target element to which the active class will be applied
			if ( $.data( target, "mobile-button" ) ) {
				// If the form will not be submitted via AJAX, do not add active class
				if ( !getAjaxFormData( $( target ).closest( "form" ), true ) ) {
					return;
				}
				// We will apply the active state to this button widget - the parent
				// of the input that was clicked will have the associated data
				if ( target.parentNode ) {
					target = target.parentNode;
				}
			} else {
				target = findClosestLink( target );
				if ( !( target && $.mobile.path.parseUrl( target.getAttribute( "href" ) || "#" ).hash !== "#" ) ) {
					return;
				}

				// TODO teach $.mobile.hijackable to operate on raw dom elements so the
				// link wrapping can be avoided
				if ( !$( target ).jqmHijackable().length ) {
					return;
				}
			}

			// Avoid calling .closest by using the data set during .buttonMarkup()
			// List items have the button data in the parent of the element clicked
			if ( !!~target.className.indexOf( "ui-link-inherit" ) ) {
				if ( target.parentNode ) {
					btnEls = $.data( target.parentNode, "buttonElements" );
				}
			// Otherwise, look for the data on the target itself
			} else {
				btnEls = $.data( target, "buttonElements" );
			}
			// If found, grab the button's outer element
			if ( btnEls ) {
				target = btnEls.outer;
			} else {
				needClosest = true;
			}

			$btn = $( target );
			// If the outer element wasn't found by the our heuristics, use .closest()
			if ( needClosest ) {
				$btn = $btn.closest( ".ui-btn" );
			}

			if ( $btn.length > 0 &&
				!( $btn.hasClass( "ui-state-disabled" ||

					// DEPRECATED as of 1.4.0 - remove after 1.4.0 release
					// only ui-state-disabled should be present thereafter
					$btn.hasClass( "ui-disabled" ) ) ) ) {
				$.mobile.removeActiveLinkClass( true );
				$.mobile.activeClickedLink = $btn;
				$.mobile.activeClickedLink.addClass( $.mobile.activeBtnClass );
			}
		});

		// click routing - direct to HTTP or Ajax, accordingly
		$.mobile.document.bind( "click", function( event ) {
			if ( !$.mobile.linkBindingEnabled || event.isDefaultPrevented() ) {
				return;
			}

			var link = findClosestLink( event.target ),
				$link = $( link ),

				//remove active link class if external (then it won't be there if you come back)
				httpCleanup = function() {
					window.setTimeout(function() { $.mobile.removeActiveLinkClass( true ); }, 200 );
				},
				baseUrl, href,
				useDefaultUrlHandling, isExternal,
				transition, reverse, role;

			// If a button was clicked, clean up the active class added by vclick above
			if ( $.mobile.activeClickedLink &&
				$.mobile.activeClickedLink[ 0 ] === event.target.parentNode ) {
				httpCleanup();
			}

			// If there is no link associated with the click or its not a left
			// click we want to ignore the click
			// TODO teach $.mobile.hijackable to operate on raw dom elements so the link wrapping
			// can be avoided
			if ( !link || event.which > 1 || !$link.jqmHijackable().length ) {
				return;
			}

			//if there's a data-rel=back attr, go back in history
			if ( $link.is( ":jqmData(rel='back')" ) ) {
				$.mobile.back();
				return false;
			}

			baseUrl = $.mobile.getClosestBaseUrl( $link );

			//get href, if defined, otherwise default to empty hash
			href = $.mobile.path.makeUrlAbsolute( $link.attr( "href" ) || "#", baseUrl );

			//if ajax is disabled, exit early
			if ( !$.mobile.ajaxEnabled && !$.mobile.path.isEmbeddedPage( href ) ) {
				httpCleanup();
				//use default click handling
				return;
			}

			// XXX_jblas: Ideally links to application pages should be specified as
			//            an url to the application document with a hash that is either
			//            the site relative path or id to the page. But some of the
			//            internal code that dynamically generates sub-pages for nested
			//            lists and select dialogs, just write a hash in the link they
			//            create. This means the actual URL path is based on whatever
			//            the current value of the base tag is at the time this code
			//            is called.
			if ( href.search( "#" ) !== -1 &&
				!( $.mobile.path.isExternal( href ) && $.mobile.path.isAbsoluteUrl( href ) ) ) {

				href = href.replace( /[^#]*#/, "" );
				if ( !href ) {
					//link was an empty hash meant purely
					//for interaction, so we ignore it.
					event.preventDefault();
					return;
				} else if ( $.mobile.path.isPath( href ) ) {
					//we have apath so make it the href we want to load.
					href = $.mobile.path.makeUrlAbsolute( href, baseUrl );
				} else {
					//we have a simple id so use the documentUrl as its base.
					href = $.mobile.path.makeUrlAbsolute( "#" + href, documentUrl.hrefNoHash );
				}
			}

			// Should we handle this link, or let the browser deal with it?
			useDefaultUrlHandling = $link.is( "[rel='external']" ) || $link.is( ":jqmData(ajax='false')" ) || $link.is( "[target]" );

			// Some embedded browsers, like the web view in Phone Gap, allow cross-domain XHR
			// requests if the document doing the request was loaded via the file:// protocol.
			// This is usually to allow the application to "phone home" and fetch app specific
			// data. We normally let the browser handle external/cross-domain urls, but if the
			// allowCrossDomainPages option is true, we will allow cross-domain http/https
			// requests to go through our page loading logic.

			//check for protocol or rel and its not an embedded page
			//TODO overlap in logic from isExternal, rel=external check should be
			//     moved into more comprehensive isExternalLink
			isExternal = useDefaultUrlHandling || ( $.mobile.path.isExternal( href ) && !$.mobile.path.isPermittedCrossDomainRequest( documentUrl, href ) );

			if ( isExternal ) {
				httpCleanup();
				//use default click handling
				return;
			}

			//use ajax
			transition = $link.jqmData( "transition" );
			reverse = $link.jqmData( "direction" ) === "reverse" ||
						// deprecated - remove by 1.0
						$link.jqmData( "back" );

			//this may need to be more specific as we use data-rel more
			role = $link.attr( "data-" + $.mobile.ns + "rel" ) || undefined;

			$.mobile.changePage( href, { transition: transition, reverse: reverse, role: role, link: $link } );
			event.preventDefault();
		});

		//prefetch pages when anchors with data-prefetch are encountered
		$.mobile.document.delegate( ".ui-page", "pageshow.prefetch", function() {
			var urls = [];
			$( this ).find( "a:jqmData(prefetch)" ).each(function() {
				var $link = $( this ),
					url = $link.attr( "href" );

				if ( url && $.inArray( url, urls ) === -1 ) {
					urls.push( url );

					$.mobile.loadPage( url, { role: $link.attr( "data-" + $.mobile.ns + "rel" ),prefetch: true } );
				}
			});
		});

		// TODO ensure that the navigate binding in the content widget happens at the right time
		$.mobile.pageContainer.pagecontainer();

		//set page min-heights to be device specific
		$.mobile.document.bind( "pageshow", function() {

			// We need to wait for window.load to make sure that styles have already been rendered,
			// otherwise heights of external toolbars will have the wrong value
			if ( loadDeferred ) {
				loadDeferred.done( $.mobile.resetActivePageHeight );
			} else {
				$.mobile.resetActivePageHeight();
			}
		});
		$.mobile.window.bind( "throttledresize", $.mobile.resetActivePageHeight );

	};//navreadyDeferred done callback

	$( function() { domreadyDeferred.resolve(); } );

	// Account for the possibility that the load event has already fired
	if ( document.readyState === "complete" ) {
		pageIsFullyLoaded();
	} else {
		$.mobile.window.load( pageIsFullyLoaded );
	}

	$.when( domreadyDeferred, $.mobile.navreadyDeferred ).done( function() { $.mobile._registerInternalEvents(); } );
})( jQuery );


(function( $ ) {
	// TODO move loader class down into the widget settings
	var loaderClass = "ui-loader", $html = $( "html" );

	$.widget( "mobile.loader", {
		// NOTE if the global config settings are defined they will override these
		//      options
		options: {
			// the theme for the loading message
			theme: "a",

			// whether the text in the loading message is shown
			textVisible: false,

			// custom html for the inner content of the loading message
			html: "",

			// the text to be displayed when the popup is shown
			text: "loading"
		},

		defaultHtml: "<div class='" + loaderClass + "'>" +
			"<span class='ui-icon-loading'></span>" +
			"<h1></h1>" +
			"</div>",

		// For non-fixed supportin browsers. Position at y center (if scrollTop supported), above the activeBtn (if defined), or just 100px from top
		fakeFixLoader: function() {
			var activeBtn = $( "." + $.mobile.activeBtnClass ).first();

			this.element
				.css({
					top: $.support.scrollTop && this.window.scrollTop() + this.window.height() / 2 ||
						activeBtn.length && activeBtn.offset().top || 100
				});
		},

		// check position of loader to see if it appears to be "fixed" to center
		// if not, use abs positioning
		checkLoaderPosition: function() {
			var offset = this.element.offset(),
				scrollTop = this.window.scrollTop(),
				screenHeight = $.mobile.getScreenHeight();

			if ( offset.top < scrollTop || ( offset.top - scrollTop ) > screenHeight ) {
				this.element.addClass( "ui-loader-fakefix" );
				this.fakeFixLoader();
				this.window
					.unbind( "scroll", this.checkLoaderPosition )
					.bind( "scroll", $.proxy( this.fakeFixLoader, this ) );
			}
		},

		resetHtml: function() {
			this.element.html( $( this.defaultHtml ).html() );
		},

		// Turn on/off page loading message. Theme doubles as an object argument
		// with the following shape: { theme: '', text: '', html: '', textVisible: '' }
		// NOTE that the $.mobile.loading* settings and params past the first are deprecated
		// TODO sweet jesus we need to break some of this out
		show: function( theme, msgText, textonly ) {
			var textVisible, message, loadSettings;

			this.resetHtml();

			// use the prototype options so that people can set them globally at
			// mobile init. Consistency, it's what's for dinner
			if ( $.type( theme ) === "object" ) {
				loadSettings = $.extend( {}, this.options, theme );

				theme = loadSettings.theme;
			} else {
				loadSettings = this.options;

				// here we prefer the theme value passed as a string argument, then
				// we prefer the global option because we can't use undefined default
				// prototype options, then the prototype option
				theme = theme || loadSettings.theme;
			}

			// set the message text, prefer the param, then the settings object
			// then loading message
			message = msgText || ( loadSettings.text === false ? "" : loadSettings.text );

			// prepare the dom
			$html.addClass( "ui-loading" );

			textVisible = loadSettings.textVisible;

			// add the proper css given the options (theme, text, etc)
			// Force text visibility if the second argument was supplied, or
			// if the text was explicitly set in the object args
			this.element.attr("class", loaderClass +
				" ui-corner-all ui-body-" + theme +
				" ui-loader-" + ( textVisible || msgText || theme.text ? "verbose" : "default" ) +
				( loadSettings.textonly || textonly ? " ui-loader-textonly" : "" ) );

			// TODO verify that jquery.fn.html is ok to use in both cases here
			//      this might be overly defensive in preventing unknowing xss
			// if the html attribute is defined on the loading settings, use that
			// otherwise use the fallbacks from above
			if ( loadSettings.html ) {
				this.element.html( loadSettings.html );
			} else {
				this.element.find( "h1" ).text( message );
			}

			// If the pagecontainer widget has been defined we may use the :mobile-pagecontainer
			// and attach to the element on which the pagecontainer widget has been defined. If not,
			// we attach to the body.
			this.element.appendTo( $.mobile.pagecontainer ?
				$( ":mobile-pagecontainer" ) : $( "body" ) );

			// check that the loader is visible
			this.checkLoaderPosition();

			// on scroll check the loader position
			this.window.bind( "scroll", $.proxy( this.checkLoaderPosition, this ) );
		},

		hide: function() {
			$html.removeClass( "ui-loading" );

			if ( this.options.text ) {
				this.element.removeClass( "ui-loader-fakefix" );
			}

			this.window.unbind( "scroll", this.fakeFixLoader );
			this.window.unbind( "scroll", this.checkLoaderPosition );
		}
	});

})(jQuery, this);


(function( $, window, undefined ) {
	var	$html = $( "html" ),
		$window = $.mobile.window;

	//remove initial build class (only present on first pageshow)
	function hideRenderingClass() {
		$html.removeClass( "ui-mobile-rendering" );
	}

	// trigger mobileinit event - useful hook for configuring $.mobile settings before they're used
	$( window.document ).trigger( "mobileinit" );

	// support conditions
	// if device support condition(s) aren't met, leave things as they are -> a basic, usable experience,
	// otherwise, proceed with the enhancements
	if ( !$.mobile.gradeA() ) {
		return;
	}

	// override ajaxEnabled on platforms that have known conflicts with hash history updates
	// or generally work better browsing in regular http for full page refreshes (BB5, Opera Mini)
	if ( $.mobile.ajaxBlacklist ) {
		$.mobile.ajaxEnabled = false;
	}

	// Add mobile, initial load "rendering" classes to docEl
	$html.addClass( "ui-mobile ui-mobile-rendering" );

	// This is a fallback. If anything goes wrong (JS errors, etc), or events don't fire,
	// this ensures the rendering class is removed after 5 seconds, so content is visible and accessible
	setTimeout( hideRenderingClass, 5000 );

	$.extend( $.mobile, {
		// find and enhance the pages in the dom and transition to the first page.
		initializePage: function() {
			// find present pages
			var path = $.mobile.path,
				$pages = $( ":jqmData(role='page'), :jqmData(role='dialog')" ),
				hash = path.stripHash( path.stripQueryParams(path.parseLocation().hash) ),
				theLocation = $.mobile.path.parseLocation(),
				hashPage = hash ? document.getElementById( hash ) : undefined;

			// if no pages are found, create one with body's inner html
			if ( !$pages.length ) {
				$pages = $( "body" ).wrapInner( "<div data-" + $.mobile.ns + "role='page'></div>" ).children( 0 );
			}

			// add dialogs, set data-url attrs
			$pages.each(function() {
				var $this = $( this );

				// unless the data url is already set set it to the pathname
				if ( !$this[ 0 ].getAttribute( "data-" + $.mobile.ns + "url" ) ) {
					$this.attr( "data-" + $.mobile.ns + "url", $this.attr( "id" ) ||
						path.convertUrlToDataUrl( theLocation.pathname + theLocation.search ) );
				}
			});

			// define first page in dom case one backs out to the directory root (not always the first page visited, but defined as fallback)
			$.mobile.firstPage = $pages.first();

			// define page container
			$.mobile.pageContainer = $.mobile.firstPage
				.parent()
				.addClass( "ui-mobile-viewport" )
				.pagecontainer();

			// initialize navigation events now, after mobileinit has occurred and the page container
			// has been created but before the rest of the library is alerted to that fact
			$.mobile.navreadyDeferred.resolve();

			// alert listeners that the pagecontainer has been determined for binding
			// to events triggered on it
			$window.trigger( "pagecontainercreate" );

			// cue page loading message
			$.mobile.loading( "show" );

			//remove initial build class (only present on first pageshow)
			hideRenderingClass();

			// if hashchange listening is disabled, there's no hash deeplink,
			// the hash is not valid (contains more than one # or does not start with #)
			// or there is no page with that hash, change to the first page in the DOM
			// Remember, however, that the hash can also be a path!
			if ( ! ( $.mobile.hashListeningEnabled &&
				$.mobile.path.isHashValid( location.hash ) &&
				( $( hashPage ).is( ":jqmData(role='page')" ) ||
					$.mobile.path.isPath( hash ) ||
					hash === $.mobile.dialogHashKey ) ) ) {

				// make sure to set initial popstate state if it exists
				// so that navigation back to the initial page works properly
				if ( $.event.special.navigate.isPushStateEnabled() ) {
					$.mobile.navigate.navigator.squash( path.parseLocation().href );
				}

				$.mobile.changePage( $.mobile.firstPage, {
					transition: "none",
					reverse: true,
					changeHash: false,
					fromHashChange: true
				});
			} else {
				// trigger hashchange or navigate to squash and record the correct
				// history entry for an initial hash path
				if ( !$.event.special.navigate.isPushStateEnabled() ) {
					$window.trigger( "hashchange", [true] );
				} else {
					// TODO figure out how to simplify this interaction with the initial history entry
					// at the bottom js/navigate/navigate.js
					$.mobile.navigate.history.stack = [];
					$.mobile.navigate( $.mobile.path.isPath( location.hash ) ? location.hash : location.href );
				}
			}
		}
	});

	$(function() {
		//Run inlineSVG support test
		$.support.inlineSVG();

		// check which scrollTop value should be used by scrolling to 1 immediately at domready
		// then check what the scroll top is. Android will report 0... others 1
		// note that this initial scroll won't hide the address bar. It's just for the check.

		// hide iOS browser chrome on load if hideUrlBar is true this is to try and do it as soon as possible
		if ( $.mobile.hideUrlBar ) {
			window.scrollTo( 0, 1 );
		}

		// if defaultHomeScroll hasn't been set yet, see if scrollTop is 1
		// it should be 1 in most browsers, but android treats 1 as 0 (for hiding addr bar)
		// so if it's 1, use 0 from now on
		$.mobile.defaultHomeScroll = ( !$.support.scrollTop || $.mobile.window.scrollTop() === 1 ) ? 0 : 1;

		//dom-ready inits
		if ( $.mobile.autoInitializePage ) {
			$.mobile.initializePage();
		}

		// window load event
		// hide iOS browser chrome on load if hideUrlBar is true this is as fall back incase we were too early before
		if ( $.mobile.hideUrlBar ) {
			$window.load( $.mobile.silentScroll );
		}

		if ( !$.support.cssPointerEvents ) {
			// IE and Opera don't support CSS pointer-events: none that we use to disable link-based buttons
			// by adding the 'ui-disabled' class to them. Using a JavaScript workaround for those browser.
			// https://github.com/jquery/jquery-mobile/issues/3558

			// DEPRECATED as of 1.4.0 - remove ui-disabled after 1.4.0 release
			// only ui-state-disabled should be present thereafter
			$.mobile.document.delegate( ".ui-state-disabled,.ui-disabled", "vclick",
				function( e ) {
					e.preventDefault();
					e.stopImmediatePropagation();
				}
			);
		}
	});
}( jQuery, this ));

(function( $, undefined ) {

$.mobile.links = function( target ) {

	//links within content areas, tests included with page
	$( target )
		.find( "a" )
		.jqmEnhanceable()
		.filter( ":jqmData(rel='popup')[href][href!='']" )
		.each( function() {
			// Accessibility info for popups
			var element = this,
				idref = element.getAttribute( "href" ).substring( 1 );

			if ( idref ) {
				element.setAttribute( "aria-haspopup", true );
				element.setAttribute( "aria-owns", idref );
				element.setAttribute( "aria-expanded", false );
			}
		})
		.end()
		.not( ".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')" )
		.addClass( "ui-link" );

};

})( jQuery );


(function( $ ) {
	var	meta = $( "meta[name=viewport]" ),
		initialContent = meta.attr( "content" ),
		disabledZoom = initialContent + ",maximum-scale=1, user-scalable=no",
		enabledZoom = initialContent + ",maximum-scale=10, user-scalable=yes",
		disabledInitially = /(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test( initialContent );

	$.mobile.zoom = $.extend( {}, {
		enabled: !disabledInitially,
		locked: false,
		disable: function( lock ) {
			if ( !disabledInitially && !$.mobile.zoom.locked ) {
				meta.attr( "content", disabledZoom );
				$.mobile.zoom.enabled = false;
				$.mobile.zoom.locked = lock || false;
			}
		},
		enable: function( unlock ) {
			if ( !disabledInitially && ( !$.mobile.zoom.locked || unlock === true ) ) {
				meta.attr( "content", enabledZoom );
				$.mobile.zoom.enabled = true;
				$.mobile.zoom.locked = false;
			}
		},
		restore: function() {
			if ( !disabledInitially ) {
				meta.attr( "content", initialContent );
				$.mobile.zoom.enabled = true;
			}
		}
	});

}( jQuery ));

(function( $, undefined ) {

var uiScreenHiddenRegex = /\bui-screen-hidden\b/;
function noHiddenClass( elements ) {
	var index,
		length = elements.length,
		result = [];

	for ( index = 0; index < length; index++ ) {
		if ( !elements[ index ].className.match( uiScreenHiddenRegex ) ) {
			result.push( elements[ index ] );
		}
	}

	return $( result );
}

$.mobile.behaviors.addFirstLastClasses = {
	_getVisibles: function( $els, create ) {
		var visibles;

		if ( create ) {
			visibles = noHiddenClass( $els );
		} else {
			visibles = $els.filter( ":visible" );
			if ( visibles.length === 0 ) {
				visibles = noHiddenClass( $els );
			}
		}

		return visibles;
	},

	_addFirstLastClasses: function( $els, $visibles, create ) {
		$els.removeClass( "ui-first-child ui-last-child" );
		$visibles.eq( 0 ).addClass( "ui-first-child" ).end().last().addClass( "ui-last-child" );
		if ( !create ) {
			this.element.trigger( "updatelayout" );
		}
	},

	_removeFirstLastClasses: function( $els ) {
		$els.removeClass( "ui-first-child ui-last-child" );
	}
};

})( jQuery );

(function( $, undefined ) {

var rInitialLetter = /([A-Z])/g,

	// Construct iconpos class from iconpos value
	iconposClass = function( iconpos ) {
		return ( "ui-btn-icon-" + ( iconpos === null ? "left" : iconpos ) );
	};

$.widget( "mobile.collapsible", {
	options: {
		enhanced: false,
		expandCueText: null,
		collapseCueText: null,
		collapsed: true,
		heading: "h1,h2,h3,h4,h5,h6,legend",
		collapsedIcon: null,
		expandedIcon: null,
		iconpos: null,
		theme: null,
		contentTheme: null,
		inset: null,
		corners: null,
		mini: null
	},

	_create: function() {
		var elem = this.element,
			ui = {
				accordion: elem
					.closest( ":jqmData(role='collapsible-set')," +
						":jqmData(role='collapsibleset')" +
						( $.mobile.collapsibleset ? ", :mobile-collapsibleset" :
							"" ) )
					.addClass( "ui-collapsible-set" )
			};

		this._ui = ui;
		this._renderedOptions = this._getOptions( this.options );

		if ( this.options.enhanced ) {
			ui.heading = this.element.children( ".ui-collapsible-heading" );
			ui.content = ui.heading.next();
			ui.anchor = ui.heading.children();
			ui.status = ui.anchor.children( ".ui-collapsible-heading-status" );
		} else {
			this._enhance( elem, ui );
		}

		this._on( ui.heading, {
			"tap": function() {
				ui.heading.find( "a" ).first().addClass( $.mobile.activeBtnClass );
			},

			"click": function( event ) {
				this._handleExpandCollapse( !ui.heading.hasClass( "ui-collapsible-heading-collapsed" ) );
				event.preventDefault();
				event.stopPropagation();
			}
		});
	},

	// Adjust the keys inside options for inherited values
	_getOptions: function( options ) {
		var key,
			accordion = this._ui.accordion,
			accordionWidget = this._ui.accordionWidget;

		// Copy options
		options = $.extend( {}, options );

		if ( accordion.length && !accordionWidget ) {
			this._ui.accordionWidget =
			accordionWidget = accordion.data( "mobile-collapsibleset" );
		}

		for ( key in options ) {

			// Retrieve the option value first from the options object passed in and, if
			// null, from the parent accordion or, if that's null too, or if there's no
			// parent accordion, then from the defaults.
			options[ key ] =
				( options[ key ] != null ) ? options[ key ] :
				( accordionWidget ) ? accordionWidget.options[ key ] :
				accordion.length ? $.mobile.getAttribute( accordion[ 0 ],
					key.replace( rInitialLetter, "-$1" ).toLowerCase() ):
				null;

			if ( null == options[ key ] ) {
				options[ key ] = $.mobile.collapsible.defaults[ key ];
			}
		}

		return options;
	},

	_themeClassFromOption: function( prefix, value ) {
		return ( value ? ( value === "none" ? "" : prefix + value ) : "" );
	},

	_enhance: function( elem, ui ) {
		var iconclass,
			opts = this._renderedOptions,
			contentThemeClass = this._themeClassFromOption( "ui-body-", opts.contentTheme );

		elem.addClass( "ui-collapsible " +
			( opts.inset ? "ui-collapsible-inset " : "" ) +
			( opts.inset && opts.corners ? "ui-corner-all " : "" ) +
			( contentThemeClass ? "ui-collapsible-themed-content " : "" ) );
		ui.originalHeading = elem.children( this.options.heading ).first(),
		ui.content = elem
			.wrapInner( "<div " +
				"class='ui-collapsible-content " +
				contentThemeClass + "'></div>" )
			.children( ".ui-collapsible-content" ),
		ui.heading = ui.originalHeading;

		// Replace collapsibleHeading if it's a legend
		if ( ui.heading.is( "legend" ) ) {
			ui.heading = $( "<div role='heading'>"+ ui.heading.html() +"</div>" );
			ui.placeholder = $( "<div><!-- placeholder for legend --></div>" ).insertBefore( ui.originalHeading );
			ui.originalHeading.remove();
		}

		iconclass = ( opts.collapsed ? ( opts.collapsedIcon ? "ui-icon-" + opts.collapsedIcon : "" ):
			( opts.expandedIcon ? "ui-icon-" + opts.expandedIcon : "" ) );

		ui.status = $( "<span class='ui-collapsible-heading-status'></span>" );
		ui.anchor = ui.heading
			.detach()
			//modify markup & attributes
			.addClass( "ui-collapsible-heading" )
			.append( ui.status )
			.wrapInner( "<a href='#' class='ui-collapsible-heading-toggle'></a>" )
			.find( "a" )
				.first()
				.addClass( "ui-btn " +
					( iconclass ? iconclass + " " : "" ) +
					( iconclass ? iconposClass( opts.iconpos ) +
						" " : "" ) +
					this._themeClassFromOption( "ui-btn-", opts.theme ) + " " +
					( opts.mini ? "ui-mini " : "" ) );

		//drop heading in before content
		ui.heading.insertBefore( ui.content );

		this._handleExpandCollapse( this.options.collapsed );

		return ui;
	},

	refresh: function() {
		this._applyOptions( this.options );
		this._renderedOptions = this._getOptions( this.options );
	},

	_applyOptions: function( options ) {
		var isCollapsed, newTheme, oldTheme, hasCorners, hasIcon,
			elem = this.element,
			currentOpts = this._renderedOptions,
			ui = this._ui,
			anchor = ui.anchor,
			status = ui.status,
			opts = this._getOptions( options );

		// First and foremost we need to make sure the collapsible is in the proper
		// state, in case somebody decided to change the collapsed option at the
		// same time as another option
		if ( options.collapsed !== undefined ) {
			this._handleExpandCollapse( options.collapsed );
		}

		isCollapsed = elem.hasClass( "ui-collapsible-collapsed" );

		// We only need to apply the cue text for the current state right away.
		// The cue text for the alternate state will be stored in the options
		// and applied the next time the collapsible's state is toggled
		if ( isCollapsed ) {
			if ( opts.expandCueText !== undefined ) {
				status.text( opts.expandCueText );
			}
		} else {
			if ( opts.collapseCueText !== undefined ) {
				status.text( opts.collapseCueText );
			}
		}

		// Update icon

		// Is it supposed to have an icon?
		hasIcon =

			// If the collapsedIcon is being set, consult that
			( opts.collapsedIcon !== undefined ? opts.collapsedIcon !== false :

				// Otherwise consult the existing option value
				currentOpts.collapsedIcon !== false );


		// If any icon-related options have changed, make sure the new icon
		// state is reflected by first removing all icon-related classes
		// reflecting the current state and then adding all icon-related
		// classes for the new state
		if ( !( opts.iconpos === undefined &&
			opts.collapsedIcon === undefined &&
			opts.expandedIcon === undefined ) ) {

			// Remove all current icon-related classes
			anchor.removeClass( [ iconposClass( currentOpts.iconpos ) ]
				.concat( ( currentOpts.expandedIcon ?
					[ "ui-icon-" + currentOpts.expandedIcon ] : [] ) )
				.concat( ( currentOpts.collapsedIcon ?
					[ "ui-icon-" + currentOpts.collapsedIcon ] : [] ) )
				.join( " " ) );

			// Add new classes if an icon is supposed to be present
			if ( hasIcon ) {
				anchor.addClass(
					[ iconposClass( opts.iconpos !== undefined ?
						opts.iconpos : currentOpts.iconpos ) ]
						.concat( isCollapsed ?
							[ "ui-icon-" + ( opts.collapsedIcon !== undefined ?
								opts.collapsedIcon :
								currentOpts.collapsedIcon ) ] :
							[ "ui-icon-" + ( opts.expandedIcon !== undefined ?
								opts.expandedIcon :
								currentOpts.expandedIcon ) ] )
						.join( " " ) );
			}
		}

		if ( opts.theme !== undefined ) {
			oldTheme = this._themeClassFromOption( "ui-btn-", currentOpts.theme );
			newTheme = this._themeClassFromOption( "ui-btn-", opts.theme );
			anchor.removeClass( oldTheme ).addClass( newTheme );
		}

		if ( opts.contentTheme !== undefined ) {
			oldTheme = this._themeClassFromOption( "ui-body-",
				currentOpts.contentTheme );
			newTheme = this._themeClassFromOption( "ui-body-",
				opts.contentTheme );
			ui.content.removeClass( oldTheme ).addClass( newTheme );
		}

		if ( opts.inset !== undefined ) {
			elem.toggleClass( "ui-collapsible-inset", opts.inset );
			hasCorners = !!( opts.inset && ( opts.corners || currentOpts.corners ) );
		}

		if ( opts.corners !== undefined ) {
			hasCorners = !!( opts.corners && ( opts.inset || currentOpts.inset ) );
		}

		if ( hasCorners !== undefined ) {
			elem.toggleClass( "ui-corner-all", hasCorners );
		}

		if ( opts.mini !== undefined ) {
			anchor.toggleClass( "ui-mini", opts.mini );
		}
	},

	_setOptions: function( options ) {
		this._applyOptions( options );
		this._super( options );
		this._renderedOptions = this._getOptions( this.options );
	},

	_handleExpandCollapse: function( isCollapse ) {
		var opts = this._renderedOptions,
			ui = this._ui;

		ui.status.text( isCollapse ? opts.expandCueText : opts.collapseCueText );
		ui.heading
			.toggleClass( "ui-collapsible-heading-collapsed", isCollapse )
			.find( "a" ).first()
			.toggleClass( "ui-icon-" + opts.expandedIcon, !isCollapse )

			// logic or cause same icon for expanded/collapsed state would remove the ui-icon-class
			.toggleClass( "ui-icon-" + opts.collapsedIcon, ( isCollapse || opts.expandedIcon === opts.collapsedIcon ) )
			.removeClass( $.mobile.activeBtnClass );

		this.element.toggleClass( "ui-collapsible-collapsed", isCollapse );
		ui.content
			.toggleClass( "ui-collapsible-content-collapsed", isCollapse )
			.attr( "aria-hidden", isCollapse )
			.trigger( "updatelayout" );
		this.options.collapsed = isCollapse;
		this._trigger( isCollapse ? "collapse" : "expand" );
	},

	expand: function() {
		this._handleExpandCollapse( false );
	},

	collapse: function() {
		this._handleExpandCollapse( true );
	},

	_destroy: function() {
		var ui = this._ui,
			opts = this.options;

		if ( opts.enhanced ) {
			return;
		}

		if ( ui.placeholder ) {
			ui.originalHeading.insertBefore( ui.placeholder );
			ui.placeholder.remove();
			ui.heading.remove();
		} else {
			ui.status.remove();
			ui.heading
				.removeClass( "ui-collapsible-heading ui-collapsible-heading-collapsed" )
				.children()
					.contents()
						.unwrap();
		}

		ui.anchor.contents().unwrap();
		ui.content.contents().unwrap();
		this.element
			.removeClass( "ui-collapsible ui-collapsible-collapsed " +
				"ui-collapsible-themed-content ui-collapsible-inset ui-corner-all" );
	}
});

// Defaults to be used by all instances of collapsible if per-instance values
// are unset or if nothing is specified by way of inheritance from an accordion.
// Note that this hash does not contain options "collapsed" or "heading",
// because those are not inheritable.
$.mobile.collapsible.defaults = {
	expandCueText: " click to expand contents",
	collapseCueText: " click to collapse contents",
	collapsedIcon: "plus",
	contentTheme: "inherit",
	expandedIcon: "minus",
	iconpos: "left",
	inset: true,
	corners: true,
	theme: "inherit",
	mini: false
};

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.controlgroup", $.extend( {
	options: {
		enhanced: false,
		theme: null,
		shadow: false,
		corners: true,
		excludeInvisible: true,
		type: "vertical",
		mini: false
	},

	_create: function() {
		var elem = this.element,
			opts = this.options,
			keepNative = $.mobile.page.prototype.keepNativeSelector();

		// Run buttonmarkup
		if ( $.fn.buttonMarkup ) {
			this.element
				.find( $.fn.buttonMarkup.initSelector )
				.not( keepNative )
				.buttonMarkup();
		}
		// Enhance child widgets
		$.each( this._childWidgets, $.proxy( function( number, widgetName ) {
			if ( $.mobile[ widgetName ] ) {
				this.element
					.find( $.mobile[ widgetName ].initSelector )
					.not( keepNative )[ widgetName ]();
			}
		}, this ));

		$.extend( this, {
			_ui: null,
			_initialRefresh: true
		});

		if ( opts.enhanced ) {
			this._ui = {
				groupLegend: elem.children( ".ui-controlgroup-label" ).children(),
				childWrapper: elem.children( ".ui-controlgroup-controls" )
			};
		} else {
			this._ui = this._enhance();
		}

	},

	_childWidgets: [ "checkboxradio", "selectmenu", "button" ],

	_themeClassFromOption: function( value ) {
		return ( value ? ( value === "none" ? "" : "ui-group-theme-" + value ) : "" );
	},

	_enhance: function() {
		var elem = this.element,
			opts = this.options,
			ui = {
				groupLegend: elem.children( "legend" ),
				childWrapper: elem
					.addClass( "ui-controlgroup " +
						"ui-controlgroup-" +
							( opts.type === "horizontal" ? "horizontal" : "vertical" ) + " " +
						this._themeClassFromOption( opts.theme ) + " " +
						( opts.corners ? "ui-corner-all " : "" ) +
						( opts.mini ? "ui-mini " : "" ) )
					.wrapInner( "<div " +
						"class='ui-controlgroup-controls " +
							( opts.shadow === true ? "ui-shadow" : "" ) + "'></div>" )
					.children()
			};

		if ( ui.groupLegend.length > 0 ) {
			$( "<div role='heading' class='ui-controlgroup-label'></div>" )
				.append( ui.groupLegend )
				.prependTo( elem );
		}

		return ui;
	},

	_init: function() {
		this.refresh();
	},

	_setOptions: function( options ) {
		var callRefresh, returnValue,
			elem = this.element;

		// Must have one of horizontal or vertical
		if ( options.type !== undefined ) {
			elem
				.removeClass( "ui-controlgroup-horizontal ui-controlgroup-vertical" )
				.addClass( "ui-controlgroup-" + ( options.type === "horizontal" ? "horizontal" : "vertical" ) );
			callRefresh = true;
		}

		if ( options.theme !== undefined ) {
			elem
				.removeClass( this._themeClassFromOption( this.options.theme ) )
				.addClass( this._themeClassFromOption( options.theme ) );
		}

		if ( options.corners !== undefined ) {
			elem.toggleClass( "ui-corner-all", options.corners );
		}

		if ( options.mini !== undefined ) {
			elem.toggleClass( "ui-mini", options.mini );
		}

		if ( options.shadow !== undefined ) {
			this._ui.childWrapper.toggleClass( "ui-shadow", options.shadow );
		}

		if ( options.excludeInvisible !== undefined ) {
			this.options.excludeInvisible = options.excludeInvisible;
			callRefresh = true;
		}

		returnValue = this._super( options );

		if ( callRefresh ) {
			this.refresh();
		}

		return returnValue;
	},

	container: function() {
		return this._ui.childWrapper;
	},

	refresh: function() {
		var $el = this.container(),
			els = $el.find( ".ui-btn" ).not( ".ui-slider-handle" ),
			create = this._initialRefresh;
		if ( $.mobile.checkboxradio ) {
			$el.find( ":mobile-checkboxradio" ).checkboxradio( "refresh" );
		}
		this._addFirstLastClasses( els,
			this.options.excludeInvisible ? this._getVisibles( els, create ) : els,
			create );
		this._initialRefresh = false;
	},

	// Caveat: If the legend is not the first child of the controlgroup at enhance
	// time, it will be after _destroy().
	_destroy: function() {
		var ui, buttons,
			opts = this.options;

		if ( opts.enhanced ) {
			return this;
		}

		ui = this._ui;
		buttons = this.element
			.removeClass( "ui-controlgroup " +
				"ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini " +
				this._themeClassFromOption( opts.theme ) )
			.find( ".ui-btn" )
			.not( ".ui-slider-handle" );

		this._removeFirstLastClasses( buttons );

		ui.groupLegend.unwrap();
		ui.childWrapper.children().unwrap();
	}
}, $.mobile.behaviors.addFirstLastClasses ) );

})(jQuery);

(function( $, undefined ) {

$.widget( "mobile.textinput", {
	initSelector: "input[type='text']," +
		"input[type='search']," +
		":jqmData(type='search')," +
		"input[type='number']," +
		":jqmData(type='number')," +
		"input[type='password']," +
		"input[type='email']," +
		"input[type='url']," +
		"input[type='tel']," +
		"textarea," +
		"input[type='time']," +
		"input[type='date']," +
		"input[type='month']," +
		"input[type='week']," +
		"input[type='datetime']," +
		"input[type='datetime-local']," +
		"input[type='color']," +
		"input:not([type])," +
		"input[type='file']",

	options: {
		theme: null,
		corners: true,
		mini: false,
		// This option defaults to true on iOS devices.
		preventFocusZoom: /iPhone|iPad|iPod/.test( navigator.platform ) && navigator.userAgent.indexOf( "AppleWebKit" ) > -1,
		wrapperClass: "",
		enhanced: false
	},

	_create: function() {

		var options = this.options,
			isSearch = this.element.is( "[type='search'], :jqmData(type='search')" ),
			isTextarea = this.element[ 0 ].tagName === "TEXTAREA",
			isRange = this.element.is( "[data-" + ( $.mobile.ns || "" ) + "type='range']" ),
			inputNeedsWrap = ( (this.element.is( "input" ) ||
				this.element.is( "[data-" + ( $.mobile.ns || "" ) + "type='search']" ) ) &&
					!isRange );

		if ( this.element.prop( "disabled" ) ) {
			options.disabled = true;
		}

		$.extend( this, {
			classes: this._classesFromOptions(),
			isSearch: isSearch,
			isTextarea: isTextarea,
			isRange: isRange,
			inputNeedsWrap: inputNeedsWrap
		});

		this._autoCorrect();

		if ( !options.enhanced ) {
			this._enhance();
		}

		this._on( {
			"focus": "_handleFocus",
			"blur": "_handleBlur"
		});

	},

	refresh: function() {
		this.setOptions({
			"disabled" : this.element.is( ":disabled" )
		});
	},

	_enhance: function() {
		var elementClasses = [];

		if ( this.isTextarea ) {
			elementClasses.push( "ui-input-text" );
		}

		if ( this.isTextarea || this.isRange ) {
			elementClasses.push( "ui-shadow-inset" );
		}

		//"search" and "text" input widgets
		if ( this.inputNeedsWrap ) {
			this.element.wrap( this._wrap() );
		} else {
			elementClasses = elementClasses.concat( this.classes );
		}

		this.element.addClass( elementClasses.join( " " ) );
	},

	widget: function() {
		return ( this.inputNeedsWrap ) ? this.element.parent() : this.element;
	},

	_classesFromOptions: function() {
		var options = this.options,
			classes = [];

		classes.push( "ui-body-" + ( ( options.theme === null ) ? "inherit" : options.theme ) );
		if ( options.corners ) {
			classes.push( "ui-corner-all" );
		}
		if ( options.mini ) {
			classes.push( "ui-mini" );
		}
		if ( options.disabled ) {
			classes.push( "ui-state-disabled" );
		}
		if ( options.wrapperClass ) {
			classes.push( options.wrapperClass );
		}

		return classes;
	},

	_wrap: function() {
		return $( "<div class='" +
			( this.isSearch ? "ui-input-search " : "ui-input-text " ) +
			this.classes.join( " " ) + " " +
			"ui-shadow-inset'></div>" );
	},

	_autoCorrect: function() {
		// XXX: Temporary workaround for issue 785 (Apple bug 8910589).
		//      Turn off autocorrect and autocomplete on non-iOS 5 devices
		//      since the popup they use can't be dismissed by the user. Note
		//      that we test for the presence of the feature by looking for
		//      the autocorrect property on the input element. We currently
		//      have no test for iOS 5 or newer so we're temporarily using
		//      the touchOverflow support flag for jQM 1.0. Yes, I feel dirty.
		//      - jblas
		if ( typeof this.element[0].autocorrect !== "undefined" &&
			!$.support.touchOverflow ) {

			// Set the attribute instead of the property just in case there
			// is code that attempts to make modifications via HTML.
			this.element[0].setAttribute( "autocorrect", "off" );
			this.element[0].setAttribute( "autocomplete", "off" );
		}
	},

	_handleBlur: function() {
		this.widget().removeClass( $.mobile.focusClass );
		if ( this.options.preventFocusZoom ) {
			$.mobile.zoom.enable( true );
		}
	},

	_handleFocus: function() {
		// In many situations, iOS will zoom into the input upon tap, this
		// prevents that from happening
		if ( this.options.preventFocusZoom ) {
			$.mobile.zoom.disable( true );
		}
		this.widget().addClass( $.mobile.focusClass );
	},

	_setOptions: function ( options ) {
		var outer = this.widget();

		this._super( options );

		if ( !( options.disabled === undefined &&
			options.mini === undefined &&
			options.corners === undefined &&
			options.theme === undefined &&
			options.wrapperClass === undefined ) ) {

			outer.removeClass( this.classes.join( " " ) );
			this.classes = this._classesFromOptions();
			outer.addClass( this.classes.join( " " ) );
		}

		if ( options.disabled !== undefined ) {
			this.element.prop( "disabled", !!options.disabled );
		}
	},

	_destroy: function() {
		if ( this.options.enhanced ) {
			return;
		}
		if ( this.inputNeedsWrap ) {
			this.element.unwrap();
		}
		this.element.removeClass( "ui-input-text " + this.classes.join( " " ) );
	}
});

})( jQuery );

(function( $, undefined ) {

	$.widget( "mobile.textinput", $.mobile.textinput, {
		options: {
			autogrow:true,
			keyupTimeoutBuffer: 100
		},

		_create: function() {
			this._super();

			if ( this.options.autogrow && this.isTextarea ) {
				this._autogrow();
			}
		},

		_autogrow: function() {
			this.element.addClass( "ui-textinput-autogrow" );

			this._on({
				"keyup": "_timeout",
				"change": "_timeout",
				"input": "_timeout",
				"paste": "_timeout"
			});

			// Attach to the various you-have-become-visible notifications that the
			// various framework elements emit.
			// TODO: Remove all but the updatelayout handler once #6426 is fixed.
			this._on( true, this.document, {

				// TODO: Move to non-deprecated event
				"pageshow": "_handleShow",
				"popupbeforeposition": "_handleShow",
				"updatelayout": "_handleShow",
				"panelopen": "_handleShow"
			});
		},

		// Synchronously fix the widget height if this widget's parents are such
		// that they show/hide content at runtime. We still need to check whether
		// the widget is actually visible in case it is contained inside multiple
		// such containers. For example: panel contains collapsible contains
		// autogrow textinput. The panel may emit "panelopen" indicating that its
		// content has become visible, but the collapsible is still collapsed, so
		// the autogrow textarea is still not visible.
		_handleShow: function( event ) {
			if ( $.contains( event.target, this.element[ 0 ] ) &&
				this.element.is( ":visible" ) ) {

				if ( event.type !== "popupbeforeposition" ) {
					this.element
						.addClass( "ui-textinput-autogrow-resize" )
						.animationComplete(
							$.proxy( function() {
								this.element.removeClass( "ui-textinput-autogrow-resize" );
							}, this ),
						"transition" );
				}
				this._prepareHeightUpdate();
			}
		},

		_unbindAutogrow: function() {
			this.element.removeClass( "ui-textinput-autogrow" );
			this._off( this.element, "keyup change input paste" );
			this._off( this.document,
				"pageshow popupbeforeposition updatelayout panelopen" );
		},

		keyupTimeout: null,

		_prepareHeightUpdate: function( delay ) {
			if ( this.keyupTimeout ) {
				clearTimeout( this.keyupTimeout );
			}
			if ( delay === undefined ) {
				this._updateHeight();
			} else {
				this.keyupTimeout = this._delay( "_updateHeight", delay );
			}
		},

		_timeout: function() {
			this._prepareHeightUpdate( this.options.keyupTimeoutBuffer );
		},

		_updateHeight: function() {
			var paddingTop, paddingBottom, paddingHeight, scrollHeight, clientHeight,
				borderTop, borderBottom, borderHeight, height,
				scrollTop = this.window.scrollTop();
			this.keyupTimeout = 0;

			// IE8 textareas have the onpage property - others do not
			if ( !( "onpage" in this.element[ 0 ] ) ) {
				this.element.css({
					"height": 0,
					"min-height": 0,
					"max-height": 0
				});
			}

			scrollHeight = this.element[ 0 ].scrollHeight;
			clientHeight = this.element[ 0 ].clientHeight;
			borderTop = parseFloat( this.element.css( "border-top-width" ) );
			borderBottom = parseFloat( this.element.css( "border-bottom-width" ) );
			borderHeight = borderTop + borderBottom;
			height = scrollHeight + borderHeight + 15;

			// Issue 6179: Padding is not included in scrollHeight and
			// clientHeight by Firefox if no scrollbar is visible. Because
			// textareas use the border-box box-sizing model, padding should be
			// included in the new (assigned) height. Because the height is set
			// to 0, clientHeight == 0 in Firefox. Therefore, we can use this to
			// check if padding must be added.
			if ( clientHeight === 0 ) {
				paddingTop = parseFloat( this.element.css( "padding-top" ) );
				paddingBottom = parseFloat( this.element.css( "padding-bottom" ) );
				paddingHeight = paddingTop + paddingBottom;

				height += paddingHeight;
			}

			this.element.css({
				"height": height,
				"min-height": "",
				"max-height": ""
			});

			this.window.scrollTop( scrollTop );
		},

		refresh: function() {
			if ( this.options.autogrow && this.isTextarea ) {
				this._updateHeight();
			}
		},

		_setOptions: function( options ) {

			this._super( options );

			if ( options.autogrow !== undefined && this.isTextarea ) {
				if ( options.autogrow ) {
					this._autogrow();
				} else {
					this._unbindAutogrow();
				}
			}
		}

	});
})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.button", {

	initSelector: "input[type='button'], input[type='submit'], input[type='reset']",

	options: {
		theme: null,
		icon: null,
		iconpos: "left",
		iconshadow: false, /* TODO: Deprecated in 1.4, remove in 1.5. */
		corners: true,
		shadow: true,
		inline: null,
		mini: null,
		wrapperClass: null,
		enhanced: false
	},

	_create: function() {

		if ( this.element.is( ":disabled" ) ) {
			this.options.disabled = true;
		}

		if ( !this.options.enhanced ) {
			this._enhance();
		}

		$.extend( this, {
			wrapper: this.element.parent()
		});

		this._on( {
			focus: function() {
				this.widget().addClass( $.mobile.focusClass );
			},

			blur: function() {
				this.widget().removeClass( $.mobile.focusClass );
			}
		});

		this.refresh( true );
	},

	_enhance: function() {
		this.element.wrap( this._button() );
	},

	_button: function() {
		var options = this.options,
			iconClasses = this._getIconClasses( this.options );

		return $("<div class='ui-btn ui-input-btn" +
			( options.wrapperClass ? " " + options.wrapperClass : "" ) +
			( options.theme ? " ui-btn-" + options.theme : "" ) +
			( options.corners ? " ui-corner-all" : "" ) +
			( options.shadow ? " ui-shadow" : "" ) +
			( options.inline ? " ui-btn-inline" : "" ) +
			( options.mini ? " ui-mini" : "" ) +
			( options.disabled ? " ui-state-disabled" : "" ) +
			( iconClasses ? ( " " + iconClasses ) : "" ) +
			"' >" + this.element.val() + "</div>" );
	},

	widget: function() {
		return this.wrapper;
	},

	_destroy: function() {
			this.element.insertBefore( this.wrapper );
			this.wrapper.remove();
	},

	_getIconClasses: function( options ) {
		return ( options.icon ? ( "ui-icon-" + options.icon +
			( options.iconshadow ? " ui-shadow-icon" : "" ) + /* TODO: Deprecated in 1.4, remove in 1.5. */
			" ui-btn-icon-" + options.iconpos ) : "" );
	},

	_setOptions: function( options ) {
		var outer = this.widget();

		if ( options.theme !== undefined ) {
			outer
				.removeClass( this.options.theme )
				.addClass( "ui-btn-" + options.theme );
		}
		if ( options.corners !== undefined ) {
			outer.toggleClass( "ui-corner-all", options.corners );
		}
		if ( options.shadow !== undefined ) {
			outer.toggleClass( "ui-shadow", options.shadow );
		}
		if ( options.inline !== undefined ) {
			outer.toggleClass( "ui-btn-inline", options.inline );
		}
		if ( options.mini !== undefined ) {
			outer.toggleClass( "ui-mini", options.mini );
		}
		if ( options.disabled !== undefined ) {
			this.element.prop( "disabled", options.disabled );
			outer.toggleClass( "ui-state-disabled", options.disabled );
		}

		if ( options.icon !== undefined ||
				options.iconshadow !== undefined || /* TODO: Deprecated in 1.4, remove in 1.5. */
				options.iconpos !== undefined ) {
			outer
				.removeClass( this._getIconClasses( this.options ) )
				.addClass( this._getIconClasses(
					$.extend( {}, this.options, options ) ) );
		}

		this._super( options );
	},

	refresh: function( create ) {
		var originalElement,
			isDisabled = this.element.prop( "disabled" );

		if ( this.options.icon && this.options.iconpos === "notext" && this.element.attr( "title" ) ) {
			this.element.attr( "title", this.element.val() );
		}
		if ( !create ) {
			originalElement = this.element.detach();
			$( this.wrapper ).text( this.element.val() ).append( originalElement );
		}
		if ( this.options.disabled !== isDisabled ) {
			this._setOptions({ disabled: isDisabled });
		}
	}
});

})( jQuery );

(function( $, undefined ) {

$.mobile.behaviors.formReset = {
	_handleFormReset: function() {
		this._on( this.element.closest( "form" ), {
			reset: function() {
				this._delay( "_reset" );
			}
		});
	}
};

})( jQuery );

/*
* "checkboxradio" plugin
*/

(function( $, undefined ) {

var escapeId = $.mobile.path.hashToSelector;

$.widget( "mobile.checkboxradio", $.extend( {

	initSelector: "input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",

	options: {
		theme: "inherit",
		mini: false,
		wrapperClass: null,
		enhanced: false,
		iconpos: "left"

	},
	_create: function() {
		var input = this.element,
			o = this.options,
			inheritAttr = function( input, dataAttr ) {
				return input.jqmData( dataAttr ) ||
					input.closest( "form, fieldset" ).jqmData( dataAttr );
			},
			label = this.options.enhanced ?
				{
					element: this.element.siblings( "label" ),
					isParent: false
				} :
				this._findLabel(),
			inputtype = input[0].type,
			checkedClass = "ui-" + inputtype + "-on",
			uncheckedClass = "ui-" + inputtype + "-off";

		if ( inputtype !== "checkbox" && inputtype !== "radio" ) {
			return;
		}

		if ( this.element[0].disabled ) {
			this.options.disabled = true;
		}

		o.iconpos = inheritAttr( input, "iconpos" ) ||
			label.element.attr( "data-" + $.mobile.ns + "iconpos" ) || o.iconpos,

		// Establish options
		o.mini = inheritAttr( input, "mini" ) || o.mini;

		// Expose for other methods
		$.extend( this, {
			input: input,
			label: label.element,
			labelIsParent: label.isParent,
			inputtype: inputtype,
			checkedClass: checkedClass,
			uncheckedClass: uncheckedClass
		});

		if ( !this.options.enhanced ) {
			this._enhance();
		}

		this._on( label.element, {
			vmouseover: "_handleLabelVMouseOver",
			vclick: "_handleLabelVClick"
		});

		this._on( input, {
			vmousedown: "_cacheVals",
			vclick: "_handleInputVClick",
			focus: "_handleInputFocus",
			blur: "_handleInputBlur"
		});

		this._handleFormReset();
		this.refresh();
	},

	_findLabel: function() {
		var parentLabel, label, isParent,
			input = this.element,
			labelsList = input[ 0 ].labels;

		if( labelsList && labelsList.length > 0 ) {
			label = $( labelsList[ 0 ] );
			isParent = $.contains( label[ 0 ], input[ 0 ] );
		} else {
			parentLabel = input.closest( "label" );
			isParent = ( parentLabel.length > 0 );

			// NOTE: Windows Phone could not find the label through a selector
			// filter works though.
			label = isParent ? parentLabel :
				$( this.document[ 0 ].getElementsByTagName( "label" ) )
					.filter( "[for='" + escapeId( input[ 0 ].id ) + "']" )
					.first();
		}

		return {
			element: label,
			isParent: isParent
		};
	},

	_enhance: function() {
		this.label.addClass( "ui-btn ui-corner-all");

		if ( this.labelIsParent ) {
			this.input.add( this.label ).wrapAll( this._wrapper() );
		} else {
			//this.element.replaceWith( this.input.add( this.label ).wrapAll( this._wrapper() ) );
			this.element.wrap( this._wrapper() );
			this.element.parent().prepend( this.label );
		}

		// Wrap the input + label in a div

		this._setOptions({
			"theme": this.options.theme,
			"iconpos": this.options.iconpos,
			"mini": this.options.mini
		});

	},

	_wrapper: function() {
		return $( "<div class='"  +
			( this.options.wrapperClass ? this.options.wrapperClass : "" ) +
			" ui-" + this.inputtype +
			( this.options.disabled ? " ui-state-disabled" : "" ) + "' ></div>" );
	},

	_handleInputFocus: function() {
		this.label.addClass( $.mobile.focusClass );
	},

	_handleInputBlur: function() {
		this.label.removeClass( $.mobile.focusClass );
	},

	_handleInputVClick: function() {
		// Adds checked attribute to checked input when keyboard is used
		this.element.prop( "checked", this.element.is( ":checked" ) );
		this._getInputSet().not( this.element ).prop( "checked", false );
		this._updateAll( true );
	},

	_handleLabelVMouseOver: function( event ) {
		if ( this.label.parent().hasClass( "ui-state-disabled" ) ) {
			event.stopPropagation();
		}
	},

	_handleLabelVClick: function( event ) {
		var input = this.element;

		if ( input.is( ":disabled" ) ) {
			event.preventDefault();
			return;
		}

		this._cacheVals();

		input.prop( "checked", this.inputtype === "radio" && true || !input.prop( "checked" ) );

		// trigger click handler's bound directly to the input as a substitute for
		// how label clicks behave normally in the browsers
		// TODO: it would be nice to let the browser's handle the clicks and pass them
		//       through to the associate input. we can swallow that click at the parent
		//       wrapper element level
		input.triggerHandler( "click" );

		// Input set for common radio buttons will contain all the radio
		// buttons, but will not for checkboxes. clearing the checked status
		// of other radios ensures the active button state is applied properly
		this._getInputSet().not( input ).prop( "checked", false );

		this._updateAll();
		return false;
	},

	_cacheVals: function() {
		this._getInputSet().each( function() {
			$( this ).attr("data-" + $.mobile.ns + "cacheVal", this.checked );
		});
	},

	// Returns those radio buttons that are supposed to be in the same group as
	// this radio button. In the case of a checkbox or a radio lacking a name
	// attribute, it returns this.element.
	_getInputSet: function() {
		var selector, formId,
			radio = this.element[ 0 ],
			name = radio.name,
			form = radio.form,
			doc = this.element.parents().last().get( 0 ),

			// A radio is always a member of its own group
			radios = this.element;

		// Only start running selectors if this is an attached radio button with a name
		if ( name && this.inputtype === "radio" && doc ) {
			selector = "input[type='radio'][name='" + escapeId( name ) + "']";

			// If we're inside a form
			if ( form ) {
				formId = form.getAttribute( "id" );

				// If the form has an ID, collect radios scattered throught the document which
				// nevertheless are part of the form by way of the value of their form attribute
				if ( formId ) {
					radios = $( selector + "[form='" + escapeId( formId ) + "']", doc );
				}

				// Also add to those the radios in the form itself
				radios = $( form ).find( selector ).filter( function() {

					// Some radios inside the form may belong to some other form by virtue of
					// having a form attribute defined on them, so we must filter them out here
					return ( this.form === form );
				}).add( radios );

			// If we're outside a form
			} else {

				// Collect all those radios which are also outside of a form and match our name
				radios = $( selector, doc ).filter( function() {
					return !this.form;
				});
			}
		}
		return radios;
	},

	_updateAll: function( changeTriggered ) {
		var self = this;

		this._getInputSet().each( function() {
			var $this = $( this );

			if ( ( this.checked || self.inputtype === "checkbox" ) && !changeTriggered ) {
				$this.trigger( "change" );
			}
		})
		.checkboxradio( "refresh" );
	},

	_reset: function() {
		this.refresh();
	},

	// Is the widget supposed to display an icon?
	_hasIcon: function() {
		var controlgroup, controlgroupWidget,
			controlgroupConstructor = $.mobile.controlgroup;

		// If the controlgroup widget is defined ...
		if ( controlgroupConstructor ) {
			controlgroup = this.element.closest(
				":mobile-controlgroup," +
				controlgroupConstructor.prototype.initSelector );

			// ... and the checkbox is in a controlgroup ...
			if ( controlgroup.length > 0 ) {

				// ... look for a controlgroup widget instance, and ...
				controlgroupWidget = $.data( controlgroup[ 0 ], "mobile-controlgroup" );

				// ... if found, decide based on the option value, ...
				return ( ( controlgroupWidget ? controlgroupWidget.options.type :

					// ... otherwise decide based on the "type" data attribute.
					controlgroup.attr( "data-" + $.mobile.ns + "type" ) ) !== "horizontal" );
			}
		}

		// Normally, the widget displays an icon.
		return true;
	},

	refresh: function() {
		var isChecked = this.element[ 0 ].checked,
			active = $.mobile.activeBtnClass,
			iconposClass = "ui-btn-icon-" + this.options.iconpos,
			addClasses = [],
			removeClasses = [];

		if ( this._hasIcon() ) {
			removeClasses.push( active );
			addClasses.push( iconposClass );
		} else {
			removeClasses.push( iconposClass );
			( isChecked ? addClasses : removeClasses ).push( active );
		}

		if ( isChecked ) {
			addClasses.push( this.checkedClass );
			removeClasses.push( this.uncheckedClass );
		} else {
			addClasses.push( this.uncheckedClass );
			removeClasses.push( this.checkedClass );
		}

		this.widget().toggleClass( "ui-state-disabled", this.element.prop( "disabled" ) );

		this.label
			.addClass( addClasses.join( " " ) )
			.removeClass( removeClasses.join( " " ) );
	},

	widget: function() {
		return this.label.parent();
	},

	_setOptions: function( options ) {
		var label = this.label,
			currentOptions = this.options,
			outer = this.widget(),
			hasIcon = this._hasIcon();

		if ( options.disabled !== undefined ) {
			this.input.prop( "disabled", !!options.disabled );
			outer.toggleClass( "ui-state-disabled", !!options.disabled );
		}
		if ( options.mini !== undefined ) {
			outer.toggleClass( "ui-mini", !!options.mini );
		}
		if ( options.theme !== undefined ) {
			label
				.removeClass( "ui-btn-" + currentOptions.theme )
				.addClass( "ui-btn-" + options.theme );
		}
		if ( options.wrapperClass !== undefined ) {
			outer
				.removeClass( currentOptions.wrapperClass )
				.addClass( options.wrapperClass );
		}
		if ( options.iconpos !== undefined && hasIcon ) {
			label.removeClass( "ui-btn-icon-" + currentOptions.iconpos ).addClass( "ui-btn-icon-" + options.iconpos );
		} else if ( !hasIcon ) {
			label.removeClass( "ui-btn-icon-" + currentOptions.iconpos );
		}
		this._super( options );
	}

}, $.mobile.behaviors.formReset ) );

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.flipswitch", $.extend({

	options: {
		onText: "On",
		offText: "Off",
		theme: null,
		enhanced: false,
		wrapperClass: null,
		corners: true,
		mini: false
	},

	_create: function() {
			if ( !this.options.enhanced ) {
				this._enhance();
			} else {
				$.extend( this, {
					flipswitch: this.element.parent(),
					on: this.element.find( ".ui-flipswitch-on" ).eq( 0 ),
					off: this.element.find( ".ui-flipswitch-off" ).eq(0),
					type: this.element.get( 0 ).tagName
				});
			}

			this._handleFormReset();

			// Transfer tabindex to "on" element and make input unfocusable
			this._originalTabIndex = this.element.attr( "tabindex" );
			if ( this._originalTabIndex != null ) {
				this.on.attr( "tabindex", this._originalTabIndex );
			}
			this.element.attr( "tabindex", "-1" );
			this._on({
				"focus" : "_handleInputFocus"
			});

			if ( this.element.is( ":disabled" ) ) {
				this._setOptions({
					"disabled": true
				});
			}

			this._on( this.flipswitch, {
				"click": "_toggle",
				"swipeleft": "_left",
				"swiperight": "_right"
			});

			this._on( this.on, {
				"keydown": "_keydown"
			});

			this._on( {
				"change": "refresh"
			});
	},

	_handleInputFocus: function() {
		this.on.focus();
	},

	widget: function() {
		return this.flipswitch;
	},

	_left: function() {
		this.flipswitch.removeClass( "ui-flipswitch-active" );
		if ( this.type === "SELECT" ) {
			this.element.get( 0 ).selectedIndex = 0;
		} else {
			this.element.prop( "checked", false );
		}
		this.element.trigger( "change" );
	},

	_right: function() {
		this.flipswitch.addClass( "ui-flipswitch-active" );
		if ( this.type === "SELECT" ) {
			this.element.get( 0 ).selectedIndex = 1;
		} else {
			this.element.prop( "checked", true );
		}
		this.element.trigger( "change" );
	},

	_enhance: function() {
		var flipswitch = $( "<div>" ),
			options = this.options,
			element = this.element,
			theme = options.theme ? options.theme : "inherit",

			// The "on" button is an anchor so it's focusable
			on = $( "<a></a>", {
				"href": "#"
			}),
			off = $( "<span></span>" ),
			type = element.get( 0 ).tagName,
			onText = ( type === "INPUT" ) ?
				options.onText : element.find( "option" ).eq( 1 ).text(),
			offText = ( type === "INPUT" ) ?
				options.offText : element.find( "option" ).eq( 0 ).text();

			on
				.addClass( "ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit" )
				.text( onText );
			off
				.addClass( "ui-flipswitch-off" )
				.text( offText );

			flipswitch
				.addClass( "ui-flipswitch ui-shadow-inset " +
					"ui-bar-" + theme + " " +
					( options.wrapperClass ? options.wrapperClass : "" ) + " " +
					( ( element.is( ":checked" ) ||
						element
							.find( "option" )
							.eq( 1 )
							.is( ":selected" ) ) ? "ui-flipswitch-active" : "" ) +
					( element.is(":disabled") ? " ui-state-disabled": "") +
					( options.corners ? " ui-corner-all": "" ) +
					( options.mini ? " ui-mini": "" ) )
				.append( on, off );

			element
				.addClass( "ui-flipswitch-input" )
				.after( flipswitch )
				.appendTo( flipswitch );

		$.extend( this, {
			flipswitch: flipswitch,
			on: on,
			off: off,
			type: type
		});
	},

	_reset: function() {
		this.refresh();
	},

	refresh: function() {
		var direction,
			existingDirection = this.flipswitch.hasClass( "ui-flipswitch-active" ) ? "_right" : "_left";

		if ( this.type === "SELECT" ) {
			direction = ( this.element.get( 0 ).selectedIndex > 0 ) ? "_right": "_left";
		} else {
			direction = this.element.prop( "checked" ) ? "_right": "_left";
		}

		if ( direction !== existingDirection ) {
			this[ direction ]();
		}
	},

	_toggle: function() {
		var direction = this.flipswitch.hasClass( "ui-flipswitch-active" ) ? "_left" : "_right";

		this[ direction ]();
	},

	_keydown: function( e ) {
		if ( e.which === $.mobile.keyCode.LEFT ) {
			this._left();
		} else if ( e.which === $.mobile.keyCode.RIGHT ) {
			this._right();
		} else if ( e.which === $.mobile.keyCode.SPACE ) {
			this._toggle();
			e.preventDefault();
		}
	},

	_setOptions: function( options ) {
		if ( options.theme !== undefined ) {
			var currentTheme = options.theme ? options.theme : "inherit",
				newTheme = options.theme ? options.theme : "inherit";

			this.widget()
				.removeClass( "ui-bar-" + currentTheme )
				.addClass( "ui-bar-" + newTheme );
		}
		if ( options.onText !== undefined ) {
			this.on.text( options.onText );
		}
		if ( options.offText !== undefined ) {
			this.off.text( options.offText );
		}
		if ( options.disabled !== undefined ) {
			this.widget().toggleClass( "ui-state-disabled", options.disabled );
		}
		if ( options.mini !== undefined ) {
			this.widget().toggleClass( "ui-mini", options.mini );
		}
		if ( options.corners !== undefined ) {
			this.widget().toggleClass( "ui-corner-all", options.corners );
		}

		this._super( options );
	},

	_destroy: function() {
		if ( this.options.enhanced ) {
			return;
		}
		if ( this._originalTabIndex != null ) {
			this.element.attr( "tabindex", this._originalTabIndex );
		} else {
			this.element.removeAttr( "tabindex" );
		}
		this.on.remove();
		this.off.remove();
		this.element.unwrap();
		this.flipswitch.remove();
		this.removeClass( "ui-flipswitch-input" );
	}

}, $.mobile.behaviors.formReset ) );

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.slider", $.extend( {
	initSelector: "input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",

	widgetEventPrefix: "slide",

	options: {
		theme: null,
		trackTheme: null,
		corners: true,
		mini: false,
		highlight: false
	},

	_create: function() {

		// TODO: Each of these should have comments explain what they're for
		var self = this,
			control = this.element,
			trackTheme = this.options.trackTheme || $.mobile.getAttribute( control[ 0 ], "theme" ),
			trackThemeClass = trackTheme ? " ui-bar-" + trackTheme : " ui-bar-inherit",
			cornerClass = ( this.options.corners || control.jqmData( "corners" ) ) ? " ui-corner-all" : "",
			miniClass = ( this.options.mini || control.jqmData( "mini" ) ) ? " ui-mini" : "",
			cType = control[ 0 ].nodeName.toLowerCase(),
			isToggleSwitch = ( cType === "select" ),
			isRangeslider = control.parent().is( ":jqmData(role='rangeslider')" ),
			selectClass = ( isToggleSwitch ) ? "ui-slider-switch" : "",
			controlID = control.attr( "id" ),
			$label = $( "[for='" + controlID + "']" ),
			labelID = $label.attr( "id" ) || controlID + "-label",
			min = !isToggleSwitch ? parseFloat( control.attr( "min" ) ) : 0,
			max =  !isToggleSwitch ? parseFloat( control.attr( "max" ) ) : control.find( "option" ).length-1,
			step = window.parseFloat( control.attr( "step" ) || 1 ),
			domHandle = document.createElement( "a" ),
			handle = $( domHandle ),
			domSlider = document.createElement( "div" ),
			slider = $( domSlider ),
			valuebg = this.options.highlight && !isToggleSwitch ? (function() {
				var bg = document.createElement( "div" );
				bg.className = "ui-slider-bg " + $.mobile.activeBtnClass;
				return $( bg ).prependTo( slider );
			})() : false,
			options,
			wrapper,
			j, length,
			i, optionsCount, origTabIndex,
			side, activeClass, sliderImg;

		$label.attr( "id", labelID );
		this.isToggleSwitch = isToggleSwitch;

		domHandle.setAttribute( "href", "#" );
		domSlider.setAttribute( "role", "application" );
		domSlider.className = [ this.isToggleSwitch ? "ui-slider ui-slider-track ui-shadow-inset " : "ui-slider-track ui-shadow-inset ", selectClass, trackThemeClass, cornerClass, miniClass ].join( "" );
		domHandle.className = "ui-slider-handle";
		domSlider.appendChild( domHandle );

		handle.attr({
			"role": "slider",
			"aria-valuemin": min,
			"aria-valuemax": max,
			"aria-valuenow": this._value(),
			"aria-valuetext": this._value(),
			"title": this._value(),
			"aria-labelledby": labelID
		});

		$.extend( this, {
			slider: slider,
			handle: handle,
			control: control,
			type: cType,
			step: step,
			max: max,
			min: min,
			valuebg: valuebg,
			isRangeslider: isRangeslider,
			dragging: false,
			beforeStart: null,
			userModified: false,
			mouseMoved: false
		});

		if ( isToggleSwitch ) {
			// TODO: restore original tabindex (if any) in a destroy method
			origTabIndex = control.attr( "tabindex" );
			if ( origTabIndex ) {
				handle.attr( "tabindex", origTabIndex );
			}
			control.attr( "tabindex", "-1" ).focus(function() {
				$( this ).blur();
				handle.focus();
			});

			wrapper = document.createElement( "div" );
			wrapper.className = "ui-slider-inneroffset";

			for ( j = 0, length = domSlider.childNodes.length; j < length; j++ ) {
				wrapper.appendChild( domSlider.childNodes[j] );
			}

			domSlider.appendChild( wrapper );

			// slider.wrapInner( "<div class='ui-slider-inneroffset'></div>" );

			// make the handle move with a smooth transition
			handle.addClass( "ui-slider-handle-snapping" );

			options = control.find( "option" );

			for ( i = 0, optionsCount = options.length; i < optionsCount; i++ ) {
				side = !i ? "b" : "a";
				activeClass = !i ? "" : " " + $.mobile.activeBtnClass;
				sliderImg = document.createElement( "span" );

				sliderImg.className = [ "ui-slider-label ui-slider-label-", side, activeClass ].join( "" );
				sliderImg.setAttribute( "role", "img" );
				sliderImg.appendChild( document.createTextNode( options[i].innerHTML ) );
				$( sliderImg ).prependTo( slider );
			}

			self._labels = $( ".ui-slider-label", slider );

		}

		// monitor the input for updated values
		control.addClass( isToggleSwitch ? "ui-slider-switch" : "ui-slider-input" );

		this._on( control, {
			"change": "_controlChange",
			"keyup": "_controlKeyup",
			"blur": "_controlBlur",
			"vmouseup": "_controlVMouseUp"
		});

		slider.bind( "vmousedown", $.proxy( this._sliderVMouseDown, this ) )
			.bind( "vclick", false );

		// We have to instantiate a new function object for the unbind to work properly
		// since the method itself is defined in the prototype (causing it to unbind everything)
		this._on( document, { "vmousemove": "_preventDocumentDrag" });
		this._on( slider.add( document ), { "vmouseup": "_sliderVMouseUp" });

		slider.insertAfter( control );

		// wrap in a div for styling purposes
		if ( !isToggleSwitch && !isRangeslider ) {
			wrapper = this.options.mini ? "<div class='ui-slider ui-mini'>" : "<div class='ui-slider'>";

			control.add( slider ).wrapAll( wrapper );
		}

		// bind the handle event callbacks and set the context to the widget instance
		this._on( this.handle, {
			"vmousedown": "_handleVMouseDown",
			"keydown": "_handleKeydown",
			"keyup": "_handleKeyup"
		});

		this.handle.bind( "vclick", false );

		this._handleFormReset();

		this.refresh( undefined, undefined, true );
	},

	_setOptions: function( options ) {
		if ( options.theme !== undefined ) {
			this._setTheme( options.theme );
		}

		if ( options.trackTheme !== undefined ) {
			this._setTrackTheme( options.trackTheme );
		}

		if ( options.corners !== undefined ) {
			this._setCorners( options.corners );
		}

		if ( options.mini !== undefined ) {
			this._setMini( options.mini );
		}

		if ( options.highlight !== undefined ) {
			this._setHighlight( options.highlight );
		}

		if ( options.disabled !== undefined ) {
			this._setDisabled( options.disabled );
		}
		this._super( options );
	},

	_controlChange: function( event ) {
		// if the user dragged the handle, the "change" event was triggered from inside refresh(); don't call refresh() again
		if ( this._trigger( "controlchange", event ) === false ) {
			return false;
		}
		if ( !this.mouseMoved ) {
			this.refresh( this._value(), true );
		}
	},

	_controlKeyup: function(/* event */) { // necessary?
		this.refresh( this._value(), true, true );
	},

	_controlBlur: function(/* event */) {
		this.refresh( this._value(), true );
	},

	// it appears the clicking the up and down buttons in chrome on
	// range/number inputs doesn't trigger a change until the field is
	// blurred. Here we check thif the value has changed and refresh
	_controlVMouseUp: function(/* event */) {
		this._checkedRefresh();
	},

	// NOTE force focus on handle
	_handleVMouseDown: function(/* event */) {
		this.handle.focus();
	},

	_handleKeydown: function( event ) {
		var index = this._value();
		if ( this.options.disabled ) {
			return;
		}

		// In all cases prevent the default and mark the handle as active
		switch ( event.keyCode ) {
			case $.mobile.keyCode.HOME:
			case $.mobile.keyCode.END:
			case $.mobile.keyCode.PAGE_UP:
			case $.mobile.keyCode.PAGE_DOWN:
			case $.mobile.keyCode.UP:
			case $.mobile.keyCode.RIGHT:
			case $.mobile.keyCode.DOWN:
			case $.mobile.keyCode.LEFT:
				event.preventDefault();

				if ( !this._keySliding ) {
					this._keySliding = true;
					this.handle.addClass( "ui-state-active" ); /* TODO: We don't use this class for styling. Do we need to add it? */
				}

				break;
		}

		// move the slider according to the keypress
		switch ( event.keyCode ) {
			case $.mobile.keyCode.HOME:
				this.refresh( this.min );
				break;
			case $.mobile.keyCode.END:
				this.refresh( this.max );
				break;
			case $.mobile.keyCode.PAGE_UP:
			case $.mobile.keyCode.UP:
			case $.mobile.keyCode.RIGHT:
				this.refresh( index + this.step );
				break;
			case $.mobile.keyCode.PAGE_DOWN:
			case $.mobile.keyCode.DOWN:
			case $.mobile.keyCode.LEFT:
				this.refresh( index - this.step );
				break;
		}
	}, // remove active mark

	_handleKeyup: function(/* event */) {
		if ( this._keySliding ) {
			this._keySliding = false;
			this.handle.removeClass( "ui-state-active" ); /* See comment above. */
		}
	},

	_sliderVMouseDown: function( event ) {
		// NOTE: we don't do this in refresh because we still want to
		//       support programmatic alteration of disabled inputs
		if ( this.options.disabled || !( event.which === 1 || event.which === 0 || event.which === undefined ) ) {
			return false;
		}
		if ( this._trigger( "beforestart", event ) === false ) {
			return false;
		}
		this.dragging = true;
		this.userModified = false;
		this.mouseMoved = false;

		if ( this.isToggleSwitch ) {
			this.beforeStart = this.element[0].selectedIndex;
		}

		this.refresh( event );
		this._trigger( "start" );
		return false;
	},

	_sliderVMouseUp: function() {
		if ( this.dragging ) {
			this.dragging = false;

			if ( this.isToggleSwitch ) {
				// make the handle move with a smooth transition
				this.handle.addClass( "ui-slider-handle-snapping" );

				if ( this.mouseMoved ) {
					// this is a drag, change the value only if user dragged enough
					if ( this.userModified ) {
						this.refresh( this.beforeStart === 0 ? 1 : 0 );
					} else {
						this.refresh( this.beforeStart );
					}
				} else {
					// this is just a click, change the value
					this.refresh( this.beforeStart === 0 ? 1 : 0 );
				}
			}

			this.mouseMoved = false;
			this._trigger( "stop" );
			return false;
		}
	},

	_preventDocumentDrag: function( event ) {
			// NOTE: we don't do this in refresh because we still want to
			//       support programmatic alteration of disabled inputs
			if ( this._trigger( "drag", event ) === false) {
				return false;
			}
			if ( this.dragging && !this.options.disabled ) {

				// this.mouseMoved must be updated before refresh() because it will be used in the control "change" event
				this.mouseMoved = true;

				if ( this.isToggleSwitch ) {
					// make the handle move in sync with the mouse
					this.handle.removeClass( "ui-slider-handle-snapping" );
				}

				this.refresh( event );

				// only after refresh() you can calculate this.userModified
				this.userModified = this.beforeStart !== this.element[0].selectedIndex;
				return false;
			}
		},

	_checkedRefresh: function() {
		if ( this.value !== this._value() ) {
			this.refresh( this._value() );
		}
	},

	_value: function() {
		return  this.isToggleSwitch ? this.element[0].selectedIndex : parseFloat( this.element.val() ) ;
	},

	_reset: function() {
		this.refresh( undefined, false, true );
	},

	refresh: function( val, isfromControl, preventInputUpdate ) {
		// NOTE: we don't return here because we want to support programmatic
		//       alteration of the input value, which should still update the slider

		var self = this,
			parentTheme = $.mobile.getAttribute( this.element[ 0 ], "theme" ),
			theme = this.options.theme || parentTheme,
			themeClass =  theme ? " ui-btn-" + theme : "",
			trackTheme = this.options.trackTheme || parentTheme,
			trackThemeClass = trackTheme ? " ui-bar-" + trackTheme : " ui-bar-inherit",
			cornerClass = this.options.corners ? " ui-corner-all" : "",
			miniClass = this.options.mini ? " ui-mini" : "",
			left, width, data, tol,
			pxStep, percent,
			control, isInput, optionElements, min, max, step,
			newval, valModStep, alignValue, percentPerStep,
			handlePercent, aPercent, bPercent,
			valueChanged;

		self.slider[0].className = [ this.isToggleSwitch ? "ui-slider ui-slider-switch ui-slider-track ui-shadow-inset" : "ui-slider-track ui-shadow-inset", trackThemeClass, cornerClass, miniClass ].join( "" );
		if ( this.options.disabled || this.element.prop( "disabled" ) ) {
			this.disable();
		}

		// set the stored value for comparison later
		this.value = this._value();
		if ( this.options.highlight && !this.isToggleSwitch && this.slider.find( ".ui-slider-bg" ).length === 0 ) {
			this.valuebg = (function() {
				var bg = document.createElement( "div" );
				bg.className = "ui-slider-bg " + $.mobile.activeBtnClass;
				return $( bg ).prependTo( self.slider );
			})();
		}
		this.handle.addClass( "ui-btn" + themeClass + " ui-shadow" );

		control = this.element;
		isInput = !this.isToggleSwitch;
		optionElements = isInput ? [] : control.find( "option" );
		min =  isInput ? parseFloat( control.attr( "min" ) ) : 0;
		max = isInput ? parseFloat( control.attr( "max" ) ) : optionElements.length - 1;
		step = ( isInput && parseFloat( control.attr( "step" ) ) > 0 ) ? parseFloat( control.attr( "step" ) ) : 1;

		if ( typeof val === "object" ) {
			data = val;
			// a slight tolerance helped get to the ends of the slider
			tol = 8;

			left = this.slider.offset().left;
			width = this.slider.width();
			pxStep = width/((max-min)/step);
			if ( !this.dragging ||
					data.pageX < left - tol ||
					data.pageX > left + width + tol ) {
				return;
			}
			if ( pxStep > 1 ) {
				percent = ( ( data.pageX - left ) / width ) * 100;
			} else {
				percent = Math.round( ( ( data.pageX - left ) / width ) * 100 );
			}
		} else {
			if ( val == null ) {
				val = isInput ? parseFloat( control.val() || 0 ) : control[0].selectedIndex;
			}
			percent = ( parseFloat( val ) - min ) / ( max - min ) * 100;
		}

		if ( isNaN( percent ) ) {
			return;
		}

		newval = ( percent / 100 ) * ( max - min ) + min;

		//from jQuery UI slider, the following source will round to the nearest step
		valModStep = ( newval - min ) % step;
		alignValue = newval - valModStep;

		if ( Math.abs( valModStep ) * 2 >= step ) {
			alignValue += ( valModStep > 0 ) ? step : ( -step );
		}

		percentPerStep = 100/((max-min)/step);
		// Since JavaScript has problems with large floats, round
		// the final value to 5 digits after the decimal point (see jQueryUI: #4124)
		newval = parseFloat( alignValue.toFixed(5) );

		if ( typeof pxStep === "undefined" ) {
			pxStep = width / ( (max-min) / step );
		}
		if ( pxStep > 1 && isInput ) {
			percent = ( newval - min ) * percentPerStep * ( 1 / step );
		}
		if ( percent < 0 ) {
			percent = 0;
		}

		if ( percent > 100 ) {
			percent = 100;
		}

		if ( newval < min ) {
			newval = min;
		}

		if ( newval > max ) {
			newval = max;
		}

		this.handle.css( "left", percent + "%" );

		this.handle[0].setAttribute( "aria-valuenow", isInput ? newval : optionElements.eq( newval ).attr( "value" ) );

		this.handle[0].setAttribute( "aria-valuetext", isInput ? newval : optionElements.eq( newval ).getEncodedText() );

		this.handle[0].setAttribute( "title", isInput ? newval : optionElements.eq( newval ).getEncodedText() );

		if ( this.valuebg ) {
			this.valuebg.css( "width", percent + "%" );
		}

		// drag the label widths
		if ( this._labels ) {
			handlePercent = this.handle.width() / this.slider.width() * 100;
			aPercent = percent && handlePercent + ( 100 - handlePercent ) * percent / 100;
			bPercent = percent === 100 ? 0 : Math.min( handlePercent + 100 - aPercent, 100 );

			this._labels.each(function() {
				var ab = $( this ).hasClass( "ui-slider-label-a" );
				$( this ).width( ( ab ? aPercent : bPercent  ) + "%" );
			});
		}

		if ( !preventInputUpdate ) {
			valueChanged = false;

			// update control"s value
			if ( isInput ) {
				valueChanged = parseFloat( control.val() ) !== newval;
				control.val( newval );
			} else {
				valueChanged = control[ 0 ].selectedIndex !== newval;
				control[ 0 ].selectedIndex = newval;
			}
			if ( this._trigger( "beforechange", val ) === false) {
					return false;
			}
			if ( !isfromControl && valueChanged ) {
				control.trigger( "change" );
			}
		}
	},

	_setHighlight: function( value ) {
		value = !!value;
		if ( value ) {
			this.options.highlight = !!value;
			this.refresh();
		} else if ( this.valuebg ) {
			this.valuebg.remove();
			this.valuebg = false;
		}
	},

	_setTheme: function( value ) {
		this.handle
			.removeClass( "ui-btn-" + this.options.theme )
			.addClass( "ui-btn-" + value );

		var currentTheme = this.options.theme ? this.options.theme : "inherit",
			newTheme = value ? value : "inherit";

		this.control
			.removeClass( "ui-body-" + currentTheme )
			.addClass( "ui-body-" + newTheme );
	},

	_setTrackTheme: function( value ) {
		var currentTrackTheme = this.options.trackTheme ? this.options.trackTheme : "inherit",
			newTrackTheme = value ? value : "inherit";

		this.slider
			.removeClass( "ui-body-" + currentTrackTheme )
			.addClass( "ui-body-" + newTrackTheme );
	},

	_setMini: function( value ) {
		value = !!value;
		if ( !this.isToggleSwitch && !this.isRangeslider ) {
			this.slider.parent().toggleClass( "ui-mini", value );
			this.element.toggleClass( "ui-mini", value );
		}
		this.slider.toggleClass( "ui-mini", value );
	},

	_setCorners: function( value ) {
		this.slider.toggleClass( "ui-corner-all", value );

		if ( !this.isToggleSwitch ) {
			this.control.toggleClass( "ui-corner-all", value );
		}
	},

	_setDisabled: function( value ) {
		value = !!value;
		this.element.prop( "disabled", value );
		this.slider
			.toggleClass( "ui-state-disabled", value )
			.attr( "aria-disabled", value );

		this.element.toggleClass( "ui-state-disabled", value );
	}

}, $.mobile.behaviors.formReset ) );

})( jQuery );

(function( $, undefined ) {
	$.widget( "mobile.rangeslider", $.extend( {

		options: {
			theme: null,
			trackTheme: null,
			corners: true,
			mini: false,
			highlight: true
		},

		_create: function() {
			var $el = this.element,
			elClass = this.options.mini ? "ui-rangeslider ui-mini" : "ui-rangeslider",
			_inputFirst = $el.find( "input" ).first(),
			_inputLast = $el.find( "input" ).last(),
			_label = $el.find( "label" ).first(),
			_sliderWidgetFirst = $.data( _inputFirst.get( 0 ), "mobile-slider" ) ||
				$.data( _inputFirst.slider().get( 0 ), "mobile-slider" ),
			_sliderWidgetLast = $.data( _inputLast.get(0), "mobile-slider" ) ||
				$.data( _inputLast.slider().get( 0 ), "mobile-slider" ),
			_sliderFirst = _sliderWidgetFirst.slider,
			_sliderLast = _sliderWidgetLast.slider,
			firstHandle = _sliderWidgetFirst.handle,
			_sliders = $( "<div class='ui-rangeslider-sliders' />" ).appendTo( $el );

			_inputFirst.addClass( "ui-rangeslider-first" );
			_inputLast.addClass( "ui-rangeslider-last" );
			$el.addClass( elClass );

			_sliderFirst.appendTo( _sliders );
			_sliderLast.appendTo( _sliders );
			_label.insertBefore( $el );
			firstHandle.prependTo( _sliderLast );

			$.extend( this, {
				_inputFirst: _inputFirst,
				_inputLast: _inputLast,
				_sliderFirst: _sliderFirst,
				_sliderLast: _sliderLast,
				_label: _label,
				_targetVal: null,
				_sliderTarget: false,
				_sliders: _sliders,
				_proxy: false
			});

			this.refresh();
			this._on( this.element.find( "input.ui-slider-input" ), {
				"slidebeforestart": "_slidebeforestart",
				"slidestop": "_slidestop",
				"slidedrag": "_slidedrag",
				"slidebeforechange": "_change",
				"blur": "_change",
				"keyup": "_change"
			});
			this._on({
				"mousedown":"_change"
			});
			this._on( this.element.closest( "form" ), {
				"reset":"_handleReset"
			});
			this._on( firstHandle, {
				"vmousedown": "_dragFirstHandle"
			});
		},
		_handleReset: function() {
			var self = this;
			//we must wait for the stack to unwind before updateing other wise sliders will not have updated yet
			setTimeout( function() {
				self._updateHighlight();
			},0);
		},

		_dragFirstHandle: function( event ) {
			//if the first handle is dragged send the event to the first slider
			$.data( this._inputFirst.get(0), "mobile-slider" ).dragging = true;
			$.data( this._inputFirst.get(0), "mobile-slider" ).refresh( event );
			$.data( this._inputFirst.get(0), "mobile-slider" )._trigger( "start" );
			return false;
		},

		_slidedrag: function( event ) {
			var first = $( event.target ).is( this._inputFirst ),
				otherSlider = ( first ) ? this._inputLast : this._inputFirst;

			this._sliderTarget = false;
			//if the drag was initiated on an extreme and the other handle is focused send the events to
			//the closest handle
			if ( ( this._proxy === "first" && first ) || ( this._proxy === "last" && !first ) ) {
				$.data( otherSlider.get(0), "mobile-slider" ).dragging = true;
				$.data( otherSlider.get(0), "mobile-slider" ).refresh( event );
				return false;
			}
		},

		_slidestop: function( event ) {
			var first = $( event.target ).is( this._inputFirst );

			this._proxy = false;
			//this stops dragging of the handle and brings the active track to the front
			//this makes clicks on the track go the the last handle used
			this.element.find( "input" ).trigger( "vmouseup" );
			this._sliderFirst.css( "z-index", first ? 1 : "" );
		},

		_slidebeforestart: function( event ) {
			this._sliderTarget = false;
			//if the track is the target remember this and the original value
			if ( $( event.originalEvent.target ).hasClass( "ui-slider-track" ) ) {
				this._sliderTarget = true;
				this._targetVal = $( event.target ).val();
			}
		},

		_setOptions: function( options ) {
			if ( options.theme !== undefined ) {
				this._setTheme( options.theme );
			}

			if ( options.trackTheme !== undefined ) {
				this._setTrackTheme( options.trackTheme );
			}

			if ( options.mini !== undefined ) {
				this._setMini( options.mini );
			}

			if ( options.highlight !== undefined ) {
				this._setHighlight( options.highlight );
			}

			if ( options.disabled !== undefined ) {
				this._setDisabled( options.disabled );
			}

			this._super( options );
			this.refresh();
		},

		refresh: function() {
			var $el = this.element,
				o = this.options;

			if ( this._inputFirst.is( ":disabled" ) || this._inputLast.is( ":disabled" ) ) {
				this.options.disabled = true;
			}

			$el.find( "input" ).slider({
				theme: o.theme,
				trackTheme: o.trackTheme,
				disabled: o.disabled,
				corners: o.corners,
				mini: o.mini,
				highlight: o.highlight
			}).slider( "refresh" );
			this._updateHighlight();
		},

		_change: function( event ) {
			if ( event.type === "keyup" ) {
				this._updateHighlight();
				return false;
			}

			var self = this,
				min = parseFloat( this._inputFirst.val(), 10 ),
				max = parseFloat( this._inputLast.val(), 10 ),
				first = $( event.target ).hasClass( "ui-rangeslider-first" ),
				thisSlider = first ? this._inputFirst : this._inputLast,
				otherSlider = first ? this._inputLast : this._inputFirst;

			if ( ( this._inputFirst.val() > this._inputLast.val() && event.type === "mousedown" && !$(event.target).hasClass("ui-slider-handle")) ) {
				thisSlider.blur();
			} else if ( event.type === "mousedown" ) {
				return;
			}
			if ( min > max && !this._sliderTarget ) {
				//this prevents min from being greater then max
				thisSlider.val( first ? max: min ).slider( "refresh" );
				this._trigger( "normalize" );
			} else if ( min > max ) {
				//this makes it so clicks on the target on either extreme go to the closest handle
				thisSlider.val( this._targetVal ).slider( "refresh" );

				//You must wait for the stack to unwind so first slider is updated before updating second
				setTimeout( function() {
					otherSlider.val( first ? min: max ).slider( "refresh" );
					$.data( otherSlider.get(0), "mobile-slider" ).handle.focus();
					self._sliderFirst.css( "z-index", first ? "" : 1 );
					self._trigger( "normalize" );
				}, 0 );
				this._proxy = ( first ) ? "first" : "last";
			}
			//fixes issue where when both _sliders are at min they cannot be adjusted
			if ( min === max ) {
				$.data( thisSlider.get(0), "mobile-slider" ).handle.css( "z-index", 1 );
				$.data( otherSlider.get(0), "mobile-slider" ).handle.css( "z-index", 0 );
			} else {
				$.data( otherSlider.get(0), "mobile-slider" ).handle.css( "z-index", "" );
				$.data( thisSlider.get(0), "mobile-slider" ).handle.css( "z-index", "" );
			}

			this._updateHighlight();

			if ( min >= max ) {
				return false;
			}
		},

		_updateHighlight: function() {
			var min = parseInt( $.data( this._inputFirst.get(0), "mobile-slider" ).handle.get(0).style.left, 10 ),
				max = parseInt( $.data( this._inputLast.get(0), "mobile-slider" ).handle.get(0).style.left, 10 ),
				width = (max - min);

			this.element.find( ".ui-slider-bg" ).css({
				"margin-left": min + "%",
				"width": width + "%"
			});
		},

		_setTheme: function( value ) {
			this._inputFirst.slider( "option", "theme", value );
			this._inputLast.slider( "option", "theme", value );
		},

		_setTrackTheme: function( value ) {
			this._inputFirst.slider( "option", "trackTheme", value );
			this._inputLast.slider( "option", "trackTheme", value );
		},

		_setMini: function( value ) {
			this._inputFirst.slider( "option", "mini", value );
			this._inputLast.slider( "option", "mini", value );
			this.element.toggleClass( "ui-mini", !!value );
		},

		_setHighlight: function( value ) {
			this._inputFirst.slider( "option", "highlight", value );
			this._inputLast.slider( "option", "highlight", value );
		},

		_setDisabled: function( value ) {
			this._inputFirst.prop( "disabled", value );
			this._inputLast.prop( "disabled", value );
		},

		_destroy: function() {
			this._label.prependTo( this.element );
			this.element.removeClass( "ui-rangeslider ui-mini" );
			this._inputFirst.after( this._sliderFirst );
			this._inputLast.after( this._sliderLast );
			this._sliders.remove();
			this.element.find( "input" ).removeClass( "ui-rangeslider-first ui-rangeslider-last" ).slider( "destroy" );
		}

	}, $.mobile.behaviors.formReset ) );

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.selectmenu", $.extend( {
	initSelector: "select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",

	options: {
		theme: null,
		icon: "carat-d",
		iconpos: "right",
		inline: false,
		corners: true,
		shadow: true,
		iconshadow: false, /* TODO: Deprecated in 1.4, remove in 1.5. */
		overlayTheme: null,
		dividerTheme: null,
		hidePlaceholderMenuItems: true,
		closeText: "Close",
		nativeMenu: true,
		// This option defaults to true on iOS devices.
		preventFocusZoom: /iPhone|iPad|iPod/.test( navigator.platform ) && navigator.userAgent.indexOf( "AppleWebKit" ) > -1,
		mini: false
	},

	_button: function() {
		return $( "<div/>" );
	},

	_setDisabled: function( value ) {
		this.element.attr( "disabled", value );
		this.button.attr( "aria-disabled", value );
		return this._setOption( "disabled", value );
	},

	_focusButton : function() {
		var self = this;

		setTimeout( function() {
			self.button.focus();
		}, 40);
	},

	_selectOptions: function() {
		return this.select.find( "option" );
	},

	// setup items that are generally necessary for select menu extension
	_preExtension: function() {
		var inline = this.options.inline || this.element.jqmData( "inline" ),
			mini = this.options.mini || this.element.jqmData( "mini" ),
			classes = "";
		// TODO: Post 1.1--once we have time to test thoroughly--any classes manually applied to the original element should be carried over to the enhanced element, with an `-enhanced` suffix. See https://github.com/jquery/jquery-mobile/issues/3577
		/* if ( $el[0].className.length ) {
			classes = $el[0].className;
		} */
		if ( !!~this.element[0].className.indexOf( "ui-btn-left" ) ) {
			classes = " ui-btn-left";
		}

		if (  !!~this.element[0].className.indexOf( "ui-btn-right" ) ) {
			classes = " ui-btn-right";
		}

		if ( inline ) {
			classes += " ui-btn-inline";
		}
		if ( mini ) {
			classes += " ui-mini";
		}

		this.select = this.element.removeClass( "ui-btn-left ui-btn-right" ).wrap( "<div class='ui-select" + classes + "'>" );
		this.selectId  = this.select.attr( "id" ) || ( "select-" + this.uuid );
		this.buttonId = this.selectId + "-button";
		this.label = $( "label[for='"+ this.selectId +"']" );
		this.isMultiple = this.select[ 0 ].multiple;
	},

	_destroy: function() {
		var wrapper = this.element.parents( ".ui-select" );
		if ( wrapper.length > 0 ) {
			if ( wrapper.is( ".ui-btn-left, .ui-btn-right" ) ) {
				this.element.addClass( wrapper.hasClass( "ui-btn-left" ) ? "ui-btn-left" : "ui-btn-right" );
			}
			this.element.insertAfter( wrapper );
			wrapper.remove();
		}
	},

	_create: function() {
		this._preExtension();

		this.button = this._button();

		var self = this,

			options = this.options,

			iconpos = options.icon ? ( options.iconpos || this.select.jqmData( "iconpos" ) ) : false,

			button = this.button
				.insertBefore( this.select )
				.attr( "id", this.buttonId )
				.addClass( "ui-btn" +
					( options.icon ? ( " ui-icon-" + options.icon + " ui-btn-icon-" + iconpos +
					( options.iconshadow ? " ui-shadow-icon" : "" ) ) :	"" ) + /* TODO: Remove in 1.5. */
					( options.theme ? " ui-btn-" + options.theme : "" ) +
					( options.corners ? " ui-corner-all" : "" ) +
					( options.shadow ? " ui-shadow" : "" ) );

		this.setButtonText();

		// Opera does not properly support opacity on select elements
		// In Mini, it hides the element, but not its text
		// On the desktop,it seems to do the opposite
		// for these reasons, using the nativeMenu option results in a full native select in Opera
		if ( options.nativeMenu && window.opera && window.opera.version ) {
			button.addClass( "ui-select-nativeonly" );
		}

		// Add counter for multi selects
		if ( this.isMultiple ) {
			this.buttonCount = $( "<span>" )
				.addClass( "ui-li-count ui-body-inherit" )
				.hide()
				.appendTo( button.addClass( "ui-li-has-count" ) );
		}

		// Disable if specified
		if ( options.disabled || this.element.attr( "disabled" )) {
			this.disable();
		}

		// Events on native select
		this.select.change(function() {
			self.refresh();

			if ( !!options.nativeMenu ) {
				self._delay( function() {
					self.select.blur();
				});
			}
		});

		this._handleFormReset();

		this._on( this.button, {
			keydown: "_handleKeydown"
		});

		this.build();
	},

	build: function() {
		var self = this;

		this.select
			.appendTo( self.button )
			.bind( "vmousedown", function() {
				// Add active class to button
				self.button.addClass( $.mobile.activeBtnClass );
			})
			.bind( "focus", function() {
				self.button.addClass( $.mobile.focusClass );
			})
			.bind( "blur", function() {
				self.button.removeClass( $.mobile.focusClass );
			})
			.bind( "focus vmouseover", function() {
				self.button.trigger( "vmouseover" );
			})
			.bind( "vmousemove", function() {
				// Remove active class on scroll/touchmove
				self.button.removeClass( $.mobile.activeBtnClass );
			})
			.bind( "change blur vmouseout", function() {
				self.button.trigger( "vmouseout" )
					.removeClass( $.mobile.activeBtnClass );
			});

		// In many situations, iOS will zoom into the select upon tap, this prevents that from happening
		self.button.bind( "vmousedown", function() {
			if ( self.options.preventFocusZoom ) {
					$.mobile.zoom.disable( true );
			}
		});
		self.label.bind( "click focus", function() {
			if ( self.options.preventFocusZoom ) {
					$.mobile.zoom.disable( true );
			}
		});
		self.select.bind( "focus", function() {
			if ( self.options.preventFocusZoom ) {
					$.mobile.zoom.disable( true );
			}
		});
		self.button.bind( "mouseup", function() {
			if ( self.options.preventFocusZoom ) {
				setTimeout(function() {
					$.mobile.zoom.enable( true );
				}, 0 );
			}
		});
		self.select.bind( "blur", function() {
			if ( self.options.preventFocusZoom ) {
				$.mobile.zoom.enable( true );
			}
		});

	},

	selected: function() {
		return this._selectOptions().filter( ":selected" );
	},

	selectedIndices: function() {
		var self = this;

		return this.selected().map(function() {
			return self._selectOptions().index( this );
		}).get();
	},

	setButtonText: function() {
		var self = this,
			selected = this.selected(),
			text = this.placeholder,
			span = $( document.createElement( "span" ) );

		this.button.children( "span" ).not( ".ui-li-count" ).remove().end().end().prepend( (function() {
			if ( selected.length ) {
				text = selected.map(function() {
					return $( this ).text();
				}).get().join( ", " );
			} else {
				text = self.placeholder;
			}

			if ( text ) {
				span.text( text );
			} else {

				// Set the contents to &nbsp; which we write as &#160; to be XHTML compliant - see gh-6699
				span.html( "&#160;" );
			}

			// TODO possibly aggregate multiple select option classes
			return span
				.addClass( self.select.attr( "class" ) )
				.addClass( selected.attr( "class" ) )
				.removeClass( "ui-screen-hidden" );
		})());
	},

	setButtonCount: function() {
		var selected = this.selected();

		// multiple count inside button
		if ( this.isMultiple ) {
			this.buttonCount[ selected.length > 1 ? "show" : "hide" ]().text( selected.length );
		}
	},

	_handleKeydown: function( /* event */ ) {
		this._delay( "_refreshButton" );
	},

	_reset: function() {
		this.refresh();
	},

	_refreshButton: function() {
		this.setButtonText();
		this.setButtonCount();
	},

	refresh: function() {
		this._refreshButton();
	},

	// open and close preserved in native selects
	// to simplify users code when looping over selects
	open: $.noop,
	close: $.noop,

	disable: function() {
		this._setDisabled( true );
		this.button.addClass( "ui-state-disabled" );
	},

	enable: function() {
		this._setDisabled( false );
		this.button.removeClass( "ui-state-disabled" );
	}
}, $.mobile.behaviors.formReset ) );

})( jQuery );

(function( $, undefined ) {

var popup;

function getPopup() {
	if ( !popup ) {
		popup = $( "<div></div>", {
			"class": "ui-slider-popup ui-shadow ui-corner-all"
		});
	}
	return popup.clone();
}

$.widget( "mobile.slider", $.mobile.slider, {
	options: {
		popupEnabled: false,
		showValue: false
	},

	_create: function() {
		this._super();

		$.extend( this, {
			_currentValue: null,
			_popup: null,
			_popupVisible: false
		});

		this._setOption( "popupEnabled", this.options.popupEnabled );

		this._on( this.handle, { "vmousedown" : "_showPopup" } );
		this._on( this.slider.add( this.document ), { "vmouseup" : "_hidePopup" } );
		this._refresh();
	},

	// position the popup centered 5px above the handle
	_positionPopup: function() {
		var dstOffset = this.handle.offset();

		this._popup.offset( {
			left: dstOffset.left + ( this.handle.width() - this._popup.width() ) / 2,
			top: dstOffset.top - this._popup.outerHeight() - 5
		});
	},

	_setOption: function( key, value ) {
		this._super( key, value );

		if ( key === "showValue" ) {
			this.handle.html( value && !this.options.mini ? this._value() : "" );
		} else if ( key === "popupEnabled" ) {
			if ( value && !this._popup ) {
				this._popup = getPopup()
					.addClass( "ui-body-" + ( this.options.theme || "a" ) )
					.hide()
					.insertBefore( this.element );
			}
		}
	},

	// show value on the handle and in popup
	refresh: function() {
		this._super.apply( this, arguments );
		this._refresh();
	},

	_refresh: function() {
		var o = this.options, newValue;

		if ( o.popupEnabled ) {
			// remove the title attribute from the handle (which is
			// responsible for the annoying tooltip); NB we have
			// to do it here as the jqm slider sets it every time
			// the slider's value changes :(
			this.handle.removeAttr( "title" );
		}

		newValue = this._value();
		if ( newValue === this._currentValue ) {
			return;
		}
		this._currentValue = newValue;

		if ( o.popupEnabled && this._popup ) {
			this._positionPopup();
			this._popup.html( newValue );
		}

		if ( o.showValue && !this.options.mini ) {
			this.handle.html( newValue );
		}
	},

	_showPopup: function() {
		if ( this.options.popupEnabled && !this._popupVisible ) {
			this.handle.html( "" );
			this._popup.show();
			this._positionPopup();
			this._popupVisible = true;
		}
	},

	_hidePopup: function() {
		var o = this.options;

		if ( o.popupEnabled && this._popupVisible ) {
			if ( o.showValue && !o.mini ) {
				this.handle.html( this._value() );
			}
			this._popup.hide();
			this._popupVisible = false;
		}
	}
});

})( jQuery );

(function( $, undefined ) {

var getAttr = $.mobile.getAttribute;

$.widget( "mobile.listview", $.extend( {

	options: {
		theme: null,
		countTheme: null, /* Deprecated in 1.4 */
		dividerTheme: null,
		icon: "carat-r",
		splitIcon: "carat-r",
		splitTheme: null,
		corners: true,
		shadow: true,
		inset: false
	},

	_create: function() {
		var t = this,
			listviewClasses = "";

		listviewClasses += t.options.inset ? " ui-listview-inset" : "";

		if ( !!t.options.inset ) {
			listviewClasses += t.options.corners ? " ui-corner-all" : "";
			listviewClasses += t.options.shadow ? " ui-shadow" : "";
		}

		// create listview markup
		t.element.addClass( " ui-listview" + listviewClasses );

		t.refresh( true );
	},

	// TODO: Remove in 1.5
	_findFirstElementByTagName: function( ele, nextProp, lcName, ucName ) {
		var dict = {};
		dict[ lcName ] = dict[ ucName ] = true;
		while ( ele ) {
			if ( dict[ ele.nodeName ] ) {
				return ele;
			}
			ele = ele[ nextProp ];
		}
		return null;
	},
	// TODO: Remove in 1.5
	_addThumbClasses: function( containers ) {
		var i, img, len = containers.length;
		for ( i = 0; i < len; i++ ) {
			img = $( this._findFirstElementByTagName( containers[ i ].firstChild, "nextSibling", "img", "IMG" ) );
			if ( img.length ) {
				$( this._findFirstElementByTagName( img[ 0 ].parentNode, "parentNode", "li", "LI" ) ).addClass( img.hasClass( "ui-li-icon" ) ? "ui-li-has-icon" : "ui-li-has-thumb" );
			}
		}
	},

	_getChildrenByTagName: function( ele, lcName, ucName ) {
		var results = [],
			dict = {};
		dict[ lcName ] = dict[ ucName ] = true;
		ele = ele.firstChild;
		while ( ele ) {
			if ( dict[ ele.nodeName ] ) {
				results.push( ele );
			}
			ele = ele.nextSibling;
		}
		return $( results );
	},

	_beforeListviewRefresh: $.noop,
	_afterListviewRefresh: $.noop,

	refresh: function( create ) {
		var buttonClass, pos, numli, item, itemClass, itemTheme, itemIcon, icon, a,
			isDivider, startCount, newStartCount, value, last, splittheme, splitThemeClass, spliticon,
			altButtonClass, dividerTheme, li,
			o = this.options,
			$list = this.element,
			ol = !!$.nodeName( $list[ 0 ], "ol" ),
			start = $list.attr( "start" ),
			itemClassDict = {},
			countBubbles = $list.find( ".ui-li-count" ),
			countTheme = getAttr( $list[ 0 ], "counttheme" ) || this.options.countTheme,
			countThemeClass = countTheme ? "ui-body-" + countTheme : "ui-body-inherit";

		if ( o.theme ) {
			$list.addClass( "ui-group-theme-" + o.theme );
		}

		// Check if a start attribute has been set while taking a value of 0 into account
		if ( ol && ( start || start === 0 ) ) {
			startCount = parseInt( start, 10 ) - 1;
			$list.css( "counter-reset", "listnumbering " + startCount );
		}

		this._beforeListviewRefresh();

		li = this._getChildrenByTagName( $list[ 0 ], "li", "LI" );

		for ( pos = 0, numli = li.length; pos < numli; pos++ ) {
			item = li.eq( pos );
			itemClass = "";

			if ( create || item[ 0 ].className.search( /\bui-li-static\b|\bui-li-divider\b/ ) < 0 ) {
				a = this._getChildrenByTagName( item[ 0 ], "a", "A" );
				isDivider = ( getAttr( item[ 0 ], "role" ) === "list-divider" );
				value = item.attr( "value" );
				itemTheme = getAttr( item[ 0 ], "theme" );

				if ( a.length && a[ 0 ].className.search( /\bui-btn\b/ ) < 0 && !isDivider ) {
					itemIcon = getAttr( item[ 0 ], "icon" );
					icon = ( itemIcon === false ) ? false : ( itemIcon || o.icon );

					// TODO: Remove in 1.5 together with links.js (links.js / .ui-link deprecated in 1.4)
					a.removeClass( "ui-link" );

					buttonClass = "ui-btn";

					if ( itemTheme ) {
						buttonClass += " ui-btn-" + itemTheme;
					}

					if ( a.length > 1 ) {
						itemClass = "ui-li-has-alt";

						last = a.last();
						splittheme = getAttr( last[ 0 ], "theme" ) || o.splitTheme || getAttr( item[ 0 ], "theme", true );
						splitThemeClass = splittheme ? " ui-btn-" + splittheme : "";
						spliticon = getAttr( last[ 0 ], "icon" ) || getAttr( item[ 0 ], "icon" ) || o.splitIcon;
						altButtonClass = "ui-btn ui-btn-icon-notext ui-icon-" + spliticon + splitThemeClass;

						last
							.attr( "title", $.trim( last.getEncodedText() ) )
							.addClass( altButtonClass )
							.empty();

						// Reduce to the first anchor, because only the first gets the buttonClass
						a = a.first();
					} else if ( icon ) {
						buttonClass += " ui-btn-icon-right ui-icon-" + icon;
					}

					// Apply buttonClass to the (first) anchor
					a.addClass( buttonClass );
				} else if ( isDivider ) {
					dividerTheme = ( getAttr( item[ 0 ], "theme" ) || o.dividerTheme || o.theme );

					itemClass = "ui-li-divider ui-bar-" + ( dividerTheme ? dividerTheme : "inherit" );

					item.attr( "role", "heading" );
				} else if ( a.length <= 0 ) {
					itemClass = "ui-li-static ui-body-" + ( itemTheme ? itemTheme : "inherit" );
				}
				if ( ol && value ) {
					newStartCount = parseInt( value , 10 ) - 1;

					item.css( "counter-reset", "listnumbering " + newStartCount );
				}
			}

			// Instead of setting item class directly on the list item
			// at this point in time, push the item into a dictionary
			// that tells us what class to set on it so we can do this after this
			// processing loop is finished.

			if ( !itemClassDict[ itemClass ] ) {
				itemClassDict[ itemClass ] = [];
			}

			itemClassDict[ itemClass ].push( item[ 0 ] );
		}

		// Set the appropriate listview item classes on each list item.
		// The main reason we didn't do this
		// in the for-loop above is because we can eliminate per-item function overhead
		// by calling addClass() and children() once or twice afterwards. This
		// can give us a significant boost on platforms like WP7.5.

		for ( itemClass in itemClassDict ) {
			$( itemClassDict[ itemClass ] ).addClass( itemClass );
		}

		countBubbles.each( function() {
			$( this ).closest( "li" ).addClass( "ui-li-has-count" );
		});
		if ( countThemeClass ) {
			countBubbles.not( "[class*='ui-body-']" ).addClass( countThemeClass );
		}

		// Deprecated in 1.4. From 1.5 you have to add class ui-li-has-thumb or ui-li-has-icon to the LI.
		this._addThumbClasses( li );
		this._addThumbClasses( li.find( ".ui-btn" ) );

		this._afterListviewRefresh();

		this._addFirstLastClasses( li, this._getVisibles( li, create ), create );
	}
}, $.mobile.behaviors.addFirstLastClasses ) );

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.navbar", {
	options: {
		iconpos: "top",
		grid: null
	},

	_create: function() {

		var $navbar = this.element,
			$navbtns = $navbar.find( "a, button" ),
			iconpos = $navbtns.filter( ":jqmData(icon)" ).length ? this.options.iconpos : undefined;

		$navbar.addClass( "ui-navbar" )
			.attr( "role", "navigation" )
			.find( "ul" )
			.jqmEnhanceable()
			.grid({ grid: this.options.grid });

		$navbtns
			.each( function() {
				var icon = $.mobile.getAttribute( this, "icon" ),
					theme = $.mobile.getAttribute( this, "theme" ),
					classes = "ui-btn";

				if ( theme ) {
					classes += " ui-btn-" + theme;
				}
				if ( icon ) {
					classes += " ui-icon-" + icon + " ui-btn-icon-" + iconpos;
				}
				$( this ).addClass( classes );
			});

		$navbar.delegate( "a", "vclick", function( /* event */ ) {
			var activeBtn = $( this );

			if ( !( activeBtn.hasClass( "ui-state-disabled" ) ||

				// DEPRECATED as of 1.4.0 - remove after 1.4.0 release
				// only ui-state-disabled should be present thereafter
				activeBtn.hasClass( "ui-disabled" ) ||
				activeBtn.hasClass( $.mobile.activeBtnClass ) ) ) {

				$navbtns.removeClass( $.mobile.activeBtnClass );
				activeBtn.addClass( $.mobile.activeBtnClass );

				// The code below is a workaround to fix #1181
				$( document ).one( "pagehide", function() {
					activeBtn.removeClass( $.mobile.activeBtnClass );
				});
			}
		});

		// Buttons in the navbar with ui-state-persist class should regain their active state before page show
		$navbar.closest( ".ui-page" ).bind( "pagebeforeshow", function() {
			$navbtns.filter( ".ui-state-persist" ).addClass( $.mobile.activeBtnClass );
		});
	}
});

})( jQuery );

(function( $, undefined ) {

$.widget( "mobile.panel", {
	options: {
		classes: {
			panel: "ui-panel",
			panelOpen: "ui-panel-open",
			panelClosed: "ui-panel-closed",
			panelFixed: "ui-panel-fixed",
			panelInner: "ui-panel-inner",
			modal: "ui-panel-dismiss",
			modalOpen: "ui-panel-dismiss-open",
			pageContainer: "ui-panel-page-container",
			pageWrapper: "ui-panel-wrapper",
			pageFixedToolbar: "ui-panel-fixed-toolbar",
			pageContentPrefix: "ui-panel-page-content", /* Used for wrapper and fixed toolbars position, display and open classes. */
			animate: "ui-panel-animate"
		},
		animate: true,
		theme: null,
		position: "left",
		dismissible: true,
		display: "reveal", //accepts reveal, push, overlay
		swipeClose: true,
		positionFixed: false
	},

	_closeLink: null,
	_parentPage: null,
	_page: null,
	_modal: null,
	_panelInner: null,
	_wrapper: null,
	_fixedToolbars: null,

	_create: function() {
		var el = this.element,
			parentPage = el.closest( ".ui-page, :jqmData(role='page')" );

		// expose some private props to other methods
		$.extend( this, {
			_closeLink: el.find( ":jqmData(rel='close')" ),
			_parentPage: ( parentPage.length > 0 ) ? parentPage : false,
			_openedPage: null,
			_page: this._getPage,
			_panelInner: this._getPanelInner(),
			_fixedToolbars: this._getFixedToolbars
		});
		if ( this.options.display !== "overlay" ){
			this._getWrapper();
		}
		this._addPanelClasses();

		// if animating, add the class to do so
		if ( $.support.cssTransform3d && !!this.options.animate ) {
			this.element.addClass( this.options.classes.animate );
		}

		this._bindUpdateLayout();
		this._bindCloseEvents();
		this._bindLinkListeners();
		this._bindPageEvents();

		if ( !!this.options.dismissible ) {
			this._createModal();
		}

		this._bindSwipeEvents();
	},

	_getPanelInner: function() {
		var panelInner = this.element.find( "." + this.options.classes.panelInner );

		if ( panelInner.length === 0 ) {
			panelInner = this.element.children().wrapAll( "<div class='" + this.options.classes.panelInner + "' />" ).parent();
		}

		return panelInner;
	},

	_createModal: function() {
		var self = this,
			target = self._parentPage ? self._parentPage.parent() : self.element.parent();

		self._modal = $( "<div class='" + self.options.classes.modal + "'></div>" )
			.on( "mousedown", function() {
				self.close();
			})
			.appendTo( target );
	},

	_getPage: function() {
		var page = this._openedPage || this._parentPage || $( "." + $.mobile.activePageClass );

		return page;
	},

	_getWrapper: function() {
		var wrapper = this._page().find( "." + this.options.classes.pageWrapper );
		if ( wrapper.length === 0 ) {
			wrapper = this._page().children( ".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)" )
				.wrapAll( "<div class='" + this.options.classes.pageWrapper + "'></div>" )
				.parent();
		}

		this._wrapper = wrapper;
	},

	_getFixedToolbars: function() {
		var extFixedToolbars = $( "body" ).children( ".ui-header-fixed, .ui-footer-fixed" ),
			intFixedToolbars = this._page().find( ".ui-header-fixed, .ui-footer-fixed" ),
			fixedToolbars = extFixedToolbars.add( intFixedToolbars ).addClass( this.options.classes.pageFixedToolbar );

		return fixedToolbars;
	},

	_getPosDisplayClasses: function( prefix ) {
		return prefix + "-position-" + this.options.position + " " + prefix + "-display-" + this.options.display;
	},

	_getPanelClasses: function() {
		var panelClasses = this.options.classes.panel +
			" " + this._getPosDisplayClasses( this.options.classes.panel ) +
			" " + this.options.classes.panelClosed +
			" " + "ui-body-" + ( this.options.theme ? this.options.theme : "inherit" );

		if ( !!this.options.positionFixed ) {
			panelClasses += " " + this.options.classes.panelFixed;
		}

		return panelClasses;
	},

	_addPanelClasses: function() {
		this.element.addClass( this._getPanelClasses() );
	},

	_handleCloseClick: function( event ) {
		if ( !event.isDefaultPrevented() ) {
			this.close();
		}
	},

	_bindCloseEvents: function() {
		this._on( this._closeLink, {
			"click": "_handleCloseClick"
		});

		this._on({
			"click a:jqmData(ajax='false')": "_handleCloseClick"
		});
	},

	_positionPanel: function( scrollToTop ) {
		var self = this,
			panelInnerHeight = self._panelInner.outerHeight(),
			expand = panelInnerHeight > $.mobile.getScreenHeight();

		if ( expand || !self.options.positionFixed ) {
			if ( expand ) {
				self._unfixPanel();
				$.mobile.resetActivePageHeight( panelInnerHeight );
			}
			if ( scrollToTop ) {
				this.window[ 0 ].scrollTo( 0, $.mobile.defaultHomeScroll );
			}
		} else {
			self._fixPanel();
		}
	},

	_bindFixListener: function() {
		this._on( $( window ), { "throttledresize": "_positionPanel" });
	},

	_unbindFixListener: function() {
		this._off( $( window ), "throttledresize" );
	},

	_unfixPanel: function() {
		if ( !!this.options.positionFixed && $.support.fixedPosition ) {
			this.element.removeClass( this.options.classes.panelFixed );
		}
	},

	_fixPanel: function() {
		if ( !!this.options.positionFixed && $.support.fixedPosition ) {
			this.element.addClass( this.options.classes.panelFixed );
		}
	},

	_bindUpdateLayout: function() {
		var self = this;

		self.element.on( "updatelayout", function(/* e */) {
			if ( self._open ) {
				self._positionPanel();
			}
		});
	},

	_bindLinkListeners: function() {
		this._on( "body", {
			"click a": "_handleClick"
		});

	},

	_handleClick: function( e ) {
		var link,
			panelId = this.element.attr( "id" );

		if ( e.currentTarget.href.split( "#" )[ 1 ] === panelId && panelId !== undefined ) {

			e.preventDefault();
			link = $( e.target );
			if ( link.hasClass( "ui-btn" ) ) {
				link.addClass( $.mobile.activeBtnClass );
				this.element.one( "panelopen panelclose", function() {
					link.removeClass( $.mobile.activeBtnClass );
				});
			}
			this.toggle();
		}
	},

	_bindSwipeEvents: function() {
		var self = this,
			area = self._modal ? self.element.add( self._modal ) : self.element;

		// on swipe, close the panel
		if ( !!self.options.swipeClose ) {
			if ( self.options.position === "left" ) {
				area.on( "swipeleft.panel", function(/* e */) {
					self.close();
				});
			} else {
				area.on( "swiperight.panel", function(/* e */) {
					self.close();
				});
			}
		}
	},

	_bindPageEvents: function() {
		var self = this;

		this.document
			// Close the panel if another panel on the page opens
			.on( "panelbeforeopen", function( e ) {
				if ( self._open && e.target !== self.element[ 0 ] ) {
					self.close();
				}
			})
			// On escape, close? might need to have a target check too...
			.on( "keyup.panel", function( e ) {
				if ( e.keyCode === 27 && self._open ) {
					self.close();
				}
			});
		if ( !this._parentPage && this.options.display !== "overlay" ) {
			this._on( this.document, {
				"pageshow": function() {
					this._openedPage = null;
					this._getWrapper();
				}
			});
		}
		// Clean up open panels after page hide
		if ( self._parentPage ) {
			this.document.on( "pagehide", ":jqmData(role='page')", function() {
				if ( self._open ) {
					self.close( true );
				}
			});
		} else {
			this.document.on( "pagebeforehide", function() {
				if ( self._open ) {
					self.close( true );
				}
			});
		}
	},

	// state storage of open or closed
	_open: false,
	_pageContentOpenClasses: null,
	_modalOpenClasses: null,

	open: function( immediate ) {
		if ( !this._open ) {
			var self = this,
				o = self.options,

				_openPanel = function() {
					self._off( self.document , "panelclose" );
					self._page().jqmData( "panel", "open" );

					if ( $.support.cssTransform3d && !!o.animate && o.display !== "overlay" ) {
						self._wrapper.addClass( o.classes.animate );
						self._fixedToolbars().addClass( o.classes.animate );
					}

					if ( !immediate && $.support.cssTransform3d && !!o.animate ) {
						( self._wrapper || self.element )
							.animationComplete( complete, "transition" );
					} else {
						setTimeout( complete, 0 );
					}

					if ( o.theme && o.display !== "overlay" ) {
						self._page().parent()
							.addClass( o.classes.pageContainer + "-themed " + o.classes.pageContainer + "-" + o.theme );
					}

					self.element
						.removeClass( o.classes.panelClosed )
						.addClass( o.classes.panelOpen );

					self._positionPanel( true );

					self._pageContentOpenClasses = self._getPosDisplayClasses( o.classes.pageContentPrefix );

					if ( o.display !== "overlay" ) {
						self._page().parent().addClass( o.classes.pageContainer );
						self._wrapper.addClass( self._pageContentOpenClasses );
						self._fixedToolbars().addClass( self._pageContentOpenClasses );
					}

					self._modalOpenClasses = self._getPosDisplayClasses( o.classes.modal ) + " " + o.classes.modalOpen;
					if ( self._modal ) {
						self._modal
							.addClass( self._modalOpenClasses )
							.height( Math.max( self._modal.height(), self.document.height() ) );
					}
				},
				complete = function() {

					// Bail if the panel was closed before the opening animation has completed
					if ( !self._open ) {
						return;
					}

					if ( o.display !== "overlay" ) {
						self._wrapper.addClass( o.classes.pageContentPrefix + "-open" );
						self._fixedToolbars().addClass( o.classes.pageContentPrefix + "-open" );
					}

					self._bindFixListener();

					self._trigger( "open" );

					self._openedPage = self._page();
				};

			self._trigger( "beforeopen" );

			if ( self._page().jqmData( "panel" ) === "open" ) {
				self._on( self.document, {
					"panelclose": _openPanel
				});
			} else {
				_openPanel();
			}

			self._open = true;
		}
	},

	close: function( immediate ) {
		if ( this._open ) {
			var self = this,
				o = this.options,

				_closePanel = function() {

					self.element.removeClass( o.classes.panelOpen );

					if ( o.display !== "overlay" ) {
						self._wrapper.removeClass( self._pageContentOpenClasses );
						self._fixedToolbars().removeClass( self._pageContentOpenClasses );
					}

					if ( !immediate && $.support.cssTransform3d && !!o.animate ) {
						( self._wrapper || self.element )
							.animationComplete( complete, "transition" );
					} else {
						setTimeout( complete, 0 );
					}

					if ( self._modal ) {
						self._modal
							.removeClass( self._modalOpenClasses )
							.height( "" );
					}
				},
				complete = function() {
					if ( o.theme && o.display !== "overlay" ) {
						self._page().parent().removeClass( o.classes.pageContainer + "-themed " + o.classes.pageContainer + "-" + o.theme );
					}

					self.element.addClass( o.classes.panelClosed );

					if ( o.display !== "overlay" ) {
						self._page().parent().removeClass( o.classes.pageContainer );
						self._wrapper.removeClass( o.classes.pageContentPrefix + "-open" );
						self._fixedToolbars().removeClass( o.classes.pageContentPrefix + "-open" );
					}

					if ( $.support.cssTransform3d && !!o.animate && o.display !== "overlay" ) {
						self._wrapper.removeClass( o.classes.animate );
						self._fixedToolbars().removeClass( o.classes.animate );
					}

					self._fixPanel();
					self._unbindFixListener();
					$.mobile.resetActivePageHeight();

					self._page().jqmRemoveData( "panel" );

					self._trigger( "close" );

					self._openedPage = null;
				};

			self._trigger( "beforeclose" );

			_closePanel();

			self._open = false;
		}
	},

	toggle: function() {
		this[ this._open ? "close" : "open" ]();
	},

	_destroy: function() {
		var otherPanels,
		o = this.options,
		multiplePanels = ( $( "body > :mobile-panel" ).length + $.mobile.activePage.find( ":mobile-panel" ).length ) > 1;

		if ( o.display !== "overlay" ) {

			//  remove the wrapper if not in use by another panel
			otherPanels = $( "body > :mobile-panel" ).add( $.mobile.activePage.find( ":mobile-panel" ) );
			if ( otherPanels.not( ".ui-panel-display-overlay" ).not( this.element ).length === 0 ) {
				this._wrapper.children().unwrap();
			}

			if ( this._open ) {

				this._fixedToolbars().removeClass( o.classes.pageContentPrefix + "-open" );

				if ( $.support.cssTransform3d && !!o.animate ) {
					this._fixedToolbars().removeClass( o.classes.animate );
				}

				this._page().parent().removeClass( o.classes.pageContainer );

				if ( o.theme ) {
					this._page().parent().removeClass( o.classes.pageContainer + "-themed " + o.classes.pageContainer + "-" + o.theme );
				}
			}
		}

		if ( !multiplePanels ) {

			this.document.off( "panelopen panelclose" );

		}

		if ( this._open ) {
			this._page().jqmRemoveData( "panel" );
		}

		this._panelInner.children().unwrap();

		this.element
			.removeClass( [ this._getPanelClasses(), o.classes.panelOpen, o.classes.animate ].join( " " ) )
			.off( "swipeleft.panel swiperight.panel" )
			.off( "panelbeforeopen" )
			.off( "panelhide" )
			.off( "keyup.panel" )
			.off( "updatelayout" );

		if ( this._modal ) {
			this._modal.remove();
		}
	}
});

})( jQuery );

(function( $, undefined ) {

function fitSegmentInsideSegment( windowSize, segmentSize, offset, desired ) {
	var returnValue = desired;

	if ( windowSize < segmentSize ) {
		// Center segment if it's bigger than the window
		returnValue = offset + ( windowSize - segmentSize ) / 2;
	} else {
		// Otherwise center it at the desired coordinate while keeping it completely inside the window
		returnValue = Math.min( Math.max( offset, desired - segmentSize / 2 ), offset + windowSize - segmentSize );
	}

	return returnValue;
}

function getWindowCoordinates( theWindow ) {
	return {
		x: theWindow.scrollLeft(),
		y: theWindow.scrollTop(),
		cx: ( theWindow[ 0 ].innerWidth || theWindow.width() ),
		cy: ( theWindow[ 0 ].innerHeight || theWindow.height() )
	};
}

$.widget( "mobile.popup", {
	options: {
		wrapperClass: null,
		theme: null,
		overlayTheme: null,
		shadow: true,
		corners: true,
		transition: "none",
		positionTo: "origin",
		tolerance: null,
		closeLinkSelector: "a:jqmData(rel='back')",
		closeLinkEvents: "click.popup",
		navigateEvents: "navigate.popup",
		closeEvents: "navigate.popup pagebeforechange.popup",
		dismissible: true,
		enhanced: false,

		// NOTE Windows Phone 7 has a scroll position caching issue that
		//      requires us to disable popup history management by default
		//      https://github.com/jquery/jquery-mobile/issues/4784
		//
		// NOTE this option is modified in _create!
		history: !$.mobile.browser.oldIE
	},

	// When the user depresses the mouse/finger on an element inside the popup while the popup is
	// open, we ignore resize events for a short while. This prevents #6961.
	_handleDocumentVmousedown: function( theEvent ) {
		if ( this._isOpen && $.contains( this._ui.container[ 0 ], theEvent.target ) ) {
			this._ignoreResizeEvents();
		}
	},

	_create: function() {
		var theElement = this.element,
			myId = theElement.attr( "id" ),
			currentOptions = this.options;

		// We need to adjust the history option to be false if there's no AJAX nav.
		// We can't do it in the option declarations because those are run before
		// it is determined whether there shall be AJAX nav.
		currentOptions.history = currentOptions.history && $.mobile.ajaxEnabled && $.mobile.hashListeningEnabled;

		this._on( this.document, {
			"vmousedown": "_handleDocumentVmousedown"
		});

		// Define instance variables
		$.extend( this, {
			_scrollTop: 0,
			_page: theElement.closest( ".ui-page" ),
			_ui: null,
			_fallbackTransition: "",
			_currentTransition: false,
			_prerequisites: null,
			_isOpen: false,
			_tolerance: null,
			_resizeData: null,
			_ignoreResizeTo: 0,
			_orientationchangeInProgress: false
		});

		if ( this._page.length === 0 ) {
			this._page = $( "body" );
		}

		if ( currentOptions.enhanced ) {
			this._ui = {
				container: theElement.parent(),
				screen: theElement.parent().prev(),
				placeholder: $( this.document[ 0 ].getElementById( myId + "-placeholder" ) )
			};
		} else {
			this._ui = this._enhance( theElement, myId );
			this._applyTransition( currentOptions.transition );
		}
		this
			._setTolerance( currentOptions.tolerance )
			._ui.focusElement = this._ui.container;

		// Event handlers
		this._on( this._ui.screen, { "vclick": "_eatEventAndClose" } );
		this._on( this.window, {
			orientationchange: $.proxy( this, "_handleWindowOrientationchange" ),
			resize: $.proxy( this, "_handleWindowResize" ),
			keyup: $.proxy( this, "_handleWindowKeyUp" )
		});
		this._on( this.document, { "focusin": "_handleDocumentFocusIn" } );
	},

	_enhance: function( theElement, myId ) {
		var currentOptions = this.options,
			wrapperClass = currentOptions.wrapperClass,
			ui = {
				screen: $( "<div class='ui-screen-hidden ui-popup-screen " +
				this._themeClassFromOption( "ui-overlay-", currentOptions.overlayTheme ) + "'></div>" ),
				placeholder: $( "<div style='display: none;'><!-- placeholder --></div>" ),
				container: $( "<div class='ui-popup-container ui-popup-hidden ui-popup-truncate" +
					( wrapperClass ? ( " " + wrapperClass ) : "" ) + "'></div>" )
			},
			fragment = this.document[ 0 ].createDocumentFragment();

		fragment.appendChild( ui.screen[ 0 ] );
		fragment.appendChild( ui.container[ 0 ] );

		if ( myId ) {
			ui.screen.attr( "id", myId + "-screen" );
			ui.container.attr( "id", myId + "-popup" );
			ui.placeholder
				.attr( "id", myId + "-placeholder" )
				.html( "<!-- placeholder for " + myId + " -->" );
		}

		// Apply the proto
		this._page[ 0 ].appendChild( fragment );
		// Leave a placeholder where the element used to be
		ui.placeholder.insertAfter( theElement );
		theElement
			.detach()
			.addClass( "ui-popup " +
				this._themeClassFromOption( "ui-body-", currentOptions.theme ) + " " +
				( currentOptions.shadow ? "ui-overlay-shadow " : "" ) +
				( currentOptions.corners ? "ui-corner-all " : "" ) )
			.appendTo( ui.container );

		return ui;
	},

	_eatEventAndClose: function( theEvent ) {
		theEvent.preventDefault();
		theEvent.stopImmediatePropagation();
		if ( this.options.dismissible ) {
			this.close();
		}
		return false;
	},

	// Make sure the screen covers the entire document - CSS is sometimes not
	// enough to accomplish this.
	_resizeScreen: function() {
		var screen = this._ui.screen,
			popupHeight = this._ui.container.outerHeight( true ),
			screenHeight = screen.removeAttr( "style" ).height(),

			// Subtracting 1 here is necessary for an obscure Andrdoid 4.0 bug where
			// the browser hangs if the screen covers the entire document :/
			documentHeight = this.document.height() - 1;

		if ( screenHeight < documentHeight ) {
			screen.height( documentHeight );
		} else if ( popupHeight > screenHeight ) {
			screen.height( popupHeight );
		}
	},

	_handleWindowKeyUp: function( theEvent ) {
		if ( this._isOpen && theEvent.keyCode === $.mobile.keyCode.ESCAPE ) {
			return this._eatEventAndClose( theEvent );
		}
	},

	_expectResizeEvent: function() {
		var windowCoordinates = getWindowCoordinates( this.window );

		if ( this._resizeData ) {
			if ( windowCoordinates.x === this._resizeData.windowCoordinates.x &&
				windowCoordinates.y === this._resizeData.windowCoordinates.y &&
				windowCoordinates.cx === this._resizeData.windowCoordinates.cx &&
				windowCoordinates.cy === this._resizeData.windowCoordinates.cy ) {
				// timeout not refreshed
				return false;
			} else {
				// clear existing timeout - it will be refreshed below
				clearTimeout( this._resizeData.timeoutId );
			}
		}

		this._resizeData = {
			timeoutId: this._delay( "_resizeTimeout", 200 ),
			windowCoordinates: windowCoordinates
		};

		return true;
	},

	_resizeTimeout: function() {
		if ( this._isOpen ) {
			if ( !this._expectResizeEvent() ) {
				if ( this._ui.container.hasClass( "ui-popup-hidden" ) ) {
					// effectively rapid-open the popup while leaving the screen intact
					this._ui.container.removeClass( "ui-popup-hidden ui-popup-truncate" );
					this.reposition( { positionTo: "window" } );
					this._ignoreResizeEvents();
				}

				this._resizeScreen();
				this._resizeData = null;
				this._orientationchangeInProgress = false;
			}
		} else {
			this._resizeData = null;
			this._orientationchangeInProgress = false;
		}
	},

	_stopIgnoringResizeEvents: function() {
		this._ignoreResizeTo = 0;
	},

	_ignoreResizeEvents: function() {
		if ( this._ignoreResizeTo ) {
			clearTimeout( this._ignoreResizeTo );
		}
		this._ignoreResizeTo = this._delay( "_stopIgnoringResizeEvents", 1000 );
	},

	_handleWindowResize: function(/* theEvent */) {
		if ( this._isOpen && this._ignoreResizeTo === 0 ) {
			if ( ( this._expectResizeEvent() || this._orientationchangeInProgress ) &&
				!this._ui.container.hasClass( "ui-popup-hidden" ) ) {
				// effectively rapid-close the popup while leaving the screen intact
				this._ui.container
					.addClass( "ui-popup-hidden ui-popup-truncate" )
					.removeAttr( "style" );
			}
		}
	},

	_handleWindowOrientationchange: function(/* theEvent */) {
		if ( !this._orientationchangeInProgress && this._isOpen && this._ignoreResizeTo === 0 ) {
			this._expectResizeEvent();
			this._orientationchangeInProgress = true;
		}
	},

	// When the popup is open, attempting to focus on an element that is not a
	// child of the popup will redirect focus to the popup
	_handleDocumentFocusIn: function( theEvent ) {
		var target,
			targetElement = theEvent.target,
			ui = this._ui;

		if ( !this._isOpen ) {
			return;
		}

		if ( targetElement !== ui.container[ 0 ] ) {
			target = $( targetElement );
			if ( !$.contains( ui.container[ 0 ], targetElement ) ) {
				$( this.document[ 0 ].activeElement ).one( "focus", $.proxy( function() {
					this._safelyBlur( targetElement );
				}, this ) );
				ui.focusElement.focus();
				theEvent.preventDefault();
				theEvent.stopImmediatePropagation();
				return false;
			} else if ( ui.focusElement[ 0 ] === ui.container[ 0 ] ) {
				ui.focusElement = target;
			}
		}

		this._ignoreResizeEvents();
	},

	_themeClassFromOption: function( prefix, value ) {
		return ( value ? ( value === "none" ? "" : ( prefix + value ) ) : ( prefix + "inherit" ) );
	},

	_applyTransition: function( value ) {
		if ( value ) {
			this._ui.container.removeClass( this._fallbackTransition );
			if ( value !== "none" ) {
				this._fallbackTransition = $.mobile._maybeDegradeTransition( value );
				if ( this._fallbackTransition === "none" ) {
					this._fallbackTransition = "";
				}
				this._ui.container.addClass( this._fallbackTransition );
			}
		}

		return this;
	},

	_setOptions: function( newOptions ) {
		var currentOptions = this.options,
			theElement = this.element,
			screen = this._ui.screen;

		if ( newOptions.wrapperClass !== undefined ) {
			this._ui.container
				.removeClass( currentOptions.wrapperClass )
				.addClass( newOptions.wrapperClass );
		}

		if ( newOptions.theme !== undefined ) {
			theElement
				.removeClass( this._themeClassFromOption( "ui-body-", currentOptions.theme ) )
				.addClass( this._themeClassFromOption( "ui-body-", newOptions.theme ) );
		}

		if ( newOptions.overlayTheme !== undefined ) {
			screen
				.removeClass( this._themeClassFromOption( "ui-overlay-", currentOptions.overlayTheme ) )
				.addClass( this._themeClassFromOption( "ui-overlay-", newOptions.overlayTheme ) );

			if ( this._isOpen ) {
				screen.addClass( "in" );
			}
		}

		if ( newOptions.shadow !== undefined ) {
			theElement.toggleClass( "ui-overlay-shadow", newOptions.shadow );
		}

		if ( newOptions.corners !== undefined ) {
			theElement.toggleClass( "ui-corner-all", newOptions.corners );
		}

		if ( newOptions.transition !== undefined ) {
			if ( !this._currentTransition ) {
				this._applyTransition( newOptions.transition );
			}
		}

		if ( newOptions.tolerance !== undefined ) {
			this._setTolerance( newOptions.tolerance );
		}

		if ( newOptions.disabled !== undefined ) {
			if ( newOptions.disabled ) {
				this.close();
			}
		}

		return this._super( newOptions );
	},

	_setTolerance: function( value ) {
		var tol = { t: 30, r: 15, b: 30, l: 15 },
			ar;

		if ( value !== undefined ) {
			ar = String( value ).split( "," );

			$.each( ar, function( idx, val ) { ar[ idx ] = parseInt( val, 10 ); } );

			switch( ar.length ) {
				// All values are to be the same
				case 1:
					if ( !isNaN( ar[ 0 ] ) ) {
						tol.t = tol.r = tol.b = tol.l = ar[ 0 ];
					}
					break;

				// The first value denotes top/bottom tolerance, and the second value denotes left/right tolerance
				case 2:
					if ( !isNaN( ar[ 0 ] ) ) {
						tol.t = tol.b = ar[ 0 ];
					}
					if ( !isNaN( ar[ 1 ] ) ) {
						tol.l = tol.r = ar[ 1 ];
					}
					break;

				// The array contains values in the order top, right, bottom, left
				case 4:
					if ( !isNaN( ar[ 0 ] ) ) {
						tol.t = ar[ 0 ];
					}
					if ( !isNaN( ar[ 1 ] ) ) {
						tol.r = ar[ 1 ];
					}
					if ( !isNaN( ar[ 2 ] ) ) {
						tol.b = ar[ 2 ];
					}
					if ( !isNaN( ar[ 3 ] ) ) {
						tol.l = ar[ 3 ];
					}
					break;

				default:
					break;
			}
		}

		this._tolerance = tol;
		return this;
	},

	_clampPopupWidth: function( infoOnly ) {
		var menuSize,
			windowCoordinates = getWindowCoordinates( this.window ),
			// rectangle within which the popup must fit
			rectangle = {
				x: this._tolerance.l,
				y: windowCoordinates.y + this._tolerance.t,
				cx: windowCoordinates.cx - this._tolerance.l - this._tolerance.r,
				cy: windowCoordinates.cy - this._tolerance.t - this._tolerance.b
			};

		if ( !infoOnly ) {
			// Clamp the width of the menu before grabbing its size
			this._ui.container.css( "max-width", rectangle.cx );
		}

		menuSize = {
			cx: this._ui.container.outerWidth( true ),
			cy: this._ui.container.outerHeight( true )
		};

		return { rc: rectangle, menuSize: menuSize };
	},

	_calculateFinalLocation: function( desired, clampInfo ) {
		var returnValue,
			rectangle = clampInfo.rc,
			menuSize = clampInfo.menuSize;

		// Center the menu over the desired coordinates, while not going outside
		// the window tolerances. This will center wrt. the window if the popup is
		// too large.
		returnValue = {
			left: fitSegmentInsideSegment( rectangle.cx, menuSize.cx, rectangle.x, desired.x ),
			top: fitSegmentInsideSegment( rectangle.cy, menuSize.cy, rectangle.y, desired.y )
		};

		// Make sure the top of the menu is visible
		returnValue.top = Math.max( 0, returnValue.top );

		// If the height of the menu is smaller than the height of the document
		// align the bottom with the bottom of the document

		returnValue.top -= Math.min( returnValue.top,
			Math.max( 0, returnValue.top + menuSize.cy - this.document.height() ) );

		return returnValue;
	},

	// Try and center the overlay over the given coordinates
	_placementCoords: function( desired ) {
		return this._calculateFinalLocation( desired, this._clampPopupWidth() );
	},

	_createPrerequisites: function( screenPrerequisite, containerPrerequisite, whenDone ) {
		var prerequisites,
			self = this;

		// It is important to maintain both the local variable prerequisites and
		// self._prerequisites. The local variable remains in the closure of the
		// functions which call the callbacks passed in. The comparison between the
		// local variable and self._prerequisites is necessary, because once a
		// function has been passed to .animationComplete() it will be called next
		// time an animation completes, even if that's not the animation whose end
		// the function was supposed to catch (for example, if an abort happens
		// during the opening animation, the .animationComplete handler is not
		// called for that animation anymore, but the handler remains attached, so
		// it is called the next time the popup is opened - making it stale.
		// Comparing the local variable prerequisites to the widget-level variable
		// self._prerequisites ensures that callbacks triggered by a stale
		// .animationComplete will be ignored.

		prerequisites = {
			screen: $.Deferred(),
			container: $.Deferred()
		};

		prerequisites.screen.then( function() {
			if ( prerequisites === self._prerequisites ) {
				screenPrerequisite();
			}
		});

		prerequisites.container.then( function() {
			if ( prerequisites === self._prerequisites ) {
				containerPrerequisite();
			}
		});

		$.when( prerequisites.screen, prerequisites.container ).done( function() {
			if ( prerequisites === self._prerequisites ) {
				self._prerequisites = null;
				whenDone();
			}
		});

		self._prerequisites = prerequisites;
	},

	_animate: function( args ) {
		// NOTE before removing the default animation of the screen
		//      this had an animate callback that would resolve the deferred
		//      now the deferred is resolved immediately
		// TODO remove the dependency on the screen deferred
		this._ui.screen
			.removeClass( args.classToRemove )
			.addClass( args.screenClassToAdd );

		args.prerequisites.screen.resolve();

		if ( args.transition && args.transition !== "none" ) {
			if ( args.applyTransition ) {
				this._applyTransition( args.transition );
			}
			if ( this._fallbackTransition ) {
				this._ui.container
					.addClass( args.containerClassToAdd )
					.removeClass( args.classToRemove )
					.animationComplete( $.proxy( args.prerequisites.container, "resolve" ) );
				return;
			}
		}
		this._ui.container.removeClass( args.classToRemove );
		args.prerequisites.container.resolve();
	},

	// The desired coordinates passed in will be returned untouched if no reference element can be identified via
	// desiredPosition.positionTo. Nevertheless, this function ensures that its return value always contains valid
	// x and y coordinates by specifying the center middle of the window if the coordinates are absent.
	// options: { x: coordinate, y: coordinate, positionTo: string: "origin", "window", or jQuery selector
	_desiredCoords: function( openOptions ) {
		var offset,
			dst = null,
			windowCoordinates = getWindowCoordinates( this.window ),
			x = openOptions.x,
			y = openOptions.y,
			pTo = openOptions.positionTo;

		// Establish which element will serve as the reference
		if ( pTo && pTo !== "origin" ) {
			if ( pTo === "window" ) {
				x = windowCoordinates.cx / 2 + windowCoordinates.x;
				y = windowCoordinates.cy / 2 + windowCoordinates.y;
			} else {
				try {
					dst = $( pTo );
				} catch( err ) {
					dst = null;
				}
				if ( dst ) {
					dst.filter( ":visible" );
					if ( dst.length === 0 ) {
						dst = null;
					}
				}
			}
		}

		// If an element was found, center over it
		if ( dst ) {
			offset = dst.offset();
			x = offset.left + dst.outerWidth() / 2;
			y = offset.top + dst.outerHeight() / 2;
		}

		// Make sure x and y are valid numbers - center over the window
		if ( $.type( x ) !== "number" || isNaN( x ) ) {
			x = windowCoordinates.cx / 2 + windowCoordinates.x;
		}
		if ( $.type( y ) !== "number" || isNaN( y ) ) {
			y = windowCoordinates.cy / 2 + windowCoordinates.y;
		}

		return { x: x, y: y };
	},

	_reposition: function( openOptions ) {
		// We only care about position-related parameters for repositioning
		openOptions = {
			x: openOptions.x,
			y: openOptions.y,
			positionTo: openOptions.positionTo
		};
		this._trigger( "beforeposition", undefined, openOptions );
		this._ui.container.offset( this._placementCoords( this._desiredCoords( openOptions ) ) );
	},

	reposition: function( openOptions ) {
		if ( this._isOpen ) {
			this._reposition( openOptions );
		}
	},

	_safelyBlur: function( currentElement ){
		if ( currentElement !== this.window[ 0 ] &&
			currentElement.nodeName.toLowerCase() !== "body" ) {
				$( currentElement ).blur();
		}
	},

	_openPrerequisitesComplete: function() {
		var id = this.element.attr( "id" ),
			firstFocus = this._ui.container.find( ":focusable" ).first();

		this._ui.container.addClass( "ui-popup-active" );
		this._isOpen = true;
		this._resizeScreen();

		// Check to see if currElement is not a child of the container.  If it's not, blur
		if ( !$.contains( this._ui.container[ 0 ], this.document[ 0 ].activeElement ) ) {
			this._safelyBlur( this.document[ 0 ].activeElement );
		}
		if ( firstFocus.length > 0 ) {
			this._ui.focusElement = firstFocus;
		}
		this._ignoreResizeEvents();
		if ( id ) {
			this.document.find( "[aria-haspopup='true'][aria-owns='" +  id + "']" ).attr( "aria-expanded", true );
		}
		this._trigger( "afteropen" );
	},

	_open: function( options ) {
		var openOptions = $.extend( {}, this.options, options ),
			// TODO move blacklist to private method
			androidBlacklist = ( function() {
				var ua = navigator.userAgent,
					// Rendering engine is Webkit, and capture major version
					wkmatch = ua.match( /AppleWebKit\/([0-9\.]+)/ ),
					wkversion = !!wkmatch && wkmatch[ 1 ],
					androidmatch = ua.match( /Android (\d+(?:\.\d+))/ ),
					andversion = !!androidmatch && androidmatch[ 1 ],
					chromematch = ua.indexOf( "Chrome" ) > -1;

				// Platform is Android, WebKit version is greater than 534.13 ( Android 3.2.1 ) and not Chrome.
				if ( androidmatch !== null && andversion === "4.0" && wkversion && wkversion > 534.13 && !chromematch ) {
					return true;
				}
				return false;
			}());

		// Count down to triggering "popupafteropen" - we have two prerequisites:
		// 1. The popup window animation completes (container())
		// 2. The screen opacity animation completes (screen())
		this._createPrerequisites(
			$.noop,
			$.noop,
			$.proxy( this, "_openPrerequisitesComplete" ) );

		this._currentTransition = openOptions.transition;
		this._applyTransition( openOptions.transition );

		this._ui.screen.removeClass( "ui-screen-hidden" );
		this._ui.container.removeClass( "ui-popup-truncate" );

		// Give applications a chance to modify the contents of the container before it appears
		this._reposition( openOptions );

		this._ui.container.removeClass( "ui-popup-hidden" );

		if ( this.options.overlayTheme && androidBlacklist ) {
			/* TODO: The native browser on Android 4.0.X ("Ice Cream Sandwich") suffers from an issue where the popup overlay appears to be z-indexed above the popup itself when certain other styles exist on the same page -- namely, any element set to `position: fixed` and certain types of input. These issues are reminiscent of previously uncovered bugs in older versions of Android's native browser: https://github.com/scottjehl/Device-Bugs/issues/3
			This fix closes the following bugs ( I use "closes" with reluctance, and stress that this issue should be revisited as soon as possible ):
			https://github.com/jquery/jquery-mobile/issues/4816
			https://github.com/jquery/jquery-mobile/issues/4844
			https://github.com/jquery/jquery-mobile/issues/4874
			*/

			// TODO sort out why this._page isn't working
			this.element.closest( ".ui-page" ).addClass( "ui-popup-open" );
		}
		this._animate({
			additionalCondition: true,
			transition: openOptions.transition,
			classToRemove: "",
			screenClassToAdd: "in",
			containerClassToAdd: "in",
			applyTransition: false,
			prerequisites: this._prerequisites
		});
	},

	_closePrerequisiteScreen: function() {
		this._ui.screen
			.removeClass( "out" )
			.addClass( "ui-screen-hidden" );
	},

	_closePrerequisiteContainer: function() {
		this._ui.container
			.removeClass( "reverse out" )
			.addClass( "ui-popup-hidden ui-popup-truncate" )
			.removeAttr( "style" );
	},

	_closePrerequisitesDone: function() {
		var container = this._ui.container,
			id = this.element.attr( "id" );

		// remove the global mutex for popups
		$.mobile.popup.active = undefined;

		// Blur elements inside the container, including the container
		$( ":focus", container[ 0 ] ).add( container[ 0 ] ).blur();

		if ( id ) {
			this.document.find( "[aria-haspopup='true'][aria-owns='" +  id + "']" ).attr( "aria-expanded", false );
		}

		// alert users that the popup is closed
		this._trigger( "afterclose" );
	},

	_close: function( immediate ) {
		this._ui.container.removeClass( "ui-popup-active" );
		this._page.removeClass( "ui-popup-open" );

		this._isOpen = false;

		// Count down to triggering "popupafterclose" - we have two prerequisites:
		// 1. The popup window reverse animation completes (container())
		// 2. The screen opacity animation completes (screen())
		this._createPrerequisites(
			$.proxy( this, "_closePrerequisiteScreen" ),
			$.proxy( this, "_closePrerequisiteContainer" ),
			$.proxy( this, "_closePrerequisitesDone" ) );

		this._animate( {
			additionalCondition: this._ui.screen.hasClass( "in" ),
			transition: ( immediate ? "none" : ( this._currentTransition ) ),
			classToRemove: "in",
			screenClassToAdd: "out",
			containerClassToAdd: "reverse out",
			applyTransition: true,
			prerequisites: this._prerequisites
		});
	},

	_unenhance: function() {
		if ( this.options.enhanced ) {
			return;
		}

		// Put the element back to where the placeholder was and remove the "ui-popup" class
		this._setOptions( { theme: $.mobile.popup.prototype.options.theme } );
		this.element
			// Cannot directly insertAfter() - we need to detach() first, because
			// insertAfter() will do nothing if the payload div was not attached
			// to the DOM at the time the widget was created, and so the payload
			// will remain inside the container even after we call insertAfter().
			// If that happens and we remove the container a few lines below, we
			// will cause an infinite recursion - #5244
			.detach()
			.insertAfter( this._ui.placeholder )
			.removeClass( "ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit" );
		this._ui.screen.remove();
		this._ui.container.remove();
		this._ui.placeholder.remove();
	},

	_destroy: function() {
		if ( $.mobile.popup.active === this ) {
			this.element.one( "popupafterclose", $.proxy( this, "_unenhance" ) );
			this.close();
		} else {
			this._unenhance();
		}

		return this;
	},

	_closePopup: function( theEvent, data ) {
		var parsedDst, toUrl,
			currentOptions = this.options,
			immediate = false;

		if ( ( theEvent && theEvent.isDefaultPrevented() ) || $.mobile.popup.active !== this ) {
			return;
		}

		// restore location on screen
		window.scrollTo( 0, this._scrollTop );

		if ( theEvent && theEvent.type === "pagebeforechange" && data ) {
			// Determine whether we need to rapid-close the popup, or whether we can
			// take the time to run the closing transition
			if ( typeof data.toPage === "string" ) {
				parsedDst = data.toPage;
			} else {
				parsedDst = data.toPage.jqmData( "url" );
			}
			parsedDst = $.mobile.path.parseUrl( parsedDst );
			toUrl = parsedDst.pathname + parsedDst.search + parsedDst.hash;

			if ( this._myUrl !== $.mobile.path.makeUrlAbsolute( toUrl ) ) {
				// Going to a different page - close immediately
				immediate = true;
			} else {
				theEvent.preventDefault();
			}
		}

		// remove nav bindings
		this.window.off( currentOptions.closeEvents );
		// unbind click handlers added when history is disabled
		this.element.undelegate( currentOptions.closeLinkSelector, currentOptions.closeLinkEvents );

		this._close( immediate );
	},

	// any navigation event after a popup is opened should close the popup
	// NOTE the pagebeforechange is bound to catch navigation events that don't
	//      alter the url (eg, dialogs from popups)
	_bindContainerClose: function() {
		this.window
			.on( this.options.closeEvents, $.proxy( this, "_closePopup" ) );
	},

	widget: function() {
		return this._ui.container;
	},

	// TODO no clear deliniation of what should be here and
	// what should be in _open. Seems to be "visual" vs "history" for now
	open: function( options ) {
		var url, hashkey, activePage, currentIsDialog, hasHash, urlHistory,
			self = this,
			currentOptions = this.options;

		// make sure open is idempotent
		if ( $.mobile.popup.active || currentOptions.disabled ) {
			return this;
		}

		// set the global popup mutex
		$.mobile.popup.active = this;
		this._scrollTop = this.window.scrollTop();

		// if history alteration is disabled close on navigate events
		// and leave the url as is
		if ( !( currentOptions.history ) ) {
			self._open( options );
			self._bindContainerClose();

			// When histoy is disabled we have to grab the data-rel
			// back link clicks so we can close the popup instead of
			// relying on history to do it for us
			self.element
				.delegate( currentOptions.closeLinkSelector, currentOptions.closeLinkEvents, function( theEvent ) {
					self.close();
					theEvent.preventDefault();
				});

			return this;
		}

		// cache some values for min/readability
		urlHistory = $.mobile.navigate.history;
		hashkey = $.mobile.dialogHashKey;
		activePage = $.mobile.activePage;
		currentIsDialog = ( activePage ? activePage.hasClass( "ui-dialog" ) : false );
		this._myUrl = url = urlHistory.getActive().url;
		hasHash = ( url.indexOf( hashkey ) > -1 ) && !currentIsDialog && ( urlHistory.activeIndex > 0 );

		if ( hasHash ) {
			self._open( options );
			self._bindContainerClose();
			return this;
		}

		// if the current url has no dialog hash key proceed as normal
		// otherwise, if the page is a dialog simply tack on the hash key
		if ( url.indexOf( hashkey ) === -1 && !currentIsDialog ) {
			url = url + (url.indexOf( "#" ) > -1 ? hashkey : "#" + hashkey);
		} else {
			url = $.mobile.path.parseLocation().hash + hashkey;
		}

		// swallow the the initial navigation event, and bind for the next
		this.window.one( "beforenavigate", function( theEvent ) {
			theEvent.preventDefault();
			self._open( options );
			self._bindContainerClose();
		});

		this.urlAltered = true;
		$.mobile.navigate( url, { role: "dialog" } );

		return this;
	},

	close: function() {
		// make sure close is idempotent
		if ( $.mobile.popup.active !== this ) {
			return this;
		}

		this._scrollTop = this.window.scrollTop();

		if ( this.options.history && this.urlAltered ) {
			$.mobile.back();
			this.urlAltered = false;
		} else {
			// simulate the nav bindings having fired
			this._closePopup();
		}

		return this;
	}
});

// TODO this can be moved inside the widget
$.mobile.popup.handleLink = function( $link ) {
	var offset,
		path = $.mobile.path,

		// NOTE make sure to get only the hash from the href because ie7 (wp7)
		//      returns the absolute href in this case ruining the element selection
		popup = $( path.hashToSelector( path.parseUrl( $link.attr( "href" ) ).hash ) ).first();

	if ( popup.length > 0 && popup.data( "mobile-popup" ) ) {
		offset = $link.offset();
		popup.popup( "open", {
			x: offset.left + $link.outerWidth() / 2,
			y: offset.top + $link.outerHeight() / 2,
			transition: $link.jqmData( "transition" ),
			positionTo: $link.jqmData( "position-to" )
		});
	}

	//remove after delay
	setTimeout( function() {
		$link.removeClass( $.mobile.activeBtnClass );
	}, 300 );
};

// TODO move inside _create
$.mobile.document.on( "pagebeforechange", function( theEvent, data ) {
	if ( data.options.role === "popup" ) {
		$.mobile.popup.handleLink( data.options.link );
		theEvent.preventDefault();
	}
});

})( jQuery );


( function( $, undefined ) {

var ieHack = ( $.mobile.browser.oldIE && $.mobile.browser.oldIE <= 8 ),
	uiTemplate = $(
		"<div class='ui-popup-arrow-guide'></div>" +
		"<div class='ui-popup-arrow-container" + ( ieHack ? " ie" : "" ) + "'>" +
			"<div class='ui-popup-arrow'></div>" +
		"</div>"
	);

function getArrow() {
	var clone = uiTemplate.clone(),
		gd = clone.eq( 0 ),
		ct = clone.eq( 1 ),
		ar = ct.children();

	return { arEls: ct.add( gd ), gd: gd, ct: ct, ar: ar };
}

$.widget( "mobile.popup", $.mobile.popup, {
	options: {

		arrow: ""
	},

	_create: function() {
		var ar,
			ret = this._super();

		if ( this.options.arrow ) {
			this._ui.arrow = ar = this._addArrow();
		}

		return ret;
	},

	_addArrow: function() {
		var theme,
			opts = this.options,
			ar = getArrow();

		theme = this._themeClassFromOption( "ui-body-", opts.theme );
		ar.ar.addClass( theme + ( opts.shadow ? " ui-overlay-shadow" : "" ) );
		ar.arEls.hide().appendTo( this.element );

		return ar;
	},

	_unenhance: function() {
		var ar = this._ui.arrow;

		if ( ar ) {
			ar.arEls.remove();
		}

		return this._super();
	},

	// Pretend to show an arrow described by @p and @dir and calculate the
	// distance from the desired point. If a best-distance is passed in, return
	// the minimum of the one passed in and the one calculated.
	_tryAnArrow: function( p, dir, desired, s, best ) {
		var result, r, diff, desiredForArrow = {}, tip = {};

		// If the arrow has no wiggle room along the edge of the popup, it cannot
		// be displayed along the requested edge without it sticking out.
		if ( s.arFull[ p.dimKey ] > s.guideDims[ p.dimKey ] ) {
			return best;
		}

		desiredForArrow[ p.fst ] = desired[ p.fst ] +
			( s.arHalf[ p.oDimKey ] + s.menuHalf[ p.oDimKey ] ) * p.offsetFactor -
			s.contentBox[ p.fst ] + ( s.clampInfo.menuSize[ p.oDimKey ] - s.contentBox[ p.oDimKey ] ) * p.arrowOffsetFactor;
		desiredForArrow[ p.snd ] = desired[ p.snd ];

		result = s.result || this._calculateFinalLocation( desiredForArrow, s.clampInfo );
		r = { x: result.left, y: result.top };

		tip[ p.fst ] = r[ p.fst ] + s.contentBox[ p.fst ] + p.tipOffset;
		tip[ p.snd ] = Math.max( result[ p.prop ] + s.guideOffset[ p.prop ] + s.arHalf[ p.dimKey ],
			Math.min( result[ p.prop ] + s.guideOffset[ p.prop ] + s.guideDims[ p.dimKey ] - s.arHalf[ p.dimKey ],
				desired[ p.snd ] ) );

		diff = Math.abs( desired.x - tip.x ) + Math.abs( desired.y - tip.y );
		if ( !best || diff < best.diff ) {
			// Convert tip offset to coordinates inside the popup
			tip[ p.snd ] -= s.arHalf[ p.dimKey ] + result[ p.prop ] + s.contentBox[ p.snd ];
			best = { dir: dir, diff: diff, result: result, posProp: p.prop, posVal: tip[ p.snd ] };
		}

		return best;
	},

	_getPlacementState: function( clamp ) {
		var offset, gdOffset,
			ar = this._ui.arrow,
			state = {
				clampInfo: this._clampPopupWidth( !clamp ),
				arFull: { cx: ar.ct.width(), cy: ar.ct.height() },
				guideDims: { cx: ar.gd.width(), cy: ar.gd.height() },
				guideOffset: ar.gd.offset()
			};

		offset = this.element.offset();

		ar.gd.css( { left: 0, top: 0, right: 0, bottom: 0 } );
		gdOffset = ar.gd.offset();
		state.contentBox = {
			x: gdOffset.left - offset.left,
			y: gdOffset.top - offset.top,
			cx: ar.gd.width(),
			cy: ar.gd.height()
		};
		ar.gd.removeAttr( "style" );

		// The arrow box moves between guideOffset and guideOffset + guideDims - arFull
		state.guideOffset = { left: state.guideOffset.left - offset.left, top: state.guideOffset.top - offset.top };
		state.arHalf = { cx: state.arFull.cx / 2, cy: state.arFull.cy / 2 };
		state.menuHalf = { cx: state.clampInfo.menuSize.cx / 2, cy: state.clampInfo.menuSize.cy / 2 };

		return state;
	},

	_placementCoords: function( desired ) {
		var state, best, params, elOffset, bgRef,
			optionValue = this.options.arrow,
			ar = this._ui.arrow;

		if ( !ar ) {
			return this._super( desired );
		}

		ar.arEls.show();

		bgRef = {};
		state = this._getPlacementState( true );
		params = {
			"l": { fst: "x", snd: "y", prop: "top", dimKey: "cy", oDimKey: "cx", offsetFactor: 1, tipOffset:  -state.arHalf.cx, arrowOffsetFactor: 0 },
			"r": { fst: "x", snd: "y", prop: "top", dimKey: "cy", oDimKey: "cx", offsetFactor: -1, tipOffset: state.arHalf.cx + state.contentBox.cx, arrowOffsetFactor: 1 },
			"b": { fst: "y", snd: "x", prop: "left", dimKey: "cx", oDimKey: "cy", offsetFactor: -1, tipOffset: state.arHalf.cy + state.contentBox.cy, arrowOffsetFactor: 1 },
			"t": { fst: "y", snd: "x", prop: "left", dimKey: "cx", oDimKey: "cy", offsetFactor: 1, tipOffset: -state.arHalf.cy, arrowOffsetFactor: 0 }
		};

		// Try each side specified in the options to see on which one the arrow
		// should be placed such that the distance between the tip of the arrow and
		// the desired coordinates is the shortest.
		$.each( ( optionValue === true ? "l,t,r,b" : optionValue ).split( "," ),
			$.proxy( function( key, value ) {
				best = this._tryAnArrow( params[ value ], value, desired, state, best );
			}, this ) );

		// Could not place the arrow along any of the edges - behave as if showing
		// the arrow was turned off.
		if ( !best ) {
			ar.arEls.hide();
			return this._super( desired );
		}

		// Move the arrow into place
		ar.ct
			.removeClass( "ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b" )
			.addClass( "ui-popup-arrow-" + best.dir )
			.removeAttr( "style" ).css( best.posProp, best.posVal )
			.show();

		// Do not move/size the background div on IE, because we use the arrow div for background as well.
		if ( !ieHack ) {
			elOffset = this.element.offset();
			bgRef[ params[ best.dir ].fst ] = ar.ct.offset();
			bgRef[ params[ best.dir ].snd ] = {
				left: elOffset.left + state.contentBox.x,
				top: elOffset.top + state.contentBox.y
			};
		}

		return best.result;
	},

	_setOptions: function( opts ) {
		var newTheme,
			oldTheme = this.options.theme,
			ar = this._ui.arrow,
			ret = this._super( opts );

		if ( opts.arrow !== undefined ) {
			if ( !ar && opts.arrow ) {
				this._ui.arrow = this._addArrow();

				// Important to return here so we don't set the same options all over
				// again below.
				return;
			} else if ( ar && !opts.arrow ) {
				ar.arEls.remove();
				this._ui.arrow = null;
			}
		}

		// Reassign with potentially new arrow
		ar = this._ui.arrow;

		if ( ar ) {
			if ( opts.theme !== undefined ) {
				oldTheme = this._themeClassFromOption( "ui-body-", oldTheme );
				newTheme = this._themeClassFromOption( "ui-body-", opts.theme );
				ar.ar.removeClass( oldTheme ).addClass( newTheme );
			}

			if ( opts.shadow !== undefined ) {
				ar.ar.toggleClass( "ui-overlay-shadow", opts.shadow );
			}
		}

		return ret;
	},

	_destroy: function() {
		var ar = this._ui.arrow;

		if ( ar ) {
			ar.arEls.remove();
		}

		return this._super();
	}
});

})( jQuery );


(function( $, undefined ) {

$.widget( "mobile.table", {
	options: {
		classes: {
			table: "ui-table"
		},
		enhanced: false
	},

	_create: function() {
		if ( !this.options.enhanced ) {
			this.element.addClass( this.options.classes.table );
		}

		// extend here, assign on refresh > _setHeaders
		$.extend( this, {

			// Expose headers and allHeaders properties on the widget
			// headers references the THs within the first TR in the table
			headers: undefined,

			// allHeaders references headers, plus all THs in the thead, which may
			// include several rows, or not
			allHeaders: undefined
		});

		this._refresh( true );
	},

	_setHeaders: function() {
		var trs = this.element.find( "thead tr" );

		this.headers = this.element.find( "tr:eq(0)" ).children();
		this.allHeaders = this.headers.add( trs.children() );
	},

	refresh: function() {
		this._refresh();
	},

	rebuild: $.noop,

	_refresh: function( /* create */ ) {
		var table = this.element,
			trs = table.find( "thead tr" );

		// updating headers on refresh (fixes #5880)
		this._setHeaders();

		// Iterate over the trs
		trs.each( function() {
			var columnCount = 0;

			// Iterate over the children of the tr
			$( this ).children().each( function() {
				var span = parseInt( this.getAttribute( "colspan" ), 10 ),
					selector = ":nth-child(" + ( columnCount + 1 ) + ")",
					j;

				this.setAttribute( "data-" + $.mobile.ns + "colstart", columnCount + 1 );

				if ( span ) {
					for( j = 0; j < span - 1; j++ ) {
						columnCount++;
						selector += ", :nth-child(" + ( columnCount + 1 ) + ")";
					}
				}

				// Store "cells" data on header as a reference to all cells in the
				// same column as this TH
				$( this ).jqmData( "cells", table.find( "tr" ).not( trs.eq( 0 ) ).not( this ).children( selector ) );

				columnCount++;
			});
		});
	}
});

})( jQuery );


(function( $, undefined ) {

$.widget( "mobile.table", $.mobile.table, {
	options: {
		mode: "reflow",
		classes: $.extend( $.mobile.table.prototype.options.classes, {
			reflowTable: "ui-table-reflow",
			cellLabels: "ui-table-cell-label"
		})
	},

	_create: function() {
		this._super();

		// If it's not reflow mode, return here.
		if ( this.options.mode !== "reflow" ) {
			return;
		}

		if ( !this.options.enhanced ) {
			this.element.addClass( this.options.classes.reflowTable );

			this._updateReflow();
		}
	},

	rebuild: function() {
		this._super();

		if ( this.options.mode === "reflow" ) {
			this._refresh( false );
		}
	},

	_refresh: function( create ) {
		this._super( create );
		if ( !create && this.options.mode === "reflow" ) {
			this._updateReflow( );
		}
	},

	_updateReflow: function() {
		var table = this,
			opts = this.options;

		// get headers in reverse order so that top-level headers are appended last
		$( table.allHeaders.get().reverse() ).each( function() {
			var cells = $( this ).jqmData( "cells" ),
				colstart = $.mobile.getAttribute( this, "colstart" ),
				hierarchyClass = cells.not( this ).filter( "thead th" ).length && " ui-table-cell-label-top",
				contents = $( this ).clone().contents(),
				iteration, filter;

				if ( contents.length > 0  ) {

					if ( hierarchyClass ) {
						iteration = parseInt( this.getAttribute( "colspan" ), 10 );
						filter = "";

						if ( iteration ) {
							filter = "td:nth-child("+ iteration +"n + " + ( colstart ) +")";
						}

						table._addLabels( cells.filter( filter ),
							opts.classes.cellLabels + hierarchyClass, contents );
					} else {
						table._addLabels( cells, opts.classes.cellLabels, contents );
					}

				}
		});
	},

	_addLabels: function( cells, label, contents ) {
		if ( contents.length === 1 && contents[ 0 ].nodeName.toLowerCase() === "abbr" ) {
			contents = contents.eq( 0 ).attr( "title" );
		}
		// .not fixes #6006
		cells
			.not( ":has(b." + label + ")" )
				.prepend( $( "<b class='" + label + "'></b>" ).append( contents ) );
	}
});

})( jQuery );


}));

// THIS FILE IS GENERATED - DO NOT EDIT!
/*global module:false, define:false*/

(function (define, undefined) {
    define(function () {
        'use strict';

        var impl = {};

        impl.mobileDetectRules = {
            "phones": {
                "iPhone": "\\biPhone\\b|\\biPod\\b",
                "BlackBerry": "BlackBerry|\\bBB10\\b|rim[0-9]+",
                "HTC": "HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m",
                "Nexus": "Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6",
                "Dell": "Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b",
                "Motorola": "Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925",
                "Samsung": "Samsung|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8",
                "LG": "\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802)",
                "Sony": "SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533",
                "Asus": "Asus.*Galaxy|PadFone.*Mobile",
                "Micromax": "Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b",
                "Palm": "PalmSource|Palm",
                "Vertu": "Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature",
                "Pantech": "PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790",
                "Fly": "IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250",
                "Wiko": "KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM",
                "iMobile": "i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)",
                "SimValley": "\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b",
                "Wolfgang": "AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q",
                "Alcatel": "Alcatel",
                "Nintendo": "Nintendo 3DS",
                "Amoi": "Amoi",
                "INQ": "INQ",
                "GenericPhone": "Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser"
            },
            "tablets": {
                "iPad": "iPad|iPad.*Mobile",
                "NexusTablet": "Android.*Nexus[\\s]+(7|9|10)|^.*Android.*Nexus(?:(?!Mobile).)*$",
                "SamsungTablet": "SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-I9205|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237P|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T",
                "Kindle": "Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\b",
                "SurfaceTablet": "Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)",
                "HPTablet": "HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10",
                "AsusTablet": "^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL",
                "BlackBerryTablet": "PlayBook|RIM Tablet",
                "HTCtablet": "HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410",
                "MotorolaTablet": "xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617",
                "NookTablet": "Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2",
                "AcerTablet": "Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b",
                "ToshibaTablet": "Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO",
                "LGTablet": "\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b",
                "FujitsuTablet": "Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b",
                "PrestigioTablet": "PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD",
                "LenovoTablet": "Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)",
                "DellTablet": "Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7",
                "YarvikTablet": "Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b",
                "MedionTablet": "Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB",
                "ArnovaTablet": "AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2",
                "IntensoTablet": "INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004",
                "IRUTablet": "M702pro",
                "MegafonTablet": "MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b",
                "EbodaTablet": "E-Boda (Supreme|Impresspeed|Izzycomm|Essential)",
                "AllViewTablet": "Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)",
                "ArchosTablet": "\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b",
                "AinolTablet": "NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark",
                "SonyTablet": "Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612",
                "PhilipsTablet": "\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b",
                "CubeTablet": "Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT",
                "CobyTablet": "MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010",
                "MIDTablet": "M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733",
                "MSITablet": "MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b",
                "SMiTTablet": "Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)",
                "RockChipTablet": "Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A",
                "FlyTablet": "IQ310|Fly Vision",
                "bqTablet": "(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus",
                "HuaweiTablet": "MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim",
                "NecTablet": "\\bN-06D|\\bN-08D",
                "PantechTablet": "Pantech.*P4100",
                "BronchoTablet": "Broncho.*(N701|N708|N802|a710)",
                "VersusTablet": "TOUCHPAD.*[78910]|\\bTOUCHTAB\\b",
                "ZyncTablet": "z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900",
                "PositivoTablet": "TB07STA|TB10STA|TB07FTA|TB10FTA",
                "NabiTablet": "Android.*\\bNabi",
                "KoboTablet": "Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build",
                "DanewTablet": "DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b",
                "TexetTablet": "NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE",
                "PlaystationTablet": "Playstation.*(Portable|Vita)",
                "TrekstorTablet": "ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab",
                "PyleAudioTablet": "\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b",
                "AdvanTablet": "Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ",
                "DanyTechTablet": "Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1",
                "GalapadTablet": "Android.*\\bG1\\b",
                "MicromaxTablet": "Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b",
                "KarbonnTablet": "Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b",
                "AllFineTablet": "Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide",
                "PROSCANTablet": "\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b",
                "YONESTablet": "BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026",
                "ChangJiaTablet": "TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503",
                "GUTablet": "TX-A1301|TX-M9002|Q702|kf026",
                "PointOfViewTablet": "TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10",
                "OvermaxTablet": "OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)",
                "HCLTablet": "HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync",
                "DPSTablet": "DPS Dream 9|DPS Dual 7",
                "VistureTablet": "V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10",
                "CrestaTablet": "CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989",
                "MediatekTablet": "\\bMT8125|MT8389|MT8135|MT8377\\b",
                "ConcordeTablet": "Concorde([ ]+)?Tab|ConCorde ReadMan",
                "GoCleverTablet": "GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042",
                "ModecomTablet": "FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003",
                "VoninoTablet": "\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b",
                "ECSTablet": "V07OT2|TM105A|S10OT1|TR10CS1",
                "StorexTablet": "eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab",
                "VodafoneTablet": "SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7",
                "EssentielBTablet": "Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2",
                "RossMoorTablet": "RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711",
                "iMobileTablet": "i-mobile i-note",
                "TolinoTablet": "tolino tab [0-9.]+|tolino shine",
                "AudioSonicTablet": "\\bC-22Q|T7-QC|T-17B|T-17P\\b",
                "AMPETablet": "Android.* A78 ",
                "SkkTablet": "Android.* (SKYPAD|PHOENIX|CYCLOPS)",
                "TecnoTablet": "TECNO P9",
                "JXDTablet": "Android.*\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b",
                "iJoyTablet": "Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)",
                "FX2Tablet": "FX2 PAD7|FX2 PAD10",
                "XoroTablet": "KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151",
                "ViewsonicTablet": "ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a",
                "OdysTablet": "LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10",
                "CaptivaTablet": "CAPTIVA PAD",
                "IconbitTablet": "NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S",
                "TeclastTablet": "T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi",
                "JaytechTablet": "TPC-PA762",
                "BlaupunktTablet": "Endeavour 800NG|Endeavour 1010",
                "DigmaTablet": "\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b",
                "EvolioTablet": "ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b",
                "LavaTablet": "QPAD E704|\\bIvoryS\\b|E-TAB IVORY",
                "CelkonTablet": "CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b",
                "WolderTablet": "miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b",
                "MiTablet": "\\bMI PAD\\b|\\bHM NOTE 1W\\b",
                "NibiruTablet": "Nibiru M1|Nibiru Jupiter One",
                "NexoTablet": "NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI",
                "UbislateTablet": "UbiSlate[\\s]?7C",
                "PocketBookTablet": "Pocketbook",
                "Hudl": "Hudl HT7S3",
                "TelstraTablet": "T-Hub2",
                "GenericTablet": "Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bJolla\\b"
            },
            "oss": {
                "AndroidOS": "Android",
                "BlackBerryOS": "blackberry|\\bBB10\\b|rim tablet os",
                "PalmOS": "PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino",
                "SymbianOS": "Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b",
                "WindowsMobileOS": "Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;",
                "WindowsPhoneOS": "Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;",
                "iOS": "\\biPhone.*Mobile|\\biPod|\\biPad",
                "MeeGoOS": "MeeGo",
                "MaemoOS": "Maemo",
                "JavaOS": "J2ME\/|\\bMIDP\\b|\\bCLDC\\b",
                "webOS": "webOS|hpwOS",
                "badaOS": "\\bBada\\b",
                "BREWOS": "BREW"
            },
            "uas": {
                "Chrome": "\\bCrMo\\b|CriOS|Android.*Chrome\/[.0-9]* (Mobile)?",
                "Dolfin": "\\bDolfin\\b",
                "Opera": "Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\/[0-9.]+|Coast\/[0-9.]+",
                "Skyfire": "Skyfire",
                "IE": "IEMobile|MSIEMobile",
                "Firefox": "fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile",
                "Bolt": "bolt",
                "TeaShark": "teashark",
                "Blazer": "Blazer",
                "Safari": "Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari",
                "Tizen": "Tizen",
                "UCBrowser": "UC.*Browser|UCWEB",
                "baiduboxapp": "baiduboxapp",
                "baidubrowser": "baidubrowser",
                "DiigoBrowser": "DiigoBrowser",
                "Puffin": "Puffin",
                "Mercury": "\\bMercury\\b",
                "ObigoBrowser": "Obigo",
                "NetFront": "NF-Browser",
                "GenericBrowser": "NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger"
            },
            "props": {
                "Mobile": "Mobile\/[VER]",
                "Build": "Build\/[VER]",
                "Version": "Version\/[VER]",
                "VendorID": "VendorID\/[VER]",
                "iPad": "iPad.*CPU[a-z ]+[VER]",
                "iPhone": "iPhone.*CPU[a-z ]+[VER]",
                "iPod": "iPod.*CPU[a-z ]+[VER]",
                "Kindle": "Kindle\/[VER]",
                "Chrome": [
                    "Chrome\/[VER]",
                    "CriOS\/[VER]",
                    "CrMo\/[VER]"
                ],
                "Coast": [
                    "Coast\/[VER]"
                ],
                "Dolfin": "Dolfin\/[VER]",
                "Firefox": "Firefox\/[VER]",
                "Fennec": "Fennec\/[VER]",
                "IE": [
                    "IEMobile\/[VER];",
                    "IEMobile [VER]",
                    "MSIE [VER];"
                ],
                "NetFront": "NetFront\/[VER]",
                "NokiaBrowser": "NokiaBrowser\/[VER]",
                "Opera": [
                    " OPR\/[VER]",
                    "Opera Mini\/[VER]",
                    "Version\/[VER]"
                ],
                "Opera Mini": "Opera Mini\/[VER]",
                "Opera Mobi": "Version\/[VER]",
                "UC Browser": "UC Browser[VER]",
                "MQQBrowser": "MQQBrowser\/[VER]",
                "MicroMessenger": "MicroMessenger\/[VER]",
                "baiduboxapp": "baiduboxapp\/[VER]",
                "baidubrowser": "baidubrowser\/[VER]",
                "Iron": "Iron\/[VER]",
                "Safari": [
                    "Version\/[VER]",
                    "Safari\/[VER]"
                ],
                "Skyfire": "Skyfire\/[VER]",
                "Tizen": "Tizen\/[VER]",
                "Webkit": "webkit[ \/][VER]",
                "Gecko": "Gecko\/[VER]",
                "Trident": "Trident\/[VER]",
                "Presto": "Presto\/[VER]",
                "iOS": " \\bi?OS\\b [VER][ ;]{1}",
                "Android": "Android [VER]",
                "BlackBerry": [
                    "BlackBerry[\\w]+\/[VER]",
                    "BlackBerry.*Version\/[VER]",
                    "Version\/[VER]"
                ],
                "BREW": "BREW [VER]",
                "Java": "Java\/[VER]",
                "Windows Phone OS": [
                    "Windows Phone OS [VER]",
                    "Windows Phone [VER]"
                ],
                "Windows Phone": "Windows Phone [VER]",
                "Windows CE": "Windows CE\/[VER]",
                "Windows NT": "Windows NT [VER]",
                "Symbian": [
                    "SymbianOS\/[VER]",
                    "Symbian\/[VER]"
                ],
                "webOS": [
                    "webOS\/[VER]",
                    "hpwOS\/[VER];"
                ]
            },
            "utils": {
                "Bot": "Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor",
                "MobileBot": "Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\/M1A1-R2D2",
                "DesktopMode": "WPDesktop",
                "TV": "SonyDTV|HbbTV",
                "WebKit": "(webkit)[ \/]([\\w.]+)",
                "Console": "\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\b",
                "Watch": "SM-V700"
            }
        };

        // following patterns come from http://detectmobilebrowsers.com/
        impl.detectMobileBrowsers = {
            fullPattern: /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,
            shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
        };

        var hasOwnProp = Object.prototype.hasOwnProperty,
            isArray;

        impl.FALLBACK_PHONE = 'UnknownPhone';
        impl.FALLBACK_TABLET = 'UnknownTablet';
        impl.FALLBACK_MOBILE = 'UnknownMobile';

        isArray = ('isArray' in Array) ?
            Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };

        function equalIC(a, b) {
            return a != null && b != null && a.toLowerCase() === b.toLowerCase();
        }

        function convertPropsToRegExp(object) {
            for (var key in object) {
                if (hasOwnProp.call(object, key)) {
                    object[key] = new RegExp(object[key], 'i');
                }
            }
        }

        (function init() {
            var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;
            for (key in mobileDetectRules.props) {
                if (hasOwnProp.call(mobileDetectRules.props, key)) {
                    values = mobileDetectRules.props[key];
                    if (!isArray(values)) {
                        values = [values];
                    }
                    len = values.length;
                    for (i = 0; i < len; ++i) {
                        value = values[i];
                        verPos = value.indexOf('[VER]');
                        if (verPos >= 0) {
                            value = value.substring(0, verPos) + '([\\w._\\+]+)' + value.substring(verPos + 5);
                        }
                        values[i] = new RegExp(value, 'i');
                    }
                    mobileDetectRules.props[key] = values;
                }
            }
            convertPropsToRegExp(mobileDetectRules.oss);
            convertPropsToRegExp(mobileDetectRules.phones);
            convertPropsToRegExp(mobileDetectRules.tablets);
            convertPropsToRegExp(mobileDetectRules.uas);
            convertPropsToRegExp(mobileDetectRules.utils);

            // copy some patterns to oss0 which are tested first (see issue#15)
            mobileDetectRules.oss0 = {
                WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,
                WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS
            };
        }());

        /**
         * Test userAgent string against a set of rules and find the matched key.
         * @param {Object} rules (key is String, value is RegExp)
         * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').
         * @returns {String|null} the matched key if found, otherwise <tt>null</tt>
         * @private
         */
        impl.findMatch = function (rules, userAgent) {
            for (var key in rules) {
                if (hasOwnProp.call(rules, key)) {
                    if (rules[key].test(userAgent)) {
                        return key;
                    }
                }
            }
            return null;
        };

        /**
         * Check the version of the given property in the User-Agent.
         *
         * @param {String} propertyName
         * @param {String} userAgent
         * @return {String} version or <tt>null</tt> if version not found
         * @private
         */
        impl.getVersionStr = function (propertyName, userAgent) {
            var props = impl.mobileDetectRules.props, patterns, i, len, match;
            if (hasOwnProp.call(props, propertyName)) {
                patterns = props[propertyName];
                len = patterns.length;
                for (i = 0; i < len; ++i) {
                    match = patterns[i].exec(userAgent);
                    if (match !== null) {
                        return match[1];
                    }
                }
            }
            return null;
        };

        /**
         * Check the version of the given property in the User-Agent.
         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)
         *
         * @param {String} propertyName
         * @param {String} userAgent
         * @return {Number} version or <tt>NaN</tt> if version not found
         * @private
         */
        impl.getVersion = function (propertyName, userAgent) {
            var version = impl.getVersionStr(propertyName, userAgent);
            return version ? impl.prepareVersionNo(version) : NaN;
        };

        /**
         * Prepare the version number.
         *
         * @param {String} version
         * @return {Number} the version number as a floating number
         * @private
         */
        impl.prepareVersionNo = function (version) {
            var numbers;

            numbers = version.split(/[a-z._ \/\-]/i);
            if (numbers.length === 1) {
                version = numbers[0];
            }
            if (numbers.length > 1) {
                version = numbers[0] + '.';
                numbers.shift();
                version += numbers.join('');
            }
            return Number(version);
        };

        impl.isMobileFallback = function (userAgent) {
            return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||
                impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0, 4));
        };

        impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {
            if (cache.mobile !== undefined) {
                return;
            }
            var phone, tablet, phoneSized;

            // first check for stronger tablet rules, then phone (see issue#5)
            tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);
            if (tablet) {
                cache.mobile = cache.tablet = tablet;
                cache.phone = null;
                return; // unambiguously identified as tablet
            }

            phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);
            if (phone) {
                cache.mobile = cache.phone = phone;
                cache.tablet = null;
                return; // unambiguously identified as phone
            }

            // our rules haven't found a match -> try more general fallback rules
            if (impl.isMobileFallback(userAgent)) {
                phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);
                if (phoneSized === undefined) {
                    cache.mobile = impl.FALLBACK_MOBILE;
                    cache.tablet = cache.phone = null;
                } else if (phoneSized) {
                    cache.mobile = cache.phone = impl.FALLBACK_PHONE;
                    cache.tablet = null;
                } else {
                    cache.mobile = cache.tablet = impl.FALLBACK_TABLET;
                    cache.phone = null;
                }
            } else {
                // not mobile at all!
                cache.mobile = cache.tablet = cache.phone = null;
            }
        };

        // t is a reference to a MobileDetect instance
        impl.mobileGrade = function (t) {
            // impl note:
            // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.
            // When changes are made in Mobile_Detect.php, copy this method and replace:
            //     $this-> / t.
            //     self::MOBILE_GRADE_(.) / '$1'
            //     , self::VERSION_TYPE_FLOAT / (nothing)
            //     isIOS() / os('iOS')
            //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE
            var $isMobile = t.mobile() !== null;

            if (
                // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)
                t.os('iOS') && t.version('iPad') >= 4.3 ||
                t.os('iOS') && t.version('iPhone') >= 3.1 ||
                t.os('iOS') && t.version('iPod') >= 3.1 ||

                // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)
                // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM
                // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices
                // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7
                (t.version('Android') > 2.1 && t.is('Webkit')) ||

                // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800
                t.version('Windows Phone OS') >= 7.0 ||

                // Blackberry 7 - Tested on BlackBerry Torch 9810
                // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670
                t.is('BlackBerry') && t.version('BlackBerry') >= 6.0 ||
                // Blackberry Playbook (1.0-2.0) - Tested on PlayBook
                t.match('Playbook.*Tablet') ||

                // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)
                (t.version('webOS') >= 1.4 && t.match('Palm|Pre|Pixi')) ||
                // Palm WebOS 3.0  - Tested on HP TouchPad
                t.match('hp.*TouchPad') ||

                // Firefox Mobile (12 Beta) - Tested on Android 2.3 device
                (t.is('Firefox') && t.version('Firefox') >= 12) ||

                // Chrome for Android - Tested on Android 4.0, 4.1 device
                (t.is('Chrome') && t.is('AndroidOS') && t.version('Android') >= 4.0) ||

                // Skyfire 4.1 - Tested on Android 2.3 device
                (t.is('Skyfire') && t.version('Skyfire') >= 4.1 && t.is('AndroidOS') && t.version('Android') >= 2.3) ||

                // Opera Mobile 11.5-12: Tested on Android 2.3
                (t.is('Opera') && t.version('Opera Mobi') > 11 && t.is('AndroidOS')) ||

                // Meego 1.2 - Tested on Nokia 950 and N9
                t.is('MeeGoOS') ||

                // Tizen (pre-release) - Tested on early hardware
                t.is('Tizen') ||

                // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser
                // @todo: more tests here!
                t.is('Dolfin') && t.version('Bada') >= 2.0 ||

                // UC Browser - Tested on Android 2.3 device
                ((t.is('UC Browser') || t.is('Dolfin')) && t.version('Android') >= 2.3) ||

                // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each
                (t.match('Kindle Fire') ||
                    t.is('Kindle') && t.version('Kindle') >= 3.0) ||

                // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet
                t.is('AndroidOS') && t.is('NookTablet') ||

                // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7
                t.version('Chrome') >= 11 && !$isMobile ||

                // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7
                t.version('Safari') >= 5.0 && !$isMobile ||

                // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7
                t.version('Firefox') >= 4.0 && !$isMobile ||

                // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7
                t.version('MSIE') >= 7.0 && !$isMobile ||

                // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7
                // @reference: http://my.opera.com/community/openweb/idopera/
                t.version('Opera') >= 10 && !$isMobile

                ) {
                return 'A';
            }

            if (
                t.os('iOS') && t.version('iPad') < 4.3 ||
                t.os('iOS') && t.version('iPhone') < 3.1 ||
                t.os('iOS') && t.version('iPod') < 3.1 ||

                // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770
                t.is('Blackberry') && t.version('BlackBerry') >= 5 && t.version('BlackBerry') < 6 ||

                //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3
                (t.version('Opera Mini') >= 5.0 && t.version('Opera Mini') <= 6.5 &&
                    (t.version('Android') >= 2.3 || t.is('iOS'))) ||

                // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)
                t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||

                // @todo: report this (tested on Nokia N71)
                t.version('Opera Mobi') >= 11 && t.is('SymbianOS')
                ) {
                return 'B';
            }

            if (
                // Blackberry 4.x - Tested on the Curve 8330
                t.version('BlackBerry') < 5.0 ||
                // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)
                t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile') <= 5.2

                ) {
                return 'C';
            }

            //All older smartphone platforms and featurephones - Any device that doesn't support media queries
            //will receive the basic, C grade experience.
            return 'C';
        };

        impl.detectOS = function (ua) {
            return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||
                impl.findMatch(impl.mobileDetectRules.oss, ua);
        };

        impl.getDeviceSmallerSide = function () {
            return window.screen.width < window.screen.height ?
                window.screen.width :
                window.screen.height;
        };

        /**
         * Constructor for MobileDetect object.
         * <br>
         * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>
         * <div style="background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px">
         *     <strong>Find information how to download and install:</strong>
         *     <a href="https://github.com/hgoebl/mobile-detect.js/">github.com/hgoebl/mobile-detect.js/</a>
         * </div>
         *
         * @example <pre>
         *     var md = new MobileDetect(window.navigator.userAgent);
         *     if (md.mobile()) {
         *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';
         *     }
         * </pre>
         *
         * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']
         * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum
         *        width of smallest device side (in logical "CSS" pixels) until a device detected as mobile will be handled
         *        as phone.
         *        This is only used in cases where the device cannot be classified as phone or tablet.<br>
         *        See <a href="http://developer.android.com/guide/practices/screens_support.html">Declaring Tablet Layouts
         *        for Android</a>.<br>
         *        If you provide a value < 0, then this "fuzzy" check is disabled.
         * @constructor
         * @global
         */
        function MobileDetect(userAgent, maxPhoneWidth) {
            this.ua = userAgent || '';
            this._cache = {};
            //600dp is typical 7" tablet minimum width
            this.maxPhoneWidth = maxPhoneWidth || 600;
        }

        MobileDetect.prototype = {
            constructor: MobileDetect,

            /**
             * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.
             * <br>
             * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or
             * <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key for the phone family or tablet family, e.g. "Nexus".
             * @function MobileDetect#mobile
             */
            mobile: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.mobile;
            },

            /**
             * Returns the detected phone type/family string or <tt>null</tt>.
             * <br>
             * The returned tablet (family or producer) is one of following keys:<br>
             * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,
             * Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley, Wolfgang,
             * Alcatel, Nintendo, Amoi, INQ, GenericPhone</tt><br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}
             * will return <code>UnknownMobile</code>.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key of the phone family or producer, e.g. "iPhone"
             * @function MobileDetect#phone
             */
            phone: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.phone;
            },

            /**
             * Returns the detected tablet type/family string or <tt>null</tt>.
             * <br>
             * The returned tablet (family or producer) is one of following keys:<br>
             * <br><tt>iPad, NexusTablet, SamsungTablet, Kindle, SurfaceTablet, HPTablet, AsusTablet,
             * BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet, AcerTablet,
             * ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet, LenovoTablet,
             * DellTablet, YarvikTablet, MedionTablet, ArnovaTablet, IntensoTablet, IRUTablet,
             * MegafonTablet, EbodaTablet, AllViewTablet, ArchosTablet, AinolTablet,
             * SonyTablet, PhilipsTablet, CubeTablet, CobyTablet, MIDTablet, MSITablet,
             * SMiTTablet, RockChipTablet, FlyTablet, bqTablet, HuaweiTablet, NecTablet,
             * PantechTablet, BronchoTablet, VersusTablet, ZyncTablet, PositivoTablet,
             * NabiTablet, KoboTablet, DanewTablet, TexetTablet, PlaystationTablet,
             * TrekstorTablet, PyleAudioTablet, AdvanTablet, DanyTechTablet, GalapadTablet,
             * MicromaxTablet, KarbonnTablet, AllFineTablet, PROSCANTablet, YONESTablet,
             * ChangJiaTablet, GUTablet, PointOfViewTablet, OvermaxTablet, HCLTablet,
             * DPSTablet, VistureTablet, CrestaTablet, MediatekTablet, ConcordeTablet,
             * GoCleverTablet, ModecomTablet, VoninoTablet, ECSTablet, StorexTablet,
             * VodafoneTablet, EssentielBTablet, RossMoorTablet, iMobileTablet, TolinoTablet,
             * AudioSonicTablet, AMPETablet, SkkTablet, TecnoTablet, JXDTablet, iJoyTablet,
             * FX2Tablet, XoroTablet, ViewsonicTablet, OdysTablet, CaptivaTablet,
             * IconbitTablet, TeclastTablet, JaytechTablet, BlaupunktTablet, DigmaTablet,
             * EvolioTablet, LavaTablet, CelkonTablet, WolderTablet, MiTablet, NibiruTablet,
             * NexoTablet, UbislateTablet, PocketBookTablet, Hudl, TelstraTablet, GenericTablet</tt><br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}
             * will return <code>UnknownMobile</code>.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key of the tablet family or producer, e.g. "SamsungTablet"
             * @function MobileDetect#tablet
             */
            tablet: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.tablet;
            },

            /**
             * Returns the detected user-agent string or <tt>null</tt>.
             * <br>
             * The returned user-agent is one of following keys:<br>
             * <br><tt>Chrome, Dolfin, Opera, Skyfire, IE, Firefox, Bolt, TeaShark, Blazer, Safari,
             * Tizen, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Puffin, Mercury,
             * ObigoBrowser, NetFront, GenericBrowser</tt><br>
             *
             * @returns {String} the key for the detected user-agent or <tt>null</tt>
             * @function MobileDetect#userAgent
             */
            userAgent: function () {
                if (this._cache.userAgent === undefined) {
                    this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);
                }
                return this._cache.userAgent;
            },

            /**
             * Returns the detected operating system string or <tt>null</tt>.
             * <br>
             * The operating system is one of following keys:<br>
             * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,
             * iOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>
             *
             * @returns {String} the key for the detected operating system.
             * @function MobileDetect#os
             */
            os: function () {
                if (this._cache.os === undefined) {
                    this._cache.os = impl.detectOS(this.ua);
                }
                return this._cache.os;
            },

            /**
             * Get the version (as Number) of the given property in the User-Agent.
             * <br>
             * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)
             *
             * @param {String} key a key defining a thing which has a version.<br>
             *        You can use one of following keys:<br>
             * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,
             * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera
             * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,
             * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,
             * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows
             * NT, Symbian, webOS</tt><br>
             *
             * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.
             *          Be careful when comparing this value with '==' operator!
             * @function MobileDetect#version
             */
            version: function (key) {
                return impl.getVersion(key, this.ua);
            },

            /**
             * Get the version (as String) of the given property in the User-Agent.
             * <br>
             *
             * @param {String} key a key defining a thing which has a version.<br>
             *        You can use one of following keys:<br>
             * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,
             * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera
             * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,
             * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,
             * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows
             * NT, Symbian, webOS</tt><br>
             *
             * @returns {String} the "raw" version as String or <tt>null</tt> if User-Agent doesn't contain this version.
             *
             * @function MobileDetect#versionStr
             */
            versionStr: function (key) {
                return impl.getVersionStr(key, this.ua);
            },

            /**
             * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.
             *
             * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or
             *        tablet family.<br>
             *        For a complete list of possible values, see {@link MobileDetect#userAgent},
             *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>
             *        Additionally you have following keys:<br>
             * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>
             *
             * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,
             *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>
             * @function MobileDetect#is
             */
            is: function (key) {
                return equalIC(key, this.userAgent()) ||
                       equalIC(key, this.os()) ||
                       equalIC(key, this.phone()) ||
                       equalIC(key, this.tablet()) ||
                       equalIC(key, impl.findMatch(impl.mobileDetectRules.utils, this.ua));
            },

            /**
             * Do a quick test against navigator::userAgent.
             *
             * @param {String|RegExp} pattern the pattern, either as String or RegExp
             *                        (a string will be converted to a case-insensitive RegExp).
             * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>
             * @function MobileDetect#match
             */
            match: function (pattern) {
                if (!(pattern instanceof RegExp)) {
                    pattern = new RegExp(pattern, 'i');
                }
                return pattern.test(this.ua);
            },

            /**
             * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.
             * <br>
             * Obviously this method makes sense in browser environments only (not for Node.js)!
             * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>
             *        The argument is optional and if not present or falsy, the value of the constructor is taken.
             * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>
             *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>
             *          Will always return <code>undefined</code> server-side.
             */
            isPhoneSized: function (maxPhoneWidth) {
                return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);
            },

            /**
             * Returns the mobile grade ('A', 'B', 'C').
             *
             * @returns {String} one of the mobile grades ('A', 'B', 'C').
             * @function MobileDetect#mobileGrade
             */
            mobileGrade: function () {
                if (this._cache.grade === undefined) {
                    this._cache.grade = impl.mobileGrade(this);
                }
                return this._cache.grade;
            }
        };

        // environment-dependent
        if (typeof window !== 'undefined' && window.screen) {
            MobileDetect.isPhoneSized = function (maxPhoneWidth) {
                return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;
            };
        } else {
            MobileDetect.isPhoneSized = function () { };
        }

        // should not be replaced by a completely new object - just overwrite existing methods
        MobileDetect._impl = impl;

        return MobileDetect;
    }); // end of call of define()
})((function (undefined) {
    if (typeof define === 'function' && define.amd) {
        return define;
    } else if (typeof module !== 'undefined' && module.exports) {
        return function (factory) { module.exports = factory(); };
    } else if (typeof window !== 'undefined') {
        return function (factory) { window.MobileDetect = factory(); };
    } else {
        // please file a bug if you get this error!
        throw new Error('unknown environment');
    }
})());

(function (jQuery, window, undefined) {
    "use strict";

    var matched, browser;

    jQuery.uaMatch = function (ua) {
        ua = ua.toLowerCase();

        var match = /(chrome)[ \/]([\w.]+)/.exec(ua) ||
            /(safari)[ \/]([\w.]+)/.exec(ua) ||
            /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua) ||
            /(msie) ([\w.]+)/.exec(ua) ||
            ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua) ||
            [];

        var platform_match = /(ipad)/.exec(ua) ||
            /(iphone)/.exec(ua) ||
            /(android)/.exec(ua) ||
            [];

        var browser = match[1] || "";

        if (ua.indexOf("windows phone") != -1 || ua.indexOf("iemobile") != -1) {

            // http://www.neowin.net/news/ie11-fakes-user-agent-to-fool-gmail-in-windows-phone-81-gdr1-update
            browser = "msie";
        }
        else if (ua.indexOf("like gecko") != -1 && ua.indexOf('webkit') == -1 && ua.indexOf('opera') == -1 && ua.indexOf('chrome') == -1 && ua.indexOf('safari') == -1) {
            browser = "msie";
        }

        return {
            browser: browser,
            version: match[2] || "0",
            platform: platform_match[0] || ""
        };
    };

    var userAgent = window.navigator.userAgent;
    matched = jQuery.uaMatch(userAgent);
    browser = {};

    if (matched.browser) {
        browser[matched.browser] = true;
        browser.version = matched.version;
    }

    if (matched.platform) {
        browser[matched.platform] = true;
    }

    if (userAgent.toLowerCase().indexOf("webkit") != -1 && !browser.chrome && !browser.msie) {
        browser.safari = true;
    }

    var md = new MobileDetect(userAgent);

    if (md.mobile()) {
        browser.mobile = true;
    } else {
        browser.mobile = null;
    }

    if (browser.msie && !browser.mobile && userAgent.toLowerCase().indexOf("xbox") != -1) {
        browser.tv = true;
    }

    if (browser.ipad || browser.iphone) {
        if (userAgent.toLowerCase().indexOf('cpu os 9') != -1) {
            browser.iOSVersion = 9;
        }
        else if (userAgent.toLowerCase().indexOf('cpu os 8') != -1) {
            browser.iOSVersion = 8;
        }
        else if (userAgent.toLowerCase().indexOf('cpu os 7') != -1) {
            browser.iOSVersion = 7;
        }
    }

    jQuery.browser = browser;

})(jQuery, window);


/*
 RequireJS 2.1.17 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs, require, define;
(function (ba) {
    function G(b) { return "[object Function]" === K.call(b) } function H(b) { return "[object Array]" === K.call(b) } function v(b, c) { if (b) { var d; for (d = 0; d < b.length && (!b[d] || !c(b[d], d, b)) ; d += 1); } } function T(b, c) { if (b) { var d; for (d = b.length - 1; -1 < d && (!b[d] || !c(b[d], d, b)) ; d -= 1); } } function t(b, c) { return fa.call(b, c) } function m(b, c) { return t(b, c) && b[c] } function B(b, c) { for (var d in b) if (t(b, d) && c(b[d], d)) break } function U(b, c, d, e) {
        c && B(c, function (c, g) {
            if (d || !t(b, g)) e && "object" === typeof c && c && !H(c) && !G(c) && !(c instanceof
            RegExp) ? (b[g] || (b[g] = {}), U(b[g], c, d, e)) : b[g] = c
        }); return b
    } function u(b, c) { return function () { return c.apply(b, arguments) } } function ca(b) { throw b; } function da(b) { if (!b) return b; var c = ba; v(b.split("."), function (b) { c = c[b] }); return c } function C(b, c, d, e) { c = Error(c + "\nhttp://requirejs.org/docs/errors.html#" + b); c.requireType = b; c.requireModules = e; d && (c.originalError = d); return c } function ga(b) {
        function c(a, k, b) {
            var f, l, c, d, e, g, i, p, k = k && k.split("/"), h = j.map, n = h && h["*"]; if (a) {
                a = a.split("/"); l = a.length - 1; j.nodeIdCompat &&
                Q.test(a[l]) && (a[l] = a[l].replace(Q, "")); "." === a[0].charAt(0) && k && (l = k.slice(0, k.length - 1), a = l.concat(a)); l = a; for (c = 0; c < l.length; c++) if (d = l[c], "." === d) l.splice(c, 1), c -= 1; else if (".." === d && !(0 === c || 1 === c && ".." === l[2] || ".." === l[c - 1]) && 0 < c) l.splice(c - 1, 2), c -= 2; a = a.join("/")
            } if (b && h && (k || n)) {
                l = a.split("/"); c = l.length; a: for (; 0 < c; c -= 1) { e = l.slice(0, c).join("/"); if (k) for (d = k.length; 0 < d; d -= 1) if (b = m(h, k.slice(0, d).join("/"))) if (b = m(b, e)) { f = b; g = c; break a } !i && (n && m(n, e)) && (i = m(n, e), p = c) } !f && i && (f = i, g = p); f && (l.splice(0,
                g, f), a = l.join("/"))
            } return (f = m(j.pkgs, a)) ? f : a
        } function d(a) { z && v(document.getElementsByTagName("script"), function (k) { if (k.getAttribute("data-requiremodule") === a && k.getAttribute("data-requirecontext") === i.contextName) return k.parentNode.removeChild(k), !0 }) } function e(a) { var k = m(j.paths, a); if (k && H(k) && 1 < k.length) return k.shift(), i.require.undef(a), i.makeRequire(null, { skipMap: !0 })([a]), !0 } function n(a) { var k, c = a ? a.indexOf("!") : -1; -1 < c && (k = a.substring(0, c), a = a.substring(c + 1, a.length)); return [k, a] } function p(a,
        k, b, f) { var l, d, e = null, g = k ? k.name : null, j = a, p = !0, h = ""; a || (p = !1, a = "_@r" + (K += 1)); a = n(a); e = a[0]; a = a[1]; e && (e = c(e, g, f), d = m(r, e)); a && (e ? h = d && d.normalize ? d.normalize(a, function (a) { return c(a, g, f) }) : -1 === a.indexOf("!") ? c(a, g, f) : a : (h = c(a, g, f), a = n(h), e = a[0], h = a[1], b = !0, l = i.nameToUrl(h))); b = e && !d && !b ? "_unnormalized" + (O += 1) : ""; return { prefix: e, name: h, parentMap: k, unnormalized: !!b, url: l, originalName: j, isDefine: p, id: (e ? e + "!" + h : h) + b } } function s(a) { var k = a.id, b = m(h, k); b || (b = h[k] = new i.Module(a)); return b } function q(a,
        k, b) { var f = a.id, c = m(h, f); if (t(r, f) && (!c || c.defineEmitComplete)) "defined" === k && b(r[f]); else if (c = s(a), c.error && "error" === k) b(c.error); else c.on(k, b) } function w(a, b) { var c = a.requireModules, f = !1; if (b) b(a); else if (v(c, function (b) { if (b = m(h, b)) b.error = a, b.events.error && (f = !0, b.emit("error", a)) }), !f) g.onError(a) } function x() { R.length && (ha.apply(A, [A.length, 0].concat(R)), R = []) } function y(a) { delete h[a]; delete V[a] } function F(a, b, c) {
            var f = a.map.id; a.error ? a.emit("error", a.error) : (b[f] = !0, v(a.depMaps, function (f,
            d) { var e = f.id, g = m(h, e); g && (!a.depMatched[d] && !c[e]) && (m(b, e) ? (a.defineDep(d, r[e]), a.check()) : F(g, b, c)) }), c[f] = !0)
        } function D() {
            var a, b, c = (a = 1E3 * j.waitSeconds) && i.startTime + a < (new Date).getTime(), f = [], l = [], g = !1, h = !0; if (!W) {
                W = !0; B(V, function (a) { var i = a.map, j = i.id; if (a.enabled && (i.isDefine || l.push(a), !a.error)) if (!a.inited && c) e(j) ? g = b = !0 : (f.push(j), d(j)); else if (!a.inited && (a.fetched && i.isDefine) && (g = !0, !i.prefix)) return h = !1 }); if (c && f.length) return a = C("timeout", "Load timeout for modules: " + f, null,
                f), a.contextName = i.contextName, w(a); h && v(l, function (a) { F(a, {}, {}) }); if ((!c || b) && g) if ((z || ea) && !X) X = setTimeout(function () { X = 0; D() }, 50); W = !1
            }
        } function E(a) { t(r, a[0]) || s(p(a[0], null, !0)).init(a[1], a[2]) } function I(a) { var a = a.currentTarget || a.srcElement, b = i.onScriptLoad; a.detachEvent && !Y ? a.detachEvent("onreadystatechange", b) : a.removeEventListener("load", b, !1); b = i.onScriptError; (!a.detachEvent || Y) && a.removeEventListener("error", b, !1); return { node: a, id: a && a.getAttribute("data-requiremodule") } } function J() {
            var a;
            for (x() ; A.length;) { a = A.shift(); if (null === a[0]) return w(C("mismatch", "Mismatched anonymous define() module: " + a[a.length - 1])); E(a) }
        } var W, Z, i, L, X, j = { waitSeconds: 7, baseUrl: "./", paths: {}, bundles: {}, pkgs: {}, shim: {}, config: {} }, h = {}, V = {}, $ = {}, A = [], r = {}, S = {}, aa = {}, K = 1, O = 1; L = {
            require: function (a) { return a.require ? a.require : a.require = i.makeRequire(a.map) }, exports: function (a) { a.usingExports = !0; if (a.map.isDefine) return a.exports ? r[a.map.id] = a.exports : a.exports = r[a.map.id] = {} }, module: function (a) {
                return a.module ?
                a.module : a.module = { id: a.map.id, uri: a.map.url, config: function () { return m(j.config, a.map.id) || {} }, exports: a.exports || (a.exports = {}) }
            }
        }; Z = function (a) { this.events = m($, a.id) || {}; this.map = a; this.shim = m(j.shim, a.id); this.depExports = []; this.depMaps = []; this.depMatched = []; this.pluginMaps = {}; this.depCount = 0 }; Z.prototype = {
            init: function (a, b, c, f) {
                f = f || {}; if (!this.inited) {
                    this.factory = b; if (c) this.on("error", c); else this.events.error && (c = u(this, function (a) { this.emit("error", a) })); this.depMaps = a && a.slice(0); this.errback =
                    c; this.inited = !0; this.ignore = f.ignore; f.enabled || this.enabled ? this.enable() : this.check()
                }
            }, defineDep: function (a, b) { this.depMatched[a] || (this.depMatched[a] = !0, this.depCount -= 1, this.depExports[a] = b) }, fetch: function () { if (!this.fetched) { this.fetched = !0; i.startTime = (new Date).getTime(); var a = this.map; if (this.shim) i.makeRequire(this.map, { enableBuildCallback: !0 })(this.shim.deps || [], u(this, function () { return a.prefix ? this.callPlugin() : this.load() })); else return a.prefix ? this.callPlugin() : this.load() } }, load: function () {
                var a =
                this.map.url; S[a] || (S[a] = !0, i.load(this.map.id, a))
            }, check: function () {
                if (this.enabled && !this.enabling) {
                    var a, b, c = this.map.id; b = this.depExports; var f = this.exports, l = this.factory; if (this.inited) if (this.error) this.emit("error", this.error); else {
                        if (!this.defining) {
                            this.defining = !0; if (1 > this.depCount && !this.defined) {
                                if (G(l)) {
                                    if (this.events.error && this.map.isDefine || g.onError !== ca) try { f = i.execCb(c, l, b, f) } catch (d) { a = d } else f = i.execCb(c, l, b, f); this.map.isDefine && void 0 === f && ((b = this.module) ? f = b.exports : this.usingExports &&
                                    (f = this.exports)); if (a) return a.requireMap = this.map, a.requireModules = this.map.isDefine ? [this.map.id] : null, a.requireType = this.map.isDefine ? "define" : "require", w(this.error = a)
                                } else f = l; this.exports = f; if (this.map.isDefine && !this.ignore && (r[c] = f, g.onResourceLoad)) g.onResourceLoad(i, this.map, this.depMaps); y(c); this.defined = !0
                            } this.defining = !1; this.defined && !this.defineEmitted && (this.defineEmitted = !0, this.emit("defined", this.exports), this.defineEmitComplete = !0)
                        }
                    } else this.fetch()
                }
            }, callPlugin: function () {
                var a =
                this.map, b = a.id, d = p(a.prefix); this.depMaps.push(d); q(d, "defined", u(this, function (f) {
                    var l, d; d = m(aa, this.map.id); var e = this.map.name, P = this.map.parentMap ? this.map.parentMap.name : null, n = i.makeRequire(a.parentMap, { enableBuildCallback: !0 }); if (this.map.unnormalized) {
                        if (f.normalize && (e = f.normalize(e, function (a) { return c(a, P, !0) }) || ""), f = p(a.prefix + "!" + e, this.map.parentMap), q(f, "defined", u(this, function (a) { this.init([], function () { return a }, null, { enabled: !0, ignore: !0 }) })), d = m(h, f.id)) {
                            this.depMaps.push(f);
                            if (this.events.error) d.on("error", u(this, function (a) { this.emit("error", a) })); d.enable()
                        }
                    } else d ? (this.map.url = i.nameToUrl(d), this.load()) : (l = u(this, function (a) { this.init([], function () { return a }, null, { enabled: !0 }) }), l.error = u(this, function (a) { this.inited = !0; this.error = a; a.requireModules = [b]; B(h, function (a) { 0 === a.map.id.indexOf(b + "_unnormalized") && y(a.map.id) }); w(a) }), l.fromText = u(this, function (f, c) {
                        var d = a.name, e = p(d), P = M; c && (f = c); P && (M = !1); s(e); t(j.config, b) && (j.config[d] = j.config[b]); try { g.exec(f) } catch (h) {
                            return w(C("fromtexteval",
                            "fromText eval for " + b + " failed: " + h, h, [b]))
                        } P && (M = !0); this.depMaps.push(e); i.completeLoad(d); n([d], l)
                    }), f.load(a.name, n, l, j))
                })); i.enable(d, this); this.pluginMaps[d.id] = d
            }, enable: function () {
                V[this.map.id] = this; this.enabling = this.enabled = !0; v(this.depMaps, u(this, function (a, b) {
                    var c, f; if ("string" === typeof a) {
                        a = p(a, this.map.isDefine ? this.map : this.map.parentMap, !1, !this.skipMap); this.depMaps[b] = a; if (c = m(L, a.id)) { this.depExports[b] = c(this); return } this.depCount += 1; q(a, "defined", u(this, function (a) {
                            this.defineDep(b,
                            a); this.check()
                        })); this.errback ? q(a, "error", u(this, this.errback)) : this.events.error && q(a, "error", u(this, function (a) { this.emit("error", a) }))
                    } c = a.id; f = h[c]; !t(L, c) && (f && !f.enabled) && i.enable(a, this)
                })); B(this.pluginMaps, u(this, function (a) { var b = m(h, a.id); b && !b.enabled && i.enable(a, this) })); this.enabling = !1; this.check()
            }, on: function (a, b) { var c = this.events[a]; c || (c = this.events[a] = []); c.push(b) }, emit: function (a, b) { v(this.events[a], function (a) { a(b) }); "error" === a && delete this.events[a] }
        }; i = {
            config: j, contextName: b,
            registry: h, defined: r, urlFetched: S, defQueue: A, Module: Z, makeModuleMap: p, nextTick: g.nextTick, onError: w, configure: function (a) {
                a.baseUrl && "/" !== a.baseUrl.charAt(a.baseUrl.length - 1) && (a.baseUrl += "/"); var b = j.shim, c = { paths: !0, bundles: !0, config: !0, map: !0 }; B(a, function (a, b) { c[b] ? (j[b] || (j[b] = {}), U(j[b], a, !0, !0)) : j[b] = a }); a.bundles && B(a.bundles, function (a, b) { v(a, function (a) { a !== b && (aa[a] = b) }) }); a.shim && (B(a.shim, function (a, c) {
                    H(a) && (a = { deps: a }); if ((a.exports || a.init) && !a.exportsFn) a.exportsFn = i.makeShimExports(a);
                    b[c] = a
                }), j.shim = b); a.packages && v(a.packages, function (a) { var b, a = "string" === typeof a ? { name: a } : a; b = a.name; a.location && (j.paths[b] = a.location); j.pkgs[b] = a.name + "/" + (a.main || "main").replace(ia, "").replace(Q, "") }); B(h, function (a, b) { !a.inited && !a.map.unnormalized && (a.map = p(b)) }); if (a.deps || a.callback) i.require(a.deps || [], a.callback)
            }, makeShimExports: function (a) { return function () { var b; a.init && (b = a.init.apply(ba, arguments)); return b || a.exports && da(a.exports) } }, makeRequire: function (a, e) {
                function j(c, d, m) {
                    var n,
                    q; e.enableBuildCallback && (d && G(d)) && (d.__requireJsBuild = !0); if ("string" === typeof c) { if (G(d)) return w(C("requireargs", "Invalid require call"), m); if (a && t(L, c)) return L[c](h[a.id]); if (g.get) return g.get(i, c, a, j); n = p(c, a, !1, !0); n = n.id; return !t(r, n) ? w(C("notloaded", 'Module name "' + n + '" has not been loaded yet for context: ' + b + (a ? "" : ". Use require([])"))) : r[n] } J(); i.nextTick(function () { J(); q = s(p(null, a)); q.skipMap = e.skipMap; q.init(c, d, m, { enabled: !0 }); D() }); return j
                } e = e || {}; U(j, {
                    isBrowser: z, toUrl: function (b) {
                        var d,
                        e = b.lastIndexOf("."), k = b.split("/")[0]; if (-1 !== e && (!("." === k || ".." === k) || 1 < e)) d = b.substring(e, b.length), b = b.substring(0, e); return i.nameToUrl(c(b, a && a.id, !0), d, !0)
                    }, defined: function (b) { return t(r, p(b, a, !1, !0).id) }, specified: function (b) { b = p(b, a, !1, !0).id; return t(r, b) || t(h, b) }
                }); a || (j.undef = function (b) { x(); var c = p(b, a, !0), e = m(h, b); d(b); delete r[b]; delete S[c.url]; delete $[b]; T(A, function (a, c) { a[0] === b && A.splice(c, 1) }); e && (e.events.defined && ($[b] = e.events), y(b)) }); return j
            }, enable: function (a) {
                m(h, a.id) &&
                s(a).enable()
            }, completeLoad: function (a) { var b, c, d = m(j.shim, a) || {}, g = d.exports; for (x() ; A.length;) { c = A.shift(); if (null === c[0]) { c[0] = a; if (b) break; b = !0 } else c[0] === a && (b = !0); E(c) } c = m(h, a); if (!b && !t(r, a) && c && !c.inited) { if (j.enforceDefine && (!g || !da(g))) return e(a) ? void 0 : w(C("nodefine", "No define call for " + a, null, [a])); E([a, d.deps || [], d.exportsFn]) } D() }, nameToUrl: function (a, b, c) {
                var d, e, h; (d = m(j.pkgs, a)) && (a = d); if (d = m(aa, a)) return i.nameToUrl(d, b, c); if (g.jsExtRegExp.test(a)) d = a + (b || ""); else {
                    d = j.paths;
                    a = a.split("/"); for (e = a.length; 0 < e; e -= 1) if (h = a.slice(0, e).join("/"), h = m(d, h)) { H(h) && (h = h[0]); a.splice(0, e, h); break } d = a.join("/"); d += b || (/^data\:|\?/.test(d) || c ? "" : ".js"); d = ("/" === d.charAt(0) || d.match(/^[\w\+\.\-]+:/) ? "" : j.baseUrl) + d
                } return j.urlArgs ? d + ((-1 === d.indexOf("?") ? "?" : "&") + j.urlArgs) : d
            }, load: function (a, b) { g.load(i, a, b) }, execCb: function (a, b, c, d) { return b.apply(d, c) }, onScriptLoad: function (a) { if ("load" === a.type || ja.test((a.currentTarget || a.srcElement).readyState)) N = null, a = I(a), i.completeLoad(a.id) },
            onScriptError: function (a) { var b = I(a); if (!e(b.id)) return w(C("scripterror", "Script error for: " + b.id, a, [b.id])) }
        }; i.require = i.makeRequire(); return i
    } var g, x, y, D, I, E, N, J, s, O, ka = /(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg, la = /[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g, Q = /\.js$/, ia = /^\.\//; x = Object.prototype; var K = x.toString, fa = x.hasOwnProperty, ha = Array.prototype.splice, z = !!("undefined" !== typeof window && "undefined" !== typeof navigator && window.document), ea = !z && "undefined" !== typeof importScripts, ja =
    z && "PLAYSTATION 3" === navigator.platform ? /^complete$/ : /^(complete|loaded)$/, Y = "undefined" !== typeof opera && "[object Opera]" === opera.toString(), F = {}, q = {}, R = [], M = !1; if ("undefined" === typeof define) {
        if ("undefined" !== typeof requirejs) { if (G(requirejs)) return; q = requirejs; requirejs = void 0 } "undefined" !== typeof require && !G(require) && (q = require, require = void 0); g = requirejs = function (b, c, d, e) {
            var n, p = "_"; !H(b) && "string" !== typeof b && (n = b, H(c) ? (b = c, c = d, d = e) : b = []); n && n.context && (p = n.context); (e = m(F, p)) || (e = F[p] = g.s.newContext(p));
            n && e.configure(n); return e.require(b, c, d)
        }; g.config = function (b) { return g(b) }; g.nextTick = "undefined" !== typeof setTimeout ? function (b) { setTimeout(b, 4) } : function (b) { b() }; require || (require = g); g.version = "2.1.17"; g.jsExtRegExp = /^\/|:|\?|\.js$/; g.isBrowser = z; x = g.s = { contexts: F, newContext: ga }; g({}); v(["toUrl", "undef", "defined", "specified"], function (b) { g[b] = function () { var c = F._; return c.require[b].apply(c, arguments) } }); if (z && (y = x.head = document.getElementsByTagName("head")[0], D = document.getElementsByTagName("base")[0])) y =
        x.head = D.parentNode; g.onError = ca; g.createNode = function (b) { var c = b.xhtml ? document.createElementNS("http://www.w3.org/1999/xhtml", "html:script") : document.createElement("script"); c.type = b.scriptType || "text/javascript"; c.charset = "utf-8"; c.async = !0; return c }; g.load = function (b, c, d) {
            var e = b && b.config || {}; if (z) return e = g.createNode(e, c, d), e.setAttribute("data-requirecontext", b.contextName), e.setAttribute("data-requiremodule", c), e.attachEvent && !(e.attachEvent.toString && 0 > e.attachEvent.toString().indexOf("[native code")) &&
            !Y ? (M = !0, e.attachEvent("onreadystatechange", b.onScriptLoad)) : (e.addEventListener("load", b.onScriptLoad, !1), e.addEventListener("error", b.onScriptError, !1)), e.src = d, J = e, D ? y.insertBefore(e, D) : y.appendChild(e), J = null, e; if (ea) try { importScripts(d), b.completeLoad(c) } catch (m) { b.onError(C("importscripts", "importScripts failed for " + c + " at " + d, m, [c])) }
        }; z && !q.skipDataMain && T(document.getElementsByTagName("script"), function (b) {
            y || (y = b.parentNode); if (I = b.getAttribute("data-main")) return s = I, q.baseUrl || (E = s.split("/"),
            s = E.pop(), O = E.length ? E.join("/") + "/" : "./", q.baseUrl = O), s = s.replace(Q, ""), g.jsExtRegExp.test(s) && (s = I), q.deps = q.deps ? q.deps.concat(s) : [s], !0
        }); define = function (b, c, d) {
            var e, g; "string" !== typeof b && (d = c, c = b, b = null); H(c) || (d = c, c = null); !c && G(d) && (c = [], d.length && (d.toString().replace(ka, "").replace(la, function (b, d) { c.push(d) }), c = (1 === d.length ? ["require"] : ["require", "exports", "module"]).concat(c))); if (M) {
                if (!(e = J)) N && "interactive" === N.readyState || T(document.getElementsByTagName("script"), function (b) {
                    if ("interactive" ===
                    b.readyState) return N = b
                }), e = N; e && (b || (b = e.getAttribute("data-requiremodule")), g = F[e.getAttribute("data-requirecontext")])
            } (g ? g.defQueue : R).push([b, c, d])
        }; define.amd = { jQuery: !0 }; g.exec = function (b) { return eval(b) }; g(q)
    }
})(this);
(function ($) {

})(jQuery);

/**
 * jQuery Unveil
 * A very lightweight jQuery plugin to lazy load images
 * http://luis-almeida.github.com/unveil
 *
 * Licensed under the MIT license.
 * Copyright 2013 Lus Almeida
 * https://github.com/luis-almeida
 */

(function ($) {

    /**
    * Copyright 2012, Digital Fusion
    * Licensed under the MIT license.
    * http://teamdf.com/jquery-plugins/license/
    *
    * @author Sam Sehnert
    * @desc A small plugin that checks whether elements are within
    *       the user visible viewport of a web browser.
    *       only accounts for vertical position, not horizontal.
    */
    var $w = $(window);

    function visibleInViewport(elem, partial, hidden, direction, threshold) {

        var $t = $(elem),
            t = elem,
            vpWidth = $w.width(),
            vpHeight = $w.height(),
            direction = (direction) ? direction : 'both',
            clientSize = hidden === true ? t.offsetWidth * t.offsetHeight : true;

        if (typeof t.getBoundingClientRect === 'function') {

            // Use this native browser method, if available.
            var rec = t.getBoundingClientRect(),
                tViz = rec.top >= 0 && rec.top < vpHeight + threshold,
                bViz = rec.bottom > 0 && rec.bottom <= vpHeight + threshold,
                lViz = rec.left >= 0 && rec.left < vpWidth + threshold,
                rViz = rec.right > 0 && rec.right <= vpWidth + threshold,
                vVisible = partial ? tViz || bViz : tViz && bViz,
                hVisible = partial ? lViz || rViz : lViz && rViz;

            if (direction === 'both')
                return clientSize && vVisible && hVisible;
            else if (direction === 'vertical')
                return clientSize && vVisible;
            else if (direction === 'horizontal')
                return clientSize && hVisible;
        } else {

            var viewTop = $w.scrollTop(),
                viewBottom = viewTop + vpHeight,
                viewLeft = $w.scrollLeft(),
                viewRight = viewLeft + vpWidth,
                offset = $t.offset(),
                _top = offset.top,
                _bottom = _top + $t.height(),
                _left = offset.left,
                _right = _left + $t.width(),
                compareTop = partial === true ? _bottom : _top,
                compareBottom = partial === true ? _top : _bottom,
                compareLeft = partial === true ? _right : _left,
                compareRight = partial === true ? _left : _right;

            if (direction === 'both')
                return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop)) && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
            else if (direction === 'vertical')
                return !!clientSize && ((compareBottom <= viewBottom) && (compareTop >= viewTop));
            else if (direction === 'horizontal')
                return !!clientSize && ((compareRight <= viewRight) && (compareLeft >= viewLeft));
        }
    }

    var unveilId = 0;

    function getThreshold() {

        // If less than 100, the search window ends up not getting images
        // If less than 200, this happens on the home page
        // Need to fix those before this can be set to 0

        if (window.AppInfo && AppInfo.isNativeApp && $.browser.safari) {
            return 7000;
        }

        var screens = $.browser.mobile ? 2.5 : 1;

        // This helps eliminate the draw-in effect as you scroll
        return Math.max(screen.availHeight * screens, 1000);
    }

    var threshold = getThreshold();

    function isVisible(elem) {
        return visibleInViewport(elem, true, false, 'both', threshold);
    }

    function fillImage(elem) {
        var source = elem.getAttribute('data-src');
        if (source) {
            ImageStore.setImageInto(elem, source);
            elem.setAttribute("data-src", '');
        }
    }

    function unveilElements(elems) {

        if (!elems.length) {
            return;
        }

        var images = elems;

        unveilId++;
        var eventNamespace = 'unveil' + unveilId;

        function unveil() {

            var remaining = [];

            for (var i = 0, length = images.length; i < length; i++) {
                var img = images[i];
                if (isVisible(img)) {
                    fillImage(img);
                } else {
                    remaining.push(img);
                }
            }

            images = remaining;

            if (!images.length) {
                Events.off(window, 'scroll.' + eventNamespace);
                Events.off(window, 'resize.' + eventNamespace);
            }
        }

        Events.on(window, 'scroll.' + eventNamespace, unveil);
        Events.on(window, 'resize.' + eventNamespace, unveil);

        unveil();
    }

    function fillImages(elems) {

        for (var i = 0, length = elems.length; i < length; i++) {
            var elem = elems[0];
            var source = elem.getAttribute('data-src');
            if (source) {
                ImageStore.setImageInto(elem, source);
                elem.setAttribute("data-src", '');
            }
        }
    }

    function lazyChildren(elem) {

        unveilElements(elem.getElementsByClassName('lazy'));
    }

    $.fn.lazyChildren = function () {

        if (this.length == 1) {
            lazyChildren(this[0]);
        } else {
            unveilElements($('.lazy', this));
        }
        return this;
    };

    function lazyImage(elem, url) {

        elem.setAttribute('data-src', url);
        fillImages([elem]);
    }

    window.ImageLoader = {
        fillImages: fillImages,
        lazyImage: lazyImage,
        lazyChildren: lazyChildren
    };

})(window.jQuery || window.Zepto);

(function () {

    function setImageIntoElement(elem, url) {

        if (elem.tagName !== "IMG") {

            elem.style.backgroundImage = "url('" + url + "')";

        } else {
            elem.setAttribute("src", url);
        }
    }

    function simpleImageStore() {

        var self = this;

        self.setImageInto = setImageIntoElement;
    }

    console.log('creating simpleImageStore');
    window.ImageStore = new simpleImageStore();

})();
window.localizationGlossary={"SettingsSaved":"Settings saved.","AddUser":"Add User","Users":"Users","Delete":"Delete","Administrator":"Administrator","Password":"Password","DeleteImage":"Delete Image","MessageThankYouForSupporting":"Thank you for supporting Emby.","MessagePleaseSupportProject":"Please support Emby.","DeleteImageConfirmation":"Are you sure you wish to delete this image?","FileReadCancelled":"The file read has been canceled.","FileNotFound":"File not found.","FileReadError":"An error occurred while reading the file.","DeleteUser":"Delete User","DeleteUserConfirmation":"Are you sure you wish to delete this user?","PasswordResetHeader":"Reset Password","PasswordResetComplete":"The password has been reset.","PinCodeResetComplete":"The pin code has been reset.","PasswordResetConfirmation":"Are you sure you wish to reset the password?","PinCodeResetConfirmation":"Are you sure you wish to reset the pin code?","HeaderPinCodeReset":"Reset Pin Code","PasswordSaved":"Password saved.","PasswordMatchError":"Password and password confirmation must match.","OptionRelease":"Official Release","OptionBeta":"Beta","OptionDev":"Dev (Unstable)","UninstallPluginHeader":"Uninstall Plugin","UninstallPluginConfirmation":"Are you sure you wish to uninstall {0}?","NoPluginConfigurationMessage":"This plugin has nothing to configure.","NoPluginsInstalledMessage":"You have no plugins installed.","BrowsePluginCatalogMessage":"Browse our plugin catalog to view available plugins.","MessageKeyEmailedTo":"Key emailed to {0}.","MessageKeysLinked":"Keys linked.","HeaderConfirmation":"Confirmation","MessageKeyUpdated":"Thank you. Your supporter key has been updated.","MessageKeyRemoved":"Thank you. Your supporter key has been removed.","HeaderSupportTheTeam":"Support the Emby Team","TextEnjoyBonusFeatures":"Enjoy Bonus Features","TitleLiveTV":"Live TV","ButtonCancelSyncJob":"Cancel sync job","TitleSync":"Sync","HeaderSelectDate":"Select Date","ButtonDonate":"Donate","HeaderMyMedia":"My Media","TitleNotifications":"Notifications","ErrorLaunchingChromecast":"There was an error launching chromecast. Please ensure your device is connected to your wireless network.","MessageErrorLoadingSupporterInfo":"There was an error loading supporter information. Please try again later.","MessageLinkYourSupporterKey":"Link your supporter key with up to {0} Emby Connect members to enjoy free access to the following apps:","HeaderConfirmRemoveUser":"Remove User","MessageSwipeDownOnRemoteControl":"Welcome to remote control. Select the device to control by clicking the cast icon in the upper right corner. Swipe down anywhere on this screen to go back to where you came from.","MessageConfirmRemoveConnectSupporter":"Are you sure you wish to remove additional supporter benefits from this user?","ValueTimeLimitSingleHour":"Time limit: 1 hour","ValueTimeLimitMultiHour":"Time limit: {0} hours","HeaderUsers":"Users","PluginCategoryGeneral":"General","PluginCategoryContentProvider":"Content Providers","PluginCategoryScreenSaver":"Screen Savers","PluginCategoryTheme":"Themes","PluginCategorySync":"Sync","PluginCategorySocialIntegration":"Social Networks","PluginCategoryNotifications":"Notifications","PluginCategoryMetadata":"Metadata","PluginCategoryLiveTV":"Live TV","PluginCategoryChannel":"Channels","HeaderSearch":"Search","ValueDateCreated":"Date created: {0}","LabelArtist":"Artist","LabelMovie":"Movie","LabelMusicVideo":"Music Video","LabelEpisode":"Episode","LabelSeries":"Series","LabelStopping":"Stopping","LabelCancelled":"(cancelled)","LabelFailed":"(failed)","ButtonHelp":"Help","ButtonSave":"Save","ButtonDownload":"Download","SyncJobStatusQueued":"Queued","SyncJobStatusConverting":"Converting","SyncJobStatusFailed":"Failed","SyncJobStatusCancelled":"Cancelled","SyncJobStatusCompleted":"Synced","SyncJobStatusReadyToTransfer":"Ready to Transfer","SyncJobStatusTransferring":"Transferring","SyncJobStatusCompletedWithError":"Synced with errors","SyncJobItemStatusReadyToTransfer":"Ready to Transfer","LabelCollection":"Collection","HeaderAddToCollection":"Add to Collection","NewCollectionNameExample":"Example: Star Wars Collection","OptionSearchForInternetMetadata":"Search the internet for artwork and metadata","LabelSelectCollection":"Select collection:","HeaderDevices":"Devices","ButtonScheduledTasks":"Scheduled tasks","MessageItemsAdded":"Items added","ButtonAddToCollection":"Add to collection","HeaderSelectCertificatePath":"Select Certificate Path","ConfirmMessageScheduledTaskButton":"This operation normally runs automatically as a scheduled task. It can also be run manually here. To configure the scheduled task, see:","HeaderSupporterBenefit":"A supporter membership provides additional benefits such as access to sync, premium plugins, internet channel content, and more. {0}Learn more{1}.","LabelSyncNoTargetsHelp":"It looks like you don't currently have any apps that support sync.","HeaderWelcomeToProjectServerDashboard":"Welcome to the Emby Server Dashboard","HeaderWelcomeToProjectWebClient":"Welcome to Emby","ButtonTakeTheTour":"Take the tour","HeaderWelcomeBack":"Welcome back!","TitlePlugins":"Plugins","ButtonTakeTheTourToSeeWhatsNew":"Take the tour to see what's new","MessageNoSyncJobsFound":"No sync jobs found. Create sync jobs using the Sync buttons found throughout the web interface.","HeaderLibraryAccess":"Library Access","HeaderChannelAccess":"Channel Access","HeaderDeviceAccess":"Device Access","HeaderSelectDevices":"Select Devices","ButtonCancelItem":"Cancel item","ButtonQueueForRetry":"Queue for retry","ButtonReenable":"Re-enable","ButtonLearnMore":"Learn more","SyncJobItemStatusSyncedMarkForRemoval":"Marked for removal","LabelAbortedByServerShutdown":"(Aborted by server shutdown)","LabelScheduledTaskLastRan":"Last ran {0}, taking {1}.","HeaderDeleteTaskTrigger":"Delete Task Trigger","HeaderTaskTriggers":"Task Triggers","MessageDeleteTaskTrigger":"Are you sure you wish to delete this task trigger?","MessageNoPluginsInstalled":"You have no plugins installed.","LabelVersionInstalled":"{0} installed","LabelNumberReviews":"{0} Reviews","LabelFree":"Free","HeaderPlaybackError":"Playback Error","MessagePlaybackErrorNotAllowed":"You're currently not authorized to play this content. Please contact your system administrator for details.","MessagePlaybackErrorNoCompatibleStream":"No compatible streams are currently available. Please try again later or contact your system administrator for details.","MessagePlaybackErrorRateLimitExceeded":"Your playback rate limit has been exceeded. Please contact your system administrator for details.","MessagePlaybackErrorPlaceHolder":"The content chosen is not playable from this device.","HeaderSelectAudio":"Select Audio","HeaderSelectSubtitles":"Select Subtitles","ButtonMarkForRemoval":"Remove from device","ButtonUnmarkForRemoval":"Cancel removal from device","LabelDefaultStream":"(Default)","LabelForcedStream":"(Forced)","LabelDefaultForcedStream":"(Default/Forced)","LabelUnknownLanguage":"Unknown language","MessageConfirmSyncJobItemCancellation":"Are you sure you wish to cancel this item?","ButtonMute":"Mute","ButtonUnmute":"Unmute","ButtonStop":"Stop","ButtonNextTrack":"Next Track","ButtonPause":"Pause","ButtonPlay":"Play","ButtonEdit":"Edit","ButtonQueue":"Queue","ButtonPlayTrailer":"Play trailer","ButtonPlaylist":"Playlist","ButtonPreviousTrack":"Previous Track","LabelEnabled":"Enabled","LabelDisabled":"Disabled","ButtonMoreInformation":"More Information","LabelNoUnreadNotifications":"No unread notifications.","ButtonViewNotifications":"View notifications","ButtonMarkTheseRead":"Mark these read","ButtonClose":"Close","LabelAllPlaysSentToPlayer":"All plays will be sent to the selected player.","MessageInvalidUser":"Invalid username or password. Please try again.","HeaderLoginFailure":"Login Failure","HeaderAllRecordings":"All Recordings","RecommendationBecauseYouLike":"Because you like {0}","RecommendationBecauseYouWatched":"Because you watched {0}","RecommendationDirectedBy":"Directed by {0}","RecommendationStarring":"Starring {0}","HeaderConfirmRecordingCancellation":"Confirm Recording Cancellation","MessageConfirmRecordingCancellation":"Are you sure you wish to cancel this recording?","MessageRecordingCancelled":"Recording cancelled.","HeaderConfirmSeriesCancellation":"Confirm Series Cancellation","MessageConfirmSeriesCancellation":"Are you sure you wish to cancel this series?","MessageSeriesCancelled":"Series cancelled.","HeaderConfirmRecordingDeletion":"Confirm Recording Deletion","MessageConfirmRecordingDeletion":"Are you sure you wish to delete this recording?","MessageRecordingDeleted":"Recording deleted.","ButonCancelRecording":"Cancel Recording","MessageRecordingSaved":"Recording saved.","OptionSunday":"Sunday","OptionMonday":"Monday","OptionTuesday":"Tuesday","OptionWednesday":"Wednesday","OptionThursday":"Thursday","OptionFriday":"Friday","OptionSaturday":"Saturday","OptionEveryday":"Every day","OptionWeekend":"Weekends","OptionWeekday":"Weekdays","HeaderConfirmDeletion":"Confirm Deletion","MessageConfirmPathSubstitutionDeletion":"Are you sure you wish to delete this path substitution?","LiveTvUpdateAvailable":"(Update available)","LabelVersionUpToDate":"Up to date!","ButtonResetTuner":"Reset tuner","HeaderResetTuner":"Reset Tuner","MessageConfirmResetTuner":"Are you sure you wish to reset this tuner? Any active players or recordings will be abruptly stopped.","ButtonCancelSeries":"Cancel Series","HeaderSeriesRecordings":"Series Recordings","LabelAnytime":"Any time","StatusRecording":"Recording","StatusWatching":"Watching","StatusRecordingProgram":"Recording {0}","StatusWatchingProgram":"Watching {0}","HeaderSplitMedia":"Split Media Apart","MessageConfirmSplitMedia":"Are you sure you wish to split the media sources into separate items?","HeaderError":"Error","MessageChromecastConnectionError":"Your Chromecast receiver is unable to connect to your Emby Server. Please check their connections and try again.","MessagePleaseSelectOneItem":"Please select at least one item.","MessagePleaseSelectTwoItems":"Please select at least two items.","MessageTheFollowingItemsWillBeGrouped":"The following titles will be grouped into one item:","MessageConfirmItemGrouping":"Emby apps will automatically choose the optimal version to play based on device and network performance. Are you sure you wish to continue?","HeaderResume":"Resume","HeaderMyViews":"My Views","HeaderLibraryFolders":"Media Folders","HeaderLatestMedia":"Latest Media","ButtonMoreItems":"More...","ButtonMore":"More","HeaderFavoriteMovies":"Favorite Movies","HeaderFavoriteShows":"Favorite Shows","HeaderFavoriteEpisodes":"Favorite Episodes","HeaderFavoriteGames":"Favorite Games","HeaderRatingsDownloads":"Rating / Downloads","HeaderConfirmProfileDeletion":"Confirm Profile Deletion","MessageConfirmProfileDeletion":"Are you sure you wish to delete this profile?","HeaderSelectServerCachePath":"Select Server Cache Path","HeaderSelectTranscodingPath":"Select Transcoding Temporary Path","HeaderSelectImagesByNamePath":"Select Images By Name Path","HeaderSelectMetadataPath":"Select Metadata Path","HeaderSelectServerCachePathHelp":"Browse or enter the path to use for server cache files. The folder must be writeable.","HeaderSelectTranscodingPathHelp":"Browse or enter the path to use for transcoding temporary files. The folder must be writeable.","HeaderSelectImagesByNamePathHelp":"Browse or enter the path to your items by name folder. The folder must be writeable.","HeaderSelectMetadataPathHelp":"Browse or enter the path you'd like to store metadata within. The folder must be writeable.","HeaderSelectChannelDownloadPath":"Select Channel Download Path","HeaderSelectChannelDownloadPathHelp":"Browse or enter the path to use for storing channel cache files. The folder must be writeable.","OptionNewCollection":"New...","ButtonAdd":"Add","ButtonRemove":"Remove","LabelChapterDownloaders":"Chapter downloaders:","LabelChapterDownloadersHelp":"Enable and rank your preferred chapter downloaders in order of priority. Lower priority downloaders will only be used to fill in missing information.","HeaderFavoriteAlbums":"Favorite Albums","HeaderLatestChannelMedia":"Latest Channel Items","ButtonOrganizeFile":"Organize File","ButtonDeleteFile":"Delete File","HeaderOrganizeFile":"Organize File","HeaderDeleteFile":"Delete File","StatusSkipped":"Skipped","StatusFailed":"Failed","StatusSuccess":"Success","MessageFileWillBeDeleted":"The following file will be deleted:","MessageSureYouWishToProceed":"Are you sure you wish to proceed?","MessageDuplicatesWillBeDeleted":"In addition the following dupliates will be deleted:","MessageFollowingFileWillBeMovedFrom":"The following file will be moved from:","MessageDestinationTo":"to:","HeaderSelectWatchFolder":"Select Watch Folder","HeaderSelectWatchFolderHelp":"Browse or enter the path to your watch folder. The folder must be writeable.","OrganizePatternResult":"Result: {0}","HeaderRestart":"Restart","HeaderShutdown":"Shutdown","MessageConfirmRestart":"Are you sure you wish to restart Emby Server?","MessageConfirmShutdown":"Are you sure you wish to shutdown Emby Server?","ButtonUpdateNow":"Update Now","ValueItemCount":"{0} item","ValueItemCountPlural":"{0} items","NewVersionOfSomethingAvailable":"A new version of {0} is available!","VersionXIsAvailableForDownload":"Version {0} is now available for download.","LabelVersionNumber":"Version {0}","LabelPlayMethodTranscoding":"Transcoding","LabelPlayMethodDirectStream":"Direct Streaming","LabelPlayMethodDirectPlay":"Direct Playing","LabelAudioCodec":"Audio: {0}","LabelVideoCodec":"Video: {0}","LabelLocalAccessUrl":"Local access: {0}","LabelRemoteAccessUrl":"Remote access: {0}","LabelRunningOnPort":"Running on http port {0}.","LabelRunningOnPorts":"Running on http port {0}, and https port {1}.","HeaderLatestFromChannel":"Latest from {0}","LabelUnknownLanaguage":"Unknown language","HeaderCurrentSubtitles":"Current Subtitles","MessageDownloadQueued":"The download has been queued.","MessageAreYouSureDeleteSubtitles":"Are you sure you wish to delete this subtitle file?","ButtonRemoteControl":"Remote Control","HeaderLatestTvRecordings":"Latest Recordings","ButtonOk":"Ok","ButtonCancel":"Cancel","ButtonRefresh":"Refresh","LabelCurrentPath":"Current path:","HeaderSelectMediaPath":"Select Media Path","HeaderSelectPath":"Select Path","ButtonNetwork":"Network","MessageDirectoryPickerInstruction":"Network paths can be entered manually in the event the Network button fails to locate your devices. For example, {0} or {1}.","HeaderMenu":"Menu","ButtonOpen":"Open","ButtonOpenInNewTab":"Open in new tab","ButtonShuffle":"Shuffle","ButtonInstantMix":"Instant mix","ButtonResume":"Resume","HeaderScenes":"Scenes","HeaderAudioTracks":"Audio Tracks","HeaderLibraries":"Libraries","HeaderSubtitles":"Subtitles","HeaderVideoQuality":"Video Quality","MessageErrorPlayingVideo":"There was an error playing the video.","MessageEnsureOpenTuner":"Please ensure there is an open tuner availalble.","ButtonHome":"Home","ButtonDashboard":"Dashboard","ButtonReports":"Reports","ButtonMetadataManager":"Metadata Manager","HeaderTime":"Time","HeaderName":"Name","HeaderAlbum":"Album","HeaderAlbumArtist":"Album Artist","HeaderArtist":"Artist","LabelAddedOnDate":"Added {0}","ButtonStart":"Start","HeaderChannels":"Channels","HeaderMediaFolders":"Media Folders","HeaderBlockItemsWithNoRating":"Block content with no rating information:","OptionBlockOthers":"Others","OptionBlockTvShows":"TV Shows","OptionBlockTrailers":"Trailers","OptionBlockMusic":"Music","OptionBlockMovies":"Movies","OptionBlockBooks":"Books","OptionBlockGames":"Games","OptionBlockLiveTvPrograms":"Live TV Programs","OptionBlockLiveTvChannels":"Live TV Channels","OptionBlockChannelContent":"Internet Channel Content","ButtonRevoke":"Revoke","MessageConfirmRevokeApiKey":"Are you sure you wish to revoke this api key? The application's connection to Emby Server will be abruptly terminated.","HeaderConfirmRevokeApiKey":"Revoke Api Key","ValueContainer":"Container: {0}","ValueAudioCodec":"Audio Codec: {0}","ValueVideoCodec":"Video Codec: {0}","ValueCodec":"Codec: {0}","ValueConditions":"Conditions: {0}","LabelAll":"All","HeaderDeleteImage":"Delete Image","MessageFileNotFound":"File not found.","MessageFileReadError":"An error occurred reading this file.","ButtonNextPage":"Next Page","ButtonPreviousPage":"Previous Page","ButtonMoveLeft":"Move left","ButtonMoveRight":"Move right","ButtonBrowseOnlineImages":"Browse online images","HeaderDeleteItem":"Delete Item","ConfirmDeleteItem":"Deleting this item will delete it from both the file system and your media library. Are you sure you wish to continue?","MessagePleaseEnterNameOrId":"Please enter a name or an external Id.","MessageValueNotCorrect":"The value entered is not correct. Please try again.","MessageItemSaved":"Item saved.","MessagePleaseAcceptTermsOfServiceBeforeContinuing":"Please accept the terms of service before continuing.","OptionEnded":"Ended","OptionContinuing":"Continuing","OptionOff":"Off","OptionOn":"On","ButtonSettings":"Settings","ButtonUninstall":"Uninstall","HeaderFields":"Fields","HeaderFieldsHelp":"Slide a field to 'off' to lock it and prevent it's data from being changed.","HeaderLiveTV":"Live TV","MissingLocalTrailer":"Missing local trailer.","MissingPrimaryImage":"Missing primary image.","MissingBackdropImage":"Missing backdrop image.","MissingLogoImage":"Missing logo image.","MissingEpisode":"Missing episode.","OptionScreenshots":"Screenshots","OptionBackdrops":"Backdrops","OptionImages":"Images","OptionKeywords":"Keywords","OptionTags":"Tags","OptionStudios":"Studios","OptionName":"Name","OptionOverview":"Overview","OptionGenres":"Genres","OptionParentalRating":"Parental Rating","OptionPeople":"People","OptionRuntime":"Runtime","OptionProductionLocations":"Production Locations","OptionBirthLocation":"Birth Location","LabelAllChannels":"All channels","LabelLiveProgram":"LIVE","LabelNewProgram":"NEW","LabelPremiereProgram":"PREMIERE","LabelHDProgram":"HD","HeaderChangeFolderType":"Change Content Type","HeaderChangeFolderTypeHelp":"To change the type, please remove and rebuild the folder with the new type.","HeaderAlert":"Alert","MessagePleaseRestart":"Please restart to finish updating.","ButtonRestart":"Restart","MessagePleaseRefreshPage":"Please refresh this page to receive new updates from the server.","ButtonHide":"Hide","MessageSettingsSaved":"Settings saved.","ButtonSignOut":"Sign Out","ButtonMyProfile":"My Profile","ButtonMyPreferences":"My Preferences","MessageBrowserDoesNotSupportWebSockets":"This browser does not support web sockets. For a better experience, try a newer browser such as Chrome, Firefox, IE10+, Safari (iOS) or Opera.","LabelInstallingPackage":"Installing {0}","LabelPackageInstallCompleted":"{0} installation completed.","LabelPackageInstallFailed":"{0} installation failed.","LabelPackageInstallCancelled":"{0} installation cancelled.","TabServer":"Server","TabUsers":"Users","TabLibrary":"Library","TabMetadata":"Metadata","TabDLNA":"DLNA","TabLiveTV":"Live TV","TabAutoOrganize":"Auto-Organize","TabPlugins":"Plugins","TabAdvanced":"Advanced","TabHelp":"Help","TabScheduledTasks":"Scheduled Tasks","ButtonFullscreen":"Fullscreen","ButtonAudioTracks":"Audio Tracks","ButtonSubtitles":"Subtitles","ButtonScenes":"Scenes","ButtonQuality":"Quality","HeaderNotifications":"Notifications","HeaderSelectPlayer":"Select Player:","ButtonSelect":"Select","ButtonNew":"New","MessageInternetExplorerWebm":"For best results with Internet Explorer please install the WebM playback plugin.","HeaderVideoError":"Video Error","ButtonAddToPlaylist":"Add to playlist","HeaderAddToPlaylist":"Add to Playlist","LabelName":"Name:","ButtonSubmit":"Submit","LabelSelectPlaylist":"Playlist:","OptionNewPlaylist":"New playlist...","MessageAddedToPlaylistSuccess":"Ok","ButtonView":"View","ButtonViewSeriesRecording":"View series recording","ValueOriginalAirDate":"Original air date: {0}","ButtonRemoveFromPlaylist":"Remove from playlist","HeaderSpecials":"Specials","HeaderTrailers":"Trailers","HeaderAudio":"Audio","HeaderResolution":"Resolution","HeaderVideo":"Video","HeaderRuntime":"Runtime","HeaderCommunityRating":"Community rating","HeaderPasswordReset":"Password Reset","HeaderParentalRating":"Parental rating","HeaderReleaseDate":"Release date","HeaderDateAdded":"Date added","HeaderSeries":"Series","HeaderSeason":"Season","HeaderSeasonNumber":"Season number","HeaderNetwork":"Network","HeaderYear":"Year","HeaderGameSystem":"Game system","HeaderPlayers":"Players","HeaderEmbeddedImage":"Embedded image","HeaderTrack":"Track","HeaderDisc":"Disc","OptionMovies":"Movies","OptionCollections":"Collections","OptionSeries":"Series","OptionSeasons":"Seasons","OptionEpisodes":"Episodes","OptionGames":"Games","OptionGameSystems":"Game systems","OptionMusicArtists":"Music artists","OptionMusicAlbums":"Music albums","OptionMusicVideos":"Music videos","OptionSongs":"Songs","OptionHomeVideos":"Home videos","OptionBooks":"Books","OptionAdultVideos":"Adult videos","ButtonUp":"Up","ButtonDown":"Down","LabelMetadataReaders":"Metadata readers:","LabelMetadataReadersHelp":"Rank your preferred local metadata sources in order of priority. The first file found will be read.","LabelMetadataDownloaders":"Metadata downloaders:","LabelMetadataDownloadersHelp":"Enable and rank your preferred metadata downloaders in order of priority. Lower priority downloaders will only be used to fill in missing information.","LabelMetadataSavers":"Metadata savers:","LabelMetadataSaversHelp":"Choose the file formats to save your metadata to.","LabelImageFetchers":"Image fetchers:","LabelImageFetchersHelp":"Enable and rank your preferred image fetchers in order of priority.","ButtonQueueAllFromHere":"Queue all from here","ButtonPlayAllFromHere":"Play all from here","LabelDynamicExternalId":"{0} Id:","HeaderIdentify":"Identify Item","PersonTypePerson":"Person","LabelTitleDisplayOrder":"Title display order:","OptionSortName":"Sort name","OptionReleaseDate":"Release date","LabelSeasonNumber":"Season number:","LabelDiscNumber":"Disc number","LabelParentNumber":"Parent number","LabelEpisodeNumber":"Episode number:","LabelTrackNumber":"Track number:","LabelNumber":"Number:","LabelReleaseDate":"Release date:","LabelEndDate":"End date:","LabelYear":"Year:","LabelDateOfBirth":"Date of birth:","LabelBirthYear":"Birth year:","LabelBirthDate":"Birth date:","LabelDeathDate":"Death date:","HeaderRemoveMediaLocation":"Remove Media Location","MessageConfirmRemoveMediaLocation":"Are you sure you wish to remove this location?","HeaderRenameMediaFolder":"Rename Media Folder","LabelNewName":"New name:","HeaderAddMediaFolder":"Add Media Folder","HeaderAddMediaFolderHelp":"Name (Movies, Music, TV, etc):","HeaderRemoveMediaFolder":"Remove Media Folder","MessageTheFollowingLocationWillBeRemovedFromLibrary":"The following media locations will be removed from your library:","MessageAreYouSureYouWishToRemoveMediaFolder":"Are you sure you wish to remove this media folder?","ButtonRename":"Rename","ButtonChangeType":"Change type","HeaderMediaLocations":"Media Locations","LabelContentTypeValue":"Content type: {0}","LabelPathSubstitutionHelp":"Optional: Path substitution can map server paths to network shares that clients can access for direct playback.","FolderTypeUnset":"Unset (mixed content)","FolderTypeMovies":"Movies","FolderTypeMusic":"Music","FolderTypeAdultVideos":"Adult videos","FolderTypePhotos":"Photos","FolderTypeMusicVideos":"Music videos","FolderTypeHomeVideos":"Home videos","FolderTypeGames":"Games","FolderTypeBooks":"Books","FolderTypeTvShows":"TV","TabMovies":"Movies","TabSeries":"Series","TabEpisodes":"Episodes","TabTrailers":"Trailers","TabGames":"Games","TabAlbums":"Albums","TabSongs":"Songs","TabMusicVideos":"Music Videos","BirthPlaceValue":"Birth place: {0}","DeathDateValue":"Died: {0}","BirthDateValue":"Born: {0}","HeaderLatestReviews":"Latest Reviews","HeaderPluginInstallation":"Plugin Installation","MessageAlreadyInstalled":"This version is already installed.","ValueReviewCount":"{0} Reviews","MessageYouHaveVersionInstalled":"You currently have version {0} installed.","MessageTrialExpired":"The trial period for this feature has expired","MessageTrialWillExpireIn":"The trial period for this feature will expire in {0} day(s)","MessageInstallPluginFromApp":"This plugin must be installed from with in the app you intend to use it in.","ValuePriceUSD":"Price: {0} (USD)","MessageFeatureIncludedWithSupporter":"You are registered for this feature, and will be able to continue using it with an active supporter membership.","MessageSupporterMembershipExpiredOn":"Your supporter membership expired on {0}.","MessageYouHaveALifetimeMembership":"You have a lifetime supporter membership. You can provide additional donations on a one-time or recurring basis using the options below. Thank you for supporting Emby.","MessageYouHaveAnActiveRecurringMembership":"You have an active {0} membership. You can upgrade your plan using the options below.","ButtonDelete":"Delete","HeaderEmbyAccountAdded":"Emby Account Added","MessageEmbyAccountAdded":"The Emby account has been added to this user.","MessagePendingEmbyAccountAdded":"The Emby account has been added to this user. An email will be sent to the owner of the account. The invitation will need to be confirmed by clicking a link within the email.","HeaderEmbyAccountRemoved":"Emby Account Removed","MessageEmbyAccontRemoved":"The Emby account has been removed from this user.","TooltipLinkedToEmbyConnect":"Linked to Emby Connect","HeaderUnrated":"Unrated","ValueDiscNumber":"Disc {0}","HeaderUnknownDate":"Unknown Date","HeaderUnknownYear":"Unknown Year","ValueMinutes":"{0} min","ButtonPlayExternalPlayer":"Play with external player","HeaderSelectExternalPlayer":"Select External Player","HeaderExternalPlayerPlayback":"External Player Playback","ButtonImDone":"I'm Done","OptionWatched":"Watched","OptionUnwatched":"Unwatched","ExternalPlayerPlaystateOptionsHelp":"Specify how you would like to resume playing this video next time.","LabelMarkAs":"Mark as:","OptionInProgress":"In-Progress","LabelResumePoint":"Resume point:","ValueOneMovie":"1 movie","ValueMovieCount":"{0} movies","ValueOneTrailer":"1 trailer","ValueTrailerCount":"{0} trailers","ValueOneSeries":"1 series","ValueSeriesCount":"{0} series","ValueOneEpisode":"1 episode","ValueEpisodeCount":"{0} episodes","ValueOneGame":"1 game","ValueGameCount":"{0} games","ValueOneAlbum":"1 album","ValueAlbumCount":"{0} albums","ValueOneSong":"1 song","ValueSongCount":"{0} songs","ValueOneMusicVideo":"1 music video","ValueMusicVideoCount":"{0} music videos","HeaderOffline":"Offline","HeaderUnaired":"Unaired","HeaderMissing":"Missing","ButtonWebsite":"Website","TooltipFavorite":"Favorite","TooltipLike":"Like","TooltipDislike":"Dislike","TooltipPlayed":"Played","ValueSeriesYearToPresent":"{0}-Present","ValueAwards":"Awards: {0}","ValueBudget":"Budget: {0}","ValueRevenue":"Revenue: {0}","ValuePremiered":"Premiered {0}","ValuePremieres":"Premieres {0}","ValueStudio":"Studio: {0}","ValueStudios":"Studios: {0}","ValueStatus":"Status: {0}","ValueSpecialEpisodeName":"Special - {0}","LabelLimit":"Limit:","ValueLinks":"Links: {0}","HeaderPeople":"People","HeaderCastAndCrew":"Cast & Crew","ValueArtist":"Artist: {0}","ValueArtists":"Artists: {0}","HeaderTags":"Tags","MediaInfoCameraMake":"Camera make","MediaInfoCameraModel":"Camera model","MediaInfoAltitude":"Altitude","MediaInfoAperture":"Aperture","MediaInfoExposureTime":"Exposure time","MediaInfoFocalLength":"Focal length","MediaInfoOrientation":"Orientation","MediaInfoIsoSpeedRating":"Iso speed rating","MediaInfoLatitude":"Latitude","MediaInfoLongitude":"Longitude","MediaInfoShutterSpeed":"Shutter speed","MediaInfoSoftware":"Software","HeaderIfYouLikeCheckTheseOut":"If you like {0}, check these out...","HeaderPlotKeywords":"Plot Keywords","HeaderMovies":"Movies","HeaderAlbums":"Albums","HeaderGames":"Games","HeaderBooks":"Books","HeaderEpisodes":"Episodes","HeaderSeasons":"Seasons","HeaderTracks":"Tracks","HeaderItems":"Items","HeaderOtherItems":"Other Items","ButtonFullReview":"Full review","ValueAsRole":"as {0}","ValueGuestStar":"Guest star","MediaInfoSize":"Size","MediaInfoPath":"Path","MediaInfoFormat":"Format","MediaInfoContainer":"Container","MediaInfoDefault":"Default","MediaInfoForced":"Forced","MediaInfoExternal":"External","MediaInfoTimestamp":"Timestamp","MediaInfoPixelFormat":"Pixel format","MediaInfoBitDepth":"Bit depth","MediaInfoSampleRate":"Sample rate","MediaInfoBitrate":"Bitrate","MediaInfoChannels":"Channels","MediaInfoLayout":"Layout","MediaInfoLanguage":"Language","MediaInfoCodec":"Codec","MediaInfoProfile":"Profile","MediaInfoLevel":"Level","MediaInfoAspectRatio":"Aspect ratio","MediaInfoResolution":"Resolution","MediaInfoAnamorphic":"Anamorphic","MediaInfoInterlaced":"Interlaced","MediaInfoFramerate":"Framerate","MediaInfoStreamTypeAudio":"Audio","MediaInfoStreamTypeData":"Data","MediaInfoStreamTypeVideo":"Video","MediaInfoStreamTypeSubtitle":"Subtitle","MediaInfoStreamTypeEmbeddedImage":"Embedded Image","MediaInfoRefFrames":"Ref frames","TabPlayback":"Playback","TabNotifications":"Notifications","TabExpert":"Expert","HeaderSelectCustomIntrosPath":"Select Custom Intros Path","HeaderRateAndReview":"Rate and Review","HeaderThankYou":"Thank You","MessageThankYouForYourReview":"Thank you for your review.","LabelYourRating":"Your rating:","LabelFullReview":"Full review:","LabelShortRatingDescription":"Short rating summary:","OptionIRecommendThisItem":"I recommend this item","WebClientTourContent":"View your recently added media, next episodes, and more. The green circles indicate how many unplayed items you have.","WebClientTourMovies":"Play movies, trailers and more from any device with a web browser","WebClientTourMouseOver":"Hold the mouse over any poster for quick access to important information","WebClientTourTapHold":"Tap and hold or right click any poster for a context menu","WebClientTourMetadataManager":"Click edit to open the metadata manager","WebClientTourPlaylists":"Easily create playlists and instant mixes, and play them on any device","WebClientTourCollections":"Create movie collections to group box sets together","WebClientTourUserPreferences1":"User preferences allow you to customize the way your library is presented in all of your Emby apps","WebClientTourUserPreferences2":"Configure your audio and subtitle language settings once, for every Emby app","WebClientTourUserPreferences3":"Design the web client home page to your liking","WebClientTourUserPreferences4":"Configure backdrops, theme songs and external players","WebClientTourMobile1":"The web client works great on smartphones and tablets...","WebClientTourMobile2":"and easily controls other devices and Emby apps","WebClientTourMySync":"Sync your personal media to your devices for offline viewing.","MessageEnjoyYourStay":"Enjoy your stay","DashboardTourDashboard":"The server dashboard allows you to monitor your server and your users. You'll always know who is doing what and where they are.","DashboardTourHelp":"In-app help provides easy buttons to open wiki pages relating to the on-screen content.","DashboardTourUsers":"Easily create user accounts for your friends and family, each with their own permissions, library access, parental controls and more.","DashboardTourCinemaMode":"Cinema mode brings the theater experience straight to your living room with the ability to play trailers and custom intros before the main feature.","DashboardTourChapters":"Enable chapter image generation for your videos for a more pleasing presentation while viewing.","DashboardTourSubtitles":"Automatically download subtitles for your videos in any language.","DashboardTourPlugins":"Install plugins such as internet video channels, live tv, metadata scanners, and more.","DashboardTourNotifications":"Automatically send notifications of server events to your mobile device, email and more.","DashboardTourScheduledTasks":"Easily manage long running operations with scheduled tasks. Decide when they run, and how often.","DashboardTourMobile":"The Emby Server dashboard works great on smartphones and tablets. Manage your server from the palm of your hand anytime, anywhere.","DashboardTourSync":"Sync your personal media to your devices for offline viewing.","MessageRefreshQueued":"Refresh queued","TabDevices":"Devices","TabExtras":"Extras","DeviceLastUsedByUserName":"Last used by {0}","HeaderDeleteDevice":"Delete Device","DeleteDeviceConfirmation":"Are you sure you wish to delete this device? It will reappear the next time a user signs in with it.","LabelEnableCameraUploadFor":"Enable camera upload for:","HeaderSelectUploadPath":"Select Upload Path","LabelEnableCameraUploadForHelp":"Uploads will occur automatically in the background when signed into Emby.","ErrorMessageStartHourGreaterThanEnd":"End time must be greater than the start time.","ButtonLibraryAccess":"Library access","ButtonParentalControl":"Parental control","HeaderInvitationSent":"Invitation Sent","MessageInvitationSentToUser":"An email has been sent to {0}, inviting them to accept your sharing invitation.","MessageInvitationSentToNewUser":"An email has been sent to {0} inviting them to sign up with Emby.","HeaderConnectionFailure":"Connection Failure","MessageUnableToConnectToServer":"We're unable to connect to the selected server right now. Please ensure it is running and try again.","ButtonSelectServer":"Select Server","MessagePluginConfigurationRequiresLocalAccess":"To configure this plugin please sign in to your local server directly.","MessageLoggedOutParentalControl":"Access is currently restricted. Please try again later.","DefaultErrorMessage":"There was an error processing the request. Please try again later.","ButtonAccept":"Accept","ButtonReject":"Reject","HeaderForgotPassword":"Forgot Password","MessageContactAdminToResetPassword":"Please contact your system administrator to reset your password.","MessageForgotPasswordInNetworkRequired":"Please try again within your home network to initiate the password reset process.","MessageForgotPasswordFileCreated":"The following file has been created on your server and contains instructions on how to proceed:","MessageForgotPasswordFileExpiration":"The reset pin will expire at {0}.","MessageInvalidForgotPasswordPin":"An invalid or expired pin was entered. Please try again.","MessagePasswordResetForUsers":"Passwords have been removed for the following users:","HeaderInviteGuest":"Invite Guest","ButtonLinkMyEmbyAccount":"Link my account now","MessageConnectAccountRequiredToInviteGuest":"In order to invite guests you need to first link your Emby account to this server.","ButtonSync":"Sync","SyncMedia":"Sync Media","HeaderCancelSyncJob":"Cancel Sync","CancelSyncJobConfirmation":"Cancelling the sync job will remove synced media from the device during the next sync process. Are you sure you wish to proceed?","TabSync":"Sync","MessagePleaseSelectDeviceToSyncTo":"Please select a device to sync to.","MessageSyncJobCreated":"Sync job created.","LabelSyncTo":"Sync to:","LabelSyncJobName":"Sync job name:","LabelQuality":"Quality:","HeaderSettings":"Settings","OptionAutomaticallySyncNewContent":"Automatically sync new content","OptionAutomaticallySyncNewContentHelp":"New content added to will be automatically synced to the device.","OptionSyncUnwatchedVideosOnly":"Sync unwatched videos only","OptionSyncUnwatchedVideosOnlyHelp":"Only unwatched videos will be synced, and videos will be removed from the device as they are watched.","LabelItemLimit":"Item limit:","LabelItemLimitHelp":"Optional. Set a limit to the number of items that will be synced.","MessageBookPluginRequired":"Requires installation of the Bookshelf plugin","MessageGamePluginRequired":"Requires installation of the GameBrowser plugin","MessageUnsetContentHelp":"Content will be displayed as plain folders. For best results use the metadata manager to set the content types of sub-folders.","SyncJobItemStatusQueued":"Queued","SyncJobItemStatusConverting":"Converting","SyncJobItemStatusTransferring":"Transferring","SyncJobItemStatusSynced":"Synced","SyncJobItemStatusFailed":"Failed","SyncJobItemStatusRemovedFromDevice":"Removed from device","SyncJobItemStatusCancelled":"Cancelled","LabelProfile":"Profile:","LabelBitrateMbps":"Bitrate (Mbps):","EmbyIntroDownloadMessage":"To download and install Emby Server visit {0}.","ButtonNewServer":"New Server","ButtonSignInWithConnect":"Sign in with Emby Connect","HeaderNewServer":"New Server","MyDevice":"My Device","ButtonRemote":"Remote","TabInfo":"Info","TabCast":"Cast","TabScenes":"Scenes","HeaderUnlockApp":"Unlock App","MessageUnlockAppWithPurchase":"Unlock the full features of the app with a small one-time purchase.","MessageUnlockAppWithPurchaseOrSupporter":"Unlock the full features of the app with a small one-time purchase, or by signing in with an active Emby Supporter Membership.","MessageUnlockAppWithSupporter":"Unlock the full features of the app by signing in with an active Emby Supporter Membership.","MessageToValidateSupporter":"If you have an active Emby Supporter Membership, simply sign into the app using your Wifi connection within your home network.","MessagePaymentServicesUnavailable":"Payment services are currently unavailable. Please try again later.","ButtonUnlockWithSupporter":"Sign in with Emby Supporter Membership","MessagePleaseSignInLocalNetwork":"Before proceeding, please ensure that you're connected to your local network using a Wifi or LAN connection.","ButtonUnlockWithPurchase":"Unlock with Purchase","ButtonUnlockPrice":"Unlock {0}","MessageLiveTvGuideRequiresUnlock":"The Live TV Guide is currently limited to {0} channels. Click the unlock button to learn how to enjoy the full experience.","OptionEnableFullscreen":"Enable Fullscreen","ButtonServer":"Server","HeaderAdmin":"Admin","HeaderLibrary":"Library","HeaderMedia":"Media","ButtonInbox":"Inbox","HeaderAdvanced":"Advanced","HeaderGroupVersions":"Group Versions","HeaderSaySomethingLike":"Say Something Like...","ButtonTryAgain":"Try Again","HeaderYouSaid":"You Said...","MessageWeDidntRecognizeCommand":"We're sorry, we didn't recognize that command.","MessageIfYouBlockedVoice":"If you denied voice access to the app you'll need to reconfigure before trying again.","MessageNoItemsFound":"No items found.","ButtonManageServer":"Manage Server","ButtonPreferences":"Preferences","ButtonViewArtist":"View artist","ButtonViewAlbum":"View album","ErrorMessagePasswordNotMatchConfirm":"The password and password confirmation must match.","ErrorMessageUsernameInUse":"The username is already in use. Please choose a new name and try again.","ErrorMessageEmailInUse":"The email address is already in use. Please enter a new email address and try again, or use the forgot password feature.","MessageThankYouForConnectSignUp":"Thank you for signing up for Emby Connect. An email will be sent to your address with instructions on how to confirm your new account. Please confirm the account and then return here to sign in."}
window.appMode='cordova';window.dashboardVersion='3.0.5658.23113';
var Logger={log:function(str){console.log(str);}};var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,g)).finalize(a)}}});var k=m.algo={};return m}(Math);(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,f)).finalize(b)}}});var s=p.algo={};return p}(Math);(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();(function(globalScope,localStorage,sessionStorage){function myStore(defaultObject){var self=this;self.localData={};var isDefaultAvailable;if(defaultObject){try{defaultObject.setItem('_test','0');isDefaultAvailable=true;}catch(e){}}
self.setItem=function(name,value){if(isDefaultAvailable){defaultObject.setItem(name,value);}else{self.localData[name]=value;}};self.getItem=function(name){if(isDefaultAvailable){return defaultObject.getItem(name);}
return self.localData[name];};self.removeItem=function(name){if(isDefaultAvailable){defaultObject.removeItem(name);}else{self.localData[name]=null;}};}
globalScope.appStorage=new myStore(localStorage);globalScope.sessionStore=new myStore(sessionStorage);})(window,window.localStorage,window.sessionStorage);(function(globalScope){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.generateDeviceId=function(keyName,seed){var keys=[];keys.push(navigator.userAgent);keys.push((navigator.cpuClass||""));if(seed){keys.push(seed);}
var randomId='';randomId=appStorage.getItem(keyName);if(!randomId){randomId=new Date().getTime();appStorage.setItem(keyName,randomId.toString());}
keys.push(randomId);return CryptoJS.SHA1(keys.join('|')).toString();};})(window);(function(globalScope,JSON){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.CredentialProvider=function(key){var self=this;var credentials=null;key=key||'servercredentials3';function ensure(){if(!credentials){var json=appStorage.getItem(key)||'{}';Logger.log('credentials initialized with: '+json);credentials=JSON.parse(json);credentials.Servers=credentials.Servers||credentials.servers||[];credentials.servers=null;}}
function get(){ensure();return credentials;}
function set(data){if(data){credentials=data;appStorage.setItem(key,JSON.stringify(data));}else{self.clear();}
Events.trigger(self,'credentialsupdated');}
self.clear=function(){credentials=null;appStorage.removeItem(key);};self.credentials=function(data){if(data){set(data);}
return get();};self.addOrUpdateServer=function(list,server){if(!server.Id){throw new Error('Server.Id cannot be null or empty');}
var existing=list.filter(function(s){return s.Id==server.Id;})[0];if(existing){existing.DateLastAccessed=Math.max(existing.DateLastAccessed||0,server.DateLastAccessed||0);existing.UserLinkType=server.UserLinkType;if(server.AccessToken){existing.AccessToken=server.AccessToken;existing.UserId=server.UserId;}
if(server.ExchangeToken){existing.ExchangeToken=server.ExchangeToken;}
if(server.RemoteAddress){existing.RemoteAddress=server.RemoteAddress;}
if(server.ManualAddress){existing.ManualAddress=server.ManualAddress;}
if(server.LocalAddress){existing.LocalAddress=server.LocalAddress;}
if(server.Name){existing.Name=server.Name;}
if(server.WakeOnLanInfos&&server.WakeOnLanInfos.length){existing.WakeOnLanInfos=server.WakeOnLanInfos;}
if(server.LastConnectionMode!=null){existing.LastConnectionMode=server.LastConnectionMode;}
existing.DateLastLocalConnection=Math.max(existing.DateLastLocalConnection||0,server.DateLastLocalConnection||0);return existing;}
else{list.push(server);return server;}};};})(window,window.JSON);(function(globalScope){globalScope.AjaxApi={param:function(params){return jQuery.param(params);},ajax:function(request){request.timeout=request.timeout||30000;try{return jQuery.ajax(request);}catch(err){var deferred=DeferredBuilder.Deferred();deferred.reject();return deferred.promise();}}};})(window);(function(globalScope){globalScope.Events={on:function(obj,eventName,selector,fn){Logger.log('event.on '+eventName);jQuery(obj).on(eventName,selector,fn);},off:function(obj,eventName,selector,fn){Logger.log('event.off '+eventName);jQuery(obj).off(eventName,selector,fn);},trigger:function(obj,eventName,params){Logger.log('event.trigger '+eventName);jQuery(obj).trigger(eventName,params);}};})(window);(function(globalScope){globalScope.DeferredBuilder={Deferred:function(){return jQuery.Deferred();},when:function(promises){return jQuery.when(promises);}};})(window);(function(globalScope,JSON,WebSocket,setTimeout,devicePixelRatio,FileReader){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.ApiClient=function(logger,serverAddress,clientName,applicationVersion,deviceName,deviceId){if(!serverAddress){throw new Error("Must supply a serverAddress");}
logger.log('ApiClient serverAddress: '+serverAddress);logger.log('ApiClient clientName: '+clientName);logger.log('ApiClient applicationVersion: '+applicationVersion);logger.log('ApiClient deviceName: '+deviceName);logger.log('ApiClient deviceId: '+deviceId);var self=this;var webSocket;var serverInfo={};self.enableAppStorePolicy=false;self.serverAddress=function(val){if(val!=null){if(val.toLowerCase().indexOf('http')!=0){throw new Error('Invalid url: '+val);}
var changed=val!=serverAddress;serverAddress=val;if(changed){Events.trigger(this,'serveraddresschanged');}}
return serverAddress;};self.serverInfo=function(info){serverInfo=info||serverInfo;return serverInfo;};var currentUserPromise;self.getCurrentUser=function(){var promise=currentUserPromise;if(promise==null){promise=self.getUser(self.getCurrentUserId()).fail(function(){currentUserPromise=null;});currentUserPromise=promise;}
return promise;};self.getCurrentUserId=function(){return serverInfo.UserId;};self.accessToken=function(){return serverInfo.AccessToken;};self.deviceName=function(){return deviceName;};self.deviceId=function(){return deviceId;};self.clearAuthenticationInfo=function(){self.setAuthenticationInfo(null,null);};self.setAuthenticationInfo=function(accessKey,userId){currentUserPromise=null;serverInfo.AccessToken=accessKey;serverInfo.UserId=userId;};self.encodeName=function(name){name=name.split('/').join('-');name=name.split('&').join('-');name=name.split('?').join('-');var val=AjaxApi.param({name:name});return val.substring(val.indexOf('=')+1).replace("'",'%27');};function onRequestFail(e){Events.trigger(self,'requestfail',[{url:this.url,type:this.type,status:e.status,errorCode:e.getResponseHeader("X-Application-Error-Code")}]);}
function onRetryRequestFail(request){Events.trigger(self,'requestfail',[{url:request.url}]);}
self.ajax=function(request,includeAuthorization){if(!request){throw new Error("Request cannot be null");}
if(includeAuthorization!==false){var currentServerInfo=self.serverInfo();if(clientName){var auth='MediaBrowser Client="'+clientName+'", Device="'+deviceName+'", DeviceId="'+deviceId+'", Version="'+applicationVersion+'"';var userId=currentServerInfo.UserId;if(userId){auth+=', UserId="'+userId+'"';}
request.headers={Authorization:auth};}
var accessToken=currentServerInfo.AccessToken;if(accessToken){request.headers['X-MediaBrowser-Token']=accessToken;}}
if(self.enableAutomaticNetworking===false||request.type!="GET"){logger.log('Requesting url without automatic networking: '+request.url);return AjaxApi.ajax(request).fail(onRequestFail);}
var deferred=DeferredBuilder.Deferred();self.ajaxWithFailover(request,deferred,true);return deferred.promise();};function switchConnectionMode(connectionMode){var currentServerInfo=self.serverInfo();var newConnectionMode=connectionMode;newConnectionMode--;if(newConnectionMode<0){newConnectionMode=MediaBrowser.ConnectionMode.Manual;}
if(MediaBrowser.ServerInfo.getServerAddress(currentServerInfo,newConnectionMode)){return newConnectionMode;}
newConnectionMode--;if(newConnectionMode<0){newConnectionMode=MediaBrowser.ConnectionMode.Manual;}
if(MediaBrowser.ServerInfo.getServerAddress(currentServerInfo,newConnectionMode)){return newConnectionMode;}
return connectionMode;}
function tryReconnectInternal(deferred,connectionMode,currentRetryCount){connectionMode=switchConnectionMode(connectionMode);var url=MediaBrowser.ServerInfo.getServerAddress(self.serverInfo(),connectionMode);logger.log("Attempting reconnection to "+url);var timeout=connectionMode==MediaBrowser.ConnectionMode.Local?5000:15000;AjaxApi.ajax({type:"GET",url:url+"/system/info/public",dataType:"json",timeout:timeout}).done(function(){logger.log("Reconnect succeeeded to "+url);self.serverInfo().LastConnectionMode=connectionMode;self.serverAddress(url);deferred.resolve();}).fail(function(){logger.log("Reconnect attempt failed to "+url);if(currentRetryCount<=5){var newConnectionMode=switchConnectionMode(connectionMode);setTimeout(function(){tryReconnectInternal(deferred,newConnectionMode,currentRetryCount+1);},500);}else{deferred.reject();}});}
function tryReconnect(){var deferred=DeferredBuilder.Deferred();setTimeout(function(){tryReconnectInternal(deferred,self.serverInfo().LastConnectionMode,0);},500);return deferred.promise();}
function replaceServerAddress(url,oldBaseUrl,newBaseUrl){return url.replace(oldBaseUrl,newBaseUrl);}
self.ajaxWithFailover=function(request,deferred,enableReconnection,replaceUrl){if(replaceUrl){var currentServerInfo=self.serverInfo();var baseUrl=MediaBrowser.ServerInfo.getServerAddress(currentServerInfo,currentServerInfo.LastConnectionMode);request.url=replaceServerAddress(request.url,baseUrl);}
logger.log("Requesting "+request.url);request.timeout=15000;AjaxApi.ajax(request).done(function(response){deferred.resolve(response,0);}).fail(function(e,textStatus){logger.log("Request failed with textStatus "+textStatus+" to "+request.url);var statusCode=parseInt(e.status||'0');var isUserErrorCode=statusCode>=400&&statusCode<500;if(enableReconnection&&!isUserErrorCode){tryReconnect().done(function(){logger.log("Reconnect succeesed");self.ajaxWithFailover(request,deferred,false,true);}).fail(function(){logger.log("Reconnect failed");onRetryRequestFail(request);deferred.reject();});}else{onRetryRequestFail(request);deferred.reject();}});};self.get=function(url){return self.ajax({type:"GET",url:url});};self.getJSON=function(url){return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUrl=function(name,params){if(!name){throw new Error("Url name cannot be empty");}
var url=serverAddress;if(!url){throw new Error("serverAddress is yet not set");}
if(name.charAt(0)!='/'){url+='/';}
url+=name;if(params){url+="?"+AjaxApi.param(params);}
return url;};self.updateServerInfo=function(server,connectionMode){if(server==null){throw new Error('server cannot be null');}
if(connectionMode==null){throw new Error('connectionMode cannot be null');}
logger.log('Begin updateServerInfo. connectionMode: '+connectionMode);self.serverInfo(server);var serverUrl=MediaBrowser.ServerInfo.getServerAddress(server,connectionMode);if(!serverUrl){throw new Error('serverUrl cannot be null. serverInfo: '+JSON.stringify(server));}
logger.log('Setting server address to '+serverUrl);self.serverAddress(serverUrl);};self.isWebSocketSupported=function(){return WebSocket!=null;};self.openWebSocket=function(){var accessToken=self.serverInfo().AccessToken;if(!accessToken){throw new Error("Cannot open web socket without access token.");}
var url=serverAddress.replace('http','ws');url+="?api_key="+accessToken;url+="&deviceId="+deviceId;webSocket=new WebSocket(url);webSocket.onmessage=function(msg){msg=JSON.parse(msg.data);onWebSocketMessage(msg);};webSocket.onopen=function(){logger.log('web socket connection opened');setTimeout(function(){Events.trigger(self,'websocketopen');},0);};webSocket.onerror=function(){setTimeout(function(){Events.trigger(self,'websocketerror');},0);};webSocket.onclose=function(){setTimeout(function(){Events.trigger(self,'websocketclose');},0);};};self.closeWebSocket=function(){if(webSocket&&webSocket.readyState===WebSocket.OPEN){webSocket.close();}};function onWebSocketMessage(msg){if(msg.MessageType==="UserDeleted"){currentUserPromise=null;}
else if(msg.MessageType==="UserUpdated"||msg.MessageType==="UserConfigurationUpdated"){var user=msg.Data;if(user.Id==self.getCurrentUserId()){currentUserPromise=null;}}
Events.trigger(self,'websocketmessage',[msg]);}
self.sendWebSocketMessage=function(name,data){logger.log('Sending web socket message: '+name);var msg={MessageType:name};if(data){msg.Data=data;}
msg=JSON.stringify(msg);webSocket.send(msg);};self.isWebSocketOpen=function(){return webSocket&&webSocket.readyState===WebSocket.OPEN;};self.isWebSocketOpenOrConnecting=function(){return webSocket&&(webSocket.readyState===WebSocket.OPEN||webSocket.readyState===WebSocket.CONNECTING);};self.getProductNews=function(options){options=options||{};var url=self.getUrl("News/Product",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getItem=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getRootFolder=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Items/Root");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNotificationSummary=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Notifications/"+userId+"/Summary");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNotifications=function(userId,options){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Notifications/"+userId,options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.markNotificationsRead=function(userId,idList,isRead){if(!userId){throw new Error("null userId");}
if(!idList){throw new Error("null idList");}
var suffix=isRead?"Read":"Unread";var params={UserId:userId,Ids:idList.join(',')};var url=self.getUrl("Notifications/"+userId+"/"+suffix,params);return self.ajax({type:"POST",url:url});};self.logout=function(){self.closeWebSocket();var done=function(){self.setAuthenticationInfo(null,null);};if(self.serverInfo().AccessToken){var url=self.getUrl("Sessions/Logout");return self.ajax({type:"POST",url:url}).always(done);}
var deferred=DeferredBuilder.Deferred();deferred.resolveWith(null,[]);return deferred.promise().always(done);};function getRemoteImagePrefix(options){var urlPrefix;if(options.artist){urlPrefix="Artists/"+self.encodeName(options.artist);delete options.artist;}else if(options.person){urlPrefix="Persons/"+self.encodeName(options.person);delete options.person;}else if(options.genre){urlPrefix="Genres/"+self.encodeName(options.genre);delete options.genre;}else if(options.musicGenre){urlPrefix="MusicGenres/"+self.encodeName(options.musicGenre);delete options.musicGenre;}else if(options.gameGenre){urlPrefix="GameGenres/"+self.encodeName(options.gameGenre);delete options.gameGenre;}else if(options.studio){urlPrefix="Studios/"+self.encodeName(options.studio);delete options.studio;}else{urlPrefix="Items/"+options.itemId;delete options.itemId;}
return urlPrefix;}
self.getRemoteImageProviders=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages/Providers",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailableRemoteImages=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.downloadRemoteImage=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages/Download",options);return self.ajax({type:"POST",url:url});};self.getLiveTvInfo=function(options){var url=self.getUrl("LiveTv/Info",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvGuideInfo=function(options){var url=self.getUrl("LiveTv/GuideInfo",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvChannel=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Channels/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvChannels=function(options){var url=self.getUrl("LiveTv/Channels",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvPrograms=function(options){options=options||{};if(options.channelIds&&options.channelIds.length>1800){return self.ajax({type:"POST",url:self.getUrl("LiveTv/Programs"),data:JSON.stringify(options),contentType:"application/json",dataType:"json"});}else{return self.ajax({type:"GET",url:self.getUrl("LiveTv/Programs",options),dataType:"json"});}};self.getLiveTvRecommendedPrograms=function(options){options=options||{};return self.ajax({type:"GET",url:self.getUrl("LiveTv/Programs/Recommended",options),dataType:"json"});};self.getLiveTvRecordings=function(options){var url=self.getUrl("LiveTv/Recordings",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecordingGroups=function(options){var url=self.getUrl("LiveTv/Recordings/Groups",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecordingGroup=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Recordings/Groups/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecording=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Recordings/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvProgram=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Programs/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.deleteLiveTvRecording=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Recordings/"+id);return self.ajax({type:"DELETE",url:url});};self.cancelLiveTvTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Timers/"+id);return self.ajax({type:"DELETE",url:url});};self.getLiveTvTimers=function(options){var url=self.getUrl("LiveTv/Timers",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Timers/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNewLiveTvTimerDefaults=function(options){options=options||{};var url=self.getUrl("LiveTv/Timers/Defaults",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.createLiveTvTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/Timers");return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updateLiveTvTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/Timers/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.resetLiveTvTuner=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Tuners/"+id+"/Reset");return self.ajax({type:"POST",url:url});};self.getLiveTvSeriesTimers=function(options){var url=self.getUrl("LiveTv/SeriesTimers",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getFileOrganizationResults=function(options){var url=self.getUrl("Library/FileOrganization",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.deleteOriginalFileFromOrganizationResult=function(id){var url=self.getUrl("Library/FileOrganizations/"+id+"/File");return self.ajax({type:"DELETE",url:url});};self.clearOrganizationLog=function(){var url=self.getUrl("Library/FileOrganizations");return self.ajax({type:"DELETE",url:url});};self.performOrganization=function(id){var url=self.getUrl("Library/FileOrganizations/"+id+"/Organize");return self.ajax({type:"POST",url:url});};self.performEpisodeOrganization=function(id,options){var url=self.getUrl("Library/FileOrganizations/"+id+"/Episode/Organize",options||{});return self.ajax({type:"POST",url:url});};self.getLiveTvSeriesTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/SeriesTimers/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.cancelLiveTvSeriesTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/SeriesTimers/"+id);return self.ajax({type:"DELETE",url:url});};self.createLiveTvSeriesTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/SeriesTimers");return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updateLiveTvSeriesTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/SeriesTimers/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.getRegistrationInfo=function(feature){var url=self.getUrl("Registrations/"+feature);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSystemInfo=function(){var url=self.getUrl("System/Info");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPublicSystemInfo=function(){var url=self.getUrl("System/Info/Public");return self.ajax({type:"GET",url:url,dataType:"json"},false);};self.getInstantMixFromSong=function(itemId,options){var url=self.getUrl("Songs/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromAlbum=function(itemId,options){var url=self.getUrl("Albums/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromArtist=function(options){var url=self.getUrl("Artists/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromMusicGenre=function(options){var url=self.getUrl("MusicGenres/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromPlaylist=function(itemId,options){var url=self.getUrl("Playlists/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getEpisodes=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Episodes",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDisplayPreferences=function(id,userId,app){var url=self.getUrl("DisplayPreferences/"+id,{userId:userId,client:app});return self.ajax({type:"GET",url:url,dataType:"json"});};self.updateDisplayPreferences=function(id,obj,userId,app){var url=self.getUrl("DisplayPreferences/"+id,{userId:userId,client:app});return self.ajax({type:"POST",url:url,data:JSON.stringify(obj),contentType:"application/json"});};self.getSeasons=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Seasons",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarMovies=function(itemId,options){var url=self.getUrl("Movies/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarTrailers=function(itemId,options){var url=self.getUrl("Trailers/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarShows=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarAlbums=function(itemId,options){var url=self.getUrl("Albums/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarGames=function(itemId,options){var url=self.getUrl("Games/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCultures=function(){var url=self.getUrl("Localization/cultures");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCountries=function(){var url=self.getUrl("Localization/countries");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPluginSecurityInfo=function(){var url=self.getUrl("Plugins/SecurityInfo");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDirectoryContents=function(path,options){if(!path){throw new Error("null path");}
options=options||{};options.path=path;var url=self.getUrl("Environment/DirectoryContents",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNetworkShares=function(path){if(!path){throw new Error("null path");}
var options={};options.path=path;var url=self.getUrl("Environment/NetworkShares",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getParentPath=function(path){if(!path){throw new Error("null path");}
var options={};options.path=path;var url=self.getUrl("Environment/ParentPath",options);return self.ajax({type:"GET",url:url});};self.getDrives=function(){var url=self.getUrl("Environment/Drives");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNetworkDevices=function(){var url=self.getUrl("Environment/NetworkDevices");return self.ajax({type:"GET",url:url,dataType:"json"});};self.cancelPackageInstallation=function(installationId){if(!installationId){throw new Error("null installationId");}
var url=self.getUrl("Packages/Installing/"+installationId);return self.ajax({type:"DELETE",url:url});};self.refreshItem=function(itemId,options){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId+"/Refresh",options||{});return self.ajax({type:"POST",url:url});};self.installPlugin=function(name,guid,updateClass,version){if(!name){throw new Error("null name");}
if(!updateClass){throw new Error("null updateClass");}
var options={updateClass:updateClass,AssemblyGuid:guid};if(version){options.version=version;}
var url=self.getUrl("Packages/Installed/"+name,options);return self.ajax({type:"POST",url:url});};self.restartServer=function(){var url=self.getUrl("System/Restart");return self.ajax({type:"POST",url:url});};self.shutdownServer=function(){var url=self.getUrl("System/Shutdown");return self.ajax({type:"POST",url:url});};self.getPackageInfo=function(name,guid){if(!name){throw new Error("null name");}
var options={AssemblyGuid:guid};var url=self.getUrl("Packages/"+name,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailableApplicationUpdate=function(){var url=self.getUrl("Packages/Updates",{PackageType:"System"});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailablePluginUpdates=function(){var url=self.getUrl("Packages/Updates",{PackageType:"UserInstalled"});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getVirtualFolders=function(){var url="Library/VirtualFolders";url=self.getUrl(url);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPhysicalPaths=function(){var url=self.getUrl("Library/PhysicalPaths");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getServerConfiguration=function(){var url=self.getUrl("System/Configuration");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNamedConfiguration=function(name){var url=self.getUrl("System/Configuration/"+name);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getScheduledTasks=function(options){options=options||{};var url=self.getUrl("ScheduledTasks",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.startScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/Running/"+id);return self.ajax({type:"POST",url:url});};self.getScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNextUpEpisodes=function(options){var url=self.getUrl("Shows/NextUp",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.stopScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/Running/"+id);return self.ajax({type:"DELETE",url:url});};self.getPluginConfiguration=function(id){if(!id){throw new Error("null Id");}
var url=self.getUrl("Plugins/"+id+"/Configuration");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailablePlugins=function(options){options=options||{};options.PackageType="UserInstalled";if(self.enableAppStorePolicy){options.IsAppStoreEnabled=true;}
var url=self.getUrl("Packages",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.uninstallPlugin=function(id){if(!id){throw new Error("null Id");}
var url=self.getUrl("Plugins/"+id);return self.ajax({type:"DELETE",url:url});};self.removeVirtualFolder=function(name,refreshLibrary){if(!name){throw new Error("null name");}
var url="Library/VirtualFolders";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,name:name});return self.ajax({type:"DELETE",url:url});};self.addVirtualFolder=function(name,type,refreshLibrary){if(!name){throw new Error("null name");}
var options={};if(type){options.collectionType=type;}
options.refreshLibrary=refreshLibrary?true:false;options.name=name;var url="Library/VirtualFolders";url=self.getUrl(url,options);return self.ajax({type:"POST",url:url});};self.renameVirtualFolder=function(name,newName,refreshLibrary){if(!name){throw new Error("null name");}
var url="Library/VirtualFolders/Name";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,newName:newName,name:name});return self.ajax({type:"POST",url:url});};self.addMediaPath=function(virtualFolderName,mediaPath,refreshLibrary){if(!virtualFolderName){throw new Error("null virtualFolderName");}
if(!mediaPath){throw new Error("null mediaPath");}
var url="Library/VirtualFolders/Paths";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,path:mediaPath,name:virtualFolderName});return self.ajax({type:"POST",url:url});};self.removeMediaPath=function(virtualFolderName,mediaPath,refreshLibrary){if(!virtualFolderName){throw new Error("null virtualFolderName");}
if(!mediaPath){throw new Error("null mediaPath");}
var url="Library/VirtualFolders/Paths";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,path:mediaPath,name:virtualFolderName});return self.ajax({type:"DELETE",url:url});};self.deleteUser=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("Users/"+id);return self.ajax({type:"DELETE",url:url});};self.deleteUserImage=function(userId,imageType,imageIndex){if(!userId){throw new Error("null userId");}
if(!imageType){throw new Error("null imageType");}
var url=self.getUrl("Users/"+userId+"/Images/"+imageType);if(imageIndex!=null){url+="/"+imageIndex;}
return self.ajax({type:"DELETE",url:url});};self.deleteItemImage=function(itemId,imageType,imageIndex){if(!imageType){throw new Error("null imageType");}
var url=self.getUrl("Items/"+itemId+"/Images");url+="/"+imageType;if(imageIndex!=null){url+="/"+imageIndex;}
return self.ajax({type:"DELETE",url:url});};self.deleteItem=function(itemId){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId);return self.ajax({type:"DELETE",url:url});};self.stopActiveEncodings=function(playSessionId){var options={deviceId:deviceId};if(playSessionId){options.PlaySessionId=playSessionId;}
var url=self.getUrl("Videos/ActiveEncodings",options);return self.ajax({type:"DELETE",url:url});};self.reportCapabilities=function(options){var url=self.getUrl("Sessions/Capabilities/Full");return self.ajax({type:"POST",url:url,data:JSON.stringify(options),contentType:"application/json"});};self.updateItemImageIndex=function(itemId,imageType,imageIndex,newIndex){if(!imageType){throw new Error("null imageType");}
var options={newIndex:newIndex};var url=self.getUrl("Items/"+itemId+"/Images/"+imageType+"/"+imageIndex+"/Index",options);return self.ajax({type:"POST",url:url});};self.getItemImageInfos=function(itemId){var url=self.getUrl("Items/"+itemId+"/Images");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCriticReviews=function(itemId,options){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId+"/CriticReviews",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSessions=function(options){var url=self.getUrl("Sessions",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.uploadUserImage=function(userId,imageType,file){if(!userId){throw new Error("null userId");}
if(!imageType){throw new Error("null imageType");}
if(!file){throw new Error("File must be an image.");}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){throw new Error("File must be an image.");}
var deferred=DeferredBuilder.Deferred();var reader=new FileReader();reader.onerror=function(){deferred.reject();};reader.onabort=function(){deferred.reject();};reader.onload=function(e){var data=e.target.result.split(',')[1];var url=self.getUrl("Users/"+userId+"/Images/"+imageType);self.ajax({type:"POST",url:url,data:data,contentType:"image/"+file.name.substring(file.name.lastIndexOf('.')+1)}).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});};reader.readAsDataURL(file);return deferred.promise();};self.uploadItemImage=function(itemId,imageType,file){if(!itemId){throw new Error("null itemId");}
if(!imageType){throw new Error("null imageType");}
if(!file){throw new Error("File must be an image.");}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){throw new Error("File must be an image.");}
var url=self.getUrl("Items/"+itemId+"/Images");url+="/"+imageType;var deferred=DeferredBuilder.Deferred();var reader=new FileReader();reader.onerror=function(){deferred.reject();};reader.onabort=function(){deferred.reject();};reader.onload=function(e){var data=e.target.result.split(',')[1];self.ajax({type:"POST",url:url,data:data,contentType:"image/"+file.name.substring(file.name.lastIndexOf('.')+1)}).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});};reader.readAsDataURL(file);return deferred.promise();};self.getInstalledPlugins=function(){var options={};if(self.enableAppStorePolicy){options.IsAppStoreEnabled=true;}
var url=self.getUrl("Plugins",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUser=function(id){if(!id){throw new Error("Must supply a userId");}
var url=self.getUrl("Users/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getStudio=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Studios/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Genres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getMusicGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("MusicGenres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGameGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("GameGenres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getArtist=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Artists/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPerson=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Persons/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPublicUsers=function(){var url=self.getUrl("users/public");return self.ajax({type:"GET",url:url,dataType:"json"},false);};self.getUsers=function(options){var url=self.getUrl("users",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getParentalRatings=function(){var url=self.getUrl("Localization/ParentalRatings");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDefaultImageQuality=function(imageType){return imageType.toLowerCase()=='backdrop'?80:90;};function normalizeImageOptions(options){var ratio=devicePixelRatio||1;if(ratio){if(options.minScale){ratio=Math.max(options.minScale,ratio);}
if(options.width){options.width=Math.round(options.width*ratio);}
if(options.height){options.height=Math.round(options.height*ratio);}
if(options.maxWidth){options.maxWidth=Math.round(options.maxWidth*ratio);}
if(options.maxHeight){options.maxHeight=Math.round(options.maxHeight*ratio);}}
options.quality=options.quality||self.getDefaultImageQuality(options.type);if(self.normalizeImageOptions){self.normalizeImageOptions(options);}}
self.getUserImageUrl=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};var url="Users/"+userId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
normalizeImageOptions(options);delete options.type;delete options.index;return self.getUrl(url,options);};self.getImageUrl=function(itemId,options){if(!itemId){throw new Error("itemId cannot be empty");}
options=options||{};var url="Items/"+itemId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
options.quality=options.quality||self.getDefaultImageQuality(options.type);if(self.normalizeImageOptions){self.normalizeImageOptions(options);}
delete options.type;delete options.index;return self.getUrl(url,options);};self.getScaledImageUrl=function(itemId,options){if(!itemId){throw new Error("itemId cannot be empty");}
options=options||{};var url="Items/"+itemId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
normalizeImageOptions(options);delete options.type;delete options.index;delete options.minScale;return self.getUrl(url,options);};self.getThumbImageUrl=function(item,options){if(!item){throw new Error("null item");}
options=options||{};options.imageType="thumb";var itemId=item.ImageTags&&item.ImageTags.Thumb?item.Id:item.ParentThumbItemId;return itemId?self.getImageUrl(itemId,options):null;};self.authenticateUserByName=function(name,password){if(!name){var deferred=DeferredBuilder.Deferred();deferred.reject();return deferred.promise();}
var url=self.getUrl("Users/authenticatebyname");var postData={password:CryptoJS.SHA1(password||"").toString(),Username:name};return self.ajax({type:"POST",url:url,data:JSON.stringify(postData),dataType:"json",contentType:"application/json"}).done(function(result){Events.trigger(self,'authenticated',[result]);});};self.updateUserPassword=function(userId,currentPassword,newPassword){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Password");return self.ajax({type:"POST",url:url,data:{currentPassword:CryptoJS.SHA1(currentPassword).toString(),newPassword:CryptoJS.SHA1(newPassword).toString()}});};self.updateEasyPassword=function(userId,newPassword){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/EasyPassword");return self.ajax({type:"POST",url:url,data:{newPassword:CryptoJS.SHA1(newPassword).toString()}});};self.resetUserPassword=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Password");var postData={};postData.resetPassword=true;return self.ajax({type:"POST",url:url,data:postData});};self.resetEasyPassword=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/EasyPassword");var postData={};postData.resetPassword=true;return self.ajax({type:"POST",url:url,data:postData});};self.updateServerConfiguration=function(configuration){if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("System/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateNamedConfiguration=function(name,configuration){if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("System/Configuration/"+name);return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateItem=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("Items/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updatePluginSecurityInfo=function(info){var url=self.getUrl("Plugins/SecurityInfo");return self.ajax({type:"POST",url:url,data:JSON.stringify(info),contentType:"application/json"});};self.createUser=function(name){var url=self.getUrl("Users/New");return self.ajax({type:"POST",url:url,data:{Name:name},dataType:"json"});};self.updateUser=function(user){if(!user){throw new Error("null user");}
var url=self.getUrl("Users/"+user.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(user),contentType:"application/json"});};self.updateUserPolicy=function(userId,policy){if(!userId){throw new Error("null userId");}
if(!policy){throw new Error("null policy");}
var url=self.getUrl("Users/"+userId+"/Policy");return self.ajax({type:"POST",url:url,data:JSON.stringify(policy),contentType:"application/json"});};self.updateUserConfiguration=function(userId,configuration){if(!userId){throw new Error("null userId");}
if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("Users/"+userId+"/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateScheduledTaskTriggers=function(id,triggers){if(!id){throw new Error("null id");}
if(!triggers){throw new Error("null triggers");}
var url=self.getUrl("ScheduledTasks/"+id+"/Triggers");return self.ajax({type:"POST",url:url,data:JSON.stringify(triggers),contentType:"application/json"});};self.updatePluginConfiguration=function(id,configuration){if(!id){throw new Error("null Id");}
if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("Plugins/"+id+"/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.getAncestorItems=function(itemId,userId){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Items/"+itemId+"/Ancestors",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getItems=function(userId,options){var url;if((typeof userId).toString().toLowerCase()=='string'){url=self.getUrl("Users/"+userId+"/Items",options);}else{url=self.getUrl("Items",options);}
return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUserViews=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};var url=self.getUrl("Users/"+userId+"/Views",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getArtists=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Artists",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAlbumArtists=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Artists/AlbumArtists",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Genres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getMusicGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("MusicGenres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGameGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("GameGenres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPeople=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Persons",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getStudios=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Studios",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLocalTrailers=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/LocalTrailers");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAdditionalVideoParts=function(userId,itemId){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Videos/"+itemId+"/AdditionalParts",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getThemeMedia=function(userId,itemId,inherit){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
options.InheritFromParent=inherit||false;var url=self.getUrl("Items/"+itemId+"/ThemeMedia",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSearchHints=function(options){var url=self.getUrl("Search/Hints",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSpecialFeatures=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/SpecialFeatures");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDateParamValue=function(date){function formatDigit(i){return i<10?"0"+i:i;}
var d=date;return""+d.getFullYear()+formatDigit(d.getMonth()+1)+formatDigit(d.getDate())+formatDigit(d.getHours())+formatDigit(d.getMinutes())+formatDigit(d.getSeconds());};self.markPlayed=function(userId,itemId,date){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var options={};if(date){options.DatePlayed=self.getDateParamValue(date);}
var url=self.getUrl("Users/"+userId+"/PlayedItems/"+itemId,options);return self.ajax({type:"POST",url:url,dataType:"json"});};self.markUnplayed=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/PlayedItems/"+itemId);return self.ajax({type:"DELETE",url:url,dataType:"json"});};self.updateFavoriteStatus=function(userId,itemId,isFavorite){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/FavoriteItems/"+itemId);var method=isFavorite?"POST":"DELETE";return self.ajax({type:method,url:url,dataType:"json"});};self.updateUserItemRating=function(userId,itemId,likes){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/Rating",{likes:likes});return self.ajax({type:"POST",url:url,dataType:"json"});};self.getItemCounts=function(userId){var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Items/Counts",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.clearUserItemRating=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/Rating");return self.ajax({type:"DELETE",url:url,dataType:"json"});};self.reportPlaybackStart=function(options){if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/Playing");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.reportPlaybackProgress=function(options){if(!options){throw new Error("null options");}
if(self.isWebSocketOpen()){var deferred=DeferredBuilder.Deferred();var msg=JSON.stringify(options);self.sendWebSocketMessage("ReportPlaybackProgress",msg);deferred.resolveWith(null,[]);return deferred.promise();}
var url=self.getUrl("Sessions/Playing/Progress");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.reportPlaybackStopped=function(options){if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/Playing/Stopped");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.sendPlayCommand=function(sessionId,options){if(!sessionId){throw new Error("null sessionId");}
if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/"+sessionId+"/Playing",options);return self.ajax({type:"POST",url:url});};self.sendCommand=function(sessionId,command){if(!sessionId){throw new Error("null sessionId");}
if(!command){throw new Error("null command");}
var url=self.getUrl("Sessions/"+sessionId+"/Command");var ajaxOptions={type:"POST",url:url};ajaxOptions.data=JSON.stringify(command);ajaxOptions.contentType="application/json";return self.ajax(ajaxOptions);};self.sendMessageCommand=function(sessionId,options){if(!sessionId){throw new Error("null sessionId");}
if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/"+sessionId+"/Message",options);return self.ajax({type:"POST",url:url});};self.sendPlayStateCommand=function(sessionId,command,options){if(!sessionId){throw new Error("null sessionId");}
if(!command){throw new Error("null command");}
var url=self.getUrl("Sessions/"+sessionId+"/Playing/"+command,options||{});return self.ajax({type:"POST",url:url});};self.createPackageReview=function(review){var url=self.getUrl("Packages/Reviews/"+review.id,review);return self.ajax({type:"POST",url:url,});};self.getPackageReviews=function(packageId,minRating,maxRating,limit){if(!packageId){throw new Error("null packageId");}
var options={};if(minRating){options.MinRating=minRating;}
if(maxRating){options.MaxRating=maxRating;}
if(limit){options.Limit=limit;}
var url=self.getUrl("Packages/"+packageId+"/Reviews",options);return self.ajax({type:"GET",url:url,dataType:"json"});};};})(window,window.JSON,window.WebSocket,window.setTimeout,window.devicePixelRatio,window.FileReader);(function(globalScope){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.ConnectionState={Unavailable:0,ServerSelection:1,ServerSignIn:2,SignedIn:3,ConnectSignIn:4};globalScope.MediaBrowser.ConnectionMode={Local:0,Remote:1,Manual:2};globalScope.MediaBrowser.ServerInfo={getServerAddress:function(server,mode){switch(mode){case MediaBrowser.ConnectionMode.Local:return server.LocalAddress;case MediaBrowser.ConnectionMode.Manual:return server.ManualAddress;case MediaBrowser.ConnectionMode.Remote:return server.RemoteAddress;default:return server.ManualAddress||server.LocalAddress||server.RemoteAddress;}}};globalScope.MediaBrowser.ConnectionManager=function(logger,credentialProvider,appName,appVersion,deviceName,deviceId,capabilities){logger.log('Begin MediaBrowser.ConnectionManager constructor');var self=this;var apiClients=[];var defaultTimeout=15000;function mergeServers(list1,list2){for(var i=0,length=list2.length;i<length;i++){credentialProvider.addOrUpdateServer(list1,list2[i]);}
return list1;}
function resolveWithFailure(deferred){deferred.resolveWith(null,[{State:MediaBrowser.ConnectionState.Unavailable,ConnectUser:self.connectUser()}]);}
function updateServerInfo(server,systemInfo){server.Name=systemInfo.ServerName;server.Id=systemInfo.Id;if(systemInfo.LocalAddress){server.LocalAddress=systemInfo.LocalAddress;}
if(systemInfo.WanAddress){server.RemoteAddress=systemInfo.WanAddress;}
if(systemInfo.MacAddress){server.WakeOnLanInfos=[{MacAddress:systemInfo.MacAddress}];}}
function tryConnect(url,timeout){url+="/system/info/public";logger.log('tryConnect url: '+url);return AjaxApi.ajax({type:"GET",url:url,dataType:"json",timeout:timeout||defaultTimeout});}
var connectUser;self.connectUser=function(){return connectUser;};self.appVersion=function(){return appVersion;};self.capabilities=function(){return capabilities;};self.deviceId=function(){return deviceId;};self.credentialProvider=function(){return credentialProvider;};self.connectUserId=function(){return credentialProvider.credentials().ConnectUserId;};self.connectToken=function(){return credentialProvider.credentials().ConnectAccessToken;};self.getLastUsedServer=function(){var servers=credentialProvider.credentials().Servers;servers.sort(function(a,b){return(b.DateLastAccessed||0)-(a.DateLastAccessed||0);});if(!servers.length){return null;}
return servers[0];};self.getLastUsedApiClient=function(){var servers=credentialProvider.credentials().Servers;servers.sort(function(a,b){return(b.DateLastAccessed||0)-(a.DateLastAccessed||0);});if(!servers.length){return null;}
var server=servers[0];return getOrAddApiClient(server,server.LastConnectionMode);};self.addApiClient=function(apiClient){apiClients.push(apiClient);var existingServers=credentialProvider.credentials().Servers.filter(function(s){return stringEqualsIgnoreCase(s.ManualAddress,apiClient.serverAddress())||stringEqualsIgnoreCase(s.LocalAddress,apiClient.serverAddress())||stringEqualsIgnoreCase(s.RemoteAddress,apiClient.serverAddress());});var existingServer=existingServers.length?existingServers[0]:{};existingServer.DateLastAccessed=new Date().getTime();existingServer.LastConnectionMode=MediaBrowser.ConnectionMode.Manual;existingServer.ManualAddress=apiClient.serverAddress();apiClient.serverInfo(existingServer);Events.on(apiClient,'authenticated',function(e,result){onAuthenticated(this,result,{},true);});if(!existingServers.length){var credentials=credentialProvider.credentials();credentials.Servers=[existingServer];credentialProvider.credentials(credentials);}
Events.trigger(self,'apiclientcreated',[apiClient]);if(existingServer.Id){return;}
apiClient.getPublicSystemInfo().done(function(systemInfo){var credentials=credentialProvider.credentials();existingServer.Id=systemInfo.Id;apiClient.serverInfo(existingServer);credentials.Servers=[existingServer];credentialProvider.credentials(credentials);});};self.clearData=function(){logger.log('connection manager clearing data');connectUser=null;var credentials=credentialProvider.credentials();credentials.ConnectAccessToken=null;credentials.ConnectUserId=null;credentials.Servers=[];credentialProvider.credentials(credentials);};function onConnectUserSignIn(user){connectUser=user;Events.trigger(self,'connectusersignedin',[user]);}
function getOrAddApiClient(server,connectionMode){var apiClient=self.getApiClient(server.Id);if(!apiClient){var url=MediaBrowser.ServerInfo.getServerAddress(server,connectionMode);apiClient=new MediaBrowser.ApiClient(logger,url,appName,appVersion,deviceName,deviceId);apiClients.push(apiClient);apiClient.serverInfo(server);Events.on(apiClient,'authenticated',function(e,result){onAuthenticated(this,result,{},true);});Events.trigger(self,'apiclientcreated',[apiClient]);}
if(server.AccessToken&&server.UserId){apiClient.setAuthenticationInfo(server.AccessToken,server.UserId);}
else{apiClient.clearAuthenticationInfo();}
logger.log('returning instance from getOrAddApiClient');return apiClient;}
self.getOrCreateApiClient=function(serverId){var apiClient=self.getApiClient(serverId);if(apiClient){return apiClient;}
var credentials=credentialProvider.credentials();var servers=credentials.Servers.filter(function(s){return stringEqualsIgnoreCase(s.Id,serverId);});if(!servers.length){throw new Error('Server not found: '+serverId);}
var server=servers[0];return getOrAddApiClient(server,server.LastConnectionMode);};function onAuthenticated(apiClient,result,options,saveCredentials){var credentials=credentialProvider.credentials();var servers=credentials.Servers.filter(function(s){return s.Id==result.ServerId;});var server=servers.length?servers[0]:apiClient.serverInfo();server.DateLastAccessed=new Date().getTime();server.Id=result.ServerId;if(saveCredentials){server.UserId=result.User.Id;server.AccessToken=result.AccessToken;}else{server.UserId=null;server.AccessToken=null;}
credentialProvider.addOrUpdateServer(credentials.Servers,server);saveUserInfoIntoCredentials(server,result.User);credentialProvider.credentials(credentials);afterConnected(apiClient,options);onLocalUserSignIn(result.User);}
function saveUserInfoIntoCredentials(server,user){}
function afterConnected(apiClient,options){options=options||{};if(options.reportCapabilities!==false){apiClient.reportCapabilities(capabilities);}
if(options.enableWebSocket!==false){if(!apiClient.isWebSocketOpenOrConnecting&&apiClient.isWebSocketSupported()){logger.log('calling apiClient.openWebSocket');apiClient.openWebSocket();}}}
function onLocalUserSignIn(user){Events.trigger(self,'localusersignedin',[user]);}
function ensureConnectUser(credentials){var deferred=DeferredBuilder.Deferred();if(connectUser&&connectUser.Id==credentials.ConnectUserId){deferred.resolveWith(null,[[]]);}
else if(credentials.ConnectUserId&&credentials.ConnectAccessToken){connectUser=null;getConnectUser(credentials.ConnectUserId,credentials.ConnectAccessToken).done(function(user){onConnectUserSignIn(user);deferred.resolveWith(null,[[]]);}).fail(function(){deferred.resolveWith(null,[[]]);});}else{deferred.resolveWith(null,[[]]);}
return deferred.promise();}
function getConnectUser(userId,accessToken){if(!userId){throw new Error("null userId");}
if(!accessToken){throw new Error("null accessToken");}
var url="https://connect.mediabrowser.tv/service/user?id="+userId;return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Application":appName+"/"+appVersion,"X-Connect-UserToken":accessToken}});}
function addAuthenticationInfoFromConnect(server,connectionMode,credentials){if(!server.ExchangeToken){throw new Error("server.ExchangeToken cannot be null");}
if(!credentials.ConnectUserId){throw new Error("credentials.ConnectUserId cannot be null");}
var url=MediaBrowser.ServerInfo.getServerAddress(server,connectionMode);url+="/Connect/Exchange?format=json&ConnectUserId="+credentials.ConnectUserId;return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-MediaBrowser-Token":server.ExchangeToken}}).done(function(auth){server.UserId=auth.LocalUserId;server.AccessToken=auth.AccessToken;}).fail(function(){server.UserId=null;server.AccessToken=null;});}
function validateAuthentication(server,connectionMode){var deferred=DeferredBuilder.Deferred();var url=MediaBrowser.ServerInfo.getServerAddress(server,connectionMode);AjaxApi.ajax({type:"GET",url:url+"/system/info",dataType:"json",headers:{"X-MediaBrowser-Token":server.AccessToken}}).done(function(systemInfo){updateServerInfo(server,systemInfo);if(server.UserId){AjaxApi.ajax({type:"GET",url:url+"/users/"+server.UserId,dataType:"json",headers:{"X-MediaBrowser-Token":server.AccessToken}}).done(function(user){onLocalUserSignIn(user);deferred.resolveWith(null,[[]]);}).fail(function(){server.UserId=null;server.AccessToken=null;deferred.resolveWith(null,[[]]);});}}).fail(function(){server.UserId=null;server.AccessToken=null;deferred.resolveWith(null,[[]]);});return deferred.promise();}
function getImageUrl(localUser){if(connectUser&&connectUser.ImageUrl){return{url:connectUser.ImageUrl};}
if(localUser&&localUser.PrimaryImageTag){var apiClient=self.getApiClient(localUser);var url=apiClient.getUserImageUrl(localUser.Id,{tag:localUser.PrimaryImageTag,type:"Primary"});return{url:url,supportsParams:true};}
return{url:null,supportsParams:false};}
self.user=function(apiClient){var deferred=DeferredBuilder.Deferred();var localUser;function onLocalUserDone(){var image=getImageUrl(localUser);deferred.resolveWith(null,[{localUser:localUser,name:connectUser?connectUser.Name:(localUser?localUser.Name:null),canManageServer:localUser&&localUser.Policy.IsAdministrator,imageUrl:image.url,supportsImageParams:image.supportsParams}]);}
function onEnsureConnectUserDone(){if(apiClient&&apiClient.getCurrentUserId()){apiClient.getCurrentUser().done(function(u){localUser=u;}).always(onLocalUserDone);}else{onLocalUserDone();}}
var credentials=credentialProvider.credentials();if(credentials.ConnectUserId&&credentials.ConnectAccessToken&&!(apiClient&&apiClient.getCurrentUserId())){ensureConnectUser(credentials).always(onEnsureConnectUserDone);}else{onEnsureConnectUserDone();}
return deferred.promise();};self.isLoggedIntoConnect=function(){if(!self.connectToken()||!self.connectUserId()){return false;}
return true;};self.logout=function(){Logger.log('begin connectionManager loguot');var promises=[];for(var i=0,length=apiClients.length;i<length;i++){var apiClient=apiClients[i];if(apiClient.accessToken()){promises.push(logoutOfServer(apiClient));}}
return DeferredBuilder.when(promises).done(function(){var credentials=credentialProvider.credentials();var servers=credentials.Servers.filter(function(u){return u.UserLinkType!="Guest";});for(var j=0,numServers=servers.length;j<numServers;j++){var server=servers[j];server.UserId=null;server.AccessToken=null;server.ExchangeToken=null;var serverUsers=server.Users||[];for(var k=0,numUsers=serverUsers.length;k<numUsers;k++){serverUsers[k].IsSignedInOffline=false;}}
credentials.Servers=servers;credentials.ConnectAccessToken=null;credentials.ConnectUserId=null;credentialProvider.credentials(credentials);if(connectUser){connectUser=null;Events.trigger(self,'connectusersignedout');}});};function logoutOfServer(apiClient){var serverInfo=apiClient.serverInfo()||{};var logoutInfo={serverId:serverInfo.Id};return apiClient.logout().always(function(){Events.trigger(self,'localusersignedout',[logoutInfo]);});}
function getConnectServers(credentials){logger.log('Begin getConnectServers');var deferred=DeferredBuilder.Deferred();if(!credentials.ConnectAccessToken||!credentials.ConnectUserId){deferred.resolveWith(null,[[]]);return deferred.promise();}
var url="https://connect.mediabrowser.tv/service/servers?userId="+credentials.ConnectUserId;AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Application":appName+"/"+appVersion,"X-Connect-UserToken":credentials.ConnectAccessToken}}).done(function(servers){servers=servers.map(function(i){return{ExchangeToken:i.AccessKey,ConnectServerId:i.Id,Id:i.SystemId,Name:i.Name,RemoteAddress:i.Url,LocalAddress:i.LocalAddress,UserLinkType:(i.UserType||'').toLowerCase()=="guest"?"Guest":"LinkedUser"};});deferred.resolveWith(null,[servers]);}).fail(function(){deferred.resolveWith(null,[[]]);});return deferred.promise();}
self.getAvailableServers=function(){logger.log('Begin getAvailableServers');var credentials=credentialProvider.credentials();var deferred=DeferredBuilder.Deferred();var connectServersPromise=getConnectServers(credentials);var findServersPromise=findServers();connectServersPromise.done(function(connectServers){findServersPromise.done(function(foundServers){var servers=credentials.Servers.slice(0);mergeServers(servers,foundServers);mergeServers(servers,connectServers);servers=filterServers(servers,connectServers);servers.sort(function(a,b){return(b.DateLastAccessed||0)-(a.DateLastAccessed||0);});credentials.Servers=servers;credentialProvider.credentials(credentials);deferred.resolveWith(null,[servers]);});});return deferred.promise();};function filterServers(servers,connectServers){return servers.filter(function(server){if(!server.ExchangeToken){return true;}
return connectServers.filter(function(connectServer){return server.Id==connectServer.Id;}).length>0;});}
function findServers(){var deferred=DeferredBuilder.Deferred();require(['serverdiscovery'],function(){ServerDiscovery.findServers(2500).done(function(foundServers){var servers=foundServers.map(function(foundServer){var info={Id:foundServer.Id,LocalAddress:foundServer.Address,Name:foundServer.Name,ManualAddress:convertEndpointAddressToManualAddress(foundServer),DateLastLocalConnection:new Date().getTime()};info.LastConnectionMode=info.ManualAddress?MediaBrowser.ConnectionMode.Manual:MediaBrowser.ConnectionMode.Local;return info;});deferred.resolveWith(null,[servers]);});});return deferred.promise();}
function convertEndpointAddressToManualAddress(info){if(info.Address&&info.EndpointAddress){var address=info.EndpointAddress.split(":")[0];var parts=info.Address.split(":");if(parts.length>1){var portString=parts[parts.length-1];if(!isNaN(parseInt(portString))){address+=":"+portString;}}
return normalizeAddress(address);}
return null;}
self.connect=function(){logger.log('Begin connect');var deferred=DeferredBuilder.Deferred();self.getAvailableServers().done(function(servers){self.connectToServers(servers).done(function(result){deferred.resolveWith(null,[result]);});});return deferred.promise();};self.getOffineResult=function(){};self.connectToServers=function(servers){logger.log('Begin connectToServers, with '+servers.length+' servers');var deferred=DeferredBuilder.Deferred();if(servers.length==1){self.connectToServer(servers[0]).done(function(result){if(result.State==MediaBrowser.ConnectionState.Unavailable){result.State=result.ConnectUser==null?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection;}
logger.log('resolving connectToServers with result.State: '+result.State);deferred.resolveWith(null,[result]);});}else{var firstServer=servers.length?servers[0]:null;if(firstServer){self.connectToServer(firstServer).done(function(result){if(result.State==MediaBrowser.ConnectionState.SignedIn){deferred.resolveWith(null,[result]);}else{deferred.resolveWith(null,[{Servers:servers,State:(!servers.length&&!self.connectUser())?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection,ConnectUser:self.connectUser()}]);}});}else{deferred.resolveWith(null,[{Servers:servers,State:(!servers.length&&!self.connectUser())?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection,ConnectUser:self.connectUser()}]);}}
return deferred.promise();};function beginWakeServer(server){require(['wakeonlan'],function(){var infos=server.WakeOnLanInfos||[];for(var i=0,length=infos.length;i<length;i++){WakeOnLan.send(infos[i]);}});}
self.connectToServer=function(server,options){var deferred=DeferredBuilder.Deferred();var tests=[];if(server.LastConnectionMode!=null){tests.push(server.LastConnectionMode);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Manual)==-1){tests.push(MediaBrowser.ConnectionMode.Manual);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Local)==-1){tests.push(MediaBrowser.ConnectionMode.Local);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Remote)==-1){tests.push(MediaBrowser.ConnectionMode.Remote);}
beginWakeServer(server);var wakeOnLanSendTime=new Date().getTime();testNextConnectionMode(tests,0,server,wakeOnLanSendTime,options,deferred);return deferred.promise();};function stringEqualsIgnoreCase(str1,str2){return(str1||'').toLowerCase()==(str2||'').toLowerCase();}
function testNextConnectionMode(tests,index,server,wakeOnLanSendTime,options,deferred){if(index>=tests.length){logger.log('Tested all connection modes. Failing server connection.');resolveWithFailure(deferred);return;}
var mode=tests[index];var address=MediaBrowser.ServerInfo.getServerAddress(server,mode);var enableRetry=false;var skipTest=false;var timeout=defaultTimeout;if(mode==MediaBrowser.ConnectionMode.Local){enableRetry=true;timeout=5000;}
else if(mode==MediaBrowser.ConnectionMode.Manual){if(stringEqualsIgnoreCase(address,server.LocalAddress)||stringEqualsIgnoreCase(address,server.RemoteAddress)){skipTest=true;}}
if(skipTest||!address){testNextConnectionMode(tests,index+1,server,wakeOnLanSendTime,options,deferred);return;}
logger.log('testing connection mode '+mode+' with server '+server.Name);tryConnect(address,timeout).done(function(result){logger.log('calling onSuccessfulConnection with connection mode '+mode+' with server '+server.Name);onSuccessfulConnection(server,result,mode,options,deferred);}).fail(function(){logger.log('test failed for connection mode '+mode+' with server '+server.Name);if(enableRetry){var sleepTime=10000-(new Date().getTime()-wakeOnLanSendTime);testNextConnectionMode(tests,index+1,server,wakeOnLanSendTime,options,deferred);}else{testNextConnectionMode(tests,index+1,server,wakeOnLanSendTime,options,deferred);}});}
function onSuccessfulConnection(server,systemInfo,connectionMode,options,deferred){var credentials=credentialProvider.credentials();if(credentials.ConnectAccessToken){ensureConnectUser(credentials).done(function(){if(server.ExchangeToken){addAuthenticationInfoFromConnect(server,connectionMode,credentials).always(function(){afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);});}else{afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);}});}
else{afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);}}
function afterConnectValidated(server,credentials,systemInfo,connectionMode,verifyLocalAuthentication,options,deferred){if(verifyLocalAuthentication&&server.AccessToken){validateAuthentication(server,connectionMode).done(function(){afterConnectValidated(server,credentials,systemInfo,connectionMode,false,options,deferred);});return;}
updateServerInfo(server,systemInfo);server.DateLastAccessed=new Date().getTime();server.LastConnectionMode=connectionMode;credentialProvider.addOrUpdateServer(credentials.Servers,server);credentialProvider.credentials(credentials);var result={Servers:[]};result.ApiClient=getOrAddApiClient(server,connectionMode);result.State=server.AccessToken?MediaBrowser.ConnectionState.SignedIn:MediaBrowser.ConnectionState.ServerSignIn;result.Servers.push(server);result.ApiClient.updateServerInfo(server,connectionMode);if(result.State==MediaBrowser.ConnectionState.SignedIn){afterConnected(result.ApiClient,options);}
deferred.resolveWith(null,[result]);Events.trigger(self,'connected',[result]);}
function normalizeAddress(address){address=address.trim();if(address.toLowerCase().indexOf('http')!=0){address="http://"+address;}
address=address.replace('Http:','http:');address=address.replace('Https:','https:');return address;}
self.connectToAddress=function(address){var deferred=DeferredBuilder.Deferred();if(!address){deferred.reject();return deferred.promise();}
address=normalizeAddress(address);function onFail(){logger.log('connectToAddress '+address+' failed');resolveWithFailure(deferred);}
tryConnect(address,defaultTimeout).done(function(publicInfo){logger.log('connectToAddress '+address+' succeeded');var server={ManualAddress:address,LastConnectionMode:MediaBrowser.ConnectionMode.Manual};updateServerInfo(server,publicInfo);self.connectToServer(server).done(function(result){deferred.resolveWith(null,[result]);}).fail(onFail);}).fail(onFail);return deferred.promise();};self.loginToConnect=function(username,password){var deferred=DeferredBuilder.Deferred();if(!username){deferred.reject();return deferred.promise();}
if(!password){deferred.reject();return deferred.promise();}
require(['connectservice'],function(){var md5=self.getConnectPasswordHash(password);AjaxApi.ajax({type:"POST",url:"https://connect.mediabrowser.tv/service/user/authenticate",data:{nameOrEmail:username,password:md5},dataType:"json",contentType:'application/x-www-form-urlencoded; charset=UTF-8',headers:{"X-Application":appName+"/"+appVersion}}).done(function(result){var credentials=credentialProvider.credentials();credentials.ConnectAccessToken=result.AccessToken;credentials.ConnectUserId=result.User.Id;credentialProvider.credentials(credentials);onConnectUserSignIn(result.User);deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});});return deferred.promise();};self.signupForConnect=function(email,username,password,passwordConfirm){var deferred=DeferredBuilder.Deferred();if(!email){deferred.rejectWith(null,[{errorCode:'invalidinput'}]);return deferred.promise();}
if(!username){deferred.rejectWith(null,[{errorCode:'invalidinput'}]);return deferred.promise();}
if(!password){deferred.rejectWith(null,[{errorCode:'invalidinput'}]);return deferred.promise();}
if(!passwordConfirm){deferred.rejectWith(null,[{errorCode:'passwordmatch'}]);return deferred.promise();}
if(password!=passwordConfirm){deferred.rejectWith(null,[{errorCode:'passwordmatch'}]);return deferred.promise();}
require(['connectservice'],function(){var md5=self.getConnectPasswordHash(password);AjaxApi.ajax({type:"POST",url:"https://connect.mediabrowser.tv/service/register",data:{email:email,userName:username,password:md5},dataType:"json",contentType:'application/x-www-form-urlencoded; charset=UTF-8',headers:{"X-Application":appName+"/"+appVersion,"X-CONNECT-TOKEN":"CONNECT-REGISTER"}}).done(function(result){deferred.resolve(null,[]);}).fail(function(e){try{var result=JSON.parse(e.responseText);deferred.rejectWith(null,[{errorCode:result.Status}]);}catch(err){deferred.rejectWith(null,[{}]);}});});return deferred.promise();};self.getConnectPasswordHash=function(password){password=globalScope.MediaBrowser.ConnectService.cleanPassword(password);return CryptoJS.MD5(password).toString();};self.getApiClient=function(item){if(item.ServerId){item=item.ServerId;}
return apiClients.filter(function(a){var serverInfo=a.serverInfo();return!serverInfo||serverInfo.Id==item;})[0];};self.getUserInvitations=function(){var connectToken=self.connectToken();if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/servers?userId="+self.connectUserId()+"&status=Waiting";return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};self.deleteServer=function(serverId){var credentials=credentialProvider.credentials();var serverInfo=credentials.Servers=credentials.Servers.filter(function(s){return s.ConnectServerId==serverId;});function onDone(){credentials=credentialProvider.credentials();credentials.Servers=credentials.Servers.filter(function(s){return s.ConnectServerId!=serverId;});credentialProvider.credentials(credentials);}
if(serverInfo.ExchangeToken){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/serverAuthorizations?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"DELETE",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}}).done(onDone);}else{onDone();var deferred=DeferredBuilder.Deferred();deferred.resolve();return deferred.promise();}};self.rejectServer=function(serverId){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/serverAuthorizations?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"DELETE",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};self.acceptServer=function(serverId){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/ServerAuthorizations/accept?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"GET",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};self.getRegistrationInfo=function(feature,apiClient){var deferred=DeferredBuilder.Deferred();self.getAvailableServers().done(function(servers){var matchedServers=servers.filter(function(s){return stringEqualsIgnoreCase(s.Id,apiClient.serverInfo().Id);});if(!matchedServers.length){deferred.resolveWith(null,[{}]);return;}
var match=matchedServers[0];if((new Date().getTime()-(match.DateLastLocalConnection||0))>2678400000){deferred.resolveWith(null,[{}]);return;}
apiClient.getRegistrationInfo(feature).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});}).fail(function(){deferred.reject();});return deferred.promise();};return self;};})(window,window.Logger);var SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g;var hiddenPre=document.createElement("pre");function htmlDecode(value){if(!value){return'';}
hiddenPre.innerHTML=value.replace(/</g,"&lt;");return hiddenPre.textContent;}
function htmlEncode(value){return value.replace(/&/g,'&amp;').replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return'&#'+(((hi-0xD800)*0x400)+(low-0xDC00)+0x10000)+';';}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return'&#'+value.charCodeAt(0)+';';}).replace(/</g,'&lt;').replace(/>/g,'&gt;');}
Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest);};$.fn.checked=function(value){if(value===true||value===false){return $(this).each(function(){this.checked=value;});}else{return $(this).is(':checked');}};$.fn.buttonEnabled=function(enabled){return enabled?this.attr('disabled','').removeAttr('disabled'):this.attr('disabled','disabled');};if(!Array.prototype.filter){Array.prototype.filter=function(fun){"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!="function")
throw new TypeError();var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisp,val,i,t))
res.push(val);}}
return res;};}
var WebNotifications={show:function(data){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.notification){if(!WebNotifications.lastId){WebNotifications.lastId=new Date().getDate()+new Date().getMilliseconds();}
WebNotifications.lastId++;window.cordova.plugins.notification.local.schedule({id:WebNotifications.lastId,title:data.title,text:data.body,icon:data.icon});}
else if(window.Notification){var level=Notification.permissionLevel?Notification.permissionLevel():Notification.permission;if(level==="granted"){var notif=new Notification(data.title,data);if(notif.show){notif.show();}
if(data.timeout){setTimeout(function(){if(notif.close){notif.close();}
else if(notif.cancel){notif.cancel();}},data.timeout);}
return notif;}else if(level==="default"){Notification.requestPermission(function(){return WebNotifications.show(data);});}}
else if(window.webkitNotifications){if(!webkitNotifications.checkPermission()){var notif=webkitNotifications.createNotification(data.icon,data.title,data.body);notif.show();if(data.timeout){setTimeout(function(){if(notif.close){notif.close();}
else if(notif.cancel){notif.cancel();}},data.timeout);}
return notif;}else{webkitNotifications.requestPermission(function(){return WebNotifications.show(data);});}}},requestPermission:function(){if(window.webkitNotifications){if(!webkitNotifications.checkPermission()){}else{webkitNotifications.requestPermission(function(){});}}
else if(window.Notification){var level=Notification.permissionLevel?Notification.permissionLevel():Notification.permission;if(level==="default"){Notification.requestPermission(function(){});}}}};function humane_date(date_str){var time_formats=[[90,'a minute'],[3600,'minutes',60],[5400,'an hour'],[86400,'hours',3600],[129600,'a day'],[604800,'days',86400],[907200,'a week'],[2628000,'weeks',604800],[3942000,'a month'],[31536000,'months',2628000],[47304000,'a year'],[3153600000,'years',31536000]];var dt=new Date;var date=parseISO8601Date(date_str,{toLocal:true});var seconds=((dt-date)/1000);var token=' ago';var i=0;var format;if(seconds<0){seconds=Math.abs(seconds);token='';}
while(format=time_formats[i++]){if(seconds<format[0]){if(format.length==2){return format[1]+token;}else{return Math.round(seconds/format[2])+' '+format[1]+token;}}}
if(seconds>4730400000)
return Math.round(seconds/4730400000)+' centuries'+token;return date_str;};function humane_elapsed(firstDateStr,secondDateStr){var dt1=new Date(firstDateStr);var dt2=new Date(secondDateStr);var seconds=(dt2.getTime()-dt1.getTime())/1000;var numdays=Math.floor((seconds%31536000)/86400);var numhours=Math.floor(((seconds%31536000)%86400)/3600);var numminutes=Math.floor((((seconds%31536000)%86400)%3600)/60);var numseconds=Math.round((((seconds%31536000)%86400)%3600)%60);var elapsedStr='';elapsedStr+=numdays==1?numdays+' day ':'';elapsedStr+=numdays>1?numdays+' days ':'';elapsedStr+=numhours==1?numhours+' hour ':'';elapsedStr+=numhours>1?numhours+' hours ':'';elapsedStr+=numminutes==1?numminutes+' minute ':'';elapsedStr+=numminutes>1?numminutes+' minutes ':'';elapsedStr+=elapsedStr.length>0?'and ':'';elapsedStr+=numseconds==1?numseconds+' second':'';elapsedStr+=numseconds==0||numseconds>1?numseconds+' seconds':'';return elapsedStr;}
function getWindowUrl(win){return(win||window).location.href;}
function getWindowLocationSearch(win){var search=(win||window).location.search;if(!search){var index=window.location.href.indexOf('?');if(index!=-1){search=window.location.href.substring(index);}}
return search||'';}
function getParameterByName(name,url){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS,"i");var results=regex.exec(url||getWindowLocationSearch());if(results==null)
return"";else
return decodeURIComponent(results[1].replace(/\+/g," "));}
function replaceQueryString(url,param,value){var re=new RegExp("([?|&])"+param+"=.*?(&|$)","i");if(url.match(re))
return url.replace(re,'$1'+param+"="+value+'$2');else if(value){if(url.indexOf('?')==-1){return url+'?'+param+"="+value;}
return url+'&'+param+"="+value;}
return url;}
function parseISO8601Date(s,options){options=options||{};var re=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?(Z|([+-])(\d{2}):(\d{2}))?/;var d=s.match(re);if(!d){throw"Couldn't parse ISO 8601 date string '"+s+"'";}
var a=[1,2,3,4,5,6,10,11];for(var i in a){d[a[i]]=parseInt(d[a[i]],10);}
d[7]=parseFloat(d[7]);var ms=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]);if(d[7]>0){ms+=Math.round(d[7]*1000);}
if(d[8]!="Z"&&d[10]){var offset=d[10]*60*60*1000;if(d[11]){offset+=d[11]*60*1000;}
if(d[9]=="-"){ms-=offset;}else{ms+=offset;}}else if(!options.toLocal){ms+=new Date().getTimezoneOffset()*60000;}
return new Date(ms);}
(function($,window,undefined){function queryStringToObject(qstr){var result={},nvPairs=((qstr||"").replace(/^\?/,"").split(/&/)),i,pair,n,v;for(i=0;i<nvPairs.length;i++){var pstr=nvPairs[i];if(pstr){pair=pstr.split(/=/);n=pair[0];v=pair[1];if(result[n]===undefined){result[n]=v;}else{if(typeof result[n]!=="object"){result[n]=[result[n]];}
result[n].push(v);}}}
return result;}
$(document).bind("pagebeforechange",function(e,data){if(typeof data.toPage==="string"){var u=$.mobile.path.parseUrl(data.toPage);if($.mobile.path.isEmbeddedPage(u)){var u2=$.mobile.path.parseUrl(u.hash.replace(/^#/,""));if(u2.search){if(!data.options.dataUrl){data.options.dataUrl=data.toPage;}
data.options.pageData=queryStringToObject(u2.search);data.toPage=u.hrefNoHash+"#"+u2.pathname;}}}});})(jQuery,window);function ticks_to_human(str){var in_seconds=(str/10000000);var hours=Math.floor(in_seconds/3600);var minutes=Math.floor((in_seconds-(hours*3600))/60);var seconds='0'+Math.round(in_seconds-(hours*3600)-(minutes*60));var time='';if(hours>0)time+=hours+":";if(minutes<10&&hours==0)time+=minutes;else time+=('0'+minutes).substr(-2);time+=":"+seconds.substr(-2);return time;};(function(window){window.Globalize={translate:function(key){var val=window.localizationGlossary[key]||key;for(var i=1;i<arguments.length;i++){val=val.replace('{'+(i-1)+'}',arguments[i]);}
return val;}};})(window);(function(){var supportTouch=$.support.touch,scrollEvent="touchmove scroll",touchStartEvent=supportTouch?"touchstart":"mousedown",touchStopEvent=supportTouch?"touchend":"mouseup",touchMoveEvent=supportTouch?"touchmove":"mousemove";$.event.special.swipeupdown={setup:function(){var thisObject=this;var $this=$(thisObject);$this.bind(touchStartEvent,function(event){var data=event.originalEvent.touches?event.originalEvent.touches[0]:event,start={time:(new Date).getTime(),coords:[data.pageX,data.pageY],origin:$(event.target)},stop;function moveHandler(event){if(!start){return;}
var data=event.originalEvent.touches?event.originalEvent.touches[0]:event;stop={time:(new Date).getTime(),coords:[data.pageX,data.pageY]};if(Math.abs(start.coords[1]-stop.coords[1])>10){event.preventDefault();}}
$this.bind(touchMoveEvent,moveHandler).one(touchStopEvent,function(event){$this.unbind(touchMoveEvent,moveHandler);if(start&&stop){if(stop.time-start.time<1000&&Math.abs(start.coords[1]-stop.coords[1])>100&&Math.abs(start.coords[0]-stop.coords[0])<75){start.origin.trigger("swipeupdown").trigger(start.coords[1]>stop.coords[1]?"swipeup":"swipedown");}}
start=stop=undefined;});});}};$.each({swipedown:"swipeupdown",swipeup:"swipeupdown"},function(event,sourceEvent){$.event.special[event]={setup:function(){$(this).bind(sourceEvent,$.noop);}};});})();$.fn.visible=function(visible){if(visible){return this.removeClass('hide');}
return this.addClass('hide');};(function(){$.ajaxSetup({crossDomain:true});if($.browser.msie){$.ajaxSetup({cache:false});}})();$.support.cors=true;$(document).one('click',WebNotifications.requestPermission);var Dashboard={jQueryMobileInit:function(){$.mobile.popup.prototype.options.transition="none";if($.browser.mobile){$.mobile.defaultPageTransition="none";}else{$.mobile.defaultPageTransition="none";}
$.mobile.panel.prototype.options.classes.modalOpen="largePanelModalOpen ui-panel-dismiss-open";$.mobile.panel.prototype.options.classes.panel="largePanel ui-panel";$.event.special.swipe.verticalDistanceThreshold=40;$.mobile.loader.prototype.options.disabled=true;$.mobile.page.prototype.options.domCache=true;$.mobile.loadingMessage=false;$.mobile.loader.prototype.options.html="";$.mobile.loader.prototype.options.textVisible=false;$.mobile.loader.prototype.options.textOnly=true;$.mobile.loader.prototype.options.text="";$.mobile.hideUrlBar=false;$.mobile.autoInitializePage=false;$.mobile.changePage.defaults.showLoadMsg=false;$.mobile.nojs=null;$.mobile.degradeInputsWithin=null;$.mobile.keepNative=":jqmData(role='none')";},isConnectMode:function(){if(AppInfo.isNativeApp){return true;}
var url=getWindowUrl().toLowerCase();return url.indexOf('mediabrowser.tv')!=-1||url.indexOf('emby.media')!=-1;},isRunningInCordova:function(){return window.appMode=='cordova';},onRequestFail:function(e,data){if(data.status==401){var url=data.url.toLowerCase();if(url.indexOf('/password')==-1&&url.indexOf('/authenticate')==-1&&!$($.mobile.activePage).is('.standalonePage')){if(data.errorCode=="ParentalControl"){Dashboard.alert({message:Globalize.translate('MessageLoggedOutParentalControl'),callback:function(){Dashboard.logout(false);}});}else{Dashboard.logout(false);}}
return;}
Dashboard.hideLoadingMsg();if(!Dashboard.suppressAjaxErrors&&data.type!='GET'&&!AppInfo.isNativeApp){setTimeout(function(){var msg=data.errorCode||Dashboard.defaultErrorMessage;Dashboard.showError(msg);},500);}},getCurrentUser:function(){if(!Dashboard.getUserPromise){Dashboard.getUserPromise=window.ApiClient.getCurrentUser().fail(Dashboard.logout);}
return Dashboard.getUserPromise;},validateCurrentUser:function(){Dashboard.getUserPromise=null;if(Dashboard.getCurrentUserId()){Dashboard.getCurrentUser();}},serverAddress:function(){if(Dashboard.isConnectMode()){var apiClient=window.ApiClient;if(apiClient){return apiClient.serverAddress();}
return null;}
var urlLower=getWindowUrl().toLowerCase();var index=urlLower.indexOf('/web');if(index==-1){index=urlLower.indexOf('/dashboard');}
if(index!=-1){return urlLower.substring(0,index);}
var loc=window.location;var address=loc.protocol+'//'+loc.hostname;if(loc.port){address+=':'+loc.port;}
return address;},getCurrentUserId:function(){var apiClient=window.ApiClient;if(apiClient){return apiClient.getCurrentUserId();}
return null;},onServerChanged:function(userId,accessToken,apiClient){apiClient=apiClient||window.ApiClient;window.ApiClient=apiClient;Dashboard.getUserPromise=null;},logout:function(logoutWithServer){function onLogoutDone(){var loginPage;if(Dashboard.isConnectMode()){loginPage='connectlogin.html';window.ApiClient=null;}else{loginPage='login.html';}
Dashboard.navigate(loginPage);}
if(logoutWithServer===false){onLogoutDone();}else{ConnectionManager.logout().done(onLogoutDone);}},importCss:function(url){if(!Dashboard.importedCss){Dashboard.importedCss=[];}
if(Dashboard.importedCss.indexOf(url)!=-1){return;}
Dashboard.importedCss.push(url);if(document.createStyleSheet){document.createStyleSheet(url);}
else{$('<link rel="stylesheet" type="text/css" href="'+url+'" />').appendTo('head');}},showError:function(message){Dashboard.alert(message);},updateSystemInfo:function(info){Dashboard.lastSystemInfo=info;Dashboard.ensureWebSocket();if(!Dashboard.initialServerVersion){Dashboard.initialServerVersion=info.Version;}
if(info.HasPendingRestart){Dashboard.hideDashboardVersionWarning();Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showServerRestartWarning(info);}});}else{Dashboard.hideServerRestartWarning();if(Dashboard.initialServerVersion!=info.Version){Dashboard.showDashboardRefreshNotification();}}
Dashboard.showInProgressInstallations(info.InProgressInstallations);},showInProgressInstallations:function(installations){installations=installations||[];for(var i=0,length=installations.length;i<length;i++){var installation=installations[i];var percent=installation.PercentComplete||0;if(percent<100){Dashboard.showPackageInstallNotification(installation,"progress");}}
if(installations.length){Dashboard.ensureInstallRefreshInterval();}else{Dashboard.stopInstallRefreshInterval();}},ensureInstallRefreshInterval:function(){if(!Dashboard.installRefreshInterval){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SystemInfoStart","0,500");}
Dashboard.installRefreshInterval=1;}},stopInstallRefreshInterval:function(){if(Dashboard.installRefreshInterval){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SystemInfoStop");}
Dashboard.installRefreshInterval=null;}},cancelInstallation:function(id){ApiClient.cancelPackageInstallation(id).always(Dashboard.refreshSystemInfoFromServer);},showServerRestartWarning:function(systemInfo){var html='<span style="margin-right: 1em;">'+Globalize.translate('MessagePleaseRestart')+'</span>';if(systemInfo.CanSelfRestart){html+='<button type="button" data-icon="refresh" onclick="this.disabled=\'disabled\';Dashboard.restartServer();" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonRestart')+'</button>';}
Dashboard.showFooterNotification({id:"serverRestartWarning",html:html,forceShow:true,allowHide:false});},hideServerRestartWarning:function(){var elem=document.getElementById('serverRestartWarning');if(elem){elem.parentNode.removeChild(elem);}},showDashboardRefreshNotification:function(){var html='<span style="margin-right: 1em;">'+Globalize.translate('MessagePleaseRefreshPage')+'</span>';html+='<button type="button" data-icon="refresh" onclick="this.disabled=\'disabled\';Dashboard.reloadPage();" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonRefresh')+'</button>';Dashboard.showFooterNotification({id:"dashboardVersionWarning",html:html,forceShow:true,allowHide:false});},reloadPage:function(){var currentUrl=getWindowUrl().toLowerCase();var newUrl;if(currentUrl.indexOf('configurationpage')!=-1){newUrl="dashboard.html";}else{newUrl=getWindowUrl();}
window.location.href=newUrl;},hideDashboardVersionWarning:function(){var elem=document.getElementById('dashboardVersionWarning');if(elem){elem.parentNode.removeChild(elem);}},showFooterNotification:function(options){if(!AppInfo.enableFooterNotifications){return;}
var removeOnHide=!options.id;options.id=options.id||"notification"+new Date().getTime()+parseInt(Math.random());var footer=$(".footer").css("top","initial").show();var parentElem=$('#footerNotifications',footer);var elem=$('#'+options.id,parentElem);if(!elem.length){elem=$('<p id="'+options.id+'" class="footerNotification"></p>').appendTo(parentElem);}
var onclick=removeOnHide?"$(\"#"+options.id+"\").trigger(\"notification.remove\").remove();":"$(\"#"+options.id+"\").trigger(\"notification.hide\").hide();";if(options.allowHide!==false){options.html+="<span style='margin-left: 1em;'><button type='button' onclick='"+onclick+"' data-icon='delete' data-iconpos='notext' data-mini='true' data-inline='true' data-theme='b'>"+Globalize.translate('ButtonHide')+"</button></span>";}
if(options.forceShow){elem.slideDown(400);}
elem.html(options.html).trigger('create');if(options.timeout){setTimeout(function(){if(removeOnHide){elem.trigger("notification.remove").remove();}else{elem.trigger("notification.hide").hide();}},options.timeout);}
footer.on("notification.remove notification.hide",function(e){setTimeout(function(){if(!parentElem.html()){footer.slideUp();}},50);});},getConfigurationPageUrl:function(name){return"ConfigurationPage?name="+encodeURIComponent(name);},navigate:function(url,preserveQueryString,transition){if(!url){throw new Error('url cannot be null or empty');}
var queryString=getWindowLocationSearch();if(preserveQueryString&&queryString){url+=queryString;}
var options={};if(transition){options.transition=transition;}
$.mobile.changePage(url,options);},showLoadingMsg:function(){require(['paperbuttonstyle'],function(){var elem=document.getElementById('docspinner');if(elem){if(!elem.active){elem.active=true;}}else{elem=document.createElement("paper-spinner");elem.id='docspinner';document.body.appendChild(elem);elem.active=true;}});},hideLoadingMsg:function(){var elem=document.getElementById('docspinner');if(elem){setTimeout(function(){elem.active=false;},100);}},getModalLoadingMsg:function(){var elem=$('.modalLoading');if(!elem.length){elem=$('<div class="modalLoading" style="display:none;"></div>').appendTo(document.body);}
return elem;},showModalLoadingMsg:function(){Dashboard.showLoadingMsg();Dashboard.getModalLoadingMsg().show();},hideModalLoadingMsg:function(){Dashboard.getModalLoadingMsg().hide();Dashboard.hideLoadingMsg();},processPluginConfigurationUpdateResult:function(){Dashboard.hideLoadingMsg();Dashboard.alert("Settings saved.");},defaultErrorMessage:Globalize.translate('DefaultErrorMessage'),processServerConfigurationUpdateResult:function(result){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('MessageSettingsSaved'));},alert:function(options){if(typeof options=="string"){require(['paperbuttonstyle'],function(){var message=options;Dashboard.toastId=Dashboard.toastId||0;var id='toast'+(Dashboard.toastId++);var elem=document.createElement("paper-toast");elem.setAttribute('text',message);elem.id=id;document.body.appendChild(elem);setTimeout(function(){elem.show();setTimeout(function(){elem.parentNode.removeChild(elem);},5000);},300);});return;}
if(navigator.notification&&navigator.notification.alert&&options.message.indexOf('<')==-1){navigator.notification.alert(options.message,options.callback||function(){},options.title||Globalize.translate('HeaderAlert'));}else{Dashboard.confirmInternal(options.message,options.title||Globalize.translate('HeaderAlert'),false,options.callback);}},confirm:function(message,title,callback){if(navigator.notification&&navigator.notification.confirm&&message.indexOf('<')==-1){var buttonLabels=[Globalize.translate('ButtonOk'),Globalize.translate('ButtonCancel')];navigator.notification.confirm(message,function(index){callback(index==1);},title||Globalize.translate('HeaderAlert'),buttonLabels.join(','));}else{Dashboard.confirmInternal(message,title,true,callback);}},confirmInternal:function(message,title,showCancel,callback){require(['paperbuttonstyle'],function(){var id='paperdlg'+new Date().getTime();var html='<paper-dialog id="'+id+'" role="alertdialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop>';html+='<h2>'+title+'</h2>';html+='<div>'+message+'</div>';html+='<div class="buttons">';if(showCancel){html+='<paper-button dialog-dismiss>'+Globalize.translate('ButtonCancel')+'</paper-button>';}
html+='<paper-button class="btnConfirm" dialog-confirm autofocus>'+Globalize.translate('ButtonOk')+'</paper-button>';html+='</div>';html+='</paper-dialog>';$(document.body).append(html);document.body.classList.add('bodyWithPopupOpen');setTimeout(function(){var dlg=document.getElementById(id);$(dlg).on('iron-overlay-closed',function(e){var confirmed=this.closingReason.confirmed;this.parentNode.removeChild(this);document.body.classList.remove('bodyWithPopupOpen');callback(confirmed);});dlg.open();},300);});},refreshSystemInfoFromServer:function(){var apiClient=ApiClient;if(apiClient&&apiClient.accessToken()){if(apiClient.enableFooterNotifications){apiClient.getSystemInfo().done(function(info){Dashboard.updateSystemInfo(info);});}else{Dashboard.ensureWebSocket();}}},restartServer:function(){Dashboard.suppressAjaxErrors=true;Dashboard.showLoadingMsg();ApiClient.restartServer().done(function(){setTimeout(function(){Dashboard.reloadPageWhenServerAvailable();},250);}).fail(function(){Dashboard.suppressAjaxErrors=false;});},reloadPageWhenServerAvailable:function(retryCount){ApiClient.getJSON(ApiClient.getUrl("System/Info")).done(function(info){if(!info.HasPendingRestart){Dashboard.reloadPage();}else{Dashboard.retryReload(retryCount);}}).fail(function(){Dashboard.retryReload(retryCount);});},retryReload:function(retryCount){setTimeout(function(){retryCount=retryCount||0;retryCount++;if(retryCount<10){Dashboard.reloadPageWhenServerAvailable(retryCount);}else{Dashboard.suppressAjaxErrors=false;}},500);},showUserFlyout:function(){var html='<div data-role="panel" data-position="right" data-display="overlay" id="userFlyout" data-position-fixed="true" data-theme="a">';html+='<h3 class="userHeader">';html+='</h3>';html+='<form>';html+='<p class="preferencesContainer"></p>';html+='<p><button data-mini="true" type="button" onclick="Dashboard.logout();" data-icon="lock">'+Globalize.translate('ButtonSignOut')+'</button></p>';html+='</form>';html+='</div>';$(document.body).append(html);var elem=$('#userFlyout').panel({}).lazyChildren().trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});ConnectionManager.user(window.ApiClient).done(function(user){Dashboard.updateUserFlyout(elem,user);});require(['jqmicons']);},updateUserFlyout:function(elem,user){var html='';var imgWidth=48;if(user.imageUrl&&AppInfo.enableUserImage){var url=user.imageUrl;if(user.supportsImageParams){url+="&width="+(imgWidth*Math.max(window.devicePixelRatio||1,2));}
html+='<div style="background-image:url(\''+url+'\');width:'+imgWidth+'px;height:'+imgWidth+'px;background-size:contain;background-repeat:no-repeat;background-position:center center;border-radius:1000px;vertical-align:middle;margin-right:.8em;display:inline-block;"></div>';}
html+=user.name;$('.userHeader',elem).html(html).lazyChildren();html='';if(user.localUser&&user.localUser.Policy.EnableUserPreferenceAccess){html+='<p><a data-mini="true" data-role="button" href="mypreferencesdisplay.html?userId='+user.localUser.Id+'" data-icon="gear">'+Globalize.translate('ButtonSettings')+'</button></a>';}
$('.preferencesContainer',elem).html(html).trigger('create');},getPluginSecurityInfo:function(){var apiClient=ApiClient;if(!apiClient){var deferred=$.Deferred();deferred.reject();return deferred.promise();}
if(!Dashboard.getPluginSecurityInfoPromise){var deferred=$.Deferred();apiClient.ajax({type:"GET",url:apiClient.getUrl("Plugins/SecurityInfo"),dataType:'json',error:function(){}}).done(function(result){deferred.resolveWith(null,[result]);});Dashboard.getPluginSecurityInfoPromise=deferred;}
return Dashboard.getPluginSecurityInfoPromise;},resetPluginSecurityInfo:function(){Dashboard.getPluginSecurityInfoPromise=null;},ensureHeader:function(page){if(page.classList.contains('standalonePage')&&!page.classList.contains('noHeaderPage')){Dashboard.renderHeader(page);}},renderHeader:function(page){var header=page.querySelector('.header');if(!header){var headerHtml='';headerHtml+='<div class="header">';headerHtml+='<a class="logo" href="index.html" style="text-decoration:none;font-size: 22px;">';if(page.classList.contains('standalonePage')){headerHtml+='<img class="imgLogoIcon" src="css/images/mblogoicon.png" />';headerHtml+='<span class="logoLibraryMenuButtonText">EMBY</span>';}
headerHtml+='</a>';headerHtml+='</div>';$(page).prepend(headerHtml);}},getToolsMenuHtml:function(page){var items=Dashboard.getToolsMenuLinks(page);var i,length,item;var menuHtml='';for(i=0,length=items.length;i<length;i++){item=items[i];if(item.divider){menuHtml+="<div class='sidebarDivider'></div>";}
if(item.href){var style=item.color?' style="color:'+item.color+'"':'';if(item.selected){menuHtml+='<a class="sidebarLink selectedSidebarLink" href="'+item.href+'">';}else{menuHtml+='<a class="sidebarLink" href="'+item.href+'">';}
var icon=item.icon;if(icon){menuHtml+='<iron-icon icon="'+icon+'" class="sidebarLinkIcon"'+style+'></iron-icon>';}
menuHtml+='<span class="sidebarLinkText">';menuHtml+=item.name;menuHtml+='</span>';menuHtml+='</a>';}else{menuHtml+='<div class="sidebarHeader">';menuHtml+=item.name;menuHtml+='</div>';}}
return menuHtml;},ensureToolsMenu:function(page){var sidebar=page.querySelector('.toolsSidebar');if(!sidebar){var html='<div class="content-secondary toolsSidebar">';html+='<div class="sidebarLinks">';html+=Dashboard.getToolsMenuHtml(page);html+='</div>';html+='</div>';$('.content-primary',page).before(html);Events.trigger(page,'create');}},getToolsMenuLinks:function(page){var pageElem=page;var isServicesPage=page.classList.contains('appServicesPage');var context=getParameterByName('context');return[{name:Globalize.translate('TabServer'),href:"dashboard.html",selected:page.classList.contains("dashboardHomePage"),icon:'dashboard',color:'#38c'},{name:Globalize.translate('TabDevices'),href:"devices.html",selected:page.classList.contains("devicesPage"),icon:'tablet',color:'#ECA403'},{name:Globalize.translate('TabUsers'),href:"userprofiles.html",selected:page.classList.contains("userProfilesPage"),icon:'people',color:'#679C34'},{name:Globalize.translate('TabLibrary'),divider:true,href:"library.html",selected:page.classList.contains("mediaLibraryPage"),icon:'video-library'},{name:Globalize.translate('TabMetadata'),href:"metadata.html",selected:page.classList.contains('metadataConfigurationPage'),icon:'insert-drive-file'},{name:Globalize.translate('TabPlayback'),href:"playbackconfiguration.html",selected:page.classList.contains('playbackConfigurationPage'),icon:'play-circle-filled'},{name:Globalize.translate('TabSync'),href:"syncactivity.html",selected:page.classList.contains('syncConfigurationPage')||(isServicesPage&&context=='sync'),icon:'refresh'},{divider:true,name:Globalize.translate('TabExtras')},{name:Globalize.translate('TabAutoOrganize'),href:"autoorganizelog.html",selected:page.classList.contains("organizePage"),icon:'folder',color:'#01C0DD'},{name:Globalize.translate('TabDLNA'),href:"dlnasettings.html",selected:page.classList.contains("dlnaPage"),icon:'tv',color:'#E5342E'},{name:Globalize.translate('TabLiveTV'),href:"livetvstatus.html",selected:page.classList.contains("liveTvSettingsPage")||(isServicesPage&&context=='livetv'),icon:'live-tv',color:'#293AAE'},{name:Globalize.translate('TabNotifications'),href:"notificationsettings.html",selected:page.classList.contains("notificationConfigurationPage"),icon:'notifications',color:'brown'},{name:Globalize.translate('TabPlugins'),href:"plugins.html",selected:page.classList.contains("pluginConfigurationPage"),icon:'add-shopping-cart',color:'#9D22B1'},{divider:true,name:Globalize.translate('TabExpert')},{name:Globalize.translate('TabAdvanced'),href:"advanced.html",selected:page.classList.contains("advancedConfigurationPage"),icon:'settings',color:'#F16834'},{name:Globalize.translate('TabScheduledTasks'),href:"scheduledtasks.html",selected:page.classList.contains("scheduledTasksConfigurationPage"),icon:'schedule',color:'#38c'},{name:Globalize.translate('TabHelp'),divider:true,href:"support.html",selected:pageElem.id=="supportPage"||pageElem.id=="logPage"||pageElem.id=="supporterPage"||pageElem.id=="supporterKeyPage"||pageElem.id=="aboutPage",icon:'help',color:'#679C34'}];},ensureWebSocket:function(){if(ApiClient.isWebSocketOpenOrConnecting()||!ApiClient.isWebSocketSupported()){return;}
ApiClient.openWebSocket();if(!Dashboard.isConnectMode()){ApiClient.reportCapabilities(Dashboard.capabilities());}},processGeneralCommand:function(cmd){switch(cmd.Name){case'GoHome':Dashboard.navigate('index.html');break;case'GoToSettings':Dashboard.navigate('dashboard.html');break;case'DisplayContent':Dashboard.onBrowseCommand(cmd.Arguments);break;case'GoToSearch':Search.showSearchPanel($.mobile.activePage);break;case'DisplayMessage':{var args=cmd.Arguments;if(args.TimeoutMs){Dashboard.showFooterNotification({html:"<div><b>"+args.Header+"</b></div>"+args.Text,timeout:args.TimeoutMs});}
else{Dashboard.alert({title:args.Header,message:args.Text});}
break;}
case'VolumeUp':case'VolumeDown':case'Mute':case'Unmute':case'ToggleMute':case'SetVolume':case'SetAudioStreamIndex':case'SetSubtitleStreamIndex':case'ToggleFullscreen':break;default:Logger.log('Unrecognized command: '+cmd.Name);break;}},onWebSocketMessageReceived:function(e,data){var msg=data;if(msg.MessageType==="LibraryChanged"){Dashboard.processLibraryUpdateNotification(msg.Data);}
else if(msg.MessageType==="ServerShuttingDown"){Dashboard.hideServerRestartWarning();}
else if(msg.MessageType==="ServerRestarting"){Dashboard.hideServerRestartWarning();}
else if(msg.MessageType==="UserDeleted"){Dashboard.validateCurrentUser();}
else if(msg.MessageType==="SystemInfo"){Dashboard.updateSystemInfo(msg.Data);}
else if(msg.MessageType==="RestartRequired"){Dashboard.updateSystemInfo(msg.Data);}
else if(msg.MessageType==="UserUpdated"||msg.MessageType==="UserConfigurationUpdated"){var user=msg.Data;if(user.Id==Dashboard.getCurrentUserId()){Dashboard.validateCurrentUser();$('.currentUsername').html(user.Name);}}
else if(msg.MessageType==="PackageInstallationCompleted"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"completed");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="PackageInstallationFailed"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"failed");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="PackageInstallationCancelled"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"cancelled");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessaapiclientcgeType==="PackageInstalling"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"progress");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="GeneralCommand"){var cmd=msg.Data;}},onBrowseCommand:function(cmd){var url;var type=(cmd.ItemType||"").toLowerCase();if(type=="genre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="musicgenre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="gamegenre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="studio"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="person"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="musicartist"){url="itembynamedetails.html?id="+cmd.ItemId;}
if(url){Dashboard.navigate(url);return;}
ApiClient.getItem(Dashboard.getCurrentUserId(),cmd.ItemId).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,null,''));});},showPackageInstallNotification:function(installation,status){var html='';if(status=='completed'){html+='<img src="css/images/notifications/done.png" class="notificationIcon" />';}
else if(status=='cancelled'){html+='<img src="css/images/notifications/info.png" class="notificationIcon" />';}
else if(status=='failed'){html+='<img src="css/images/notifications/error.png" class="notificationIcon" />';}
else if(status=='progress'){html+='<img src="css/images/notifications/download.png" class="notificationIcon" />';}
html+='<span style="margin-right: 1em;">';if(status=='completed'){html+=Globalize.translate('LabelPackageInstallCompleted').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='cancelled'){html+=Globalize.translate('LabelPackageInstallCancelled').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='failed'){html+=Globalize.translate('LabelPackageInstallFailed').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='progress'){html+=Globalize.translate('LabelInstallingPackage').replace('{0}',installation.Name+' '+installation.Version);}
html+='</span>';if(status=='progress'){var percentComplete=Math.round(installation.PercentComplete||0);html+='<progress style="margin-right: 1em;" max="100" value="'+percentComplete+'" title="'+percentComplete+'%">';html+=''+percentComplete+'%';html+='</progress>';if(percentComplete<100){var btnId="btnCancel"+installation.Id;html+='<button id="'+btnId+'" type="button" data-icon="delete" onclick="$(\''+btnId+'\').buttonEnabled(false);Dashboard.cancelInstallation(\''+installation.Id+'\');" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonCancel')+'</button>';}}
var timeout=0;if(status=='cancelled'){timeout=2000;}
var forceShow=status!="progress";var allowHide=status!="progress"&&status!='cancelled';Dashboard.showFooterNotification({html:html,id:installation.Id,timeout:timeout,forceShow:forceShow,allowHide:allowHide});},processLibraryUpdateNotification:function(data){var newItems=data.ItemsAdded;if(!newItems.length){return;}
ApiClient.getItems(Dashboard.getCurrentUserId(),{Recursive:true,Limit:3,Filters:"IsNotFolder",SortBy:"DateCreated",SortOrder:"Descending",ImageTypes:"Primary",Ids:newItems.join(',')}).done(function(result){var items=result.Items;for(var i=0,length=Math.min(items.length,2);i<length;i++){var item=items[i];var notification={title:"New "+item.Type,body:item.Name,timeout:5000};var imageTags=item.ImageTags||{};if(imageTags.Primary){notification.icon=ApiClient.getScaledImageUrl(item.Id,{width:60,tag:imageTags.Primary,type:"Primary"});}
WebNotifications.show(notification);}});},ensurePageTitle:function(page){if(!page.classList.contains('type-interior')){return;}
var pageElem=page;if(pageElem.querySelector('.pageTitle')){return;}
var parent=pageElem.querySelector('.content-primary');if(!parent){parent=pageElem.getElementsByClassName('ui-content')[0];}
var helpUrl=pageElem.getAttribute('data-helpurl');var html='<div>';html+='<h1 class="pageTitle" style="display:inline-block;">'+(document.title||'&nbsp;')+'</h1>';if(helpUrl){html+='<a href="'+helpUrl+'" target="_blank" class="clearLink" style="margin-top:-10px;display:inline-block;vertical-align:middle;margin-left:1em;"><paper-button raised class="secondary mini"><i class="fa fa-info-circle"></i>'+Globalize.translate('ButtonHelp')+'</paper-button></a>';}
html+='</div>';$(parent).prepend(html);if(helpUrl){require(['paperbuttonstyle']);}},setPageTitle:function(title){var elem=$($.mobile.activePage)[0].querySelector('.pageTitle');if(elem){elem.innerHTML=title;}
if(title){document.title=title;}},getDisplayTime:function(ticks){var ticksPerHour=36000000000;var ticksPerMinute=600000000;var ticksPerSecond=10000000;var parts=[];var hours=ticks/ticksPerHour;hours=Math.floor(hours);if(hours){parts.push(hours);}
ticks-=(hours*ticksPerHour);var minutes=ticks/ticksPerMinute;minutes=Math.floor(minutes);ticks-=(minutes*ticksPerMinute);if(minutes<10&&hours){minutes='0'+minutes;}
parts.push(minutes);var seconds=ticks/ticksPerSecond;seconds=Math.floor(seconds);if(seconds<10){seconds='0'+seconds;}
parts.push(seconds);return parts.join(':');},populateLanguages:function(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>";}
$(select).html(html).selectmenu("refresh");},populateCountries:function(select,allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>";}
$(select).html(html).selectmenu("refresh");},getSupportedRemoteCommands:function(){return["GoHome","GoToSettings","VolumeUp","VolumeDown","Mute","Unmute","ToggleMute","SetVolume","SetAudioStreamIndex","SetSubtitleStreamIndex","DisplayContent","GoToSearch","DisplayMessage"];},isServerlessPage:function(){var url=getWindowUrl().toLowerCase();return url.indexOf('connectlogin.html')!=-1||url.indexOf('selectserver.html')!=-1||url.indexOf('login.html')!=-1||url.indexOf('forgotpassword.html')!=-1||url.indexOf('forgotpasswordpin.html')!=-1;},capabilities:function(){var caps={PlayableMediaTypes:['Audio','Video'],SupportedCommands:Dashboard.getSupportedRemoteCommands(),SupportsPersistentIdentifier:Dashboard.isRunningInCordova(),SupportsMediaControl:true,SupportedLiveMediaTypes:['Audio','Video']};if(Dashboard.isRunningInCordova()&&$.browser.android){caps.SupportsOfflineAccess=true;caps.SupportsSync=true;caps.SupportsContentUploading=true;}
return caps;},getDefaultImageQuality:function(imageType){var quality=90;var isBackdrop=imageType.toLowerCase()=='backdrop';if(isBackdrop){quality-=10;}
if(AppInfo.hasLowImageBandwidth){if(AppInfo.isNativeApp){quality-=15;if(isBackdrop){quality-=20;}}else{quality-=40;}}
return quality;},normalizeImageOptions:function(options){if(AppInfo.hasLowImageBandwidth){options.enableImageEnhancers=false;}
if(AppInfo.forcedImageFormat&&options.type!='Logo'){options.format=AppInfo.forcedImageFormat;options.backgroundColor='#1c1c1c';}},getAppInfo:function(appName,deviceId,deviceName){function generateDeviceName(){var name="Web Browser";if($.browser.chrome){name="Chrome";}else if($.browser.safari){name="Safari";}else if($.browser.msie){name="Internet Explorer";}else if($.browser.opera){name="Opera";}else if($.browser.mozilla){name="Firefox";}
if($.browser.version){name+=" "+$.browser.version;}
if($.browser.ipad){name+=" Ipad";}else if($.browser.iphone){name+=" Iphone";}else if($.browser.android){name+=" Android";}
return name;}
var appVersion=window.dashboardVersion;appName=appName||"Emby Web Client";deviceName=deviceName||generateDeviceName();var seed=[];var keyName='randomId';deviceId=deviceId||MediaBrowser.generateDeviceId(keyName,seed.join(','));return{appName:appName,appVersion:appVersion,deviceName:deviceName,deviceId:deviceId};},loadSwipebox:function(){var deferred=DeferredBuilder.Deferred();Dashboard.importCss('thirdparty/swipebox-master/css/swipebox.min.css');require(['thirdparty/swipebox-master/js/jquery.swipebox.min'],function(){deferred.resolve();});return deferred.promise();},ready:function(fn){if(Dashboard.initPromiseDone){fn();return;}
Dashboard.initPromise.done(fn);},firePageEvent:function(page,name,dependencies){Dashboard.ready(function(){if(dependencies&&dependencies.length){require(dependencies,function(){Events.trigger(page,name);});}else{Events.trigger(page,name);}});},loadExternalPlayer:function(){var deferred=DeferredBuilder.Deferred();require(['scripts/externalplayer.js'],function(){if(Dashboard.isRunningInCordova()){require(['cordova/externalplayer.js'],function(){deferred.resolve();});}else{deferred.resolve();}});return deferred.promise();},exitOnBack:function(){return $($.mobile.activePage).is('#indexPage');},exit:function(){Dashboard.logout();}};var AppInfo={};(function(){function isTouchDevice(){return(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));}
function setAppInfo(){if(isTouchDevice()){AppInfo.isTouchPreferred=true;}
var isCordova=Dashboard.isRunningInCordova();AppInfo.enableDetailPageChapters=true;AppInfo.enableDetailsMenuImages=true;AppInfo.enableMovieHomeSuggestions=true;AppInfo.enableAppStorePolicy=isCordova;var isIOS=$.browser.safari||$.browser.ipad||$.browser.iphone;var isAndroid=$.browser.android;var isMobile=$.browser.mobile;if(isIOS){if(isMobile){AppInfo.hasLowImageBandwidth=true;}
if(isCordova){AppInfo.enableBottomTabs=true;AppInfo.cardMargin='mediumCardMargin';}else{if(isMobile){AppInfo.enableDetailPageChapters=false;AppInfo.enableDetailsMenuImages=false;AppInfo.enableMovieHomeSuggestions=false;AppInfo.cardMargin='largeCardMargin';AppInfo.forcedImageFormat='jpg';}}}
if(!AppInfo.hasLowImageBandwidth){AppInfo.enableStudioTabs=true;AppInfo.enablePeopleTabs=true;AppInfo.enableTvEpisodesTab=true;AppInfo.enableMovieTrailersTab=true;}
if(isCordova){AppInfo.enableAppLayouts=true;AppInfo.hasKnownExternalPlayerSupport=true;AppInfo.isNativeApp=true;}
else{AppInfo.enableFooterNotifications=true;AppInfo.enableSupporterMembership=true;if(!isAndroid&&!isIOS){AppInfo.enableAppLayouts=true;}}
if(!$.browser.tv&&!isIOS){if(AppInfo.isNativeApp||window.navigator.standalone||!$.browser.mobile){AppInfo.enableHeadRoom=true;}}
AppInfo.enableUserImage=true;AppInfo.hasPhysicalVolumeButtons=isCordova||isMobile;AppInfo.enableBackButton=isIOS&&(window.navigator.standalone||AppInfo.isNativeApp);AppInfo.supportsFullScreen=isCordova&&isAndroid;AppInfo.supportsSyncPathSetting=isCordova&&isAndroid;if(isCordova&&isAndroid){AppInfo.directPlayAudioContainers=['aac','mp3','ogg','flac','wma','m4a','oga'];}else{AppInfo.directPlayAudioContainers=[];}}
function initializeApiClient(apiClient){apiClient.enableAppStorePolicy=AppInfo.enableAppStorePolicy;apiClient.getDefaultImageQuality=Dashboard.getDefaultImageQuality;apiClient.normalizeImageOptions=Dashboard.normalizeImageOptions;$(apiClient).off("websocketmessage",Dashboard.onWebSocketMessageReceived).off('requestfail',Dashboard.onRequestFail);$(apiClient).on("websocketmessage",Dashboard.onWebSocketMessageReceived).on('requestfail',Dashboard.onRequestFail);}
function createConnectionManager(capabilities){var credentialKey=Dashboard.isConnectMode()?null:'servercredentials4';var credentialProvider=new MediaBrowser.CredentialProvider(credentialKey);window.ConnectionManager=new MediaBrowser.ConnectionManager(Logger,credentialProvider,AppInfo.appName,AppInfo.appVersion,AppInfo.deviceName,AppInfo.deviceId,capabilities);if(getWindowUrl().toLowerCase().indexOf('wizardstart.html')!=-1){window.ConnectionManager.clearData();}
$(ConnectionManager).on('apiclientcreated',function(e,newApiClient){initializeApiClient(newApiClient);});var deferred=DeferredBuilder.Deferred();if(Dashboard.isConnectMode()){var server=ConnectionManager.getLastUsedServer();if(!Dashboard.isServerlessPage()){if(server&&server.UserId&&server.AccessToken){ConnectionManager.connectToServer(server).done(function(result){if(result.State==MediaBrowser.ConnectionState.SignedIn){window.ApiClient=result.ApiClient;}
deferred.resolve();});return deferred.promise();}}
deferred.resolve();}else{var apiClient=new MediaBrowser.ApiClient(Logger,Dashboard.serverAddress(),AppInfo.appName,AppInfo.appVersion,AppInfo.deviceName,AppInfo.deviceId);apiClient.enableAutomaticNetworking=false;ConnectionManager.addApiClient(apiClient);Dashboard.importCss(apiClient.getUrl('Branding/Css'));window.ApiClient=apiClient;}
return deferred.promise();}
function initFastClick(){require(["thirdparty/fastclick"],function(FastClick){FastClick.attach(document.body);$(document.body).on('touchstart','.ui-panel-dismiss',function(){$(this).trigger('click');});});}
function setDocumentClasses(){var elem=document.documentElement;if(AppInfo.enableBottomTabs){elem.classList.add('bottomSecondaryNav');}
if(AppInfo.isTouchPreferred){elem.classList.add('touch');}else{elem.classList.add('pointerInput');}
if(AppInfo.cardMargin){elem.classList.add(AppInfo.cardMargin);}
if(!AppInfo.enableStudioTabs){elem.classList.add('studioTabDisabled');}
if(!AppInfo.enablePeopleTabs){elem.classList.add('peopleTabDisabled');}
if(!AppInfo.enableTvEpisodesTab){elem.classList.add('tvEpisodesTabDisabled');}
if(!AppInfo.enableMovieTrailersTab){elem.classList.add('movieTrailersTabDisabled');}
if(!AppInfo.enableSupporterMembership){elem.classList.add('supporterMembershipDisabled');}
if(AppInfo.isNativeApp){elem.classList.add('nativeApp');}}
function onDocumentReady(){if(AppInfo.isNativeApp){if($.browser.android){Dashboard.importCss('themes/android.css');}
else if($.browser.safari){Dashboard.importCss('themes/ios.css');}}
if($.browser.safari&&$.browser.mobile){initFastClick();}
var footerHtml='<div id="footer" class="footer" data-theme="b" class="ui-bar-b">';footerHtml+='<div id="footerNotifications"></div>';footerHtml+='</div>';$(document.body).append(footerHtml);$(window).on("beforeunload",function(){var apiClient=window.ApiClient;if(apiClient&&apiClient.isWebSocketOpen()){var localActivePlayers=MediaController.getPlayers().filter(function(p){return p.isLocalPlayer&&p.isPlaying();});if(!localActivePlayers.length){Logger.log('Sending close web socket command');apiClient.closeWebSocket();}}});$(document).on('contextmenu','.ui-popup-screen',function(e){$('.ui-popup').popup('close');e.preventDefault();return false;});require(['filesystem']);if(Dashboard.isRunningInCordova()){require(['cordova/connectsdk','scripts/registrationservices','cordova/back']);if($.browser.android){require(['cordova/android/androidcredentials','cordova/android/immersive','cordova/android/mediasession']);}else{require(['cordova/volume']);}
if($.browser.safari){require(['cordova/remotecontrols','cordova/ios/orientation']);}}else{if($.browser.chrome){require(['scripts/chromecast']);}}
if(navigator.splashscreen){navigator.splashscreen.hide();}}
function init(deferred,capabilities,appName,deviceId,deviceName){requirejs.config({urlArgs:"v="+window.dashboardVersion,paths:{"velocity":"bower_components/velocity/velocity.min"}});define('jquery',[],function(){return jQuery;});if(Dashboard.isRunningInCordova()&&$.browser.android){define("appstorage",["cordova/android/appstorage"]);}else{define('appstorage',[],function(){return appStorage;});}
if(Dashboard.isRunningInCordova()){define("serverdiscovery",["cordova/serverdiscovery"]);define("wakeonlan",["cordova/wakeonlan"]);}else{define("serverdiscovery",["apiclient/serverdiscovery"]);define("wakeonlan",["apiclient/wakeonlan"]);}
if(Dashboard.isRunningInCordova()&&$.browser.android){define("localassetmanager",["cordova/android/localassetmanager"]);}else{define("localassetmanager",["apiclient/localassetmanager"]);}
if(Dashboard.isRunningInCordova()&&$.browser.android){define("filesystem",["cordova/android/filesystem"]);}
else if(Dashboard.isRunningInCordova()){define("filesystem",["cordova/filesystem"]);}
else{define("filesystem",["thirdparty/filesystem"]);}
if(Dashboard.isRunningInCordova()&&$.browser.android){define("nativedirectorychooser",["cordova/android/nativedirectorychooser"]);}
if(Dashboard.isRunningInCordova()&&$.browser.android){define("audiorenderer",["cordova/android/vlcplayer"]);define("videorenderer",["scripts/htmlmediarenderer"]);}
else{define("audiorenderer",["scripts/htmlmediarenderer"]);define("videorenderer",["scripts/htmlmediarenderer"]);}
define("connectservice",["apiclient/connectservice"]);define("paperbuttonstyle",[],function(){Dashboard.importCss('thirdparty/paper-button-style.css');return{};});define("jqmicons",[],function(){Dashboard.importCss('thirdparty/jquerymobile-1.4.5/jquery.mobile.custom.icons.css');return{};});define("livetvcss",[],function(){Dashboard.importCss('css/livetv.css');return{};});define("detailtablecss",[],function(){Dashboard.importCss('css/detailtable.css');return{};});define("tileitemcss",[],function(){Dashboard.importCss('css/tileitem.css');return{};});if(Dashboard.isRunningInCordova()&&$.browser.safari){define("actionsheet",["cordova/ios/actionsheet"]);}else{define("actionsheet",["scripts/actionsheet"]);}
$.extend(AppInfo,Dashboard.getAppInfo(appName,deviceId,deviceName));$(document).on('WebComponentsReady',function(){var drawer=document.querySelector('.mainDrawerPanel');drawer.classList.remove('mainDrawerPanelPreInit');drawer.forceNarrow=true;drawer.drawerWidth=screen.availWidth>=330?"310px":"270px";if($.browser.safari&&!AppInfo.isNativeApp){drawer.disableEdgeSwipe=true;}
if(Dashboard.isConnectMode()){require(['appstorage'],function(){capabilities.DeviceProfile=MediaPlayer.getDeviceProfile(Math.max(screen.height,screen.width));createConnectionManager(capabilities).done(function(){$(function(){onDocumentReady();Dashboard.initPromiseDone=true;$.mobile.initializePage();deferred.resolve();});});});}else{createConnectionManager(capabilities);$(function(){onDocumentReady();Dashboard.initPromiseDone=true;$.mobile.initializePage();deferred.resolve();});}});}
function initCordovaWithDeviceId(deferred,deviceId){require(['cordova/imagestore']);var capablities=Dashboard.capabilities();init(deferred,capablities,"Emby Mobile",deviceId,device.model);}
function initCordova(deferred){document.addEventListener("deviceready",function(){window.plugins.uniqueDeviceID.get(function(uuid){initCordovaWithDeviceId(deferred,uuid);},function(){initCordovaWithDeviceId(deferred,device.uuid);});},false);}
var initDeferred=$.Deferred();Dashboard.initPromise=initDeferred.promise();setAppInfo();setDocumentClasses();if(Dashboard.isRunningInCordova()){initCordova(initDeferred);}else{init(initDeferred,Dashboard.capabilities());}})();Dashboard.jQueryMobileInit();$(document).on('pagecreate',".page",function(){var page=$(this);var current=page.data('theme');if(!current){var newTheme;if(page.hasClass('libraryPage')){newTheme='b';}else{newTheme='a';}
current=page.page("option","theme");if(current&&current!=newTheme){page.page("option","theme",newTheme);}
current=newTheme;}
if(current=='b'&&!$.browser.mobile){document.body.classList.add('darkScrollbars');}else{document.body.classList.remove('darkScrollbars');}}).on('pageinit',".page",function(){var page=this;var dependencies=this.getAttribute('data-require');dependencies=dependencies?dependencies.split(','):null;Dashboard.firePageEvent(page,'pageinitdepends',dependencies);}).on('pagebeforeshow',".page",function(){var page=this;var dependencies=this.getAttribute('data-require');Dashboard.ensurePageTitle(page);dependencies=dependencies?dependencies.split(','):null;Dashboard.firePageEvent(page,'pagebeforeshowready',dependencies);}).on('pageshow',".page",function(){var page=this;var dependencies=this.getAttribute('data-require');dependencies=dependencies?dependencies.split(','):null;Dashboard.firePageEvent(page,'pageshowbeginready',dependencies);}).on('pageshowbeginready',".page",function(){var page=this;var apiClient=window.ApiClient;if(apiClient&&apiClient.accessToken()&&Dashboard.getCurrentUserId()){var isSettingsPage=page.classList.contains('type-interior');if(isSettingsPage){Dashboard.ensureToolsMenu(page);Dashboard.getCurrentUser().done(function(user){if(!user.Policy.IsAdministrator){Dashboard.logout();return;}});}}
else{var isConnectMode=Dashboard.isConnectMode();if(isConnectMode){if(!Dashboard.isServerlessPage()){Dashboard.logout();return;}}
if(!isConnectMode&&this.id!=="loginPage"&&!page.classList.contains('forgotPasswordPage')&&!page.classList.contains('wizardPage')){Logger.log('Not logged into server. Redirecting to login.');Dashboard.logout();return;}}
Dashboard.firePageEvent(page,'pageshowready');Dashboard.ensureHeader(page);if(apiClient&&!apiClient.isWebSocketOpen()){Dashboard.refreshSystemInfoFromServer();}
if(!page.classList.contains('libraryPage')){require(['jqmicons']);}});var LibraryBrowser=(function(window,document,$,screen){var pageSizeKey='pagesize_v4';return{getDefaultPageSize:function(key,defaultValue){var saved=appStorage.getItem(key||pageSizeKey);if(saved){return parseInt(saved);}
if(defaultValue){return defaultValue;}
var isChrome=$.browser.chrome;return isChrome?200:100;},getDefaultItemsView:function(view,mobileView){return $.browser.mobile?mobileView:view;},loadSavedQueryValues:function(key,query){var values=appStorage.getItem(key+'_'+Dashboard.getCurrentUserId());if(values){values=JSON.parse(values);return $.extend(query,values);}
return query;},saveQueryValues:function(key,query){var values={};if(query.SortBy){values.SortBy=query.SortBy;}
if(query.SortOrder){values.SortOrder=query.SortOrder;}
try{appStorage.setItem(key+'_'+Dashboard.getCurrentUserId(),JSON.stringify(values));}catch(e){}},saveViewSetting:function(key,value){try{appStorage.setItem(key+'_'+Dashboard.getCurrentUserId()+'_view',value);}catch(e){}},getSavedViewSetting:function(key){var deferred=$.Deferred();var val=appStorage.getItem(key+'_'+Dashboard.getCurrentUserId()+'_view');deferred.resolveWith(null,[val]);return deferred.promise();},getDateParamValue:function(date){function formatDigit(i){return i<10?"0"+i:i;}
var d=date;return""+d.getFullYear()+formatDigit(d.getMonth()+1)+formatDigit(d.getDate())+formatDigit(d.getHours())+formatDigit(d.getMinutes())+formatDigit(d.getSeconds());},playAllFromHere:function(fn,index){fn(index,100,"MediaSources,Chapters").done(function(result){MediaController.play({items:result.Items});});},queueAllFromHere:function(query,index){fn(index,100,"MediaSources,Chapters").done(function(result){MediaController.queue({items:result.Items});});},getItemCountsHtml:function(options,item){var counts=[];var childText;if(item.Type=='Playlist'){childText='';if(item.CumulativeRunTimeTicks){var minutes=item.CumulativeRunTimeTicks/600000000;minutes=minutes||1;childText+=Globalize.translate('ValueMinutes',Math.round(minutes));}else{childText+=Globalize.translate('ValueMinutes',0);}
counts.push(childText);}
else if(options.context=="movies"){if(item.MovieCount){childText=item.MovieCount==1?Globalize.translate('ValueOneMovie'):Globalize.translate('ValueMovieCount',item.MovieCount);counts.push(childText);}
if(item.TrailerCount){childText=item.TrailerCount==1?Globalize.translate('ValueOneTrailer'):Globalize.translate('ValueTrailerCount',item.TrailerCount);counts.push(childText);}}else if(options.context=="tv"){if(item.SeriesCount){childText=item.SeriesCount==1?Globalize.translate('ValueOneSeries'):Globalize.translate('ValueSeriesCount',item.SeriesCount);counts.push(childText);}
if(item.EpisodeCount){childText=item.EpisodeCount==1?Globalize.translate('ValueOneEpisode'):Globalize.translate('ValueEpisodeCount',item.EpisodeCount);counts.push(childText);}}else if(options.context=="games"){if(item.GameCount){childText=item.GameCount==1?Globalize.translate('ValueOneGame'):Globalize.translate('ValueGameCount',item.GameCount);counts.push(childText);}}else if(options.context=="music"){if(item.AlbumCount){childText=item.AlbumCount==1?Globalize.translate('ValueOneAlbum'):Globalize.translate('ValueAlbumCount',item.AlbumCount);counts.push(childText);}
if(item.SongCount){childText=item.SongCount==1?Globalize.translate('ValueOneSong'):Globalize.translate('ValueSongCount',item.SongCount);counts.push(childText);}
if(item.MusicVideoCount){childText=item.MusicVideoCount==1?Globalize.translate('ValueOneMusicVideo'):Globalize.translate('ValueMusicVideoCount',item.MusicVideoCount);counts.push(childText);}}
return counts.join('  ');},getArtistLinksHtml:function(artists,cssClass){var html=[];for(var i=0,length=artists.length;i<length;i++){var artist=artists[i];var css=cssClass?(' class="'+cssClass+'"'):'';html.push('<a'+css+' href="itembynamedetails.html?context=music&id='+artist.Id+'">'+artist.Name+'</a>');}
html=html.join(' / ');return html;},playInExternalPlayer:function(id){Dashboard.loadExternalPlayer().done(function(){ExternalPlayer.showMenu(id);});},showPlayMenu:function(positionTo,itemId,itemType,isFolder,mediaType,resumePositionTicks){var externalPlayers=AppSettings.enableExternalPlayers();if(!resumePositionTicks&&mediaType!="Audio"&&!isFolder){if(!externalPlayers||mediaType!="Video"){MediaController.play(itemId);return;}}
var menuItems=[];if(resumePositionTicks){menuItems.push({name:Globalize.translate('ButtonResume'),id:'resume',ironIcon:'play-arrow'});}
menuItems.push({name:Globalize.translate('ButtonPlay'),id:'play',ironIcon:'play-arrow'});if(!isFolder&&externalPlayers&&mediaType!="Audio"){menuItems.push({name:Globalize.translate('ButtonPlayExternalPlayer'),id:'externalplayer',ironIcon:'airplay'});}
if(MediaController.canQueueMediaType(mediaType,itemType)){menuItems.push({name:Globalize.translate('ButtonQueue'),id:'queue',ironIcon:'playlist-add'});}
if(itemType=="Audio"||itemType=="MusicAlbum"||itemType=="MusicArtist"||itemType=="MusicGenre"){menuItems.push({name:Globalize.translate('ButtonInstantMix'),id:'instantmix',ironIcon:'shuffle'});}
if(isFolder||itemType=="MusicArtist"||itemType=="MusicGenre"){menuItems.push({name:Globalize.translate('ButtonShuffle'),id:'shuffle',ironIcon:'shuffle'});}
require(['actionsheet'],function(){ActionSheetElement.show({items:menuItems,positionTo:positionTo,callback:function(id){switch(id){case'play':MediaController.play(itemId);break;case'externalplayer':LibraryBrowser.playInExternalPlayer(itemId);break;case'resume':MediaController.play({ids:[itemId],startPositionTicks:resumePositionTicks});break;case'queue':MediaController.queue(itemId);break;case'instantmix':MediaController.instantMix(itemId);break;case'shuffle':MediaController.shuffle(itemId);break;default:break;}}});});},getMoreCommands:function(item,user){var commands=[];if(BoxSetEditor.supportsAddingToCollection(item)){commands.push('addtocollection');}
if(PlaylistManager.supportsPlaylists(item)){commands.push('playlist');}
if(item.Type=='BoxSet'||item.Type=='Playlist'){commands.push('delete');}
else if(item.CanDelete){commands.push('delete');}
if(user.Policy.IsAdministrator){if(item.Type!="Recording"&&item.Type!="Program"){commands.push('edit');}}
commands.push('refresh');if(SyncManager.isAvailable(item,user)){commands.push('sync');}
if(item.CanDownload){commands.push('download');}
return commands;},refreshItem:function(itemId){ApiClient.refreshItem(itemId,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllImages:false,ReplaceAllMetadata:true});Dashboard.alert(Globalize.translate('MessageRefreshQueued'));},deleteItem:function(itemId){setTimeout(function(){var msg=Globalize.translate('ConfirmDeleteItem');Dashboard.confirm(msg,Globalize.translate('HeaderDeleteItem'),function(result){if(result){ApiClient.deleteItem(itemId);Events.trigger(LibraryBrowser,'itemdeleting',[itemId]);}});},250);},showMoreCommands:function(positionTo,itemId,commands){var items=[];if(commands.indexOf('addtocollection')!=-1){items.push({name:Globalize.translate('ButtonAddToCollection'),id:'addtocollection',ironIcon:'add'});}
if(commands.indexOf('playlist')!=-1){items.push({name:Globalize.translate('ButtonAddToPlaylist'),id:'playlist',ironIcon:'playlist-add'});}
if(commands.indexOf('delete')!=-1){items.push({name:Globalize.translate('ButtonDelete'),id:'delete',ironIcon:'delete'});}
if(commands.indexOf('download')!=-1){items.push({name:Globalize.translate('ButtonDownload'),id:'download',ironIcon:'file-download'});}
if(commands.indexOf('edit')!=-1){items.push({name:Globalize.translate('ButtonEdit'),id:'edit',ironIcon:'mode-edit'});}
if(commands.indexOf('refresh')!=-1){items.push({name:Globalize.translate('ButtonRefresh'),id:'refresh',ironIcon:'refresh'});}
require(['actionsheet'],function(){ActionSheetElement.show({items:items,positionTo:positionTo,callback:function(id){switch(id){case'addtocollection':BoxSetEditor.showPanel([itemId]);break;case'playlist':PlaylistManager.showPanel([itemId]);break;case'delete':LibraryBrowser.deleteItem(itemId);break;case'download':{var downloadHref=ApiClient.getUrl("Items/"+itemId+"/Download",{api_key:ApiClient.accessToken()});window.location.href=downloadHref;break;}
case'edit':Dashboard.navigate('edititemmetadata.html?id='+itemId);break;case'refresh':ApiClient.refreshItem(itemId,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllImages:false,ReplaceAllMetadata:true});break;default:break;}}});});},getHref:function(item,context,topParentId){var href=LibraryBrowser.getHrefInternal(item,context);if(context){href+=href.indexOf('?')==-1?"?context=":"&context=";href+=context;}
if(topParentId==null&&context!='playlists'){topParentId=LibraryMenu.getTopParentId();}
if(topParentId){href+=href.indexOf('?')==-1?"?topParentId=":"&topParentId=";href+=topParentId;}
return href;},getHrefInternal:function(item,context){if(!item){throw new Error('item cannot be null');}
if(item.url){return item.url;}
var id=item.Id||item.ItemId;if(item.CollectionType=='livetv'){return'livetvsuggested.html#liveTvSuggestedPage';}
if(item.CollectionType=='channels'){if(AppInfo.enableLatestChannelItems){return'channelslatest.html';}else{return'channels.html';}}
if(context!='folders'){if(item.CollectionType=='movies'){return'moviesrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='boxsets'){return'collections.html?topParentId='+item.Id;}
if(item.CollectionType=='tvshows'){return'tvrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='music'){return'musicrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='games'){return'gamesrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='playlists'){return'playlists.html?topParentId='+item.Id;}
if(item.CollectionType=='photos'){return'photos.html?topParentId='+item.Id;}}
if(item.Type=='CollectionFolder'){return'itemlist.html?topParentId='+item.Id+'&parentid='+item.Id;}
if(item.Type=="PhotoAlbum"&&context=='photos'){return"photos.html?parentId="+id;}
if(item.Type=="Playlist"){return"playlistedit.html?id="+id;}
if(item.Type=="TvChannel"){return"livetvchannel.html?id="+id;}
if(item.Type=="Channel"){return"channelitems.html?id="+id;}
if(item.Type=="ChannelFolderItem"){return"channelitems.html?id="+item.ChannelId+'&folderId='+item.Id;}
if(item.Type=="Program"){return"livetvprogram.html?id="+id;}
if(item.Type=="Series"){return"itemdetails.html?id="+id;}
if(item.Type=="Season"){return"itemdetails.html?id="+id;}
if(item.Type=="BoxSet"){return"itemdetails.html?id="+id;}
if(item.Type=="MusicAlbum"){return"itemdetails.html?id="+id;}
if(item.Type=="GameSystem"){return"itemdetails.html?id="+id;}
if(item.Type=="Genre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="MusicGenre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="GameGenre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Studio"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Person"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Recording"){return"livetvrecording.html?id="+id;}
if(item.Type=="MusicArtist"){return"itembynamedetails.html?id="+id;}
if(item.IsFolder){return id?"itemlist.html?parentId="+id:"#";}
return"itemdetails.html?id="+id;},getImageUrl:function(item,type,index,options){options=options||{};options.type=type;options.index=index;if(type=='Backdrop'){options.tag=item.BackdropImageTags[index];}else if(type=='Screenshot'){options.tag=item.ScreenshotImageTags[index];}else if(type=='Primary'){options.tag=item.PrimaryImageTag||item.ImageTags[type];}else{options.tag=item.ImageTags[type];}
return ApiClient.getScaledImageUrl(item.Id||item.ItemId,options);},getListViewIndex:function(item,options){if(options.index=='disc'){return item.ParentIndexNumber==null?'':Globalize.translate('ValueDiscNumber',item.ParentIndexNumber);}
var sortBy=(options.sortBy||'').toLowerCase();var code,name;if(sortBy.indexOf('sortname')==0){if(item.Type=='Episode')return'';name=(item.SortName||item.Name||'?')[0].toUpperCase();code=name.charCodeAt(0);if(code<65||code>90){return'#';}
return name.toUpperCase();}
if(sortBy.indexOf('officialrating')==0){return item.OfficialRating||Globalize.translate('HeaderUnrated');}
if(sortBy.indexOf('communityrating')==0){if(item.CommunityRating==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.CommunityRating);}
if(sortBy.indexOf('criticrating')==0){if(item.CriticRating==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.CriticRating);}
if(sortBy.indexOf('metascore')==0){if(item.Metascore==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.Metascore);}
if(sortBy.indexOf('albumartist')==0){if(!item.AlbumArtist)return'';name=item.AlbumArtist[0].toUpperCase();code=name.charCodeAt(0);if(code<65||code>90){return'#';}
return name.toUpperCase();}
return'';},getUserDataCssClass:function(key){if(!key)return'';return'libraryItemUserData'+key.replace(new RegExp(' ','g'),'');},getListViewHtml:function(options){var outerHtml="";outerHtml+='<ul data-role="listview" class="itemsListview">';if(options.title){outerHtml+='<li data-role="list-divider">';outerHtml+=options.title;outerHtml+='</li>';}
var index=0;var groupTitle='';outerHtml+=options.items.map(function(item){var html='';if(options.showIndex!==false){var itemGroupTitle=LibraryBrowser.getListViewIndex(item,options);if(itemGroupTitle!=groupTitle){html+='<li data-role="list-divider">';html+=itemGroupTitle;html+='</li>';groupTitle=itemGroupTitle;}}
var dataAttributes=LibraryBrowser.getItemDataAttributes(item,options,index);var cssClass=options.smallIcon?'ui-li-has-icon listItem':'ui-li-has-thumb listItem';if(item.UserData){cssClass+=' '+LibraryBrowser.getUserDataCssClass(item.UserData.Key);}
var href=LibraryBrowser.getHref(item,options.context);html+='<li class="'+cssClass+'"'+dataAttributes+' data-itemid="'+item.Id+'" data-playlistitemid="'+(item.PlaylistItemId||'')+'" data-href="'+href+'" data-icon="false">';var defaultAction=options.defaultAction;if(defaultAction=='play'||defaultAction=='playallfromhere'){if(item.PlayAccess!='Full'){defaultAction=null;}}
var defaultActionAttribute=defaultAction?(' data-action="'+defaultAction+'" class="itemWithAction mediaItem"'):' class="mediaItem"';html+='<a'+defaultActionAttribute+' href="'+href+'">';var imgUrl;var downloadWidth=options.smallIcon?70:80;var minScale=item.Type=='Episode'||item.Type=='Game'||options.smallIcon?2:1.5;if(item.ImageTags.Primary){imgUrl=ApiClient.getScaledImageUrl(item.Id,{width:downloadWidth,tag:item.ImageTags.Primary,type:"Primary",index:0,minScale:minScale});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",width:downloadWidth,tag:item.AlbumPrimaryImageTag,minScale:minScale});}
else if(item.AlbumId&&item.SeriesPrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Primary",width:downloadWidth,tag:item.SeriesPrimaryImageTag,minScale:minScale});}
else if(item.ParentPrimaryImageTag){imgUrl=ApiClient.getImageUrl(item.ParentPrimaryImageItemId,{type:"Primary",width:downloadWidth,tag:item.ParentPrimaryImageTag,minScale:minScale});}
if(imgUrl){var minLazyIndex=16;if(options.smallIcon){if(index<minLazyIndex){html+='<div class="listviewIcon ui-li-icon" style="background-image:url(\''+imgUrl+'\');"></div>';}else{html+='<div class="listviewIcon ui-li-icon lazy" data-src="'+imgUrl+'"></div>';}}else{if(index<minLazyIndex){html+='<div class="listviewImage ui-li-thumb" style="background-image:url(\''+imgUrl+'\');"></div>';}else{html+='<div class="listviewImage ui-li-thumb lazy" data-src="'+imgUrl+'"></div>';}}}
var textlines=[];if(item.Type=='Episode'){textlines.push(item.SeriesName||'&nbsp;');}else if(item.Type=='MusicAlbum'){textlines.push(item.AlbumArtist||'&nbsp;');}
var displayName=LibraryBrowser.getPosterViewDisplayName(item);if(options.showIndexNumber&&item.IndexNumber!=null){displayName=item.IndexNumber+". "+displayName;}
textlines.push(displayName);var verticalTextLines=2;if(item.Type=='Audio'){textlines.push(item.ArtistItems.map(function(a){return a.Name;}).join(', ')||'&nbsp;');}
if(item.Type=='Game'){textlines.push(item.GameSystem||'&nbsp;');}
else if(item.Type=='MusicGenre'){textlines.push('&nbsp;');}
else if(item.Type=='MusicArtist'){textlines.push('&nbsp;');}
else{textlines.push(LibraryBrowser.getMiscInfoHtml(item));}
html+='<h3>';html+=textlines[0];html+='</h3>';if(textlines.length>1&&verticalTextLines>1){html+='<p>';html+=textlines[1];html+='</p>';}
if(textlines.length>2&&verticalTextLines>2){html+='<p>';html+=textlines[2];html+='</p>';}
html+=LibraryBrowser.getSyncIndicator(item);if(item.Type=='Series'||item.Type=='Season'||item.Type=='BoxSet'||item.MediaType=='Video'){if(item.UserData.UnplayedItemCount){}else if(item.UserData.Played&&item.Type!='TvChannel'){html+='<div class="playedIndicator"><i class="fa fa-check"></i></div>';}}
html+='</a>';html+='<div class="listViewAside">';html+='<span class="listViewAsideText">';html+=textlines[verticalTextLines]||LibraryBrowser.getRatingHtml(item,false);html+='</span>';html+='<paper-icon-button icon="more-vert" class="listviewMenuButton"></paper-icon-button>';html+='<span class="listViewUserDataButtons">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</span>';html+='</div>';html+='</li>';index++;return html;}).join('');outerHtml+='</ul>';return outerHtml;},getItemDataAttributes:function(item,options,index){var atts=[];var itemCommands=LibraryBrowser.getItemCommands(item,options);atts.push('data-itemid="'+item.Id+'"');atts.push('data-commands="'+itemCommands.join(',')+'"');atts.push('data-context="'+(options.context||'')+'"');atts.push('data-itemtype="'+item.Type+'"');atts.push('data-mediatype="'+(item.MediaType||'')+'"');if(item.UserData.PlaybackPositionTicks){atts.push('data-positionticks="'+(item.UserData.PlaybackPositionTicks||0)+'"');}
atts.push('data-playaccess="'+(item.PlayAccess||'')+'"');atts.push('data-locationtype="'+(item.LocationType||'')+'"');atts.push('data-index="'+index+'"');if(options.showDetailsMenu){atts.push('data-detailsmenu="true"');}
if(item.AlbumId){atts.push('data-albumid="'+item.AlbumId+'"');}
if(item.ArtistItems&&item.ArtistItems.length){atts.push('data-artistid="'+item.ArtistItems[0].Id+'"');}
var html=atts.join(' ');if(html){html=' '+html;}
return html;},getItemCommands:function(item,options){var itemCommands=[];if(item.Type!="Recording"&&item.Type!="Program"){itemCommands.push('edit');}
if(item.LocalTrailerCount){itemCommands.push('trailer');}
if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"||item.Type=="MusicGenre"){itemCommands.push('instantmix');}
if(item.IsFolder||item.Type=="MusicArtist"||item.Type=="MusicGenre"){itemCommands.push('shuffle');}
if(PlaylistManager.supportsPlaylists(item)){if(options.showRemoveFromPlaylist){itemCommands.push('removefromplaylist');}else{itemCommands.push('playlist');}}
if(BoxSetEditor.supportsAddingToCollection(item)){itemCommands.push('addtocollection');}
if(options.playFromHere){itemCommands.push('playfromhere');itemCommands.push('queuefromhere');}
if(item.Type=='Playlist'||item.Type=='BoxSet'){if(item.CanDelete){itemCommands.push('delete');}}
if(SyncManager.isAvailable(item)){itemCommands.push('sync');}
return itemCommands;},screenWidth:function(){var screenWidth=$(window).width();return screenWidth;},shapes:['square','portrait','banner','smallBackdrop','homePageSmallBackdrop','backdrop','overflowBackdrop','overflowPortrait','overflowSquare'],getPostersPerRow:function(screenWidth){var cache=true;function getValue(shape){var div=$('<div class="card '+shape+'Card"><div class="cardBox"><div class="cardImage"></div></div></div>').appendTo(document.body);var innerWidth=$('.cardImage',div).innerWidth();if(!innerWidth||isNaN(innerWidth)){cache=false;innerWidth=Math.min(400,screenWidth/2);}
var width=screenWidth/innerWidth;div.remove();return Math.floor(width);}
var info={};for(var i=0,length=LibraryBrowser.shapes.length;i<length;i++){var currentShape=LibraryBrowser.shapes[i];info[currentShape]=getValue(currentShape);}
info.cache=cache;return info;},posterSizes:[],getPosterViewInfo:function(){var screenWidth=LibraryBrowser.screenWidth();var cachedResults=LibraryBrowser.posterSizes;for(var i=0,length=cachedResults.length;i<length;i++){if(cachedResults[i].screenWidth==screenWidth){return cachedResults[i];}}
var result=LibraryBrowser.getPosterViewInfoInternal(screenWidth);result.screenWidth=screenWidth;if(result.cache){cachedResults.push(result);}
return result;},getPosterViewInfoInternal:function(screenWidth){var imagesPerRow=LibraryBrowser.getPostersPerRow(screenWidth);var result={};result.screenWidth=screenWidth;if(!AppInfo.hasLowImageBandwidth){screenWidth*=1.2;}
var roundTo=100;for(var i=0,length=LibraryBrowser.shapes.length;i<length;i++){var currentShape=LibraryBrowser.shapes[i];var shapeWidth=screenWidth/imagesPerRow[currentShape];if(!$.browser.mobile){shapeWidth=Math.round(shapeWidth/roundTo)*roundTo;}
result[currentShape+'Width']=Math.round(shapeWidth);}
result.cache=imagesPerRow.cache;return result;},getPosterViewHtml:function(options){var items=options.items;var currentIndexValue;options.shape=options.shape||"portrait";var html="";var primaryImageAspectRatio=LibraryBrowser.getAveragePrimaryImageAspectRatio(items);var isThumbAspectRatio=primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1.777777778)<.3;var isSquareAspectRatio=primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1)<.33||primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1.3333334)<.01;if(options.shape=='auto'||options.shape=='autohome'){if(isThumbAspectRatio){options.shape=options.shape=='auto'?'backdrop':'backdrop';}else if(isSquareAspectRatio){options.coverImage=true;options.shape='square';}else if(primaryImageAspectRatio&&primaryImageAspectRatio>1.9){options.shape='banner';options.coverImage=true;}else if(primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-0.6666667)<.2){options.shape=options.shape=='auto'?'portrait':'portrait';}else{options.shape=options.defaultShape||(options.shape=='auto'?'portrait':'portrait');}}
var posterInfo=LibraryBrowser.getPosterViewInfo();var thumbWidth=posterInfo.backdropWidth;var posterWidth=posterInfo.portraitWidth;var squareSize=posterInfo.squareWidth;var bannerWidth=posterInfo.bannerWidth;if(isThumbAspectRatio){posterWidth=thumbWidth;}
else if(isSquareAspectRatio){posterWidth=squareSize;}
if(options.shape=='overflowBackdrop'){thumbWidth=posterInfo.overflowBackdropWidth;}
else if(options.shape=='overflowPortrait'){posterWidth=posterInfo.overflowPortraitWidth;}
else if(options.shape=='overflowSquare'){squareSize=posterInfo.overflowSquareWidth;}
else if(options.shape=='smallBackdrop'){thumbWidth=posterInfo.smallBackdropWidth;}
else if(options.shape=='homePageSmallBackdrop'){thumbWidth=posterInfo.homePageSmallBackdropWidth;posterWidth=posterInfo.homePageSmallBackdropWidth;}
else if(options.shape=='detailPagePortrait'){posterWidth=200;}
else if(options.shape=='detailPageSquare'){posterWidth=200;squareSize=200;}
else if(options.shape=='detailPage169'){posterWidth=320;thumbWidth=320;}
var dateText;for(var i=0,length=items.length;i<length;i++){var item=items[i];dateText=null;primaryImageAspectRatio=LibraryBrowser.getAveragePrimaryImageAspectRatio([item]);if(options.showPremiereDateIndex){if(item.PremiereDate){try{dateText=LibraryBrowser.getFutureDateText(parseISO8601Date(item.PremiereDate,{toLocal:true}),true);}catch(err){}}
var newIndexValue=dateText||Globalize.translate('HeaderUnknownDate');if(newIndexValue!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader" style="text-align:center;">'+newIndexValue+'</h2>';currentIndexValue=newIndexValue;}}
else if(options.showStartDateIndex){if(item.StartDate){try{dateText=LibraryBrowser.getFutureDateText(parseISO8601Date(item.StartDate,{toLocal:true}),true);}catch(err){}}
var newIndexValue=dateText||Globalize.translate('HeaderUnknownDate');if(newIndexValue!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader" style="text-align:center;">'+newIndexValue+'</h2>';currentIndexValue=newIndexValue;}}else if(options.timeline){var year=item.ProductionYear||Globalize.translate('HeaderUnknownYear');if(year!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader">'+year+'</h2>';currentIndexValue=year;}}
html+=LibraryBrowser.getPosterViewItemHtml(item,i,options,primaryImageAspectRatio,thumbWidth,posterWidth,squareSize,bannerWidth);}
return html;},getPosterViewItemHtml:function(item,index,options,primaryImageAspectRatio,thumbWidth,posterWidth,squareSize,bannerWidth){var html='';var imgUrl=null;var icon;var width=null;var height=null;var forceName=false;var enableImageEnhancers=options.enableImageEnhancers!==false;var cssClass="card";if(options.autoThumb&&item.ImageTags&&item.ImageTags.Primary&&item.PrimaryImageAspectRatio&&item.PrimaryImageAspectRatio>=1.5){width=posterWidth;height=primaryImageAspectRatio?Math.round(posterWidth/primaryImageAspectRatio):null;imgUrl=ApiClient.getImageUrl(item.Id,{type:"Primary",height:height,width:width,tag:item.ImageTags.Primary,enableImageEnhancers:enableImageEnhancers});}else if(options.autoThumb&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:thumbWidth,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(options.preferBackdrop&&item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:thumbWidth,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:thumbWidth,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(options.preferBanner&&item.ImageTags&&item.ImageTags.Banner){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Banner",maxWidth:bannerWidth,tag:item.ImageTags.Banner,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.SeriesThumbImageTag&&options.inheritThumb!==false){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Thumb",maxWidth:thumbWidth,tag:item.SeriesThumbImageTag,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.ParentThumbItemId&&options.inheritThumb!==false){imgUrl=ApiClient.getThumbImageUrl(item.ParentThumbItemId,{type:"Thumb",maxWidth:thumbWidth,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:thumbWidth,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});forceName=true;}else if(item.ImageTags&&item.ImageTags.Primary){width=posterWidth;height=primaryImageAspectRatio?Math.round(posterWidth/primaryImageAspectRatio):null;imgUrl=ApiClient.getImageUrl(item.Id,{type:"Primary",height:height,width:width,tag:item.ImageTags.Primary,enableImageEnhancers:enableImageEnhancers});}
else if(item.ParentPrimaryImageTag){imgUrl=ApiClient.getImageUrl(item.ParentPrimaryImageItemId,{type:"Primary",width:posterWidth,tag:item.ParentPrimaryImageTag,enableImageEnhancers:enableImageEnhancers});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){height=squareSize;width=primaryImageAspectRatio?Math.round(height*primaryImageAspectRatio):null;imgUrl=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:height,width:width,tag:item.AlbumPrimaryImageTag,enableImageEnhancers:enableImageEnhancers});}
else if(item.Type=='Season'&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:thumbWidth,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:thumbWidth,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});}else if(item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:thumbWidth,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(item.SeriesThumbImageTag){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Thumb",maxWidth:thumbWidth,tag:item.SeriesThumbImageTag,enableImageEnhancers:enableImageEnhancers});}else if(item.ParentThumbItemId){imgUrl=ApiClient.getThumbImageUrl(item,{type:"Thumb",maxWidth:thumbWidth,enableImageEnhancers:enableImageEnhancers});}else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"){if(item.Name&&options.showTitle){icon='fa-music';}
cssClass+=" defaultBackground";}else if(item.Type=="Recording"||item.Type=="Program"||item.Type=="TvChannel"){if(item.Name&&options.showTitle){icon='fa-folder-open';}
cssClass+=" defaultBackground";}else if(item.MediaType=="Video"||item.Type=="Season"||item.Type=="Series"){if(item.Name&&options.showTitle){icon='fa-video-camera';}
cssClass+=" defaultBackground";}else if(item.Type=="Person"){if(item.Name&&options.showTitle){icon='fa-user';}
cssClass+=" defaultBackground";}else{if(item.Name&&options.showTitle){icon='fa-folder-open';}
cssClass+=" defaultBackground";}
cssClass+=' '+options.shape+'Card';var mediaSourceCount=item.MediaSourceCount||1;var href=options.linkItem===false?'#':LibraryBrowser.getHref(item,options.context);if(item.UserData){cssClass+=' '+LibraryBrowser.getUserDataCssClass(item.UserData.Key);}
if(options.showChildCountIndicator&&item.ChildCount&&options.showLatestItemsPopup!==false){cssClass+=' groupedCard';}
if(options.showTitle&&!options.overlayText){cssClass+=' bottomPaddedCard';}
var dataAttributes=LibraryBrowser.getItemDataAttributes(item,options,index);var defaultAction=options.defaultAction;if(defaultAction=='play'||defaultAction=='playallfromhere'){if(item.PlayAccess!='Full'){defaultAction=null;}}
var defaultActionAttribute=defaultAction?(' data-action="'+defaultAction+'"'):'';html+='<div'+dataAttributes+' class="'+cssClass+'">';var style="";if(imgUrl&&!options.lazy){style+='background-image:url(\''+imgUrl+'\');';}
var imageCssClass='cardImage';if(icon){imageCssClass+=" iconCardImage";}
if(options.coverImage){imageCssClass+=" coveredCardImage";}
if(options.centerImage){imageCssClass+=" centeredCardImage";}
var dataSrc="";if(options.lazy&&imgUrl){imageCssClass+=" lazy";dataSrc=' data-src="'+imgUrl+'"';}
var cardboxCssClass='cardBox';if(options.cardLayout){cardboxCssClass+=' visualCardBox';}
html+='<div class="'+cardboxCssClass+'">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var anchorCssClass="cardContent";anchorCssClass+=' mediaItem';if(options.defaultAction){anchorCssClass+=' itemWithAction';}
var transition=options.transition===false||!AppInfo.enableSectionTransitions?'':' data-transition="slide"';html+='<a'+transition+' class="'+anchorCssClass+'" href="'+href+'"'+defaultActionAttribute+'>';html+='<div class="'+imageCssClass+'" style="'+style+'"'+dataSrc+'>';if(icon){html+='<i class="fa '+icon+'"></i>';}
html+='</div>';html+='<div class="cardOverlayTarget"></div>';if(item.LocationType=="Offline"||item.LocationType=="Virtual"){if(options.showLocationTypeIndicator!==false){html+=LibraryBrowser.getOfflineIndicatorHtml(item);}}else if(options.showUnplayedIndicator!==false){html+=LibraryBrowser.getPlayedIndicatorHtml(item);}else if(options.showChildCountIndicator){html+=LibraryBrowser.getGroupCountIndicator(item);}
html+=LibraryBrowser.getSyncIndicator(item);if(mediaSourceCount>1){html+='<div class="mediaSourceIndicator">'+mediaSourceCount+'</div>';}
if(item.IsUnidentified){html+='<div class="unidentifiedIndicator"><i class="fa fa-exclamation"></i></div>';}
var progressHtml=options.showProgress===false||item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));var footerOverlayed=false;if(options.overlayText||(forceName&&!options.showTitle)){var footerCssClass=progressHtml?'cardFooter fullCardFooter':'cardFooter';html+=LibraryBrowser.getCardFooterText(item,options,imgUrl,forceName,footerCssClass,progressHtml);footerOverlayed=true;}
else if(progressHtml){html+='<div class="cardFooter fullCardFooter lightCardFooter">';html+="<div class='cardProgress cardText'>";html+=progressHtml;html+="</div>";html+="</div>";progressHtml='';}
html+='</a>';html+='</div>';if(!options.overlayText&&!footerOverlayed){html+=LibraryBrowser.getCardFooterText(item,options,imgUrl,forceName,'cardFooter outerCardFooter',progressHtml);}
html+='</div>';html+="</div>";return html;},getCardFooterText:function(item,options,imgUrl,forceName,footerClass,progressHtml){var html='';html+='<div class="'+footerClass+'">';if(options.cardLayout){html+='<div class="cardButtonContainer">';html+='<paper-icon-button icon="more-vert" class="listviewMenuButton btnCardOptions"></paper-icon-button>';html+="</div>";}
var name=LibraryBrowser.getPosterViewDisplayName(item,options.displayAsSpecial);if(!imgUrl&&!options.showTitle){html+="<div class='cardDefaultText'>";html+=htmlEncode(name);html+="</div>";}
var cssClass=options.centerText?"cardText cardTextCentered":"cardText";var lines=[];if(options.showParentTitle){lines.push(item.EpisodeTitle?item.Name:(item.SeriesName||item.Album||item.AlbumArtist||item.GameSystem||""));}
if(options.showTitle||forceName){lines.push(htmlEncode(name));}
if(options.showItemCounts){var itemCountHtml=LibraryBrowser.getItemCountsHtml(options,item);lines.push(itemCountHtml);}
if(options.textLines){var additionalLines=options.textLines(item);for(var i=0,length=additionalLines.length;i<length;i++){lines.push(additionalLines[i]);}}
if(options.showSongCount){var songLine='';if(item.SongCount){songLine=item.SongCount==1?Globalize.translate('ValueOneSong'):Globalize.translate('ValueSongCount',item.SongCount);}
lines.push(songLine);}
if(options.showPremiereDate){if(item.PremiereDate){try{lines.push(LibraryBrowser.getPremiereDateText(item));}catch(err){lines.push('');}}else{lines.push('');}}
if(options.showYear){lines.push(item.ProductionYear||'');}
if(options.showSeriesYear){if(item.Status=="Continuing"){lines.push(Globalize.translate('ValueSeriesYearToPresent',item.ProductionYear||''));}else{lines.push(item.ProductionYear||'');}}
if(options.showProgramAirInfo){var date=parseISO8601Date(item.StartDate,{toLocal:true});var text=item.StartDate?date.toLocaleString():'';lines.push(text||'&nbsp;');lines.push(item.ChannelName||'&nbsp;');}
html+=LibraryBrowser.getCardTextLines(lines,cssClass,!options.overlayText);if(options.overlayText){if(progressHtml){html+="<div class='cardText cardProgress'>";html+=progressHtml;html+="</div>";}}
html+="</div>";return html;},getListItemInfo:function(elem){var elemWithAttributes=elem;while(!elemWithAttributes.getAttribute('data-itemid')){elemWithAttributes=elemWithAttributes.parentNode;}
var itemId=elemWithAttributes.getAttribute('data-itemid');var index=elemWithAttributes.getAttribute('data-index');var mediaType=elemWithAttributes.getAttribute('data-mediatype');return{id:itemId,index:index,mediaType:mediaType,context:elemWithAttributes.getAttribute('data-context')};},getCardTextLines:function(lines,cssClass,forceLines){var html='';var valid=0;var i,length;for(i=0,length=lines.length;i<length;i++){var text=lines[i];if(text){html+="<div class='"+cssClass+"'>";html+=text;html+="</div>";valid++;}}
if(forceLines){while(valid<length){html+="<div class='"+cssClass+"'>&nbsp;</div>";valid++;}}
return html;},getFutureDateText:function(date){var weekday=[];weekday[0]=Globalize.translate('OptionSunday');weekday[1]=Globalize.translate('OptionMonday');weekday[2]=Globalize.translate('OptionTuesday');weekday[3]=Globalize.translate('OptionWednesday');weekday[4]=Globalize.translate('OptionThursday');weekday[5]=Globalize.translate('OptionFriday');weekday[6]=Globalize.translate('OptionSaturday');var day=weekday[date.getDay()];date=date.toLocaleDateString();if(date.toLowerCase().indexOf(day.toLowerCase())==-1){return day+" "+date;}
return date;},getPremiereDateText:function(item,date){if(!date){var text='';if(item.AirTime){text+=item.AirTime;}
if(item.SeriesStudio){if(text){text+=" on "+item.SeriesStudio;}else{text+=item.SeriesStudio;}}
return text;}
var day=LibraryBrowser.getFutureDateText(date);if(item.AirTime){day+=" at "+item.AirTime;}
if(item.SeriesStudio){day+=" on "+item.SeriesStudio;}
return day;},getPosterViewDisplayName:function(item,displayAsSpecial,includeParentInfo){if(!item){throw new Error("null item passed into getPosterViewDisplayName");}
var name=item.EpisodeTitle||item.Name||'';if(item.Type=="TvChannel"){if(item.Number){return item.Number+' '+name;}
return name;}
if(displayAsSpecial&&item.Type=="Episode"&&item.ParentIndexNumber==0){name=Globalize.translate('ValueSpecialEpisodeName',name);}else if(item.Type=="Episode"&&item.IndexNumber!=null&&item.ParentIndexNumber!=null){var displayIndexNumber=item.IndexNumber;var number="E"+displayIndexNumber;if(includeParentInfo!==false){number="S"+item.ParentIndexNumber+", "+number;}
if(item.IndexNumberEnd){displayIndexNumber=item.IndexNumberEnd;number+="-"+displayIndexNumber;}
name=number+" - "+name;}
return name;},getOfflineIndicatorHtml:function(item){if(item.LocationType=="Offline"){return'<div class="posterRibbon offlinePosterRibbon">'+Globalize.translate('HeaderOffline')+'</div>';}
if(item.Type=='Episode'){try{var date=parseISO8601Date(item.PremiereDate,{toLocal:true});if(item.PremiereDate&&(new Date().getTime()<date.getTime())){return'<div class="posterRibbon unairedPosterRibbon">'+Globalize.translate('HeaderUnaired')+'</div>';}}catch(err){}
return'<div class="posterRibbon missingPosterRibbon">'+Globalize.translate('HeaderMissing')+'</div>';}
return'';},getPlayedIndicatorHtml:function(item){if(item.Type=="Series"||item.Type=="Season"||item.Type=="BoxSet"||item.MediaType=="Video"||item.MediaType=="Game"||item.MediaType=="Book"){if(item.UserData.UnplayedItemCount){return'<div class="playedIndicator textIndicator">'+item.UserData.UnplayedItemCount+'</div>';}
if(item.Type!='TvChannel'){if(item.UserData.PlayedPercentage&&item.UserData.PlayedPercentage>=100||(item.UserData&&item.UserData.Played)){return'<div class="playedIndicator"><i class="fa fa-check"></i></div>';}}}
return'';},getGroupCountIndicator:function(item){if(item.ChildCount){return'<div class="playedIndicator textIndicator">'+item.ChildCount+'</div>';}
return'';},getSyncIndicator:function(item){if(item.SyncPercent){if(item.SyncPercent>=100){return'<div class="syncIndicator"><i class="fa fa-refresh"></i></div>';}
var degree=(item.SyncPercent/100)*360;return'<div class="pieIndicator"><i class="fa fa-refresh"></i><div class="pieBackground"></div><div class="hold"><div class="pie" style="-webkit-transform: rotate('+degree+'deg);-moz-transform: rotate('+degree+'deg);-o-transform: rotate('+degree+'deg);transform: rotate('+degree+'deg);"></div></div></div>';}
if(item.SyncStatus){if(item.SyncStatus=='Queued'||item.SyncStatus=='Converting'||item.SyncStatus=='ReadyToTransfer'||item.SyncStatus=='Transferring'){return'<div class="syncIndicator syncWorkingIndicator"><i class="fa fa-refresh"></i></div>';}
if(item.SyncStatus=='Synced'){return'<div class="syncIndicator"><i class="fa fa-refresh"></i></div>';}}
return'';},getAveragePrimaryImageAspectRatio:function(items){var values=[];for(var i=0,length=items.length;i<length;i++){var ratio=items[i].PrimaryImageAspectRatio||0;if(!ratio){continue;}
values[values.length]=ratio;}
if(!values.length){return null;}
values.sort(function(a,b){return a-b;});var half=Math.floor(values.length/2);var result;if(values.length%2)
result=values[half];else
result=(values[half-1]+values[half])/2.0;if(Math.abs(0.66666666667-result)<=.15){return 0.66666666667;}
if(Math.abs(1.777777778-result)<=.2){return 1.777777778;}
if(Math.abs(1-result)<=.15){return 1;}
if(Math.abs(1.33333333333-result)<=.15){return 1.33333333333;}
return result;},metroColors:["#6FBD45","#4BB3DD","#4164A5","#E12026","#800080","#E1B222","#008040","#0094FF","#FF00C7","#FF870F","#7F0037"],getRandomMetroColor:function(){var index=Math.floor(Math.random()*(LibraryBrowser.metroColors.length-1));return LibraryBrowser.metroColors[index];},getMetroColor:function(str){if(str){var character=String(str.substr(0,1).charCodeAt());var sum=0;for(var i=0;i<character.length;i++){sum+=parseInt(character.charAt(i));}
var index=String(sum).substr(-1);return LibraryBrowser.metroColors[index];}else{return LibraryBrowser.getRandomMetroColor();}},renderName:function(item,nameElem,linkToElement,context){var name=LibraryBrowser.getPosterViewDisplayName(item,false,false);Dashboard.setPageTitle(name);if(linkToElement){nameElem.html('<a class="detailPageParentLink" href="'+LibraryBrowser.getHref(item,context)+'">'+name+'</a>').trigger('create');}else{nameElem.html(name);}},renderParentName:function(item,parentNameElem,context){var html=[];var contextParam=context?('&context='+context):'';if(item.AlbumArtists){html.push(LibraryBrowser.getArtistLinksHtml(item.AlbumArtists,"detailPageParentLink"));}else if(item.ArtistItems&&item.ArtistItems.length&&item.Type=="MusicVideo"){html.push(LibraryBrowser.getArtistLinksHtml(item.ArtistItems,"detailPageParentLink"));}else if(item.SeriesName&&item.Type=="Episode"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeriesId+contextParam+'">'+item.SeriesName+'</a>');}
if(item.SeriesName&&item.Type=="Season"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeriesId+contextParam+'">'+item.SeriesName+'</a>');}else if(item.ParentIndexNumber!=null&&item.Type=="Episode"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeasonId+contextParam+'">'+item.SeasonName+'</a>');}else if(item.Album&&item.Type=="Audio"&&(item.AlbumId||item.ParentId)){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+(item.AlbumId||item.ParentId)+contextParam+'">'+item.Album+'</a>');}else if(item.Album&&item.Type=="MusicVideo"&&item.AlbumId){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.AlbumId+contextParam+'">'+item.Album+'</a>');}else if(item.Album){html.push(item.Album);}
if(html.length){parentNameElem.show().html(html.join(' - ')).trigger('create');}else{parentNameElem.hide();}},renderLinks:function(linksElem,item){var links=[];if(item.HomePageUrl){links.push('<a class="textlink" href="'+item.HomePageUrl+'" target="_blank">'+Globalize.translate('ButtonWebsite')+'</a>');}
if(item.ExternalUrls){for(var i=0,length=item.ExternalUrls.length;i<length;i++){var url=item.ExternalUrls[i];links.push('<a class="textlink" href="'+url.Url+'" target="_blank">'+url.Name+'</a>');}}
if(links.length){var html=links.join('&nbsp;&nbsp;/&nbsp;&nbsp;');html=Globalize.translate('ValueLinks',html);linksElem.innerHTML=html;$(linksElem).trigger('create');$(linksElem).show();}else{$(linksElem).hide();}},getDefaultPageSizeSelections:function(){return[20,50,100,200,300,400,500];},getQueryPagingHtml:function(options){var startIndex=options.startIndex;var limit=options.limit;var totalRecordCount=options.totalRecordCount;if(limit&&options.updatePageSizeSetting!==false){try{appStorage.setItem(options.pageSizeKey||pageSizeKey,limit);}catch(e){}}
var html='';var recordsEnd=Math.min(startIndex+limit,totalRecordCount);var showControls=totalRecordCount>20||limit<totalRecordCount;html+='<div class="listPaging">';html+='<span style="margin-right: 10px;vertical-align:middle;">';var startAtDisplay=totalRecordCount?startIndex+1:0;html+=startAtDisplay+'-'+recordsEnd+' of '+totalRecordCount;html+='</span>';if(showControls||options.viewButton||options.addSelectionButton||options.additionalButtonsHtml){html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">';if(showControls){html+='<paper-button raised class="subdued notext btnPreviousPage" '+(startIndex?'':'disabled')+'><iron-icon icon="arrow-back"></iron-icon></paper-button>';html+='<paper-button raised class="subdued notext btnNextPage" '+(startIndex+limit>=totalRecordCount?'disabled':'')+'><iron-icon icon="arrow-forward"></iron-icon></paper-button>';}
html+=(options.additionalButtonsHtml||'');if(options.addSelectionButton){html+='<paper-button raised class="subdued notext btnToggleSelections"><iron-icon icon="check"></iron-icon></paper-button>';}
if(options.viewButton){html+='<paper-button raised class="subdued notext" onclick="require([\'jqmicons\']);jQuery(\'.viewPanel\', jQuery(this).parents(\'.page\')).panel(\'toggle\');"><iron-icon icon="more-vert"></iron-icon></paper-button>';}
html+='</div>';if(showControls&&options.showLimit){require(['jqmicons']);var id="selectPageSize";var pageSizes=options.pageSizes||LibraryBrowser.getDefaultPageSizeSelections();var optionsHtml=pageSizes.map(function(val){if(limit==val){return'<option value="'+val+'" selected="selected">'+val+'</option>';}else{return'<option value="'+val+'">'+val+'</option>';}}).join('');html+='<div class="pageSizeContainer"><label style="font-size:inherit;" class="labelPageSize" for="'+id+'">'+Globalize.translate('LabelLimit')+'</label><select class="selectPageSize" id="'+id+'" data-inline="true" data-mini="true">'+optionsHtml+'</select></div>';}}
html+='</div>';return html;},getRatingHtml:function(item,metascore){var html="";if(item.CommunityRating){html+="<div class='starRating' title='"+item.CommunityRating+"'></div>";html+='<div class="starRatingValue">';html+=item.CommunityRating.toFixed(1);html+='</div>';}
if(item.CriticRating!=null){if(item.CriticRating>=60){html+='<div class="fresh rottentomatoesicon" title="Rotten Tomatoes"></div>';}else{html+='<div class="rotten rottentomatoesicon" title="Rotten Tomatoes"></div>';}
html+='<div class="criticRating" title="Rotten Tomatoes">'+item.CriticRating+'%</div>';}
if(item.Metascore&&metascore!==false){if(item.Metascore>=60){html+='<div class="metascore metascorehigh" title="Metascore">'+item.Metascore+'</div>';}
else if(item.Metascore>=40){html+='<div class="metascore metascoremid" title="Metascore">'+item.Metascore+'</div>';}else{html+='<div class="metascore metascorelow" title="Metascore">'+item.Metascore+'</div>';}}
return html;},getItemProgressBarHtml:function(item){if(item.Type=="Recording"&&item.CompletionPercentage){return'<progress class="itemProgressBar recordingProgressBar" min="0" max="100" value="'+item.CompletionPercentage+'"></progress>';}
var pct=item.PlayedPercentage;if(pct&&pct<100){return'<progress class="itemProgressBar" min="0" max="100" value="'+pct+'"></progress>';}
return null;},getUserDataButtonHtml:function(method,itemId,btnCssClass,icon,tooltip){return'<paper-icon-button data-itemid="'+itemId+'" icon="'+icon+'" class="'+btnCssClass+'" onclick="LibraryBrowser.'+method+'(this);return false;"></paper-icon-button>';btnCssClass+=" imageButton";return'<button data-itemid="'+itemId+'" class="'+btnCssClass+'" type="button" onclick="LibraryBrowser.'+method+'(this);return false;" title="'+tooltip+'" data-role="none"><i class="fa '+icon+'"></i></button>';},getUserDataIconsHtml:function(item,includePlayed){var html='';var userData=item.UserData||{};var itemId=item.Id;var type=item.Type;if(includePlayed!==false){var tooltipPlayed=Globalize.translate('TooltipPlayed');if((item.MediaType||item.IsFolder)&&type!="TvChannel"&&type!="MusicArtist"&&item.MediaType!="Audio"){if(userData.Played){html+=LibraryBrowser.getUserDataButtonHtml('markPlayed',itemId,'btnUserItemRating btnUserItemRatingOn','check',tooltipPlayed);}else{html+=LibraryBrowser.getUserDataButtonHtml('markPlayed',itemId,'btnUserItemRating','check',tooltipPlayed);}}}
var tooltipLike=Globalize.translate('TooltipLike');var tooltipDislike=Globalize.translate('TooltipDislike');if(typeof userData.Likes=="undefined"){html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating','thumb-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating','thumb-up',tooltipLike);}
else if(userData.Likes){html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating','thumb-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating btnUserItemRatingOn','thumb-up',tooltipLike);}
else{html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating btnUserItemRatingOn','thumb-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating','thumb-up',tooltipLike);}
var tooltipFavorite=Globalize.translate('TooltipFavorite');if(userData.IsFavorite){html+=LibraryBrowser.getUserDataButtonHtml('markFavorite',itemId,'btnUserItemRating btnUserItemRatingOn','favorite',tooltipFavorite);}else{html+=LibraryBrowser.getUserDataButtonHtml('markFavorite',itemId,'btnUserItemRating','favorite',tooltipFavorite);}
return html;},markPlayed:function(link){var id=link.getAttribute('data-itemid');var markAsPlayed=!link.classList.contains('btnUserItemRatingOn');if(markAsPlayed){ApiClient.markPlayed(Dashboard.getCurrentUserId(),id);link.classList.add('btnUserItemRatingOn');}else{ApiClient.markUnplayed(Dashboard.getCurrentUserId(),id);link.classList.remove('btnUserItemRatingOn');}},markFavorite:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);var markAsFavorite=!$link.hasClass('btnUserItemRatingOn');ApiClient.updateFavoriteStatus(Dashboard.getCurrentUserId(),id,markAsFavorite);if(markAsFavorite){$link.addClass('btnUserItemRatingOn');}else{$link.removeClass('btnUserItemRatingOn');}},markLike:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);if(!$link.hasClass('btnUserItemRatingOn')){ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),id,true);$link.addClass('btnUserItemRatingOn');}else{ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),id);$link.removeClass('btnUserItemRatingOn');}
$link.prev().removeClass('btnUserItemRatingOn');},markDislike:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);if(!$link.hasClass('btnUserItemRatingOn')){ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),id,false);$link.addClass('btnUserItemRatingOn');}else{ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),id);$link.removeClass('btnUserItemRatingOn');}
$link.next().removeClass('btnUserItemRatingOn');},getDetailImageHtml:function(item,href,preferThumb){var imageTags=item.ImageTags||{};if(item.PrimaryImageTag){imageTags.Primary=item.PrimaryImageTag;}
var html='';var url;var imageHeight=360;if(preferThumb&&imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});}
else if(imageTags.Primary){url=ApiClient.getScaledImageUrl(item.Id,{type:"Primary",height:imageHeight,tag:item.ImageTags.Primary});}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){url=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",height:imageHeight,tag:item.BackdropImageTags[0]});}
else if(imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});}
else if(imageTags.Disc){url=ApiClient.getScaledImageUrl(item.Id,{type:"Disc",height:imageHeight,tag:item.ImageTags.Disc});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){url=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:imageHeight,tag:item.AlbumPrimaryImageTag});}
else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicGenre"){url="css/images/items/detail/audio.png";}
else if(item.MediaType=="Game"||item.Type=="GameGenre"){url="css/images/items/detail/game.png";}
else if(item.Type=="Person"){url="css/images/items/detail/person.png";}
else if(item.Type=="Genre"||item.Type=="Studio"){url="css/images/items/detail/video.png";}
else if(item.Type=="TvChannel"){url="css/images/items/detail/tv.png";}
else{url="css/images/items/detail/video.png";}
html+='<div style="position:relative;">';if(href){html+="<a class='itemDetailGalleryLink' href='"+href+"'>";}
html+="<img class='itemDetailImage' src='"+url+"' />";if(href){html+="</a>";}
var progressHtml=item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));if(progressHtml){html+='<div class="detailImageProgressContainer">';html+=progressHtml;html+="</div>";}
html+="</div>";return html;},renderDetailImage:function(elem,item,href,preferThumb){var imageTags=item.ImageTags||{};if(item.PrimaryImageTag){imageTags.Primary=item.PrimaryImageTag;}
var html='';var url;var shape='portrait';var imageHeight=360;var detectRatio=false;if(preferThumb&&imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});shape='thumb';}
else if(imageTags.Primary){url=ApiClient.getScaledImageUrl(item.Id,{type:"Primary",height:imageHeight,tag:item.ImageTags.Primary});detectRatio=true;}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){url=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",height:imageHeight,tag:item.BackdropImageTags[0]});shape='thumb';}
else if(imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});shape='thumb';}
else if(imageTags.Disc){url=ApiClient.getScaledImageUrl(item.Id,{type:"Disc",height:imageHeight,tag:item.ImageTags.Disc});shape='square';}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){url=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:imageHeight,tag:item.AlbumPrimaryImageTag});shape='square';}
else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicGenre"){url="css/images/items/detail/audio.png";shape='square';}
else if(item.MediaType=="Game"||item.Type=="GameGenre"){url="css/images/items/detail/game.png";shape='square';}
else if(item.Type=="Person"){url="css/images/items/detail/person.png";shape='square';}
else if(item.Type=="Genre"||item.Type=="Studio"){url="css/images/items/detail/video.png";shape='square';}
else if(item.Type=="TvChannel"){url="css/images/items/detail/tv.png";shape='square';}
else{url="css/images/items/detail/video.png";shape='square';}
html+='<div style="position:relative;">';if(href){html+="<a class='itemDetailGalleryLink' href='"+href+"'>";}
if(detectRatio&&item.PrimaryImageAspectRatio){if(item.PrimaryImageAspectRatio>=1.48){shape='thumb';}else if(item.PrimaryImageAspectRatio>=.85&&item.PrimaryImageAspectRatio<=1.34){shape='square';}}
var screenWidth=$(window).width();if(screenWidth>600){html+="<img class='itemDetailImage' src='"+url+"' />";}else{html+="<img class='itemDetailImage lazy' data-src='"+url+"' src='css/images/empty.png' />";}
if(href){html+="</a>";}
var progressHtml=item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));if(progressHtml){html+='<div class="detailImageProgressContainer">';html+=progressHtml;html+="</div>";}
html+="</div>";elem.innerHTML=html;function addClass(elems,name){for(var i=0,length=elems.length;i<length;i++){elems[i].classList.add(name);}}
function removeClass(elems,name){for(var i=0,length=elems.length;i<length;i++){elems[i].classList.remove(name);}}
var page=$(elem).parents('.page')[0];var detailContentEffectedByImage=page.querySelectorAll('.detailContentEffectedByImage');if(shape=='thumb'){addClass(detailContentEffectedByImage,'detailContentEffectedByThumbImage');removeClass(detailContentEffectedByImage,'detailContentEffectedBySquareImage');removeClass(detailContentEffectedByImage,'detailContentEffectedByPortraitImage');elem.classList.add('thumbDetailImageContainer');elem.classList.remove('portraitDetailImageContainer');elem.classList.remove('squareDetailImageContainer');}
else if(shape=='square'){removeClass(detailContentEffectedByImage,'detailContentEffectedByThumbImage');removeClass(detailContentEffectedByImage,'detailContentEffectedByPortraitImage');addClass(detailContentEffectedByImage,'detailContentEffectedBySquareImage');elem.classList.remove('thumbDetailImageContainer');elem.classList.remove('portraitDetailImageContainer');elem.classList.add('squareDetailImageContainer');}else{removeClass(detailContentEffectedByImage,'detailContentEffectedByThumbImage');removeClass(detailContentEffectedByImage,'detailContentEffectedBySquareImage');addClass(detailContentEffectedByImage,'detailContentEffectedByPortraitImage');elem.classList.remove('thumbDetailImageContainer');elem.classList.add('portraitDetailImageContainer');elem.classList.remove('squareDetailImageContainer');}
ImageLoader.lazyChildren(elem);},getDisplayTime:function(date){if((typeof date).toString().toLowerCase()==='string'){try{date=parseISO8601Date(date,{toLocal:true});}catch(err){return date;}}
var lower=date.toLocaleTimeString().toLowerCase();var hours=date.getHours();var minutes=date.getMinutes();var text;if(lower.indexOf('am')!=-1||lower.indexOf('pm')!=-1){var suffix=hours>11?'pm':'am';hours=(hours%12)||12;text=hours;if(minutes){text+=':';if(minutes<10){text+='0';}
text+=minutes;}
text+=suffix;}else{text=hours+':';if(minutes<10){text+='0';}
text+=minutes;}
return text;},getMiscInfoHtml:function(item){var miscInfo=[];var text,date;if(item.Type=="Episode"||item.MediaType=='Photo'){if(item.PremiereDate){try{date=parseISO8601Date(item.PremiereDate,{toLocal:true});text=date.toLocaleDateString();miscInfo.push(text);}
catch(e){Logger.log("Error parsing date: "+item.PremiereDate);}}}
if(item.StartDate){try{date=parseISO8601Date(item.StartDate,{toLocal:true});text=date.toLocaleDateString();miscInfo.push(text);if(item.Type!="Recording"){text=LibraryBrowser.getDisplayTime(date);miscInfo.push(text);}}
catch(e){Logger.log("Error parsing date: "+item.PremiereDate);}}
if(item.ProductionYear&&item.Type=="Series"){if(item.Status=="Continuing"){miscInfo.push(Globalize.translate('ValueSeriesYearToPresent',item.ProductionYear));}
else if(item.ProductionYear){text=item.ProductionYear;if(item.EndDate){try{var endYear=parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();if(endYear!=item.ProductionYear){text+="-"+parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();}}
catch(e){Logger.log("Error parsing date: "+item.EndDate);}}
miscInfo.push(text);}}
if(item.Type!="Series"&&item.Type!="Episode"&&item.MediaType!='Photo'){if(item.ProductionYear){miscInfo.push(item.ProductionYear);}
else if(item.PremiereDate){try{text=parseISO8601Date(item.PremiereDate,{toLocal:true}).getFullYear();miscInfo.push(text);}
catch(e){Logger.log("Error parsing date: "+item.PremiereDate);}}}
var minutes;if(item.RunTimeTicks&&item.Type!="Series"){if(item.Type=="Audio"){miscInfo.push(Dashboard.getDisplayTime(item.RunTimeTicks));}else{minutes=item.RunTimeTicks/600000000;minutes=minutes||1;miscInfo.push(Math.round(minutes)+"min");}}
if(item.OfficialRating&&item.Type!=="Season"&&item.Type!=="Episode"){miscInfo.push(item.OfficialRating);}
if(item.Video3DFormat){miscInfo.push("3D");}
if(item.MediaType=='Photo'&&item.Width&&item.Height){miscInfo.push(item.Width+"x"+item.Height);}
return miscInfo.join('&nbsp;&nbsp;&nbsp;&nbsp;');},renderOverview:function(elem,item){var overview=item.Overview||'';elem.innerHTML=overview;$('a',elem).each(function(){this.setAttribute("target","_blank");});if(overview){elem.classList.remove('empty');}else{elem.classList.add('empty');}},renderStudios:function(elem,item,context){if(item.Studios&&item.Studios.length&&item.Type!="Series"){var html='';for(var i=0,length=item.Studios.length;i<length;i++){if(i>0){html+='&nbsp;&nbsp;/&nbsp;&nbsp;';}
html+='<a class="textlink" href="itembynamedetails.html?context='+context+'&id='+item.Studios[i].Id+'">'+item.Studios[i].Name+'</a>';}
var translationKey=item.Studios.length>1?"ValueStudios":"ValueStudio";html=Globalize.translate(translationKey,html);elem.show().html(html).trigger('create');}else{elem.hide();}},renderGenres:function(elem,item,context,limit){var html='';var genres=item.Genres||[];for(var i=0,length=genres.length;i<length;i++){if(limit&&i>=limit){break;}
if(i>0){html+='<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>';}
var param=item.Type=="Audio"||item.Type=="MusicArtist"||item.Type=="MusicAlbum"?"musicgenre":"genre";if(item.MediaType=="Game"){param="gamegenre";}
html+='<a class="textlink" href="itembynamedetails.html?context='+context+'&'+param+'='+ApiClient.encodeName(genres[i])+'">'+genres[i]+'</a>';}
elem.html(html).trigger('create');},renderPremiereDate:function(elem,item){if(item.PremiereDate){try{var date=parseISO8601Date(item.PremiereDate,{toLocal:true});var translationKey=new Date().getTime()>date.getTime()?"ValuePremiered":"ValuePremieres";elem.show().html(Globalize.translate(translationKey,date.toLocaleDateString()));}catch(err){elem.hide();}}else{elem.hide();}},renderBudget:function(elem,item){if(item.Budget){elem.show().html(Globalize.translate('ValueBudget','$'+item.Budget));}else{elem.hide();}},renderRevenue:function(elem,item){if(item.Revenue){elem.show().html(Globalize.translate('ValueRevenue','$'+item.Revenue));}else{elem.hide();}},renderAwardSummary:function(elem,item){if(item.AwardSummary){elem.show().html(Globalize.translate('ValueAwards',item.AwardSummary));}else{elem.hide();}},renderDetailPageBackdrop:function(page,item){var screenWidth=screen.availWidth;var imgUrl;if(item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:screenWidth,tag:item.BackdropImageTags[0]});ImageLoader.lazyImage($('#itemBackdrop',page).removeClass('noBackdrop')[0],imgUrl);}
else if(item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:'Backdrop',index:0,tag:item.ParentBackdropImageTags[0],maxWidth:screenWidth});ImageLoader.lazyImage($('#itemBackdrop',page).removeClass('noBackdrop')[0],imgUrl);}
else{$('#itemBackdrop',page).addClass('noBackdrop').css('background-image','none');}}};})(window,document,jQuery,screen);(function($,document,window){var showOverlayTimeout;function onHoverOut(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
var elem=this.querySelector('.cardOverlayTarget');if($(elem).is(':visible')){require(["jquery","velocity"],function($,Velocity){Velocity.animate(elem,{"height":"0"},{complete:function(){$(elem).hide();}});});}}
function getOverlayHtml(item,currentUser,card,commands){var html='';html+='<div class="cardOverlayInner">';var className=card.className.toLowerCase();var isMiniItem=className.indexOf('mini')!=-1;var isSmallItem=isMiniItem||className.indexOf('small')!=-1;var isPortrait=className.indexOf('portrait')!=-1;var isSquare=className.indexOf('square')!=-1;var parentName=isSmallItem||isMiniItem||isPortrait?null:item.SeriesName;var name=LibraryBrowser.getPosterViewDisplayName(item,true);html+='<div style="margin-bottom:1em;">';var logoHeight=isSmallItem||isMiniItem?20:26;var maxLogoWidth=isPortrait?100:200;var imgUrl;if(parentName&&item.ParentLogoItemId){imgUrl=ApiClient.getScaledImageUrl(item.ParentLogoItemId,{height:logoHeight,type:'logo',tag:item.ParentLogoImageTag});html+='<img src="'+imgUrl+'" style="max-height:'+logoHeight+'px;max-width:100%;" />';}
else if(item.ImageTags.Logo){imgUrl=ApiClient.getScaledImageUrl(item.Id,{height:logoHeight,type:'logo',tag:item.ImageTags.Logo});html+='<img src="'+imgUrl+'" style="max-height:'+logoHeight+'px;max-width:100%;" />';}
else{html+=parentName||name;}
html+='</div>';if(parentName){html+='<p>';html+=name;html+='</p>';}else if(!isSmallItem&&!isMiniItem){html+='<p class="itemMiscInfo" style="white-space:nowrap;">';html+=LibraryBrowser.getMiscInfoHtml(item);html+='</p>';}
if(!isMiniItem){html+='<div style="margin:1em 0 .75em;">';if(isPortrait){html+='<div class="itemCommunityRating">';html+=LibraryBrowser.getRatingHtml(item,false);html+='</div>';html+='<div class="userDataIcons" style="margin:.5em 0 0em;">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</div>';}else{html+='<span class="itemCommunityRating" style="vertical-align:middle;">';html+=LibraryBrowser.getRatingHtml(item,false);html+='</span>';html+='<span class="userDataIcons" style="vertical-align:middle;">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</span>';}
html+='</div>';}
html+='<div>';var buttonMargin=isPortrait||isSquare?"margin:0 4px 0 0;":"margin:0 10px 0 0;";var buttonCount=0;if(MediaController.canPlay(item)){var resumePosition=(item.UserData||{}).PlaybackPositionTicks||0;html+='<button type="button" class="btnPlayItem" data-itemid="'+item.Id+'" data-itemtype="'+item.Type+'" data-isfolder="'+item.IsFolder+'" data-mediatype="'+item.MediaType+'" data-resumeposition="'+resumePosition+'" data-mini="true" data-inline="true" data-icon="play" data-iconpos="notext" title="'+Globalize.translate('ButtonPlay')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonPlay')+'</button>';buttonCount++;}
if(commands.indexOf('trailer')!=-1){html+='<button type="button" data-mini="true" data-inline="true" data-icon="video" data-iconpos="notext" class="btnPlayTrailer" data-itemid="'+item.Id+'" title="'+Globalize.translate('ButtonPlayTrailer')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonPlayTrailer')+'</button>';buttonCount++;}
html+='<button type="button" class="btnMoreCommands" data-mini="true" data-inline="true" data-icon="ellipsis-v" data-iconpos="notext" title="'+Globalize.translate('ButtonMore')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonMore')+'</button>';buttonCount++;html+='</div>';html+='</div>';return html;}
function onTrailerButtonClick(){var id=this.getAttribute('data-itemid');ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),id).done(function(trailers){MediaController.play({items:trailers});});return false;}
function onPlayItemButtonClick(){var id=this.getAttribute('data-itemid');var type=this.getAttribute('data-itemtype');var isFolder=this.getAttribute('data-isfolder')=='true';var mediaType=this.getAttribute('data-mediatype');var resumePosition=parseInt(this.getAttribute('data-resumeposition'));LibraryBrowser.showPlayMenu(this,id,type,isFolder,mediaType,resumePosition);return false;}
function onMoreButtonClick(){var card=$(this).parents('.card')[0];showContextMenu(card,{showPlayOptions:false});return false;}
function onCardTapHold(e){showContextMenu(this,{});e.preventDefault();return false;}
function showContextMenu(card,options){var displayContextItem=card;if(card.classList.contains('listviewMenuButton')){card=$(card).parents('.listItem,.card')[0];}
var itemId=card.getAttribute('data-itemid');var playlistItemId=card.getAttribute('data-playlistitemid');var commands=card.getAttribute('data-commands').split(',');var itemType=card.getAttribute('data-itemtype');var mediaType=card.getAttribute('data-mediatype');var playbackPositionTicks=parseInt(card.getAttribute('data-positionticks')||'0');var playAccess=card.getAttribute('data-playaccess');var locationType=card.getAttribute('data-locationtype');var index=card.getAttribute('data-index');var albumid=card.getAttribute('data-albumid');var artistid=card.getAttribute('data-artistid');Dashboard.getCurrentUser().done(function(user){var items=[];if(commands.indexOf('addtocollection')!=-1){items.push({name:Globalize.translate('ButtonAddToCollection'),id:'addtocollection',ironIcon:'add'});}
if(commands.indexOf('playlist')!=-1){items.push({name:Globalize.translate('ButtonAddToPlaylist'),id:'playlist',ironIcon:'playlist-add'});}
if(commands.indexOf('delete')!=-1){items.push({name:Globalize.translate('ButtonDelete'),id:'delete',ironIcon:'delete'});}
if(user.Policy.IsAdministrator&&commands.indexOf('edit')!=-1){items.push({name:Globalize.translate('ButtonEdit'),id:'edit',ironIcon:'mode-edit'});}
if(commands.indexOf('instantmix')!=-1){items.push({name:Globalize.translate('ButtonInstantMix'),id:'instantmix',ironIcon:'shuffle'});}
items.push({name:Globalize.translate('ButtonOpen'),id:'open',ironIcon:'folder-open'});if(options.showPlayOptions!==false){if(MediaController.canPlayByAttributes(itemType,mediaType,playAccess,locationType)){items.push({name:Globalize.translate('ButtonPlay'),id:'play',ironIcon:'play-arrow'});if(commands.indexOf('playfromhere')!=-1){items.push({name:Globalize.translate('ButtonPlayAllFromHere'),id:'playallfromhere',ironIcon:'play-arrow'});}}
if(mediaType=='Video'&&AppSettings.enableExternalPlayers()){items.push({name:Globalize.translate('ButtonPlayExternalPlayer'),id:'externalplayer',ironIcon:'airplay'});}
if(playbackPositionTicks&&mediaType!="Audio"){items.push({name:Globalize.translate('ButtonResume'),id:'resume',ironIcon:'play-arrow'});}
if(commands.indexOf('trailer')!=-1){items.push({name:Globalize.translate('ButtonPlayTrailer'),id:'trailer',ironIcon:'play-arrow'});}}
if(MediaController.canQueueMediaType(mediaType,itemType)){items.push({name:Globalize.translate('ButtonQueue'),id:'queue',ironIcon:'playlist-add'});if(commands.indexOf('queuefromhere')!=-1){items.push({name:Globalize.translate('ButtonQueueAllFromHere'),id:'queueallfromhere',ironIcon:'playlist-add'});}}
if(commands.indexOf('shuffle')!=-1){items.push({name:Globalize.translate('ButtonShuffle'),id:'shuffle',ironIcon:'shuffle'});}
if(commands.indexOf('removefromplaylist')!=-1){items.push({name:Globalize.translate('ButtonRemoveFromPlaylist'),id:'removefromplaylist',ironIcon:'remove'});}
if(commands.indexOf('sync')!=-1){items.push({name:Globalize.translate('ButtonSync'),id:'sync',ironIcon:'refresh'});}
if(albumid){items.push({name:Globalize.translate('ButtonViewAlbum'),id:'album',ironIcon:'album'});}
if(artistid){items.push({name:Globalize.translate('ButtonViewArtist'),id:'artist',ironIcon:'person'});}
var href=card.getAttribute('data-href')||card.href;if(!href){var links=card.getElementsByTagName('a');if(links.length){href=links[0].href;}}
require(['actionsheet'],function(){ActionSheetElement.show({items:items,positionTo:displayContextItem,callback:function(id){switch(id){case'addtocollection':BoxSetEditor.showPanel([itemId]);break;case'playlist':PlaylistManager.showPanel([itemId]);break;case'delete':LibraryBrowser.deleteItem(itemId);break;case'download':{var downloadHref=ApiClient.getUrl("Items/"+itemId+"/Download",{api_key:ApiClient.accessToken()});window.location.href=downloadHref;break;}
case'edit':Dashboard.navigate('edititemmetadata.html?id='+itemId);break;case'refresh':ApiClient.refreshItem(itemId,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllImages:false,ReplaceAllMetadata:true});break;case'instantmix':MediaController.instantMix(itemId);break;case'shuffle':MediaController.shuffle(itemId);break;case'open':Dashboard.navigate(href);break;case'album':Dashboard.navigate('itemdetails.html?id='+albumid);break;case'artist':Dashboard.navigate('itembynamedetails.html?context=music&id='+artistid);break;case'play':MediaController.play(itemId);break;case'playallfromhere':$(card).parents('.itemsContainer').trigger('playallfromhere',[index]);break;case'queue':MediaController.queue(itemId);break;case'trailer':ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),itemId).done(function(trailers){MediaController.play({items:trailers});});break;case'resume':MediaController.play({ids:[itemId],startPositionTicks:playbackPositionTicks});break;case'queueallfromhere':$(card).parents('.itemsContainer').trigger('queueallfromhere',[index]);break;case'sync':SyncManager.showMenu({items:[{Id:itemId}]});break;case'externalplayer':LibraryBrowser.playInExternalPlayer(itemId);break;case'removefromplaylist':$(card).parents('.itemsContainer').trigger('removefromplaylist',[playlistItemId]);break;default:break;}}});});});}
function onListViewMenuButtonClick(e){showContextMenu(this,{});e.preventDefault();return false;}
function onGroupedCardClick(e){var card=this;var itemId=card.getAttribute('data-itemid');var context=card.getAttribute('data-context');var userId=Dashboard.getCurrentUserId();var options={Limit:parseInt($('.playedIndicator',card).html()||'10'),Fields:"PrimaryImageAspectRatio,DateCreated",ParentId:itemId,GroupItems:false};var target=e.target;if(target.tagName=='A'||target.tagName=='BUTTON'){return;}
var buttonParents=$(target).parents('a:not(.card,.cardContent),button:not(.card,.cardContent)');if(buttonParents.length){return;}
ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options)).done(function(items){if(items.length==1){Dashboard.navigate(LibraryBrowser.getHref(items[0],context));return;}
var ids=items.map(function(i){return i.Id;});showItemsOverlay({ids:ids,context:context});});e.preventDefault();return false;}
function getItemsOverlay(ids,context){$('.detailsMenu').remove();var html='<div data-role="popup" class="detailsMenu" style="border:0;padding:0;" data-ids="'+ids.join(',')+'" data-context="'+(context||'')+'">';html+='<div style="padding:1em 1em;background:rgba(20,20,20,1);margin:0;text-align:center;" class="detailsMenuHeader">';html+='<button type="button" class="imageButton detailsMenuLeftButton" data-role="none"><i class="fa fa-arrow-left"></i></button>';html+='<h3 style="font-weight:400;margin:.5em 0;"></h3>';html+='<button type="button" class="imageButton detailsMenuRightButton" data-role="none"><i class="fa fa-arrow-right"></i></button>';html+='</div>';html+='<div class="detailsMenuContent" style="background-position:center center;background-repeat:no-repeat;background-size:cover;">';html+='<div style="padding:.5em 1em 1em;background:rgba(10,10,10,.80);" class="detailsMenuContentInner">';html+='</div>';html+='</div>';html+='</div>';$($.mobile.activePage).append(html);var elem=$('.detailsMenu').popup().trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();})[0];$('.detailsMenuLeftButton',elem).on('click',function(){var overlay=$(this).parents('.detailsMenu')[0];setItemIntoOverlay(overlay,parseInt(overlay.getAttribute('data-index')||'0')-1,context);});$('.detailsMenuRightButton',elem).on('click',function(){var overlay=$(this).parents('.detailsMenu')[0];setItemIntoOverlay(overlay,parseInt(overlay.getAttribute('data-index')||'0')+1,context);});return elem;}
function setItemIntoOverlay(elem,index){var ids=elem.getAttribute('data-ids').split(',');var itemId=ids[index];var userId=Dashboard.getCurrentUserId();var context=elem.getAttribute('data-context');elem.setAttribute('data-index',index);if(index>0){$('.detailsMenuLeftButton',elem).show();}else{$('.detailsMenuLeftButton',elem).hide();}
if(index<ids.length-1){$('.detailsMenuRightButton',elem).show();}else{$('.detailsMenuRightButton',elem).hide();}
var promise1=ApiClient.getItem(userId,itemId);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var item=response1[0];var user=response2[0];var background='none';if(AppInfo.enableDetailsMenuImages){var backdropUrl;var screenWidth=$(window).width();var backdropWidth=Math.min(screenWidth,800);if(item.BackdropImageTags&&item.BackdropImageTags.length){backdropUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:backdropWidth,tag:item.BackdropImageTags[0]});}
else if(item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){backdropUrl=ApiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:'Backdrop',index:0,tag:item.ParentBackdropImageTags[0],maxWidth:backdropWidth});}
if(backdropUrl){background='url('+backdropUrl+')';}}
$('.detailsMenuContent',elem).css('backgroundImage',background);var headerHtml=LibraryBrowser.getPosterViewDisplayName(item);$('.detailsMenuHeader',elem).removeClass('detailsMenuHeaderWithLogo');if(AppInfo.enableDetailsMenuImages){var logoUrl;var logoHeight=30;if(item.ImageTags&&item.ImageTags.Logo){logoUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Logo",index:0,height:logoHeight,tag:item.ImageTags.Logo});}
if(logoUrl){headerHtml='<img src="'+logoUrl+'" style="height:'+logoHeight+'px;" />';$('.detailsMenuHeader',elem).addClass('detailsMenuHeaderWithLogo');}}
$('h3',elem).html(headerHtml);var contentHtml='';var miscInfo=LibraryBrowser.getMiscInfoHtml(item);if(miscInfo){contentHtml+='<p>'+miscInfo+'</p>';}
var userData=LibraryBrowser.getUserDataIconsHtml(item);if(userData){contentHtml+='<p class="detailsMenuUserData">'+userData+'</p>';}
var ratingHtml=LibraryBrowser.getRatingHtml(item);if(ratingHtml){contentHtml+='<p>'+ratingHtml+'</p>';}
if(item.Overview){contentHtml+='<p class="detailsMenuOverview">'+item.Overview+'</p>';}
contentHtml+='<div class="detailsMenuButtons">';if(MediaController.canPlay(item)){if(item.MediaType=='Video'&&!item.IsFolder&&item.UserData&&item.UserData.PlaybackPositionTicks){contentHtml+='<paper-button raised class="secondary btnResume" style="background-color:#ff8f00;"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate('ButtonResume')+'</span></paper-button>';}
contentHtml+='<paper-button raised class="secondary btnPlay"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate('ButtonPlay')+'</span></paper-button>';}
contentHtml+='<paper-button data-href="'+LibraryBrowser.getHref(item,context)+'" raised class="submit btnSync" style="background-color: #673AB7;" onclick="Dashboard.navigate(this.getAttribute(\'data-href\'));"><iron-icon icon="folder-open"></iron-icon><span>'+Globalize.translate('ButtonOpen')+'</span></paper-button>';if(SyncManager.isAvailable(item,user)){contentHtml+='<paper-button raised class="submit btnSync"><iron-icon icon="refresh"></iron-icon><span>'+Globalize.translate('ButtonSync')+'</span></paper-button>';}
contentHtml+='</div>';$('.detailsMenuContentInner',elem).html(contentHtml).trigger('create');$('.btnSync',elem).on('click',function(){$(elem).popup('close');SyncManager.showMenu({items:[item]});});$('.btnPlay',elem).on('click',function(){$(elem).popup('close');MediaController.play({items:[item]});});$('.btnResume',elem).on('click',function(){$(elem).popup('close');MediaController.play({items:[item],startPositionTicks:item.UserData.PlaybackPositionTicks});});});}
function showItemsOverlay(options){var context=options.context;var elem=getItemsOverlay(options.ids,context);setItemIntoOverlay(elem,0);}
function onCardClick(e){var targetElem=e.target;if(targetElem.classList.contains('itemSelectionPanel')||this.querySelector('.itemSelectionPanel')){return false;}
var info=LibraryBrowser.getListItemInfo(this);var itemId=info.id;var context=info.context;var card=this;if(card.classList.contains('itemWithAction')){return;}
if(!card.classList.contains('card')){card=$(card).parents('.card')[0];}
if(card.classList.contains('groupedCard')){return;}
if(card.getAttribute('data-detailsmenu')!='true'){return;}
if(targetElem.tagName=='A'||targetElem.tagName=='BUTTON'){return;}
var target=$(targetElem);if(target.parents('a').length||target.parents('button').length){return;}
if(AppSettings.enableItemPreviews()){showItemsOverlay({ids:[itemId],context:context});return false;}}
$.fn.createCardMenus=function(options){var preventHover=false;function onShowTimerExpired(elem){elem=elem.querySelector('a');if($('.itemSelectionPanel:visible',elem).length){return;}
var innerElem=elem.querySelector('.cardOverlayTarget');var dataElement=elem;while(dataElement&&!dataElement.getAttribute('data-itemid')){dataElement=dataElement.parentNode;}
var id=dataElement.getAttribute('data-itemid');var commands=dataElement.getAttribute('data-commands').split(',');var promise1=ApiClient.getItem(Dashboard.getCurrentUserId(),id);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var item=response1[0];var user=response2[0];var card=elem;while(!card.classList.contains('card')){card=card.parentNode;}
innerElem.innerHTML=getOverlayHtml(item,user,card,commands);$('.btnPlayItem',innerElem).on('click',onPlayItemButtonClick);$('.btnPlayTrailer',innerElem).on('click',onTrailerButtonClick);$('.btnMoreCommands',innerElem).on('click',onMoreButtonClick);});$(innerElem).show();innerElem.style.height='0';require(["jquery","velocity"],function($,Velocity){Velocity.animate(innerElem,{"height":"100%"},"fast");});}
function onHoverIn(){if(preventHover===true){preventHover=false;return;}
if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
var elem=this;showOverlayTimeout=setTimeout(function(){onShowTimerExpired(elem);},1000);}
function preventTouchHover(){preventHover=true;}
this.off('contextmenu','.card',onCardTapHold);this.on('contextmenu','.card',onCardTapHold);this.off('click','.groupedCard',onGroupedCardClick);this.on('click','.groupedCard',onGroupedCardClick);this.off('click','.listviewMenuButton',onListViewMenuButtonClick);this.on('click','.listviewMenuButton',onListViewMenuButtonClick);if(!AppInfo.isTouchPreferred){this.off('mouseenter','.card:not(.bannerCard)',onHoverIn);this.on('mouseenter','.card:not(.bannerCard)',onHoverIn);this.off('mouseleave','.card:not(.bannerCard)',onHoverOut);this.on('mouseleave','.card:not(.bannerCard)',onHoverOut);this.off("touchstart",'.card:not(.bannerCard)',preventTouchHover);this.on("touchstart",'.card:not(.bannerCard)',preventTouchHover);}
this.off('click','.mediaItem',onCardClick);this.on('click','.mediaItem',onCardClick);return this;};function toggleSelections(page){Dashboard.showLoadingMsg();var selectionCommands=$('.selectionCommands',page);if(selectionCommands.is(':visible')){selectionCommands.hide();$('.itemSelectionPanel',page).hide();}else{selectionCommands.show();var panels=$('.itemSelectionPanel',page).show();if(!panels.length){var index=0;$('.cardContent',page).each(function(){var chkItemSelectId='chkItemSelect'+index;$(this).append('<div class="itemSelectionPanel" onclick="return false;"><div class="ui-checkbox"><label class="ui-btn ui-corner-all ui-btn-inherit ui-btn-icon-left ui-checkbox-off" for="'+chkItemSelectId+'">Select</label><input id="'+chkItemSelectId+'" type="checkbox" class="chkItemSelect" data-enhanced="true" /></div></div>');index++;});$('.itemsContainer',page).trigger('create');}
$('.chkItemSelect:checked',page).checked(false).checkboxradio('refresh');}
Dashboard.hideLoadingMsg();}
function hideSelections(page){var selectionCommands=page.querySelector('.selectionCommands');if(selectionCommands){selectionCommands.style.display='none';}
var elems=page.getElementsByClassName('itemSelectionPanel');for(var i=0,length=elems.length;i<length;i++){elems[i].style.display='none';}}
function getSelectedItems(page){var selection=$('.chkItemSelect:checked',page);return selection.parents('.card').map(function(){return this.getAttribute('data-itemid');}).get();}
function onSyncJobListSubmit(){hideSelections($($.mobile.activePage)[0]);}
function sync(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
SyncManager.showMenu({items:selection});Events.off(SyncManager,'jobsubmit',onSyncJobListSubmit);Events.on(SyncManager,'jobsubmit',onSyncJobListSubmit);}
function combineVersions(page){var selection=getSelectedItems(page);if(selection.length<2){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectTwoItems'),title:Globalize.translate('HeaderError')});return;}
var names=$('.chkItemSelect:checked',page).parents('.card').get().reverse().map(function(e){return $('.cardText',e).html();}).join('<br/>');var msg=Globalize.translate('MessageTheFollowingItemsWillBeGrouped')+"<br/><br/>"+names;msg+="<br/><br/>"+Globalize.translate('MessageConfirmItemGrouping');Dashboard.confirm(msg,Globalize.translate('HeaderGroupVersions'),function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Videos/MergeVersions",{Ids:selection.join(',')})}).done(function(){Dashboard.hideLoadingMsg();hideSelections(page);$('.itemsContainer',page).trigger('needsrefresh');});}});}
function addToCollection(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
BoxSetEditor.showPanel(selection);}
function addToPlaylist(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
PlaylistManager.showPanel(selection);}
function onListviewSubLinkClick(e){var elem=e.target;Dashboard.navigate(elem.getAttribute('data-href'));return false;}
function onItemWithActionClick(e){var elem=this;var action=elem.getAttribute('data-action');var elemWithAttributes=elem;if(action){while(!elemWithAttributes.getAttribute('data-itemid')){elemWithAttributes=elemWithAttributes.parentNode;}}
var index;var itemsContainer;var itemId=elemWithAttributes.getAttribute('data-itemid');if(action=='play'){MediaController.play(itemId);}
else if(action=='playallfromhere'){index=elemWithAttributes.getAttribute('data-index');itemsContainer=$(elem).parents('.itemsContainer');itemsContainer.trigger('playallfromhere',[index]);}
return false;}
$(document).on('pageinitdepends',".libraryPage",function(){var page=this;var btnAddToPlaylist=page.querySelector('.btnAddToPlaylist');if(btnAddToPlaylist){Events.on(btnAddToPlaylist,'click',function(){addToPlaylist(page);});}
var btnMergeVersions=page.querySelector('.btnMergeVersions');if(btnMergeVersions){Events.on(btnMergeVersions,'click',function(){combineVersions(page);});}
var btnSyncItems=page.querySelector('.btnSyncItems');if(btnSyncItems){Events.on(btnSyncItems,'click',function(){sync(page);});}
var btnAddToCollection=page.querySelector('.btnAddToCollection');if(btnAddToCollection){Events.on(btnAddToCollection,'click',function(){addToCollection(page);});}
$(page.getElementsByClassName('viewTabButton')).on('click',function(){$('.viewTabButton',page).removeClass('ui-btn-active');this.classList.add('ui-btn-active');$('.viewTab',page).hide();$('.'+this.getAttribute('data-tab'),page).show();});var viewPanel=$('.viewPanel',page);$('#selectPageSize',viewPanel).html(LibraryBrowser.getDefaultPageSizeSelections().map(function(i){return'<option value="'+i+'">'+i+'</option>';}).join('')).selectmenu('refresh');$(page).on('click','.btnToggleSelections',function(){toggleSelections(page);}).on('click','.itemWithAction',onItemWithActionClick).on('click','.listviewSubLink',onListviewSubLinkClick);var itemsContainers=page.getElementsByClassName('itemsContainer');for(var i=0,length=itemsContainers.length;i<length;i++){$(itemsContainers[i]).createCardMenus();}}).on('pagebeforeshowready',".libraryPage",function(){var page=this;hideSelections(page);var elem=page.querySelector('.viewTabButton');if(elem){Events.trigger(elem,'click');}});function renderUserDataChanges(card,userData){if(userData.Played){if(!$('.playedIndicator',card).length){$('<div class="playedIndicator"></div>').insertAfter($('.cardOverlayTarget',card));}
$('.playedIndicator',card).html('<i class="material-icons">check</i>');$('.cardProgress',card).remove();}
else if(userData.UnplayedItemCount){if(!$('.playedIndicator',card).length){$('<div class="playedIndicator"></div>').insertAfter($('.cardOverlayTarget',card));}
$('.playedIndicator',card).html(userData.UnplayedItemCount);}
else{$('.playedIndicator',card).remove();var progressHtml=LibraryBrowser.getItemProgressBarHtml(userData);$('.cardProgress',card).html(progressHtml);}}
function onUserDataChanged(userData){var cssClass=LibraryBrowser.getUserDataCssClass(userData.Key);if(!cssClass){return;}
$('.'+cssClass).each(function(){var mediaType=this.getAttribute('data-mediatype');if(mediaType=='Video'){this.setAttribute('data-positionticks',(userData.PlaybackPositionTicks||0));if($(this).hasClass('card')){renderUserDataChanges(this,userData);}}});}
function onWebSocketMessage(e,data){var msg=data;if(msg.MessageType==="UserDataChanged"){if(msg.Data.UserId==Dashboard.getCurrentUserId()){for(var i=0,length=msg.Data.UserDataList.length;i<length;i++){onUserDataChanged(msg.Data.UserDataList[i]);}}}}
function initializeApiClient(apiClient){$(apiClient).off('websocketmessage',onWebSocketMessage).on('websocketmessage',onWebSocketMessage);}
Dashboard.ready(function(){if(window.ApiClient){initializeApiClient(window.ApiClient);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});});})(jQuery,document,window);(function(window,document,$,devicePixelRatio){var backStack=[];var addNextToBackStack=true;function renderHeader(){var html='<div class="viewMenuBar ui-bar-b">';if(AppInfo.enableBackButton){html+='<paper-icon-button icon="chevron-left" class="headerButton headerButtonLeft headerBackButton"></paper-icon-button>';}
html+='<paper-icon-button icon="menu" class="headerButton mainDrawerButton barsMenuButton headerButtonLeft"></paper-icon-button>';html+='<div class="libraryMenuButtonText headerButton">'+Globalize.translate('ButtonHome')+'</div>';html+='<div class="viewMenuSecondary">';html+='<span class="headerSelectedPlayer"></span>';html+='<paper-icon-button icon="cast" class="btnCast headerButton headerButtonRight hide"></paper-icon-button>';html+='<paper-icon-button icon="search" class="headerButton headerButtonRight headerSearchButton hide" onclick="Search.showSearchPanel();"></paper-icon-button>';html+='<div class="viewMenuSearch hide">';html+='<form class="viewMenuSearchForm">';html+='<input type="text" data-role="none" data-type="search" class="headerSearchInput" autocomplete="off" spellcheck="off" />';html+='<div class="searchInputIcon fa fa-search"></div>';html+='<paper-icon-button icon="close" class="btnCloseSearch"></paper-icon-button>';html+='</form>';html+='</div>';html+='<paper-icon-button icon="mic" class="headerButton headerButtonRight headerVoiceButton hide" onclick="VoiceInputManager.startListening();"></paper-icon-button>';if(!showUserAtTop()){html+='<button class="headerButton headerButtonRight headerUserButton" type="button" data-role="none" onclick="Dashboard.showUserFlyout(this);">';html+='<div class="fa fa-user"></div>';html+='</button>';}
if(!$.browser.mobile&&!AppInfo.isNativeApp){html+='<paper-icon-button icon="settings" class="headerButton headerButtonRight dashboardEntryHeaderButton hide" onclick="Dashboard.navigate(\'dashboard.html\');"></paper-icon-button>';}
html+='</div>';html+='</div>';$(document.body).append(html);ImageLoader.lazyChildren(document.querySelector('.viewMenuBar'));Events.trigger(document,'headercreated');bindMenuEvents();}
function onBackClick(){if(Dashboard.exitOnBack()){Dashboard.exit();}
else{addNextToBackStack=false;backStack.length=Math.max(0,backStack.length-1);history.back();}}
function addUserToHeader(user){var header=document.querySelector('.viewMenuBar');if(user.localUser){$('.btnCast',header).visible(true);$('.headerSearchButton',header).visible(true);requirejs(['voice/voice'],function(){if(VoiceInputManager.isSupported()){$('.headerVoiceButton',header).visible(true);}else{$('.headerVoiceButton',header).visible(false);}});}else{$('.btnCast',header).visible(false);$('.headerVoiceButton',header).visible(false);$('.headerSearchButton',header).visible(false);}
if(user.canManageServer){$('.dashboardEntryHeaderButton',header).visible(true);}else{$('.dashboardEntryHeaderButton',header).visible(false);}
var userButtonHtml='';if(user.name){if(user.imageUrl&&AppInfo.enableUserImage){var userButtonHeight=26;var url=user.imageUrl;if(user.supportsImageParams){url+="&height="+(userButtonHeight*Math.max(devicePixelRatio||1,2));}
userButtonHtml+='<div class="lazy headerUserImage" data-src="'+url+'" style="width:'+userButtonHeight+'px;height:'+userButtonHeight+'px;"></div>';}else{userButtonHtml+='<div class="fa fa-user"></div>';}
var headerUserButton=header.querySelector('.headerUserButton');if(headerUserButton){headerUserButton.innerHTML=userButtonHtml;ImageLoader.lazyChildren(headerUserButton);}}}
function bindMenuEvents(){if(AppInfo.isTouchPreferred){$('.mainDrawerButton').on('touchend',openMainDrawer).on('click',openMainDrawer);}else{$('.mainDrawerButton').createHoverTouch().on('hovertouch',openMainDrawer);}
$('.headerBackButton').on('click',onBackClick);$(initViewMenuBarHeadroom);}
function initViewMenuBarHeadroom(){var viewMenuBar=document.getElementsByClassName("viewMenuBar")[0];initHeadRoom(viewMenuBar);}
function updateViewMenuBarHeadroom(page,viewMenuBar){if(page.classList.contains('libraryPage')){setTimeout(reEnableHeadroom,700);}else{viewMenuBar.classList.add('headroomDisabled');}}
function reEnableHeadroom(){$('.headroomDisabled').removeClass('headroomDisabled');}
function getItemHref(item,context){return LibraryBrowser.getHref(item,context);}
var requiresDrawerRefresh=true;var requiresDashboardDrawerRefresh=true;var lastOpenTime=new Date().getTime();function openMainDrawer(){var drawerPanel=document.querySelector('.mainDrawerPanel');drawerPanel.openDrawer();lastOpenTime=new Date().getTime();}
function onMainDrawerOpened(){if($.browser.mobile){document.body.classList.add('bodyWithPopupOpen');}
var drawer=document.querySelector('.mainDrawerPanel .mainDrawer');ConnectionManager.user(window.ApiClient).done(function(user){if(requiresDrawerRefresh){ensureDrawerStructure(drawer);refreshUserInfoInDrawer(user,drawer);refreshLibraryInfoInDrawer(user,drawer);refreshBottomUserInfoInDrawer(user,drawer);Events.trigger(document,'libraryMenuCreated');updateLibraryMenu(user.localUser);}
var pageElem=$($.mobile.activePage)[0];if(requiresDrawerRefresh||requiresDashboardDrawerRefresh){refreshDashboardInfoInDrawer(pageElem,user,drawer);requiresDashboardDrawerRefresh=false;}
requiresDrawerRefresh=false;updateLibraryNavLinks(pageElem);});document.querySelector('.mainDrawerPanel #drawer').classList.add('verticalScrollingDrawer');}
function onMainDrawerClosed(){document.body.classList.remove('bodyWithPopupOpen');document.querySelector('.mainDrawerPanel #drawer').classList.remove('verticalScrollingDrawer');}
function closeMainDrawer(){document.getElementsByClassName('mainDrawerPanel')[0].closeDrawer();}
function ensureDrawerStructure(drawer){if(drawer.querySelector('.mainDrawerContent')){return;}
var html='<div class="mainDrawerContent">';html+='<div class="userheader">';html+='</div>';html+='<div class="libraryDrawerContent">';html+='</div>';html+='<div class="dashboardDrawerContent">';html+='</div>';html+='<div class="userFooter">';html+='</div>';html+='</div>';drawer.innerHTML=html;}
function refreshUserInfoInDrawer(user,drawer){var html='';var userAtTop=showUserAtTop();var homeHref=window.ApiClient?'index.html':'selectserver.html';var hasUserImage=user.imageUrl&&AppInfo.enableUserImage;if(userAtTop){html+='<div class="drawerUserPanel">';html+='<div class="drawerUserPanelInner">';html+='<div class="drawerUserPanelContent">';var imgWidth=60;if(hasUserImage){var url=user.imageUrl;if(user.supportsImageParams){url+="&width="+(imgWidth*Math.max(devicePixelRatio||1,2));html+='<div class="lazy drawerUserPanelUserImage" data-src="'+url+'" style="width:'+imgWidth+'px;height:'+imgWidth+'px;"></div>';}}else{html+='<div class="fa fa-user drawerUserPanelUserImage" style="font-size:'+imgWidth+'px;"></div>';}
html+='<div class="drawerUserPanelUserName">';html+=user.name;html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='<a class="sidebarLink lnkMediaFolder" data-itemid="remote" href="index.html" onclick="return LibraryMenu.onLinkClicked(this);"><iron-icon icon="home" class="sidebarLinkIcon" style="color:#2196F3;"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonHome')+'</span></a>';}else{html+='<div style="margin-top:5px;"></div>';html+='<a class="lnkMediaFolder sidebarLink" href="'+homeHref+'" onclick="return LibraryMenu.onLinkClicked(this);">';html+='<div style="background-image:url(\'css/images/mblogoicon.png\');width:'+28+'px;height:'+28+'px;background-size:contain;background-repeat:no-repeat;background-position:center center;border-radius:1000px;vertical-align:middle;margin:0 1.6em 0 1.5em;display:inline-block;"></div>';html+=Globalize.translate('ButtonHome');html+='</a>';}
html+='<a class="sidebarLink lnkMediaFolder" data-itemid="remote" href="nowplaying.html" onclick="return LibraryMenu.onLinkClicked(this);"><iron-icon icon="tablet-android" class="sidebarLinkIcon" style="color:#673AB7;"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonRemote')+'</span></a>';var userHeader=drawer.querySelector('.userheader');userHeader.innerHTML=html;ImageLoader.fillImages(userHeader.getElementsByClassName('lazy'));}
function refreshLibraryInfoInDrawer(user,drawer){var html='';html+='<div class="sidebarDivider"></div>';html+='<div class="libraryMenuOptions">';html+='</div>';drawer.querySelector('.libraryDrawerContent').innerHTML=html;}
function refreshDashboardInfoInDrawer(page,user,drawer){var html='';html+='<div class="sidebarDivider"></div>';html+=Dashboard.getToolsMenuHtml(page);html=html.split('href=').join('onclick="return LibraryMenu.onLinkClicked(this);" href=');drawer.querySelector('.dashboardDrawerContent').innerHTML=html;}
function replaceAll(string,find,replace){return string.replace(new RegExp(escapeRegExp(find),'g'),replace);}
function refreshBottomUserInfoInDrawer(user,drawer){var html='';html+='<div class="adminMenuOptions">';html+='<div class="sidebarDivider"></div>';html+='<div class="sidebarHeader">';html+=Globalize.translate('HeaderAdmin');html+='</div>';html+='<a class="sidebarLink lnkMediaFolder lnkManageServer" data-itemid="dashboard" href="#"><iron-icon icon="dashboard" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonManageServer')+'</span></a>';html+='<a class="sidebarLink lnkMediaFolder editorViewMenu" data-itemid="editor" onclick="return LibraryMenu.onLinkClicked(this);" href="edititemmetadata.html"><iron-icon icon="mode-edit" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonMetadataManager')+'</span></a>';if(!$.browser.mobile&&!AppInfo.isTouchPreferred){html+='<a class="sidebarLink lnkMediaFolder" data-itemid="reports" onclick="return LibraryMenu.onLinkClicked(this);" href="reports.html"><iron-icon icon="insert-chart" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonReports')+'</span></a>';}
html+='</div>';html+='<div class="userMenuOptions">';html+='<div class="sidebarDivider"></div>';html+='<a class="sidebarLink lnkMediaFolder" data-itemid="inbox" onclick="return LibraryMenu.onLinkClicked(this);" href="notificationlist.html"><iron-icon icon="inbox" class="sidebarLinkIcon"></iron-icon>';html+=Globalize.translate('ButtonInbox');html+='<div class="btnNotifications"><div class="btnNotificationsInner">0</div></div>';html+='</a>';if(user.localUser&&showUserAtTop()){html+='<a class="sidebarLink lnkMediaFolder lnkMySettings" onclick="return LibraryMenu.onLinkClicked(this);" data-itemid="mysync" href="mypreferencesdisplay.html?userId='+user.localUser.Id+'"><iron-icon icon="settings" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonSettings')+'</span></a>';}
html+='<a class="sidebarLink lnkMediaFolder lnkMySync" data-itemid="mysync" onclick="return LibraryMenu.onLinkClicked(this);" href="mysync.html"><iron-icon icon="refresh" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonSync')+'</span></a>';if(Dashboard.isConnectMode()){html+='<a class="sidebarLink lnkMediaFolder" data-itemid="selectserver" onclick="return LibraryMenu.onLinkClicked(this);" href="selectserver.html"><span class="fa fa-globe sidebarLinkIcon"></span><span class="sidebarLinkText">'+Globalize.translate('ButtonSelectServer')+'</span></a>';}
if(showUserAtTop()){html+='<a class="sidebarLink lnkMediaFolder" data-itemid="logout" onclick="return LibraryMenu.onLogoutClicked(this);" href="#"><iron-icon icon="lock" class="sidebarLinkIcon"></iron-icon><span class="sidebarLinkText">'+Globalize.translate('ButtonSignOut')+'</span></a>';}
html+='</div>';drawer.querySelector('.userFooter').innerHTML=html;Events.on(drawer.querySelector('.lnkManageServer'),'click',onManageServerClicked);}
function onSidebarLinkClick(){var section=this.getElementsByClassName('sectionName')[0];var text=section?section.innerHTML:this.innerHTML;document.querySelector('.libraryMenuButtonText').innerHTML=text;}
function updateLibraryMenu(user){if(!user){$('.adminMenuOptions').visible(false);$('.lnkMySync').visible(false);$('.userMenuOptions').visible(false);return;}
var userId=Dashboard.getCurrentUserId();var apiClient=window.ApiClient;apiClient.getUserViews(userId).done(function(result){var items=result.Items;var html='';html+='<div class="sidebarHeader">';html+=Globalize.translate('HeaderMedia');html+='</div>';html+=items.map(function(i){var icon='folder';var color='inherit';var itemId=i.Id;if(i.CollectionType=="channels"){itemId="channels";}
else if(i.CollectionType=="livetv"){itemId="livetv";}
if(i.Type=='Channel'){}
if(i.CollectionType=="photos"){icon='photo-library';color="#009688";}
else if(i.CollectionType=="music"||i.CollectionType=="musicvideos"){icon='library-music';color='#FB8521';}
else if(i.CollectionType=="books"){icon='library-books';color="#1AA1E1";}
else if(i.CollectionType=="playlists"){icon='view-list';color="#795548";}
else if(i.CollectionType=="games"){icon='games';color="#F44336";}
else if(i.CollectionType=="movies"){icon='video-library';color='#CE5043';}
else if(i.CollectionType=="channels"||i.Type=='Channel'){icon='videocam';color='#E91E63';}
else if(i.CollectionType=="tvshows"){icon='tv';color="#4CAF50";}
else if(i.CollectionType=="livetv"){icon='live-tv';color="#293AAE";}
return'<a data-itemid="'+itemId+'" class="lnkMediaFolder sidebarLink" onclick="return LibraryMenu.onLinkClicked(this);" href="'+getItemHref(i,i.CollectionType)+'"><iron-icon icon="'+icon+'" class="sidebarLinkIcon" style="color:'+color+'"></iron-icon><span class="sectionName">'+i.Name+'</span></a>';}).join('');var libraryMenuOptions=document.querySelector('.libraryMenuOptions');libraryMenuOptions.innerHTML=html;var elem=libraryMenuOptions;$('.sidebarLink',elem).off('click',onSidebarLinkClick).on('click',onSidebarLinkClick);});if(user.Policy.IsAdministrator){$('.adminMenuOptions').visible(true);}else{$('.adminMenuOptions').visible(false);}
if(user.Policy.EnableSync){$('.lnkMySync').visible(true);}else{$('.lnkMySync').visible(false);}}
function showUserAtTop(){return $.browser.mobile||AppInfo.isNativeApp;}
var requiresLibraryMenuRefresh=false;var requiresViewMenuRefresh=false;function onManageServerClicked(){closeMainDrawer();requirejs(["scripts/registrationservices"],function(){RegistrationServices.validateFeature('manageserver').done(function(){Dashboard.navigate('dashboard.html');});});}
function setLibraryMenuText(text){document.querySelector('.libraryMenuButtonText').innerHTML='<span>'+text+'</span>';}
function getTopParentId(){return getParameterByName('topParentId')||null;}
window.LibraryMenu={getTopParentId:getTopParentId,setText:setLibraryMenuText,onLinkClicked:function(link){if((new Date().getTime()-lastOpenTime)>200){setTimeout(function(){closeMainDrawer();setTimeout(function(){Dashboard.navigate(link.href);},350);},50);}
return false;},onLogoutClicked:function(){if((new Date().getTime()-lastOpenTime)>200){closeMainDrawer();setTimeout(function(){Dashboard.logout();},350);}
return false;}};function updateCastIcon(){var info=MediaController.getPlayerInfo();if(info.isLocalPlayer){$('.btnCast').removeClass('btnActiveCast').each(function(){this.icon='cast';});$('.nowPlayingSelectedPlayer').html('');}else{$('.btnCast').addClass('btnActiveCast').each(function(){this.icon='cast-connected';});$('.nowPlayingSelectedPlayer').html((info.deviceName||info.name));}}
function updateLibraryNavLinks(page){var isLiveTvPage=page.classList.contains('liveTvPage');var isChannelsPage=page.classList.contains('channelsPage');var isEditorPage=page.classList.contains('metadataEditorPage');var isReportsPage=page.classList.contains('reportsPage');var isMySyncPage=page.classList.contains('mySyncPage');var id=isLiveTvPage||isChannelsPage||isEditorPage||isReportsPage||isMySyncPage||page.classList.contains('allLibraryPage')?'':getTopParentId()||'';var i,length;var elems=document.getElementsByClassName('lnkMediaFolder');for(i=0,length=elems.length;i<length;i++){var lnkMediaFolder=elems[i];var itemId=lnkMediaFolder.getAttribute('data-itemid');if(isChannelsPage&&itemId=='channels'){lnkMediaFolder.classList.add('selectedMediaFolder');}
else if(isLiveTvPage&&itemId=='livetv'){lnkMediaFolder.classList.add('selectedMediaFolder');}
else if(isEditorPage&&itemId=='editor'){lnkMediaFolder.classList.add('selectedMediaFolder');}
else if(isReportsPage&&itemId=='reports'){lnkMediaFolder.classList.add('selectedMediaFolder');}
else if(isMySyncPage&&itemId=='mysync'){lnkMediaFolder.classList.add('selectedMediaFolder');}
else if(id&&itemId==id){lnkMediaFolder.classList.add('selectedMediaFolder');}
else{lnkMediaFolder.classList.remove('selectedMediaFolder');}}
var context=getParameterByName('context');if(context!=='playlists'){elems=page.querySelectorAll('.scopedLibraryViewNav a');for(i=0,length=elems.length;i<length;i++){var lnk=elems[i];var src=lnk.href;if(src.indexOf('#')!=-1){continue;}
src=replaceQueryString(src,'topParentId',id);lnk.href=src;}}}
function updateContextText(page){var name=page.getAttribute('data-contextname');if(name){document.querySelector('.libraryMenuButtonText').innerHTML='<span>'+name+'</span>';}
else if(page.classList.contains('allLibraryPage')||page.classList.contains('type-interior')){document.querySelector('.libraryMenuButtonText').innerHTML=Globalize.translate('ButtonHome');}}
function onWebSocketMessage(e,data){var msg=data;if(msg.MessageType==="UserConfigurationUpdated"){if(msg.Data.Id==Dashboard.getCurrentUserId()){requiresLibraryMenuRefresh=true;}}}
function buildViewMenuBar(page){if(page.classList.contains('standalonePage')){$('.viewMenuBar').visible(false);return;}
var viewMenuBar=document.querySelector('.viewMenuBar');if(requiresViewMenuRefresh){if(viewMenuBar){$(viewMenuBar).remove();viewMenuBar=null;}}
if(!viewMenuBar){renderHeader();updateViewMenuBarHeadroom(page,document.querySelector('.viewMenuBar'));updateCastIcon();updateLibraryNavLinks(page);updateContextText(page);requiresViewMenuRefresh=false;ConnectionManager.user(window.ApiClient).done(addUserToHeader);}else{$(viewMenuBar).visible(true);updateContextText(page);updateLibraryNavLinks(page);updateViewMenuBarHeadroom(page,viewMenuBar);requiresViewMenuRefresh=false;}}
var updateViewMenuBarBeforePageShow=false;$(document).on('pagebeforeshowready',".page",function(){var page=this;requiresDashboardDrawerRefresh=true;if(updateViewMenuBarBeforePageShow){onPageBeforeShowDocumentReady(page);}}).one('pageshowready',".page",function(){var page=this;$(function(){onPageBeforeShowDocumentReady(page);updateViewMenuBarBeforePageShow=true;});}).on('pageshowready',".page",function(){var page=this;onPageShowDocumentReady(page);}).on('pagebeforehide',".page",function(){if(addNextToBackStack){var text=$('.libraryMenuButtonText').text()||document.title;backStack.push(text);}
addNextToBackStack=true;$('.headroomEnabled').addClass('headroomDisabled');});function onPageBeforeShowDocumentReady(page){buildViewMenuBar(page);var isLibraryPage=page.classList.contains('libraryPage');var darkDrawer=false;if(isLibraryPage){document.body.classList.add('libraryDocument');document.body.classList.remove('dashboardDocument');document.body.classList.remove('hideMainDrawer');if(AppInfo.enableBottomTabs){page.classList.add('noSecondaryNavPage');$(function(){document.querySelector('.footer').classList.add('footerOverBottomTabs');});}else{$('.libraryViewNav',page).each(function(){initHeadRoom(this);});}
if(!$.browser.mobile){darkDrawer=true;}}
else if(page.classList.contains('type-interior')){document.body.classList.remove('libraryDocument');document.body.classList.add('dashboardDocument');document.body.classList.remove('hideMainDrawer');}else{document.body.classList.remove('libraryDocument');document.body.classList.remove('dashboardDocument');document.body.classList.add('hideMainDrawer');}
if(darkDrawer){document.querySelector('.mainDrawerPanel #drawer').classList.add('darkDrawer');}else{document.querySelector('.mainDrawerPanel #drawer').classList.remove('darkDrawer');}
if(AppInfo.enableBackButton){updateBackButton(page);}}
function updateBackButton(page){var canGoBack=backStack.length>0&&!page.classList.contains('homePage');$('.headerBackButton').visible(canGoBack);Events.off(page,'swiperight',onPageSwipeLeft);if(canGoBack){}}
function onPageSwipeLeft(e){var target=e.target;if(!target.classList.contains('hiddenScrollX')&&!$(target).parents('.hiddenScrollX').length){history.back();}}
function onPageShowDocumentReady(page){var elems=page.querySelectorAll('.libraryViewNav .ui-btn-active');elems=$(elems).filter(':visible');if(elems.length){elems[0].scrollIntoView();window.scrollTo(0,0);}}
function initHeadRoom(elem){if(!AppInfo.enableHeadRoom){return;}
requirejs(["thirdparty/headroom"],function(){var headroom=new Headroom(elem,{tolerance:{down:40,up:0}});headroom.init();elem.classList.add('headroomEnabled');});}
function initializeApiClient(apiClient){requiresLibraryMenuRefresh=true;Events.off(apiClient,'websocketmessage',onWebSocketMessage);Events.on(apiClient,'websocketmessage',onWebSocketMessage);}
Dashboard.ready(function(){if(window.ApiClient){initializeApiClient(window.ApiClient);}
Events.on(ConnectionManager,'apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});Events.on(ConnectionManager,'localusersignedin',function(){requiresLibraryMenuRefresh=true;requiresViewMenuRefresh=true;requiresDrawerRefresh=true;});Events.on(ConnectionManager,'localusersignedout',function(){requiresLibraryMenuRefresh=true;requiresViewMenuRefresh=true;requiresDrawerRefresh=true;});Events.on(MediaController,'playerchange',function(){updateCastIcon();});var mainDrawerPanel=document.querySelector('.mainDrawerPanel');Events.on(mainDrawerPanel,'paper-drawer-panel-open',onMainDrawerOpened);Events.on(mainDrawerPanel,'paper-drawer-panel-close',onMainDrawerClosed);});})(window,document,jQuery,window.devicePixelRatio);$.fn.createHoverTouch=function(){var preventHover=false;var timerId;function startTimer(elem){stopTimer();timerId=setTimeout(function(){Events.trigger(elem,'hovertouch');},300);}
function stopTimer(elem){if(timerId){clearTimeout(timerId);timerId=null;}}
return $(this).on('mouseenter',function(){if(preventHover===true){preventHover=false;return;}
startTimer(this);}).on('mouseleave',function(){stopTimer(this);}).on('touchstart',function(){preventHover=true;}).on('click',function(){preventHover=true;if(preventHover){Events.trigger(this,'hovertouch');stopTimer(this);preventHover=false;}});};(function($,window){function setMirrorModeEnabled(enabled){var val=enabled?'1':'0';appStorage.setItem('displaymirror--'+Dashboard.getCurrentUserId(),val);}
function isMirrorModeEnabled(){return(appStorage.getItem('displaymirror--'+Dashboard.getCurrentUserId())||'')!='0';}
var currentDisplayInfo;function mirrorItem(info){var item=info.item;MediaController.getCurrentPlayer().displayContent({ItemName:item.Name,ItemId:item.Id,ItemType:item.Type,Context:info.context});}
function mirrorIfEnabled(info){if(isMirrorModeEnabled()){var player=MediaController.getPlayerInfo();if(!player.isLocalPlayer&&player.supportedCommands.indexOf('DisplayContent')!=-1){mirrorItem(info);}}}
function monitorPlayer(player){Events.on(player,'playbackstart',function(e,state){var info={QueueableMediaTypes:state.NowPlayingItem.MediaType,ItemId:state.NowPlayingItem.Id,NowPlayingItem:state.NowPlayingItem};info=$.extend(info,state.PlayState);ApiClient.reportPlaybackStart(info);});Events.on(player,'playbackstop',function(e,state){var stopInfo={itemId:state.NowPlayingItem.Id,mediaSourceId:state.PlayState.MediaSourceId,positionTicks:state.PlayState.PositionTicks};if(state.PlayState.LiveStreamId){stopInfo.LiveStreamId=state.PlayState.LiveStreamId;}
if(state.PlayState.PlaySessionId){stopInfo.PlaySessionId=state.PlayState.PlaySessionId;}
ApiClient.reportPlaybackStopped(stopInfo);});}
function getTargetsHtml(targets){var playerInfo=MediaController.getPlayerInfo();var html='';html+='<form>';html+='<h3>'+Globalize.translate('HeaderSelectPlayer')+'</h3>';html+='<fieldset data-role="controlgroup" data-mini="true">';var checkedHtml;for(var i=0,length=targets.length;i<length;i++){var target=targets[i];var id='radioPlayerTarget'+i;var isChecked=target.id==playerInfo.id;checkedHtml=isChecked?' checked="checked"':'';var mirror=(!target.isLocalPlayer&&target.supportedCommands.indexOf('DisplayContent')!=-1)?'true':'false';html+='<input type="radio" class="radioSelectPlayerTarget" name="radioSelectPlayerTarget" data-mirror="'+mirror+'" data-commands="'+target.supportedCommands.join(',')+'" data-mediatypes="'+target.playableMediaTypes.join(',')+'" data-playername="'+target.playerName+'" data-targetid="'+target.id+'" data-targetname="'+target.name+'" data-devicename="'+(target.deviceName||'')+'" id="'+id+'" value="'+target.id+'"'+checkedHtml+'>';html+='<label for="'+id+'" style="font-weight:normal;">'+target.name;if(target.appName&&target.appName!=target.name){html+='<br/><span>'+target.appName+'</span>';}
html+='</label>';}
html+='</fieldset>';html+='<p class="fieldDescription">'+Globalize.translate('LabelAllPlaysSentToPlayer')+'</p>';checkedHtml=isMirrorModeEnabled()?' checked="checked"':'';html+='<div style="margin-top:1.5em;" class="fldMirrorMode"><label for="chkEnableMirrorMode">Enable display mirroring</label><input type="checkbox" class="chkEnableMirrorMode" id="chkEnableMirrorMode" data-mini="true"'+checkedHtml+' /></div>';html+='</form>';return html;}
function showPlayerSelection(){var promise=MediaController.getTargets();var html='<div data-role="panel" data-position="right" data-display="overlay" data-position-fixed="true" id="playerSelectionPanel" data-theme="a">';html+='<div class="players"></div>';html+='<br/>';html+='<p><a href="nowplaying.html" class="clearLink"><paper-button raised class="block"><iron-icon icon="tablet-android"></iron-icon><span>'+Globalize.translate('ButtonRemoteControl')+'</span></paper-button></a></p>';html+='</div>';$(document.body).append(html);require(['jqmicons']);var elem=$('#playerSelectionPanel').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});promise.done(function(targets){$('.players',elem).html(getTargetsHtml(targets)).trigger('create');$('.chkEnableMirrorMode',elem).on('change',function(){setMirrorModeEnabled(this.checked);if(this.checked&&currentDisplayInfo){mirrorItem(currentDisplayInfo);}});$('.radioSelectPlayerTarget',elem).off('change').on('change',function(){var supportsMirror=this.getAttribute('data-mirror')=='true';if(supportsMirror){$('.fldMirrorMode',elem).show();}else{$('.fldMirrorMode',elem).hide();}
var playerName=this.getAttribute('data-playername');var targetId=this.getAttribute('data-targetid');var targetName=this.getAttribute('data-targetname');var deviceName=this.getAttribute('data-deviceName');var playableMediaTypes=this.getAttribute('data-mediatypes').split(',');var supportedCommands=this.getAttribute('data-commands').split(',');MediaController.trySetActivePlayer(playerName,{id:targetId,name:targetName,playableMediaTypes:playableMediaTypes,supportedCommands:supportedCommands,deviceName:deviceName});if(currentDisplayInfo){mirrorIfEnabled(currentDisplayInfo);}});if($('.radioSelectPlayerTarget:checked',elem)[0].getAttribute('data-mirror')=='true'){$('.fldMirrorMode',elem).show();}else{$('.fldMirrorMode',elem).hide();}});}
function bindKeys(controller){var self=this;var keyResult={};self.keyBinding=function(e){if(bypass())return;Logger.log("keyCode",e.keyCode);if(keyResult[e.keyCode]){e.preventDefault();keyResult[e.keyCode](e);}};self.keyPrevent=function(e){if(bypass())return;var codes=[32,38,40,37,39,81,77,65,84,83,70];if(codes.indexOf(e.keyCode)!=-1){e.preventDefault();}};keyResult[32]=function(){var player=controller.getCurrentPlayer();player.getPlayerState().done(function(result){var state=result;if(state.NowPlayingItem&&state.PlayState){if(state.PlayState.IsPaused){player.unpause();}else{player.pause();}}});};var bypass=function(){var active=document.activeElement;var type=active.type||active.tagName.toLowerCase();return(type==="text"||type==="select"||type==="textarea"||type=="password");};}
function mediaController(){var self=this;var currentPlayer;var currentTargetInfo;var players=[];var keys=new bindKeys(self);$(window).on("keydown",keys.keyBinding).on("keypress",keys.keyPrevent).on("keyup",keys.keyPrevent);self.registerPlayer=function(player){players.push(player);if(player.isLocalPlayer){monitorPlayer(player);}};self.getPlayerInfo=function(){return{name:currentPlayer.name,isLocalPlayer:currentPlayer.isLocalPlayer,id:currentTargetInfo.id,deviceName:currentTargetInfo.deviceName,playableMediaTypes:currentTargetInfo.playableMediaTypes,supportedCommands:currentTargetInfo.supportedCommands};};function triggerPlayerChange(newPlayer,newTarget){$(self).trigger('playerchange',[newPlayer,newTarget]);}
self.setActivePlayer=function(player,targetInfo){if(typeof(player)==='string'){player=players.filter(function(p){return p.name==player;})[0];}
if(!player){throw new Error('null player');}
currentPairingId=null;currentPlayer=player;currentTargetInfo=targetInfo;Logger.log('Active player: '+JSON.stringify(currentTargetInfo));triggerPlayerChange(player,targetInfo);};var currentPairingId=null;self.trySetActivePlayer=function(player,targetInfo){if(typeof(player)==='string'){player=players.filter(function(p){return p.name==player;})[0];}
if(!player){throw new Error('null player');}
if(currentPairingId==targetInfo.id){return;}
currentPairingId=targetInfo.id;player.tryPair(targetInfo).done(function(){currentPlayer=player;currentTargetInfo=targetInfo;Logger.log('Active player: '+JSON.stringify(currentTargetInfo));triggerPlayerChange(player,targetInfo);});};self.setDefaultPlayerActive=function(){var player=self.getDefaultPlayer();var target=player.getTargets()[0];self.setActivePlayer(player,target);};self.removeActivePlayer=function(name){if(self.getPlayerInfo().name==name){self.setDefaultPlayerActive();}};self.removeActiveTarget=function(id){if(self.getPlayerInfo().id==id){self.setDefaultPlayerActive();}};self.getPlayers=function(){return players;};self.getTargets=function(){var deferred=$.Deferred();var promises=players.map(function(p){return p.getTargets();});$.when.apply($,promises).done(function(){var targets=[];for(var i=0;i<arguments.length;i++){var subTargets=arguments[i];for(var j=0;j<subTargets.length;j++){targets.push(subTargets[j]);}}
targets=targets.sort(function(a,b){var aVal=a.isLocalPlayer?0:1;var bVal=b.isLocalPlayer?0:1;aVal=aVal.toString()+a.name;bVal=bVal.toString()+b.name;return aVal.localeCompare(bVal);});deferred.resolveWith(null,[targets]);});return deferred.promise();};function doWithPlaybackValidation(fn){requirejs(["scripts/registrationservices"],function(){RegistrationServices.validateFeature('playback').done(fn);});}
self.play=function(options){doWithPlaybackValidation(function(){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.play(options);});};self.shuffle=function(id){doWithPlaybackValidation(function(){currentPlayer.shuffle(id);});};self.instantMix=function(id){doWithPlaybackValidation(function(){currentPlayer.instantMix(id);});};self.queue=function(options){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.queue(options);};self.queueNext=function(options){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.queueNext(options);};self.canPlay=function(item){return self.canPlayByAttributes(item.Type,item.MediaType,item.PlayAccess,item.LocationType);};self.canPlayByAttributes=function(itemType,mediaType,playAccess,locationType){if(playAccess!='Full'){return false;}
if(locationType=="Virtual"){return false;}
if(itemType=="Program"){return false;}
if(itemType=="MusicGenre"||itemType=="Season"||itemType=="Series"||itemType=="BoxSet"||itemType=="MusicAlbum"||itemType=="MusicArtist"||itemType=="Playlist"){return true;}
return self.getPlayerInfo().playableMediaTypes.indexOf(mediaType)!=-1;};self.canQueueMediaType=function(mediaType,itemType){if(itemType=='MusicAlbum'||itemType=='MusicArtist'||itemType=='MusicGenre'){mediaType='Audio';}
return currentPlayer.canQueueMediaType(mediaType);};self.getLocalPlayer=function(){return currentPlayer.isLocalPlayer?currentPlayer:players.filter(function(p){return p.isLocalPlayer;})[0];};self.getDefaultPlayer=function(){return currentPlayer.isLocalPlayer?currentPlayer:players.filter(function(p){return p.isDefaultPlayer;})[0];};self.getCurrentPlayer=function(){return currentPlayer;};self.pause=function(){currentPlayer.pause();};self.stop=function(){currentPlayer.stop();};self.unpause=function(){currentPlayer.unpause();};self.seek=function(position){currentPlayer.seek(position);};self.currentPlaylistIndex=function(i){currentPlayer.currentPlaylistIndex(i);};self.removeFromPlaylist=function(i){currentPlayer.removeFromPlaylist(i);};self.nextTrack=function(){currentPlayer.nextTrack();};self.previousTrack=function(){currentPlayer.previousTrack();};self.mute=function(){currentPlayer.mute();};self.unMute=function(){currentPlayer.unMute();};self.toggleMute=function(){currentPlayer.toggleMute();};self.volumeDown=function(){currentPlayer.volumeDown();};self.volumeUp=function(){currentPlayer.volumeUp();};self.playlist=function(){return currentPlayer.playlist||[];};self.sendCommand=function(cmd,player){player=player||self.getLocalPlayer();Logger.log('MediaController received command: '+cmd.Name);switch(cmd.Name){case'VolumeUp':player.volumeUp();break;case'VolumeDown':player.volumeDown();break;case'Mute':player.mute();break;case'Unmute':player.unMute();break;case'ToggleMute':player.toggleMute();break;case'SetVolume':player.setVolume(cmd.Arguments.Volume);break;case'SetAudioStreamIndex':player.setAudioStreamIndex(parseInt(cmd.Arguments.Index));break;case'SetSubtitleStreamIndex':player.setSubtitleStreamIndex(parseInt(cmd.Arguments.Index));break;case'ToggleFullscreen':player.toggleFullscreen();break;default:{if(player.isLocalPlayer){Dashboard.processGeneralCommand(cmd);}else{player.sendCommand(cmd);}
break;}}};self.getNowPlayingNameHtml=function(nowPlayingItem,includeNonNameInfo){var topText=nowPlayingItem.Name;if(nowPlayingItem.MediaType=='Video'){if(nowPlayingItem.IndexNumber!=null){topText=nowPlayingItem.IndexNumber+" - "+topText;}
if(nowPlayingItem.ParentIndexNumber!=null){topText=nowPlayingItem.ParentIndexNumber+"."+topText;}}
var bottomText='';if(nowPlayingItem.Artists&&nowPlayingItem.Artists.length){bottomText=topText;topText=nowPlayingItem.Artists[0];}
else if(nowPlayingItem.SeriesName||nowPlayingItem.Album){bottomText=topText;topText=nowPlayingItem.SeriesName||nowPlayingItem.Album;}
else if(nowPlayingItem.ProductionYear&&includeNonNameInfo!==false){bottomText=nowPlayingItem.ProductionYear;}
return bottomText?topText+'<br/>'+bottomText:topText;};self.showPlaybackInfoErrorMessage=function(errorCode){setTimeout(function(){Dashboard.alert({message:Globalize.translate('MessagePlaybackError'+errorCode),title:Globalize.translate('HeaderPlaybackError')});},300);};function getPlaybackInfoFromLocalMediaSource(itemId,deviceProfile,startPosition,mediaSource){mediaSource.SupportsDirectPlay=true;return{MediaSources:[mediaSource],PlaySessionId:new Date().getTime().toString()};}
self.getPlaybackInfo=function(itemId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId){var deferred=DeferredBuilder.Deferred();require(['localassetmanager'],function(){var serverInfo=ApiClient.serverInfo();if(serverInfo.Id){var localMediaSource=window.LocalAssetManager.getLocalMediaSource(serverInfo.Id,itemId);if(localMediaSource&&(!mediaSource||mediaSource.Id==localMediaSource.Id)){var playbackInfo=getPlaybackInfoFromLocalMediaSource(itemId,deviceProfile,startPosition,localMediaSource);deferred.resolveWith(null,[playbackInfo]);return;}}
self.getPlaybackInfoInternal(itemId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});});return deferred.promise();}
self.getPlaybackInfoInternal=function(itemId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId){var postData={DeviceProfile:deviceProfile};var query={UserId:Dashboard.getCurrentUserId(),StartTimeTicks:startPosition||0};if(audioStreamIndex!=null){query.AudioStreamIndex=audioStreamIndex;}
if(subtitleStreamIndex!=null){query.SubtitleStreamIndex=subtitleStreamIndex;}
if(mediaSource){query.MediaSourceId=mediaSource.Id;}
if(liveStreamId){query.LiveStreamId=liveStreamId;}
return ApiClient.ajax({url:ApiClient.getUrl('Items/'+itemId+'/PlaybackInfo',query),type:'POST',data:JSON.stringify(postData),contentType:"application/json",dataType:"json"});}
self.getLiveStream=function(itemId,playSessionId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex){var postData={DeviceProfile:deviceProfile,OpenToken:mediaSource.OpenToken};var query={UserId:Dashboard.getCurrentUserId(),StartTimeTicks:startPosition||0,ItemId:itemId,PlaySessionId:playSessionId};if(audioStreamIndex!=null){query.AudioStreamIndex=audioStreamIndex;}
if(subtitleStreamIndex!=null){query.SubtitleStreamIndex=subtitleStreamIndex;}
return ApiClient.ajax({url:ApiClient.getUrl('LiveStreams/Open',query),type:'POST',data:JSON.stringify(postData),contentType:"application/json",dataType:"json"});};self.supportsDirectPlay=function(mediaSource){if(mediaSource.SupportsDirectPlay&&mediaSource.Protocol=='Http'&&!mediaSource.RequiredHttpHeaders.length){return true;}
if(mediaSource.SupportsDirectPlay&&mediaSource.Protocol=='File'){return FileSystemBridge.fileExists(mediaSource.Path);}
return false;};self.showPlayerSelection=showPlayerSelection;}
window.MediaController=new mediaController();function onWebSocketMessageReceived(e,msg){var localPlayer;if(msg.MessageType==="Play"){localPlayer=MediaController.getLocalPlayer();if(msg.Data.PlayCommand=="PlayNext"){localPlayer.queueNext({ids:msg.Data.ItemIds});}
else if(msg.Data.PlayCommand=="PlayLast"){localPlayer.queue({ids:msg.Data.ItemIds});}
else{localPlayer.play({ids:msg.Data.ItemIds,startPositionTicks:msg.Data.StartPositionTicks});}}
else if(msg.MessageType==="ServerShuttingDown"){MediaController.setDefaultPlayerActive();}
else if(msg.MessageType==="ServerRestarting"){MediaController.setDefaultPlayerActive();}
else if(msg.MessageType==="Playstate"){localPlayer=MediaController.getLocalPlayer();if(msg.Data.Command==='Stop'){localPlayer.stop();}
else if(msg.Data.Command==='Pause'){localPlayer.pause();}
else if(msg.Data.Command==='Unpause'){localPlayer.unpause();}
else if(msg.Data.Command==='Seek'){localPlayer.seek(msg.Data.SeekPositionTicks);}
else if(msg.Data.Command==='NextTrack'){localPlayer.nextTrack();}
else if(msg.Data.Command==='PreviousTrack'){localPlayer.previousTrack();}}
else if(msg.MessageType==="GeneralCommand"){var cmd=msg.Data;localPlayer=MediaController.getLocalPlayer();MediaController.sendCommand(cmd,localPlayer);}}
function initializeApiClient(apiClient){$(apiClient).off("websocketmessage",onWebSocketMessageReceived).on("websocketmessage",onWebSocketMessageReceived);}
Dashboard.ready(function(){if(window.ApiClient){initializeApiClient(window.ApiClient);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});});function onCastButtonClicked(){showPlayerSelection();}
$(document).on('headercreated',function(){$('.btnCast').off('click',onCastButtonClicked).on('click',onCastButtonClicked);}).on('pagebeforeshow',".page",function(){var page=this;currentDisplayInfo=null;}).on('displayingitem',".libraryPage",function(e,info){currentDisplayInfo=info;mirrorIfEnabled(info);});})(jQuery,window);(function($,document){function getElement(){var elem=document.documentElement;elem.classList.add('backdropContainer');return elem;}
function clearBackdrop(){var elem=document.documentElement;elem.classList.remove('backdropContainer');elem.style.backgroundImage='';}
function getRandom(min,max){return Math.floor(Math.random()*(max-min)+min);}
function getBackdropItemIds(apiClient,userId,types,parentId){var key='backdrops2_'+userId+(types||'')+(parentId||'');var deferred=$.Deferred();var data=sessionStore.getItem(key);if(data){Logger.log('Found backdrop id list in cache. Key: '+key)
data=JSON.parse(data);deferred.resolveWith(null,[data]);}else{var options={SortBy:"IsFavoriteOrLiked,Random",Limit:20,Recursive:true,IncludeItemTypes:types,ImageTypes:"Backdrop",ParentId:parentId};apiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var images=result.Items.map(function(i){return{id:i.Id,tag:i.BackdropImageTags[0]};});sessionStore.setItem(key,JSON.stringify(images));deferred.resolveWith(null,[images]);});}
return deferred.promise();}
function setBackdropImage(elem,url){ImageLoader.lazyImage(elem,url);}
function showBackdrop(type,parentId){var apiClient=window.ApiClient;if(!apiClient){return;}
getBackdropItemIds(apiClient,Dashboard.getCurrentUserId(),type,parentId).done(function(images){if(images.length){var index=getRandom(0,images.length-1);var item=images[index];var screenWidth=$(window).width();var imgUrl=apiClient.getScaledImageUrl(item.id,{type:"Backdrop",tag:item.tag,maxWidth:screenWidth,quality:50});setBackdropImage(getElement(),imgUrl);}else{clearBackdrop();}});}
function setDefault(page){getElement().style.backgroundImage="url(css/images/splash.jpg)";page.classList.add('backdropPage');page.classList.add('staticBackdropPage');}
function isEnabledByDefault(){if(AppInfo.hasLowImageBandwidth){return false;}
if($.browser.android&&AppInfo.isNativeApp){return screen.availWidth>=1200;}
if($.browser.mobile){return false;}
return true;}
function enabled(){var userId=Dashboard.getCurrentUserId();var val=appStorage.getItem('enableBackdrops-'+userId);return val=='1'||(val!='0'&&isEnabledByDefault());}
function setBackdrops(page,items){var images=items.filter(function(i){return i.BackdropImageTags.length>0;}).map(function(i){return{id:i.Id,tag:i.BackdropImageTags[0]};});if(images.length){page.classList.add('backdropPage');var index=getRandom(0,images.length-1);var item=images[index];var screenWidth=$(window).width();var imgUrl=ApiClient.getScaledImageUrl(item.id,{type:"Backdrop",tag:item.tag,maxWidth:screenWidth,quality:50});setBackdropImage(getElement(),imgUrl);}else{page.classList.remove('backdropPage');}}
function setBackdropUrl(page,url){if(url){page.classList.add('backdropPage');setBackdropImage(getElement(),url);}else{page.classList.remove('backdropPage');clearBackdrop();}}
Events.on(document,'pagebeforeshowready',".page",function(){var page=this;if(!page.classList.contains('staticBackdropPage')){if(page.classList.contains('backdropPage')){if(enabled()){var type=page.getAttribute('data-backdroptype');var parentId=page.classList.contains('globalBackdropPage')?'':LibraryMenu.getTopParentId();showBackdrop(type,parentId);}else{page.classList.remove('backdropPage');clearBackdrop();}}else{clearBackdrop();}}});window.Backdrops={setBackdrops:setBackdrops,setBackdropUrl:setBackdropUrl,setDefault:setDefault};})(jQuery,document);(function(window,$){var currentDialogOptions;function submitJob(userId,syncOptions,form){if(!userId){throw new Error('userId cannot be null');}
if(!syncOptions){throw new Error('syncOptions cannot be null');}
if(!form){throw new Error('form cannot be null');}
var target=$('#selectSyncTarget',form).val();if(!target){Dashboard.alert(Globalize.translate('MessagePleaseSelectDeviceToSyncTo'));return;}
var options={userId:userId,TargetId:target,ParentId:syncOptions.ParentId,Category:syncOptions.Category};setJobValues(options,form);if(syncOptions.items&&syncOptions.items.length){options.ItemIds=(syncOptions.items||[]).map(function(i){return i.Id||i;}).join(',');}
ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Sync/Jobs"),data:JSON.stringify(options),contentType:"application/json"}).done(function(){$('.syncPanel').panel('close');$(window.SyncManager).trigger('jobsubmit');Dashboard.alert(Globalize.translate('MessageSyncJobCreated'));});}
function setJobValues(job,form){var bitrate=$('#txtBitrate',form).val()||null;if(bitrate){bitrate=parseFloat(bitrate)*1000000;}
job.Name=$('#txtSyncJobName',form).val();job.Quality=$('#selectQuality',form).val()||null;job.Profile=$('#selectProfile',form).val()||null;job.Bitrate=bitrate;job.ItemLimit=$('#txtItemLimit',form).val()||null;job.SyncNewContent=$('#chkSyncNewContent',form).checked();job.UnwatchedOnly=$('#chkUnwatchedOnly',form).checked();}
function renderForm(options){var elem=options.elem;var dialogOptions=options.dialogOptions;var targets=dialogOptions.Targets;var html='';if(options.showName||dialogOptions.Options.indexOf('Name')!=-1){html+='<p>';html+='<label for="txtSyncJobName">'+Globalize.translate('LabelSyncJobName')+'</label>';html+='<input type="text" id="txtSyncJobName" class="txtSyncJobName" required="required" />';html+='</p>';}
html+='<div>';html+='<label for="selectSyncTarget">'+Globalize.translate('LabelSyncTo')+'</label>';if(options.readOnlySyncTarget){html+='<input type="text" id="selectSyncTarget" readonly="readonly" />';}else{html+='<select id="selectSyncTarget" required="required" data-mini="true">';html+=targets.map(function(t){var isSelected=t.Id==AppInfo.deviceId;var selectedHtml=isSelected?' selected="selected"':'';return'<option'+selectedHtml+' value="'+t.Id+'">'+t.Name+'</option>';}).join('');html+='</select>';if(!targets.length){html+='<div class="fieldDescription">'+Globalize.translate('LabelSyncNoTargetsHelp')+'</div>';html+='<div class="fieldDescription"><a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank">'+Globalize.translate('ButtonLearnMore')+'</a></div>';}}
html+='</div>';html+='<div class="fldProfile" style="display:none;">';html+='<br/>';html+='<label for="selectProfile">'+Globalize.translate('LabelProfile')+'</label>';html+='<select id="selectProfile" data-mini="true">';html+='</select>';html+='<div class="fieldDescription profileDescription"></div>';html+='</div>';html+='<div class="fldQuality" style="display:none;">';html+='<br/>';html+='<label for="selectQuality">'+Globalize.translate('LabelQuality')+'</label>';html+='<select id="selectQuality" data-mini="true" required="required">';html+='</select>';html+='<div class="fieldDescription qualityDescription"></div>';html+='</div>';html+='<div class="fldBitrate" style="display:none;">';html+='<br/>';html+='<div>';html+='<label for="txtBitrate">'+Globalize.translate('LabelBitrateMbps')+'</label>';html+='<input type="number" id="txtBitrate" step=".1" min=".1" />';html+='</div>';html+='</div>';if(dialogOptions.Options.indexOf('UnwatchedOnly')!=-1){html+='<br/>';html+='<div>';html+='<label for="chkUnwatchedOnly">'+Globalize.translate('OptionSyncUnwatchedVideosOnly')+'</label>';html+='<input type="checkbox" id="chkUnwatchedOnly" data-mini="true" />';html+='<div class="fieldDescription">'+Globalize.translate('OptionSyncUnwatchedVideosOnlyHelp')+'</div>';html+='</div>';}
if(dialogOptions.Options.indexOf('SyncNewContent')!=-1||dialogOptions.Options.indexOf('ItemLimit')!=-1){html+='<br/>';html+='<div data-role="collapsible" data-mini="true">';html+='<h2>'+Globalize.translate('HeaderAdvanced')+'</h2>';html+='<div style="padding:0 0 1em;">';if(dialogOptions.Options.indexOf('SyncNewContent')!=-1){html+='<br/>';html+='<div>';html+='<label for="chkSyncNewContent">'+Globalize.translate('OptionAutomaticallySyncNewContent')+'</label>';html+='<input type="checkbox" id="chkSyncNewContent" data-mini="true" checked="checked" />';html+='<div class="fieldDescription">'+Globalize.translate('OptionAutomaticallySyncNewContentHelp')+'</div>';html+='</div>';}
if(dialogOptions.Options.indexOf('ItemLimit')!=-1){html+='<br/>';html+='<div>';html+='<label for="txtItemLimit">'+Globalize.translate('LabelItemLimit')+'</label>';html+='<input type="number" id="txtItemLimit" step="1" min="1" />';html+='<div class="fieldDescription">'+Globalize.translate('LabelItemLimitHelp')+'</div>';html+='</div>';}
html+='</div>';html+='</div>';}
$(elem).html(html).trigger('create');$('#selectSyncTarget',elem).on('change',function(){loadQualityOptions(elem,this.value,options.dialogOptionsFn);}).trigger('change');$('#selectProfile',elem).on('change',function(){onProfileChange(elem,this.value);}).trigger('change');$('#selectQuality',elem).on('change',function(){onQualityChange(elem,this.value);}).trigger('change');}
function showSyncMenu(options){var userId=Dashboard.getCurrentUserId();var dialogOptionsQuery={UserId:userId,ItemIds:(options.items||[]).map(function(i){return i.Id||i;}).join(','),ParentId:options.ParentId,Category:options.Category};ApiClient.getJSON(ApiClient.getUrl('Sync/Options',dialogOptionsQuery)).done(function(dialogOptions){currentDialogOptions=dialogOptions;var html='<div data-role="panel" data-position="right" data-display="overlay" class="syncPanel" data-position-fixed="true" data-theme="a">';html+='<div>';html+='<form class="formSubmitSyncRequest">';html+='<div style="margin:1em 0 1.5em;">';html+='<h1 style="margin: 0;display:inline-block;vertical-align:middle;">'+Globalize.translate('SyncMedia')+'</h1>';html+='<a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank" class="clearLink" style="margin-top:0;display:inline-block;vertical-align:middle;margin-left:1em;"><paper-button raised class="secondary mini"><i class="fa fa-info-circle"></i>'+Globalize.translate('ButtonHelp')+'</paper-button></a>';html+='</div>';html+='<div class="formFields"></div>';html+='<p>';html+='<button type="submit" data-role="none" class="clearButton"><paper-button raised class="submit block"><iron-icon icon="refresh"></iron-icon><span>'+Globalize.translate('ButtonSync')+'</span></paper-button></button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';$(document.body).append(html);require(['paperbuttonstyle']);var elem=$('.syncPanel').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});$('form',elem).on('submit',function(){submitJob(userId,options,this);return false;});renderForm({elem:$('.formFields',elem),dialogOptions:dialogOptions,dialogOptionsFn:getTargetDialogOptionsFn(dialogOptionsQuery)});});require(['jqmicons']);}
function getTargetDialogOptionsFn(query){return function(targetId){query.TargetId=targetId;return ApiClient.getJSON(ApiClient.getUrl('Sync/Options',query));};}
function onProfileChange(form,profileId){var options=currentDialogOptions||{};var option=(options.ProfileOptions||[]).filter(function(o){return o.Id==profileId;})[0];if(option){$('.profileDescription',form).html(option.Description||'');setQualityFieldVisible(form,options.QualityOptions.length>0&&option.EnableQualityOptions&&options.Options.indexOf('Quality')!=-1);}else{$('.profileDescription',form).html('');setQualityFieldVisible(form,options.QualityOptions.length>0&&options.Options.indexOf('Quality')!=-1);}}
function onQualityChange(form,qualityId){var options=currentDialogOptions||{};var option=(options.QualityOptions||[]).filter(function(o){return o.Id==qualityId;})[0];if(option){$('.qualityDescription',form).html(option.Description||'');}else{$('.qualityDescription',form).html('');}
if(qualityId=='custom'){$('.fldBitrate',form).show();$('#txtBitrate',form).attr('required','required');}else{$('.fldBitrate',form).hide();$('#txtBitrate',form).removeAttr('required').val('');}}
function loadQualityOptions(form,targetId,dialogOptionsFn){dialogOptionsFn(targetId).done(function(options){renderTargetDialogOptions(form,options);});}
function setQualityFieldVisible(form,visible){if(visible){$('.fldQuality',form).show();$('#selectQuality',form).attr('required','required');}else{$('.fldQuality',form).hide();$('#selectQuality',form).removeAttr('required');}}
function renderTargetDialogOptions(form,options){currentDialogOptions=options;if(options.ProfileOptions.length&&options.Options.indexOf('Profile')!=-1){$('.fldProfile',form).show();$('#selectProfile',form).attr('required','required');}else{$('.fldProfile',form).hide();$('#selectProfile',form).removeAttr('required');}
setQualityFieldVisible(options.QualityOptions.length>0);$('#selectProfile',form).html(options.ProfileOptions.map(function(o){var selectedAttribute=o.IsDefault?' selected="selected"':'';return'<option value="'+o.Id+'"'+selectedAttribute+'>'+o.Name+'</option>';}).join('')).trigger('change').selectmenu('refresh');$('#selectQuality',form).html(options.QualityOptions.map(function(o){var selectedAttribute=o.IsDefault?' selected="selected"':'';return'<option value="'+o.Id+'"'+selectedAttribute+'>'+o.Name+'</option>';}).join('')).trigger('change').selectmenu('refresh');}
function isAvailable(item,user){return item.SupportsSync;}
window.SyncManager={showMenu:showSyncMenu,isAvailable:isAvailable,renderForm:renderForm,setJobValues:setJobValues};function showSyncButtonsPerUser(page){var apiClient=window.ApiClient;if(!apiClient||!apiClient.getCurrentUserId()){return;}
Dashboard.getCurrentUser().done(function(user){$('.categorySyncButton',page).visible(user.Policy.EnableSync);});}
function onCategorySyncButtonClick(page,button){var category=button.getAttribute('data-category');var parentId=LibraryMenu.getTopParentId();SyncManager.showMenu({ParentId:parentId,Category:category});}
$(document).on('pageinitdepends',".libraryPage",function(){var page=this;$('.categorySyncButton',page).on('click',function(){onCategorySyncButtonClick(page,this);});}).on('pageshowready',".libraryPage",function(){var page=this;if(!Dashboard.isServerlessPage()){showSyncButtonsPerUser(page);}});})(window,jQuery);(function($,document){var lastPlaylistId='';function redirectToPlaylist(id){var context=getParameterByName('context');ApiClient.getItem(Dashboard.getCurrentUserId(),id).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,context));});}
function onAddToPlaylistFormSubmit(){Dashboard.showLoadingMsg();var panel=$(this).parents('.newPlaylistPanel');var playlistId=$('select.selectPlaylistToAddTo',panel).val();if(playlistId){lastPlaylistId=playlistId;addToPlaylist(panel,playlistId);}else{createPlaylist(panel);}
return false;}
function getNewPlaylistPanel(){Dashboard.showLoadingMsg();$('.newPlaylistPanel').panel('destroy').remove();var html='<div data-role="panel" data-position="right" data-display="overlay" class="newPlaylistPanel" data-position-fixed="true" data-theme="a">';html+='<h3>'+Globalize.translate('HeaderAddToPlaylist')+'</h3>';html+='<br />';html+='<form class="addToPlaylistForm">';var selectId='selectPlaylistToAddTo'+new Date().getTime();html+='<div>';html+='<label for="'+selectId+'">'+Globalize.translate('LabelSelectPlaylist')+'</label>';html+='<select id="'+selectId+'" class="selectPlaylistToAddTo" data-mini="true">';html+='</select>';html+='</div>';html+='<br />';html+='<div class="fldNewPlaylist" style="display:none;">';html+='<label for="txtNewPlaylistName">'+Globalize.translate('LabelName')+'</label>';html+='<input type="text" id="txtNewPlaylistName" />';html+='</div>';html+='<p>';html+='<input class="fldSelectedItemIds" type="hidden" />';html+='<button type="submit" data-icon="plus" data-mini="true" data-theme="b">'+Globalize.translate('ButtonSubmit')+'</button>';html+='</p>';html+='</form>';html+='</div>';$(document.body).append(html);var elem=$('.newPlaylistPanel').panel({}).trigger('create').on("panelclose",function(){$(this).off("panelclose").remove();});var select=$('#'+selectId,elem).on('change',function(){if(this.value){$('.fldNewPlaylist',elem).hide();$('input',elem).removeAttr('required');}else{$('.fldNewPlaylist',elem).show();$('input',elem).attr('required','required');}}).trigger('change');ApiClient.getItems(Dashboard.getCurrentUserId(),{IncludeItemTypes:'Playlist',recursive:true,SortBy:'SortName'}).done(function(result){var selectHtml='<option value="">'+Globalize.translate('OptionNewPlaylist')+'</option>';selectHtml+=result.Items.map(function(o){return'<option value="'+o.Id+'">'+o.Name+'</option>';}).join('');select.html(selectHtml).selectmenu('refresh');select.val(lastPlaylistId||'').selectmenu('refresh').trigger('change');Dashboard.hideLoadingMsg();});$('form',elem).on('submit',onAddToPlaylistFormSubmit);return elem;}
function showNewPlaylistPanel(items){var panel=getNewPlaylistPanel().panel('toggle');$('.fldSelectedItemIds',panel).val(items.join(','));populatePlaylists(panel);}
function populatePlaylists(panel){var select=$('select.selectPlaylistToAddTo',panel);if(!select.length){$('#txtNewPlaylistName',panel).val('').focus();return;}
$('.newPlaylistInfo',panel).hide();var options={Recursive:true,IncludeItemTypes:"Playlist",SortBy:'SortName'};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var html='';html+='<option value="">'+Globalize.translate('OptionNewPlaylist')+'</option>';html+=result.Items.map(function(i){return'<option value="'+i.Id+'">'+i.Name+'</option>';});select.html(html).val('').selectmenu('refresh').trigger('change');});}
function createPlaylist(panel){var url=ApiClient.getUrl("Playlists",{Name:$('#txtNewPlaylistName',panel).val(),Ids:$('.fldSelectedItemIds',panel).val()||'',userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:url,dataType:"json"}).done(function(result){Dashboard.hideLoadingMsg();var id=result.Id;panel.panel('toggle');redirectToPlaylist(id);});}
function addToPlaylist(panel,id){var url=ApiClient.getUrl("Playlists/"+id+"/Items",{Ids:$('.fldSelectedItemIds',panel).val()||'',userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:url}).done(function(){Dashboard.hideLoadingMsg();panel.panel('toggle');Dashboard.alert(Globalize.translate('MessageAddedToPlaylistSuccess'));});}
window.PlaylistManager={showPanel:function(items){showNewPlaylistPanel(items);},supportsPlaylists:function(item){if(item.Type=='Program'){return false;}
return item.RunTimeTicks||item.IsFolder||item.Type=="Genre"||item.Type=="MusicGenre"||item.Type=="MusicArtist";}};})(jQuery,document);(function(window){function update(key,val){appStorage.setItem(key,val);Events.trigger(AppSettings,'settingupdated',[key]);}
window.AppSettings={maxStreamingBitrate:function(val){if(val!=null){update('preferredVideoBitrate',val);}
return parseInt(appStorage.getItem('preferredVideoBitrate')||'')||1500000;},maxChromecastBitrate:function(val){if(val!=null){update('chromecastBitrate',val);}
return parseInt(appStorage.getItem('chromecastBitrate')||'')||3000000;},enableChromecastAc3:function(val){if(val!=null){update('enablechromecastac3',val.toString());}
return appStorage.getItem('enablechromecastac3')=='true';},enableExternalPlayers:function(val){if(val!=null){update('externalplayers',val.toString());}
return appStorage.getItem('externalplayers')=='true';},enableItemPreviews:function(val){if(val!=null){update('enableItemPreviews',val.toString());}
return appStorage.getItem('enableItemPreviews')=='true';},enableFullScreen:function(val){if(val!=null){update('enableFullScreen',val.toString());}
return appStorage.getItem('enableFullScreen')=='true';},syncPath:function(val){if(val!=null){update('syncPath',val.toString());}
return appStorage.getItem('syncPath');}};})(window);(function(document,setTimeout,clearTimeout,screen,$,setInterval,window){function mediaPlayer(){var self=this;var currentProgressInterval;var canClientSeek;var currentPlaylistIndex=0;self.currentMediaRenderer=null;self.currentItem=null;self.currentMediaSource=null;self.currentDurationTicks=null;self.startTimeTicksOffset=null;self.playlist=[];self.isLocalPlayer=true;self.isDefaultPlayer=true;self.name='Html5 Player';self.getTargets=function(){var targets=[{name:Globalize.translate('MyDevice'),id:ConnectionManager.deviceId(),playerName:self.name,playableMediaTypes:['Audio','Video'],isLocalPlayer:true,supportedCommands:Dashboard.getSupportedRemoteCommands()}];return targets;};var canPlayAac=document.createElement('audio').canPlayType('audio/aac').replace(/no/,'');self.getVideoQualityOptions=function(videoWidth,videoHeight){var bitrateSetting=AppSettings.maxStreamingBitrate();var maxAllowedWidth=videoWidth||4096;var maxAllowedHeight=videoHeight||2304;var options=[];if(maxAllowedWidth>=1900){options.push({name:'1080p - 30Mbps',maxHeight:1080,bitrate:30000000});options.push({name:'1080p - 25Mbps',maxHeight:1080,bitrate:25000000});options.push({name:'1080p - 20Mbps',maxHeight:1080,bitrate:20000000});options.push({name:'1080p - 15Mbps',maxHeight:1080,bitrate:15000000});options.push({name:'1080p - 10Mbps',maxHeight:1080,bitrate:10000000});options.push({name:'1080p - 8Mbps',maxHeight:1080,bitrate:8000000});options.push({name:'1080p - 6Mbps',maxHeight:1080,bitrate:6000000});options.push({name:'1080p - 5Mbps',maxHeight:1080,bitrate:5000000});}else if(maxAllowedWidth>=1260){options.push({name:'720p - 10Mbps',maxHeight:720,bitrate:10000000});options.push({name:'720p - 8Mbps',maxHeight:720,bitrate:8000000});options.push({name:'720p - 6Mbps',maxHeight:720,bitrate:6000000});options.push({name:'720p - 5Mbps',maxHeight:720,bitrate:5000000});}else if(maxAllowedWidth>=700){options.push({name:'480p - 4Mbps',maxHeight:480,bitrate:4000000});options.push({name:'480p - 3Mbps',maxHeight:480,bitrate:3000000});options.push({name:'480p - 2.5Mbps',maxHeight:480,bitrate:2500000});options.push({name:'480p - 2Mbps',maxHeight:480,bitrate:2000000});options.push({name:'480p - 1.5Mbps',maxHeight:480,bitrate:1500000});}
if(maxAllowedWidth>=1260){options.push({name:'720p - 4Mbps',maxHeight:720,bitrate:4000000});options.push({name:'720p - 3Mbps',maxHeight:720,bitrate:3000000});options.push({name:'720p - 2Mbps',maxHeight:720,bitrate:2000000});options.push({name:'720p - 1.5Mbps',maxHeight:720,bitrate:1500001});options.push({name:'720p - 1Mbps',maxHeight:720,bitrate:1000001});}
options.push({name:'480p - 1.0Mbps',maxHeight:480,bitrate:1000000});options.push({name:'480p - 720kbps',maxHeight:480,bitrate:720000});options.push({name:'480p - 420kbps',maxHeight:480,bitrate:420000});options.push({name:'360p',maxHeight:360,bitrate:400000});options.push({name:'240p',maxHeight:240,bitrate:320000});options.push({name:'144p',maxHeight:144,bitrate:192000});var i,length,option;var selectedIndex=-1;for(i=0,length=options.length;i<length;i++){option=options[i];if(selectedIndex==-1&&option.bitrate<=bitrateSetting){selectedIndex=i;}}
if(selectedIndex==-1){selectedIndex=options.length-1;}
options[selectedIndex].selected=true;return options;};self.getDeviceProfile=function(maxHeight){if(!maxHeight){maxHeight=self.getVideoQualityOptions().filter(function(q){return q.selected;})[0].maxHeight;}
var bitrateSetting=AppSettings.maxStreamingBitrate();var canPlayWebm=self.canPlayWebm();var profile={};profile.MaxStreamingBitrate=bitrateSetting;profile.MaxStaticBitrate=40000000;profile.MusicStreamingTranscodingBitrate=Math.min(bitrateSetting,192000);profile.DirectPlayProfiles=[];profile.DirectPlayProfiles.push({Container:'mp4,m4v',Type:'Video',VideoCodec:'h264',AudioCodec:'aac,mp3'});if($.browser.chrome){profile.DirectPlayProfiles.push({Container:'mkv',Type:'Video',VideoCodec:'h264',AudioCodec:'aac,mp3'});}
profile.DirectPlayProfiles.push({Container:'mp3',Type:'Audio'});if(canPlayAac){profile.DirectPlayProfiles.push({Container:'aac',Type:'Audio'});}
var directPlayAudioContainers=AppInfo.directPlayAudioContainers;if(directPlayAudioContainers&&directPlayAudioContainers.length){profile.DirectPlayProfiles.push({Container:directPlayAudioContainers.join(','),Type:'Audio'});}
if(canPlayWebm){profile.DirectPlayProfiles.push({Container:'webm',Type:'Video'});profile.DirectPlayProfiles.push({Container:'webm,webma',Type:'Audio'});}
profile.TranscodingProfiles=[];if(self.canPlayHls()){profile.TranscodingProfiles.push({Container:'ts',Type:'Video',AudioCodec:'aac',VideoCodec:'h264',Context:'Streaming',Protocol:'hls'});if(canPlayAac&&$.browser.safari){profile.TranscodingProfiles.push({Container:'ts',Type:'Audio',AudioCodec:'aac',Context:'Streaming',Protocol:'hls'});}}
if(canPlayWebm){profile.TranscodingProfiles.push({Container:'webm',Type:'Video',AudioCodec:'vorbis',VideoCodec:'vpx',Context:'Streaming',Protocol:'http'});}
profile.TranscodingProfiles.push({Container:'mp4',Type:'Video',AudioCodec:'aac',VideoCodec:'h264',Context:'Streaming',Protocol:'http'});profile.TranscodingProfiles.push({Container:'mp4',Type:'Video',AudioCodec:'aac',VideoCodec:'h264',Context:'Static',Protocol:'http'});if(canPlayAac&&$.browser.safari){profile.TranscodingProfiles.push({Container:'aac',Type:'Audio',AudioCodec:'aac',Context:'Streaming',Protocol:'http'});profile.TranscodingProfiles.push({Container:'aac',Type:'Audio',AudioCodec:'aac',Context:'Static',Protocol:'http'});}else{profile.TranscodingProfiles.push({Container:'mp3',Type:'Audio',AudioCodec:'mp3',Context:'Streaming',Protocol:'http'});profile.TranscodingProfiles.push({Container:'mp3',Type:'Audio',AudioCodec:'mp3',Context:'Static',Protocol:'http'});}
profile.ContainerProfiles=[];var audioConditions=[];var maxAudioChannels=$.browser.msie||$.browser.safari?'2':'6';audioConditions.push({Condition:'LessThanEqual',Property:'AudioChannels',Value:maxAudioChannels});profile.CodecProfiles=[];profile.CodecProfiles.push({Type:'Audio',Conditions:audioConditions});profile.CodecProfiles.push({Type:'VideoAudio',Codec:'mp3',Conditions:[{Condition:'LessThanEqual',Property:'AudioChannels',Value:maxAudioChannels}]});profile.CodecProfiles.push({Type:'VideoAudio',Codec:'aac',Container:'mkv,mov',Conditions:[{Condition:'NotEquals',Property:'AudioProfile',Value:'HE-AAC'},{Condition:'NotEquals',Property:'AudioProfile',Value:'LC'}]});profile.CodecProfiles.push({Type:'VideoAudio',Codec:'aac',Conditions:[{Condition:'LessThanEqual',Property:'AudioChannels',Value:maxAudioChannels}]});profile.CodecProfiles.push({Type:'Video',Codec:'h264',Conditions:[{Condition:'NotEquals',Property:'IsAnamorphic',Value:'true',IsRequired:false},{Condition:'EqualsAny',Property:'VideoProfile',Value:'high|main|baseline|constrained baseline'},{Condition:'LessThanEqual',Property:'VideoLevel',Value:'41'},{Condition:'LessThanEqual',Property:'Height',Value:maxHeight}]});profile.CodecProfiles.push({Type:'Video',Codec:'vpx',Conditions:[{Condition:'NotEquals',Property:'IsAnamorphic',Value:'true',IsRequired:false},{Condition:'LessThanEqual',Property:'Height',Value:maxHeight}]});profile.SubtitleProfiles=[];if(self.supportsTextTracks()){profile.SubtitleProfiles.push({Format:'vtt',Method:'External'});}
profile.ResponseProfiles=[];profile.ResponseProfiles.push({Type:'Video',Container:'m4v',MimeType:'video/mp4'});profile.ResponseProfiles.push({Type:'Video',Container:'mov',MimeType:'video/webm'});return profile;};var supportsTextTracks;self.supportsTextTracks=function(){if(supportsTextTracks==null){supportsTextTracks=document.createElement('video').textTracks!=null;}
return supportsTextTracks;};self.updateCanClientSeek=function(mediaRenderer){var duration=mediaRenderer.duration();canClientSeek=duration&&!isNaN(duration)&&duration!=Number.POSITIVE_INFINITY&&duration!=Number.NEGATIVE_INFINITY;};self.getCurrentSrc=function(mediaRenderer){return mediaRenderer.currentSrc();};self.getCurrentTicks=function(mediaRenderer){var playerTime=Math.floor(10000*(mediaRenderer||self.currentMediaRenderer).currentTime());playerTime+=self.startTimeTicksOffset;return playerTime;};self.playNextAfterEnded=function(){self.nextTrack();};self.startProgressInterval=function(){clearProgressInterval();var intervalTime=ApiClient.isWebSocketOpen()?1200:5000;self.lastProgressReport=0;currentProgressInterval=setInterval(function(){if(self.currentMediaRenderer){if((new Date().getTime()-self.lastProgressReport)>intervalTime){self.lastProgressReport=new Date().getTime();sendProgressUpdate();}}},250);};self.getCurrentMediaExtension=function(currentSrc){currentSrc=currentSrc.split('?')[0];return currentSrc.substring(currentSrc.lastIndexOf('.'));};self.canPlayNativeHls=function(){var media=document.createElement('video');if(media.canPlayType('application/x-mpegURL').replace(/no/,'')||media.canPlayType('application/vnd.apple.mpegURL').replace(/no/,'')){return true;}
return false;};self.canPlayHls=function(){if(self.canPlayNativeHls()){return true;}
return false;};self.changeStream=function(ticks,params){var mediaRenderer=self.currentMediaRenderer;if(canClientSeek&&params==null){mediaRenderer.currentTime(ticks/10000);return;}
params=params||{};var currentSrc=mediaRenderer.currentSrc();var playSessionId=getParameterByName('PlaySessionId',currentSrc);var liveStreamId=getParameterByName('LiveStreamId',currentSrc);if(params.AudioStreamIndex==null&&params.SubtitleStreamIndex==null&&params.Bitrate==null){currentSrc=replaceQueryString(currentSrc,'starttimeticks',ticks||0);changeStreamToUrl(mediaRenderer,playSessionId,currentSrc,ticks);return;}
var deviceProfile=self.getDeviceProfile();var audioStreamIndex=params.AudioStreamIndex==null?(getParameterByName('AudioStreamIndex',currentSrc)||null):params.AudioStreamIndex;if(typeof(audioStreamIndex)=='string'){audioStreamIndex=parseInt(audioStreamIndex);}
var subtitleStreamIndex=params.SubtitleStreamIndex==null?(getParameterByName('SubtitleStreamIndex',currentSrc)||null):params.SubtitleStreamIndex;if(typeof(subtitleStreamIndex)=='string'){subtitleStreamIndex=parseInt(subtitleStreamIndex);}
MediaController.getPlaybackInfo(self.currentItem.Id,deviceProfile,ticks,self.currentMediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId).done(function(result){if(validatePlaybackInfoResult(result)){self.currentMediaSource=result.MediaSources[0];self.currentSubtitleStreamIndex=subtitleStreamIndex;currentSrc=ApiClient.getUrl(self.currentMediaSource.TranscodingUrl);changeStreamToUrl(mediaRenderer,playSessionId,currentSrc,ticks);}});};function changeStreamToUrl(mediaRenderer,playSessionId,url,newPositionTicks){clearProgressInterval();Events.off(mediaRenderer,'ended',self.onPlaybackStopped);Events.off(mediaRenderer,'ended',self.playNextAfterEnded);$(mediaRenderer).one("play",function(){self.updateCanClientSeek(this);Events.on(this,'ended',self.onPlaybackStopped);$(this).one('ended',self.playNextAfterEnded);self.startProgressInterval();sendProgressUpdate();});if(self.currentItem.MediaType=="Video"){ApiClient.stopActiveEncodings(playSessionId).done(function(){self.startTimeTicksOffset=newPositionTicks;mediaRenderer.setCurrentSrc(url,self.currentItem,self.currentMediaSource);});self.updateTextStreamUrls(newPositionTicks||0);}else{self.startTimeTicksOffset=newPositionTicks;mediaRenderer.setCurrentSrc(url,self.currentItem,self.currentMediaSource);}}
self.setCurrentTime=function(ticks,positionSlider,currentTimeElement){ticks=Math.floor(ticks);var timeText=Dashboard.getDisplayTime(ticks);if(self.currentDurationTicks){timeText+=" / "+Dashboard.getDisplayTime(self.currentDurationTicks);if(positionSlider){var percent=ticks/self.currentDurationTicks;percent*=100;positionSlider.disabled=false;positionSlider.value=percent;}}else{if(positionSlider){positionSlider.disabled=true;}}
if(currentTimeElement){currentTimeElement.html(timeText);}
var state=self.getPlayerStateInternal(self.currentMediaRenderer,self.currentItem,self.currentMediaSource);Events.trigger(self,'positionchange',[state]);};self.canQueueMediaType=function(mediaType){return self.currentItem&&self.currentItem.MediaType==mediaType;};function translateItemsForPlayback(items){var deferred=$.Deferred();var firstItem=items[0];var promise;if(firstItem.Type=="Playlist"){promise=self.getItemsForPlayback({ParentId:firstItem.Id,});}
else if(firstItem.Type=="MusicArtist"){promise=self.getItemsForPlayback({ArtistIds:firstItem.Id,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio"});}
else if(firstItem.Type=="MusicGenre"){promise=self.getItemsForPlayback({Genres:firstItem.Name,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio"});}
else if(firstItem.IsFolder){promise=self.getItemsForPlayback({ParentId:firstItem.Id,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio,Video"});}
if(promise){promise.done(function(result){deferred.resolveWith(null,[result.Items]);});}else{deferred.resolveWith(null,[items]);}
return deferred.promise();}
self.play=function(options){Dashboard.getCurrentUser().done(function(user){if(options.items){translateItemsForPlayback(options.items).done(function(items){self.playWithIntros(items,options,user);});}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){translateItemsForPlayback(result.Items).done(function(items){self.playWithIntros(items,options,user);});});}});};self.playWithIntros=function(items,options,user){var firstItem=items[0];if(options.startPositionTicks||firstItem.MediaType!=='Video'||!self.canAutoPlayVideo()){self.playInternal(firstItem,options.startPositionTicks,function(){self.setPlaylistState(0,items);});return;}
ApiClient.getJSON(ApiClient.getUrl('Users/'+user.Id+'/Items/'+firstItem.Id+'/Intros')).done(function(intros){items=intros.Items.concat(items);self.playInternal(items[0],options.startPositionTicks,function(){self.setPlaylistState(0,items);});});};function getOptimalMediaSource(mediaType,versions){var optimalVersion=versions.filter(function(v){v.enableDirectPlay=MediaController.supportsDirectPlay(v);return v.enableDirectPlay;})[0];if(!optimalVersion){optimalVersion=versions.filter(function(v){return v.SupportsDirectStream;})[0];}
return optimalVersion||versions.filter(function(s){return s.SupportsTranscoding;})[0];}
self.createStreamInfo=function(type,item,mediaSource,startPosition){var mediaUrl;var contentType;var startTimeTicksOffset=0;var startPositionInSeekParam=startPosition?(startPosition/10000000):0;var seekParam=startPositionInSeekParam?'#t='+startPositionInSeekParam:'';var playMethod='Transcode';if(type=='Video'){contentType='video/'+mediaSource.Container;if(mediaSource.enableDirectPlay){mediaUrl=FileSystemBridge.translateFilePath(mediaSource.Path);playMethod='DirectPlay';}else{if(mediaSource.SupportsDirectStream){mediaUrl=ApiClient.getUrl('Videos/'+item.Id+'/stream.'+mediaSource.Container,{Static:true,mediaSourceId:mediaSource.Id,api_key:ApiClient.accessToken()});mediaUrl+=seekParam;playMethod='DirectStream';}else{startTimeTicksOffset=startPosition||0;mediaUrl=ApiClient.getUrl(mediaSource.TranscodingUrl);if(mediaSource.TranscodingSubProtocol=='hls'){mediaUrl+=seekParam;contentType='application/x-mpegURL';}else{contentType='video/'+mediaSource.TranscodingContainer;}}}}else{contentType='audio/'+mediaSource.Container;if(mediaSource.enableDirectPlay){mediaUrl=FileSystemBridge.translateFilePath(mediaSource.Path);playMethod='DirectPlay';}else{var isDirectStream=mediaSource.SupportsDirectStream;if(isDirectStream){var outputContainer=(mediaSource.Container||'').toLowerCase();mediaUrl=ApiClient.getUrl('Audio/'+item.Id+'/stream.'+outputContainer,{mediaSourceId:mediaSource.Id,deviceId:ApiClient.deviceId(),api_key:ApiClient.accessToken()});mediaUrl+="&static=true"+seekParam;playMethod='DirectStream';}else{contentType='audio/'+mediaSource.TranscodingContainer;mediaUrl=ApiClient.getUrl(mediaSource.TranscodingUrl);}
startTimeTicksOffset=startPosition||0;}}
return{url:mediaUrl,mimeType:contentType,startTimeTicksOffset:startTimeTicksOffset,startPositionInSeekParam:startPositionInSeekParam,playMethod:playMethod};};self.playInternal=function(item,startPosition,callback){if(item==null){throw new Error("item cannot be null");}
if(self.isPlaying()){self.stop(false);}
if(item.MediaType!=='Audio'&&item.MediaType!=='Video'){throw new Error("Unrecognized media type");}
if(item.IsPlaceHolder){MediaController.showPlaybackInfoErrorMessage('PlaceHolder');return;}
var deviceProfile=self.getDeviceProfile();if(item.MediaType==="Video"){Dashboard.showModalLoadingMsg();}
MediaController.getPlaybackInfo(item.Id,deviceProfile,startPosition).done(function(playbackInfoResult){if(validatePlaybackInfoResult(playbackInfoResult)){var mediaSource=getOptimalMediaSource(item.MediaType,playbackInfoResult.MediaSources);if(mediaSource){if(mediaSource.RequiresOpening){MediaController.getLiveStream(item.Id,playbackInfoResult.PlaySessionId,deviceProfile,startPosition,mediaSource,null,null).done(function(openLiveStreamResult){openLiveStreamResult.MediaSource.enableDirectPlay=MediaController.supportsDirectPlay(openLiveStreamResult.MediaSource);playInternalPostMediaSourceSelection(item,openLiveStreamResult.MediaSource,startPosition,callback);});}else{playInternalPostMediaSourceSelection(item,mediaSource,startPosition,callback);}}else{Dashboard.hideModalLoadingMsg();MediaController.showPlaybackInfoErrorMessage('NoCompatibleStream');}}});};function playInternalPostMediaSourceSelection(item,mediaSource,startPosition,callback){Dashboard.hideModalLoadingMsg();self.currentMediaSource=mediaSource;self.currentItem=item;if(item.MediaType==="Video"){self.playVideo(item,self.currentMediaSource,startPosition);}else if(item.MediaType==="Audio"){playAudio(item,self.currentMediaSource,startPosition);}
if(callback){callback();}}
function validatePlaybackInfoResult(result){if(result.ErrorCode){MediaController.showPlaybackInfoErrorMessage(result.ErrorCode);return false;}
return true;}
self.getPosterUrl=function(item){if($.browser.safari){return null;}
var screenWidth=Math.max(screen.height,screen.width);if(item.BackdropImageTags&&item.BackdropImageTags.length){return ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:screenWidth,tag:item.BackdropImageTags[0]});}
else if(item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){return ApiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:'Backdrop',index:0,maxWidth:screenWidth,tag:item.ParentBackdropImageTags[0]});}
return null;};self.displayContent=function(options){Dashboard.onBrowseCommand(options);};self.getItemsForPlayback=function(query){var userId=Dashboard.getCurrentUserId();if(query.Ids&&query.Ids.split(',').length==1){var deferred=DeferredBuilder.Deferred();ApiClient.getItem(userId,query.Ids.split(',')).done(function(item){deferred.resolveWith(null,[{Items:[item],TotalRecordCount:1}]);});return deferred.promise();}
else{query.Limit=query.Limit||100;query.Fields=getItemFields;query.ExcludeLocationTypes="Virtual";return ApiClient.getItems(userId,query);}};self.removeFromPlaylist=function(index){self.playlist.remove(index);};self.currentPlaylistIndex=function(i){if(i==null){return currentPlaylistIndex;}
var newItem=self.playlist[i];self.playInternal(newItem,0,function(){self.setPlaylistState(i);});};self.setPlaylistState=function(i,items){if(!isNaN(i)){currentPlaylistIndex=i;}
if(items){self.playlist=items;}
if(self.updatePlaylistUi){self.updatePlaylistUi();}};self.nextTrack=function(){var newIndex=currentPlaylistIndex+1;var newItem=self.playlist[newIndex];if(newItem){Logger.log('playing next track');self.playInternal(newItem,0,function(){self.setPlaylistState(newIndex);});}};self.previousTrack=function(){var newIndex=currentPlaylistIndex-1;if(newIndex>=0){var newItem=self.playlist[newIndex];if(newItem){self.playInternal(newItem,0,function(){self.setPlaylistState(newIndex);});}}};self.queueItemsNext=function(items){var insertIndex=1;for(var i=0,length=items.length;i<length;i++){self.playlist.splice(insertIndex,0,items[i]);insertIndex++;}};self.queueItems=function(items){for(var i=0,length=items.length;i<length;i++){self.playlist.push(items[i]);}};self.queue=function(options){if(!self.playlist.length){self.play(options);return;}
Dashboard.getCurrentUser().done(function(user){if(options.items){translateItemsForPlayback(options.items).done(function(items){self.queueItems(items);});}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){translateItemsForPlayback(result.Items).done(function(items){self.queueItems(items);});});}});};self.queueNext=function(options){if(!self.playlist.length){self.play(options);return;}
Dashboard.getCurrentUser().done(function(user){if(options.items){self.queueItemsNext(options.items);}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){options.items=result.Items;self.queueItemsNext(options.items);});}});};self.pause=function(){self.currentMediaRenderer.pause();};self.unpause=function(){self.currentMediaRenderer.unpause();};self.seek=function(position){self.changeStream(position);};self.mute=function(){self.setVolume(0);};self.unMute=function(){self.setVolume(self.getSavedVolume()*100);};self.volume=function(){return self.currentMediaRenderer.volume()*100;};self.toggleMute=function(){if(self.currentMediaRenderer){Logger.log('MediaPlayer toggling mute');if(self.volume()){self.mute();}else{self.unMute();}}};self.volumeDown=function(){if(self.currentMediaRenderer){self.setVolume(Math.max(self.volume()-2,0));}};self.volumeUp=function(){if(self.currentMediaRenderer){self.setVolume(Math.min(self.volume()+2,100));}};self.setVolume=function(val){if(self.currentMediaRenderer){Logger.log('MediaPlayer setting volume to '+val);self.currentMediaRenderer.volume(val/100);self.onVolumeChanged(self.currentMediaRenderer);}};self.saveVolume=function(val){if(val){appStorage.setItem("volume",val);}};self.getSavedVolume=function(){return appStorage.getItem("volume")||0.5;};self.shuffle=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){var query={UserId:userId,Fields:getItemFields,Limit:100,Filters:"IsNotFolder",Recursive:true,SortBy:"Random"};if(item.Type=="MusicArtist"){query.MediaTypes="Audio";query.ArtistIds=item.Id;}
else if(item.Type=="MusicGenre"){query.MediaTypes="Audio";query.Genres=item.Name;}
else if(item.IsFolder){query.ParentId=id;}
else{return;}
self.getItemsForPlayback(query).done(function(result){self.play({items:result.Items});});});};self.instantMix=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){var promise;var itemLimit=100;if(item.Type=="MusicArtist"){promise=ApiClient.getInstantMixFromArtist({UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit,Id:id});}
else if(item.Type=="MusicGenre"){promise=ApiClient.getInstantMixFromMusicGenre({UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit,Id:id});}
else if(item.Type=="MusicAlbum"){promise=ApiClient.getInstantMixFromAlbum(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else if(item.Type=="Playlist"){promise=ApiClient.getInstantMixFromPlaylist(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else if(item.Type=="Audio"){promise=ApiClient.getInstantMixFromSong(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else{return;}
promise.done(function(result){self.play({items:result.Items});});});};self.stop=function(destroyRenderer){var mediaRenderer=self.currentMediaRenderer;if(mediaRenderer){mediaRenderer.stop();Events.off(mediaRenderer,'ended',self.playNextAfterEnded);$(mediaRenderer).one("ended",function(){$(this).off('.mediaplayerevent');this.cleanup(destroyRenderer);self.currentMediaRenderer=null;self.currentItem=null;self.currentMediaSource=null;});Events.trigger(mediaRenderer,"ended");}else{self.currentMediaRenderer=null;self.currentItem=null;self.currentMediaSource=null;}
if(self.isFullScreen()){self.exitFullScreen();}
self.resetEnhancements();};self.isPlaying=function(){return self.playlist.length>0;};self.getPlayerState=function(){var deferred=$.Deferred();var result=self.getPlayerStateInternal(self.currentMediaRenderer,self.currentItem,self.currentMediaSource);deferred.resolveWith(null,[result]);return deferred.promise();};self.getPlayerStateInternal=function(mediaRenderer,item,mediaSource){var state={PlayState:{}};if(mediaRenderer){state.PlayState.VolumeLevel=mediaRenderer.volume()*100;state.PlayState.IsMuted=mediaRenderer.volume()==0;state.PlayState.IsPaused=mediaRenderer.paused();state.PlayState.PositionTicks=self.getCurrentTicks(mediaRenderer);var currentSrc=mediaRenderer.currentSrc();if(currentSrc){var audioStreamIndex=getParameterByName('AudioStreamIndex',currentSrc);if(audioStreamIndex){state.PlayState.AudioStreamIndex=parseInt(audioStreamIndex);}
state.PlayState.SubtitleStreamIndex=self.currentSubtitleStreamIndex;state.PlayState.PlayMethod=getParameterByName('static',currentSrc)=='true'?'DirectStream':'Transcode';state.PlayState.LiveStreamId=getParameterByName('LiveStreamId',currentSrc);state.PlayState.PlaySessionId=getParameterByName('PlaySessionId',currentSrc);}}
if(mediaSource){state.PlayState.MediaSourceId=mediaSource.Id;state.NowPlayingItem={RunTimeTicks:mediaSource.RunTimeTicks};state.PlayState.CanSeek=mediaSource.RunTimeTicks&&mediaSource.RunTimeTicks>0;}
if(item){state.NowPlayingItem=self.getNowPlayingItemForReporting(item,mediaSource);}
return state;};self.getNowPlayingItemForReporting=function(item,mediaSource){var nowPlayingItem={};nowPlayingItem.RunTimeTicks=mediaSource.RunTimeTicks;nowPlayingItem.Id=item.Id;nowPlayingItem.MediaType=item.MediaType;nowPlayingItem.Type=item.Type;nowPlayingItem.Name=item.Name;nowPlayingItem.IndexNumber=item.IndexNumber;nowPlayingItem.IndexNumberEnd=item.IndexNumberEnd;nowPlayingItem.ParentIndexNumber=item.ParentIndexNumber;nowPlayingItem.ProductionYear=item.ProductionYear;nowPlayingItem.PremiereDate=item.PremiereDate;nowPlayingItem.SeriesName=item.SeriesName;nowPlayingItem.Album=item.Album;nowPlayingItem.Artists=item.Artists;var imageTags=item.ImageTags||{};if(item.SeriesPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.SeriesId;nowPlayingItem.PrimaryImageTag=item.SeriesPrimaryImageTag;}
else if(imageTags.Primary){nowPlayingItem.PrimaryImageItemId=item.Id;nowPlayingItem.PrimaryImageTag=imageTags.Primary;}
else if(item.AlbumPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.AlbumId;nowPlayingItem.PrimaryImageTag=item.AlbumPrimaryImageTag;}
else if(item.SeriesPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.SeriesId;nowPlayingItem.PrimaryImageTag=item.SeriesPrimaryImageTag;}
if(item.BackdropImageTags&&item.BackdropImageTags.length){nowPlayingItem.BackdropItemId=item.Id;nowPlayingItem.BackdropImageTag=item.BackdropImageTags[0];}
else if(item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){nowPlayingItem.BackdropItemId=item.ParentBackdropItemId;nowPlayingItem.BackdropImageTag=item.ParentBackdropImageTags[0];}
if(imageTags.Thumb){nowPlayingItem.ThumbItemId=item.Id;nowPlayingItem.ThumbImageTag=imageTags.Thumb;}
if(imageTags.Logo){nowPlayingItem.LogoItemId=item.Id;nowPlayingItem.LogoImageTag=imageTags.Logo;}
else if(item.ParentLogoImageTag){nowPlayingItem.LogoItemId=item.ParentLogoItemId;nowPlayingItem.LogoImageTag=item.ParentLogoImageTag;}
return nowPlayingItem;};self.beginPlayerUpdates=function(){};self.endPlayerUpdates=function(){};self.onPlaybackStart=function(mediaRenderer,item,mediaSource){self.updateCanClientSeek(mediaRenderer);var state=self.getPlayerStateInternal(mediaRenderer,item,mediaSource);Events.trigger(self,'playbackstart',[state]);self.startProgressInterval();};self.onVolumeChanged=function(mediaRenderer){self.saveVolume(mediaRenderer.volume());var state=self.getPlayerStateInternal(mediaRenderer,self.currentItem,self.currentMediaSource);Events.trigger(self,'volumechange',[state]);};self.cleanup=function(){};self.onPlaybackStopped=function(){Logger.log('playback stopped');document.body.classList.remove('bodyWithPopupOpen');var mediaRenderer=this;Events.off(mediaRenderer,'.mediaplayerevent');Events.off(mediaRenderer,'ended',self.onPlaybackStopped);self.cleanup(mediaRenderer);clearProgressInterval();var item=self.currentItem;var mediaSource=self.currentMediaSource;if(item.MediaType=="Video"){if(self.isFullScreen()){self.exitFullScreen();}
self.resetEnhancements();}
var state=self.getPlayerStateInternal(mediaRenderer,item,mediaSource);Events.trigger(self,'playbackstop',[state]);};self.onPlaystateChange=function(mediaRenderer){var state=self.getPlayerStateInternal(mediaRenderer,self.currentItem,self.currentMediaSource);Events.trigger(self,'playstatechange',[state]);};Events.on(window,"beforeunload",function(){if(self.currentItem&&self.currentMediaRenderer&&currentProgressInterval){self.onPlaybackStopped.call(self.currentMediaRenderer);}});function sendProgressUpdate(){var state=self.getPlayerStateInternal(self.currentMediaRenderer,self.currentItem,self.currentMediaSource);var info={QueueableMediaTypes:state.NowPlayingItem.MediaType,ItemId:state.NowPlayingItem.Id,NowPlayingItem:state.NowPlayingItem};info=$.extend(info,state.PlayState);ApiClient.reportPlaybackProgress(info);}
function clearProgressInterval(){if(currentProgressInterval){clearTimeout(currentProgressInterval);currentProgressInterval=null;}}
self._canPlayWebm=null;self.canPlayWebm=function(){if(self._canPlayWebm==null){self._canPlayWebm=document.createElement('video').canPlayType('video/webm').replace(/no/,'');}
return self._canPlayWebm;};self.canAutoPlayAudio=function(){if(AppInfo.isNativeApp){return true;}
if($.browser.mobile){return false;}
return true;};function getAudioRenderer(){return new AudioRenderer('audio');}
function onTimeUpdate(){var currentTicks=self.getCurrentTicks(this);self.setCurrentTime(currentTicks);}
function playAudio(item,mediaSource,startPositionTicks){requirejs(['audiorenderer'],function(){playAudioInternal(item,mediaSource,startPositionTicks);});}
function playAudioInternal(item,mediaSource,startPositionTicks){var streamInfo=self.createStreamInfo('Audio',item,mediaSource,startPositionTicks);var audioUrl=streamInfo.url;self.startTimeTicksOffset=streamInfo.startTimeTicksOffset;var initialVolume=self.getSavedVolume();var mediaRenderer=getAudioRenderer();mediaRenderer.volume(initialVolume);mediaRenderer.setPoster(self.getPosterUrl(item));mediaRenderer.setCurrentSrc(audioUrl,item,mediaSource);Events.on(mediaRenderer,"volumechange.mediaplayerevent",function(){Logger.log('audio element event: volumechange');self.onVolumeChanged(this);});$(mediaRenderer).one("playing.mediaplayerevent",function(){Logger.log('audio element event: playing');Events.on(this,'ended',self.onPlaybackStopped);$(this).one('ended',self.playNextAfterEnded);self.onPlaybackStart(this,item,mediaSource);}).on("pause.mediaplayerevent",function(){Logger.log('audio element event: pause');self.onPlaystateChange(this);self.setCurrentTime(self.getCurrentTicks());}).on("playing.mediaplayerevent",function(){Logger.log('audio element event: playing');self.onPlaystateChange(this);self.setCurrentTime(self.getCurrentTicks());}).on("timeupdate.mediaplayerevent",onTimeUpdate);self.currentMediaRenderer=mediaRenderer;self.currentDurationTicks=self.currentMediaSource.RunTimeTicks;}
var getItemFields="MediaSources,Chapters";self.tryPair=function(target){var deferred=$.Deferred();deferred.resolve();return deferred.promise();};}
window.MediaPlayer=new mediaPlayer();Dashboard.ready(function(){window.MediaController.registerPlayer(window.MediaPlayer);window.MediaController.setActivePlayer(window.MediaPlayer,window.MediaPlayer.getTargets()[0]);});})(document,setTimeout,clearTimeout,screen,$,setInterval,window);(function(){function createVideoPlayer(self){var initialVolume;var idleState=true;var muteButton=null;var unmuteButton=null;var volumeSlider=null;var positionSlider;var currentTimeElement;self.currentSubtitleStreamIndex=null;self.getCurrentSubtitleStream=function(){return self.getSubtitleStream(self.currentSubtitleStreamIndex);};self.getSubtitleStream=function(index){return self.currentMediaSource.MediaStreams.filter(function(s){return s.Type=='Subtitle'&&s.Index==index;})[0];};self.toggleFullscreen=function(){if(self.isFullScreen()){self.exitFullScreen();}else{requestFullScreen(document.body);}};self.resetEnhancements=function(){$("#mediaPlayer").hide();$('#videoPlayer').removeClass('fullscreenVideo').removeClass('idlePlayer');$('.hiddenOnIdle').removeClass("inactive");$("video").remove();};self.exitFullScreen=function(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}
$('#videoPlayer').removeClass('fullscreenVideo');};self.isFullScreen=function(){return document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?true:false;};self.showChaptersFlyout=function(){function onFlyoutClose(){$('.itemVideo').css('visibility','visible');}
require(['jqmicons']);var html=getChaptersFlyoutHtml();var elem=$('.videoChaptersPopup').html(html).trigger('create').popup("option","positionTo",$('.videoChaptersButton')).off('popupafterclose',onFlyoutClose).on('popupafterclose',onFlyoutClose);elem.popup("open").parents(".ui-popup-container").css("margin-top",30);};self.showSubtitleMenu=function(){var streams=self.currentMediaSource.MediaStreams.filter(function(currentStream){return currentStream.Type=="Subtitle";});var currentIndex=self.currentSubtitleStreamIndex||-1;streams.unshift({Index:-1,Language:"Off"});var menuItems=streams.map(function(stream){var attributes=[];attributes.push(stream.Language||Globalize.translate('LabelUnknownLanguage'));if(stream.Codec){attributes.push(stream.Codec);}
var name=attributes.join(' - ');if(stream.IsDefault){name+=' (D)';}
if(stream.IsForced){name+=' (F)';}
if(stream.External){name+=' (EXT)';}
var opt={name:name,id:stream.Index};if(stream.Index==currentIndex){opt.ironIcon="check";}
return opt;});require(['actionsheet'],function(){ActionSheetElement.show({items:menuItems,positionTo:$('.videoSubtitleButton')[0],callback:function(id){var index=parseInt(id);if(index!=currentIndex){self.onSubtitleOptionSelected(index);}}});});};self.showQualityFlyout=function(){var currentSrc=self.getCurrentSrc(self.currentMediaRenderer).toLowerCase();var isStatic=currentSrc.indexOf('static=true')!=-1;var videoStream=self.currentMediaSource.MediaStreams.filter(function(stream){return stream.Type=="Video";})[0];var videoWidth=videoStream?videoStream.Width:null;var videoHeight=videoStream?videoStream.Height:null;var options=self.getVideoQualityOptions(videoWidth,videoHeight);if(isStatic){options[0].name="Direct";}
var menuItems=options.map(function(o){var opt={name:o.name,id:o.bitrate};if(o.selected){opt.ironIcon="check";}
return opt;});var selectedId=options.filter(function(o){return o.selected;});selectedId=selectedId.length?selectedId[0].bitrate:null;require(['actionsheet'],function(){ActionSheetElement.show({items:menuItems,positionTo:$('.videoQualityButton')[0],callback:function(id){var bitrate=parseInt(id);if(bitrate!=selectedId){self.onQualityOptionSelected(bitrate);}}});});};self.showAudioTracksFlyout=function(){var options=self.currentMediaSource.MediaStreams.filter(function(currentStream){return currentStream.Type=="Audio";});var currentIndex=getParameterByName('AudioStreamIndex',self.getCurrentSrc(self.currentMediaRenderer));var menuItems=options.map(function(stream){var attributes=[];attributes.push(stream.Language||Globalize.translate('LabelUnknownLanguage'));if(stream.Codec){attributes.push(stream.Codec);}
if(stream.Profile){attributes.push(stream.Profile);}
if(stream.BitRate){attributes.push((Math.floor(stream.BitRate/1000))+' kbps');}
if(stream.Channels){attributes.push(stream.Channels+' ch');}
var name=attributes.join(' - ');if(stream.IsDefault){name+=' (D)';}
var opt={name:name,id:stream.Index};if(stream.Index==currentIndex){opt.ironIcon="check";}
return opt;});require(['actionsheet'],function(){ActionSheetElement.show({items:menuItems,positionTo:$('.videoAudioButton')[0],callback:function(id){var index=parseInt(id);if(index!=currentIndex){self.onAudioOptionSelected(index);}}});});};self.setAudioStreamIndex=function(index){self.changeStream(self.getCurrentTicks(),{AudioStreamIndex:index});};self.setSubtitleStreamIndex=function(index){if(!self.currentMediaRenderer.supportsTextTracks()){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});self.currentSubtitleStreamIndex=index;return;}
var currentStream=self.getCurrentSubtitleStream();var newStream=self.getSubtitleStream(index);if(!currentStream&&!newStream)return;var selectedTrackElementIndex=-1;if(currentStream&&!newStream){if(currentStream.DeliveryMethod!='External'){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:-1});}}
else if(!currentStream&&newStream){if(newStream.DeliveryMethod=='External'){selectedTrackElementIndex=index;}else{self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});}}
else if(currentStream&&newStream){if(newStream.DeliveryMethod=='External'){selectedTrackElementIndex=index;if(currentStream.DeliveryMethod!='External'){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:-1});}}else{self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});}}
self.setCurrentTrackElement(selectedTrackElementIndex);self.currentSubtitleStreamIndex=index;};self.setCurrentTrackElement=function(index){var textStreams=self.currentMediaSource.MediaStreams.filter(function(s){return s.DeliveryMethod=='External';});var newStream=textStreams.filter(function(s){return s.Index==index;})[0];var trackIndex=newStream?textStreams.indexOf(newStream):-1;self.currentMediaRenderer.setCurrentTrackElement(trackIndex);};self.updateTextStreamUrls=function(startPositionTicks){self.currentMediaRenderer.updateTextStreamUrls(startPositionTicks);};self.updateNowPlayingInfo=function(item){if(!item){throw new Error('item cannot be null');}
var mediaControls=$("#videoPlayer");var state=self.getPlayerStateInternal(self.currentMediaRenderer,item,self.currentMediaSource);var url="";var imageWidth=400;var imageHeight=300;if(state.NowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.PrimaryImageItemId,{type:"Primary",width:imageWidth,tag:state.NowPlayingItem.PrimaryImageTag});}
else if(state.NowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.PrimaryImageItemId,{type:"Primary",width:imageWidth,tag:state.NowPlayingItem.PrimaryImageTag});}
else if(state.NowPlayingItem.BackdropImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.BackdropItemId,{type:"Backdrop",height:imageHeight,tag:state.NowPlayingItem.BackdropImageTag,index:0});}
else if(state.NowPlayingItem.ThumbImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.ThumbImageItemId,{type:"Thumb",height:imageHeight,tag:state.NowPlayingItem.ThumbImageTag});}
if(url){$('.nowPlayingImage',mediaControls).html('<img src="'+url+'" />');}else{$('.nowPlayingImage',mediaControls).html('');}
if(state.NowPlayingItem.LogoItemId){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.LogoItemId,{type:"Logo",height:42,tag:state.NowPlayingItem.LogoImageTag});$('.videoTopControlsLogo',mediaControls).html('<img src="'+url+'" />');}else{$('.videoTopControlsLogo',mediaControls).html('');}
var elem=$('.nowPlayingTabs',mediaControls).html(getNowPlayingTabsHtml(item)).lazyChildren();$('.nowPlayingTabButton',elem).on('click',function(){if(!$(this).hasClass('selectedNowPlayingTabButton')){$('.selectedNowPlayingTabButton').removeClass('selectedNowPlayingTabButton');$(this).addClass('selectedNowPlayingTabButton');$('.nowPlayingTab').hide();$('.'+this.getAttribute('data-tab')).show().trigger('scroll');}});$('.chapterCard',elem).on('click',function(){self.seek(parseInt(this.getAttribute('data-position')));});};function getNowPlayingTabsHtml(item){var html='';html+='<div class="nowPlayingTabButtons">';html+='<a href="#" class="nowPlayingTabButton selectedNowPlayingTabButton" data-tab="tabInfo">'+Globalize.translate('TabInfo')+'</a>';if(item.Chapters&&item.Chapters.length){html+='<a href="#" class="nowPlayingTabButton" data-tab="tabScenes">'+Globalize.translate('TabScenes')+'</a>';}
if(item.People&&item.People.length){html+='<a href="#" class="nowPlayingTabButton" data-tab="tabCast">'+Globalize.translate('TabCast')+'</a>';}
html+='</div>';html+='<div class="tabInfo nowPlayingTab">';var nameHtml=MediaController.getNowPlayingNameHtml(item,false);nameHtml='<div class="videoNowPlayingName">'+nameHtml+'</div>';var miscInfo=LibraryBrowser.getMiscInfoHtml(item);if(miscInfo){nameHtml+='<div class="videoNowPlayingRating">'+miscInfo+'</div>';}
var ratingHtml=LibraryBrowser.getRatingHtml(item);if(ratingHtml){nameHtml+='<div class="videoNowPlayingRating">'+ratingHtml+'</div>';}
if(item.Overview){nameHtml+='<div class="videoNowPlayingOverview">'+item.Overview+'</div>';}
html+=nameHtml;html+='</div>';if(item.Chapters&&item.Chapters.length){html+='<div class="tabScenes nowPlayingTab hiddenScrollX" style="display:none;white-space:nowrap;margin-bottom:2em;">';var chapterIndex=0;html+=item.Chapters.map(function(c){var width=240;var chapterHtml='<a class="card backdropCard chapterCard" href="#" style="margin-right:1em;width:'+width+'px;" data-position="'+c.StartPositionTicks+'">';chapterHtml+='<div class="cardBox">';chapterHtml+='<div class="cardScalable">';chapterHtml+='<div class="cardPadder"></div>';chapterHtml+='<div class="cardContent">';if(c.ImageTag){var chapterImageUrl=ApiClient.getScaledImageUrl(item.Id,{width:width,tag:c.ImageTag,type:"Chapter",index:chapterIndex});chapterHtml+='<div class="cardImage lazy" data-src="'+chapterImageUrl+'"></div>';}else{chapterHtml+='<div class="cardImage" style="background:#444;"></div>';}
chapterHtml+='<div class="cardFooter">';if(c.Name){chapterHtml+='<div class="cardText">'+c.Name+'</div>';}
chapterHtml+='<div class="cardText">'+Dashboard.getDisplayTime(c.StartPositionTicks)+'</div>';chapterHtml+='</div>';chapterHtml+='</div>';chapterHtml+='</div>';chapterHtml+='</div>';chapterHtml+='</a>';chapterIndex++;return chapterHtml;}).join('');html+='</div>';}
if(item.People&&item.People.length){html+='<div class="tabCast nowPlayingTab hiddenScrollX" style="display:none;white-space:nowrap;">';html+=item.People.map(function(cast){var personHtml='<div class="tileItem smallPosterTileItem" style="width:300px;">';var imgUrl;var height=160;if(cast.PrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(cast.Id,{height:height,tag:cast.PrimaryImageTag,type:"primary",minScale:2});}else{imgUrl="css/images/items/list/person.png";}
personHtml+='<div class="tileImage lazy" data-src="'+imgUrl+'" style="height:'+height+'px;"></div>';personHtml+='<div class="tileContent">';personHtml+='<p>'+cast.Name+'</p>';var role=cast.Role?Globalize.translate('ValueAsRole',cast.Role):cast.Type;if(role=="GuestStar"){role=Globalize.translate('ValueGuestStar');}
role=role||"";var maxlength=40;if(role.length>maxlength){role=role.substring(0,maxlength-3)+'...';}
personHtml+='<p>'+role+'</p>';personHtml+='</div>';personHtml+='</div>';return personHtml;}).join('');html+='</div>';}
return html;}
function onPositionSliderChange(){var newPercent=parseInt(this.value);var newPositionTicks=(newPercent/100)*self.currentMediaSource.RunTimeTicks;self.changeStream(Math.floor(newPositionTicks));}
self.onChapterOptionSelected=function(elem){if(!$(elem).hasClass('selectedMediaPopupOption')){var ticks=parseInt(elem.getAttribute('data-value')||'0');self.changeStream(ticks);}
$('.videoChaptersPopup').popup('close');};self.onAudioOptionSelected=function(index){self.setAudioStreamIndex(index);};self.onSubtitleOptionSelected=function(index){self.setSubtitleStreamIndex(index);};self.onQualityOptionSelected=function(bitrate){AppSettings.maxStreamingBitrate(bitrate);$('.videoQualityPopup').popup('close');self.changeStream(self.getCurrentTicks(),{Bitrate:bitrate});};function ensureVideoPlayerElements(){var html='<div id="mediaPlayer" data-theme="b" class="ui-bar-b" style="display: none;">';html+='<div class="videoBackdrop">';html+='<div id="videoPlayer">';html+='<div id="videoElement">';html+='<div id="play" class="status"></div>';html+='<div id="pause" class="status"></div>';html+='</div>';html+='<div class="videoTopControls hiddenOnIdle">';html+='<div class="videoTopControlsLogo"></div>';html+='<div class="videoAdvancedControls">';html+='<paper-icon-button icon="skip-previous" class="previousTrackButton mediaButton videoTrackControl" onclick="MediaPlayer.previousTrack();"></paper-icon-button>';html+='<paper-icon-button icon="skip-next" class="nextTrackButton mediaButton videoTrackControl" onclick="MediaPlayer.nextTrack();"></paper-icon-button>';html+='<paper-icon-button icon="audiotrack" class="mediaButton videoAudioButton" onclick="MediaPlayer.showAudioTracksFlyout();"></paper-icon-button>';html+='<div data-role="popup" class="videoAudioPopup videoPlayerPopup" data-history="false" data-theme="b"></div>';html+='<paper-icon-button icon="subtitles" class="mediaButton videoSubtitleButton" onclick="MediaPlayer.showSubtitleMenu();"></paper-icon-button>';html+='<div data-role="popup" class="videoSubtitlePopup videoPlayerPopup" data-history="false" data-theme="b"></div>';html+='<paper-icon-button icon="videocam" class="mediaButton videoChaptersButton" onclick="MediaPlayer.showChaptersFlyout();"></paper-icon-button>';html+='<div data-role="popup" class="videoChaptersPopup videoPlayerPopup" data-history="false" data-theme="b"></div>';html+='<paper-icon-button icon="settings" class="mediaButton videoQualityButton" onclick="MediaPlayer.showQualityFlyout();"></paper-icon-button>';html+='<paper-icon-button icon="close" class="mediaButton" onclick="MediaPlayer.stop();"></paper-icon-button>';html+='</div>';html+='</div>';html+='<div class="videoControls hiddenOnIdle">';html+='<div class="nowPlayingInfo hiddenOnIdle">';html+='<div class="nowPlayingImage"></div>';html+='<div class="nowPlayingTabs"></div>';html+='</div>';html+='<paper-icon-button icon="skip-previous" class="previousTrackButton mediaButton videoTrackControl" onclick="MediaPlayer.previousTrack();"></paper-icon-button>';html+='<paper-icon-button id="video-playButton" icon="play-arrow" class="mediaButton unpauseButton" onclick="MediaPlayer.unpause();"></paper-icon-button>';html+='<paper-icon-button id="video-pauseButton" icon="pause" class="mediaButton pauseButton" onclick="MediaPlayer.pause();"></paper-icon-button>';html+='<paper-icon-button icon="skip-next" class="nextTrackButton mediaButton videoTrackControl" onclick="MediaPlayer.nextTrack();"></paper-icon-button>';html+='<paper-slider pin step=".1" min="0" max="100" value="0" class="videoPositionSlider" style="width:300px;vertical-align:middle;margin-left:-1em;"></paper-slider>';html+='<div class="currentTime">--:--</div>';html+='<paper-icon-button icon="volume-up" class="muteButton mediaButton" onclick="MediaPlayer.mute();"></paper-icon-button>';html+='<paper-icon-button icon="volume-off" class="unmuteButton mediaButton" onclick="MediaPlayer.unMute();"></paper-icon-button>';html+='<paper-slider pin step="1" min="0" max="100" value="0" class="videoVolumeSlider" style="width:100px;vertical-align:middle;margin-left:-1em;"></paper-slider>';html+='<paper-icon-button icon="fullscreen" class="mediaButton fullscreenButton" onclick="MediaPlayer.toggleFullscreen();" id="video-fullscreenButton"></paper-icon-button>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';var div=document.createElement('div');div.innerHTML=html;document.body.appendChild(div);}
Dashboard.ready(function(){ensureVideoPlayerElements();var parent=$("#mediaPlayer");muteButton=$('.muteButton',parent);unmuteButton=$('.unmuteButton',parent);currentTimeElement=$('.currentTime',parent);positionSlider=$(".videoPositionSlider",parent).on('change',onPositionSliderChange)[0];positionSlider._setPinValue=function(value){if(!self.currentMediaSource||!self.currentMediaSource.RunTimeTicks){this.pinValue='--:--';return;}
var ticks=self.currentMediaSource.RunTimeTicks;ticks/=100;ticks*=value;this.pinValue=Dashboard.getDisplayTime(ticks);};volumeSlider=$('.videoVolumeSlider',parent).on('change',function(){var vol=this.value;updateVolumeButtons(vol);self.setVolume(vol);})[0];});var idleHandlerTimeout;function idleHandler(){if(idleHandlerTimeout){window.clearTimeout(idleHandlerTimeout);}
if(idleState==true){$('.hiddenOnIdle').removeClass("inactive");$('#videoPlayer').removeClass('idlePlayer');}
idleState=false;idleHandlerTimeout=window.setTimeout(function(){idleState=true;$('.hiddenOnIdle').addClass("inactive");$('#videoPlayer').addClass('idlePlayer');},3500);}
function updateVolumeButtons(vol){if(vol){muteButton.show();unmuteButton.hide();}else{muteButton.hide();unmuteButton.show();}}
function requestFullScreen(element){var requestMethod=element.requestFullscreen||element.webkitRequestFullscreen||element.mozRequestFullScreen||element.msRequestFullscreen;if(requestMethod){requestMethod.call(element);}else{enterFullScreen();}}
function enterFullScreen(){var player=$("#videoPlayer");player.addClass("fullscreenVideo");}
function exitFullScreenToWindow(){var player=$("#videoPlayer");player.removeClass("fullscreenVideo");}
function getChaptersFlyoutHtml(){var item=self.currentItem;var currentTicks=self.getCurrentTicks();var chapters=item.Chapters||[];var html='';html+='<div class="videoPlayerPopupContent">';html+='<ul data-role="listview" data-inset="true"><li data-role="list-divider">'+Globalize.translate('HeaderScenes')+'</li>';html+='</ul>';html+='<div class="videoPlayerPopupScroller">';html+='<ul data-role="listview" data-inset="true">';var index=0;html+=chapters.map(function(chapter){var cssClass="mediaPopupOption";var selected=false;var onclick='';if(currentTicks>=chapter.StartPositionTicks){var nextChapter=chapters[index+1];selected=!nextChapter||currentTicks<nextChapter.StartPositionTicks;}
if(!selected){onclick=' onclick="MediaPlayer.onChapterOptionSelected(this);"';}
var optionHtml='<li><a'+onclick+' data-value="'+chapter.StartPositionTicks+'" class="'+cssClass+'" href="#" style="padding-top:0;padding-bottom:0;">';var imgUrl="css/images/media/chapterflyout.png";if(chapter.ImageTag){optionHtml+='<img src="'+imgUrl+'" style="visibility:hidden;" />';imgUrl=ApiClient.getScaledImageUrl(item.Id,{width:160,tag:chapter.ImageTag,type:"Chapter",index:index});optionHtml+='<div class="videoChapterPopupImage" style="background-image:url(\''+imgUrl+'\');"></div>';}else{optionHtml+='<img src="'+imgUrl+'" />';}
optionHtml+='<p style="margin:12px 0 0;">';var textLines=[];textLines.push(chapter.Name);textLines.push(Dashboard.getDisplayTime(chapter.StartPositionTicks));optionHtml+=textLines.join('<br/>');optionHtml+='</p>';optionHtml+='</a></li>';index++;return optionHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';return html;}
function onPopState(){self.stop();return;}
function onBodyMouseMove(){idleHandler();}
function onFullScreenChange(){if(self.isFullScreen()){enterFullScreen();idleState=true;}else{exitFullScreenToWindow();}}
function bindEventsForPlayback(mediaRenderer){var hideElementsOnIdle=true;if(hideElementsOnIdle){var itemVideo=document.querySelector('.itemVideo');if(itemVideo){Events.on(itemVideo,'mousemove',idleHandler);Events.on(itemVideo,'keydown',idleHandler);Events.on(itemVideo,'scroll',idleHandler);Events.on(itemVideo,'mousedown',idleHandler);idleHandler();}}
$(document).on('webkitfullscreenchange',onFullScreenChange);$(document).on('mozfullscreenchange',onFullScreenChange);$(document).on('msfullscreenchange',onFullScreenChange);$(document).on('fullscreenchange',onFullScreenChange);$(window).one("popstate",onPopState);if(hideElementsOnIdle){$(document.body).on("mousemove",onBodyMouseMove);}}
function unbindEventsForPlayback(mediaRenderer){$(document).off('webkitfullscreenchange',onFullScreenChange);$(document).off('mozfullscreenchange',onFullScreenChange);$(document).off('msfullscreenchange',onFullScreenChange);$(document).off('fullscreenchange',onFullScreenChange);$(window).off("popstate",onPopState);$(document.body).off("mousemove",onBodyMouseMove);var itemVideo=document.querySelector('.itemVideo');if(itemVideo){Events.off(itemVideo,'mousemove',idleHandler);Events.off(itemVideo,'keydown',idleHandler);Events.off(itemVideo,'scroll',idleHandler);Events.off(itemVideo,'mousedown',idleHandler);}}
self.canAutoPlayVideo=function(){if(AppInfo.isNativeApp){return true;}
if($.browser.mobile){return false;}
return true;};self.enableCustomVideoControls=function(){return self.canAutoPlayVideo()&&!$.browser.mobile;};self.cleanup=function(mediaRenderer){currentTimeElement.html('--:--');unbindEventsForPlayback(mediaRenderer);};self.playVideo=function(item,mediaSource,startPosition){requirejs(['videorenderer'],function(){var streamInfo=self.createStreamInfo('Video',item,mediaSource,startPosition);if($.browser.safari&&!mediaSource.RunTimeTicks){Dashboard.showLoadingMsg();ApiClient.ajax({type:'GET',url:streamInfo.url.replace('master.m3u8','live.m3u8')}).always(function(){Dashboard.hideLoadingMsg();}).done(function(){self.playVideoInternal(item,mediaSource,startPosition,streamInfo);});}else{self.playVideoInternal(item,mediaSource,startPosition,streamInfo);}});};function supportsContentOverVideoPlayer(){return true;}
self.playVideoInternal=function(item,mediaSource,startPosition,streamInfo){var videoUrl=streamInfo.url;var contentType=streamInfo.mimeType;var startPositionInSeekParam=streamInfo.startPositionInSeekParam;self.startTimeTicksOffset=streamInfo.startTimeTicksOffset;var mediaStreams=mediaSource.MediaStreams||[];var subtitleStreams=mediaStreams.filter(function(s){return s.Type=='Subtitle';});if(streamInfo.playMethod=='Transcode'&&videoUrl.indexOf('.m3u8')==-1){videoUrl+='&EnableAutoStreamCopy=false';}
var posterCode=self.getPosterUrl(item);posterCode=posterCode?(' poster="'+posterCode+'"'):'';var html='';var requiresNativeControls=!self.enableCustomVideoControls();if(requiresNativeControls&&AppInfo.isNativeApp&&$.browser.android){html+='<video data-viblast-key="N8FjNTQ3NDdhZqZhNGI5NWU5ZTI=" class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay" crossorigin="anonymous" '+posterCode+' webkit-playsinline>';}
else if(requiresNativeControls){html+='<video data-viblast-key="N8FjNTQ3NDdhZqZhNGI5NWU5ZTI=" class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay" crossorigin="anonymous" controls="controls"'+posterCode+' webkit-playsinline>';}
else{html+='<video data-viblast-key="N8FjNTQ3NDdhZqZhNGI5NWU5ZTI=" class="itemVideo" id="itemVideo" preload="metadata" crossorigin="anonymous" autoplay'+posterCode+'>';}
html+='<source type="'+contentType+'" src="'+videoUrl+'" />';var textStreams=subtitleStreams.filter(function(s){return s.DeliveryMethod=='External';});for(var i=0,length=textStreams.length;i<length;i++){var textStream=textStreams[i];var textStreamUrl=!textStream.IsExternalUrl?ApiClient.getUrl(textStream.DeliveryUrl):textStream.DeliveryUrl;var defaultAttribute=textStream.Index==mediaSource.DefaultSubtitleStreamIndex?' default':'';html+='<track kind="subtitles" src="'+textStreamUrl+'" srclang="'+(textStream.Language||'und')+'"'+defaultAttribute+'></track>';}
html+='</video>';var mediaPlayerContainer=$("#mediaPlayer").show();var videoControls=$('.videoControls',mediaPlayerContainer);$('#video-playButton',videoControls).hide();$('#video-pauseButton',videoControls).show();$('.videoTrackControl').hide();var videoElement=$('#videoElement',mediaPlayerContainer).prepend(html);$('.videoQualityButton',videoControls).show();if(mediaStreams.filter(function(s){return s.Type=="Audio";}).length){$('.videoAudioButton').show();}else{$('.videoAudioButton').hide();}
if(subtitleStreams.length){$('.videoSubtitleButton').show();}else{$('.videoSubtitleButton').hide();}
if(item.Chapters&&item.Chapters.length&&supportsContentOverVideoPlayer()){$('.videoChaptersButton').show();}else{$('.videoChaptersButton').hide();}
if(requiresNativeControls){$('#video-fullscreenButton',videoControls).hide();}else{$('#video-fullscreenButton',videoControls).show();}
if(AppInfo.hasPhysicalVolumeButtons){$(volumeSlider).visible(false);$('.muteButton',videoControls).addClass('hide');$('.unmuteButton',videoControls).addClass('hide');}else{$(volumeSlider).visible(true);$('.muteButton',videoControls).removeClass('hide');$('.unmuteButton',videoControls).removeClass('hide');}
if(requiresNativeControls){videoControls.addClass('hide');}else{videoControls.removeClass('hide');}
var mediaRenderer=new VideoRenderer('video');initialVolume=self.getSavedVolume();mediaRenderer.volume(initialVolume);volumeSlider.value=initialVolume*100;updateVolumeButtons(initialVolume);$(mediaRenderer).on("volumechange.mediaplayerevent",function(e){updateVolumeButtons(this.volume());}).one("playing.mediaplayerevent",function(){$(this).on("ended",self.onPlaybackStopped).one('ended',self.playNextAfterEnded);self.onPlaybackStart(this,item,mediaSource);}).on("pause.mediaplayerevent",function(e){$('#video-playButton',videoControls).show();$('#video-pauseButton',videoControls).hide();$("#pause",videoElement).show().addClass("fadeOut");setTimeout(function(){$("#pause",videoElement).hide().removeClass("fadeOut");},300);}).on("playing.mediaplayerevent",function(e){$('#video-playButton',videoControls).hide();$('#video-pauseButton',videoControls).show();$("#play",videoElement).show().addClass("fadeOut");setTimeout(function(){$("#play",videoElement).hide().removeClass("fadeOut");},300);}).on("timeupdate.mediaplayerevent",function(){if(!positionSlider.dragging){self.setCurrentTime(self.getCurrentTicks(this),positionSlider,currentTimeElement);}}).on("error.mediaplayerevent",function(){self.stop();var errorMsg=Globalize.translate('MessageErrorPlayingVideo');if(item.Type=="TvChannel"){errorMsg+='<p>';errorMsg+=Globalize.translate('MessageEnsureOpenTuner');errorMsg+='</p>';}
if($.browser.msie&&!$.browser.mobile&&!self.canPlayWebm()){errorMsg+='<p>';errorMsg+='<a href="https://tools.google.com/dlpage/webmmf/" target="_blank">';errorMsg+=Globalize.translate('MessageInternetExplorerWebm');errorMsg+='</a>';errorMsg+='</p>';}
Dashboard.alert({title:Globalize.translate('HeaderVideoError'),message:errorMsg});}).on("click.mediaplayerevent",function(e){if(!$.browser.mobile){if(this.paused()){self.unpause();}else{self.pause();}}}).on("dblclick.mediaplayerevent",function(){if(!$.browser.mobile){self.toggleFullscreen();}});bindEventsForPlayback(mediaRenderer);mediaPlayerContainer.trigger('create');self.currentSubtitleStreamIndex=mediaSource.DefaultSubtitleStreamIndex;$(document.body).addClass('bodyWithPopupOpen');self.currentMediaRenderer=mediaRenderer;self.currentDurationTicks=self.currentMediaSource.RunTimeTicks;self.updateNowPlayingInfo(item);};self.updatePlaylistUi=function(){var index=self.currentPlaylistIndex(null);var length=self.playlist.length;var requiresNativeControls=!self.enableCustomVideoControls();if(length<2){$('.videoTrackControl').hide();return;}
var controls=requiresNativeControls?'.videoAdvancedControls':'.videoControls';controls=document.querySelector(controls);var previousTrackButton=controls.getElementsByClassName('previousTrackButton')[0];var nextTrackButton=controls.getElementsByClassName('nextTrackButton')[0];if(index===0){previousTrackButton.setAttribute('disabled','disabled');}else{previousTrackButton.removeAttribute('disabled');}
if((index+1)>=length){nextTrackButton.setAttribute('disabled','disabled');}else{nextTrackButton.removeAttribute('disabled');}
$('.videoTrackControl',controls).show();};}
createVideoPlayer(MediaPlayer);})();(function(window,document,$,setTimeout,clearTimeout){var currentPlayer;var currentTimeElement;var nowPlayingImageElement;var nowPlayingTextElement;var nowPlayingUserData;var unmuteButton;var muteButton;var volumeSlider;var unpauseButton;var pauseButton;var positionSlider;var lastPlayerState;function getNowPlayingBarHtml(){var html='';html+='<div class="nowPlayingBar" style="display:none;">';html+='<div class="nowPlayingBarPositionContainer">';html+='<paper-slider pin step=".1" min="0" max="100" value="0" class="nowPlayingBarPositionSlider"></paper-slider>';html+='</div>';html+='<div class="nowPlayingBarInfoContainer">';html+='<div class="nowPlayingImage"></div>';html+='<div class="nowPlayingBarText"></div>';html+='</div>';html+='<div class="nowPlayingBarCenter">';html+='<paper-icon-button icon="skip-previous" class="previousTrackButton mediaButton"></paper-icon-button>';html+='<paper-icon-button icon="play-arrow" class="mediaButton unpauseButton"></paper-icon-button>';html+='<paper-icon-button icon="pause" class="mediaButton pauseButton"></paper-icon-button>';html+='<paper-icon-button icon="stop" class="stopButton mediaButton"></paper-icon-button>';html+='<paper-icon-button icon="skip-next" class="nextTrackButton mediaButton"></paper-icon-button>';html+='<div class="nowPlayingBarCurrentTime"></div>';html+='</div>';html+='<div class="nowPlayingBarRight">';html+='<paper-icon-button icon="volume-up" class="muteButton mediaButton"></paper-icon-button>';html+='<paper-icon-button icon="volume-off" class="unmuteButton mediaButton"></paper-icon-button>';html+='<paper-slider pin step="1" min="0" max="100" value="0" class="nowPlayingBarVolumeSlider" style="width:100px;vertical-align:middle;"></paper-slider>';html+='<div class="nowPlayingBarUserDataButtons">';html+='</div>';html+='<paper-icon-button icon="play-arrow" class="mediaButton unpauseButton"></paper-icon-button>';html+='<paper-icon-button icon="pause" class="mediaButton pauseButton"></paper-icon-button>';html+='<paper-icon-button icon="tablet-android" onclick="Dashboard.navigate(\'nowplaying.html\', false);" class="mediaButton remoteControlButton"></paper-icon-button>';html+='<paper-icon-button icon="queue-music" onclick="Dashboard.navigate(\'nowplaying.html?tab=Playlist\', false);" class="mediaButton playlistButton"></paper-icon-button>';html+='</div>';html+='</div>';return html;}
function bindEvents(elem){currentTimeElement=$('.nowPlayingBarCurrentTime',elem);nowPlayingImageElement=$('.nowPlayingImage',elem);nowPlayingTextElement=$('.nowPlayingBarText',elem);nowPlayingUserData=$('.nowPlayingBarUserDataButtons',elem);$(elem).on('swipeup',function(){Dashboard.navigate('nowplaying.html');});unmuteButton=$('.unmuteButton',elem).on('click',function(){if(currentPlayer){currentPlayer.unMute();}});muteButton=$('.muteButton',elem).on('click',function(){if(currentPlayer){currentPlayer.mute();}});$('.stopButton',elem).on('click',function(){if(currentPlayer){currentPlayer.stop();}});pauseButton=$('.pauseButton',elem).on('click',function(){if(currentPlayer){currentPlayer.pause();}});unpauseButton=$('.unpauseButton',elem).on('click',function(){if(currentPlayer){currentPlayer.unpause();}});$('.nextTrackButton',elem).on('click',function(){if(currentPlayer){currentPlayer.nextTrack();}});$('.previousTrackButton',elem).on('click',function(){if(currentPlayer){currentPlayer.previousTrack();}});volumeSlider=$('.nowPlayingBarVolumeSlider',elem).on('change',function(){if(currentPlayer){currentPlayer.setVolume(this.value);}})[0];positionSlider=$('.nowPlayingBarPositionSlider',elem).on('change',function(){if(currentPlayer&&lastPlayerState){var newPercent=parseFloat(this.value);var newPositionTicks=(newPercent/100)*lastPlayerState.NowPlayingItem.RunTimeTicks;currentPlayer.seek(Math.floor(newPositionTicks));}})[0];positionSlider._setPinValue=function(value){var state=lastPlayerState;if(!state||!state.NowPlayingItem||!state.NowPlayingItem.RunTimeTicks){this.pinValue='--:--';return;}
var ticks=state.NowPlayingItem.RunTimeTicks;ticks/=100;ticks*=value;this.pinValue=Dashboard.getDisplayTime(ticks);};}
function getNowPlayingBar(){var elem=document.querySelector('.nowPlayingBar');if(elem){return elem;}
elem=$(getNowPlayingBarHtml()).insertBefore('#footerNotifications')[0];if($.browser.safari&&$.browser.mobile){elem.classList.add('noMediaProgress');}
bindEvents(elem);return elem;}
function showButton(button){button.removeClass('hide');}
function hideButton(button){button.addClass('hide');}
function updatePlayerState(state){if(state.NowPlayingItem){showNowPlayingBar();}else{hideNowPlayingBar();return;}
lastPlayerState=state;if(!muteButton){getNowPlayingBar();}
var playerInfo=MediaController.getPlayerInfo();var playState=state.PlayState||{};if(playState.IsPaused){hideButton(pauseButton);showButton(unpauseButton);}else{showButton(pauseButton);hideButton(unpauseButton);}
updatePlayerVolumeState(state,playerInfo);var nowPlayingItem=state.NowPlayingItem||{};if(!positionSlider.dragging){if(nowPlayingItem&&nowPlayingItem.RunTimeTicks){var pct=playState.PositionTicks/nowPlayingItem.RunTimeTicks;pct*=100;positionSlider.value=pct;}else{positionSlider.value=0;}
positionSlider.disabled=!playState.CanSeek;}
var timeText=Dashboard.getDisplayTime(playState.PositionTicks);if(nowPlayingItem.RunTimeTicks){timeText+=" / "+Dashboard.getDisplayTime(nowPlayingItem.RunTimeTicks);}
currentTimeElement.html(timeText);updateNowPlayingInfo(state);}
function updatePlayerVolumeState(state,playerInfo){playerInfo=playerInfo||MediaController.getPlayerInfo();if(!muteButton){getNowPlayingBar();}
var playState=state.PlayState||{};var supportedCommands=playerInfo.supportedCommands;var showMuteButton=true;var showUnmuteButton=true;var showVolumeSlider=true;if(supportedCommands.indexOf('Mute')==-1){showMuteButton=false;}
if(supportedCommands.indexOf('Unmute')==-1){showUnmuteButton=false;}
if(playState.IsMuted){showMuteButton=false;}else{showUnmuteButton=false;}
if(supportedCommands.indexOf('SetVolume')==-1){showVolumeSlider=false;}
if(playerInfo.isLocalPlayer&&AppInfo.hasPhysicalVolumeButtons){showMuteButton=false;showUnmuteButton=false;showVolumeSlider=false;}
if(showMuteButton){showButton(muteButton);}else{hideButton(muteButton);}
if(showUnmuteButton){showButton(unmuteButton);}else{hideButton(unmuteButton);}
$(volumeSlider).visible(showVolumeSlider);if(!volumeSlider.dragging){volumeSlider.value=playState.VolumeLevel||0;}}
var currentImgUrl;function updateNowPlayingInfo(state){var nameHtml=MediaController.getNowPlayingNameHtml(state.NowPlayingItem)||'';if(nameHtml.indexOf('<br/>')!=-1){nowPlayingTextElement.addClass('nowPlayingDoubleText');}else{nowPlayingTextElement.removeClass('nowPlayingDoubleText');}
if(state.NowPlayingItem.Id){nameHtml='<a style="color:inherit;text-decoration:none;" href="'+LibraryBrowser.getHref(state.NowPlayingItem)+'">'+nameHtml+'</a>';}
nowPlayingTextElement.html(nameHtml);var url;var imgHeight=90;var nowPlayingItem=state.NowPlayingItem;if(nowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.PrimaryImageItemId,{type:"Primary",height:imgHeight,tag:nowPlayingItem.PrimaryImageTag});}
else if(nowPlayingItem.BackdropImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.BackdropItemId,{type:"Backdrop",height:imgHeight,tag:nowPlayingItem.BackdropImageTag,index:0});}else if(nowPlayingItem.ThumbImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.ThumbImageItemId,{type:"Thumb",height:imgHeight,tag:nowPlayingItem.ThumbImageTag});}
else if(nowPlayingItem.Type=="TvChannel"||nowPlayingItem.Type=="Recording"){url="css/images/items/detail/tv.png";}
else if(nowPlayingItem.MediaType=="Audio"){url="css/images/items/detail/audio.png";}
else{url="css/images/items/detail/video.png";}
if(url==currentImgUrl){return;}
currentImgUrl=url;var imgHtml='<img src="'+url+'" />';nowPlayingImageElement.html(imgHtml);if(nowPlayingItem.Id){ApiClient.getItem(Dashboard.getCurrentUserId(),nowPlayingItem.Id).done(function(item){nowPlayingUserData.html(LibraryBrowser.getUserDataIconsHtml(item,false));});}else{nowPlayingUserData.html('');}}
function onPlaybackStart(e,state){Logger.log('nowplaying event: '+e.type);var player=this;player.beginPlayerUpdates();onStateChanged.call(player,e,state);}
function showNowPlayingBar(){var nowPlayingBar=getNowPlayingBar();$(nowPlayingBar).show();}
function hideNowPlayingBar(){var elem=document.getElementsByClassName('nowPlayingBar')[0];if(elem){elem.style.display='none';}}
function onPlaybackStopped(e,state){Logger.log('nowplaying event: '+e.type);var player=this;player.endPlayerUpdates();hideNowPlayingBar();}
function onStateChanged(e,state){var player=this;if(player.isDefaultPlayer&&state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'){return;}
updatePlayerState(state);}
function releaseCurrentPlayer(){if(currentPlayer){$(currentPlayer).off('playbackstart',onPlaybackStart).off('playbackstop',onPlaybackStopped).off('volumechange',onVolumeChanged).off('playstatechange',onStateChanged).off('positionchange',onStateChanged);currentPlayer.endPlayerUpdates();currentPlayer=null;hideNowPlayingBar();}}
function onVolumeChanged(e){var player=this;player.getPlayerState().done(function(state){if(player.isDefaultPlayer&&state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'){return;}
updatePlayerVolumeState(state);});}
function bindToPlayer(player){releaseCurrentPlayer();currentPlayer=player;player.getPlayerState().done(function(state){if(state.NowPlayingItem){player.beginPlayerUpdates();}
onStateChanged.call(player,{type:'init'},state);});$(player).on('playbackstart',onPlaybackStart).on('playbackstop',onPlaybackStopped).on('volumechange',onVolumeChanged).on('playstatechange',onStateChanged).on('positionchange',onStateChanged);}
Dashboard.ready(function(){Events.on(MediaController,'playerchange',function(){bindToPlayer(MediaController.getCurrentPlayer());});bindToPlayer(MediaController.getCurrentPlayer());});})(window,document,jQuery,setTimeout,clearTimeout);(function(window,document,$){function getPickerHtml(){var html='';html+='<a href="#">#</a>';html+='<a href="#">A</a>';html+='<a href="#">B</a>';html+='<a href="#">C</a>';html+='<a href="#">D</a>';html+='<a href="#">E</a>';html+='<a href="#">F</a>';html+='<a href="#">G</a>';html+='<a href="#">H</a>';html+='<a href="#">I</a>';html+='<a href="#">J</a>';html+='<a href="#">K</a>';html+='<a href="#">L</a>';html+='<a href="#">M</a>';html+='<a href="#">N</a>';html+='<a href="#">O</a>';html+='<a href="#">P</a>';html+='<a href="#">Q</a>';html+='<a href="#">R</a>';html+='<a href="#">S</a>';html+='<a href="#">T</a>';html+='<a href="#">U</a>';html+='<a href="#">V</a>';html+='<a href="#">W</a>';html+='<a href="#">X</a>';html+='<a href="#">Y</a>';html+='<a href="#">Z</a>';return html;}
$(document).on('pageinitdepends',".libraryPage",function(){var page=this;var picker=page.querySelector('.alphabetPicker');if(!picker){return;}
$('.itemsContainer',page).addClass('itemsContainerWithAlphaPicker');picker.innerHTML=getPickerHtml();Events.on(picker,'click','a',function(){var elem=this;var isSelected=elem.classList.contains('selectedCharacter');$('.selectedCharacter',picker).removeClass('selectedCharacter');if(!isSelected){elem.classList.add('selectedCharacter');Events.trigger(picker,'alphaselect',[this.innerHTML]);}else{Events.trigger(picker,'alphaclear');}});});$.fn.alphaValue=function(val){if(val==null){return $('.selectedCharacter',this).html();}
val=val.toLowerCase();$('.selectedCharacter',this).removeClass('selectedCharacter');$('a',this).each(function(){if(this.innerHTML.toLowerCase()==val){this.classList.add('selectedCharacter');}else{this.classList.remove('selectedCharacter');}});return this;};$.fn.alphaClear=function(val){return this.alphaValue('');};})(window,document,jQuery);(function(window,document,$){function refreshDirectoryBrowser(page,path,fileOptions){Dashboard.showLoadingMsg();if(path){$('.networkHeadline').hide();}else{$('.networkHeadline').show();}
var promise;var parentPathPromise=null;if(path==="Network"){promise=ApiClient.getNetworkDevices();}
else if(path){promise=ApiClient.getDirectoryContents(path,fileOptions);parentPathPromise=ApiClient.getParentPath(path);}else{promise=ApiClient.getDrives();}
if(!parentPathPromise){parentPathPromise=$.Deferred();parentPathPromise.resolveWith(null,[]);parentPathPromise=parentPathPromise.promise();}
$.when(promise,parentPathPromise).done(function(response1,response2){var folders=response1[0];var parentPath=response2&&response2.length?response2[0]||'':'';$('#txtDirectoryPickerPath',page).val(path||"");var html='';if(path){html+='<li><a class="lnkPath lnkDirectory" data-path="'+parentPath+'" href="#">..</a></li>';}
for(var i=0,length=folders.length;i<length;i++){var folder=folders[i];var cssClass=folder.Type=="File"?"lnkPath lnkFile":"lnkPath lnkDirectory";html+='<li><a class="'+cssClass+'" data-type="'+folder.Type+'" data-path="'+folder.Path+'" href="#">'+folder.Name+'</a></li>';}
if(!path){html+='<li><a class="lnkPath lnkDirectory" data-path="Network" href="#">'+Globalize.translate('ButtonNetwork')+'</a></li>';}
$('#ulDirectoryPickerList',page).html(html).listview('refresh');Dashboard.hideLoadingMsg();}).fail(function(){$('#txtDirectoryPickerPath',page).val("");$('#ulDirectoryPickerList',page).html('').listview('refresh');Dashboard.hideLoadingMsg();});}
window.DirectoryBrowser=function(page){var self=this;self.show=function(options){options=options||{};var fileOptions={includeDirectories:true};if(options.includeDirectories!=null){fileOptions.includeDirectories=options.includeDirectories;}
if(options.includeFiles!=null){fileOptions.includeFiles=options.includeFiles;}
options.header=options.header||Globalize.translate('HeaderSelectPath');options.instruction=options.instruction||"";var html='<div data-role="popup" id="popupDirectoryPicker" class="popup" style="min-width:65%;">';html+='<div class="ui-bar-a" style="text-align: center; padding: 0 20px;">';html+='<h3>'+options.header+'</h3>';html+='</div>';html+='<div data-role="content" class="ui-content">';html+='<form>';var instruction=options.instruction?options.instruction+'<br/><br/>':'';html+='<p class="directoryPickerHeadline">';html+=instruction;html+=Globalize.translate('MessageDirectoryPickerInstruction').replace('{0}','<b>\\\\server</b>').replace('{1}','<b>\\\\192.168.1.101</b>');html+='</p>';html+='<div style="margin:20px 0 0;">';html+='<label for="txtDirectoryPickerPath" class="lblDirectoryPickerPath">'+Globalize.translate('LabelCurrentPath')+'</label>';html+='<div style="width:82%;display:inline-block;"><input id="txtDirectoryPickerPath" name="txtDirectoryPickerPath" type="text" required="required" style="font-weight:bold;" /></div>';html+='<button class="btnRefreshDirectories" type="button" data-icon="refresh" data-inline="true" data-mini="true" data-iconpos="notext">'+Globalize.translate('ButtonRefresh')+'</button>';html+='</div>';html+='<div style="height: 180px; overflow-y: auto;">';html+='<ul id="ulDirectoryPickerList" data-role="listview" data-inset="true" data-auto-enhanced="false"></ul>';html+='</div>';html+='<p>';html+='<button type="submit" data-theme="b" data-icon="check" data-mini="true">'+Globalize.translate('ButtonOk')+'</button>';html+='<button type="button" data-icon="delete" onclick="$(this).parents(\'.popup\').popup(\'close\');" data-mini="true">'+Globalize.translate('ButtonCancel')+'</button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';$(page).append(html);var popup=$('#popupDirectoryPicker').popup().trigger('create').on("popupafteropen",function(){$('#popupDirectoryPicker input:first',this).focus();}).popup("open").on("popupafterclose",function(){$('form',this).off("submit");$(this).off("click").off("change").off("popupafterclose").remove();}).on("click",".lnkPath",function(){var path=this.getAttribute('data-path');if($(this).hasClass('lnkFile')){$('#txtDirectoryPickerPath',page).val(path);}else{refreshDirectoryBrowser(page,path,fileOptions);}}).on("click",".btnRefreshDirectories",function(){var path=$('#txtDirectoryPickerPath',page).val();refreshDirectoryBrowser(page,path,fileOptions);}).on("change","#txtDirectoryPickerPath",function(){refreshDirectoryBrowser(page,this.value,fileOptions);});var txtCurrentPath=$('#txtDirectoryPickerPath',popup);if(options.path){txtCurrentPath.val(options.path);}
$('form',popup).on('submit',function(){if(options.callback){options.callback($('#txtDirectoryPickerPath',this).val());}
return false;});refreshDirectoryBrowser(page,txtCurrentPath.val());};self.close=function(){$('#popupDirectoryPicker',page).popup("close");};};})(window,document,jQuery);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"BoxSet",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo,CanDelete",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'collections'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();var promise1=ApiClient.getItems(Dashboard.getCurrentUserId(),query);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var result=response1[0];var user=response2[0];window.scrollTo(0,0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,})).trigger('create');updateFilterControls(page);var trigger=false;if(result.TotalRecordCount){if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'movies',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:'movies',showTitle:true,centerText:true,lazy:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:'movies',showTitle:true,cardLayout:true,lazy:true,showItemCounts:true});}
else if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",context:'movies',showTitle:true,centerText:true,lazy:true,preferThumb:true});}
else if(view=="ThumbCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",context:'movies',showTitle:true,lazy:true,preferThumb:true,cardLayout:true,showItemCounts:true});}
$('.noItemsMessage',page).hide();}else{$('.noItemsMessage',page).show();}
var elem=page.querySelector('.itemsContainer');elem.innerHTML=html;ImageLoader.lazyChildren(elem);if(trigger){$(elem).trigger('create');}
$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinitdepends',"#boxsetsPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#chkTrailer',this).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',this).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;reloadItems(page);});$('#chkThemeVideo',this).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshowready',"#boxsetsPage",function(){var page=this;var context=getParameterByName('context');if(context=='movies'){$('.collectionTabs',page).hide();$('.movieTabs',page).show();query.ParentId=null;}else{$('.collectionTabs',page).show();$('.movieTabs',page).hide();query.ParentId=LibraryMenu.getTopParentId();query.ParentId=null;}
var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});updateFilterControls(this);});})(jQuery,document);(function($,document){function getNewCollectionPanel(createIfNeeded){var panel=$('.newCollectionPanel');if(createIfNeeded&&!panel.length){var html='';html+='<div>';html+='<div data-role="panel" class="newCollectionPanel" data-position="right" data-display="overlay" data-position-fixed="true" data-theme="a">';html+='<form class="newCollectionForm">';html+='<h3>'+Globalize.translate('HeaderAddToCollection')+'</h3>';html+='<div class="fldSelectCollection">';html+='<br />';html+='<label for="selectCollectionToAddTo">'+Globalize.translate('LabelSelectCollection')+'</label>';html+='<select id="selectCollectionToAddTo" data-mini="true"></select>';html+='</div>';html+='<div class="newCollectionInfo">';html+='<br />';html+='<div>';html+='<label for="txtNewCollectionName">'+Globalize.translate('LabelName')+'</label>';html+='<input type="text" id="txtNewCollectionName" required="required" />';html+='<div class="fieldDescription">'+Globalize.translate('NewCollectionNameExample')+'</div>';html+='</div>';html+='<br />';html+='<div>';html+='<label for="chkEnableInternetMetadata">'+Globalize.translate('OptionSearchForInternetMetadata')+'</label>';html+='<input type="checkbox" id="chkEnableInternetMetadata" data-mini="true" />';html+='</div>';html+='</div>';html+='<br />';html+='<p>';html+='<input class="fldSelectedItemIds" type="hidden" />';html+='<button type="submit" data-icon="plus" data-mini="true" data-theme="b">'+Globalize.translate('ButtonSubmit')+'</button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';panel=$(html).appendTo(document.body).trigger('create').find('.newCollectionPanel');$('#selectCollectionToAddTo',panel).on('change',function(){if(this.value){$('.newCollectionInfo',panel).hide();$('#txtNewCollectionName',panel).removeAttr('required');}else{$('.newCollectionInfo',panel).show();$('#txtNewCollectionName',panel).attr('required','required');}});$('.newCollectionForm',panel).off('submit',BoxSetEditor.onNewCollectionSubmit).on('submit',BoxSetEditor.onNewCollectionSubmit);}
return panel;}
function showCollectionPanel(items){var panel=getNewCollectionPanel(true).panel('toggle');$('.fldSelectedItemIds',panel).val(items.join(','));require(['jqmicons']);if(items.length){$('.fldSelectCollection',panel).show();populateCollections(panel);}else{$('.fldSelectCollection',panel).hide();$('#selectCollectionToAddTo',panel).html('').val('').selectmenu('refresh').trigger('change');}}
function populateCollections(panel){var select=$('#selectCollectionToAddTo',panel);$('.newCollectionInfo',panel).hide();var options={Recursive:true,IncludeItemTypes:"BoxSet",SortBy:"SortName"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var html='';html+='<option value="">'+Globalize.translate('OptionNewCollection')+'</option>';html+=result.Items.map(function(i){return'<option value="'+i.Id+'">'+i.Name+'</option>';});select.html(html).val('').selectmenu('refresh').trigger('change');});}
$(document).on('pageinitdepends',".collectionEditorPage",function(){var page=this;$(page).on('click','.btnNewCollection',function(){showCollectionPanel([]);});});function redirectToCollection(id){var context=getParameterByName('context');ApiClient.getItem(Dashboard.getCurrentUserId(),id).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,context));});}
function createCollection(panel){var url=ApiClient.getUrl("Collections",{Name:$('#txtNewCollectionName',panel).val(),IsLocked:!$('#chkEnableInternetMetadata',panel).checked(),Ids:$('.fldSelectedItemIds',panel).val()||''});ApiClient.ajax({type:"POST",url:url,dataType:"json"}).done(function(result){Dashboard.hideLoadingMsg();var id=result.Id;panel.panel('toggle');redirectToCollection(id);});}
function addToCollection(panel,id){var url=ApiClient.getUrl("Collections/"+id+"/Items",{Ids:$('.fldSelectedItemIds',panel).val()||''});ApiClient.ajax({type:"POST",url:url}).done(function(){Dashboard.hideLoadingMsg();panel.panel('toggle');Dashboard.alert(Globalize.translate('MessageItemsAdded'));});}
window.BoxSetEditor={showPanel:function(items){showCollectionPanel(items);},onNewCollectionSubmit:function(){Dashboard.showLoadingMsg();var panel=getNewCollectionPanel(false);var collectionId=$('#selectCollectionToAddTo',panel).val();if(collectionId){addToCollection(panel,collectionId);}else{createCollection(panel);}
return false;},supportsAddingToCollection:function(item){var invalidTypes=['Person','Genre','MusicGenre','Studio','GameGenre','BoxSet','Playlist','UserView','CollectionFolder','Audio','Episode'];return item.LocationType=='FileSystem'&&!item.CollectionType&&invalidTypes.indexOf(item.Type)==-1&&item.MediaType!='Photo';}};})(jQuery,document);(function($,document,Dashboard,LibraryBrowser){function notifications(){var self=this;self.getNotificationsSummaryPromise=null;self.total=0;self.getNotificationsSummary=function(){var apiClient=window.ApiClient;if(!apiClient){return;}
self.getNotificationsSummaryPromise=self.getNotificationsSummaryPromise||apiClient.getNotificationSummary(Dashboard.getCurrentUserId());return self.getNotificationsSummaryPromise;};self.updateNotificationCount=function(){if(!Dashboard.getCurrentUserId()){return;}
var promise=self.getNotificationsSummary();if(!promise){return;}
promise.done(function(summary){var item=$('.btnNotificationsInner').removeClass('levelNormal').removeClass('levelWarning').removeClass('levelError').html(summary.UnreadCount);if(summary.UnreadCount){item.addClass('level'+summary.MaxUnreadNotificationLevel);}});};self.markNotificationsRead=function(ids,callback){ApiClient.markNotificationsRead(Dashboard.getCurrentUserId(),ids,true).done(function(){self.getNotificationsSummaryPromise=null;self.updateNotificationCount();if(callback){callback();}});};self.showNotificationsList=function(startIndex,limit,elem){refreshNotifications(startIndex,limit,elem,true);};}
function refreshNotifications(startIndex,limit,elem,showPaging){var apiClient=window.ApiClient;if(apiClient){return apiClient.getNotifications(Dashboard.getCurrentUserId(),{StartIndex:startIndex,Limit:limit}).done(function(result){listUnreadNotifications(result.Notifications,result.TotalRecordCount,startIndex,limit,elem,showPaging);});}}
function listUnreadNotifications(list,totalRecordCount,startIndex,limit,elem,showPaging){if(!totalRecordCount){elem.html('<p style="padding:.5em 1em;">'+Globalize.translate('LabelNoUnreadNotifications')+'</p>');return;}
Notifications.total=totalRecordCount;var html='';if(totalRecordCount>limit&&showPaging===true){var query={StartIndex:startIndex,Limit:limit};html+=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:totalRecordCount,showLimit:false,updatePageSizeSetting:false});}
for(var i=0,length=list.length;i<length;i++){var notification=list[i];html+=getNotificationHtml(notification);}
elem.html(html).trigger('create');}
function getNotificationHtml(notification){var html='';var cssClass=notification.IsRead?"flyoutNotification":"flyoutNotification unreadFlyoutNotification";html+='<div data-notificationid="'+notification.Id+'" class="'+cssClass+'">';html+='<div class="notificationImage">';html+=getImageHtml(notification);html+='</div>';html+='<div class="notificationContent">';html+='<p style="font-size:16px;margin: .5em 0 .5em;" class="notificationName">';if(notification.Url){html+='<a href="'+notification.Url+'" target="_blank" style="text-decoration:none;">'+notification.Name+'</a>';}else{html+=notification.Name;}
html+='</p>';html+='<p class="notificationTime" style="margin: .5em 0;">'+humane_date(notification.Date)+'</p>';if(notification.Description){html+='<p style="margin: .5em 0;max-height:150px;overflow:hidden;text-overflow:ellipsis;">'+notification.Description+'</p>';}
html+='</div>';html+='</div>';return html;}
function getImageHtml(notification){if(notification.Level=="Error"){return'<div class="imgNotification imgNotificationError"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
if(notification.Level=="Warning"){return'<div class="imgNotification imgNotificationWarning"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
return'<div class="imgNotification imgNotificationNormal"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
window.Notifications=new notifications();$(document).on('libraryMenuCreated',function(e){if(window.ApiClient){Notifications.updateNotificationCount();}});function onWebSocketMessage(e,msg){if(msg.MessageType==="NotificationUpdated"||msg.MessageType==="NotificationAdded"||msg.MessageType==="NotificationsMarkedRead"){Notifications.getNotificationsSummaryPromise=null;Notifications.updateNotificationCount();}}
function initializeApiClient(apiClient){$(apiClient).off("websocketmessage",onWebSocketMessage).on("websocketmessage",onWebSocketMessage);}
Dashboard.ready(function(){if(window.ApiClient){initializeApiClient(window.ApiClient);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});});})(jQuery,document,Dashboard,LibraryBrowser);(function(window,document,$){function sendPlayCommand(options,playType){var sessionId=MediaController.getPlayerInfo().id;var ids=options.ids||options.items.map(function(i){return i.Id;});var remoteOptions={ItemIds:ids.join(','),PlayCommand:playType};if(options.startPositionTicks){remoteOptions.startPositionTicks=options.startPositionTicks;}
ApiClient.sendPlayCommand(sessionId,remoteOptions);}
function sendPlayStateCommand(command,options){var sessionId=MediaController.getPlayerInfo().id;ApiClient.sendPlayStateCommand(sessionId,command,options);}
function remoteControlPlayer(){var self=this;self.name='Remote Control';function sendCommandByName(name,options){var command={Name:name};if(options){command.Arguments=options;}
self.sendCommand(command);}
self.sendCommand=function(command){var sessionId=MediaController.getPlayerInfo().id;ApiClient.sendCommand(sessionId,command);};self.play=function(options){sendPlayCommand(options,'PlayNow');};self.shuffle=function(id){sendPlayCommand({ids:[id]},'PlayShuffle');};self.instantMix=function(id){sendPlayCommand({ids:[id]},'PlayInstantMix');};self.queue=function(options){sendPlayCommand(options,'PlayNext');};self.queueNext=function(options){sendPlayCommand(options,'PlayLast');};self.canQueueMediaType=function(mediaType){return mediaType=='Audio'||mediaType=='Video';};self.stop=function(){sendPlayStateCommand('stop');};self.nextTrack=function(){sendPlayStateCommand('nextTrack');};self.previousTrack=function(){sendPlayStateCommand('previousTrack');};self.seek=function(positionTicks){sendPlayStateCommand('seek',{SeekPositionTicks:positionTicks});};self.pause=function(){sendPlayStateCommand('Pause');};self.unpause=function(){sendPlayStateCommand('Unpause');};self.mute=function(){sendCommandByName('Mute');};self.unMute=function(){sendCommandByName('Unmute');};self.toggleMute=function(){sendCommandByName('ToggleMute');};self.setVolume=function(vol){sendCommandByName('SetVolume',{Volume:vol});};self.volumeUp=function(){sendCommandByName('VolumeUp');};self.volumeDown=function(){sendCommandByName('VolumeDown');};self.toggleFullscreen=function(){sendCommandByName('ToggleFullscreen');};self.setAudioStreamIndex=function(index){sendCommandByName('SetAudioStreamIndex',{Index:index});};self.setSubtitleStreamIndex=function(index){sendCommandByName('SetSubtitleStreamIndex',{Index:index});};self.displayContent=function(options){sendCommandByName('DisplayContent',options);};self.getPlayerState=function(){var deferred=$.Deferred();var apiClient=window.ApiClient;if(apiClient){apiClient.getSessions().done(function(sessions){var currentTargetId=MediaController.getPlayerInfo().id;var session=sessions.filter(function(s){return s.Id==currentTargetId;})[0];if(session){session=getPlayerState(session);}
deferred.resolveWith(null,[session]);});}else{deferred.resolveWith(null,[{}]);}
return deferred.promise();};self.subscribeToPlayerUpdates=function(){self.isUpdating=true;if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStart","100,800");}};function unsubscribeFromPlayerUpdates(){self.false=true;if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStop");}}
var playerListenerCount=0;self.beginPlayerUpdates=function(){if(playerListenerCount<=0){playerListenerCount=0;self.subscribeToPlayerUpdates();}
playerListenerCount++;};self.endPlayerUpdates=function(){playerListenerCount--;if(playerListenerCount<=0){unsubscribeFromPlayerUpdates();playerListenerCount=0;}};self.getTargets=function(){var deferred=$.Deferred();var sessionQuery={ControllableByUserId:Dashboard.getCurrentUserId()};var apiClient=window.ApiClient;if(apiClient){apiClient.getSessions(sessionQuery).done(function(sessions){var targets=sessions.filter(function(s){return s.DeviceId!=apiClient.deviceId();}).map(function(s){return{name:s.DeviceName,deviceName:s.DeviceName,id:s.Id,playerName:self.name,appName:s.Client,playableMediaTypes:s.PlayableMediaTypes,isLocalPlayer:false,supportedCommands:s.SupportedCommands};});deferred.resolveWith(null,[targets]);}).fail(function(){deferred.reject();});}else{deferred.resolveWith(null,[]);}
return deferred.promise();};self.tryPair=function(target){var deferred=$.Deferred();deferred.resolve();return deferred.promise();};}
var player=new remoteControlPlayer();MediaController.registerPlayer(player);function getPlayerState(session){return session;}
function firePlaybackEvent(name,session){$(player).trigger(name,[getPlayerState(session)]);}
function onWebSocketConnectionChange(){if(player.isUpdating){player.subscribeToPlayerUpdates();}}
function onWebSocketMessageReceived(e,msg){var apiClient=this;if(msg.MessageType==="Sessions"){var currentTargetId=MediaController.getPlayerInfo().id;var session=msg.Data.filter(function(s){return s.Id==currentTargetId;})[0];if(session){firePlaybackEvent('playstatechange',session);}}
else if(msg.MessageType==="SessionEnded"){Logger.log("Server reports another session ended");if(MediaController.getPlayerInfo().id==msg.Data.Id){MediaController.setDefaultPlayerActive();}}
else if(msg.MessageType==="PlaybackStart"){if(msg.Data.DeviceId!=apiClient.deviceId()){if(MediaController.getPlayerInfo().id==msg.Data.Id){firePlaybackEvent('playbackstart',msg.Data);}}}
else if(msg.MessageType==="PlaybackStopped"){if(msg.Data.DeviceId!=apiClient.deviceId()){if(MediaController.getPlayerInfo().id==msg.Data.Id){firePlaybackEvent('playbackstop',msg.Data);}}}}
function initializeApiClient(apiClient){$(apiClient).on("websocketmessage",onWebSocketMessageReceived).on("websocketopen",onWebSocketConnectionChange);}
Dashboard.ready(function(){if(window.ApiClient){initializeApiClient(window.ApiClient);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});});})(window,document,jQuery);(function($,document,window,clearTimeout,setTimeout){var searchHintTimeout;function clearSearchHintTimeout(){if(searchHintTimeout){clearTimeout(searchHintTimeout);searchHintTimeout=null;}}
function getAdditionalTextLines(hint){if(hint.Type=="Audio"){return[[hint.AlbumArtist,hint.Album].join(" - ")];}
else if(hint.Type=="MusicAlbum"){return[hint.AlbumArtist];}
else if(hint.Type=="MusicArtist"){return[Globalize.translate('LabelArtist')];}
else if(hint.Type=="Movie"){return[Globalize.translate('LabelMovie')];}
else if(hint.Type=="MusicVideo"){return[Globalize.translate('LabelMusicVideo')];}
else if(hint.Type=="Episode"){return[Globalize.translate('LabelEpisode')];}
else if(hint.Type=="Series"){return[Globalize.translate('LabelSeries')];}
else if(hint.Type=="BoxSet"){return[Globalize.translate('LabelCollection')];}
return[hint.Type];}
function search(){var self=this;self.showSearchPanel=function(){showSearchMenu();$('.headerSearchInput').focus();};}
window.Search=new search();function renderSearchResultsInOverlay(elem,hints){hints=hints.map(function(i){i.Id=i.ItemId;i.ImageTags={};i.UserData={};if(i.PrimaryImageTag){i.ImageTags.Primary=i.PrimaryImageTag;}
return i;});var html=LibraryBrowser.getPosterViewHtml({items:hints,shape:"auto",lazy:true,overlayText:false,showTitle:true,coverImage:true,centerImage:true,textLines:getAdditionalTextLines});var itemsContainer=elem.querySelector('.itemsContainer');itemsContainer.innerHTML=html;ImageLoader.lazyChildren(html);}
function requestSearchHintsForOverlay(elem,searchTerm){var currentTimeout=searchHintTimeout;Dashboard.showLoadingMsg();ApiClient.getSearchHints({userId:Dashboard.getCurrentUserId(),searchTerm:searchTerm,limit:30}).done(function(result){if(currentTimeout==searchHintTimeout){renderSearchResultsInOverlay(elem,result.SearchHints);}
Dashboard.hideLoadingMsg();}).fail(function(){Dashboard.hideLoadingMsg();});}
function updateSearchOverlay(elem,searchTerm){if(!searchTerm){$('.itemsContainer',elem).empty();clearSearchHintTimeout();return;}
clearSearchHintTimeout();searchHintTimeout=setTimeout(function(){requestSearchHintsForOverlay(elem,searchTerm);},100);}
function getSearchOverlay(createIfNeeded){var elem=$('.searchResultsOverlay');if(createIfNeeded&&!elem.length){var html='<div class="searchResultsOverlay ui-page-theme-b smoothScrollY">';html+='<div class="searchResultsContainer"><div class="itemsContainer"></div></div></div>';elem=$(html).appendTo(document.body).hide().trigger('create');elem.createCardMenus();}
return elem;}
function onHeaderSearchChange(val){if(val){updateSearchOverlay(getSearchOverlay(true).fadeIn('fast'),val);document.body.classList.add('bodyWithPopupOpen');}else{updateSearchOverlay(getSearchOverlay(false).fadeOut('fast'),val);document.body.classList.remove('bodyWithPopupOpen');}}
function bindSearchEvents(){$('.headerSearchInput').on("keyup",function(e){if(e.keyCode==40){return false;}else{onHeaderSearchChange(this.value);}}).on("search",function(e){if(!this.value){onHeaderSearchChange('');}});$('.btnCloseSearch').on('click',closeSearchOverlay);$('.viewMenuSearchForm').on('submit',function(){return false;});}
function closeSearchOverlay(){$('.headerSearchInput').val('');onHeaderSearchChange('');hideSearchMenu();}
function showSearchMenu(){require(["jquery","velocity"],function($,Velocity){$('.btnCloseSearch').hide();var elem=$('.viewMenuSearch').css({left:'100%'}).removeClass('hide')[0];Velocity.animate(elem,{"left":"0px"},{complete:function(){$('.headerSearchInput').focus();$('.btnCloseSearch').show();}});});}
function hideSearchMenu(){var viewMenuSearch=document.querySelector('.viewMenuSearch');if(!viewMenuSearch){return;}
if(!viewMenuSearch.classList.contains('hide')){require(["jquery","velocity"],function($,Velocity){$('.btnCloseSearch').hide();viewMenuSearch.style.left='0';Velocity.animate(viewMenuSearch,{"left":"100%"},{complete:function(){$('.viewMenuSearch').visible(false);}});});}}
$(document).on('pagebeforehide',".libraryPage",function(){$('#txtSearch',this).val('');$('#searchHints',this).empty();}).on('pagecontainerbeforehide',closeSearchOverlay);$(document).on('headercreated',function(){bindSearchEvents();});})(jQuery,document,window,clearTimeout,setTimeout);(function(document){var currentOwnerId;var currentThemeIds=[];function playThemeSongs(items,ownerId){var player=getPlayer();if(items.length&&player.isDefaultPlayer&&player.canAutoPlayAudio()){if(!currentOwnerId&&player.isPlaying()){return;}
currentThemeIds=items.map(function(i){return i.Id;});currentOwnerId=ownerId;player.play({items:items});}else{currentOwnerId=null;}}
function onPlayItem(item){if(currentThemeIds.indexOf(item.Id)==-1){currentOwnerId=null;}}
function enabled(){var userId=Dashboard.getCurrentUserId();var val=appStorage.getItem('enableThemeSongs-'+userId);var localAutoPlayers=MediaController.getPlayers().filter(function(p){return p.isLocalPlayer&&p.canAutoPlayAudio();});return val=='1'||(val!='0'&&localAutoPlayers.length);}
function getPlayer(){return MediaController.getCurrentPlayer();}
Events.on(document,'thememediadownload',".libraryPage",function(e,themeMediaResult){if(!enabled()){return;}
var ownerId=themeMediaResult.ThemeSongsResult.OwnerId;if(ownerId!=currentOwnerId){playThemeSongs(themeMediaResult.ThemeSongsResult.Items,ownerId);}});})(document);