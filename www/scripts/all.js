/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!n.isArray(a)&&a-parseFloat(a)>=0},isPlainObject:function(a){return"object"!==n.type(a)||a.nodeType||n.isWindow(a)?!1:a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=lb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=mb(b);function pb(){}pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)};function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ub(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}return h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a)return I.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return g.call(b,a)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:l,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=l.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=l,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(n(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(C[a]||n.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return n.each(a.match(E)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&n.each(arguments,function(a,b){var c;while((c=n.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}});function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}n.ready.promise=function(b){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},n.ready.promise();var J=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};n.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,n.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(n.isEmptyObject(f))n.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!n.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)
},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=n.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||n.isArray(c)?d=L.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:n.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=l.createDocumentFragment(),b=a.appendChild(l.createElement("div")),c=l.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof n!==U&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,m,o,p=[d||l],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||l,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+n.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},e||!o.trigger||o.trigger.apply(d,c)!==!1)){if(!e&&!o.noBubble&&!n.isWindow(d)){for(i=o.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||l)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:o.bindType||q,m=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),m&&m.apply(g,c),m=k&&g[k],m&&m.apply&&n.acceptData(g)&&(b.result=m.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!n.acceptData(d)||k&&n.isFunction(d[q])&&!n.isWindow(d)&&(h=d[k],h&&(d[k]=null),n.event.triggered=q,d[q](),n.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>=0:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||l,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=l),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?Z:$):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=Z,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return n().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=n.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}n.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,o=a.length;o>m;m++)if(e=a[m],e||0===e)if("object"===n.type(e))n.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;n.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===n.inArray(e,d))&&(i=n.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f=n.event.special,g=0;void 0!==(c=a[g]);g++){if(n.acceptData(c)&&(e=c[L.expando],e&&(b=L.cache[e]))){if(b.events)for(d in b.events)f[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);L.cache[e]&&delete L.cache[e]}delete M.cache[c[M.expando]]}}}),n.fn.extend({text:function(a){return J(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(ob(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,m=this,o=l-1,p=a[0],q=n.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(c=n.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=n.map(ob(c,"script"),kb),g=f.length;l>j;j++)h=c,j!==o&&(h=n.clone(h,!0,!0),g&&n.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,n.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&n.contains(i,h)&&(h.src?n._evalUrl&&n._evalUrl(h.src):n.globalEval(h.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),n(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d,e=n(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:n.css(e[0],"display");return e.detach(),f}function tb(a){var b=l,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d=l.documentElement,e=l.createElement("div"),f=l.createElement("div");if(f.style){f.style.backgroundClip="content-box",f.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===f.style.backgroundClip,e.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",e.appendChild(f);function g(){f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",f.innerHTML="",d.appendChild(e);var g=a.getComputedStyle(f,null);b="1%"!==g.top,c="4px"===g.width,d.removeChild(e)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return g(),b},boxSizingReliable:function(){return null==c&&g(),c},reliableMarginRight:function(){var b,c=f.appendChild(l.createElement("div"));return c.style.cssText=f.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",f.style.width="1px",d.appendChild(e),b=!parseFloat(a.getComputedStyle(c,null).marginRight),d.removeChild(e),b}})}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+R[f]+"Width",!0,e))):(g+=n.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):(e=S(d),"none"===c&&e||L.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Fb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Fb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||n.isNumeric(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?zb.test(n.css(a,"display"))&&0===a.offsetWidth?n.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(n.cssHooks[a+b].set=Gb)}),n.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&S(a),q=L.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?L.get(a,"olddisplay")||tb(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?tb(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=L.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;L.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ub(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return n.map(k,Ub,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(Xb,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=Xb(this,n.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Lb=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=l.createElement("input"),b=l.createElement("select"),c=b.appendChild(l.createElement("option"));a.type="checkbox",k.checkOn=""!==a.value,k.optSelected=c.selected,b.disabled=!0,k.optDisabled=!c.disabled,a=l.createElement("input"),a.value="t",a.type="radio",k.radioValue="t"===a.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return J(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))
},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||n.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(a,b){return J(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,n.ajaxSettings),b):tc(n.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),sc(nc,k,b,v),2===t)return v;i=k.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(n.lastModified[d]&&v.setRequestHeader("If-Modified-Since",n.lastModified[d]),n.etag[d]&&v.setRequestHeader("If-None-Match",n.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(n.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Bc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Bc(c,a[c],b,e);return d.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Dc)Dc[a]()}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(a){var b;return k.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=n("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),l.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||n.expando+"_"+cc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||l;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var Ic=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;n.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=yb(k.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Mc),b&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n});

/*! jQuery Mobile 1.4.5 | Git HEADhash: 68e55e7 <> 2014-10-31T17:33:30Z | (c) 2010, 2014 jQuery Foundation, Inc. | jquery.org/license */

!function(a,b,c){"function"==typeof define&&define.amd?define(["jquery"],function(d){return c(d,a,b),d.mobile}):c(a.jQuery,a,b)}(this,document,function(a,b,c){!function(a){a.mobile={}}(a),function(a,b){function d(b,c){var d,f,g,h=b.nodeName.toLowerCase();return"area"===h?(d=b.parentNode,f=d.name,b.href&&f&&"map"===d.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&e(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&e(b)}function e(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var f=0,g=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"c0ab71056b936627e8a7821f03c044aec6280a40",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(this[0].ownerDocument||c):b},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++f)})},removeUniqueId:function(){return this.each(function(){g.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return d(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var c=a.attr(b,"tabindex"),e=isNaN(c);return(e||c>=0)&&d(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in c.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(d){if(d!==b)return this.css("zIndex",d);if(this.length)for(var e,f,g=a(this[0]);g.length&&g[0]!==c;){if(e=g.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(f=parseInt(g.css("zIndex"),10),!isNaN(f)&&0!==f))return f;g=g.parent()}return 0}}),a.ui.plugin={add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c,d){var e,f=a.plugins[b];if(f&&(d||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<f.length;e++)a.options[f[e][0]]&&f[e][1].apply(a.element,c)}}}(a),function(a,b){var d=function(b,c){var d=b.parent(),e=[],f=function(){var b=a(this),c=a.mobile.toolbar&&b.data("mobile-toolbar")?b.toolbar("option"):{position:b.attr("data-"+a.mobile.ns+"position"),updatePagePadding:b.attr("data-"+a.mobile.ns+"update-page-padding")!==!1};return!("fixed"===c.position&&c.updatePagePadding===!0)},g=d.children(":jqmData(role='header')").filter(f),h=b.children(":jqmData(role='header')"),i=d.children(":jqmData(role='footer')").filter(f),j=b.children(":jqmData(role='footer')");return 0===h.length&&g.length>0&&(e=e.concat(g.toArray())),0===j.length&&i.length>0&&(e=e.concat(i.toArray())),a.each(e,function(b,d){c-=a(d).outerHeight()}),Math.max(0,c)};a.extend(a.mobile,{window:a(b),document:a(c),keyCode:a.ui.keyCode,behaviors:{},silentScroll:function(c){"number"!==a.type(c)&&(c=a.mobile.defaultHomeScroll),a.event.special.scrollstart.enabled=!1,setTimeout(function(){b.scrollTo(0,c),a.mobile.document.trigger("silentscroll",{x:0,y:c})},20),setTimeout(function(){a.event.special.scrollstart.enabled=!0},150)},getClosestBaseUrl:function(b){var c=a(b).closest(".ui-page").jqmData("url"),d=a.mobile.path.documentBase.hrefNoHash;return a.mobile.dynamicBaseEnabled&&c&&a.mobile.path.isPath(c)||(c=d),a.mobile.path.makeUrlAbsolute(c,d)},removeActiveLinkClass:function(b){!a.mobile.activeClickedLink||a.mobile.activeClickedLink.closest("."+a.mobile.activePageClass).length&&!b||a.mobile.activeClickedLink.removeClass(a.mobile.activeBtnClass),a.mobile.activeClickedLink=null},getInheritedTheme:function(a,b){for(var c,d,e=a[0],f="",g=/ui-(bar|body|overlay)-([a-z])\b/;e&&(c=e.className||"",!(c&&(d=g.exec(c))&&(f=d[2])));)e=e.parentNode;return f||b||"a"},enhanceable:function(a){return this.haveParents(a,"enhance")},hijackable:function(a){return this.haveParents(a,"ajax")},haveParents:function(b,c){if(!a.mobile.ignoreContentEnabled)return b;var d,e,f,g,h,i=b.length,j=a();for(g=0;i>g;g++){for(e=b.eq(g),f=!1,d=b[g];d;){if(h=d.getAttribute?d.getAttribute("data-"+a.mobile.ns+c):"","false"===h){f=!0;break}d=d.parentNode}f||(j=j.add(e))}return j},getScreenHeight:function(){return b.innerHeight||a.mobile.window.height()},resetActivePageHeight:function(b){var c=a("."+a.mobile.activePageClass),e=c.height(),f=c.outerHeight(!0);b=d(c,"number"==typeof b?b:a.mobile.getScreenHeight()),c.css("min-height",""),c.height()<b&&c.css("min-height",b-(f-e))},loading:function(){var b=this.loading._widget||a(a.mobile.loader.prototype.defaultHtml).loader(),c=b.loader.apply(b,arguments);return this.loading._widget=b,c}}),a.addDependents=function(b,c){var d=a(b),e=d.jqmData("dependents")||a();d.jqmData("dependents",a(e).add(c))},a.fn.extend({removeWithDependents:function(){a.removeWithDependents(this)},enhanceWithin:function(){var b,c={},d=a.mobile.page.prototype.keepNativeSelector(),e=this;a.mobile.nojs&&a.mobile.nojs(this),a.mobile.links&&a.mobile.links(this),a.mobile.degradeInputsWithin&&a.mobile.degradeInputsWithin(this),a.fn.buttonMarkup&&this.find(a.fn.buttonMarkup.initSelector).not(d).jqmEnhanceable().buttonMarkup(),a.fn.fieldcontain&&this.find(":jqmData(role='fieldcontain')").not(d).jqmEnhanceable().fieldcontain(),a.each(a.mobile.widgets,function(b,f){if(f.initSelector){var g=a.mobile.enhanceable(e.find(f.initSelector));g.length>0&&(g=g.not(d)),g.length>0&&(c[f.prototype.widgetName]=g)}});for(b in c)c[b][b]();return this},addDependents:function(b){a.addDependents(this,b)},getEncodedText:function(){return a("<a>").text(this.text()).html()},jqmEnhanceable:function(){return a.mobile.enhanceable(this)},jqmHijackable:function(){return a.mobile.hijackable(this)}}),a.removeWithDependents=function(b){var c=a(b);(c.jqmData("dependents")||a()).remove(),c.remove()},a.addDependents=function(b,c){var d=a(b),e=d.jqmData("dependents")||a();d.jqmData("dependents",a(e).add(c))},a.find.matches=function(b,c){return a.find(b,null,null,c)},a.find.matchesSelector=function(b,c){return a.find(c,null,null,[b]).length>0}}(a,this),function(a){a.extend(a.mobile,{version:"1.4.5",subPageUrlKey:"ui-page",hideUrlBar:!0,keepNative:":jqmData(role='none'), :jqmData(role='nojs')",activePageClass:"ui-page-active",activeBtnClass:"ui-btn-active",focusClass:"ui-focus",ajaxEnabled:!0,hashListeningEnabled:!0,linkBindingEnabled:!0,defaultPageTransition:"fade",maxTransitionWidth:!1,minScrollBack:0,defaultDialogTransition:"pop",pageLoadErrorMessage:"Error Loading Page",pageLoadErrorMessageTheme:"a",phonegapNavigationEnabled:!1,autoInitializePage:!0,pushStateEnabled:!0,ignoreContentEnabled:!1,buttonMarkup:{hoverDelay:200},dynamicBaseEnabled:!0,pageContainer:a(),allowCrossDomainPages:!1,dialogHashKey:"&ui-state=dialog"})}(a,this),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];return b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g),g},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return"instance"===g?(j=e,!1):e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),d===b)return f[c]===b?null:f[c];f[c]=d}else{if(d===b)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(a),function(a,b,c){var d={},e=a.find,f=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,g=/:jqmData\(([^)]*)\)/g;a.extend(a.mobile,{ns:"",getAttribute:function(b,c){var d;b=b.jquery?b[0]:b,b&&b.getAttribute&&(d=b.getAttribute("data-"+a.mobile.ns+c));try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:f.test(d)?JSON.parse(d):d}catch(e){}return d},nsNormalizeDict:d,nsNormalize:function(b){return d[b]||(d[b]=a.camelCase(a.mobile.ns+b))},closestPageData:function(a){return a.closest(":jqmData(role='page'), :jqmData(role='dialog')").data("mobile-page")}}),a.fn.jqmData=function(b,d){var e;return"undefined"!=typeof b&&(b&&(b=a.mobile.nsNormalize(b)),e=arguments.length<2||d===c?this.data(b):this.data(b,d)),e},a.jqmData=function(b,c,d){var e;return"undefined"!=typeof c&&(e=a.data(b,c?a.mobile.nsNormalize(c):c,d)),e},a.fn.jqmRemoveData=function(b){return this.removeData(a.mobile.nsNormalize(b))},a.jqmRemoveData=function(b,c){return a.removeData(b,a.mobile.nsNormalize(c))},a.find=function(b,c,d,f){return b.indexOf(":jqmData")>-1&&(b=b.replace(g,"[data-"+(a.mobile.ns||"")+"$1]")),e.call(this,b,c,d,f)},a.extend(a.find,e)}(a,this),function(a){var b=/[A-Z]/g,c=function(a){return"-"+a.toLowerCase()};a.extend(a.Widget.prototype,{_getCreateOptions:function(){var d,e,f=this.element[0],g={};if(!a.mobile.getAttribute(f,"defaults"))for(d in this.options)e=a.mobile.getAttribute(f,d.replace(b,c)),null!=e&&(g[d]=e);return g}}),a.mobile.widget=a.Widget}(a),function(a){var b="ui-loader",c=a("html");a.widget("mobile.loader",{options:{theme:"a",textVisible:!1,html:"",text:"loading"},defaultHtml:"<div class='"+b+"'><span class='ui-icon-loading'></span><h1></h1></div>",fakeFixLoader:function(){var b=a("."+a.mobile.activeBtnClass).first();this.element.css({top:a.support.scrollTop&&this.window.scrollTop()+this.window.height()/2||b.length&&b.offset().top||100})},checkLoaderPosition:function(){var b=this.element.offset(),c=this.window.scrollTop(),d=a.mobile.getScreenHeight();(b.top<c||b.top-c>d)&&(this.element.addClass("ui-loader-fakefix"),this.fakeFixLoader(),this.window.unbind("scroll",this.checkLoaderPosition).bind("scroll",a.proxy(this.fakeFixLoader,this)))},resetHtml:function(){this.element.html(a(this.defaultHtml).html())},show:function(d,e,f){var g,h,i;this.resetHtml(),"object"===a.type(d)?(i=a.extend({},this.options,d),d=i.theme):(i=this.options,d=d||i.theme),h=e||(i.text===!1?"":i.text),c.addClass("ui-loading"),g=i.textVisible,this.element.attr("class",b+" ui-corner-all ui-body-"+d+" ui-loader-"+(g||e||d.text?"verbose":"default")+(i.textonly||f?" ui-loader-textonly":"")),i.html?this.element.html(i.html):this.element.find("h1").text(h),this.element.appendTo(a(a.mobile.pagecontainer?":mobile-pagecontainer":"body")),this.checkLoaderPosition(),this.window.bind("scroll",a.proxy(this.checkLoaderPosition,this))},hide:function(){c.removeClass("ui-loading"),this.options.text&&this.element.removeClass("ui-loader-fakefix"),this.window.unbind("scroll",this.fakeFixLoader),this.window.unbind("scroll",this.checkLoaderPosition)}})}(a,this),function(a,b,d){"$:nomunge";function e(a){return a=a||location.href,"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var f,g="hashchange",h=c,i=a.event.special,j=h.documentMode,k="on"+g in b&&(j===d||j>7);a.fn[g]=function(a){return a?this.bind(g,a):this.trigger(g)},a.fn[g].delay=50,i[g]=a.extend(i[g],{setup:function(){return k?!1:void a(f.start)},teardown:function(){return k?!1:void a(f.stop)}}),f=function(){function c(){var d=e(),h=n(j);d!==j?(m(j=d,h),a(b).trigger(g)):h!==j&&(location.href=location.href.replace(/#.*/,"")+h),f=setTimeout(c,a.fn[g].delay)}var f,i={},j=e(),l=function(a){return a},m=l,n=l;return i.start=function(){f||c()},i.stop=function(){f&&clearTimeout(f),f=d},b.attachEvent&&!b.addEventListener&&!k&&function(){var b,d;i.start=function(){b||(d=a.fn[g].src,d=d&&d+e(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){d||m(e()),c()}).attr("src",d||"javascript:0").insertAfter("body")[0].contentWindow,h.onpropertychange=function(){try{"title"===event.propertyName&&(b.document.title=h.title)}catch(a){}})},i.stop=l,n=function(){return e(b.location.href)},m=function(c,d){var e=b.document,f=a.fn[g].domain;c!==d&&(e.title=h.title,e.open(),f&&e.write('<script>document.domain="'+f+'"</script>'),e.close(),b.location.hash=c)}}(),i}()}(a,this),function(a){b.matchMedia=b.matchMedia||function(a){var b,c=a.documentElement,d=c.firstElementChild||c.firstChild,e=a.createElement("body"),f=a.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),function(a){return f.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',c.insertBefore(e,d),b=42===f.offsetWidth,c.removeChild(e),{matches:b,media:a}}}(c),a.mobile.media=function(a){return b.matchMedia(a).matches}}(a),function(a){var b={touch:"ontouchend"in c};a.mobile.support=a.mobile.support||{},a.extend(a.support,b),a.extend(a.mobile.support,b)}(a),function(a){a.extend(a.support,{orientation:"orientation"in b&&"onorientationchange"in b})}(a),function(a,d){function e(a){var b,c=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+o.join(c+" ")+c).split(" ");for(b in e)if(n[e[b]]!==d)return!0}function f(){var c=b,d=!(!c.document.createElementNS||!c.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||c.opera&&-1===navigator.userAgent.indexOf("Chrome")),e=function(b){b&&d||a("html").addClass("ui-nosvg")},f=new c.Image;f.onerror=function(){e(!1)},f.onload=function(){e(1===f.width&&1===f.height)},f.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}function g(){var e,f,g,h="transform-3d",i=a.mobile.media("(-"+o.join("-"+h+"),(-")+"-"+h+"),("+h+")");if(i)return!!i;e=c.createElement("div"),f={MozTransform:"-moz-transform",transform:"transform"},m.append(e);for(g in f)e.style[g]!==d&&(e.style[g]="translate3d( 100px, 1px, 1px )",i=b.getComputedStyle(e).getPropertyValue(f[g]));return!!i&&"none"!==i}function h(){var b,c,d=location.protocol+"//"+location.host+location.pathname+"ui-dir/",e=a("head base"),f=null,g="";return e.length?g=e.attr("href"):e=f=a("<base>",{href:d}).appendTo("head"),b=a("<a href='testurl' />").prependTo(m),c=b[0].href,e[0].href=g||location.pathname,f&&f.remove(),0===c.indexOf(d)}function i(){var a,d=c.createElement("x"),e=c.documentElement,f=b.getComputedStyle;return"pointerEvents"in d.style?(d.style.pointerEvents="auto",d.style.pointerEvents="x",e.appendChild(d),a=f&&"auto"===f(d,"").pointerEvents,e.removeChild(d),!!a):!1}function j(){var a=c.createElement("div");return"undefined"!=typeof a.getBoundingClientRect}function k(){var a=b,c=navigator.userAgent,d=navigator.platform,e=c.match(/AppleWebKit\/([0-9]+)/),f=!!e&&e[1],g=c.match(/Fennec\/([0-9]+)/),h=!!g&&g[1],i=c.match(/Opera Mobi\/([0-9]+)/),j=!!i&&i[1];return(d.indexOf("iPhone")>-1||d.indexOf("iPad")>-1||d.indexOf("iPod")>-1)&&f&&534>f||a.operamini&&"[object OperaMini]"==={}.toString.call(a.operamini)||i&&7458>j||c.indexOf("Android")>-1&&f&&533>f||h&&6>h||"palmGetResource"in b&&f&&534>f||c.indexOf("MeeGo")>-1&&c.indexOf("NokiaBrowser/8.5.0")>-1?!1:!0}var l,m=a("<body>").prependTo("html"),n=m[0].style,o=["Webkit","Moz","O"],p="palmGetResource"in b,q=b.operamini&&"[object OperaMini]"==={}.toString.call(b.operamini),r=b.blackberry&&!e("-webkit-transform");a.extend(a.mobile,{browser:{}}),a.mobile.browser.oldIE=function(){var a=3,b=c.createElement("div"),d=b.all||[];do b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]-->";while(d[0]);return a>4?a:!a}(),a.extend(a.support,{pushState:"pushState"in history&&"replaceState"in history&&!(b.navigator.userAgent.indexOf("Firefox")>=0&&b.top!==b)&&-1===b.navigator.userAgent.search(/CriOS/),mediaquery:a.mobile.media("only all"),cssPseudoElement:!!e("content"),touchOverflow:!!e("overflowScrolling"),cssTransform3d:g(),boxShadow:!!e("boxShadow")&&!r,fixedPosition:k(),scrollTop:("pageXOffset"in b||"scrollTop"in c.documentElement||"scrollTop"in m[0])&&!p&&!q,dynamicBaseTag:h(),cssPointerEvents:i(),boundingRect:j(),inlineSVG:f}),m.remove(),l=function(){var a=b.navigator.userAgent;return a.indexOf("Nokia")>-1&&(a.indexOf("Symbian/3")>-1||a.indexOf("Series60/5")>-1)&&a.indexOf("AppleWebKit")>-1&&a.match(/(BrowserNG|NokiaBrowser)\/7\.[0-3]/)}(),a.mobile.gradeA=function(){return(a.support.mediaquery&&a.support.cssPseudoElement||a.mobile.browser.oldIE&&a.mobile.browser.oldIE>=8)&&(a.support.boundingRect||null!==a.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/))},a.mobile.ajaxBlacklist=b.blackberry&&!b.WebKitPoint||q||l,l&&a(function(){a("head link[rel='stylesheet']").attr("rel","alternate stylesheet").attr("rel","stylesheet")}),a.support.boxShadow||a("html").addClass("ui-noboxshadow")}(a),function(a,b){var c,d=a.mobile.window,e=function(){};a.event.special.beforenavigate={setup:function(){d.on("navigate",e)},teardown:function(){d.off("navigate",e)}},a.event.special.navigate=c={bound:!1,pushStateEnabled:!0,originalEventName:b,isPushStateEnabled:function(){return a.support.pushState&&a.mobile.pushStateEnabled===!0&&this.isHashChangeEnabled()},isHashChangeEnabled:function(){return a.mobile.hashListeningEnabled===!0},popstate:function(b){var c=new a.Event("navigate"),e=new a.Event("beforenavigate"),f=b.originalEvent.state||{};e.originalEvent=b,d.trigger(e),e.isDefaultPrevented()||(b.historyState&&a.extend(f,b.historyState),c.originalEvent=b,setTimeout(function(){d.trigger(c,{state:f})},0))},hashchange:function(b){var c=new a.Event("navigate"),e=new a.Event("beforenavigate");e.originalEvent=b,d.trigger(e),e.isDefaultPrevented()||(c.originalEvent=b,d.trigger(c,{state:b.hashchangeState||{}}))},setup:function(){c.bound||(c.bound=!0,c.isPushStateEnabled()?(c.originalEventName="popstate",d.bind("popstate.navigate",c.popstate)):c.isHashChangeEnabled()&&(c.originalEventName="hashchange",d.bind("hashchange.navigate",c.hashchange)))}}}(a),function(a,c){var d,e,f="&ui-state=dialog";a.mobile.path=d={uiStateKey:"&ui-state",urlParseRE:/^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,getLocation:function(a){var b=this.parseUrl(a||location.href),c=a?b:location,d=b.hash;return d="#"===d?"":d,c.protocol+b.doubleSlash+c.host+(""!==c.protocol&&"/"!==c.pathname.substring(0,1)?"/":"")+c.pathname+c.search+d},getDocumentUrl:function(b){return b?a.extend({},d.documentUrl):d.documentUrl.href},parseLocation:function(){return this.parseUrl(this.getLocation())},parseUrl:function(b){if("object"===a.type(b))return b;var c=d.urlParseRE.exec(b||"")||[];return{href:c[0]||"",hrefNoHash:c[1]||"",hrefNoSearch:c[2]||"",domain:c[3]||"",protocol:c[4]||"",doubleSlash:c[5]||"",authority:c[6]||"",username:c[8]||"",password:c[9]||"",host:c[10]||"",hostname:c[11]||"",port:c[12]||"",pathname:c[13]||"",directory:c[14]||"",filename:c[15]||"",search:c[16]||"",hash:c[17]||""}},makePathAbsolute:function(a,b){var c,d,e,f;if(a&&"/"===a.charAt(0))return a;for(a=a||"",b=b?b.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"",c=b?b.split("/"):[],d=a.split("/"),e=0;e<d.length;e++)switch(f=d[e]){case".":break;case"..":c.length&&c.pop();break;default:c.push(f)}return"/"+c.join("/")},isSameDomain:function(a,b){return d.parseUrl(a).domain.toLowerCase()===d.parseUrl(b).domain.toLowerCase()},isRelativeUrl:function(a){return""===d.parseUrl(a).protocol},isAbsoluteUrl:function(a){return""!==d.parseUrl(a).protocol},makeUrlAbsolute:function(a,b){if(!d.isRelativeUrl(a))return a;b===c&&(b=this.documentBase);var e=d.parseUrl(a),f=d.parseUrl(b),g=e.protocol||f.protocol,h=e.protocol?e.doubleSlash:e.doubleSlash||f.doubleSlash,i=e.authority||f.authority,j=""!==e.pathname,k=d.makePathAbsolute(e.pathname||f.filename,f.pathname),l=e.search||!j&&f.search||"",m=e.hash;return g+h+i+k+l+m},addSearchParams:function(b,c){var e=d.parseUrl(b),f="object"==typeof c?a.param(c):c,g=e.search||"?";return e.hrefNoSearch+g+("?"!==g.charAt(g.length-1)?"&":"")+f+(e.hash||"")},convertUrlToDataUrl:function(a){var c=a,e=d.parseUrl(a);return d.isEmbeddedPage(e)?c=e.hash.split(f)[0].replace(/^#/,"").replace(/\?.*$/,""):d.isSameDomain(e,this.documentBase)&&(c=e.hrefNoHash.replace(this.documentBase.domain,"").split(f)[0]),b.decodeURIComponent(c)},get:function(a){return a===c&&(a=d.parseLocation().hash),d.stripHash(a).replace(/[^\/]*\.[^\/*]+$/,"")},set:function(a){location.hash=a},isPath:function(a){return/\//.test(a)},clean:function(a){return a.replace(this.documentBase.domain,"")},stripHash:function(a){return a.replace(/^#/,"")},stripQueryParams:function(a){return a.replace(/\?.*$/,"")},cleanHash:function(a){return d.stripHash(a.replace(/\?.*$/,"").replace(f,""))},isHashValid:function(a){return/^#[^#]+$/.test(a)},isExternal:function(a){var b=d.parseUrl(a);return!(!b.protocol||b.domain.toLowerCase()===this.documentUrl.domain.toLowerCase())},hasProtocol:function(a){return/^(:?\w+:)/.test(a)},isEmbeddedPage:function(a){var b=d.parseUrl(a);return""!==b.protocol?!this.isPath(b.hash)&&b.hash&&(b.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&b.hrefNoHash===this.documentBase.hrefNoHash):/^#/.test(b.href)},squash:function(a,b){var c,e,f,g,h,i=this.isPath(a),j=this.parseUrl(a),k=j.hash,l="";return b||(i?b=d.getLocation():(h=d.getDocumentUrl(!0),b=d.isPath(h.hash)?d.squash(h.href):h.href)),e=i?d.stripHash(a):a,e=d.isPath(j.hash)?d.stripHash(j.hash):e,g=e.indexOf(this.uiStateKey),g>-1&&(l=e.slice(g),e=e.slice(0,g)),c=d.makeUrlAbsolute(e,b),f=this.parseUrl(c).search,i?((d.isPath(k)||0===k.replace("#","").indexOf(this.uiStateKey))&&(k=""),l&&-1===k.indexOf(this.uiStateKey)&&(k+=l),-1===k.indexOf("#")&&""!==k&&(k="#"+k),c=d.parseUrl(c),c=c.protocol+c.doubleSlash+c.host+c.pathname+f+k):c+=c.indexOf("#")>-1?l:"#"+l,c},isPreservableHash:function(a){return 0===a.replace("#","").indexOf(this.uiStateKey)},hashToSelector:function(a){var b="#"===a.substring(0,1);return b&&(a=a.substring(1)),(b?"#":"")+a.replace(/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g,"\\$1")},getFilePath:function(a){return a&&a.split(f)[0]},isFirstPageUrl:function(b){var e=d.parseUrl(d.makeUrlAbsolute(b,this.documentBase)),f=e.hrefNoHash===this.documentUrl.hrefNoHash||this.documentBaseDiffers&&e.hrefNoHash===this.documentBase.hrefNoHash,g=a.mobile.firstPage,h=g&&g[0]?g[0].id:c;return f&&(!e.hash||"#"===e.hash||h&&e.hash.replace(/^#/,"")===h)},isPermittedCrossDomainRequest:function(b,c){return a.mobile.allowCrossDomainPages&&("file:"===b.protocol||"content:"===b.protocol)&&-1!==c.search(/^https?:/)}},d.documentUrl=d.parseLocation(),e=a("head").find("base"),d.documentBase=e.length?d.parseUrl(d.makeUrlAbsolute(e.attr("href"),d.documentUrl.href)):d.documentUrl,d.documentBaseDiffers=d.documentUrl.hrefNoHash!==d.documentBase.hrefNoHash,d.getDocumentBase=function(b){return b?a.extend({},d.documentBase):d.documentBase.href},a.extend(a.mobile,{getDocumentUrl:d.getDocumentUrl,getDocumentBase:d.getDocumentBase})}(a),function(a,b){a.mobile.History=function(a,b){this.stack=a||[],this.activeIndex=b||0},a.extend(a.mobile.History.prototype,{getActive:function(){return this.stack[this.activeIndex]},getLast:function(){return this.stack[this.previousIndex]},getNext:function(){return this.stack[this.activeIndex+1]},getPrev:function(){return this.stack[this.activeIndex-1]},add:function(a,b){b=b||{},this.getNext()&&this.clearForward(),b.hash&&-1===b.hash.indexOf("#")&&(b.hash="#"+b.hash),b.url=a,this.stack.push(b),this.activeIndex=this.stack.length-1},clearForward:function(){this.stack=this.stack.slice(0,this.activeIndex+1)},find:function(a,b,c){b=b||this.stack;var d,e,f,g=b.length;for(e=0;g>e;e++)if(d=b[e],(decodeURIComponent(a)===decodeURIComponent(d.url)||decodeURIComponent(a)===decodeURIComponent(d.hash))&&(f=e,c))return f;return f},closest:function(a){var c,d=this.activeIndex;return c=this.find(a,this.stack.slice(0,d)),c===b&&(c=this.find(a,this.stack.slice(d),!0),c=c===b?c:c+d),c},direct:function(c){var d=this.closest(c.url),e=this.activeIndex;d!==b&&(this.activeIndex=d,this.previousIndex=e),e>d?(c.present||c.back||a.noop)(this.getActive(),"back"):d>e?(c.present||c.forward||a.noop)(this.getActive(),"forward"):d===b&&c.missing&&c.missing(this.getActive())}})}(a),function(a){var d=a.mobile.path,e=location.href;a.mobile.Navigator=function(b){this.history=b,this.ignoreInitialHashChange=!0,a.mobile.window.bind({"popstate.history":a.proxy(this.popstate,this),"hashchange.history":a.proxy(this.hashchange,this)})},a.extend(a.mobile.Navigator.prototype,{squash:function(e,f){var g,h,i=d.isPath(e)?d.stripHash(e):e;return h=d.squash(e),g=a.extend({hash:i,url:h},f),b.history.replaceState(g,g.title||c.title,h),g},hash:function(a,b){var c,e,f,g;return c=d.parseUrl(a),e=d.parseLocation(),e.pathname+e.search===c.pathname+c.search?f=c.hash?c.hash:c.pathname+c.search:d.isPath(a)?(g=d.parseUrl(b),f=g.pathname+g.search+(d.isPreservableHash(g.hash)?g.hash.replace("#",""):"")):f=a,f},go:function(e,f,g){var h,i,j,k,l=a.event.special.navigate.isPushStateEnabled();
i=d.squash(e),j=this.hash(e,i),g&&j!==d.stripHash(d.parseLocation().hash)&&(this.preventNextHashChange=g),this.preventHashAssignPopState=!0,b.location.hash=j,this.preventHashAssignPopState=!1,h=a.extend({url:i,hash:j,title:c.title},f),l&&(k=new a.Event("popstate"),k.originalEvent={type:"popstate",state:null},this.squash(e,h),g||(this.ignorePopState=!0,a.mobile.window.trigger(k))),this.history.add(h.url,h)},popstate:function(b){var c,f;if(a.event.special.navigate.isPushStateEnabled())return this.preventHashAssignPopState?(this.preventHashAssignPopState=!1,void b.stopImmediatePropagation()):this.ignorePopState?void(this.ignorePopState=!1):!b.originalEvent.state&&1===this.history.stack.length&&this.ignoreInitialHashChange&&(this.ignoreInitialHashChange=!1,location.href===e)?void b.preventDefault():(c=d.parseLocation().hash,!b.originalEvent.state&&c?(f=this.squash(c),this.history.add(f.url,f),void(b.historyState=f)):void this.history.direct({url:(b.originalEvent.state||{}).url||c,present:function(c,d){b.historyState=a.extend({},c),b.historyState.direction=d}}))},hashchange:function(b){var e,f;if(a.event.special.navigate.isHashChangeEnabled()&&!a.event.special.navigate.isPushStateEnabled()){if(this.preventNextHashChange)return this.preventNextHashChange=!1,void b.stopImmediatePropagation();e=this.history,f=d.parseLocation().hash,this.history.direct({url:f,present:function(c,d){b.hashchangeState=a.extend({},c),b.hashchangeState.direction=d},missing:function(){e.add(f,{hash:f,title:c.title})}})}}})}(a),function(a){a.mobile.navigate=function(b,c,d){a.mobile.navigate.navigator.go(b,c,d)},a.mobile.navigate.history=new a.mobile.History,a.mobile.navigate.navigator=new a.mobile.Navigator(a.mobile.navigate.history);var b=a.mobile.path.parseLocation();a.mobile.navigate.history.add(b.href,{hash:b.hash})}(a),function(a,b){var d={animation:{},transition:{}},e=c.createElement("a"),f=["","webkit-","moz-","o-"];a.each(["animation","transition"],function(c,g){var h=0===c?g+"-name":g;a.each(f,function(c,f){return e.style[a.camelCase(f+h)]!==b?(d[g].prefix=f,!1):void 0}),d[g].duration=a.camelCase(d[g].prefix+g+"-duration"),d[g].event=a.camelCase(d[g].prefix+g+"-end"),""===d[g].prefix&&(d[g].event=d[g].event.toLowerCase())}),a.support.cssTransitions=d.transition.prefix!==b,a.support.cssAnimations=d.animation.prefix!==b,a(e).remove(),a.fn.animationComplete=function(e,f,g){var h,i,j=this,k=function(){clearTimeout(h),e.apply(this,arguments)},l=f&&"animation"!==f?"transition":"animation";return a.support.cssTransitions&&"transition"===l||a.support.cssAnimations&&"animation"===l?(g===b&&(a(this).context!==c&&(i=3e3*parseFloat(a(this).css(d[l].duration))),(0===i||i===b||isNaN(i))&&(i=a.fn.animationComplete.defaultDuration)),h=setTimeout(function(){a(j).off(d[l].event,k),e.apply(j)},i),a(this).one(d[l].event,k)):(setTimeout(a.proxy(e,this),0),a(this))},a.fn.animationComplete.defaultDuration=1e3}(a),function(a,b,c,d){function e(a){for(;a&&"undefined"!=typeof a.originalEvent;)a=a.originalEvent;return a}function f(b,c){var f,g,h,i,j,k,l,m,n,o=b.type;if(b=a.Event(b),b.type=c,f=b.originalEvent,g=a.event.props,o.search(/^(mouse|click)/)>-1&&(g=E),f)for(l=g.length,i;l;)i=g[--l],b[i]=f[i];if(o.search(/mouse(down|up)|click/)>-1&&!b.which&&(b.which=1),-1!==o.search(/^touch/)&&(h=e(f),o=h.touches,j=h.changedTouches,k=o&&o.length?o[0]:j&&j.length?j[0]:d))for(m=0,n=C.length;n>m;m++)i=C[m],b[i]=k[i];return b}function g(b){for(var c,d,e={};b;){c=a.data(b,z);for(d in c)c[d]&&(e[d]=e.hasVirtualBinding=!0);b=b.parentNode}return e}function h(b,c){for(var d;b;){if(d=a.data(b,z),d&&(!c||d[c]))return b;b=b.parentNode}return null}function i(){M=!1}function j(){M=!0}function k(){Q=0,K.length=0,L=!1,j()}function l(){i()}function m(){n(),G=setTimeout(function(){G=0,k()},a.vmouse.resetTimerDuration)}function n(){G&&(clearTimeout(G),G=0)}function o(b,c,d){var e;return(d&&d[b]||!d&&h(c.target,b))&&(e=f(c,b),a(c.target).trigger(e)),e}function p(b){var c,d=a.data(b.target,A);L||Q&&Q===d||(c=o("v"+b.type,b),c&&(c.isDefaultPrevented()&&b.preventDefault(),c.isPropagationStopped()&&b.stopPropagation(),c.isImmediatePropagationStopped()&&b.stopImmediatePropagation()))}function q(b){var c,d,f,h=e(b).touches;h&&1===h.length&&(c=b.target,d=g(c),d.hasVirtualBinding&&(Q=P++,a.data(c,A,Q),n(),l(),J=!1,f=e(b).touches[0],H=f.pageX,I=f.pageY,o("vmouseover",b,d),o("vmousedown",b,d)))}function r(a){M||(J||o("vmousecancel",a,g(a.target)),J=!0,m())}function s(b){if(!M){var c=e(b).touches[0],d=J,f=a.vmouse.moveDistanceThreshold,h=g(b.target);J=J||Math.abs(c.pageX-H)>f||Math.abs(c.pageY-I)>f,J&&!d&&o("vmousecancel",b,h),o("vmousemove",b,h),m()}}function t(a){if(!M){j();var b,c,d=g(a.target);o("vmouseup",a,d),J||(b=o("vclick",a,d),b&&b.isDefaultPrevented()&&(c=e(a).changedTouches[0],K.push({touchID:Q,x:c.clientX,y:c.clientY}),L=!0)),o("vmouseout",a,d),J=!1,m()}}function u(b){var c,d=a.data(b,z);if(d)for(c in d)if(d[c])return!0;return!1}function v(){}function w(b){var c=b.substr(1);return{setup:function(){u(this)||a.data(this,z,{});var d=a.data(this,z);d[b]=!0,F[b]=(F[b]||0)+1,1===F[b]&&O.bind(c,p),a(this).bind(c,v),N&&(F.touchstart=(F.touchstart||0)+1,1===F.touchstart&&O.bind("touchstart",q).bind("touchend",t).bind("touchmove",s).bind("scroll",r))},teardown:function(){--F[b],F[b]||O.unbind(c,p),N&&(--F.touchstart,F.touchstart||O.unbind("touchstart",q).unbind("touchmove",s).unbind("touchend",t).unbind("scroll",r));var d=a(this),e=a.data(this,z);e&&(e[b]=!1),d.unbind(c,v),u(this)||d.removeData(z)}}}var x,y,z="virtualMouseBindings",A="virtualTouchID",B="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),C="clientX clientY pageX pageY screenX screenY".split(" "),D=a.event.mouseHooks?a.event.mouseHooks.props:[],E=a.event.props.concat(D),F={},G=0,H=0,I=0,J=!1,K=[],L=!1,M=!1,N="addEventListener"in c,O=a(c),P=1,Q=0;for(a.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},y=0;y<B.length;y++)a.event.special[B[y]]=w(B[y]);N&&c.addEventListener("click",function(b){var c,d,e,f,g,h,i=K.length,j=b.target;if(i)for(c=b.clientX,d=b.clientY,x=a.vmouse.clickDistanceThreshold,e=j;e;){for(f=0;i>f;f++)if(g=K[f],h=0,e===j&&Math.abs(g.x-c)<x&&Math.abs(g.y-d)<x||a.data(e,A)===g.touchID)return b.preventDefault(),void b.stopPropagation();e=e.parentNode}},!0)}(a,b,c),function(a,b,d){function e(b,c,e,f){var g=e.type;e.type=c,f?a.event.trigger(e,d,b):a.event.dispatch.call(b,e),e.type=g}var f=a(c),g=a.mobile.support.touch,h="touchmove scroll",i=g?"touchstart":"mousedown",j=g?"touchend":"mouseup",k=g?"touchmove":"mousemove";a.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(b,c){a.fn[c]=function(a){return a?this.bind(c,a):this.trigger(c)},a.attrFn&&(a.attrFn[c]=!0)}),a.event.special.scrollstart={enabled:!0,setup:function(){function b(a,b){c=b,e(f,c?"scrollstart":"scrollstop",a)}var c,d,f=this,g=a(f);g.bind(h,function(e){a.event.special.scrollstart.enabled&&(c||b(e,!0),clearTimeout(d),d=setTimeout(function(){b(e,!1)},50))})},teardown:function(){a(this).unbind(h)}},a.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var b=this,c=a(b),d=!1;c.bind("vmousedown",function(g){function h(){clearTimeout(k)}function i(){h(),c.unbind("vclick",j).unbind("vmouseup",h),f.unbind("vmousecancel",i)}function j(a){i(),d||l!==a.target?d&&a.preventDefault():e(b,"tap",a)}if(d=!1,g.which&&1!==g.which)return!1;var k,l=g.target;c.bind("vmouseup",h).bind("vclick",j),f.bind("vmousecancel",i),k=setTimeout(function(){a.event.special.tap.emitTapOnTaphold||(d=!0),e(b,"taphold",a.Event("taphold",{target:l}))},a.event.special.tap.tapholdThreshold)})},teardown:function(){a(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),f.unbind("vmousecancel")}},a.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(a){var c=b.pageXOffset,d=b.pageYOffset,e=a.clientX,f=a.clientY;return 0===a.pageY&&Math.floor(f)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX)?(e-=c,f-=d):(f<a.pageY-d||e<a.pageX-c)&&(e=a.pageX-c,f=a.pageY-d),{x:e,y:f}},start:function(b){var c=b.originalEvent.touches?b.originalEvent.touches[0]:b,d=a.event.special.swipe.getLocation(c);return{time:(new Date).getTime(),coords:[d.x,d.y],origin:a(b.target)}},stop:function(b){var c=b.originalEvent.touches?b.originalEvent.touches[0]:b,d=a.event.special.swipe.getLocation(c);return{time:(new Date).getTime(),coords:[d.x,d.y]}},handleSwipe:function(b,c,d,f){if(c.time-b.time<a.event.special.swipe.durationThreshold&&Math.abs(b.coords[0]-c.coords[0])>a.event.special.swipe.horizontalDistanceThreshold&&Math.abs(b.coords[1]-c.coords[1])<a.event.special.swipe.verticalDistanceThreshold){var g=b.coords[0]>c.coords[0]?"swipeleft":"swiperight";return e(d,"swipe",a.Event("swipe",{target:f,swipestart:b,swipestop:c}),!0),e(d,g,a.Event(g,{target:f,swipestart:b,swipestop:c}),!0),!0}return!1},eventInProgress:!1,setup:function(){var b,c=this,d=a(c),e={};b=a.data(this,"mobile-events"),b||(b={length:0},a.data(this,"mobile-events",b)),b.length++,b.swipe=e,e.start=function(b){if(!a.event.special.swipe.eventInProgress){a.event.special.swipe.eventInProgress=!0;var d,g=a.event.special.swipe.start(b),h=b.target,i=!1;e.move=function(b){g&&!b.isDefaultPrevented()&&(d=a.event.special.swipe.stop(b),i||(i=a.event.special.swipe.handleSwipe(g,d,c,h),i&&(a.event.special.swipe.eventInProgress=!1)),Math.abs(g.coords[0]-d.coords[0])>a.event.special.swipe.scrollSupressionThreshold&&b.preventDefault())},e.stop=function(){i=!0,a.event.special.swipe.eventInProgress=!1,f.off(k,e.move),e.move=null},f.on(k,e.move).one(j,e.stop)}},d.on(i,e.start)},teardown:function(){var b,c;b=a.data(this,"mobile-events"),b&&(c=b.swipe,delete b.swipe,b.length--,0===b.length&&a.removeData(this,"mobile-events")),c&&(c.start&&a(this).off(i,c.start),c.move&&f.off(k,c.move),c.stop&&f.off(j,c.stop))}},a.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(b,c){a.event.special[b]={setup:function(){a(this).bind(c,a.noop)},teardown:function(){a(this).unbind(c)}}})}(a,this),function(a){a.event.special.throttledresize={setup:function(){a(this).bind("resize",f)},teardown:function(){a(this).unbind("resize",f)}};var b,c,d,e=250,f=function(){c=(new Date).getTime(),d=c-g,d>=e?(g=c,a(this).trigger("throttledresize")):(b&&clearTimeout(b),b=setTimeout(f,e-d))},g=0}(a),function(a,b){function d(){var a=e();a!==f&&(f=a,l.trigger(m))}var e,f,g,h,i,j,k,l=a(b),m="orientationchange",n={0:!0,180:!0};a.support.orientation&&(i=b.innerWidth||l.width(),j=b.innerHeight||l.height(),k=50,g=i>j&&i-j>k,h=n[b.orientation],(g&&h||!g&&!h)&&(n={"-90":!0,90:!0})),a.event.special.orientationchange=a.extend({},a.event.special.orientationchange,{setup:function(){return a.support.orientation&&!a.event.special.orientationchange.disabled?!1:(f=e(),void l.bind("throttledresize",d))},teardown:function(){return a.support.orientation&&!a.event.special.orientationchange.disabled?!1:void l.unbind("throttledresize",d)},add:function(a){var b=a.handler;a.handler=function(a){return a.orientation=e(),b.apply(this,arguments)}}}),a.event.special.orientationchange.orientation=e=function(){var d=!0,e=c.documentElement;return d=a.support.orientation?n[b.orientation]:e&&e.clientWidth/e.clientHeight<1.1,d?"portrait":"landscape"},a.fn[m]=function(a){return a?this.bind(m,a):this.trigger(m)},a.attrFn&&(a.attrFn[m]=!0)}(a,this),function(a){var b=a("head").children("base"),c={element:b.length?b:a("<base>",{href:a.mobile.path.documentBase.hrefNoHash}).prependTo(a("head")),linkSelector:"[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",set:function(b){a.mobile.dynamicBaseEnabled&&a.support.dynamicBaseTag&&c.element.attr("href",a.mobile.path.makeUrlAbsolute(b,a.mobile.path.documentBase))},rewrite:function(b,d){var e=a.mobile.path.get(b);d.find(c.linkSelector).each(function(b,c){var d=a(c).is("[href]")?"href":a(c).is("[src]")?"src":"action",f=a.mobile.path.parseLocation(),g=a(c).attr(d);g=g.replace(f.protocol+f.doubleSlash+f.host+f.pathname,""),/^(\w+:|#|\/)/.test(g)||a(c).attr(d,e+g)})},reset:function(){c.element.attr("href",a.mobile.path.documentBase.hrefNoSearch)}};a.mobile.base=c}(a),function(a,b){a.mobile.widgets={};var c=a.widget,d=a.mobile.keepNative;a.widget=function(c){return function(){var d=c.apply(this,arguments),e=d.prototype.widgetName;return d.initSelector=d.prototype.initSelector!==b?d.prototype.initSelector:":jqmData(role='"+e+"')",a.mobile.widgets[e]=d,d}}(a.widget),a.extend(a.widget,c),a.mobile.document.on("create",function(b){a(b.target).enhanceWithin()}),a.widget("mobile.page",{options:{theme:"a",domCache:!1,keepNativeDefault:a.mobile.keepNative,contentTheme:null,enhanced:!1},_createWidget:function(){a.Widget.prototype._createWidget.apply(this,arguments),this._trigger("init")},_create:function(){return this._trigger("beforecreate")===!1?!1:(this.options.enhanced||this._enhance(),this._on(this.element,{pagebeforehide:"removeContainerBackground",pagebeforeshow:"_handlePageBeforeShow"}),this.element.enhanceWithin(),void("dialog"===a.mobile.getAttribute(this.element[0],"role")&&a.mobile.dialog&&this.element.dialog()))},_enhance:function(){var c="data-"+a.mobile.ns,d=this;this.options.role&&this.element.attr("data-"+a.mobile.ns+"role",this.options.role),this.element.attr("tabindex","0").addClass("ui-page ui-page-theme-"+this.options.theme),this.element.find("["+c+"role='content']").each(function(){var e=a(this),f=this.getAttribute(c+"theme")||b;d.options.contentTheme=f||d.options.contentTheme||d.options.dialog&&d.options.theme||"dialog"===d.element.jqmData("role")&&d.options.theme,e.addClass("ui-content"),d.options.contentTheme&&e.addClass("ui-body-"+d.options.contentTheme),e.attr("role","main").addClass("ui-content")})},bindRemove:function(b){var c=this.element;!c.data("mobile-page").options.domCache&&c.is(":jqmData(external-page='true')")&&c.bind("pagehide.remove",b||function(b,c){if(!c.samePage){var d=a(this),e=new a.Event("pageremove");d.trigger(e),e.isDefaultPrevented()||d.removeWithDependents()}})},_setOptions:function(c){c.theme!==b&&this.element.removeClass("ui-page-theme-"+this.options.theme).addClass("ui-page-theme-"+c.theme),c.contentTheme!==b&&this.element.find("[data-"+a.mobile.ns+"='content']").removeClass("ui-body-"+this.options.contentTheme).addClass("ui-body-"+c.contentTheme)},_handlePageBeforeShow:function(){this.setContainerBackground()},removeContainerBackground:function(){this.element.closest(":mobile-pagecontainer").pagecontainer({theme:"none"})},setContainerBackground:function(a){this.element.parent().pagecontainer({theme:a||this.options.theme})},keepNativeSelector:function(){var b=this.options,c=a.trim(b.keepNative||""),e=a.trim(a.mobile.keepNative),f=a.trim(b.keepNativeDefault),g=d===e?"":e,h=""===g?f:"";return(c?[c]:[]).concat(g?[g]:[]).concat(h?[h]:[]).join(", ")}})}(a),function(a,d){a.widget("mobile.pagecontainer",{options:{theme:"a"},initSelector:!1,_create:function(){this._trigger("beforecreate"),this.setLastScrollEnabled=!0,this._on(this.window,{navigate:"_disableRecordScroll",scrollstop:"_delayedRecordScroll"}),this._on(this.window,{navigate:"_filterNavigateEvents"}),this._on({pagechange:"_afterContentChange"}),this.window.one("navigate",a.proxy(function(){this.setLastScrollEnabled=!0},this))},_setOptions:function(a){a.theme!==d&&"none"!==a.theme?this.element.removeClass("ui-overlay-"+this.options.theme).addClass("ui-overlay-"+a.theme):a.theme!==d&&this.element.removeClass("ui-overlay-"+this.options.theme),this._super(a)},_disableRecordScroll:function(){this.setLastScrollEnabled=!1},_enableRecordScroll:function(){this.setLastScrollEnabled=!0},_afterContentChange:function(){this.setLastScrollEnabled=!0,this._off(this.window,"scrollstop"),this._on(this.window,{scrollstop:"_delayedRecordScroll"})},_recordScroll:function(){if(this.setLastScrollEnabled){var a,b,c,d=this._getActiveHistory();d&&(a=this._getScroll(),b=this._getMinScroll(),c=this._getDefaultScroll(),d.lastScroll=b>a?c:a)}},_delayedRecordScroll:function(){setTimeout(a.proxy(this,"_recordScroll"),100)},_getScroll:function(){return this.window.scrollTop()},_getMinScroll:function(){return a.mobile.minScrollBack},_getDefaultScroll:function(){return a.mobile.defaultHomeScroll},_filterNavigateEvents:function(b,c){var d;b.originalEvent&&b.originalEvent.isDefaultPrevented()||(d=b.originalEvent.type.indexOf("hashchange")>-1?c.state.hash:c.state.url,d||(d=this._getHash()),d&&"#"!==d&&0!==d.indexOf("#"+a.mobile.path.uiStateKey)||(d=location.href),this._handleNavigate(d,c.state))},_getHash:function(){return a.mobile.path.parseLocation().hash},getActivePage:function(){return this.activePage},_getInitialContent:function(){return a.mobile.firstPage},_getHistory:function(){return a.mobile.navigate.history},_getActiveHistory:function(){return this._getHistory().getActive()},_getDocumentBase:function(){return a.mobile.path.documentBase},back:function(){this.go(-1)},forward:function(){this.go(1)},go:function(c){if(a.mobile.hashListeningEnabled)b.history.go(c);else{var d=a.mobile.navigate.history.activeIndex,e=d+parseInt(c,10),f=a.mobile.navigate.history.stack[e].url,g=c>=1?"forward":"back";a.mobile.navigate.history.activeIndex=e,a.mobile.navigate.history.previousIndex=d,this.change(f,{direction:g,changeHash:!1,fromHashChange:!0})}},_handleDestination:function(b){var c;return"string"===a.type(b)&&(b=a.mobile.path.stripHash(b)),b&&(c=this._getHistory(),b=a.mobile.path.isPath(b)?b:a.mobile.path.makeUrlAbsolute("#"+b,this._getDocumentBase())),b||this._getInitialContent()},_transitionFromHistory:function(a,b){var c=this._getHistory(),d="back"===a?c.getLast():c.getActive();return d&&d.transition||b},_handleDialog:function(b,c){var d,e,f=this.getActivePage();return f&&!f.data("mobile-dialog")?("back"===c.direction?this.back():this.forward(),!1):(d=c.pageUrl,e=this._getActiveHistory(),a.extend(b,{role:e.role,transition:this._transitionFromHistory(c.direction,b.transition),reverse:"back"===c.direction}),d)},_handleNavigate:function(b,c){var d=a.mobile.path.stripHash(b),e=this._getHistory(),f=0===e.stack.length?"none":this._transitionFromHistory(c.direction),g={changeHash:!1,fromHashChange:!0,reverse:"back"===c.direction};a.extend(g,c,{transition:f}),e.activeIndex>0&&d.indexOf(a.mobile.dialogHashKey)>-1&&(d=this._handleDialog(g,c),d===!1)||this._changeContent(this._handleDestination(d),g)},_changeContent:function(b,c){a.mobile.changePage(b,c)},_getBase:function(){return a.mobile.base},_getNs:function(){return a.mobile.ns},_enhance:function(a,b){return a.page({role:b})},_include:function(a,b){a.appendTo(this.element),this._enhance(a,b.role),a.page("bindRemove")},_find:function(b){var c,d=this._createFileUrl(b),e=this._createDataUrl(b),f=this._getInitialContent();return c=this.element.children("[data-"+this._getNs()+"url='"+a.mobile.path.hashToSelector(e)+"']"),0===c.length&&e&&!a.mobile.path.isPath(e)&&(c=this.element.children(a.mobile.path.hashToSelector("#"+e)).attr("data-"+this._getNs()+"url",e).jqmData("url",e)),0===c.length&&a.mobile.path.isFirstPageUrl(d)&&f&&f.parent().length&&(c=a(f)),c},_getLoader:function(){return a.mobile.loading()},_showLoading:function(b,c,d,e){this._loadMsg||(this._loadMsg=setTimeout(a.proxy(function(){this._getLoader().loader("show",c,d,e),this._loadMsg=0},this),b))},_hideLoading:function(){clearTimeout(this._loadMsg),this._loadMsg=0,this._getLoader().loader("hide")},_showError:function(){this._hideLoading(),this._showLoading(0,a.mobile.pageLoadErrorMessageTheme,a.mobile.pageLoadErrorMessage,!0),setTimeout(a.proxy(this,"_hideLoading"),1500)},_parse:function(b,c){var d,e=a("<div></div>");return e.get(0).innerHTML=b,d=e.find(":jqmData(role='page'), :jqmData(role='dialog')").first(),d.length||(d=a("<div data-"+this._getNs()+"role='page'>"+(b.split(/<\/?body[^>]*>/gim)[1]||"")+"</div>")),d.attr("data-"+this._getNs()+"url",this._createDataUrl(c)).attr("data-"+this._getNs()+"external-page",!0),d},_setLoadedTitle:function(b,c){var d=c.match(/<title[^>]*>([^<]*)/)&&RegExp.$1;d&&!b.jqmData("title")&&(d=a("<div>"+d+"</div>").text(),b.jqmData("title",d))},_isRewritableBaseTag:function(){return a.mobile.dynamicBaseEnabled&&!a.support.dynamicBaseTag},_createDataUrl:function(b){return a.mobile.path.convertUrlToDataUrl(b)},_createFileUrl:function(b){return a.mobile.path.getFilePath(b)},_triggerWithDeprecated:function(b,c,d){var e=a.Event("page"+b),f=a.Event(this.widgetName+b);return(d||this.element).trigger(e,c),this._trigger(b,f,c),{deprecatedEvent:e,event:f}},_loadSuccess:function(b,c,e,f){var g=this._createFileUrl(b);return a.proxy(function(h,i,j){var k,l=new RegExp("(<[^>]+\\bdata-"+this._getNs()+"role=[\"']?page[\"']?[^>]*>)"),m=new RegExp("\\bdata-"+this._getNs()+"url=[\"']?([^\"'>]*)[\"']?");l.test(h)&&RegExp.$1&&m.test(RegExp.$1)&&RegExp.$1&&(g=a.mobile.path.getFilePath(a("<div>"+RegExp.$1+"</div>").text()),g=this.window[0].encodeURIComponent(g)),e.prefetch===d&&this._getBase().set(g),k=this._parse(h,g),this._setLoadedTitle(k,h),c.xhr=j,c.textStatus=i,c.page=k,c.content=k,c.toPage=k,this._triggerWithDeprecated("load",c).event.isDefaultPrevented()||(this._isRewritableBaseTag()&&k&&this._getBase().rewrite(g,k),this._include(k,e),e.showLoadMsg&&this._hideLoading(),f.resolve(b,e,k))},this)},_loadDefaults:{type:"get",data:d,reloadPage:!1,reload:!1,role:d,showLoadMsg:!1,loadMsgDelay:50},load:function(b,c){var e,f,g,h,i=c&&c.deferred||a.Deferred(),j=c&&c.reload===d&&c.reloadPage!==d?{reload:c.reloadPage}:{},k=a.extend({},this._loadDefaults,c,j),l=null,m=a.mobile.path.makeUrlAbsolute(b,this._findBaseWithDefault());return k.data&&"get"===k.type&&(m=a.mobile.path.addSearchParams(m,k.data),k.data=d),k.data&&"post"===k.type&&(k.reload=!0),e=this._createFileUrl(m),f=this._createDataUrl(m),l=this._find(m),0===l.length&&a.mobile.path.isEmbeddedPage(e)&&!a.mobile.path.isFirstPageUrl(e)?(i.reject(m,k),i.promise()):(this._getBase().reset(),l.length&&!k.reload?(this._enhance(l,k.role),i.resolve(m,k,l),k.prefetch||this._getBase().set(b),i.promise()):(h={url:b,absUrl:m,toPage:b,prevPage:c?c.fromPage:d,dataUrl:f,deferred:i,options:k},g=this._triggerWithDeprecated("beforeload",h),g.deprecatedEvent.isDefaultPrevented()||g.event.isDefaultPrevented()?i.promise():(k.showLoadMsg&&this._showLoading(k.loadMsgDelay),k.prefetch===d&&this._getBase().reset(),a.mobile.allowCrossDomainPages||a.mobile.path.isSameDomain(a.mobile.path.documentUrl,m)?(a.ajax({url:e,type:k.type,data:k.data,contentType:k.contentType,dataType:"html",success:this._loadSuccess(m,h,k,i),error:this._loadError(m,h,k,i)}),i.promise()):(i.reject(m,k),i.promise()))))},_loadError:function(b,c,d,e){return a.proxy(function(f,g,h){this._getBase().set(a.mobile.path.get()),c.xhr=f,c.textStatus=g,c.errorThrown=h;var i=this._triggerWithDeprecated("loadfailed",c);i.deprecatedEvent.isDefaultPrevented()||i.event.isDefaultPrevented()||(d.showLoadMsg&&this._showError(),e.reject(b,d))},this)},_getTransitionHandler:function(b){return b=a.mobile._maybeDegradeTransition(b),a.mobile.transitionHandlers[b]||a.mobile.defaultTransitionHandler},_triggerCssTransitionEvents:function(b,c,d){var e=!1;d=d||"",c&&(b[0]===c[0]&&(e=!0),this._triggerWithDeprecated(d+"hide",{nextPage:b,toPage:b,prevPage:c,samePage:e},c)),this._triggerWithDeprecated(d+"show",{prevPage:c||a(""),toPage:b},b)},_cssTransition:function(b,c,d){var e,f,g=d.transition,h=d.reverse,i=d.deferred;this._triggerCssTransitionEvents(b,c,"before"),this._hideLoading(),e=this._getTransitionHandler(g),f=new e(g,h,b,c).transition(),f.done(a.proxy(function(){this._triggerCssTransitionEvents(b,c)},this)),f.done(function(){i.resolve.apply(i,arguments)})},_releaseTransitionLock:function(){f=!1,e.length>0&&a.mobile.changePage.apply(null,e.pop())},_removeActiveLinkClass:function(b){a.mobile.removeActiveLinkClass(b)},_loadUrl:function(b,c,d){d.target=b,d.deferred=a.Deferred(),this.load(b,d),d.deferred.done(a.proxy(function(a,b,d){f=!1,b.absUrl=c.absUrl,this.transition(d,c,b)},this)),d.deferred.fail(a.proxy(function(){this._removeActiveLinkClass(!0),this._releaseTransitionLock(),this._triggerWithDeprecated("changefailed",c)},this))},_triggerPageBeforeChange:function(b,c,d){var e;return c.prevPage=this.activePage,a.extend(c,{toPage:b,options:d}),c.absUrl="string"===a.type(b)?a.mobile.path.makeUrlAbsolute(b,this._findBaseWithDefault()):d.absUrl,e=this._triggerWithDeprecated("beforechange",c),e.event.isDefaultPrevented()||e.deprecatedEvent.isDefaultPrevented()?!1:!0},change:function(b,c){if(f)return void e.unshift(arguments);var d=a.extend({},a.mobile.changePage.defaults,c),g={};d.fromPage=d.fromPage||this.activePage,this._triggerPageBeforeChange(b,g,d)&&(b=g.toPage,"string"===a.type(b)?(f=!0,this._loadUrl(b,g,d)):this.transition(b,g,d))},transition:function(b,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(f)return void e.unshift([b,h]);if(this._triggerPageBeforeChange(b,g,h)&&(g.prevPage=h.fromPage,v=this._triggerWithDeprecated("beforetransition",g),!v.deprecatedEvent.isDefaultPrevented()&&!v.event.isDefaultPrevented())){if(f=!0,b[0]!==a.mobile.firstPage[0]||h.dataUrl||(h.dataUrl=a.mobile.path.documentUrl.hrefNoHash),i=h.fromPage,j=h.dataUrl&&a.mobile.path.convertUrlToDataUrl(h.dataUrl)||b.jqmData("url"),k=j,l=a.mobile.path.getFilePath(j),m=a.mobile.navigate.history.getActive(),n=0===a.mobile.navigate.history.activeIndex,o=0,p=c.title,q=("dialog"===h.role||"dialog"===b.jqmData("role"))&&b.jqmData("dialog")!==!0,i&&i[0]===b[0]&&!h.allowSamePageTransition)return f=!1,this._triggerWithDeprecated("transition",g),this._triggerWithDeprecated("change",g),void(h.fromHashChange&&a.mobile.navigate.history.direct({url:j}));b.page({role:h.role}),h.fromHashChange&&(o="back"===h.direction?-1:1);try{c.activeElement&&"body"!==c.activeElement.nodeName.toLowerCase()?a(c.activeElement).blur():a("input:focus, textarea:focus, select:focus").blur()}catch(w){}r=!1,q&&m&&(m.url&&m.url.indexOf(a.mobile.dialogHashKey)>-1&&this.activePage&&!this.activePage.hasClass("ui-dialog")&&a.mobile.navigate.history.activeIndex>0&&(h.changeHash=!1,r=!0),j=m.url||"",j+=!r&&j.indexOf("#")>-1?a.mobile.dialogHashKey:"#"+a.mobile.dialogHashKey),s=m?b.jqmData("title")||b.children(":jqmData(role='header')").find(".ui-title").text():p,s&&p===c.title&&(p=s),b.jqmData("title")||b.jqmData("title",p),h.transition=h.transition||(o&&!n?m.transition:d)||(q?a.mobile.defaultDialogTransition:a.mobile.defaultPageTransition),!o&&r&&(a.mobile.navigate.history.getActive().pageUrl=k),j&&!h.fromHashChange&&(!a.mobile.path.isPath(j)&&j.indexOf("#")<0&&(j="#"+j),t={transition:h.transition,title:p,pageUrl:k,role:h.role},h.changeHash!==!1&&a.mobile.hashListeningEnabled?a.mobile.navigate(this.window[0].encodeURI(j),t,!0):b[0]!==a.mobile.firstPage[0]&&a.mobile.navigate.history.add(j,t)),c.title=p,a.mobile.activePage=b,this.activePage=b,h.reverse=h.reverse||0>o,u=a.Deferred(),this._cssTransition(b,i,{transition:h.transition,reverse:h.reverse,deferred:u}),u.done(a.proxy(function(c,d,e,f,i){a.mobile.removeActiveLinkClass(),h.duplicateCachedPage&&h.duplicateCachedPage.remove(),i||a.mobile.focusPage(b),this._releaseTransitionLock(),this._triggerWithDeprecated("transition",g),this._triggerWithDeprecated("change",g)},this))}},_findBaseWithDefault:function(){var b=this.activePage&&a.mobile.getClosestBaseUrl(this.activePage);return b||a.mobile.path.documentBase.hrefNoHash}}),a.mobile.navreadyDeferred=a.Deferred();var e=[],f=!1}(a),function(a,d){function e(a){for(;a&&("string"!=typeof a.nodeName||"a"!==a.nodeName.toLowerCase());)a=a.parentNode;return a}var f=a.Deferred(),g=a.Deferred(),h=function(){g.resolve(),g=null},i=a.mobile.path.documentUrl,j=null;a.mobile.loadPage=function(b,c){var d;return c=c||{},d=c.pageContainer||a.mobile.pageContainer,c.deferred=a.Deferred(),d.pagecontainer("load",b,c),c.deferred.promise()},a.mobile.back=function(){var c=b.navigator;this.phonegapNavigationEnabled&&c&&c.app&&c.app.backHistory?c.app.backHistory():a.mobile.pageContainer.pagecontainer("back")},a.mobile.focusPage=function(a){var b=a.find("[autofocus]"),c=a.find(".ui-title:eq(0)");return b.length?void b.focus():void(c.length?c.focus():a.focus())},a.mobile._maybeDegradeTransition=a.mobile._maybeDegradeTransition||function(a){return a},a.mobile.changePage=function(b,c){a.mobile.pageContainer.pagecontainer("change",b,c)},a.mobile.changePage.defaults={transition:d,reverse:!1,changeHash:!0,fromHashChange:!1,role:d,duplicateCachedPage:d,pageContainer:d,showLoadMsg:!0,dataUrl:d,fromPage:d,allowSamePageTransition:!1},a.mobile._registerInternalEvents=function(){var c=function(b,c){var d,e,f,g,h=!0;return!a.mobile.ajaxEnabled||b.is(":jqmData(ajax='false')")||!b.jqmHijackable().length||b.attr("target")?!1:(d=j&&j.attr("formaction")||b.attr("action"),g=(b.attr("method")||"get").toLowerCase(),d||(d=a.mobile.getClosestBaseUrl(b),"get"===g&&(d=a.mobile.path.parseUrl(d).hrefNoSearch),d===a.mobile.path.documentBase.hrefNoHash&&(d=i.hrefNoSearch)),d=a.mobile.path.makeUrlAbsolute(d,a.mobile.getClosestBaseUrl(b)),a.mobile.path.isExternal(d)&&!a.mobile.path.isPermittedCrossDomainRequest(i,d)?!1:(c||(e=b.serializeArray(),j&&j[0].form===b[0]&&(f=j.attr("name"),f&&(a.each(e,function(a,b){return b.name===f?(f="",!1):void 0}),f&&e.push({name:f,value:j.attr("value")}))),h={url:d,options:{type:g,data:a.param(e),transition:b.jqmData("transition"),reverse:"reverse"===b.jqmData("direction"),reloadPage:!0}}),h))};a.mobile.document.delegate("form","submit",function(b){var d;b.isDefaultPrevented()||(d=c(a(this)),d&&(a.mobile.changePage(d.url,d.options),b.preventDefault()))}),a.mobile.document.bind("vclick",function(b){var d,f,g=b.target,h=!1;if(!(b.which>1)&&a.mobile.linkBindingEnabled){if(j=a(g),a.data(g,"mobile-button")){if(!c(a(g).closest("form"),!0))return;g.parentNode&&(g=g.parentNode)}else{if(g=e(g),!g||"#"===a.mobile.path.parseUrl(g.getAttribute("href")||"#").hash)return;if(!a(g).jqmHijackable().length)return}~g.className.indexOf("ui-link-inherit")?g.parentNode&&(f=a.data(g.parentNode,"buttonElements")):f=a.data(g,"buttonElements"),f?g=f.outer:h=!0,d=a(g),h&&(d=d.closest(".ui-btn")),d.length>0&&!d.hasClass("ui-state-disabled")&&(a.mobile.removeActiveLinkClass(!0),a.mobile.activeClickedLink=d,a.mobile.activeClickedLink.addClass(a.mobile.activeBtnClass))}}),a.mobile.document.bind("click",function(c){if(a.mobile.linkBindingEnabled&&!c.isDefaultPrevented()){var f,g,h,j,k,l,m,n=e(c.target),o=a(n),p=function(){b.setTimeout(function(){a.mobile.removeActiveLinkClass(!0)},200)};if(a.mobile.activeClickedLink&&a.mobile.activeClickedLink[0]===c.target.parentNode&&p(),n&&!(c.which>1)&&o.jqmHijackable().length){if(o.is(":jqmData(rel='back')"))return a.mobile.back(),!1;if(f=a.mobile.getClosestBaseUrl(o),g=a.mobile.path.makeUrlAbsolute(o.attr("href")||"#",f),!a.mobile.ajaxEnabled&&!a.mobile.path.isEmbeddedPage(g))return void p();if(!(-1===g.search("#")||a.mobile.path.isExternal(g)&&a.mobile.path.isAbsoluteUrl(g))){if(g=g.replace(/[^#]*#/,""),!g)return void c.preventDefault();g=a.mobile.path.isPath(g)?a.mobile.path.makeUrlAbsolute(g,f):a.mobile.path.makeUrlAbsolute("#"+g,i.hrefNoHash)}if(h=o.is("[rel='external']")||o.is(":jqmData(ajax='false')")||o.is("[target]"),j=h||a.mobile.path.isExternal(g)&&!a.mobile.path.isPermittedCrossDomainRequest(i,g))return void p();k=o.jqmData("transition"),l="reverse"===o.jqmData("direction")||o.jqmData("back"),m=o.attr("data-"+a.mobile.ns+"rel")||d,a.mobile.changePage(g,{transition:k,reverse:l,role:m,link:o}),c.preventDefault()}}}),a.mobile.document.delegate(".ui-page","pageshow.prefetch",function(){var b=[];a(this).find("a:jqmData(prefetch)").each(function(){var c=a(this),d=c.attr("href");d&&-1===a.inArray(d,b)&&(b.push(d),a.mobile.loadPage(d,{role:c.attr("data-"+a.mobile.ns+"rel"),prefetch:!0}))})}),a.mobile.pageContainer.pagecontainer(),a.mobile.document.bind("pageshow",function(){g?g.done(a.mobile.resetActivePageHeight):a.mobile.resetActivePageHeight()
}),a.mobile.window.bind("throttledresize",a.mobile.resetActivePageHeight)},a(function(){f.resolve()}),"complete"===c.readyState?h():a.mobile.window.load(h),a.when(f,a.mobile.navreadyDeferred).done(function(){a.mobile._registerInternalEvents()})}(a),function(a,b){a.mobile.Transition=function(){this.init.apply(this,arguments)},a.extend(a.mobile.Transition.prototype,{toPreClass:" ui-page-pre-in",init:function(b,c,d,e){a.extend(this,{name:b,reverse:c,$to:d,$from:e,deferred:new a.Deferred})},cleanFrom:function(){this.$from.removeClass(a.mobile.activePageClass+" out in reverse "+this.name).height("")},beforeDoneIn:function(){},beforeDoneOut:function(){},beforeStartOut:function(){},doneIn:function(){this.beforeDoneIn(),this.$to.removeClass("out in reverse "+this.name).height(""),this.toggleViewportClass(),a.mobile.window.scrollTop()!==this.toScroll&&this.scrollPage(),this.sequential||this.$to.addClass(a.mobile.activePageClass),this.deferred.resolve(this.name,this.reverse,this.$to,this.$from,!0)},doneOut:function(a,b,c,d){this.beforeDoneOut(),this.startIn(a,b,c,d)},hideIn:function(a){this.$to.css("z-index",-10),a.call(this),this.$to.css("z-index","")},scrollPage:function(){a.event.special.scrollstart.enabled=!1,(a.mobile.hideUrlBar||this.toScroll!==a.mobile.defaultHomeScroll)&&b.scrollTo(0,this.toScroll),setTimeout(function(){a.event.special.scrollstart.enabled=!0},150)},startIn:function(b,c,d,e){this.hideIn(function(){this.$to.addClass(a.mobile.activePageClass+this.toPreClass),e||a.mobile.focusPage(this.$to),this.$to.height(b+this.toScroll),d||this.scrollPage()}),this.$to.removeClass(this.toPreClass).addClass(this.name+" in "+c),d?this.doneIn():this.$to.animationComplete(a.proxy(function(){this.doneIn()},this))},startOut:function(b,c,d){this.beforeStartOut(b,c,d),this.$from.height(b+a.mobile.window.scrollTop()).addClass(this.name+" out"+c)},toggleViewportClass:function(){a.mobile.pageContainer.toggleClass("ui-mobile-viewport-transitioning viewport-"+this.name)},transition:function(){var b,c=this.reverse?" reverse":"",d=a.mobile.getScreenHeight(),e=a.mobile.maxTransitionWidth!==!1&&a.mobile.window.width()>a.mobile.maxTransitionWidth;return this.toScroll=a.mobile.navigate.history.getActive().lastScroll||a.mobile.defaultHomeScroll,b=!a.support.cssTransitions||!a.support.cssAnimations||e||!this.name||"none"===this.name||Math.max(a.mobile.window.scrollTop(),this.toScroll)>a.mobile.getMaxScrollForTransition(),this.toggleViewportClass(),this.$from&&!b?this.startOut(d,c,b):this.doneOut(d,c,b,!0),this.deferred.promise()}})}(a,this),function(a){a.mobile.SerialTransition=function(){this.init.apply(this,arguments)},a.extend(a.mobile.SerialTransition.prototype,a.mobile.Transition.prototype,{sequential:!0,beforeDoneOut:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(b,c,d){this.$from.animationComplete(a.proxy(function(){this.doneOut(b,c,d)},this))}})}(a),function(a){a.mobile.ConcurrentTransition=function(){this.init.apply(this,arguments)},a.extend(a.mobile.ConcurrentTransition.prototype,a.mobile.Transition.prototype,{sequential:!1,beforeDoneIn:function(){this.$from&&this.cleanFrom()},beforeStartOut:function(a,b,c){this.doneOut(a,b,c)}})}(a),function(a){var b=function(){return 3*a.mobile.getScreenHeight()};a.mobile.transitionHandlers={sequential:a.mobile.SerialTransition,simultaneous:a.mobile.ConcurrentTransition},a.mobile.defaultTransitionHandler=a.mobile.transitionHandlers.sequential,a.mobile.transitionFallbacks={},a.mobile._maybeDegradeTransition=function(b){return b&&!a.support.cssTransform3d&&a.mobile.transitionFallbacks[b]&&(b=a.mobile.transitionFallbacks[b]),b},a.mobile.getMaxScrollForTransition=a.mobile.getMaxScrollForTransition||b}(a),function(a){a.mobile.transitionFallbacks.flip="fade"}(a,this),function(a){a.mobile.transitionFallbacks.flow="fade"}(a,this),function(a){a.mobile.transitionFallbacks.pop="fade"}(a,this),function(a){a.mobile.transitionHandlers.slide=a.mobile.transitionHandlers.simultaneous,a.mobile.transitionFallbacks.slide="fade"}(a,this),function(a){a.mobile.transitionFallbacks.slidedown="fade"}(a,this),function(a){a.mobile.transitionFallbacks.slidefade="fade"}(a,this),function(a){a.mobile.transitionFallbacks.slideup="fade"}(a,this),function(a){a.mobile.transitionFallbacks.turn="fade"}(a,this),function(a){a.mobile.degradeInputs={color:!1,date:!1,datetime:!1,"datetime-local":!1,email:!1,month:!1,number:!1,range:"number",search:"text",tel:!1,time:!1,url:!1,week:!1},a.mobile.page.prototype.options.degradeInputs=a.mobile.degradeInputs,a.mobile.degradeInputsWithin=function(b){b=a(b),b.find("input").not(a.mobile.page.prototype.keepNativeSelector()).each(function(){var b,c,d,e,f=a(this),g=this.getAttribute("type"),h=a.mobile.degradeInputs[g]||"text";a.mobile.degradeInputs[g]&&(b=a("<div>").html(f.clone()).html(),c=b.indexOf(" type=")>-1,d=c?/\s+type=["']?\w+['"]?/:/\/?>/,e=' type="'+h+'" data-'+a.mobile.ns+'type="'+g+'"'+(c?"":">"),f.replaceWith(b.replace(d,e)))})}}(a),function(a,b,c){a.widget("mobile.page",a.mobile.page,{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0,dialog:!1},_create:function(){this._super(),this.options.dialog&&(a.extend(this,{_inner:this.element.children(),_headerCloseButton:null}),this.options.enhanced||this._setCloseBtn(this.options.closeBtn))},_enhance:function(){this._super(),this.options.dialog&&this.element.addClass("ui-dialog").wrapInner(a("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(this.options.corners?" ui-corner-all":"")}))},_setOptions:function(b){var d,e,f=this.options;b.corners!==c&&this._inner.toggleClass("ui-corner-all",!!b.corners),b.overlayTheme!==c&&a.mobile.activePage[0]===this.element[0]&&(f.overlayTheme=b.overlayTheme,this._handlePageBeforeShow()),b.closeBtnText!==c&&(d=f.closeBtn,e=b.closeBtnText),b.closeBtn!==c&&(d=b.closeBtn),d&&this._setCloseBtn(d,e),this._super(b)},_handlePageBeforeShow:function(){this.options.overlayTheme&&this.options.dialog?(this.removeContainerBackground(),this.setContainerBackground(this.options.overlayTheme)):this._super()},_setCloseBtn:function(b,c){var d,e=this._headerCloseButton;b="left"===b?"left":"right"===b?"right":"none","none"===b?e&&(e.remove(),e=null):e?(e.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+b),c&&e.text(c)):(d=this._inner.find(":jqmData(role='header')").first(),e=a("<a></a>",{href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+b}).attr("data-"+a.mobile.ns+"rel","back").text(c||this.options.closeBtnText||"").prependTo(d)),this._headerCloseButton=e}})}(a,this),function(a,b,c){a.widget("mobile.dialog",{options:{closeBtn:"left",closeBtnText:"Close",overlayTheme:"a",corners:!0},_handlePageBeforeShow:function(){this._isCloseable=!0,this.options.overlayTheme&&this.element.page("removeContainerBackground").page("setContainerBackground",this.options.overlayTheme)},_handlePageBeforeHide:function(){this._isCloseable=!1},_handleVClickSubmit:function(b){var c,d=a(b.target).closest("vclick"===b.type?"a":"form");d.length&&!d.jqmData("transition")&&(c={},c["data-"+a.mobile.ns+"transition"]=(a.mobile.navigate.history.getActive()||{}).transition||a.mobile.defaultDialogTransition,c["data-"+a.mobile.ns+"direction"]="reverse",d.attr(c))},_create:function(){var b=this.element,c=this.options;b.addClass("ui-dialog").wrapInner(a("<div/>",{role:"dialog","class":"ui-dialog-contain ui-overlay-shadow"+(c.corners?" ui-corner-all":"")})),a.extend(this,{_isCloseable:!1,_inner:b.children(),_headerCloseButton:null}),this._on(b,{vclick:"_handleVClickSubmit",submit:"_handleVClickSubmit",pagebeforeshow:"_handlePageBeforeShow",pagebeforehide:"_handlePageBeforeHide"}),this._setCloseBtn(c.closeBtn)},_setOptions:function(b){var d,e,f=this.options;b.corners!==c&&this._inner.toggleClass("ui-corner-all",!!b.corners),b.overlayTheme!==c&&a.mobile.activePage[0]===this.element[0]&&(f.overlayTheme=b.overlayTheme,this._handlePageBeforeShow()),b.closeBtnText!==c&&(d=f.closeBtn,e=b.closeBtnText),b.closeBtn!==c&&(d=b.closeBtn),d&&this._setCloseBtn(d,e),this._super(b)},_setCloseBtn:function(b,c){var d,e=this._headerCloseButton;b="left"===b?"left":"right"===b?"right":"none","none"===b?e&&(e.remove(),e=null):e?(e.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-"+b),c&&e.text(c)):(d=this._inner.find(":jqmData(role='header')").first(),e=a("<a></a>",{role:"button",href:"#","class":"ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-"+b}).text(c||this.options.closeBtnText||"").prependTo(d),this._on(e,{click:"close"})),this._headerCloseButton=e},close:function(){var b=a.mobile.navigate.history;this._isCloseable&&(this._isCloseable=!1,a.mobile.hashListeningEnabled&&b.activeIndex>0?a.mobile.back():a.mobile.pageContainer.pagecontainer("back"))}})}(a,this),function(a,b){var c=/([A-Z])/g,d=function(a){return"ui-btn-icon-"+(null===a?"left":a)};a.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var b=this.element,c={accordion:b.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+(a.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=c,this._renderedOptions=this._getOptions(this.options),this.options.enhanced?(c.heading=this.element.children(".ui-collapsible-heading"),c.content=c.heading.next(),c.anchor=c.heading.children(),c.status=c.anchor.children(".ui-collapsible-heading-status")):this._enhance(b,c),this._on(c.heading,{tap:function(){c.heading.find("a").first().addClass(a.mobile.activeBtnClass)},click:function(a){this._handleExpandCollapse(!c.heading.hasClass("ui-collapsible-heading-collapsed")),a.preventDefault(),a.stopPropagation()}})},_getOptions:function(b){var d,e=this._ui.accordion,f=this._ui.accordionWidget;b=a.extend({},b),e.length&&!f&&(this._ui.accordionWidget=f=e.data("mobile-collapsibleset"));for(d in b)b[d]=null!=b[d]?b[d]:f?f.options[d]:e.length?a.mobile.getAttribute(e[0],d.replace(c,"-$1").toLowerCase()):null,null==b[d]&&(b[d]=a.mobile.collapsible.defaults[d]);return b},_themeClassFromOption:function(a,b){return b?"none"===b?"":a+b:""},_enhance:function(b,c){var e,f=this._renderedOptions,g=this._themeClassFromOption("ui-body-",f.contentTheme);return b.addClass("ui-collapsible "+(f.inset?"ui-collapsible-inset ":"")+(f.inset&&f.corners?"ui-corner-all ":"")+(g?"ui-collapsible-themed-content ":"")),c.originalHeading=b.children(this.options.heading).first(),c.content=b.wrapInner("<div class='ui-collapsible-content "+g+"'></div>").children(".ui-collapsible-content"),c.heading=c.originalHeading,c.heading.is("legend")&&(c.heading=a("<div role='heading'>"+c.heading.html()+"</div>"),c.placeholder=a("<div><!-- placeholder for legend --></div>").insertBefore(c.originalHeading),c.originalHeading.remove()),e=f.collapsed?f.collapsedIcon?"ui-icon-"+f.collapsedIcon:"":f.expandedIcon?"ui-icon-"+f.expandedIcon:"",c.status=a("<span class='ui-collapsible-heading-status'></span>"),c.anchor=c.heading.detach().addClass("ui-collapsible-heading").append(c.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn "+(e?e+" ":"")+(e?d(f.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",f.theme)+" "+(f.mini?"ui-mini ":"")),c.heading.insertBefore(c.content),this._handleExpandCollapse(this.options.collapsed),c},refresh:function(){this._applyOptions(this.options),this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(a){var c,e,f,g,h,i=this.element,j=this._renderedOptions,k=this._ui,l=k.anchor,m=k.status,n=this._getOptions(a);a.collapsed!==b&&this._handleExpandCollapse(a.collapsed),c=i.hasClass("ui-collapsible-collapsed"),c?n.expandCueText!==b&&m.text(n.expandCueText):n.collapseCueText!==b&&m.text(n.collapseCueText),h=n.collapsedIcon!==b?n.collapsedIcon!==!1:j.collapsedIcon!==!1,(n.iconpos!==b||n.collapsedIcon!==b||n.expandedIcon!==b)&&(l.removeClass([d(j.iconpos)].concat(j.expandedIcon?["ui-icon-"+j.expandedIcon]:[]).concat(j.collapsedIcon?["ui-icon-"+j.collapsedIcon]:[]).join(" ")),h&&l.addClass([d(n.iconpos!==b?n.iconpos:j.iconpos)].concat(c?["ui-icon-"+(n.collapsedIcon!==b?n.collapsedIcon:j.collapsedIcon)]:["ui-icon-"+(n.expandedIcon!==b?n.expandedIcon:j.expandedIcon)]).join(" "))),n.theme!==b&&(f=this._themeClassFromOption("ui-btn-",j.theme),e=this._themeClassFromOption("ui-btn-",n.theme),l.removeClass(f).addClass(e)),n.contentTheme!==b&&(f=this._themeClassFromOption("ui-body-",j.contentTheme),e=this._themeClassFromOption("ui-body-",n.contentTheme),k.content.removeClass(f).addClass(e)),n.inset!==b&&(i.toggleClass("ui-collapsible-inset",n.inset),g=!(!n.inset||!n.corners&&!j.corners)),n.corners!==b&&(g=!(!n.corners||!n.inset&&!j.inset)),g!==b&&i.toggleClass("ui-corner-all",g),n.mini!==b&&l.toggleClass("ui-mini",n.mini)},_setOptions:function(a){this._applyOptions(a),this._super(a),this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(b){var c=this._renderedOptions,d=this._ui;d.status.text(b?c.expandCueText:c.collapseCueText),d.heading.toggleClass("ui-collapsible-heading-collapsed",b).find("a").first().toggleClass("ui-icon-"+c.expandedIcon,!b).toggleClass("ui-icon-"+c.collapsedIcon,b||c.expandedIcon===c.collapsedIcon).removeClass(a.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",b),d.content.toggleClass("ui-collapsible-content-collapsed",b).attr("aria-hidden",b).trigger("updatelayout"),this.options.collapsed=b,this._trigger(b?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var a=this._ui,b=this.options;b.enhanced||(a.placeholder?(a.originalHeading.insertBefore(a.placeholder),a.placeholder.remove(),a.heading.remove()):(a.status.remove(),a.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),a.anchor.contents().unwrap(),a.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}}),a.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}}(a),function(a){function b(b){var d,e=b.length,f=[];for(d=0;e>d;d++)b[d].className.match(c)||f.push(b[d]);return a(f)}var c=/\bui-screen-hidden\b/;a.mobile.behaviors.addFirstLastClasses={_getVisibles:function(a,c){var d;return c?d=b(a):(d=a.filter(":visible"),0===d.length&&(d=b(a))),d},_addFirstLastClasses:function(a,b,c){a.removeClass("ui-first-child ui-last-child"),b.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child"),c||this.element.trigger("updatelayout")},_removeFirstLastClasses:function(a){a.removeClass("ui-first-child ui-last-child")}}}(a),function(a,b){var c=":mobile-collapsible, "+a.mobile.collapsible.initSelector;a.widget("mobile.collapsibleset",a.extend({initSelector:":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')",options:a.extend({enhanced:!1},a.mobile.collapsible.defaults),_handleCollapsibleExpand:function(b){var c=a(b.target).closest(".ui-collapsible");c.parent().is(":mobile-collapsibleset, :jqmData(role='collapsible-set')")&&c.siblings(".ui-collapsible:not(.ui-collapsible-collapsed)").collapsible("collapse")},_create:function(){var b=this.element,c=this.options;a.extend(this,{_classes:""}),c.enhanced||(b.addClass("ui-collapsible-set "+this._themeClassFromOption("ui-group-theme-",c.theme)+" "+(c.corners&&c.inset?"ui-corner-all ":"")),this.element.find(a.mobile.collapsible.initSelector).collapsible()),this._on(b,{collapsibleexpand:"_handleCollapsibleExpand"})},_themeClassFromOption:function(a,b){return b?"none"===b?"":a+b:""},_init:function(){this._refresh(!0),this.element.children(c).filter(":jqmData(collapsed='false')").collapsible("expand")},_setOptions:function(a){var c,d,e=this.element,f=this._themeClassFromOption("ui-group-theme-",a.theme);return f&&e.removeClass(this._themeClassFromOption("ui-group-theme-",this.options.theme)).addClass(f),a.inset!==b&&(d=!(!a.inset||!a.corners&&!this.options.corners)),a.corners!==b&&(d=!(!a.corners||!a.inset&&!this.options.inset)),d!==b&&e.toggleClass("ui-corner-all",d),c=this._super(a),this.element.children(":mobile-collapsible").collapsible("refresh"),c},_destroy:function(){var a=this.element;this._removeFirstLastClasses(a.children(c)),a.removeClass("ui-collapsible-set ui-corner-all "+this._themeClassFromOption("ui-group-theme-",this.options.theme)).children(":mobile-collapsible").collapsible("destroy")},_refresh:function(b){var d=this.element.children(c);this.element.find(a.mobile.collapsible.initSelector).not(".ui-collapsible").collapsible(),this._addFirstLastClasses(d,this._getVisibles(d,b),b)},refresh:function(){this._refresh(!1)}},a.mobile.behaviors.addFirstLastClasses))}(a),function(a){a.fn.fieldcontain=function(){return this.addClass("ui-field-contain")}}(a),function(a){a.fn.grid=function(b){return this.each(function(){var c,d,e=a(this),f=a.extend({grid:null},b),g=e.children(),h={solo:1,a:2,b:3,c:4,d:5},i=f.grid;if(!i)if(g.length<=5)for(d in h)h[d]===g.length&&(i=d);else i="a",e.addClass("ui-grid-duo");c=h[i],e.addClass("ui-grid-"+i),g.filter(":nth-child("+c+"n+1)").addClass("ui-block-a"),c>1&&g.filter(":nth-child("+c+"n+2)").addClass("ui-block-b"),c>2&&g.filter(":nth-child("+c+"n+3)").addClass("ui-block-c"),c>3&&g.filter(":nth-child("+c+"n+4)").addClass("ui-block-d"),c>4&&g.filter(":nth-child("+c+"n+5)").addClass("ui-block-e")})}}(a),function(a,b){a.widget("mobile.navbar",{options:{iconpos:"top",grid:null},_create:function(){var d=this.element,e=d.find("a, button"),f=e.filter(":jqmData(icon)").length?this.options.iconpos:b;d.addClass("ui-navbar").attr("role","navigation").find("ul").jqmEnhanceable().grid({grid:this.options.grid}),e.each(function(){var b=a.mobile.getAttribute(this,"icon"),c=a.mobile.getAttribute(this,"theme"),d="ui-btn";c&&(d+=" ui-btn-"+c),b&&(d+=" ui-icon-"+b+" ui-btn-icon-"+f),a(this).addClass(d)}),d.delegate("a","vclick",function(){var b=a(this);b.hasClass("ui-state-disabled")||b.hasClass("ui-disabled")||b.hasClass(a.mobile.activeBtnClass)||(e.removeClass(a.mobile.activeBtnClass),b.addClass(a.mobile.activeBtnClass),a(c).one("pagehide",function(){b.removeClass(a.mobile.activeBtnClass)}))}),d.closest(".ui-page").bind("pagebeforeshow",function(){e.filter(".ui-state-persist").addClass(a.mobile.activeBtnClass)})}})}(a),function(a){var b=a.mobile.getAttribute;a.widget("mobile.listview",a.extend({options:{theme:null,countTheme:null,dividerTheme:null,icon:"carat-r",splitIcon:"carat-r",splitTheme:null,corners:!0,shadow:!0,inset:!1},_create:function(){var a=this,b="";b+=a.options.inset?" ui-listview-inset":"",a.options.inset&&(b+=a.options.corners?" ui-corner-all":"",b+=a.options.shadow?" ui-shadow":""),a.element.addClass(" ui-listview"+b),a.refresh(!0)},_findFirstElementByTagName:function(a,b,c,d){var e={};for(e[c]=e[d]=!0;a;){if(e[a.nodeName])return a;a=a[b]}return null},_addThumbClasses:function(b){var c,d,e=b.length;for(c=0;e>c;c++)d=a(this._findFirstElementByTagName(b[c].firstChild,"nextSibling","img","IMG")),d.length&&a(this._findFirstElementByTagName(d[0].parentNode,"parentNode","li","LI")).addClass(d.hasClass("ui-li-icon")?"ui-li-has-icon":"ui-li-has-thumb")},_getChildrenByTagName:function(b,c,d){var e=[],f={};for(f[c]=f[d]=!0,b=b.firstChild;b;)f[b.nodeName]&&e.push(b),b=b.nextSibling;return a(e)},_beforeListviewRefresh:a.noop,_afterListviewRefresh:a.noop,refresh:function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=this.options,y=this.element,z=!!a.nodeName(y[0],"ol"),A=y.attr("start"),B={},C=y.find(".ui-li-count"),D=b(y[0],"counttheme")||this.options.countTheme,E=D?"ui-body-"+D:"ui-body-inherit";for(x.theme&&y.addClass("ui-group-theme-"+x.theme),z&&(A||0===A)&&(n=parseInt(A,10)-1,y.css("counter-reset","listnumbering "+n)),this._beforeListviewRefresh(),w=this._getChildrenByTagName(y[0],"li","LI"),e=0,f=w.length;f>e;e++)g=w.eq(e),h="",(c||g[0].className.search(/\bui-li-static\b|\bui-li-divider\b/)<0)&&(l=this._getChildrenByTagName(g[0],"a","A"),m="list-divider"===b(g[0],"role"),p=g.attr("value"),i=b(g[0],"theme"),l.length&&l[0].className.search(/\bui-btn\b/)<0&&!m?(j=b(g[0],"icon"),k=j===!1?!1:j||x.icon,l.removeClass("ui-link"),d="ui-btn",i&&(d+=" ui-btn-"+i),l.length>1?(h="ui-li-has-alt",q=l.last(),r=b(q[0],"theme")||x.splitTheme||b(g[0],"theme",!0),s=r?" ui-btn-"+r:"",t=b(q[0],"icon")||b(g[0],"icon")||x.splitIcon,u="ui-btn ui-btn-icon-notext ui-icon-"+t+s,q.attr("title",a.trim(q.getEncodedText())).addClass(u).empty(),l=l.first()):k&&(d+=" ui-btn-icon-right ui-icon-"+k),l.addClass(d)):m?(v=b(g[0],"theme")||x.dividerTheme||x.theme,h="ui-li-divider ui-bar-"+(v?v:"inherit"),g.attr("role","heading")):l.length<=0&&(h="ui-li-static ui-body-"+(i?i:"inherit")),z&&p&&(o=parseInt(p,10)-1,g.css("counter-reset","listnumbering "+o))),B[h]||(B[h]=[]),B[h].push(g[0]);for(h in B)a(B[h]).addClass(h);C.each(function(){a(this).closest("li").addClass("ui-li-has-count")}),E&&C.not("[class*='ui-body-']").addClass(E),this._addThumbClasses(w),this._addThumbClasses(w.find(".ui-btn")),this._afterListviewRefresh(),this._addFirstLastClasses(w,this._getVisibles(w,c),c)}},a.mobile.behaviors.addFirstLastClasses))}(a),function(a){function b(b){var c=a.trim(b.text())||null;return c?c=c.slice(0,1).toUpperCase():null}a.widget("mobile.listview",a.mobile.listview,{options:{autodividers:!1,autodividersSelector:b},_beforeListviewRefresh:function(){this.options.autodividers&&(this._replaceDividers(),this._superApply(arguments))},_replaceDividers:function(){var b,d,e,f,g,h=null,i=this.element;for(i.children("li:jqmData(role='list-divider')").remove(),d=i.children("li"),b=0;b<d.length;b++)e=d[b],f=this.options.autodividersSelector(a(e)),f&&h!==f&&(g=c.createElement("li"),g.appendChild(c.createTextNode(f)),g.setAttribute("data-"+a.mobile.ns+"role","list-divider"),e.parentNode.insertBefore(g,e)),h=f}})}(a),function(a){var b=/(^|\s)ui-li-divider($|\s)/,c=/(^|\s)ui-screen-hidden($|\s)/;a.widget("mobile.listview",a.mobile.listview,{options:{hideDividers:!1},_afterListviewRefresh:function(){var a,d,e,f=!0;if(this._superApply(arguments),this.options.hideDividers)for(a=this._getChildrenByTagName(this.element[0],"li","LI"),d=a.length-1;d>-1;d--)e=a[d],e.className.match(b)?(f&&(e.className=e.className+" ui-screen-hidden"),f=!0):e.className.match(c)||(f=!1)}})}(a),function(a){a.mobile.nojs=function(b){a(":jqmData(role='nojs')",b).addClass("ui-nojs")}}(a),function(a){a.mobile.behaviors.formReset={_handleFormReset:function(){this._on(this.element.closest("form"),{reset:function(){this._delay("_reset")}})}}}(a),function(a,b){var c=a.mobile.path.hashToSelector;a.widget("mobile.checkboxradio",a.extend({initSelector:"input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",options:{theme:"inherit",mini:!1,wrapperClass:null,enhanced:!1,iconpos:"left"},_create:function(){var b=this.element,c=this.options,d=function(a,b){return a.jqmData(b)||a.closest("form, fieldset").jqmData(b)},e=this.options.enhanced?{element:this.element.siblings("label"),isParent:!1}:this._findLabel(),f=b[0].type,g="ui-"+f+"-on",h="ui-"+f+"-off";("checkbox"===f||"radio"===f)&&(this.element[0].disabled&&(this.options.disabled=!0),c.iconpos=d(b,"iconpos")||e.element.attr("data-"+a.mobile.ns+"iconpos")||c.iconpos,c.mini=d(b,"mini")||c.mini,a.extend(this,{input:b,label:e.element,labelIsParent:e.isParent,inputtype:f,checkedClass:g,uncheckedClass:h}),this.options.enhanced||this._enhance(),this._on(e.element,{vmouseover:"_handleLabelVMouseOver",vclick:"_handleLabelVClick"}),this._on(b,{vmousedown:"_cacheVals",vclick:"_handleInputVClick",focus:"_handleInputFocus",blur:"_handleInputBlur"}),this._handleFormReset(),this.refresh())},_findLabel:function(){var b,d,e,f=this.element,g=f[0].labels;return g&&g.length>0?(d=a(g[0]),e=a.contains(d[0],f[0])):(b=f.closest("label"),e=b.length>0,d=e?b:a(this.document[0].getElementsByTagName("label")).filter("[for='"+c(f[0].id)+"']").first()),{element:d,isParent:e}},_enhance:function(){this.label.addClass("ui-btn ui-corner-all"),this.labelIsParent?this.input.add(this.label).wrapAll(this._wrapper()):(this.element.wrap(this._wrapper()),this.element.parent().prepend(this.label)),this._setOptions({theme:this.options.theme,iconpos:this.options.iconpos,mini:this.options.mini})},_wrapper:function(){return a("<div class='"+(this.options.wrapperClass?this.options.wrapperClass:"")+" ui-"+this.inputtype+(this.options.disabled?" ui-state-disabled":"")+"' ></div>")},_handleInputFocus:function(){this.label.addClass(a.mobile.focusClass)},_handleInputBlur:function(){this.label.removeClass(a.mobile.focusClass)},_handleInputVClick:function(){this.element.prop("checked",this.element.is(":checked")),this._getInputSet().not(this.element).prop("checked",!1),this._updateAll(!0)},_handleLabelVMouseOver:function(a){this.label.parent().hasClass("ui-state-disabled")&&a.stopPropagation()},_handleLabelVClick:function(a){var b=this.element;return b.is(":disabled")?void a.preventDefault():(this._cacheVals(),b.prop("checked","radio"===this.inputtype&&!0||!b.prop("checked")),b.triggerHandler("click"),this._getInputSet().not(b).prop("checked",!1),this._updateAll(),!1)},_cacheVals:function(){this._getInputSet().each(function(){a(this).attr("data-"+a.mobile.ns+"cacheVal",this.checked)})},_getInputSet:function(){var b,d,e=this.element[0],f=e.name,g=e.form,h=this.element.parents().last().get(0),i=this.element;return f&&"radio"===this.inputtype&&h&&(b="input[type='radio'][name='"+c(f)+"']",g?(d=g.getAttribute("id"),d&&(i=a(b+"[form='"+c(d)+"']",h)),i=a(g).find(b).filter(function(){return this.form===g}).add(i)):i=a(b,h).filter(function(){return!this.form})),i},_updateAll:function(b){var c=this;this._getInputSet().each(function(){var d=a(this);!this.checked&&"checkbox"!==c.inputtype||b||d.trigger("change")}).checkboxradio("refresh")},_reset:function(){this.refresh()},_hasIcon:function(){var b,c,d=a.mobile.controlgroup;return d&&(b=this.element.closest(":mobile-controlgroup,"+d.prototype.initSelector),b.length>0)?(c=a.data(b[0],"mobile-controlgroup"),"horizontal"!==(c?c.options.type:b.attr("data-"+a.mobile.ns+"type"))):!0},refresh:function(){var b=this.element[0].checked,c=a.mobile.activeBtnClass,d="ui-btn-icon-"+this.options.iconpos,e=[],f=[];this._hasIcon()?(f.push(c),e.push(d)):(f.push(d),(b?e:f).push(c)),b?(e.push(this.checkedClass),f.push(this.uncheckedClass)):(e.push(this.uncheckedClass),f.push(this.checkedClass)),this.widget().toggleClass("ui-state-disabled",this.element.prop("disabled")),this.label.addClass(e.join(" ")).removeClass(f.join(" "))},widget:function(){return this.label.parent()},_setOptions:function(a){var c=this.label,d=this.options,e=this.widget(),f=this._hasIcon();a.disabled!==b&&(this.input.prop("disabled",!!a.disabled),e.toggleClass("ui-state-disabled",!!a.disabled)),a.mini!==b&&e.toggleClass("ui-mini",!!a.mini),a.theme!==b&&c.removeClass("ui-btn-"+d.theme).addClass("ui-btn-"+a.theme),a.wrapperClass!==b&&e.removeClass(d.wrapperClass).addClass(a.wrapperClass),a.iconpos!==b&&f?c.removeClass("ui-btn-icon-"+d.iconpos).addClass("ui-btn-icon-"+a.iconpos):f||c.removeClass("ui-btn-icon-"+d.iconpos),this._super(a)}},a.mobile.behaviors.formReset))}(a),function(a,b){a.widget("mobile.button",{initSelector:"input[type='button'], input[type='submit'], input[type='reset']",options:{theme:null,icon:null,iconpos:"left",iconshadow:!1,corners:!0,shadow:!0,inline:null,mini:null,wrapperClass:null,enhanced:!1},_create:function(){this.element.is(":disabled")&&(this.options.disabled=!0),this.options.enhanced||this._enhance(),a.extend(this,{wrapper:this.element.parent()}),this._on({focus:function(){this.widget().addClass(a.mobile.focusClass)},blur:function(){this.widget().removeClass(a.mobile.focusClass)}}),this.refresh(!0)},_enhance:function(){this.element.wrap(this._button())},_button:function(){var b=this.options,c=this._getIconClasses(this.options);return a("<div class='ui-btn ui-input-btn"+(b.wrapperClass?" "+b.wrapperClass:"")+(b.theme?" ui-btn-"+b.theme:"")+(b.corners?" ui-corner-all":"")+(b.shadow?" ui-shadow":"")+(b.inline?" ui-btn-inline":"")+(b.mini?" ui-mini":"")+(b.disabled?" ui-state-disabled":"")+(c?" "+c:"")+"' >"+this.element.val()+"</div>")},widget:function(){return this.wrapper},_destroy:function(){this.element.insertBefore(this.wrapper),this.wrapper.remove()},_getIconClasses:function(a){return a.icon?"ui-icon-"+a.icon+(a.iconshadow?" ui-shadow-icon":"")+" ui-btn-icon-"+a.iconpos:""},_setOptions:function(c){var d=this.widget();c.theme!==b&&d.removeClass(this.options.theme).addClass("ui-btn-"+c.theme),c.corners!==b&&d.toggleClass("ui-corner-all",c.corners),c.shadow!==b&&d.toggleClass("ui-shadow",c.shadow),c.inline!==b&&d.toggleClass("ui-btn-inline",c.inline),c.mini!==b&&d.toggleClass("ui-mini",c.mini),c.disabled!==b&&(this.element.prop("disabled",c.disabled),d.toggleClass("ui-state-disabled",c.disabled)),(c.icon!==b||c.iconshadow!==b||c.iconpos!==b)&&d.removeClass(this._getIconClasses(this.options)).addClass(this._getIconClasses(a.extend({},this.options,c))),this._super(c)},refresh:function(b){var c,d=this.element.prop("disabled");this.options.icon&&"notext"===this.options.iconpos&&this.element.attr("title")&&this.element.attr("title",this.element.val()),b||(c=this.element.detach(),a(this.wrapper).text(this.element.val()).append(c)),this.options.disabled!==d&&this._setOptions({disabled:d})}})}(a),function(a){var b=a("meta[name=viewport]"),c=b.attr("content"),d=c+",maximum-scale=1, user-scalable=no",e=c+",maximum-scale=10, user-scalable=yes",f=/(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test(c);a.mobile.zoom=a.extend({},{enabled:!f,locked:!1,disable:function(c){f||a.mobile.zoom.locked||(b.attr("content",d),a.mobile.zoom.enabled=!1,a.mobile.zoom.locked=c||!1)},enable:function(c){f||a.mobile.zoom.locked&&c!==!0||(b.attr("content",e),a.mobile.zoom.enabled=!0,a.mobile.zoom.locked=!1)},restore:function(){f||(b.attr("content",c),a.mobile.zoom.enabled=!0)}})}(a),function(a,b){a.widget("mobile.textinput",{initSelector:"input[type='text'],input[type='search'],:jqmData(type='search'),input[type='number'],:jqmData(type='number'),input[type='password'],input[type='email'],input[type='url'],input[type='tel'],textarea,input[type='time'],input[type='date'],input[type='month'],input[type='week'],input[type='datetime'],input[type='datetime-local'],input[type='color'],input:not([type]),input[type='file']",options:{theme:null,corners:!0,mini:!1,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,wrapperClass:"",enhanced:!1},_create:function(){var b=this.options,c=this.element.is("[type='search'], :jqmData(type='search')"),d="TEXTAREA"===this.element[0].tagName,e=this.element.is("[data-"+(a.mobile.ns||"")+"type='range']"),f=(this.element.is("input")||this.element.is("[data-"+(a.mobile.ns||"")+"type='search']"))&&!e;this.element.prop("disabled")&&(b.disabled=!0),a.extend(this,{classes:this._classesFromOptions(),isSearch:c,isTextarea:d,isRange:e,inputNeedsWrap:f}),this._autoCorrect(),b.enhanced||this._enhance(),this._on({focus:"_handleFocus",blur:"_handleBlur"})},refresh:function(){this.setOptions({disabled:this.element.is(":disabled")})},_enhance:function(){var a=[];this.isTextarea&&a.push("ui-input-text"),(this.isTextarea||this.isRange)&&a.push("ui-shadow-inset"),this.inputNeedsWrap?this.element.wrap(this._wrap()):a=a.concat(this.classes),this.element.addClass(a.join(" "))},widget:function(){return this.inputNeedsWrap?this.element.parent():this.element},_classesFromOptions:function(){var a=this.options,b=[];return b.push("ui-body-"+(null===a.theme?"inherit":a.theme)),a.corners&&b.push("ui-corner-all"),a.mini&&b.push("ui-mini"),a.disabled&&b.push("ui-state-disabled"),a.wrapperClass&&b.push(a.wrapperClass),b
},_wrap:function(){return a("<div class='"+(this.isSearch?"ui-input-search ":"ui-input-text ")+this.classes.join(" ")+" ui-shadow-inset'></div>")},_autoCorrect:function(){"undefined"==typeof this.element[0].autocorrect||a.support.touchOverflow||(this.element[0].setAttribute("autocorrect","off"),this.element[0].setAttribute("autocomplete","off"))},_handleBlur:function(){this.widget().removeClass(a.mobile.focusClass),this.options.preventFocusZoom&&a.mobile.zoom.enable(!0)},_handleFocus:function(){this.options.preventFocusZoom&&a.mobile.zoom.disable(!0),this.widget().addClass(a.mobile.focusClass)},_setOptions:function(a){var c=this.widget();this._super(a),(a.disabled!==b||a.mini!==b||a.corners!==b||a.theme!==b||a.wrapperClass!==b)&&(c.removeClass(this.classes.join(" ")),this.classes=this._classesFromOptions(),c.addClass(this.classes.join(" "))),a.disabled!==b&&this.element.prop("disabled",!!a.disabled)},_destroy:function(){this.options.enhanced||(this.inputNeedsWrap&&this.element.unwrap(),this.element.removeClass("ui-input-text "+this.classes.join(" ")))}})}(a),function(a,d){a.widget("mobile.slider",a.extend({initSelector:"input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",widgetEventPrefix:"slide",options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!1},_create:function(){var e,f,g,h,i,j,k,l,m,n,o=this,p=this.element,q=this.options.trackTheme||a.mobile.getAttribute(p[0],"theme"),r=q?" ui-bar-"+q:" ui-bar-inherit",s=this.options.corners||p.jqmData("corners")?" ui-corner-all":"",t=this.options.mini||p.jqmData("mini")?" ui-mini":"",u=p[0].nodeName.toLowerCase(),v="select"===u,w=p.parent().is(":jqmData(role='rangeslider')"),x=v?"ui-slider-switch":"",y=p.attr("id"),z=a("[for='"+y+"']"),A=z.attr("id")||y+"-label",B=v?0:parseFloat(p.attr("min")),C=v?p.find("option").length-1:parseFloat(p.attr("max")),D=b.parseFloat(p.attr("step")||1),E=c.createElement("a"),F=a(E),G=c.createElement("div"),H=a(G),I=this.options.highlight&&!v?function(){var b=c.createElement("div");return b.className="ui-slider-bg "+a.mobile.activeBtnClass,a(b).prependTo(H)}():!1;if(z.attr("id",A),this.isToggleSwitch=v,E.setAttribute("href","#"),G.setAttribute("role","application"),G.className=[this.isToggleSwitch?"ui-slider ui-slider-track ui-shadow-inset ":"ui-slider-track ui-shadow-inset ",x,r,s,t].join(""),E.className="ui-slider-handle",G.appendChild(E),F.attr({role:"slider","aria-valuemin":B,"aria-valuemax":C,"aria-valuenow":this._value(),"aria-valuetext":this._value(),title:this._value(),"aria-labelledby":A}),a.extend(this,{slider:H,handle:F,control:p,type:u,step:D,max:C,min:B,valuebg:I,isRangeslider:w,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),v){for(k=p.attr("tabindex"),k&&F.attr("tabindex",k),p.attr("tabindex","-1").focus(function(){a(this).blur(),F.focus()}),f=c.createElement("div"),f.className="ui-slider-inneroffset",g=0,h=G.childNodes.length;h>g;g++)f.appendChild(G.childNodes[g]);for(G.appendChild(f),F.addClass("ui-slider-handle-snapping"),e=p.find("option"),i=0,j=e.length;j>i;i++)l=i?"a":"b",m=i?" "+a.mobile.activeBtnClass:"",n=c.createElement("span"),n.className=["ui-slider-label ui-slider-label-",l,m].join(""),n.setAttribute("role","img"),n.appendChild(c.createTextNode(e[i].innerHTML)),a(n).prependTo(H);o._labels=a(".ui-slider-label",H)}p.addClass(v?"ui-slider-switch":"ui-slider-input"),this._on(p,{change:"_controlChange",keyup:"_controlKeyup",blur:"_controlBlur",vmouseup:"_controlVMouseUp"}),H.bind("vmousedown",a.proxy(this._sliderVMouseDown,this)).bind("vclick",!1),this._on(c,{vmousemove:"_preventDocumentDrag"}),this._on(H.add(c),{vmouseup:"_sliderVMouseUp"}),H.insertAfter(p),v||w||(f=this.options.mini?"<div class='ui-slider ui-mini'>":"<div class='ui-slider'>",p.add(H).wrapAll(f)),this._on(this.handle,{vmousedown:"_handleVMouseDown",keydown:"_handleKeydown",keyup:"_handleKeyup"}),this.handle.bind("vclick",!1),this._handleFormReset(),this.refresh(d,d,!0)},_setOptions:function(a){a.theme!==d&&this._setTheme(a.theme),a.trackTheme!==d&&this._setTrackTheme(a.trackTheme),a.corners!==d&&this._setCorners(a.corners),a.mini!==d&&this._setMini(a.mini),a.highlight!==d&&this._setHighlight(a.highlight),a.disabled!==d&&this._setDisabled(a.disabled),this._super(a)},_controlChange:function(a){return this._trigger("controlchange",a)===!1?!1:void(this.mouseMoved||this.refresh(this._value(),!0))},_controlKeyup:function(){this.refresh(this._value(),!0,!0)},_controlBlur:function(){this.refresh(this._value(),!0)},_controlVMouseUp:function(){this._checkedRefresh()},_handleVMouseDown:function(){this.handle.focus()},_handleKeydown:function(b){var c=this._value();if(!this.options.disabled){switch(b.keyCode){case a.mobile.keyCode.HOME:case a.mobile.keyCode.END:case a.mobile.keyCode.PAGE_UP:case a.mobile.keyCode.PAGE_DOWN:case a.mobile.keyCode.UP:case a.mobile.keyCode.RIGHT:case a.mobile.keyCode.DOWN:case a.mobile.keyCode.LEFT:b.preventDefault(),this._keySliding||(this._keySliding=!0,this.handle.addClass("ui-state-active"))}switch(b.keyCode){case a.mobile.keyCode.HOME:this.refresh(this.min);break;case a.mobile.keyCode.END:this.refresh(this.max);break;case a.mobile.keyCode.PAGE_UP:case a.mobile.keyCode.UP:case a.mobile.keyCode.RIGHT:this.refresh(c+this.step);break;case a.mobile.keyCode.PAGE_DOWN:case a.mobile.keyCode.DOWN:case a.mobile.keyCode.LEFT:this.refresh(c-this.step)}}},_handleKeyup:function(){this._keySliding&&(this._keySliding=!1,this.handle.removeClass("ui-state-active"))},_sliderVMouseDown:function(a){return this.options.disabled||1!==a.which&&0!==a.which&&a.which!==d?!1:this._trigger("beforestart",a)===!1?!1:(this.dragging=!0,this.userModified=!1,this.mouseMoved=!1,this.isToggleSwitch&&(this.beforeStart=this.element[0].selectedIndex),this.refresh(a),this._trigger("start"),!1)},_sliderVMouseUp:function(){return this.dragging?(this.dragging=!1,this.isToggleSwitch&&(this.handle.addClass("ui-slider-handle-snapping"),this.refresh(this.mouseMoved?this.userModified?0===this.beforeStart?1:0:this.beforeStart:0===this.beforeStart?1:0)),this.mouseMoved=!1,this._trigger("stop"),!1):void 0},_preventDocumentDrag:function(a){return this._trigger("drag",a)===!1?!1:this.dragging&&!this.options.disabled?(this.mouseMoved=!0,this.isToggleSwitch&&this.handle.removeClass("ui-slider-handle-snapping"),this.refresh(a),this.userModified=this.beforeStart!==this.element[0].selectedIndex,!1):void 0},_checkedRefresh:function(){this.value!==this._value()&&this.refresh(this._value())},_value:function(){return this.isToggleSwitch?this.element[0].selectedIndex:parseFloat(this.element.val())},_reset:function(){this.refresh(d,!1,!0)},refresh:function(b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this,A=a.mobile.getAttribute(this.element[0],"theme"),B=this.options.theme||A,C=B?" ui-btn-"+B:"",D=this.options.trackTheme||A,E=D?" ui-bar-"+D:" ui-bar-inherit",F=this.options.corners?" ui-corner-all":"",G=this.options.mini?" ui-mini":"";if(z.slider[0].className=[this.isToggleSwitch?"ui-slider ui-slider-switch ui-slider-track ui-shadow-inset":"ui-slider-track ui-shadow-inset",E,F,G].join(""),(this.options.disabled||this.element.prop("disabled"))&&this.disable(),this.value=this._value(),this.options.highlight&&!this.isToggleSwitch&&0===this.slider.find(".ui-slider-bg").length&&(this.valuebg=function(){var b=c.createElement("div");return b.className="ui-slider-bg "+a.mobile.activeBtnClass,a(b).prependTo(z.slider)}()),this.handle.addClass("ui-btn"+C+" ui-shadow"),l=this.element,m=!this.isToggleSwitch,n=m?[]:l.find("option"),o=m?parseFloat(l.attr("min")):0,p=m?parseFloat(l.attr("max")):n.length-1,q=m&&parseFloat(l.attr("step"))>0?parseFloat(l.attr("step")):1,"object"==typeof b){if(h=b,i=8,f=this.slider.offset().left,g=this.slider.width(),j=g/((p-o)/q),!this.dragging||h.pageX<f-i||h.pageX>f+g+i)return;k=j>1?(h.pageX-f)/g*100:Math.round((h.pageX-f)/g*100)}else null==b&&(b=m?parseFloat(l.val()||0):l[0].selectedIndex),k=(parseFloat(b)-o)/(p-o)*100;if(!isNaN(k)&&(r=k/100*(p-o)+o,s=(r-o)%q,t=r-s,2*Math.abs(s)>=q&&(t+=s>0?q:-q),u=100/((p-o)/q),r=parseFloat(t.toFixed(5)),"undefined"==typeof j&&(j=g/((p-o)/q)),j>1&&m&&(k=(r-o)*u*(1/q)),0>k&&(k=0),k>100&&(k=100),o>r&&(r=o),r>p&&(r=p),this.handle.css("left",k+"%"),this.handle[0].setAttribute("aria-valuenow",m?r:n.eq(r).attr("value")),this.handle[0].setAttribute("aria-valuetext",m?r:n.eq(r).getEncodedText()),this.handle[0].setAttribute("title",m?r:n.eq(r).getEncodedText()),this.valuebg&&this.valuebg.css("width",k+"%"),this._labels&&(v=this.handle.width()/this.slider.width()*100,w=k&&v+(100-v)*k/100,x=100===k?0:Math.min(v+100-w,100),this._labels.each(function(){var b=a(this).hasClass("ui-slider-label-a");a(this).width((b?w:x)+"%")})),!e)){if(y=!1,m?(y=parseFloat(l.val())!==r,l.val(r)):(y=l[0].selectedIndex!==r,l[0].selectedIndex=r),this._trigger("beforechange",b)===!1)return!1;!d&&y&&l.trigger("change")}},_setHighlight:function(a){a=!!a,a?(this.options.highlight=!!a,this.refresh()):this.valuebg&&(this.valuebg.remove(),this.valuebg=!1)},_setTheme:function(a){this.handle.removeClass("ui-btn-"+this.options.theme).addClass("ui-btn-"+a);var b=this.options.theme?this.options.theme:"inherit",c=a?a:"inherit";this.control.removeClass("ui-body-"+b).addClass("ui-body-"+c)},_setTrackTheme:function(a){var b=this.options.trackTheme?this.options.trackTheme:"inherit",c=a?a:"inherit";this.slider.removeClass("ui-body-"+b).addClass("ui-body-"+c)},_setMini:function(a){a=!!a,this.isToggleSwitch||this.isRangeslider||(this.slider.parent().toggleClass("ui-mini",a),this.element.toggleClass("ui-mini",a)),this.slider.toggleClass("ui-mini",a)},_setCorners:function(a){this.slider.toggleClass("ui-corner-all",a),this.isToggleSwitch||this.control.toggleClass("ui-corner-all",a)},_setDisabled:function(a){a=!!a,this.element.prop("disabled",a),this.slider.toggleClass("ui-state-disabled",a).attr("aria-disabled",a),this.element.toggleClass("ui-state-disabled",a)}},a.mobile.behaviors.formReset))}(a),function(a){function b(){return c||(c=a("<div></div>",{"class":"ui-slider-popup ui-shadow ui-corner-all"})),c.clone()}var c;a.widget("mobile.slider",a.mobile.slider,{options:{popupEnabled:!1,showValue:!1},_create:function(){this._super(),a.extend(this,{_currentValue:null,_popup:null,_popupVisible:!1}),this._setOption("popupEnabled",this.options.popupEnabled),this._on(this.handle,{vmousedown:"_showPopup"}),this._on(this.slider.add(this.document),{vmouseup:"_hidePopup"}),this._refresh()},_positionPopup:function(){var a=this.handle.offset();this._popup.offset({left:a.left+(this.handle.width()-this._popup.width())/2,top:a.top-this._popup.outerHeight()-5})},_setOption:function(a,c){this._super(a,c),"showValue"===a?this.handle.html(c&&!this.options.mini?this._value():""):"popupEnabled"===a&&c&&!this._popup&&(this._popup=b().addClass("ui-body-"+(this.options.theme||"a")).hide().insertBefore(this.element))},refresh:function(){this._super.apply(this,arguments),this._refresh()},_refresh:function(){var a,b=this.options;b.popupEnabled&&this.handle.removeAttr("title"),a=this._value(),a!==this._currentValue&&(this._currentValue=a,b.popupEnabled&&this._popup&&(this._positionPopup(),this._popup.html(a)),b.showValue&&!this.options.mini&&this.handle.html(a))},_showPopup:function(){this.options.popupEnabled&&!this._popupVisible&&(this.handle.html(""),this._popup.show(),this._positionPopup(),this._popupVisible=!0)},_hidePopup:function(){var a=this.options;a.popupEnabled&&this._popupVisible&&(a.showValue&&!a.mini&&this.handle.html(this._value()),this._popup.hide(),this._popupVisible=!1)}})}(a),function(a,b){a.widget("mobile.flipswitch",a.extend({options:{onText:"On",offText:"Off",theme:null,enhanced:!1,wrapperClass:null,corners:!0,mini:!1},_create:function(){this.options.enhanced?a.extend(this,{flipswitch:this.element.parent(),on:this.element.find(".ui-flipswitch-on").eq(0),off:this.element.find(".ui-flipswitch-off").eq(0),type:this.element.get(0).tagName}):this._enhance(),this._handleFormReset(),this._originalTabIndex=this.element.attr("tabindex"),null!=this._originalTabIndex&&this.on.attr("tabindex",this._originalTabIndex),this.element.attr("tabindex","-1"),this._on({focus:"_handleInputFocus"}),this.element.is(":disabled")&&this._setOptions({disabled:!0}),this._on(this.flipswitch,{click:"_toggle",swipeleft:"_left",swiperight:"_right"}),this._on(this.on,{keydown:"_keydown"}),this._on({change:"refresh"})},_handleInputFocus:function(){this.on.focus()},widget:function(){return this.flipswitch},_left:function(){this.flipswitch.removeClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=0:this.element.prop("checked",!1),this.element.trigger("change")},_right:function(){this.flipswitch.addClass("ui-flipswitch-active"),"SELECT"===this.type?this.element.get(0).selectedIndex=1:this.element.prop("checked",!0),this.element.trigger("change")},_enhance:function(){var b=a("<div>"),c=this.options,d=this.element,e=c.theme?c.theme:"inherit",f=a("<a></a>",{href:"#"}),g=a("<span></span>"),h=d.get(0).tagName,i="INPUT"===h?c.onText:d.find("option").eq(1).text(),j="INPUT"===h?c.offText:d.find("option").eq(0).text();f.addClass("ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit").text(i),g.addClass("ui-flipswitch-off").text(j),b.addClass("ui-flipswitch ui-shadow-inset ui-bar-"+e+" "+(c.wrapperClass?c.wrapperClass:"")+" "+(d.is(":checked")||d.find("option").eq(1).is(":selected")?"ui-flipswitch-active":"")+(d.is(":disabled")?" ui-state-disabled":"")+(c.corners?" ui-corner-all":"")+(c.mini?" ui-mini":"")).append(f,g),d.addClass("ui-flipswitch-input").after(b).appendTo(b),a.extend(this,{flipswitch:b,on:f,off:g,type:h})},_reset:function(){this.refresh()},refresh:function(){var a,b=this.flipswitch.hasClass("ui-flipswitch-active")?"_right":"_left";a="SELECT"===this.type?this.element.get(0).selectedIndex>0?"_right":"_left":this.element.prop("checked")?"_right":"_left",a!==b&&this[a]()},_toggle:function(){var a=this.flipswitch.hasClass("ui-flipswitch-active")?"_left":"_right";this[a]()},_keydown:function(b){b.which===a.mobile.keyCode.LEFT?this._left():b.which===a.mobile.keyCode.RIGHT?this._right():b.which===a.mobile.keyCode.SPACE&&(this._toggle(),b.preventDefault())},_setOptions:function(a){if(a.theme!==b){var c=a.theme?a.theme:"inherit",d=a.theme?a.theme:"inherit";this.widget().removeClass("ui-bar-"+c).addClass("ui-bar-"+d)}a.onText!==b&&this.on.text(a.onText),a.offText!==b&&this.off.text(a.offText),a.disabled!==b&&this.widget().toggleClass("ui-state-disabled",a.disabled),a.mini!==b&&this.widget().toggleClass("ui-mini",a.mini),a.corners!==b&&this.widget().toggleClass("ui-corner-all",a.corners),this._super(a)},_destroy:function(){this.options.enhanced||(null!=this._originalTabIndex?this.element.attr("tabindex",this._originalTabIndex):this.element.removeAttr("tabindex"),this.on.remove(),this.off.remove(),this.element.unwrap(),this.flipswitch.remove(),this.removeClass("ui-flipswitch-input"))}},a.mobile.behaviors.formReset))}(a),function(a,b){a.widget("mobile.rangeslider",a.extend({options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!0},_create:function(){var b=this.element,c=this.options.mini?"ui-rangeslider ui-mini":"ui-rangeslider",d=b.find("input").first(),e=b.find("input").last(),f=b.find("label").first(),g=a.data(d.get(0),"mobile-slider")||a.data(d.slider().get(0),"mobile-slider"),h=a.data(e.get(0),"mobile-slider")||a.data(e.slider().get(0),"mobile-slider"),i=g.slider,j=h.slider,k=g.handle,l=a("<div class='ui-rangeslider-sliders' />").appendTo(b);d.addClass("ui-rangeslider-first"),e.addClass("ui-rangeslider-last"),b.addClass(c),i.appendTo(l),j.appendTo(l),f.insertBefore(b),k.prependTo(j),a.extend(this,{_inputFirst:d,_inputLast:e,_sliderFirst:i,_sliderLast:j,_label:f,_targetVal:null,_sliderTarget:!1,_sliders:l,_proxy:!1}),this.refresh(),this._on(this.element.find("input.ui-slider-input"),{slidebeforestart:"_slidebeforestart",slidestop:"_slidestop",slidedrag:"_slidedrag",slidebeforechange:"_change",blur:"_change",keyup:"_change"}),this._on({mousedown:"_change"}),this._on(this.element.closest("form"),{reset:"_handleReset"}),this._on(k,{vmousedown:"_dragFirstHandle"})},_handleReset:function(){var a=this;setTimeout(function(){a._updateHighlight()},0)},_dragFirstHandle:function(b){return a.data(this._inputFirst.get(0),"mobile-slider").dragging=!0,a.data(this._inputFirst.get(0),"mobile-slider").refresh(b),a.data(this._inputFirst.get(0),"mobile-slider")._trigger("start"),!1},_slidedrag:function(b){var c=a(b.target).is(this._inputFirst),d=c?this._inputLast:this._inputFirst;return this._sliderTarget=!1,"first"===this._proxy&&c||"last"===this._proxy&&!c?(a.data(d.get(0),"mobile-slider").dragging=!0,a.data(d.get(0),"mobile-slider").refresh(b),!1):void 0},_slidestop:function(b){var c=a(b.target).is(this._inputFirst);this._proxy=!1,this.element.find("input").trigger("vmouseup"),this._sliderFirst.css("z-index",c?1:"")},_slidebeforestart:function(b){this._sliderTarget=!1,a(b.originalEvent.target).hasClass("ui-slider-track")&&(this._sliderTarget=!0,this._targetVal=a(b.target).val())},_setOptions:function(a){a.theme!==b&&this._setTheme(a.theme),a.trackTheme!==b&&this._setTrackTheme(a.trackTheme),a.mini!==b&&this._setMini(a.mini),a.highlight!==b&&this._setHighlight(a.highlight),a.disabled!==b&&this._setDisabled(a.disabled),this._super(a),this.refresh()},refresh:function(){var a=this.element,b=this.options;(this._inputFirst.is(":disabled")||this._inputLast.is(":disabled"))&&(this.options.disabled=!0),a.find("input").slider({theme:b.theme,trackTheme:b.trackTheme,disabled:b.disabled,corners:b.corners,mini:b.mini,highlight:b.highlight}).slider("refresh"),this._updateHighlight()},_change:function(b){if("keyup"===b.type)return this._updateHighlight(),!1;var c=this,d=parseFloat(this._inputFirst.val(),10),e=parseFloat(this._inputLast.val(),10),f=a(b.target).hasClass("ui-rangeslider-first"),g=f?this._inputFirst:this._inputLast,h=f?this._inputLast:this._inputFirst;if(this._inputFirst.val()>this._inputLast.val()&&"mousedown"===b.type&&!a(b.target).hasClass("ui-slider-handle"))g.blur();else if("mousedown"===b.type)return;return d>e&&!this._sliderTarget?(g.val(f?e:d).slider("refresh"),this._trigger("normalize")):d>e&&(g.val(this._targetVal).slider("refresh"),setTimeout(function(){h.val(f?d:e).slider("refresh"),a.data(h.get(0),"mobile-slider").handle.focus(),c._sliderFirst.css("z-index",f?"":1),c._trigger("normalize")},0),this._proxy=f?"first":"last"),d===e?(a.data(g.get(0),"mobile-slider").handle.css("z-index",1),a.data(h.get(0),"mobile-slider").handle.css("z-index",0)):(a.data(h.get(0),"mobile-slider").handle.css("z-index",""),a.data(g.get(0),"mobile-slider").handle.css("z-index","")),this._updateHighlight(),d>=e?!1:void 0},_updateHighlight:function(){var b=parseInt(a.data(this._inputFirst.get(0),"mobile-slider").handle.get(0).style.left,10),c=parseInt(a.data(this._inputLast.get(0),"mobile-slider").handle.get(0).style.left,10),d=c-b;this.element.find(".ui-slider-bg").css({"margin-left":b+"%",width:d+"%"})},_setTheme:function(a){this._inputFirst.slider("option","theme",a),this._inputLast.slider("option","theme",a)},_setTrackTheme:function(a){this._inputFirst.slider("option","trackTheme",a),this._inputLast.slider("option","trackTheme",a)},_setMini:function(a){this._inputFirst.slider("option","mini",a),this._inputLast.slider("option","mini",a),this.element.toggleClass("ui-mini",!!a)},_setHighlight:function(a){this._inputFirst.slider("option","highlight",a),this._inputLast.slider("option","highlight",a)},_setDisabled:function(a){this._inputFirst.prop("disabled",a),this._inputLast.prop("disabled",a)},_destroy:function(){this._label.prependTo(this.element),this.element.removeClass("ui-rangeslider ui-mini"),this._inputFirst.after(this._sliderFirst),this._inputLast.after(this._sliderLast),this._sliders.remove(),this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")}},a.mobile.behaviors.formReset))}(a),function(a,b){a.widget("mobile.textinput",a.mobile.textinput,{options:{clearBtn:!1,clearBtnText:"Clear text"},_create:function(){this._super(),this.isSearch&&(this.options.clearBtn=!0),this.options.clearBtn&&this.inputNeedsWrap&&this._addClearBtn()},clearButton:function(){return a("<a href='#' tabindex='-1' aria-hidden='true' class='ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all'></a>").attr("title",this.options.clearBtnText).text(this.options.clearBtnText)},_clearBtnClick:function(a){this.element.val("").focus().trigger("change"),this._clearBtn.addClass("ui-input-clear-hidden"),a.preventDefault()},_addClearBtn:function(){this.options.enhanced||this._enhanceClear(),a.extend(this,{_clearBtn:this.widget().find("a.ui-input-clear")}),this._bindClearEvents(),this._toggleClear()},_enhanceClear:function(){this.clearButton().appendTo(this.widget()),this.widget().addClass("ui-input-has-clear")},_bindClearEvents:function(){this._on(this._clearBtn,{click:"_clearBtnClick"}),this._on({keyup:"_toggleClear",change:"_toggleClear",input:"_toggleClear",focus:"_toggleClear",blur:"_toggleClear",cut:"_toggleClear",paste:"_toggleClear"})},_unbindClear:function(){this._off(this._clearBtn,"click"),this._off(this.element,"keyup change input focus blur cut paste")},_setOptions:function(a){this._super(a),a.clearBtn===b||this.element.is("textarea, :jqmData(type='range')")||(a.clearBtn?this._addClearBtn():this._destroyClear()),a.clearBtnText!==b&&this._clearBtn!==b&&this._clearBtn.text(a.clearBtnText).attr("title",a.clearBtnText)},_toggleClear:function(){this._delay("_toggleClearClass",0)},_toggleClearClass:function(){this._clearBtn.toggleClass("ui-input-clear-hidden",!this.element.val())},_destroyClear:function(){this.widget().removeClass("ui-input-has-clear"),this._unbindClear(),this._clearBtn.remove()},_destroy:function(){this._super(),this.options.clearBtn&&this._destroyClear()}})}(a),function(a,b){a.widget("mobile.textinput",a.mobile.textinput,{options:{autogrow:!0,keyupTimeoutBuffer:100},_create:function(){this._super(),this.options.autogrow&&this.isTextarea&&this._autogrow()},_autogrow:function(){this.element.addClass("ui-textinput-autogrow"),this._on({keyup:"_timeout",change:"_timeout",input:"_timeout",paste:"_timeout"}),this._on(!0,this.document,{pageshow:"_handleShow",popupbeforeposition:"_handleShow",updatelayout:"_handleShow",panelopen:"_handleShow"})},_handleShow:function(b){a.contains(b.target,this.element[0])&&this.element.is(":visible")&&("popupbeforeposition"!==b.type&&this.element.addClass("ui-textinput-autogrow-resize").animationComplete(a.proxy(function(){this.element.removeClass("ui-textinput-autogrow-resize")},this),"transition"),this._prepareHeightUpdate())},_unbindAutogrow:function(){this.element.removeClass("ui-textinput-autogrow"),this._off(this.element,"keyup change input paste"),this._off(this.document,"pageshow popupbeforeposition updatelayout panelopen")},keyupTimeout:null,_prepareHeightUpdate:function(a){this.keyupTimeout&&clearTimeout(this.keyupTimeout),a===b?this._updateHeight():this.keyupTimeout=this._delay("_updateHeight",a)},_timeout:function(){this._prepareHeightUpdate(this.options.keyupTimeoutBuffer)},_updateHeight:function(){var a,b,c,d,e,f,g,h,i,j=this.window.scrollTop();this.keyupTimeout=0,"onpage"in this.element[0]||this.element.css({height:0,"min-height":0,"max-height":0}),d=this.element[0].scrollHeight,e=this.element[0].clientHeight,f=parseFloat(this.element.css("border-top-width")),g=parseFloat(this.element.css("border-bottom-width")),h=f+g,i=d+h+15,0===e&&(a=parseFloat(this.element.css("padding-top")),b=parseFloat(this.element.css("padding-bottom")),c=a+b,i+=c),this.element.css({height:i,"min-height":"","max-height":""}),this.window.scrollTop(j)},refresh:function(){this.options.autogrow&&this.isTextarea&&this._updateHeight()},_setOptions:function(a){this._super(a),a.autogrow!==b&&this.isTextarea&&(a.autogrow?this._autogrow():this._unbindAutogrow())}})}(a),function(a){a.widget("mobile.selectmenu",a.extend({initSelector:"select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",options:{theme:null,icon:"carat-d",iconpos:"right",inline:!1,corners:!0,shadow:!0,iconshadow:!1,overlayTheme:null,dividerTheme:null,hidePlaceholderMenuItems:!0,closeText:"Close",nativeMenu:!0,preventFocusZoom:/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1,mini:!1},_button:function(){return a("<div/>")},_setDisabled:function(a){return this.element.attr("disabled",a),this.button.attr("aria-disabled",a),this._setOption("disabled",a)},_focusButton:function(){var a=this;setTimeout(function(){a.button.focus()},40)},_selectOptions:function(){return this.select.find("option")},_preExtension:function(){var b=this.options.inline||this.element.jqmData("inline"),c=this.options.mini||this.element.jqmData("mini"),d="";~this.element[0].className.indexOf("ui-btn-left")&&(d=" ui-btn-left"),~this.element[0].className.indexOf("ui-btn-right")&&(d=" ui-btn-right"),b&&(d+=" ui-btn-inline"),c&&(d+=" ui-mini"),this.select=this.element.removeClass("ui-btn-left ui-btn-right").wrap("<div class='ui-select"+d+"'>"),this.selectId=this.select.attr("id")||"select-"+this.uuid,this.buttonId=this.selectId+"-button",this.label=a("label[for='"+this.selectId+"']"),this.isMultiple=this.select[0].multiple},_destroy:function(){var a=this.element.parents(".ui-select");a.length>0&&(a.is(".ui-btn-left, .ui-btn-right")&&this.element.addClass(a.hasClass("ui-btn-left")?"ui-btn-left":"ui-btn-right"),this.element.insertAfter(a),a.remove())},_create:function(){this._preExtension(),this.button=this._button();var c=this,d=this.options,e=d.icon?d.iconpos||this.select.jqmData("iconpos"):!1,f=this.button.insertBefore(this.select).attr("id",this.buttonId).addClass("ui-btn"+(d.icon?" ui-icon-"+d.icon+" ui-btn-icon-"+e+(d.iconshadow?" ui-shadow-icon":""):"")+(d.theme?" ui-btn-"+d.theme:"")+(d.corners?" ui-corner-all":"")+(d.shadow?" ui-shadow":""));this.setButtonText(),d.nativeMenu&&b.opera&&b.opera.version&&f.addClass("ui-select-nativeonly"),this.isMultiple&&(this.buttonCount=a("<span>").addClass("ui-li-count ui-body-inherit").hide().appendTo(f.addClass("ui-li-has-count"))),(d.disabled||this.element.attr("disabled"))&&this.disable(),this.select.change(function(){c.refresh(),d.nativeMenu&&c._delay(function(){c.select.blur()})}),this._handleFormReset(),this._on(this.button,{keydown:"_handleKeydown"}),this.build()},build:function(){var b=this;this.select.appendTo(b.button).bind("vmousedown",function(){b.button.addClass(a.mobile.activeBtnClass)}).bind("focus",function(){b.button.addClass(a.mobile.focusClass)}).bind("blur",function(){b.button.removeClass(a.mobile.focusClass)}).bind("focus vmouseover",function(){b.button.trigger("vmouseover")}).bind("vmousemove",function(){b.button.removeClass(a.mobile.activeBtnClass)}).bind("change blur vmouseout",function(){b.button.trigger("vmouseout").removeClass(a.mobile.activeBtnClass)}),b.button.bind("vmousedown",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)}),b.label.bind("click focus",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)}),b.select.bind("focus",function(){b.options.preventFocusZoom&&a.mobile.zoom.disable(!0)}),b.button.bind("mouseup",function(){b.options.preventFocusZoom&&setTimeout(function(){a.mobile.zoom.enable(!0)},0)}),b.select.bind("blur",function(){b.options.preventFocusZoom&&a.mobile.zoom.enable(!0)})},selected:function(){return this._selectOptions().filter(":selected")},selectedIndices:function(){var a=this;return this.selected().map(function(){return a._selectOptions().index(this)}).get()},setButtonText:function(){var b=this,d=this.selected(),e=this.placeholder,f=a(c.createElement("span"));this.button.children("span").not(".ui-li-count").remove().end().end().prepend(function(){return e=d.length?d.map(function(){return a(this).text()}).get().join(", "):b.placeholder,e?f.text(e):f.html("&#160;"),f.addClass(b.select.attr("class")).addClass(d.attr("class")).removeClass("ui-screen-hidden")}())},setButtonCount:function(){var a=this.selected();this.isMultiple&&this.buttonCount[a.length>1?"show":"hide"]().text(a.length)},_handleKeydown:function(){this._delay("_refreshButton")},_reset:function(){this.refresh()},_refreshButton:function(){this.setButtonText(),this.setButtonCount()},refresh:function(){this._refreshButton()},open:a.noop,close:a.noop,disable:function(){this._setDisabled(!0),this.button.addClass("ui-state-disabled")},enable:function(){this._setDisabled(!1),this.button.removeClass("ui-state-disabled")}},a.mobile.behaviors.formReset))}(a),function(a){a.mobile.links=function(b){a(b).find("a").jqmEnhanceable().filter(":jqmData(rel='popup')[href][href!='']").each(function(){var a=this,b=a.getAttribute("href").substring(1);b&&(a.setAttribute("aria-haspopup",!0),a.setAttribute("aria-owns",b),a.setAttribute("aria-expanded",!1))}).end().not(".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')").addClass("ui-link")}}(a),function(a,c){function d(a,b,c,d){var e=d;return e=b>a?c+(a-b)/2:Math.min(Math.max(c,d-b/2),c+a-b)}function e(a){return{x:a.scrollLeft(),y:a.scrollTop(),cx:a[0].innerWidth||a.width(),cy:a[0].innerHeight||a.height()}}a.widget("mobile.popup",{options:{wrapperClass:null,theme:null,overlayTheme:null,shadow:!0,corners:!0,transition:"none",positionTo:"origin",tolerance:null,closeLinkSelector:"a:jqmData(rel='back')",closeLinkEvents:"click.popup",navigateEvents:"navigate.popup",closeEvents:"navigate.popup pagebeforechange.popup",dismissible:!0,enhanced:!1,history:!a.mobile.browser.oldIE},_handleDocumentVmousedown:function(b){this._isOpen&&a.contains(this._ui.container[0],b.target)&&this._ignoreResizeEvents()},_create:function(){var b=this.element,c=b.attr("id"),d=this.options;d.history=d.history&&a.mobile.ajaxEnabled&&a.mobile.hashListeningEnabled,this._on(this.document,{vmousedown:"_handleDocumentVmousedown"}),a.extend(this,{_scrollTop:0,_page:b.closest(".ui-page"),_ui:null,_fallbackTransition:"",_currentTransition:!1,_prerequisites:null,_isOpen:!1,_tolerance:null,_resizeData:null,_ignoreResizeTo:0,_orientationchangeInProgress:!1}),0===this._page.length&&(this._page=a("body")),d.enhanced?this._ui={container:b.parent(),screen:b.parent().prev(),placeholder:a(this.document[0].getElementById(c+"-placeholder"))}:(this._ui=this._enhance(b,c),this._applyTransition(d.transition)),this._setTolerance(d.tolerance)._ui.focusElement=this._ui.container,this._on(this._ui.screen,{vclick:"_eatEventAndClose"}),this._on(this.window,{orientationchange:a.proxy(this,"_handleWindowOrientationchange"),resize:a.proxy(this,"_handleWindowResize"),keyup:a.proxy(this,"_handleWindowKeyUp")}),this._on(this.document,{focusin:"_handleDocumentFocusIn"})},_enhance:function(b,c){var d=this.options,e=d.wrapperClass,f={screen:a("<div class='ui-screen-hidden ui-popup-screen "+this._themeClassFromOption("ui-overlay-",d.overlayTheme)+"'></div>"),placeholder:a("<div style='display: none;'><!-- placeholder --></div>"),container:a("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate"+(e?" "+e:"")+"'></div>")},g=this.document[0].createDocumentFragment();return g.appendChild(f.screen[0]),g.appendChild(f.container[0]),c&&(f.screen.attr("id",c+"-screen"),f.container.attr("id",c+"-popup"),f.placeholder.attr("id",c+"-placeholder").html("<!-- placeholder for "+c+" -->")),this._page[0].appendChild(g),f.placeholder.insertAfter(b),b.detach().addClass("ui-popup "+this._themeClassFromOption("ui-body-",d.theme)+" "+(d.shadow?"ui-overlay-shadow ":"")+(d.corners?"ui-corner-all ":"")).appendTo(f.container),f},_eatEventAndClose:function(a){return a.preventDefault(),a.stopImmediatePropagation(),this.options.dismissible&&this.close(),!1},_resizeScreen:function(){var a=this._ui.screen,b=this._ui.container.outerHeight(!0),c=a.removeAttr("style").height(),d=this.document.height()-1;d>c?a.height(d):b>c&&a.height(b)},_handleWindowKeyUp:function(b){return this._isOpen&&b.keyCode===a.mobile.keyCode.ESCAPE?this._eatEventAndClose(b):void 0},_expectResizeEvent:function(){var a=e(this.window);
if(this._resizeData){if(a.x===this._resizeData.windowCoordinates.x&&a.y===this._resizeData.windowCoordinates.y&&a.cx===this._resizeData.windowCoordinates.cx&&a.cy===this._resizeData.windowCoordinates.cy)return!1;clearTimeout(this._resizeData.timeoutId)}return this._resizeData={timeoutId:this._delay("_resizeTimeout",200),windowCoordinates:a},!0},_resizeTimeout:function(){this._isOpen?this._expectResizeEvent()||(this._ui.container.hasClass("ui-popup-hidden")&&(this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"),this.reposition({positionTo:"window"}),this._ignoreResizeEvents()),this._resizeScreen(),this._resizeData=null,this._orientationchangeInProgress=!1):(this._resizeData=null,this._orientationchangeInProgress=!1)},_stopIgnoringResizeEvents:function(){this._ignoreResizeTo=0},_ignoreResizeEvents:function(){this._ignoreResizeTo&&clearTimeout(this._ignoreResizeTo),this._ignoreResizeTo=this._delay("_stopIgnoringResizeEvents",1e3)},_handleWindowResize:function(){this._isOpen&&0===this._ignoreResizeTo&&(!this._expectResizeEvent()&&!this._orientationchangeInProgress||this._ui.container.hasClass("ui-popup-hidden")||this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))},_handleWindowOrientationchange:function(){!this._orientationchangeInProgress&&this._isOpen&&0===this._ignoreResizeTo&&(this._expectResizeEvent(),this._orientationchangeInProgress=!0)},_handleDocumentFocusIn:function(b){var c,d=b.target,e=this._ui;if(this._isOpen){if(d!==e.container[0]){if(c=a(d),!a.contains(e.container[0],d))return a(this.document[0].activeElement).one("focus",a.proxy(function(){this._safelyBlur(d)},this)),e.focusElement.focus(),b.preventDefault(),b.stopImmediatePropagation(),!1;e.focusElement[0]===e.container[0]&&(e.focusElement=c)}this._ignoreResizeEvents()}},_themeClassFromOption:function(a,b){return b?"none"===b?"":a+b:a+"inherit"},_applyTransition:function(b){return b&&(this._ui.container.removeClass(this._fallbackTransition),"none"!==b&&(this._fallbackTransition=a.mobile._maybeDegradeTransition(b),"none"===this._fallbackTransition&&(this._fallbackTransition=""),this._ui.container.addClass(this._fallbackTransition))),this},_setOptions:function(a){var b=this.options,d=this.element,e=this._ui.screen;return a.wrapperClass!==c&&this._ui.container.removeClass(b.wrapperClass).addClass(a.wrapperClass),a.theme!==c&&d.removeClass(this._themeClassFromOption("ui-body-",b.theme)).addClass(this._themeClassFromOption("ui-body-",a.theme)),a.overlayTheme!==c&&(e.removeClass(this._themeClassFromOption("ui-overlay-",b.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-",a.overlayTheme)),this._isOpen&&e.addClass("in")),a.shadow!==c&&d.toggleClass("ui-overlay-shadow",a.shadow),a.corners!==c&&d.toggleClass("ui-corner-all",a.corners),a.transition!==c&&(this._currentTransition||this._applyTransition(a.transition)),a.tolerance!==c&&this._setTolerance(a.tolerance),a.disabled!==c&&a.disabled&&this.close(),this._super(a)},_setTolerance:function(b){var d,e={t:30,r:15,b:30,l:15};if(b!==c)switch(d=String(b).split(","),a.each(d,function(a,b){d[a]=parseInt(b,10)}),d.length){case 1:isNaN(d[0])||(e.t=e.r=e.b=e.l=d[0]);break;case 2:isNaN(d[0])||(e.t=e.b=d[0]),isNaN(d[1])||(e.l=e.r=d[1]);break;case 4:isNaN(d[0])||(e.t=d[0]),isNaN(d[1])||(e.r=d[1]),isNaN(d[2])||(e.b=d[2]),isNaN(d[3])||(e.l=d[3])}return this._tolerance=e,this},_clampPopupWidth:function(a){var b,c=e(this.window),d={x:this._tolerance.l,y:c.y+this._tolerance.t,cx:c.cx-this._tolerance.l-this._tolerance.r,cy:c.cy-this._tolerance.t-this._tolerance.b};return a||this._ui.container.css("max-width",d.cx),b={cx:this._ui.container.outerWidth(!0),cy:this._ui.container.outerHeight(!0)},{rc:d,menuSize:b}},_calculateFinalLocation:function(a,b){var c,e=b.rc,f=b.menuSize;return c={left:d(e.cx,f.cx,e.x,a.x),top:d(e.cy,f.cy,e.y,a.y)},c.top=Math.max(0,c.top),c.top-=Math.min(c.top,Math.max(0,c.top+f.cy-this.document.height())),c},_placementCoords:function(a){return this._calculateFinalLocation(a,this._clampPopupWidth())},_createPrerequisites:function(b,c,d){var e,f=this;e={screen:a.Deferred(),container:a.Deferred()},e.screen.then(function(){e===f._prerequisites&&b()}),e.container.then(function(){e===f._prerequisites&&c()}),a.when(e.screen,e.container).done(function(){e===f._prerequisites&&(f._prerequisites=null,d())}),f._prerequisites=e},_animate:function(b){return this._ui.screen.removeClass(b.classToRemove).addClass(b.screenClassToAdd),b.prerequisites.screen.resolve(),b.transition&&"none"!==b.transition&&(b.applyTransition&&this._applyTransition(b.transition),this._fallbackTransition)?void this._ui.container.addClass(b.containerClassToAdd).removeClass(b.classToRemove).animationComplete(a.proxy(b.prerequisites.container,"resolve")):(this._ui.container.removeClass(b.classToRemove),void b.prerequisites.container.resolve())},_desiredCoords:function(b){var c,d=null,f=e(this.window),g=b.x,h=b.y,i=b.positionTo;if(i&&"origin"!==i)if("window"===i)g=f.cx/2+f.x,h=f.cy/2+f.y;else{try{d=a(i)}catch(j){d=null}d&&(d.filter(":visible"),0===d.length&&(d=null))}return d&&(c=d.offset(),g=c.left+d.outerWidth()/2,h=c.top+d.outerHeight()/2),("number"!==a.type(g)||isNaN(g))&&(g=f.cx/2+f.x),("number"!==a.type(h)||isNaN(h))&&(h=f.cy/2+f.y),{x:g,y:h}},_reposition:function(a){a={x:a.x,y:a.y,positionTo:a.positionTo},this._trigger("beforeposition",c,a),this._ui.container.offset(this._placementCoords(this._desiredCoords(a)))},reposition:function(a){this._isOpen&&this._reposition(a)},_safelyBlur:function(b){b!==this.window[0]&&"body"!==b.nodeName.toLowerCase()&&a(b).blur()},_openPrerequisitesComplete:function(){var b=this.element.attr("id"),c=this._ui.container.find(":focusable").first();this._ui.container.addClass("ui-popup-active"),this._isOpen=!0,this._resizeScreen(),a.contains(this._ui.container[0],this.document[0].activeElement)||this._safelyBlur(this.document[0].activeElement),c.length>0&&(this._ui.focusElement=c),this._ignoreResizeEvents(),b&&this.document.find("[aria-haspopup='true'][aria-owns='"+b+"']").attr("aria-expanded",!0),this._trigger("afteropen")},_open:function(b){var c=a.extend({},this.options,b),d=function(){var a=navigator.userAgent,b=a.match(/AppleWebKit\/([0-9\.]+)/),c=!!b&&b[1],d=a.match(/Android (\d+(?:\.\d+))/),e=!!d&&d[1],f=a.indexOf("Chrome")>-1;return null!==d&&"4.0"===e&&c&&c>534.13&&!f?!0:!1}();this._createPrerequisites(a.noop,a.noop,a.proxy(this,"_openPrerequisitesComplete")),this._currentTransition=c.transition,this._applyTransition(c.transition),this._ui.screen.removeClass("ui-screen-hidden"),this._ui.container.removeClass("ui-popup-truncate"),this._reposition(c),this._ui.container.removeClass("ui-popup-hidden"),this.options.overlayTheme&&d&&this.element.closest(".ui-page").addClass("ui-popup-open"),this._animate({additionalCondition:!0,transition:c.transition,classToRemove:"",screenClassToAdd:"in",containerClassToAdd:"in",applyTransition:!1,prerequisites:this._prerequisites})},_closePrerequisiteScreen:function(){this._ui.screen.removeClass("out").addClass("ui-screen-hidden")},_closePrerequisiteContainer:function(){this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")},_closePrerequisitesDone:function(){var b=this._ui.container,d=this.element.attr("id");a.mobile.popup.active=c,a(":focus",b[0]).add(b[0]).blur(),d&&this.document.find("[aria-haspopup='true'][aria-owns='"+d+"']").attr("aria-expanded",!1),this._trigger("afterclose")},_close:function(b){this._ui.container.removeClass("ui-popup-active"),this._page.removeClass("ui-popup-open"),this._isOpen=!1,this._createPrerequisites(a.proxy(this,"_closePrerequisiteScreen"),a.proxy(this,"_closePrerequisiteContainer"),a.proxy(this,"_closePrerequisitesDone")),this._animate({additionalCondition:this._ui.screen.hasClass("in"),transition:b?"none":this._currentTransition,classToRemove:"in",screenClassToAdd:"out",containerClassToAdd:"reverse out",applyTransition:!0,prerequisites:this._prerequisites})},_unenhance:function(){this.options.enhanced||(this._setOptions({theme:a.mobile.popup.prototype.options.theme}),this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"),this._ui.screen.remove(),this._ui.container.remove(),this._ui.placeholder.remove())},_destroy:function(){return a.mobile.popup.active===this?(this.element.one("popupafterclose",a.proxy(this,"_unenhance")),this.close()):this._unenhance(),this},_closePopup:function(c,d){var e,f,g=this.options,h=!1;c&&c.isDefaultPrevented()||a.mobile.popup.active!==this||(b.scrollTo(0,this._scrollTop),c&&"pagebeforechange"===c.type&&d&&(e="string"==typeof d.toPage?d.toPage:d.toPage.jqmData("url"),e=a.mobile.path.parseUrl(e),f=e.pathname+e.search+e.hash,this._myUrl!==a.mobile.path.makeUrlAbsolute(f)?h=!0:c.preventDefault()),this.window.off(g.closeEvents),this.element.undelegate(g.closeLinkSelector,g.closeLinkEvents),this._close(h))},_bindContainerClose:function(){this.window.on(this.options.closeEvents,a.proxy(this,"_closePopup"))},widget:function(){return this._ui.container},open:function(b){var c,d,e,f,g,h,i=this,j=this.options;return a.mobile.popup.active||j.disabled?this:(a.mobile.popup.active=this,this._scrollTop=this.window.scrollTop(),j.history?(h=a.mobile.navigate.history,d=a.mobile.dialogHashKey,e=a.mobile.activePage,f=e?e.hasClass("ui-dialog"):!1,this._myUrl=c=h.getActive().url,(g=c.indexOf(d)>-1&&!f&&h.activeIndex>0)?(i._open(b),i._bindContainerClose(),this):(-1!==c.indexOf(d)||f?c=a.mobile.path.parseLocation().hash+d:c+=c.indexOf("#")>-1?d:"#"+d,this.window.one("beforenavigate",function(a){a.preventDefault(),i._open(b),i._bindContainerClose()}),this.urlAltered=!0,a.mobile.navigate(c,{role:"dialog"}),this)):(i._open(b),i._bindContainerClose(),i.element.delegate(j.closeLinkSelector,j.closeLinkEvents,function(a){i.close(),a.preventDefault()}),this))},close:function(){return a.mobile.popup.active!==this?this:(this._scrollTop=this.window.scrollTop(),this.options.history&&this.urlAltered?(a.mobile.back(),this.urlAltered=!1):this._closePopup(),this)}}),a.mobile.popup.handleLink=function(b){var c,d=a.mobile.path,e=a(d.hashToSelector(d.parseUrl(b.attr("href")).hash)).first();e.length>0&&e.data("mobile-popup")&&(c=b.offset(),e.popup("open",{x:c.left+b.outerWidth()/2,y:c.top+b.outerHeight()/2,transition:b.jqmData("transition"),positionTo:b.jqmData("position-to")})),setTimeout(function(){b.removeClass(a.mobile.activeBtnClass)},300)},a.mobile.document.on("pagebeforechange",function(b,c){"popup"===c.options.role&&(a.mobile.popup.handleLink(c.options.link),b.preventDefault())})}(a),function(a,b){var d=".ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')",e=function(a,b,c){var e=a[c+"All"]().not(d).first();e.length&&(b.blur().attr("tabindex","-1"),e.find("a").first().focus())};a.widget("mobile.selectmenu",a.mobile.selectmenu,{_create:function(){var a=this.options;return a.nativeMenu=a.nativeMenu||this.element.parents(":jqmData(role='popup'),:mobile-popup").length>0,this._super()},_handleSelectFocus:function(){this.element.blur(),this.button.focus()},_handleKeydown:function(a){this._super(a),this._handleButtonVclickKeydown(a)},_handleButtonVclickKeydown:function(b){this.options.disabled||this.isOpen||this.options.nativeMenu||("vclick"===b.type||b.keyCode&&(b.keyCode===a.mobile.keyCode.ENTER||b.keyCode===a.mobile.keyCode.SPACE))&&(this._decideFormat(),"overlay"===this.menuType?this.button.attr("href","#"+this.popupId).attr("data-"+(a.mobile.ns||"")+"rel","popup"):this.button.attr("href","#"+this.dialogId).attr("data-"+(a.mobile.ns||"")+"rel","dialog"),this.isOpen=!0)},_handleListFocus:function(b){var c="focusin"===b.type?{tabindex:"0",event:"vmouseover"}:{tabindex:"-1",event:"vmouseout"};a(b.target).attr("tabindex",c.tabindex).trigger(c.event)},_handleListKeydown:function(b){var c=a(b.target),d=c.closest("li");switch(b.keyCode){case 38:return e(d,c,"prev"),!1;case 40:return e(d,c,"next"),!1;case 13:case 32:return c.trigger("click"),!1}},_handleMenuPageHide:function(){this._delayedTrigger(),this.thisPage.page("bindRemove")},_handleHeaderCloseClick:function(){return"overlay"===this.menuType?(this.close(),!1):void 0},_handleListItemClick:function(b){var c=a(b.target).closest("li"),d=this.select[0].selectedIndex,e=a.mobile.getAttribute(c,"option-index"),f=this._selectOptions().eq(e)[0];f.selected=this.isMultiple?!f.selected:!0,this.isMultiple&&c.find("a").toggleClass("ui-checkbox-on",f.selected).toggleClass("ui-checkbox-off",!f.selected),this.isMultiple||d===e||(this._triggerChange=!0),this.isMultiple?(this.select.trigger("change"),this.list.find("li:not(.ui-li-divider)").eq(e).find("a").first().focus()):this.close(),b.preventDefault()},build:function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=this.options;return v.nativeMenu?this._super():(c=this.selectId,d=c+"-listbox",e=c+"-dialog",f=this.label,g=this.element.closest(".ui-page"),h=this.element[0].multiple,i=c+"-menu",j=v.theme?" data-"+a.mobile.ns+"theme='"+v.theme+"'":"",k=v.overlayTheme||v.theme||null,l=k?" data-"+a.mobile.ns+"overlay-theme='"+k+"'":"",m=v.dividerTheme&&h?" data-"+a.mobile.ns+"divider-theme='"+v.dividerTheme+"'":"",n=a("<div data-"+a.mobile.ns+"role='dialog' class='ui-selectmenu' id='"+e+"'"+j+l+"><div data-"+a.mobile.ns+"role='header'><div class='ui-title'></div></div><div data-"+a.mobile.ns+"role='content'></div></div>"),o=a("<div"+j+l+" id='"+d+"' class='ui-selectmenu'></div>").insertAfter(this.select).popup(),p=a("<ul class='ui-selectmenu-list' id='"+i+"' role='listbox' aria-labelledby='"+this.buttonId+"'"+j+m+"></ul>").appendTo(o),q=a("<div class='ui-header ui-bar-"+(v.theme?v.theme:"inherit")+"'></div>").prependTo(o),r=a("<h1 class='ui-title'></h1>").appendTo(q),this.isMultiple&&(u=a("<a>",{role:"button",text:v.closeText,href:"#","class":"ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete"}).appendTo(q)),a.extend(this,{selectId:c,menuId:i,popupId:d,dialogId:e,thisPage:g,menuPage:n,label:f,isMultiple:h,theme:v.theme,listbox:o,list:p,header:q,headerTitle:r,headerClose:u,menuPageContent:s,menuPageClose:t,placeholder:""}),this.refresh(),this._origTabIndex===b&&(this._origTabIndex=null===this.select[0].getAttribute("tabindex")?!1:this.select.attr("tabindex")),this.select.attr("tabindex","-1"),this._on(this.select,{focus:"_handleSelectFocus"}),this._on(this.button,{vclick:"_handleButtonVclickKeydown"}),this.list.attr("role","listbox"),this._on(this.list,{focusin:"_handleListFocus",focusout:"_handleListFocus",keydown:"_handleListKeydown","click li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider)":"_handleListItemClick"}),this._on(this.menuPage,{pagehide:"_handleMenuPageHide"}),this._on(this.listbox,{popupafterclose:"_popupClosed"}),this.isMultiple&&this._on(this.headerClose,{click:"_handleHeaderCloseClick"}),this)},_popupClosed:function(){this.close(),this._delayedTrigger()},_delayedTrigger:function(){this._triggerChange&&this.element.trigger("change"),this._triggerChange=!1},_isRebuildRequired:function(){var a=this.list.find("li"),b=this._selectOptions().not(".ui-screen-hidden");return b.text()!==a.text()},selected:function(){return this._selectOptions().filter(":selected:not( :jqmData(placeholder='true') )")},refresh:function(b){var c,d;return this.options.nativeMenu?this._super(b):(c=this,(b||this._isRebuildRequired())&&c._buildList(),d=this.selectedIndices(),c.setButtonText(),c.setButtonCount(),void c.list.find("li:not(.ui-li-divider)").find("a").removeClass(a.mobile.activeBtnClass).end().attr("aria-selected",!1).each(function(b){var e=a(this);a.inArray(b,d)>-1?(e.attr("aria-selected",!0),c.isMultiple?e.find("a").removeClass("ui-checkbox-off").addClass("ui-checkbox-on"):e.hasClass("ui-screen-hidden")?e.next().find("a").addClass(a.mobile.activeBtnClass):e.find("a").addClass(a.mobile.activeBtnClass)):c.isMultiple&&e.find("a").removeClass("ui-checkbox-on").addClass("ui-checkbox-off")}))},close:function(){if(!this.options.disabled&&this.isOpen){var a=this;"page"===a.menuType?(a.menuPage.dialog("close"),a.list.appendTo(a.listbox)):a.listbox.popup("close"),a._focusButton(),a.isOpen=!1}},open:function(){this.button.click()},_focusMenuItem:function(){var b=this.list.find("a."+a.mobile.activeBtnClass);0===b.length&&(b=this.list.find("li:not("+d+") a.ui-btn")),b.first().focus()},_decideFormat:function(){var b=this,c=this.window,d=b.list.parent(),e=d.outerHeight(),f=c.scrollTop(),g=b.button.offset().top,h=c.height();e>h-80||!a.support.scrollTop?(b.menuPage.appendTo(a.mobile.pageContainer).page(),b.menuPageContent=b.menuPage.find(".ui-content"),b.menuPageClose=b.menuPage.find(".ui-header a"),b.thisPage.unbind("pagehide.remove"),0===f&&g>h&&b.thisPage.one("pagehide",function(){a(this).jqmData("lastScroll",g)}),b.menuPage.one({pageshow:a.proxy(this,"_focusMenuItem"),pagehide:a.proxy(this,"close")}),b.menuType="page",b.menuPageContent.append(b.list),b.menuPage.find("div .ui-title").text(b.label.getEncodedText()||b.placeholder)):(b.menuType="overlay",b.listbox.one({popupafteropen:a.proxy(this,"_focusMenuItem")}))},_buildList:function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=this.options,s=this.placeholder,t=!0,u="false",v="data-"+a.mobile.ns,w=v+"option-index",x=v+"icon",y=v+"role",z=v+"placeholder",A=c.createDocumentFragment(),B=!1;for(q.list.empty().filter(".ui-listview").listview("destroy"),b=this._selectOptions(),d=b.length,e=this.select[0],g=0;d>g;g++,B=!1)h=b[g],i=a(h),i.hasClass("ui-screen-hidden")||(j=h.parentNode,m=[],k=i.text(),l=c.createElement("a"),l.setAttribute("href","#"),l.appendChild(c.createTextNode(k)),j!==e&&"optgroup"===j.nodeName.toLowerCase()&&(n=j.getAttribute("label"),n!==f&&(o=c.createElement("li"),o.setAttribute(y,"list-divider"),o.setAttribute("role","option"),o.setAttribute("tabindex","-1"),o.appendChild(c.createTextNode(n)),A.appendChild(o),f=n)),!t||h.getAttribute("value")&&0!==k.length&&!i.jqmData("placeholder")||(t=!1,B=!0,null===h.getAttribute(z)&&(this._removePlaceholderAttr=!0),h.setAttribute(z,!0),r.hidePlaceholderMenuItems&&m.push("ui-screen-hidden"),s!==k&&(s=q.placeholder=k)),p=c.createElement("li"),h.disabled&&(m.push("ui-state-disabled"),p.setAttribute("aria-disabled",!0)),p.setAttribute(w,g),p.setAttribute(x,u),B&&p.setAttribute(z,!0),p.className=m.join(" "),p.setAttribute("role","option"),l.setAttribute("tabindex","-1"),this.isMultiple&&a(l).addClass("ui-btn ui-checkbox-off ui-btn-icon-right"),p.appendChild(l),A.appendChild(p));q.list[0].appendChild(A),this.isMultiple||s.length?this.headerTitle.text(this.placeholder):this.header.addClass("ui-screen-hidden"),q.list.listview()},_button:function(){return this.options.nativeMenu?this._super():a("<a>",{href:"#",role:"button",id:this.buttonId,"aria-haspopup":"true","aria-owns":this.menuId})},_destroy:function(){this.options.nativeMenu||(this.close(),this._origTabIndex!==b&&(this._origTabIndex!==!1?this.select.attr("tabindex",this._origTabIndex):this.select.removeAttr("tabindex")),this._removePlaceholderAttr&&this._selectOptions().removeAttr("data-"+a.mobile.ns+"placeholder"),this.listbox.remove(),this.menuPage.remove()),this._super()}})}(a),function(a,b){function c(a,b){var c=b?b:[];return c.push("ui-btn"),a.theme&&c.push("ui-btn-"+a.theme),a.icon&&(c=c.concat(["ui-icon-"+a.icon,"ui-btn-icon-"+a.iconpos]),a.iconshadow&&c.push("ui-shadow-icon")),a.inline&&c.push("ui-btn-inline"),a.shadow&&c.push("ui-shadow"),a.corners&&c.push("ui-corner-all"),a.mini&&c.push("ui-mini"),c}function d(a){var c,d,e,g=!1,h=!0,i={icon:"",inline:!1,shadow:!1,corners:!1,iconshadow:!1,mini:!1},j=[];for(a=a.split(" "),c=0;c<a.length;c++)e=!0,d=f[a[c]],d!==b?(e=!1,i[d]=!0):0===a[c].indexOf("ui-btn-icon-")?(e=!1,h=!1,i.iconpos=a[c].substring(12)):0===a[c].indexOf("ui-icon-")?(e=!1,i.icon=a[c].substring(8)):0===a[c].indexOf("ui-btn-")&&8===a[c].length?(e=!1,i.theme=a[c].substring(7)):"ui-btn"===a[c]&&(e=!1,g=!0),e&&j.push(a[c]);return h&&(i.icon=""),{options:i,unknownClasses:j,alreadyEnhanced:g}}function e(a){return"-"+a.toLowerCase()}var f={"ui-shadow":"shadow","ui-corner-all":"corners","ui-btn-inline":"inline","ui-shadow-icon":"iconshadow","ui-mini":"mini"},g=function(){var c=a.mobile.getAttribute.apply(this,arguments);return null==c?b:c},h=/[A-Z]/g;a.fn.buttonMarkup=function(f,i){var j,k,l,m,n,o=a.fn.buttonMarkup.defaults;for(j=0;j<this.length;j++){if(l=this[j],k=i?{alreadyEnhanced:!1,unknownClasses:[]}:d(l.className),m=a.extend({},k.alreadyEnhanced?k.options:{},f),!k.alreadyEnhanced)for(n in o)m[n]===b&&(m[n]=g(l,n.replace(h,e)));l.className=c(a.extend({},o,m),k.unknownClasses).join(" "),"button"!==l.tagName.toLowerCase()&&l.setAttribute("role","button")}return this},a.fn.buttonMarkup.defaults={icon:"",iconpos:"left",theme:null,inline:!1,shadow:!0,corners:!0,iconshadow:!1,mini:!1},a.extend(a.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button:not(:jqmData(role='navbar') button)"})}(a),function(a,b){a.widget("mobile.controlgroup",a.extend({options:{enhanced:!1,theme:null,shadow:!1,corners:!0,excludeInvisible:!0,type:"vertical",mini:!1},_create:function(){var b=this.element,c=this.options,d=a.mobile.page.prototype.keepNativeSelector();a.fn.buttonMarkup&&this.element.find(a.fn.buttonMarkup.initSelector).not(d).buttonMarkup(),a.each(this._childWidgets,a.proxy(function(b,c){a.mobile[c]&&this.element.find(a.mobile[c].initSelector).not(d)[c]()},this)),a.extend(this,{_ui:null,_initialRefresh:!0}),this._ui=c.enhanced?{groupLegend:b.children(".ui-controlgroup-label").children(),childWrapper:b.children(".ui-controlgroup-controls")}:this._enhance()},_childWidgets:["checkboxradio","selectmenu","button"],_themeClassFromOption:function(a){return a?"none"===a?"":"ui-group-theme-"+a:""},_enhance:function(){var b=this.element,c=this.options,d={groupLegend:b.children("legend"),childWrapper:b.addClass("ui-controlgroup ui-controlgroup-"+("horizontal"===c.type?"horizontal":"vertical")+" "+this._themeClassFromOption(c.theme)+" "+(c.corners?"ui-corner-all ":"")+(c.mini?"ui-mini ":"")).wrapInner("<div class='ui-controlgroup-controls "+(c.shadow===!0?"ui-shadow":"")+"'></div>").children()};return d.groupLegend.length>0&&a("<div role='heading' class='ui-controlgroup-label'></div>").append(d.groupLegend).prependTo(b),d},_init:function(){this.refresh()},_setOptions:function(a){var c,d,e=this.element;return a.type!==b&&(e.removeClass("ui-controlgroup-horizontal ui-controlgroup-vertical").addClass("ui-controlgroup-"+("horizontal"===a.type?"horizontal":"vertical")),c=!0),a.theme!==b&&e.removeClass(this._themeClassFromOption(this.options.theme)).addClass(this._themeClassFromOption(a.theme)),a.corners!==b&&e.toggleClass("ui-corner-all",a.corners),a.mini!==b&&e.toggleClass("ui-mini",a.mini),a.shadow!==b&&this._ui.childWrapper.toggleClass("ui-shadow",a.shadow),a.excludeInvisible!==b&&(this.options.excludeInvisible=a.excludeInvisible,c=!0),d=this._super(a),c&&this.refresh(),d},container:function(){return this._ui.childWrapper},refresh:function(){var b=this.container(),c=b.find(".ui-btn").not(".ui-slider-handle"),d=this._initialRefresh;a.mobile.checkboxradio&&b.find(":mobile-checkboxradio").checkboxradio("refresh"),this._addFirstLastClasses(c,this.options.excludeInvisible?this._getVisibles(c,d):c,d),this._initialRefresh=!1},_destroy:function(){var a,b,c=this.options;return c.enhanced?this:(a=this._ui,b=this.element.removeClass("ui-controlgroup ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini "+this._themeClassFromOption(c.theme)).find(".ui-btn").not(".ui-slider-handle"),this._removeFirstLastClasses(b),a.groupLegend.unwrap(),void a.childWrapper.children().unwrap())}},a.mobile.behaviors.addFirstLastClasses))}(a),function(a,b){a.widget("mobile.toolbar",{initSelector:":jqmData(role='footer'), :jqmData(role='header')",options:{theme:null,addBackBtn:!1,backBtnTheme:null,backBtnText:"Back"},_create:function(){var b,c,d=this.element.is(":jqmData(role='header')")?"header":"footer",e=this.element.closest(".ui-page");0===e.length&&(e=!1,this._on(this.document,{pageshow:"refresh"})),a.extend(this,{role:d,page:e,leftbtn:b,rightbtn:c}),this.element.attr("role","header"===d?"banner":"contentinfo").addClass("ui-"+d),this.refresh(),this._setOptions(this.options)},_setOptions:function(a){if(a.addBackBtn!==b&&this._updateBackButton(),null!=a.backBtnTheme&&this.element.find(".ui-toolbar-back-btn").addClass("ui-btn ui-btn-"+a.backBtnTheme),a.backBtnText!==b&&this.element.find(".ui-toolbar-back-btn .ui-btn-text").text(a.backBtnText),a.theme!==b){var c=this.options.theme?this.options.theme:"inherit",d=a.theme?a.theme:"inherit";this.element.removeClass("ui-bar-"+c).addClass("ui-bar-"+d)}this._super(a)},refresh:function(){"header"===this.role&&this._addHeaderButtonClasses(),this.page||(this._setRelative(),"footer"===this.role?this.element.appendTo("body"):"header"===this.role&&this._updateBackButton()),this._addHeadingClasses(),this._btnMarkup()},_setRelative:function(){a("[data-"+a.mobile.ns+"role='page']").css({position:"relative"})},_btnMarkup:function(){this.element.children("a").filter(":not([data-"+a.mobile.ns+"role='none'])").attr("data-"+a.mobile.ns+"role","button"),this.element.trigger("create")},_addHeaderButtonClasses:function(){var a=this.element.children("a, button");this.leftbtn=a.hasClass("ui-btn-left")&&!a.hasClass("ui-toolbar-back-btn"),this.rightbtn=a.hasClass("ui-btn-right"),this.leftbtn=this.leftbtn||a.eq(0).not(".ui-btn-right,.ui-toolbar-back-btn").addClass("ui-btn-left").length,this.rightbtn=this.rightbtn||a.eq(1).addClass("ui-btn-right").length},_updateBackButton:function(){var b,c=this.options,d=c.backBtnTheme||c.theme;b=this._backButton=this._backButton||{},this.options.addBackBtn&&"header"===this.role&&a(".ui-page").length>1&&(this.page?this.page[0].getAttribute("data-"+a.mobile.ns+"url")!==a.mobile.path.stripHash(location.hash):a.mobile.navigate&&a.mobile.navigate.history&&a.mobile.navigate.history.activeIndex>0)&&!this.leftbtn?b.attached||(this.backButton=b.element=(b.element||a("<a role='button' href='javascript:void(0);' class='ui-btn ui-corner-all ui-shadow ui-btn-left "+(d?"ui-btn-"+d+" ":"")+"ui-toolbar-back-btn ui-icon-carat-l ui-btn-icon-left' data-"+a.mobile.ns+"rel='back'>"+c.backBtnText+"</a>")).prependTo(this.element),b.attached=!0):b.element&&(b.element.detach(),b.attached=!1)},_addHeadingClasses:function(){this.element.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({role:"heading","aria-level":"1"})},_destroy:function(){var a;this.element.children("h1, h2, h3, h4, h5, h6").removeClass("ui-title").removeAttr("role").removeAttr("aria-level"),"header"===this.role&&(this.element.children("a, button").removeClass("ui-btn-left ui-btn-right ui-btn ui-shadow ui-corner-all"),this.backButton&&this.backButton.remove()),a=this.options.theme?this.options.theme:"inherit",this.element.removeClass("ui-bar-"+a),this.element.removeClass("ui-"+this.role).removeAttr("role")}})}(a),function(a,b){a.widget("mobile.toolbar",a.mobile.toolbar,{options:{position:null,visibleOnPageShow:!0,disablePageZoom:!0,transition:"slide",fullscreen:!1,tapToggle:!0,tapToggleBlacklist:"a, button, input, select, textarea, .ui-header-fixed, .ui-footer-fixed, .ui-flipswitch, .ui-popup, .ui-panel, .ui-panel-dismiss-open",hideDuringFocus:"input, textarea, select",updatePagePadding:!0,trackPersistentToolbars:!0,supportBlacklist:function(){return!a.support.fixedPosition}},_create:function(){this._super(),this.pagecontainer=a(":mobile-pagecontainer"),"fixed"!==this.options.position||this.options.supportBlacklist()||this._makeFixed()},_makeFixed:function(){this.element.addClass("ui-"+this.role+"-fixed"),this.updatePagePadding(),this._addTransitionClass(),this._bindPageEvents(),this._bindToggleHandlers()},_setOptions:function(c){if("fixed"===c.position&&"fixed"!==this.options.position&&this._makeFixed(),"fixed"===this.options.position&&!this.options.supportBlacklist()){var d=this.page?this.page:a(".ui-page-active").length>0?a(".ui-page-active"):a(".ui-page").eq(0);c.fullscreen!==b&&(c.fullscreen?(this.element.addClass("ui-"+this.role+"-fullscreen"),d.addClass("ui-page-"+this.role+"-fullscreen")):(this.element.removeClass("ui-"+this.role+"-fullscreen"),d.removeClass("ui-page-"+this.role+"-fullscreen").addClass("ui-page-"+this.role+"-fixed")))}this._super(c)},_addTransitionClass:function(){var a=this.options.transition;a&&"none"!==a&&("slide"===a&&(a=this.element.hasClass("ui-header")?"slidedown":"slideup"),this.element.addClass(a))},_bindPageEvents:function(){var a=this.page?this.element.closest(".ui-page"):this.document;this._on(a,{pagebeforeshow:"_handlePageBeforeShow",webkitAnimationStart:"_handleAnimationStart",animationstart:"_handleAnimationStart",updatelayout:"_handleAnimationStart",pageshow:"_handlePageShow",pagebeforehide:"_handlePageBeforeHide"})},_handlePageBeforeShow:function(){var b=this.options;b.disablePageZoom&&a.mobile.zoom.disable(!0),b.visibleOnPageShow||this.hide(!0)},_handleAnimationStart:function(){this.options.updatePagePadding&&this.updatePagePadding(this.page?this.page:".ui-page-active")},_handlePageShow:function(){this.updatePagePadding(this.page?this.page:".ui-page-active"),this.options.updatePagePadding&&this._on(this.window,{throttledresize:"updatePagePadding"})},_handlePageBeforeHide:function(b,c){var d,e,f,g,h=this.options;h.disablePageZoom&&a.mobile.zoom.enable(!0),h.updatePagePadding&&this._off(this.window,"throttledresize"),h.trackPersistentToolbars&&(d=a(".ui-footer-fixed:jqmData(id)",this.page),e=a(".ui-header-fixed:jqmData(id)",this.page),f=d.length&&c.nextPage&&a(".ui-footer-fixed:jqmData(id='"+d.jqmData("id")+"')",c.nextPage)||a(),g=e.length&&c.nextPage&&a(".ui-header-fixed:jqmData(id='"+e.jqmData("id")+"')",c.nextPage)||a(),(f.length||g.length)&&(f.add(g).appendTo(a.mobile.pageContainer),c.nextPage.one("pageshow",function(){g.prependTo(this),f.appendTo(this)})))},_visible:!0,updatePagePadding:function(c){var d=this.element,e="header"===this.role,f=parseFloat(d.css(e?"top":"bottom"));this.options.fullscreen||(c=c&&c.type===b&&c||this.page||d.closest(".ui-page"),c=this.page?this.page:".ui-page-active",a(c).css("padding-"+(e?"top":"bottom"),d.outerHeight()+f))},_useTransition:function(b){var c=this.window,d=this.element,e=c.scrollTop(),f=d.height(),g=this.page?d.closest(".ui-page").height():a(".ui-page-active").height(),h=a.mobile.getScreenHeight();return!b&&(this.options.transition&&"none"!==this.options.transition&&("header"===this.role&&!this.options.fullscreen&&e>f||"footer"===this.role&&!this.options.fullscreen&&g-f>e+h)||this.options.fullscreen)},show:function(a){var b="ui-fixed-hidden",c=this.element;this._useTransition(a)?c.removeClass("out "+b).addClass("in").animationComplete(function(){c.removeClass("in")}):c.removeClass(b),this._visible=!0},hide:function(a){var b="ui-fixed-hidden",c=this.element,d="out"+("slide"===this.options.transition?" reverse":"");this._useTransition(a)?c.addClass(d).removeClass("in").animationComplete(function(){c.addClass(b).removeClass(d)}):c.addClass(b).removeClass(d),this._visible=!1},toggle:function(){this[this._visible?"hide":"show"]()},_bindToggleHandlers:function(){var b,c,d=this,e=d.options,f=!0,g=this.page?this.page:a(".ui-page");g.bind("vclick",function(b){e.tapToggle&&!a(b.target).closest(e.tapToggleBlacklist).length&&d.toggle()}).bind("focusin focusout",function(g){screen.width<1025&&a(g.target).is(e.hideDuringFocus)&&!a(g.target).closest(".ui-header-fixed, .ui-footer-fixed").length&&("focusout"!==g.type||f?"focusin"===g.type&&f&&(clearTimeout(b),f=!1,c=setTimeout(function(){d.hide()},0)):(f=!0,clearTimeout(c),b=setTimeout(function(){d.show()},0)))})},_setRelative:function(){"fixed"!==this.options.position&&a("[data-"+a.mobile.ns+"role='page']").css({position:"relative"})},_destroy:function(){var b,c,d,e,f,g=this.pagecontainer.pagecontainer("getActivePage");this._super(),"fixed"===this.options.position&&(d=a("body>.ui-"+this.role+"-fixed").add(g.find(".ui-"+this.options.role+"-fixed")).not(this.element).length>0,f=a("body>.ui-"+this.role+"-fixed").add(g.find(".ui-"+this.options.role+"-fullscreen")).not(this.element).length>0,c="ui-header-fixed ui-footer-fixed ui-header-fullscreen in out ui-footer-fullscreen fade slidedown slideup ui-fixed-hidden",this.element.removeClass(c),f||(b="ui-page-"+this.role+"-fullscreen"),d||(e="header"===this.role,b+=" ui-page-"+this.role+"-fixed",g.css("padding-"+(e?"top":"bottom"),"")),g.removeClass(b))
}})}(a),function(a){a.widget("mobile.toolbar",a.mobile.toolbar,{_makeFixed:function(){this._super(),this._workarounds()},_workarounds:function(){var a=navigator.userAgent,b=navigator.platform,c=a.match(/AppleWebKit\/([0-9]+)/),d=!!c&&c[1],e=null,f=this;if(b.indexOf("iPhone")>-1||b.indexOf("iPad")>-1||b.indexOf("iPod")>-1)e="ios";else{if(!(a.indexOf("Android")>-1))return;e="android"}if("ios"===e)f._bindScrollWorkaround();else{if(!("android"===e&&d&&534>d))return;f._bindScrollWorkaround(),f._bindListThumbWorkaround()}},_viewportOffset:function(){var a=this.element,b=a.hasClass("ui-header"),c=Math.abs(a.offset().top-this.window.scrollTop());return b||(c=Math.round(c-this.window.height()+a.outerHeight())-60),c},_bindScrollWorkaround:function(){var a=this;this._on(this.window,{scrollstop:function(){var b=a._viewportOffset();b>2&&a._visible&&a._triggerRedraw()}})},_bindListThumbWorkaround:function(){this.element.closest(".ui-page").addClass("ui-android-2x-fixed")},_triggerRedraw:function(){var b=parseFloat(a(".ui-page-active").css("padding-bottom"));a(".ui-page-active").css("padding-bottom",b+1+"px"),setTimeout(function(){a(".ui-page-active").css("padding-bottom",b+"px")},0)},destroy:function(){this._super(),this.element.closest(".ui-page-active").removeClass("ui-android-2x-fix")}})}(a),function(a,b){function c(){var a=e.clone(),b=a.eq(0),c=a.eq(1),d=c.children();return{arEls:c.add(b),gd:b,ct:c,ar:d}}var d=a.mobile.browser.oldIE&&a.mobile.browser.oldIE<=8,e=a("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container"+(d?" ie":"")+"'><div class='ui-popup-arrow'></div></div>");a.widget("mobile.popup",a.mobile.popup,{options:{arrow:""},_create:function(){var a,b=this._super();return this.options.arrow&&(this._ui.arrow=a=this._addArrow()),b},_addArrow:function(){var a,b=this.options,d=c();return a=this._themeClassFromOption("ui-body-",b.theme),d.ar.addClass(a+(b.shadow?" ui-overlay-shadow":"")),d.arEls.hide().appendTo(this.element),d},_unenhance:function(){var a=this._ui.arrow;return a&&a.arEls.remove(),this._super()},_tryAnArrow:function(a,b,c,d,e){var f,g,h,i={},j={};return d.arFull[a.dimKey]>d.guideDims[a.dimKey]?e:(i[a.fst]=c[a.fst]+(d.arHalf[a.oDimKey]+d.menuHalf[a.oDimKey])*a.offsetFactor-d.contentBox[a.fst]+(d.clampInfo.menuSize[a.oDimKey]-d.contentBox[a.oDimKey])*a.arrowOffsetFactor,i[a.snd]=c[a.snd],f=d.result||this._calculateFinalLocation(i,d.clampInfo),g={x:f.left,y:f.top},j[a.fst]=g[a.fst]+d.contentBox[a.fst]+a.tipOffset,j[a.snd]=Math.max(f[a.prop]+d.guideOffset[a.prop]+d.arHalf[a.dimKey],Math.min(f[a.prop]+d.guideOffset[a.prop]+d.guideDims[a.dimKey]-d.arHalf[a.dimKey],c[a.snd])),h=Math.abs(c.x-j.x)+Math.abs(c.y-j.y),(!e||h<e.diff)&&(j[a.snd]-=d.arHalf[a.dimKey]+f[a.prop]+d.contentBox[a.snd],e={dir:b,diff:h,result:f,posProp:a.prop,posVal:j[a.snd]}),e)},_getPlacementState:function(a){var b,c,d=this._ui.arrow,e={clampInfo:this._clampPopupWidth(!a),arFull:{cx:d.ct.width(),cy:d.ct.height()},guideDims:{cx:d.gd.width(),cy:d.gd.height()},guideOffset:d.gd.offset()};return b=this.element.offset(),d.gd.css({left:0,top:0,right:0,bottom:0}),c=d.gd.offset(),e.contentBox={x:c.left-b.left,y:c.top-b.top,cx:d.gd.width(),cy:d.gd.height()},d.gd.removeAttr("style"),e.guideOffset={left:e.guideOffset.left-b.left,top:e.guideOffset.top-b.top},e.arHalf={cx:e.arFull.cx/2,cy:e.arFull.cy/2},e.menuHalf={cx:e.clampInfo.menuSize.cx/2,cy:e.clampInfo.menuSize.cy/2},e},_placementCoords:function(b){var c,e,f,g,h,i=this.options.arrow,j=this._ui.arrow;return j?(j.arEls.show(),h={},c=this._getPlacementState(!0),f={l:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:1,tipOffset:-c.arHalf.cx,arrowOffsetFactor:0},r:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:-1,tipOffset:c.arHalf.cx+c.contentBox.cx,arrowOffsetFactor:1},b:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:-1,tipOffset:c.arHalf.cy+c.contentBox.cy,arrowOffsetFactor:1},t:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:1,tipOffset:-c.arHalf.cy,arrowOffsetFactor:0}},a.each((i===!0?"l,t,r,b":i).split(","),a.proxy(function(a,d){e=this._tryAnArrow(f[d],d,b,c,e)},this)),e?(j.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-"+e.dir).removeAttr("style").css(e.posProp,e.posVal).show(),d||(g=this.element.offset(),h[f[e.dir].fst]=j.ct.offset(),h[f[e.dir].snd]={left:g.left+c.contentBox.x,top:g.top+c.contentBox.y}),e.result):(j.arEls.hide(),this._super(b))):this._super(b)},_setOptions:function(a){var c,d=this.options.theme,e=this._ui.arrow,f=this._super(a);if(a.arrow!==b){if(!e&&a.arrow)return void(this._ui.arrow=this._addArrow());e&&!a.arrow&&(e.arEls.remove(),this._ui.arrow=null)}return e=this._ui.arrow,e&&(a.theme!==b&&(d=this._themeClassFromOption("ui-body-",d),c=this._themeClassFromOption("ui-body-",a.theme),e.ar.removeClass(d).addClass(c)),a.shadow!==b&&e.ar.toggleClass("ui-overlay-shadow",a.shadow)),f},_destroy:function(){var a=this._ui.arrow;return a&&a.arEls.remove(),this._super()}})}(a),function(a,c){a.widget("mobile.panel",{options:{classes:{panel:"ui-panel",panelOpen:"ui-panel-open",panelClosed:"ui-panel-closed",panelFixed:"ui-panel-fixed",panelInner:"ui-panel-inner",modal:"ui-panel-dismiss",modalOpen:"ui-panel-dismiss-open",pageContainer:"ui-panel-page-container",pageWrapper:"ui-panel-wrapper",pageFixedToolbar:"ui-panel-fixed-toolbar",pageContentPrefix:"ui-panel-page-content",animate:"ui-panel-animate"},animate:!0,theme:null,position:"left",dismissible:!0,display:"reveal",swipeClose:!0,positionFixed:!1},_closeLink:null,_parentPage:null,_page:null,_modal:null,_panelInner:null,_wrapper:null,_fixedToolbars:null,_create:function(){var b=this.element,c=b.closest(".ui-page, :jqmData(role='page')");a.extend(this,{_closeLink:b.find(":jqmData(rel='close')"),_parentPage:c.length>0?c:!1,_openedPage:null,_page:this._getPage,_panelInner:this._getPanelInner(),_fixedToolbars:this._getFixedToolbars}),"overlay"!==this.options.display&&this._getWrapper(),this._addPanelClasses(),a.support.cssTransform3d&&this.options.animate&&this.element.addClass(this.options.classes.animate),this._bindUpdateLayout(),this._bindCloseEvents(),this._bindLinkListeners(),this._bindPageEvents(),this.options.dismissible&&this._createModal(),this._bindSwipeEvents()},_getPanelInner:function(){var a=this.element.find("."+this.options.classes.panelInner);return 0===a.length&&(a=this.element.children().wrapAll("<div class='"+this.options.classes.panelInner+"' />").parent()),a},_createModal:function(){var b=this,c=b._parentPage?b._parentPage.parent():b.element.parent();b._modal=a("<div class='"+b.options.classes.modal+"'></div>").on("mousedown",function(){b.close()}).appendTo(c)},_getPage:function(){var b=this._openedPage||this._parentPage||a("."+a.mobile.activePageClass);return b},_getWrapper:function(){var a=this._page().find("."+this.options.classes.pageWrapper);0===a.length&&(a=this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='"+this.options.classes.pageWrapper+"'></div>").parent()),this._wrapper=a},_getFixedToolbars:function(){var b=a("body").children(".ui-header-fixed, .ui-footer-fixed"),c=this._page().find(".ui-header-fixed, .ui-footer-fixed"),d=b.add(c).addClass(this.options.classes.pageFixedToolbar);return d},_getPosDisplayClasses:function(a){return a+"-position-"+this.options.position+" "+a+"-display-"+this.options.display},_getPanelClasses:function(){var a=this.options.classes.panel+" "+this._getPosDisplayClasses(this.options.classes.panel)+" "+this.options.classes.panelClosed+" ui-body-"+(this.options.theme?this.options.theme:"inherit");return this.options.positionFixed&&(a+=" "+this.options.classes.panelFixed),a},_addPanelClasses:function(){this.element.addClass(this._getPanelClasses())},_handleCloseClick:function(a){a.isDefaultPrevented()||this.close()},_bindCloseEvents:function(){this._on(this._closeLink,{click:"_handleCloseClick"}),this._on({"click a:jqmData(ajax='false')":"_handleCloseClick"})},_positionPanel:function(b){var c=this,d=c._panelInner.outerHeight(),e=d>a.mobile.getScreenHeight();e||!c.options.positionFixed?(e&&(c._unfixPanel(),a.mobile.resetActivePageHeight(d)),b&&this.window[0].scrollTo(0,a.mobile.defaultHomeScroll)):c._fixPanel()},_bindFixListener:function(){this._on(a(b),{throttledresize:"_positionPanel"})},_unbindFixListener:function(){this._off(a(b),"throttledresize")},_unfixPanel:function(){this.options.positionFixed&&a.support.fixedPosition&&this.element.removeClass(this.options.classes.panelFixed)},_fixPanel:function(){this.options.positionFixed&&a.support.fixedPosition&&this.element.addClass(this.options.classes.panelFixed)},_bindUpdateLayout:function(){var a=this;a.element.on("updatelayout",function(){a._open&&a._positionPanel()})},_bindLinkListeners:function(){this._on("body",{"click a":"_handleClick"})},_handleClick:function(b){var d,e=this.element.attr("id");b.currentTarget.href.split("#")[1]===e&&e!==c&&(b.preventDefault(),d=a(b.target),d.hasClass("ui-btn")&&(d.addClass(a.mobile.activeBtnClass),this.element.one("panelopen panelclose",function(){d.removeClass(a.mobile.activeBtnClass)})),this.toggle())},_bindSwipeEvents:function(){var a=this,b=a._modal?a.element.add(a._modal):a.element;a.options.swipeClose&&("left"===a.options.position?b.on("swipeleft.panel",function(){a.close()}):b.on("swiperight.panel",function(){a.close()}))},_bindPageEvents:function(){var a=this;this.document.on("panelbeforeopen",function(b){a._open&&b.target!==a.element[0]&&a.close()}).on("keyup.panel",function(b){27===b.keyCode&&a._open&&a.close()}),this._parentPage||"overlay"===this.options.display||this._on(this.document,{pageshow:function(){this._openedPage=null,this._getWrapper()}}),a._parentPage?this.document.on("pagehide",":jqmData(role='page')",function(){a._open&&a.close(!0)}):this.document.on("pagebeforehide",function(){a._open&&a.close(!0)})},_open:!1,_pageContentOpenClasses:null,_modalOpenClasses:null,open:function(b){if(!this._open){var c=this,d=c.options,e=function(){c._off(c.document,"panelclose"),c._page().jqmData("panel","open"),a.support.cssTransform3d&&d.animate&&"overlay"!==d.display&&(c._wrapper.addClass(d.classes.animate),c._fixedToolbars().addClass(d.classes.animate)),!b&&a.support.cssTransform3d&&d.animate?(c._wrapper||c.element).animationComplete(f,"transition"):setTimeout(f,0),d.theme&&"overlay"!==d.display&&c._page().parent().addClass(d.classes.pageContainer+"-themed "+d.classes.pageContainer+"-"+d.theme),c.element.removeClass(d.classes.panelClosed).addClass(d.classes.panelOpen),c._positionPanel(!0),c._pageContentOpenClasses=c._getPosDisplayClasses(d.classes.pageContentPrefix),"overlay"!==d.display&&(c._page().parent().addClass(d.classes.pageContainer),c._wrapper.addClass(c._pageContentOpenClasses),c._fixedToolbars().addClass(c._pageContentOpenClasses)),c._modalOpenClasses=c._getPosDisplayClasses(d.classes.modal)+" "+d.classes.modalOpen,c._modal&&c._modal.addClass(c._modalOpenClasses).height(Math.max(c._modal.height(),c.document.height()))},f=function(){c._open&&("overlay"!==d.display&&(c._wrapper.addClass(d.classes.pageContentPrefix+"-open"),c._fixedToolbars().addClass(d.classes.pageContentPrefix+"-open")),c._bindFixListener(),c._trigger("open"),c._openedPage=c._page())};c._trigger("beforeopen"),"open"===c._page().jqmData("panel")?c._on(c.document,{panelclose:e}):e(),c._open=!0}},close:function(b){if(this._open){var c=this,d=this.options,e=function(){c.element.removeClass(d.classes.panelOpen),"overlay"!==d.display&&(c._wrapper.removeClass(c._pageContentOpenClasses),c._fixedToolbars().removeClass(c._pageContentOpenClasses)),!b&&a.support.cssTransform3d&&d.animate?(c._wrapper||c.element).animationComplete(f,"transition"):setTimeout(f,0),c._modal&&c._modal.removeClass(c._modalOpenClasses).height("")},f=function(){d.theme&&"overlay"!==d.display&&c._page().parent().removeClass(d.classes.pageContainer+"-themed "+d.classes.pageContainer+"-"+d.theme),c.element.addClass(d.classes.panelClosed),"overlay"!==d.display&&(c._page().parent().removeClass(d.classes.pageContainer),c._wrapper.removeClass(d.classes.pageContentPrefix+"-open"),c._fixedToolbars().removeClass(d.classes.pageContentPrefix+"-open")),a.support.cssTransform3d&&d.animate&&"overlay"!==d.display&&(c._wrapper.removeClass(d.classes.animate),c._fixedToolbars().removeClass(d.classes.animate)),c._fixPanel(),c._unbindFixListener(),a.mobile.resetActivePageHeight(),c._page().jqmRemoveData("panel"),c._trigger("close"),c._openedPage=null};c._trigger("beforeclose"),e(),c._open=!1}},toggle:function(){this[this._open?"close":"open"]()},_destroy:function(){var b,c=this.options,d=a("body > :mobile-panel").length+a.mobile.activePage.find(":mobile-panel").length>1;"overlay"!==c.display&&(b=a("body > :mobile-panel").add(a.mobile.activePage.find(":mobile-panel")),0===b.not(".ui-panel-display-overlay").not(this.element).length&&this._wrapper.children().unwrap(),this._open&&(this._fixedToolbars().removeClass(c.classes.pageContentPrefix+"-open"),a.support.cssTransform3d&&c.animate&&this._fixedToolbars().removeClass(c.classes.animate),this._page().parent().removeClass(c.classes.pageContainer),c.theme&&this._page().parent().removeClass(c.classes.pageContainer+"-themed "+c.classes.pageContainer+"-"+c.theme))),d||this.document.off("panelopen panelclose"),this._open&&this._page().jqmRemoveData("panel"),this._panelInner.children().unwrap(),this.element.removeClass([this._getPanelClasses(),c.classes.panelOpen,c.classes.animate].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout"),this._modal&&this._modal.remove()}})}(a),function(a,b){a.widget("mobile.table",{options:{classes:{table:"ui-table"},enhanced:!1},_create:function(){this.options.enhanced||this.element.addClass(this.options.classes.table),a.extend(this,{headers:b,allHeaders:b}),this._refresh(!0)},_setHeaders:function(){var a=this.element.find("thead tr");this.headers=this.element.find("tr:eq(0)").children(),this.allHeaders=this.headers.add(a.children())},refresh:function(){this._refresh()},rebuild:a.noop,_refresh:function(){var b=this.element,c=b.find("thead tr");this._setHeaders(),c.each(function(){var d=0;a(this).children().each(function(){var e,f=parseInt(this.getAttribute("colspan"),10),g=":nth-child("+(d+1)+")";if(this.setAttribute("data-"+a.mobile.ns+"colstart",d+1),f)for(e=0;f-1>e;e++)d++,g+=", :nth-child("+(d+1)+")";a(this).jqmData("cells",b.find("tr").not(c.eq(0)).not(this).children(g)),d++})})}})}(a),function(a){a.widget("mobile.table",a.mobile.table,{options:{mode:"columntoggle",columnBtnTheme:null,columnPopupTheme:null,columnBtnText:"Columns...",classes:a.extend(a.mobile.table.prototype.options.classes,{popup:"ui-table-columntoggle-popup",columnBtn:"ui-table-columntoggle-btn",priorityPrefix:"ui-table-priority-",columnToggleTable:"ui-table-columntoggle"})},_create:function(){this._super(),"columntoggle"===this.options.mode&&(a.extend(this,{_menu:null}),this.options.enhanced?(this._menu=a(this.document[0].getElementById(this._id()+"-popup")).children().first(),this._addToggles(this._menu,!0)):(this._menu=this._enhanceColToggle(),this.element.addClass(this.options.classes.columnToggleTable)),this._setupEvents(),this._setToggleState())},_id:function(){return this.element.attr("id")||this.widgetName+this.uuid},_setupEvents:function(){this._on(this.window,{throttledresize:"_setToggleState"}),this._on(this._menu,{"change input":"_menuInputChange"})},_addToggles:function(b,c){var d,e=0,f=this.options,g=b.controlgroup("container");c?d=b.find("input"):g.empty(),this.headers.not("td").each(function(){var b,h,i=a(this),j=a.mobile.getAttribute(this,"priority");j&&(h=i.add(i.jqmData("cells")),h.addClass(f.classes.priorityPrefix+j),b=(c?d.eq(e++):a("<label><input type='checkbox' checked />"+(i.children("abbr").first().attr("title")||i.text())+"</label>").appendTo(g).children(0).checkboxradio({theme:f.columnPopupTheme})).jqmData("header",i).jqmData("cells",h),i.jqmData("input",b))}),c||b.controlgroup("refresh")},_menuInputChange:function(b){var c=a(b.target),d=c[0].checked;c.jqmData("cells").toggleClass("ui-table-cell-hidden",!d).toggleClass("ui-table-cell-visible",d)},_unlockCells:function(a){a.removeClass("ui-table-cell-hidden ui-table-cell-visible")},_enhanceColToggle:function(){var b,c,d,e,f=this.element,g=this.options,h=a.mobile.ns,i=this.document[0].createDocumentFragment();return b=this._id()+"-popup",c=a("<a href='#"+b+"' class='"+g.classes.columnBtn+" ui-btn ui-btn-"+(g.columnBtnTheme||"a")+" ui-corner-all ui-shadow ui-mini' data-"+h+"rel='popup'>"+g.columnBtnText+"</a>"),d=a("<div class='"+g.classes.popup+"' id='"+b+"'></div>"),e=a("<fieldset></fieldset>").controlgroup(),this._addToggles(e,!1),e.appendTo(d),i.appendChild(d[0]),i.appendChild(c[0]),f.before(i),d.popup(),e},rebuild:function(){this._super(),"columntoggle"===this.options.mode&&this._refresh(!1)},_refresh:function(b){var c,d,e;if(this._super(b),!b&&"columntoggle"===this.options.mode)for(c=this.headers,d=[],this._menu.find("input").each(function(){var b=a(this),e=b.jqmData("header"),f=c.index(e[0]);f>-1&&!b.prop("checked")&&d.push(f)}),this._unlockCells(this.element.find(".ui-table-cell-hidden, .ui-table-cell-visible")),this._addToggles(this._menu,b),e=d.length-1;e>-1;e--)c.eq(d[e]).jqmData("input").prop("checked",!1).checkboxradio("refresh").trigger("change")},_setToggleState:function(){this._menu.find("input").each(function(){var b=a(this);this.checked="table-cell"===b.jqmData("cells").eq(0).css("display"),b.checkboxradio("refresh")})},_destroy:function(){this._super()}})}(a),function(a){a.widget("mobile.table",a.mobile.table,{options:{mode:"reflow",classes:a.extend(a.mobile.table.prototype.options.classes,{reflowTable:"ui-table-reflow",cellLabels:"ui-table-cell-label"})},_create:function(){this._super(),"reflow"===this.options.mode&&(this.options.enhanced||(this.element.addClass(this.options.classes.reflowTable),this._updateReflow()))},rebuild:function(){this._super(),"reflow"===this.options.mode&&this._refresh(!1)},_refresh:function(a){this._super(a),a||"reflow"!==this.options.mode||this._updateReflow()},_updateReflow:function(){var b=this,c=this.options;a(b.allHeaders.get().reverse()).each(function(){var d,e,f=a(this).jqmData("cells"),g=a.mobile.getAttribute(this,"colstart"),h=f.not(this).filter("thead th").length&&" ui-table-cell-label-top",i=a(this).clone().contents();i.length>0&&(h?(d=parseInt(this.getAttribute("colspan"),10),e="",d&&(e="td:nth-child("+d+"n + "+g+")"),b._addLabels(f.filter(e),c.classes.cellLabels+h,i)):b._addLabels(f,c.classes.cellLabels,i))})},_addLabels:function(b,c,d){1===d.length&&"abbr"===d[0].nodeName.toLowerCase()&&(d=d.eq(0).attr("title")),b.not(":has(b."+c+")").prepend(a("<b class='"+c+"'></b>").append(d))}})}(a),function(a,c){var d=function(b,c){return-1===(""+(a.mobile.getAttribute(this,"filtertext")||a(this).text())).toLowerCase().indexOf(c)};a.widget("mobile.filterable",{initSelector:":jqmData(filter='true')",options:{filterReveal:!1,filterCallback:d,enhanced:!1,input:null,children:"> li, > option, > optgroup option, > tbody tr, > .ui-controlgroup-controls > .ui-btn, > .ui-controlgroup-controls > .ui-checkbox, > .ui-controlgroup-controls > .ui-radio"},_create:function(){var b=this.options;a.extend(this,{_search:null,_timer:0}),this._setInput(b.input),b.enhanced||this._filterItems((this._search&&this._search.val()||"").toLowerCase())},_onKeyUp:function(){var c,d,e=this._search;if(e){if(c=e.val().toLowerCase(),d=a.mobile.getAttribute(e[0],"lastval")+"",d&&d===c)return;this._timer&&(b.clearTimeout(this._timer),this._timer=0),this._timer=this._delay(function(){return this._trigger("beforefilter",null,{input:e})===!1?!1:(e[0].setAttribute("data-"+a.mobile.ns+"lastval",c),this._filterItems(c),void(this._timer=0))},250)}},_getFilterableItems:function(){var b=this.element,c=this.options.children,d=c?a.isFunction(c)?c():c.nodeName?a(c):c.jquery?c:this.element.find(c):{length:0};return 0===d.length&&(d=b.children()),d},_filterItems:function(b){var c,e,f,g,h=[],i=[],j=this.options,k=this._getFilterableItems();if(null!=b)for(e=j.filterCallback||d,f=k.length,c=0;f>c;c++)g=e.call(k[c],c,b)?i:h,g.push(k[c]);0===i.length?k[j.filterReveal&&0===b.length?"addClass":"removeClass"]("ui-screen-hidden"):(a(i).addClass("ui-screen-hidden"),a(h).removeClass("ui-screen-hidden")),this._refreshChildWidget(),this._trigger("filter",null,{items:k})},_refreshChildWidget:function(){var b,c,d=["collapsibleset","selectmenu","controlgroup","listview"];for(c=d.length-1;c>-1;c--)b=d[c],a.mobile[b]&&(b=this.element.data("mobile-"+b),b&&a.isFunction(b.refresh)&&b.refresh())},_setInput:function(c){var d=this._search;this._timer&&(b.clearTimeout(this._timer),this._timer=0),d&&(this._off(d,"keyup change input"),d=null),c&&(d=c.jquery?c:c.nodeName?a(c):this.document.find(c),this._on(d,{keydown:"_onKeyDown",keypress:"_onKeyPress",keyup:"_onKeyUp",change:"_onKeyUp",input:"_onKeyUp"})),this._search=d},_onKeyDown:function(b){b.keyCode===a.ui.keyCode.ENTER&&(b.preventDefault(),this._preventKeyPress=!0)},_onKeyPress:function(a){this._preventKeyPress&&(a.preventDefault(),this._preventKeyPress=!1)},_setOptions:function(a){var b=!(a.filterReveal===c&&a.filterCallback===c&&a.children===c);this._super(a),a.input!==c&&(this._setInput(a.input),b=!0),b&&this.refresh()},_destroy:function(){var a=this.options,b=this._getFilterableItems();a.enhanced?b.toggleClass("ui-screen-hidden",a.filterReveal):b.removeClass("ui-screen-hidden")},refresh:function(){this._timer&&(b.clearTimeout(this._timer),this._timer=0),this._filterItems((this._search&&this._search.val()||"").toLowerCase())}})}(a),function(a,b){var c=function(a,b){return function(c){b.call(this,c),a._syncTextInputOptions(c)}},d=/(^|\s)ui-li-divider(\s|$)/,e=a.mobile.filterable.prototype.options.filterCallback;a.mobile.filterable.prototype.options.filterCallback=function(a,b){return!this.className.match(d)&&e.call(this,a,b)},a.widget("mobile.filterable",a.mobile.filterable,{options:{filterPlaceholder:"Filter items...",filterTheme:null},_create:function(){var b,c,d=this.element,e=["collapsibleset","selectmenu","controlgroup","listview"],f={};for(this._super(),a.extend(this,{_widget:null}),b=e.length-1;b>-1;b--)if(c=e[b],a.mobile[c]){if(this._setWidget(d.data("mobile-"+c)))break;f[c+"create"]="_handleCreate"}this._widget||this._on(d,f)},_handleCreate:function(a){this._setWidget(this.element.data("mobile-"+a.type.substring(0,a.type.length-6)))},_trigger:function(a,b,c){return this._widget&&"mobile-listview"===this._widget.widgetFullName&&"beforefilter"===a&&this._widget._trigger("beforefilter",b,c),this._super(a,b,c)},_setWidget:function(a){return!this._widget&&a&&(this._widget=a,this._widget._setOptions=c(this,this._widget._setOptions)),this._widget&&(this._syncTextInputOptions(this._widget.options),"listview"===this._widget.widgetName&&(this._widget.options.hideDividers=!0,this._widget.element.listview("refresh"))),!!this._widget},_isSearchInternal:function(){return this._search&&this._search.jqmData("ui-filterable-"+this.uuid+"-internal")},_setInput:function(b){var c=this.options,d=!0,e={};if(!b){if(this._isSearchInternal())return;d=!1,b=a("<input data-"+a.mobile.ns+"type='search' placeholder='"+c.filterPlaceholder+"'></input>").jqmData("ui-filterable-"+this.uuid+"-internal",!0),a("<form class='ui-filterable'></form>").append(b).submit(function(a){a.preventDefault(),b.blur()}).insertBefore(this.element),a.mobile.textinput&&(null!=this.options.filterTheme&&(e.theme=c.filterTheme),b.textinput(e))}this._super(b),this._isSearchInternal()&&d&&this._search.attr("placeholder",this.options.filterPlaceholder)},_setOptions:function(c){var d=this._super(c);return c.filterPlaceholder!==b&&this._isSearchInternal()&&this._search.attr("placeholder",c.filterPlaceholder),c.filterTheme!==b&&this._search&&a.mobile.textinput&&this._search.textinput("option","theme",c.filterTheme),d},_refreshChildWidget:function(){this._refreshingChildWidget=!0,this._superApply(arguments),this._refreshingChildWidget=!1},refresh:function(){this._refreshingChildWidget||this._superApply(arguments)},_destroy:function(){this._isSearchInternal()&&this._search.remove(),this._super()},_syncTextInputOptions:function(c){var d,e={};if(this._isSearchInternal()&&a.mobile.textinput){for(d in a.mobile.textinput.prototype.options)c[d]!==b&&(e[d]="theme"===d&&null!=this.options.filterTheme?this.options.filterTheme:c[d]);this._search.textinput("option",e)}}}),a.widget("mobile.listview",a.mobile.listview,{options:{filter:!1},_create:function(){return this.options.filter!==!0||this.element.data("mobile-filterable")||this.element.filterable(),this._super()},refresh:function(){var a;this._superApply(arguments),this.options.filter===!0&&(a=this.element.data("mobile-filterable"),a&&a.refresh())}})}(a),function(a,b){function c(){return++e}function d(a){return a.hash.length>1&&decodeURIComponent(a.href.replace(f,""))===decodeURIComponent(location.href.replace(f,""))}var e=0,f=/#.*$/;a.widget("ui.tabs",{version:"fadf2b312a05040436451c64bbfaf4814bc62c56",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var b=this,c=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",c.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(b){a(this).is(".ui-state-disabled")&&b.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){a(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),c.active=this._initialActive(),a.isArray(c.disabled)&&(c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".ui-state-disabled"),function(a){return b.tabs.index(a)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(c.active):a(),this._refresh(),this.active.length&&this.load(c.active)},_initialActive:function(){var b=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);return null===b&&(d&&this.tabs.each(function(c,e){return a(e).attr("aria-controls")===d?(b=c,!1):void 0}),null===b&&(b=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===b||-1===b)&&(b=this.tabs.length?0:!1)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),-1===b&&(b=c?!1:0)),!c&&b===!1&&this.anchors.length&&(b=0),b},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):a()}},_tabKeydown:function(b){var c=a(this.document[0].activeElement).closest("li"),d=this.tabs.index(c),e=!0;if(!this._handlePageNav(b)){switch(b.keyCode){case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:d++;break;case a.ui.keyCode.UP:case a.ui.keyCode.LEFT:e=!1,d--;break;case a.ui.keyCode.END:d=this.anchors.length-1;break;case a.ui.keyCode.HOME:d=0;break;case a.ui.keyCode.SPACE:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d);case a.ui.keyCode.ENTER:return b.preventDefault(),clearTimeout(this.activating),void this._activate(d===this.options.active?!1:d);default:return}b.preventDefault(),clearTimeout(this.activating),d=this._focusNextTab(d,e),b.ctrlKey||(c.attr("aria-selected","false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(b){this._handlePageNav(b)||b.ctrlKey&&b.keyCode===a.ui.keyCode.UP&&(b.preventDefault(),this.active.focus())},_handlePageNav:function(b){return b.altKey&&b.keyCode===a.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):b.altKey&&b.keyCode===a.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(b,c){function d(){return b>e&&(b=0),0>b&&(b=e),b}for(var e=this.tabs.length-1;-1!==a.inArray(d(),this.options.disabled);)b=c?b+1:b-1;return b},_focusNextTab:function(a,b){return a=this._findNextTab(a,b),this.tabs.eq(a).focus(),a},_setOption:function(a,b){return"active"===a?void this._activate(b):"disabled"===a?void this._setupDisabled(b):(this._super(a,b),"collapsible"===a&&(this.element.toggleClass("ui-tabs-collapsible",b),b||this.options.active!==!1||this._activate(0)),"event"===a&&this._setupEvents(b),void("heightStyle"===a&&this._setupHeightStyle(b)))},_tabId:function(a){return a.attr("aria-controls")||"ui-tabs-"+c()},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,c=this.tablist.children(":has(a[href])");b.disabled=a.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)}),this._processTabs(),b.active!==!1&&this.anchors.length?this.active.length&&!a.contains(this.tablist[0],this.active[0])?this.tabs.length===b.disabled.length?(b.active=!1,this.active=a()):this._activate(this._findNextTab(Math.max(0,b.active-1),!1)):b.active=this.tabs.index(this.active):(b.active=!1,this.active=a()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var b=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=a(),this.anchors.each(function(c,e){var f,g,h,i=a(e).uniqueId().attr("id"),j=a(e).closest("li"),k=j.attr("aria-controls");d(e)?(f=e.hash,g=b.element.find(b._sanitizeSelector(f))):(h=b._tabId(j),f="#"+h,g=b.element.find(f),g.length||(g=b._createPanel(h),g.insertAfter(b.panels[c-1]||b.tablist)),g.attr("aria-live","polite")),g.length&&(b.panels=b.panels.add(g)),k&&j.data("ui-tabs-aria-controls",k),j.attr({"aria-controls":f.substring(1),"aria-labelledby":i}),g.attr("aria-labelledby",i)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(b){return a("<div>").attr("id",b).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(b){a.isArray(b)&&(b.length?b.length===this.anchors.length&&(b=!0):b=!1);for(var c,d=0;c=this.tabs[d];d++)b===!0||-1!==a.inArray(d,b)?a(c).addClass("ui-state-disabled").attr("aria-disabled","true"):a(c).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=b},_setupEvents:function(b){var c={click:function(a){a.preventDefault()}};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,c),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(b){var c,d=this.element.parent();"fill"===b?(c=d.height(),c-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var b=a(this),d=b.css("position");"absolute"!==d&&"fixed"!==d&&(c-=b.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){c-=a(this).outerHeight(!0)
}),this.panels.each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")):"auto"===b&&(c=0,this.panels.each(function(){c=Math.max(c,a(this).height("").height())}).height(c))},_eventHandler:function(b){var c=this.options,d=this.active,e=a(b.currentTarget),f=e.closest("li"),g=f[0]===d[0],h=g&&c.collapsible,i=h?a():this._getPanelForTab(f),j=d.length?this._getPanelForTab(d):a(),k={oldTab:d,oldPanel:j,newTab:h?a():f,newPanel:i};b.preventDefault(),f.hasClass("ui-state-disabled")||f.hasClass("ui-tabs-loading")||this.running||g&&!c.collapsible||this._trigger("beforeActivate",b,k)===!1||(c.active=h?!1:this.tabs.index(f),this.active=g?a():f,this.xhr&&this.xhr.abort(),j.length||i.length||a.error("jQuery UI Tabs: Mismatching fragment identifier."),i.length&&this.load(this.tabs.index(f),b),this._toggle(b,k))},_toggle:function(b,c){function d(){f.running=!1,f._trigger("activate",b,c)}function e(){c.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),g.length&&f.options.show?f._show(g,f.options.show,d):(g.show(),d())}var f=this,g=c.newPanel,h=c.oldPanel;this.running=!0,h.length&&this.options.hide?this._hide(h,this.options.hide,function(){c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),e()}):(c.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),h.hide(),e()),h.attr({"aria-expanded":"false","aria-hidden":"true"}),c.oldTab.attr("aria-selected","false"),g.length&&h.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===a(this).attr("tabIndex")}).attr("tabIndex",-1),g.attr({"aria-expanded":"true","aria-hidden":"false"}),c.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(b){var c,d=this._findActive(b);d[0]!==this.active[0]&&(d.length||(d=this.active),c=d.find(".ui-tabs-anchor")[0],this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop}))},_findActive:function(b){return b===!1?a():this.tabs.eq(b)},_getIndex:function(a){return"string"==typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){a.data(this,"ui-tabs-destroy")?a(this).remove():a(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var b=a(this),c=b.data("ui-tabs-aria-controls");c?b.attr("aria-controls",c).removeData("ui-tabs-aria-controls"):b.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(c){var d=this.options.disabled;d!==!1&&(c===b?d=!1:(c=this._getIndex(c),d=a.isArray(d)?a.map(d,function(a){return a!==c?a:null}):a.map(this.tabs,function(a,b){return b!==c?b:null})),this._setupDisabled(d))},disable:function(c){var d=this.options.disabled;if(d!==!0){if(c===b)d=!0;else{if(c=this._getIndex(c),-1!==a.inArray(c,d))return;d=a.isArray(d)?a.merge([c],d).sort():[c]}this._setupDisabled(d)}},load:function(b,c){b=this._getIndex(b);var e=this,f=this.tabs.eq(b),g=f.find(".ui-tabs-anchor"),h=this._getPanelForTab(f),i={tab:f,panel:h};d(g[0])||(this.xhr=a.ajax(this._ajaxSettings(g,c,i)),this.xhr&&"canceled"!==this.xhr.statusText&&(f.addClass("ui-tabs-loading"),h.attr("aria-busy","true"),this.xhr.success(function(a){setTimeout(function(){h.html(a),e._trigger("load",c,i)},1)}).complete(function(a,b){setTimeout(function(){"abort"===b&&e.panels.stop(!1,!0),f.removeClass("ui-tabs-loading"),h.removeAttr("aria-busy"),a===e.xhr&&delete e.xhr},1)})))},_ajaxSettings:function(b,c,d){var e=this;return{url:b.attr("href"),beforeSend:function(b,f){return e._trigger("beforeLoad",c,a.extend({jqXHR:b,ajaxSettings:f},d))}}},_getPanelForTab:function(b){var c=a(b).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+c))}})}(a),function(){}(a),function(a,b){function c(a){e=a.originalEvent,i=e.accelerationIncludingGravity,f=Math.abs(i.x),g=Math.abs(i.y),h=Math.abs(i.z),!b.orientation&&(f>7||(h>6&&8>g||8>h&&g>6)&&f>5)?d.enabled&&d.disable():d.enabled||d.enable()}a.mobile.iosorientationfixEnabled=!0;var d,e,f,g,h,i,j=navigator.userAgent;return/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(j)&&j.indexOf("AppleWebKit")>-1?(d=a.mobile.zoom,void a.mobile.document.on("mobileinit",function(){a.mobile.iosorientationfixEnabled&&a.mobile.window.bind("orientationchange.iosorientationfix",d.enable).bind("devicemotion.iosorientationfix",c)})):void(a.mobile.iosorientationfixEnabled=!1)}(a,this),function(a,b,d){function e(){f.removeClass("ui-mobile-rendering")}var f=a("html"),g=a.mobile.window;a(b.document).trigger("mobileinit"),a.mobile.gradeA()&&(a.mobile.ajaxBlacklist&&(a.mobile.ajaxEnabled=!1),f.addClass("ui-mobile ui-mobile-rendering"),setTimeout(e,5e3),a.extend(a.mobile,{initializePage:function(){var b=a.mobile.path,f=a(":jqmData(role='page'), :jqmData(role='dialog')"),h=b.stripHash(b.stripQueryParams(b.parseLocation().hash)),i=a.mobile.path.parseLocation(),j=h?c.getElementById(h):d;f.length||(f=a("body").wrapInner("<div data-"+a.mobile.ns+"role='page'></div>").children(0)),f.each(function(){var c=a(this);c[0].getAttribute("data-"+a.mobile.ns+"url")||c.attr("data-"+a.mobile.ns+"url",c.attr("id")||b.convertUrlToDataUrl(i.pathname+i.search))}),a.mobile.firstPage=f.first(),a.mobile.pageContainer=a.mobile.firstPage.parent().addClass("ui-mobile-viewport").pagecontainer(),a.mobile.navreadyDeferred.resolve(),g.trigger("pagecontainercreate"),a.mobile.loading("show"),e(),a.mobile.hashListeningEnabled&&a.mobile.path.isHashValid(location.hash)&&(a(j).is(":jqmData(role='page')")||a.mobile.path.isPath(h)||h===a.mobile.dialogHashKey)?a.event.special.navigate.isPushStateEnabled()?(a.mobile.navigate.history.stack=[],a.mobile.navigate(a.mobile.path.isPath(location.hash)?location.hash:location.href)):g.trigger("hashchange",[!0]):(a.event.special.navigate.isPushStateEnabled()&&a.mobile.navigate.navigator.squash(b.parseLocation().href),a.mobile.changePage(a.mobile.firstPage,{transition:"none",reverse:!0,changeHash:!1,fromHashChange:!0}))}}),a(function(){a.support.inlineSVG(),a.mobile.hideUrlBar&&b.scrollTo(0,1),a.mobile.defaultHomeScroll=a.support.scrollTop&&1!==a.mobile.window.scrollTop()?1:0,a.mobile.autoInitializePage&&a.mobile.initializePage(),a.mobile.hideUrlBar&&g.load(a.mobile.silentScroll),a.support.cssPointerEvents||a.mobile.document.delegate(".ui-state-disabled,.ui-disabled","vclick",function(a){a.preventDefault(),a.stopImmediatePropagation()})}))}(a,this)});
//# sourceMappingURL=jquery.mobile-1.4.5.min.map
/**
 * jQuery Unveil
 * A very lightweight jQuery plugin to lazy load images
 * http://luis-almeida.github.com/unveil
 *
 * Licensed under the MIT license.
 * Copyright 2013 Lus Almeida
 * https://github.com/luis-almeida
 */

; (function ($) {

    $.fn.unveil = function (threshold, callback) {

        var $w = $(window),
            th = threshold || 0,
            retina = window.devicePixelRatio > 1,
            attrib = retina ? "data-src-retina" : "data-src",
            images = this,
            loaded;

        this.one("unveil", function () {
            var elemType = $(this).get(0).tagName;
            var source = this.getAttribute(attrib);
            source = source || this.getAttribute("data-src");
            if (source) {
                if (elemType === "DIV") {
                    this.style.backgroundImage = "url('" + source + "')";
                } else {
                    this.setAttribute("src", source);
                }
                this.setAttribute("data-src", '');
                if (typeof callback === "function") callback.call(this);
            }
        });

        function unveil() {
            var inview = images.filter(function () {
                var $e = $(this);
                if ($e.is(":hidden")) return;

                var wt = $w.scrollTop(),
                    wb = wt + $w.height(),
                    et = $e.offset().top,
                    eb = et + $e.height();

                return eb >= wt - th && et <= wb + th;
            });

            loaded = inview.trigger("unveil");
            images = images.not(loaded);
        }

        $w.on('scroll.unveil', unveil);
        $w.on('resize.unveil', unveil);

        unveil();

        return this;

    };

    $.fn.lazyChildren = function () {

        $(".lazy", this).unveil(200);
        return this;
    };

})(window.jQuery || window.Zepto);
(function () {

    // This script produces errors in older versions of safari

    if ((navigator.userAgent || '').toLowerCase().indexOf('chrome') == -1) {
        return;
    }

    var chrome = window.chrome || {};
    chrome.cast = chrome.cast || {};
    chrome.cast.media = chrome.cast.media || {};
    chrome.cast.ApiBootstrap_ = function () {
    };
    chrome.cast.ApiBootstrap_.EXTENSION_IDS = ["boadgeojelhgndaghljhdicfkmllpafd", "dliochdbjfkdbacpmhlcpmleaejidimm", "hfaagokkkhdbgiakmmlclaapfelnkoah", "fmfcbgogabcbclcofgocippekhfcmgfj", "enhhojjnijigcajfphajepfemndkmdlo"];
    chrome.cast.ApiBootstrap_.findInstalledExtension_ = function (callback) {
        chrome.cast.ApiBootstrap_.findInstalledExtensionHelper_(0, callback);
    };
    chrome.cast.ApiBootstrap_.findInstalledExtensionHelper_ = function (index, callback) {
        index == chrome.cast.ApiBootstrap_.EXTENSION_IDS.length ? callback(null) : chrome.cast.ApiBootstrap_.isExtensionInstalled_(chrome.cast.ApiBootstrap_.EXTENSION_IDS[index], function (installed) {
            installed ? callback(chrome.cast.ApiBootstrap_.EXTENSION_IDS[index]) : chrome.cast.ApiBootstrap_.findInstalledExtensionHelper_(index + 1, callback);
        });
    };
    chrome.cast.ApiBootstrap_.getCastSenderUrl_ = function (extensionId) {
        return "chrome-extension://" + extensionId + "/cast_sender.js";
    };
    chrome.cast.ApiBootstrap_.isExtensionInstalled_ = function (extensionId, callback) {
        var xmlhttp = new XMLHttpRequest;
        xmlhttp.onreadystatechange = function () {
            4 == xmlhttp.readyState && 200 == xmlhttp.status && callback(!0);
        };
        xmlhttp.onerror = function () {
            callback(!1);
        };

        try {
            // Throws an error in other browsers
            xmlhttp.open("GET", chrome.cast.ApiBootstrap_.getCastSenderUrl_(extensionId), !0);
            xmlhttp.send();
        } catch (ex) {

        }
    };
    chrome.cast.ApiBootstrap_.findInstalledExtension_(function (extensionId) {
        if (extensionId) {
            console.log("Found cast extension: " + extensionId);
            chrome.cast.extensionId = extensionId;
            var apiScript = document.createElement("script");
            apiScript.src = chrome.cast.ApiBootstrap_.getCastSenderUrl_(extensionId);
            (document.head || document.documentElement).appendChild(apiScript);
        } else {
            var msg = "No cast extension found";
            console.log(msg);
            var callback = window.__onGCastApiAvailable;
            callback && "function" == typeof callback && callback(!1, msg);
        }
    });
})();

// THIS FILE IS GENERATED - DO NOT EDIT!
/*global module:false, define:false*/

(function (define, undefined) {
    define(function () {
        'use strict';

        var impl = {};

        impl.mobileDetectRules = {
            "phones": {
                "iPhone": "\\biPhone\\b|\\biPod\\b",
                "BlackBerry": "BlackBerry|\\bBB10\\b|rim[0-9]+",
                "HTC": "HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m",
                "Nexus": "Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 6",
                "Dell": "Dell.*Streak|Dell.*Aero|Dell.*Venue|DELL.*Venue Pro|Dell Flash|Dell Smoke|Dell Mini 3iX|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b",
                "Motorola": "Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925",
                "Samsung": "Samsung|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8",
                "LG": "\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802)",
                "Sony": "SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533",
                "Asus": "Asus.*Galaxy|PadFone.*Mobile",
                "Micromax": "Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b",
                "Palm": "PalmSource|Palm",
                "Vertu": "Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature",
                "Pantech": "PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790",
                "Fly": "IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250",
                "Wiko": "KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM",
                "iMobile": "i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)",
                "SimValley": "\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b",
                "Wolfgang": "AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q",
                "Alcatel": "Alcatel",
                "Nintendo": "Nintendo 3DS",
                "Amoi": "Amoi",
                "INQ": "INQ",
                "GenericPhone": "Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser"
            },
            "tablets": {
                "iPad": "iPad|iPad.*Mobile",
                "NexusTablet": "Android.*Nexus[\\s]+(7|9|10)|^.*Android.*Nexus(?:(?!Mobile).)*$",
                "SamsungTablet": "SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-I9205|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237P|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T",
                "Kindle": "Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI)\\b",
                "SurfaceTablet": "Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)",
                "HPTablet": "HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10",
                "AsusTablet": "^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL",
                "BlackBerryTablet": "PlayBook|RIM Tablet",
                "HTCtablet": "HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410",
                "MotorolaTablet": "xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617",
                "NookTablet": "Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2",
                "AcerTablet": "Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b",
                "ToshibaTablet": "Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO",
                "LGTablet": "\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b",
                "FujitsuTablet": "Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b",
                "PrestigioTablet": "PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD",
                "LenovoTablet": "Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)",
                "DellTablet": "Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7",
                "YarvikTablet": "Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b",
                "MedionTablet": "Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB",
                "ArnovaTablet": "AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2",
                "IntensoTablet": "INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004",
                "IRUTablet": "M702pro",
                "MegafonTablet": "MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b",
                "EbodaTablet": "E-Boda (Supreme|Impresspeed|Izzycomm|Essential)",
                "AllViewTablet": "Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)",
                "ArchosTablet": "\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b",
                "AinolTablet": "NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark",
                "SonyTablet": "Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP612",
                "PhilipsTablet": "\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b",
                "CubeTablet": "Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT",
                "CobyTablet": "MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010",
                "MIDTablet": "M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733",
                "MSITablet": "MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b",
                "SMiTTablet": "Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)",
                "RockChipTablet": "Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A",
                "FlyTablet": "IQ310|Fly Vision",
                "bqTablet": "(bq)?.*(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris E10)|Maxwell.*Lite|Maxwell.*Plus",
                "HuaweiTablet": "MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim",
                "NecTablet": "\\bN-06D|\\bN-08D",
                "PantechTablet": "Pantech.*P4100",
                "BronchoTablet": "Broncho.*(N701|N708|N802|a710)",
                "VersusTablet": "TOUCHPAD.*[78910]|\\bTOUCHTAB\\b",
                "ZyncTablet": "z1000|Z99 2G|z99|z930|z999|z990|z909|Z919|z900",
                "PositivoTablet": "TB07STA|TB10STA|TB07FTA|TB10FTA",
                "NabiTablet": "Android.*\\bNabi",
                "KoboTablet": "Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build",
                "DanewTablet": "DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b",
                "TexetTablet": "NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE",
                "PlaystationTablet": "Playstation.*(Portable|Vita)",
                "TrekstorTablet": "ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab",
                "PyleAudioTablet": "\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b",
                "AdvanTablet": "Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ",
                "DanyTechTablet": "Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1",
                "GalapadTablet": "Android.*\\bG1\\b",
                "MicromaxTablet": "Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b",
                "KarbonnTablet": "Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b",
                "AllFineTablet": "Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide",
                "PROSCANTablet": "\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b",
                "YONESTablet": "BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026",
                "ChangJiaTablet": "TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503",
                "GUTablet": "TX-A1301|TX-M9002|Q702|kf026",
                "PointOfViewTablet": "TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10",
                "OvermaxTablet": "OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)",
                "HCLTablet": "HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync",
                "DPSTablet": "DPS Dream 9|DPS Dual 7",
                "VistureTablet": "V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10",
                "CrestaTablet": "CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989",
                "MediatekTablet": "\\bMT8125|MT8389|MT8135|MT8377\\b",
                "ConcordeTablet": "Concorde([ ]+)?Tab|ConCorde ReadMan",
                "GoCleverTablet": "GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042",
                "ModecomTablet": "FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003",
                "VoninoTablet": "\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b",
                "ECSTablet": "V07OT2|TM105A|S10OT1|TR10CS1",
                "StorexTablet": "eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab",
                "VodafoneTablet": "SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7",
                "EssentielBTablet": "Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2",
                "RossMoorTablet": "RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711",
                "iMobileTablet": "i-mobile i-note",
                "TolinoTablet": "tolino tab [0-9.]+|tolino shine",
                "AudioSonicTablet": "\\bC-22Q|T7-QC|T-17B|T-17P\\b",
                "AMPETablet": "Android.* A78 ",
                "SkkTablet": "Android.* (SKYPAD|PHOENIX|CYCLOPS)",
                "TecnoTablet": "TECNO P9",
                "JXDTablet": "Android.*\\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b",
                "iJoyTablet": "Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)",
                "FX2Tablet": "FX2 PAD7|FX2 PAD10",
                "XoroTablet": "KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151",
                "ViewsonicTablet": "ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a",
                "OdysTablet": "LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10",
                "CaptivaTablet": "CAPTIVA PAD",
                "IconbitTablet": "NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S",
                "TeclastTablet": "T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi",
                "JaytechTablet": "TPC-PA762",
                "BlaupunktTablet": "Endeavour 800NG|Endeavour 1010",
                "DigmaTablet": "\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b",
                "EvolioTablet": "ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b",
                "LavaTablet": "QPAD E704|\\bIvoryS\\b|E-TAB IVORY",
                "CelkonTablet": "CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b",
                "WolderTablet": "miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b",
                "MiTablet": "\\bMI PAD\\b|\\bHM NOTE 1W\\b",
                "NibiruTablet": "Nibiru M1|Nibiru Jupiter One",
                "NexoTablet": "NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI",
                "UbislateTablet": "UbiSlate[\\s]?7C",
                "PocketBookTablet": "Pocketbook",
                "Hudl": "Hudl HT7S3",
                "TelstraTablet": "T-Hub2",
                "GenericTablet": "Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bJolla\\b"
            },
            "oss": {
                "AndroidOS": "Android",
                "BlackBerryOS": "blackberry|\\bBB10\\b|rim tablet os",
                "PalmOS": "PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino",
                "SymbianOS": "Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b",
                "WindowsMobileOS": "Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;",
                "WindowsPhoneOS": "Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;",
                "iOS": "\\biPhone.*Mobile|\\biPod|\\biPad",
                "MeeGoOS": "MeeGo",
                "MaemoOS": "Maemo",
                "JavaOS": "J2ME\/|\\bMIDP\\b|\\bCLDC\\b",
                "webOS": "webOS|hpwOS",
                "badaOS": "\\bBada\\b",
                "BREWOS": "BREW"
            },
            "uas": {
                "Chrome": "\\bCrMo\\b|CriOS|Android.*Chrome\/[.0-9]* (Mobile)?",
                "Dolfin": "\\bDolfin\\b",
                "Opera": "Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR\/[0-9.]+|Coast\/[0-9.]+",
                "Skyfire": "Skyfire",
                "IE": "IEMobile|MSIEMobile",
                "Firefox": "fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile",
                "Bolt": "bolt",
                "TeaShark": "teashark",
                "Blazer": "Blazer",
                "Safari": "Version.*Mobile.*Safari|Safari.*Mobile|MobileSafari",
                "Tizen": "Tizen",
                "UCBrowser": "UC.*Browser|UCWEB",
                "baiduboxapp": "baiduboxapp",
                "baidubrowser": "baidubrowser",
                "DiigoBrowser": "DiigoBrowser",
                "Puffin": "Puffin",
                "Mercury": "\\bMercury\\b",
                "ObigoBrowser": "Obigo",
                "NetFront": "NF-Browser",
                "GenericBrowser": "NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger"
            },
            "props": {
                "Mobile": "Mobile\/[VER]",
                "Build": "Build\/[VER]",
                "Version": "Version\/[VER]",
                "VendorID": "VendorID\/[VER]",
                "iPad": "iPad.*CPU[a-z ]+[VER]",
                "iPhone": "iPhone.*CPU[a-z ]+[VER]",
                "iPod": "iPod.*CPU[a-z ]+[VER]",
                "Kindle": "Kindle\/[VER]",
                "Chrome": [
                    "Chrome\/[VER]",
                    "CriOS\/[VER]",
                    "CrMo\/[VER]"
                ],
                "Coast": [
                    "Coast\/[VER]"
                ],
                "Dolfin": "Dolfin\/[VER]",
                "Firefox": "Firefox\/[VER]",
                "Fennec": "Fennec\/[VER]",
                "IE": [
                    "IEMobile\/[VER];",
                    "IEMobile [VER]",
                    "MSIE [VER];"
                ],
                "NetFront": "NetFront\/[VER]",
                "NokiaBrowser": "NokiaBrowser\/[VER]",
                "Opera": [
                    " OPR\/[VER]",
                    "Opera Mini\/[VER]",
                    "Version\/[VER]"
                ],
                "Opera Mini": "Opera Mini\/[VER]",
                "Opera Mobi": "Version\/[VER]",
                "UC Browser": "UC Browser[VER]",
                "MQQBrowser": "MQQBrowser\/[VER]",
                "MicroMessenger": "MicroMessenger\/[VER]",
                "baiduboxapp": "baiduboxapp\/[VER]",
                "baidubrowser": "baidubrowser\/[VER]",
                "Iron": "Iron\/[VER]",
                "Safari": [
                    "Version\/[VER]",
                    "Safari\/[VER]"
                ],
                "Skyfire": "Skyfire\/[VER]",
                "Tizen": "Tizen\/[VER]",
                "Webkit": "webkit[ \/][VER]",
                "Gecko": "Gecko\/[VER]",
                "Trident": "Trident\/[VER]",
                "Presto": "Presto\/[VER]",
                "iOS": " \\bi?OS\\b [VER][ ;]{1}",
                "Android": "Android [VER]",
                "BlackBerry": [
                    "BlackBerry[\\w]+\/[VER]",
                    "BlackBerry.*Version\/[VER]",
                    "Version\/[VER]"
                ],
                "BREW": "BREW [VER]",
                "Java": "Java\/[VER]",
                "Windows Phone OS": [
                    "Windows Phone OS [VER]",
                    "Windows Phone [VER]"
                ],
                "Windows Phone": "Windows Phone [VER]",
                "Windows CE": "Windows CE\/[VER]",
                "Windows NT": "Windows NT [VER]",
                "Symbian": [
                    "SymbianOS\/[VER]",
                    "Symbian\/[VER]"
                ],
                "webOS": [
                    "webOS\/[VER]",
                    "hpwOS\/[VER];"
                ]
            },
            "utils": {
                "Bot": "Googlebot|facebookexternalhit|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor",
                "MobileBot": "Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker\/M1A1-R2D2",
                "DesktopMode": "WPDesktop",
                "TV": "SonyDTV|HbbTV",
                "WebKit": "(webkit)[ \/]([\\w.]+)",
                "Console": "\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|PLAYSTATION|Xbox)\\b",
                "Watch": "SM-V700"
            }
        };

        // following patterns come from http://detectmobilebrowsers.com/
        impl.detectMobileBrowsers = {
            fullPattern: /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,
            shortPattern: /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
        };

        var hasOwnProp = Object.prototype.hasOwnProperty,
            isArray;

        impl.FALLBACK_PHONE = 'UnknownPhone';
        impl.FALLBACK_TABLET = 'UnknownTablet';
        impl.FALLBACK_MOBILE = 'UnknownMobile';

        isArray = ('isArray' in Array) ?
            Array.isArray : function (value) { return Object.prototype.toString.call(value) === '[object Array]'; };

        function equalIC(a, b) {
            return a != null && b != null && a.toLowerCase() === b.toLowerCase();
        }

        function convertPropsToRegExp(object) {
            for (var key in object) {
                if (hasOwnProp.call(object, key)) {
                    object[key] = new RegExp(object[key], 'i');
                }
            }
        }

        (function init() {
            var key, values, value, i, len, verPos, mobileDetectRules = impl.mobileDetectRules;
            for (key in mobileDetectRules.props) {
                if (hasOwnProp.call(mobileDetectRules.props, key)) {
                    values = mobileDetectRules.props[key];
                    if (!isArray(values)) {
                        values = [values];
                    }
                    len = values.length;
                    for (i = 0; i < len; ++i) {
                        value = values[i];
                        verPos = value.indexOf('[VER]');
                        if (verPos >= 0) {
                            value = value.substring(0, verPos) + '([\\w._\\+]+)' + value.substring(verPos + 5);
                        }
                        values[i] = new RegExp(value, 'i');
                    }
                    mobileDetectRules.props[key] = values;
                }
            }
            convertPropsToRegExp(mobileDetectRules.oss);
            convertPropsToRegExp(mobileDetectRules.phones);
            convertPropsToRegExp(mobileDetectRules.tablets);
            convertPropsToRegExp(mobileDetectRules.uas);
            convertPropsToRegExp(mobileDetectRules.utils);

            // copy some patterns to oss0 which are tested first (see issue#15)
            mobileDetectRules.oss0 = {
                WindowsPhoneOS: mobileDetectRules.oss.WindowsPhoneOS,
                WindowsMobileOS: mobileDetectRules.oss.WindowsMobileOS
            };
        }());

        /**
         * Test userAgent string against a set of rules and find the matched key.
         * @param {Object} rules (key is String, value is RegExp)
         * @param {String} userAgent the navigator.userAgent (or HTTP-Header 'User-Agent').
         * @returns {String|null} the matched key if found, otherwise <tt>null</tt>
         * @private
         */
        impl.findMatch = function (rules, userAgent) {
            for (var key in rules) {
                if (hasOwnProp.call(rules, key)) {
                    if (rules[key].test(userAgent)) {
                        return key;
                    }
                }
            }
            return null;
        };

        /**
         * Check the version of the given property in the User-Agent.
         *
         * @param {String} propertyName
         * @param {String} userAgent
         * @return {String} version or <tt>null</tt> if version not found
         * @private
         */
        impl.getVersionStr = function (propertyName, userAgent) {
            var props = impl.mobileDetectRules.props, patterns, i, len, match;
            if (hasOwnProp.call(props, propertyName)) {
                patterns = props[propertyName];
                len = patterns.length;
                for (i = 0; i < len; ++i) {
                    match = patterns[i].exec(userAgent);
                    if (match !== null) {
                        return match[1];
                    }
                }
            }
            return null;
        };

        /**
         * Check the version of the given property in the User-Agent.
         * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)
         *
         * @param {String} propertyName
         * @param {String} userAgent
         * @return {Number} version or <tt>NaN</tt> if version not found
         * @private
         */
        impl.getVersion = function (propertyName, userAgent) {
            var version = impl.getVersionStr(propertyName, userAgent);
            return version ? impl.prepareVersionNo(version) : NaN;
        };

        /**
         * Prepare the version number.
         *
         * @param {String} version
         * @return {Number} the version number as a floating number
         * @private
         */
        impl.prepareVersionNo = function (version) {
            var numbers;

            numbers = version.split(/[a-z._ \/\-]/i);
            if (numbers.length === 1) {
                version = numbers[0];
            }
            if (numbers.length > 1) {
                version = numbers[0] + '.';
                numbers.shift();
                version += numbers.join('');
            }
            return Number(version);
        };

        impl.isMobileFallback = function (userAgent) {
            return impl.detectMobileBrowsers.fullPattern.test(userAgent) ||
                impl.detectMobileBrowsers.shortPattern.test(userAgent.substr(0, 4));
        };

        impl.prepareDetectionCache = function (cache, userAgent, maxPhoneWidth) {
            if (cache.mobile !== undefined) {
                return;
            }
            var phone, tablet, phoneSized;

            // first check for stronger tablet rules, then phone (see issue#5)
            tablet = impl.findMatch(impl.mobileDetectRules.tablets, userAgent);
            if (tablet) {
                cache.mobile = cache.tablet = tablet;
                cache.phone = null;
                return; // unambiguously identified as tablet
            }

            phone = impl.findMatch(impl.mobileDetectRules.phones, userAgent);
            if (phone) {
                cache.mobile = cache.phone = phone;
                cache.tablet = null;
                return; // unambiguously identified as phone
            }

            // our rules haven't found a match -> try more general fallback rules
            if (impl.isMobileFallback(userAgent)) {
                phoneSized = MobileDetect.isPhoneSized(maxPhoneWidth);
                if (phoneSized === undefined) {
                    cache.mobile = impl.FALLBACK_MOBILE;
                    cache.tablet = cache.phone = null;
                } else if (phoneSized) {
                    cache.mobile = cache.phone = impl.FALLBACK_PHONE;
                    cache.tablet = null;
                } else {
                    cache.mobile = cache.tablet = impl.FALLBACK_TABLET;
                    cache.phone = null;
                }
            } else {
                // not mobile at all!
                cache.mobile = cache.tablet = cache.phone = null;
            }
        };

        // t is a reference to a MobileDetect instance
        impl.mobileGrade = function (t) {
            // impl note:
            // To keep in sync w/ Mobile_Detect.php easily, the following code is tightly aligned to the PHP version.
            // When changes are made in Mobile_Detect.php, copy this method and replace:
            //     $this-> / t.
            //     self::MOBILE_GRADE_(.) / '$1'
            //     , self::VERSION_TYPE_FLOAT / (nothing)
            //     isIOS() / os('iOS')
            //     [reg] / (nothing)   <-- jsdelivr complaining about unescaped unicode character U+00AE
            var $isMobile = t.mobile() !== null;

            if (
                // Apple iOS 3.2-5.1 - Tested on the original iPad (4.3 / 5.0), iPad 2 (4.3), iPad 3 (5.1), original iPhone (3.1), iPhone 3 (3.2), 3GS (4.3), 4 (4.3 / 5.0), and 4S (5.1)
                t.os('iOS') && t.version('iPad') >= 4.3 ||
                t.os('iOS') && t.version('iPhone') >= 3.1 ||
                t.os('iOS') && t.version('iPod') >= 3.1 ||

                // Android 2.1-2.3 - Tested on the HTC Incredible (2.2), original Droid (2.2), HTC Aria (2.1), Google Nexus S (2.3). Functional on 1.5 & 1.6 but performance may be sluggish, tested on Google G1 (1.5)
                // Android 3.1 (Honeycomb)  - Tested on the Samsung Galaxy Tab 10.1 and Motorola XOOM
                // Android 4.0 (ICS)  - Tested on a Galaxy Nexus. Note: transition performance can be poor on upgraded devices
                // Android 4.1 (Jelly Bean)  - Tested on a Galaxy Nexus and Galaxy 7
                (t.version('Android') > 2.1 && t.is('Webkit')) ||

                // Windows Phone 7-7.5 - Tested on the HTC Surround (7.0) HTC Trophy (7.5), LG-E900 (7.5), Nokia Lumia 800
                t.version('Windows Phone OS') >= 7.0 ||

                // Blackberry 7 - Tested on BlackBerry Torch 9810
                // Blackberry 6.0 - Tested on the Torch 9800 and Style 9670
                t.is('BlackBerry') && t.version('BlackBerry') >= 6.0 ||
                // Blackberry Playbook (1.0-2.0) - Tested on PlayBook
                t.match('Playbook.*Tablet') ||

                // Palm WebOS (1.4-2.0) - Tested on the Palm Pixi (1.4), Pre (1.4), Pre 2 (2.0)
                (t.version('webOS') >= 1.4 && t.match('Palm|Pre|Pixi')) ||
                // Palm WebOS 3.0  - Tested on HP TouchPad
                t.match('hp.*TouchPad') ||

                // Firefox Mobile (12 Beta) - Tested on Android 2.3 device
                (t.is('Firefox') && t.version('Firefox') >= 12) ||

                // Chrome for Android - Tested on Android 4.0, 4.1 device
                (t.is('Chrome') && t.is('AndroidOS') && t.version('Android') >= 4.0) ||

                // Skyfire 4.1 - Tested on Android 2.3 device
                (t.is('Skyfire') && t.version('Skyfire') >= 4.1 && t.is('AndroidOS') && t.version('Android') >= 2.3) ||

                // Opera Mobile 11.5-12: Tested on Android 2.3
                (t.is('Opera') && t.version('Opera Mobi') > 11 && t.is('AndroidOS')) ||

                // Meego 1.2 - Tested on Nokia 950 and N9
                t.is('MeeGoOS') ||

                // Tizen (pre-release) - Tested on early hardware
                t.is('Tizen') ||

                // Samsung Bada 2.0 - Tested on a Samsung Wave 3, Dolphin browser
                // @todo: more tests here!
                t.is('Dolfin') && t.version('Bada') >= 2.0 ||

                // UC Browser - Tested on Android 2.3 device
                ((t.is('UC Browser') || t.is('Dolfin')) && t.version('Android') >= 2.3) ||

                // Kindle 3 and Fire  - Tested on the built-in WebKit browser for each
                (t.match('Kindle Fire') ||
                    t.is('Kindle') && t.version('Kindle') >= 3.0) ||

                // Nook Color 1.4.1 - Tested on original Nook Color, not Nook Tablet
                t.is('AndroidOS') && t.is('NookTablet') ||

                // Chrome Desktop 11-21 - Tested on OS X 10.7 and Windows 7
                t.version('Chrome') >= 11 && !$isMobile ||

                // Safari Desktop 4-5 - Tested on OS X 10.7 and Windows 7
                t.version('Safari') >= 5.0 && !$isMobile ||

                // Firefox Desktop 4-13 - Tested on OS X 10.7 and Windows 7
                t.version('Firefox') >= 4.0 && !$isMobile ||

                // Internet Explorer 7-9 - Tested on Windows XP, Vista and 7
                t.version('MSIE') >= 7.0 && !$isMobile ||

                // Opera Desktop 10-12 - Tested on OS X 10.7 and Windows 7
                // @reference: http://my.opera.com/community/openweb/idopera/
                t.version('Opera') >= 10 && !$isMobile

                ) {
                return 'A';
            }

            if (
                t.os('iOS') && t.version('iPad') < 4.3 ||
                t.os('iOS') && t.version('iPhone') < 3.1 ||
                t.os('iOS') && t.version('iPod') < 3.1 ||

                // Blackberry 5.0: Tested on the Storm 2 9550, Bold 9770
                t.is('Blackberry') && t.version('BlackBerry') >= 5 && t.version('BlackBerry') < 6 ||

                //Opera Mini (5.0-6.5) - Tested on iOS 3.2/4.3 and Android 2.3
                (t.version('Opera Mini') >= 5.0 && t.version('Opera Mini') <= 6.5 &&
                    (t.version('Android') >= 2.3 || t.is('iOS'))) ||

                // Nokia Symbian^3 - Tested on Nokia N8 (Symbian^3), C7 (Symbian^3), also works on N97 (Symbian^1)
                t.match('NokiaN8|NokiaC7|N97.*Series60|Symbian/3') ||

                // @todo: report this (tested on Nokia N71)
                t.version('Opera Mobi') >= 11 && t.is('SymbianOS')
                ) {
                return 'B';
            }

            if (
                // Blackberry 4.x - Tested on the Curve 8330
                t.version('BlackBerry') < 5.0 ||
                // Windows Mobile - Tested on the HTC Leo (WinMo 5.2)
                t.match('MSIEMobile|Windows CE.*Mobile') || t.version('Windows Mobile') <= 5.2

                ) {
                return 'C';
            }

            //All older smartphone platforms and featurephones - Any device that doesn't support media queries
            //will receive the basic, C grade experience.
            return 'C';
        };

        impl.detectOS = function (ua) {
            return impl.findMatch(impl.mobileDetectRules.oss0, ua) ||
                impl.findMatch(impl.mobileDetectRules.oss, ua);
        };

        impl.getDeviceSmallerSide = function () {
            return window.screen.width < window.screen.height ?
                window.screen.width :
                window.screen.height;
        };

        /**
         * Constructor for MobileDetect object.
         * <br>
         * Such an object will keep a reference to the given user-agent string and cache most of the detect queries.<br>
         * <div style="background-color: #d9edf7; border: 1px solid #bce8f1; color: #3a87ad; padding: 14px; border-radius: 2px; margin-top: 20px">
         *     <strong>Find information how to download and install:</strong>
         *     <a href="https://github.com/hgoebl/mobile-detect.js/">github.com/hgoebl/mobile-detect.js/</a>
         * </div>
         *
         * @example <pre>
         *     var md = new MobileDetect(window.navigator.userAgent);
         *     if (md.mobile()) {
         *         location.href = (md.mobileGrade() === 'A') ? '/mobile/' : '/lynx/';
         *     }
         * </pre>
         *
         * @param {string} userAgent typically taken from window.navigator.userAgent or http_header['User-Agent']
         * @param {number} [maxPhoneWidth=600] <strong>only for browsers</strong> specify a value for the maximum
         *        width of smallest device side (in logical "CSS" pixels) until a device detected as mobile will be handled
         *        as phone.
         *        This is only used in cases where the device cannot be classified as phone or tablet.<br>
         *        See <a href="http://developer.android.com/guide/practices/screens_support.html">Declaring Tablet Layouts
         *        for Android</a>.<br>
         *        If you provide a value < 0, then this "fuzzy" check is disabled.
         * @constructor
         * @global
         */
        function MobileDetect(userAgent, maxPhoneWidth) {
            this.ua = userAgent || '';
            this._cache = {};
            //600dp is typical 7" tablet minimum width
            this.maxPhoneWidth = maxPhoneWidth || 600;
        }

        MobileDetect.prototype = {
            constructor: MobileDetect,

            /**
             * Returns the detected phone or tablet type or <tt>null</tt> if it is not a mobile device.
             * <br>
             * For a list of possible return values see {@link MobileDetect#phone} and {@link MobileDetect#tablet}.<br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownPhone</code>, <code>UnknownTablet</code> or
             * <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>UnknownMobile</code> here.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key for the phone family or tablet family, e.g. "Nexus".
             * @function MobileDetect#mobile
             */
            mobile: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.mobile;
            },

            /**
             * Returns the detected phone type/family string or <tt>null</tt>.
             * <br>
             * The returned tablet (family or producer) is one of following keys:<br>
             * <br><tt>iPhone, BlackBerry, HTC, Nexus, Dell, Motorola, Samsung, LG, Sony, Asus,
             * Micromax, Palm, Vertu, Pantech, Fly, Wiko, iMobile, SimValley, Wolfgang,
             * Alcatel, Nintendo, Amoi, INQ, GenericPhone</tt><br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownPhone</code> or <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}
             * will return <code>UnknownMobile</code>.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key of the phone family or producer, e.g. "iPhone"
             * @function MobileDetect#phone
             */
            phone: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.phone;
            },

            /**
             * Returns the detected tablet type/family string or <tt>null</tt>.
             * <br>
             * The returned tablet (family or producer) is one of following keys:<br>
             * <br><tt>iPad, NexusTablet, SamsungTablet, Kindle, SurfaceTablet, HPTablet, AsusTablet,
             * BlackBerryTablet, HTCtablet, MotorolaTablet, NookTablet, AcerTablet,
             * ToshibaTablet, LGTablet, FujitsuTablet, PrestigioTablet, LenovoTablet,
             * DellTablet, YarvikTablet, MedionTablet, ArnovaTablet, IntensoTablet, IRUTablet,
             * MegafonTablet, EbodaTablet, AllViewTablet, ArchosTablet, AinolTablet,
             * SonyTablet, PhilipsTablet, CubeTablet, CobyTablet, MIDTablet, MSITablet,
             * SMiTTablet, RockChipTablet, FlyTablet, bqTablet, HuaweiTablet, NecTablet,
             * PantechTablet, BronchoTablet, VersusTablet, ZyncTablet, PositivoTablet,
             * NabiTablet, KoboTablet, DanewTablet, TexetTablet, PlaystationTablet,
             * TrekstorTablet, PyleAudioTablet, AdvanTablet, DanyTechTablet, GalapadTablet,
             * MicromaxTablet, KarbonnTablet, AllFineTablet, PROSCANTablet, YONESTablet,
             * ChangJiaTablet, GUTablet, PointOfViewTablet, OvermaxTablet, HCLTablet,
             * DPSTablet, VistureTablet, CrestaTablet, MediatekTablet, ConcordeTablet,
             * GoCleverTablet, ModecomTablet, VoninoTablet, ECSTablet, StorexTablet,
             * VodafoneTablet, EssentielBTablet, RossMoorTablet, iMobileTablet, TolinoTablet,
             * AudioSonicTablet, AMPETablet, SkkTablet, TecnoTablet, JXDTablet, iJoyTablet,
             * FX2Tablet, XoroTablet, ViewsonicTablet, OdysTablet, CaptivaTablet,
             * IconbitTablet, TeclastTablet, JaytechTablet, BlaupunktTablet, DigmaTablet,
             * EvolioTablet, LavaTablet, CelkonTablet, WolderTablet, MiTablet, NibiruTablet,
             * NexoTablet, UbislateTablet, PocketBookTablet, Hudl, TelstraTablet, GenericTablet</tt><br>
             * <br>
             * If the device is not detected by the regular expressions from Mobile-Detect, a test is made against
             * the patterns of <a href="http://detectmobilebrowsers.com/">detectmobilebrowsers.com</a>. If this test
             * is positive, a value of <code>UnknownTablet</code> or <code>UnknownMobile</code> is returned.<br>
             * When used in browser, the decision whether phone or tablet is made based on <code>screen.width/height</code>.<br>
             * <br>
             * When used server-side (node.js), there is no way to tell the difference between <code>UnknownTablet</code>
             * and <code>UnknownMobile</code>, so you will get <code>null</code> here, while {@link MobileDetect#mobile}
             * will return <code>UnknownMobile</code>.<br>
             * Be aware that since v1.0.0 in this special case you will get <code>UnknownMobile</code> only for:
             * {@link MobileDetect#mobile}, not for {@link MobileDetect#phone} and {@link MobileDetect#tablet}.
             * In versions before v1.0.0 all 3 methods returned <code>UnknownMobile</code> which was tedious to use.
             * <br>
             * In most cases you will use the return value just as a boolean.
             *
             * @returns {String} the key of the tablet family or producer, e.g. "SamsungTablet"
             * @function MobileDetect#tablet
             */
            tablet: function () {
                impl.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth);
                return this._cache.tablet;
            },

            /**
             * Returns the detected user-agent string or <tt>null</tt>.
             * <br>
             * The returned user-agent is one of following keys:<br>
             * <br><tt>Chrome, Dolfin, Opera, Skyfire, IE, Firefox, Bolt, TeaShark, Blazer, Safari,
             * Tizen, UCBrowser, baiduboxapp, baidubrowser, DiigoBrowser, Puffin, Mercury,
             * ObigoBrowser, NetFront, GenericBrowser</tt><br>
             *
             * @returns {String} the key for the detected user-agent or <tt>null</tt>
             * @function MobileDetect#userAgent
             */
            userAgent: function () {
                if (this._cache.userAgent === undefined) {
                    this._cache.userAgent = impl.findMatch(impl.mobileDetectRules.uas, this.ua);
                }
                return this._cache.userAgent;
            },

            /**
             * Returns the detected operating system string or <tt>null</tt>.
             * <br>
             * The operating system is one of following keys:<br>
             * <br><tt>AndroidOS, BlackBerryOS, PalmOS, SymbianOS, WindowsMobileOS, WindowsPhoneOS,
             * iOS, MeeGoOS, MaemoOS, JavaOS, webOS, badaOS, BREWOS</tt><br>
             *
             * @returns {String} the key for the detected operating system.
             * @function MobileDetect#os
             */
            os: function () {
                if (this._cache.os === undefined) {
                    this._cache.os = impl.detectOS(this.ua);
                }
                return this._cache.os;
            },

            /**
             * Get the version (as Number) of the given property in the User-Agent.
             * <br>
             * Will return a float number. (eg. 2_0 will return 2.0, 4.3.1 will return 4.31)
             *
             * @param {String} key a key defining a thing which has a version.<br>
             *        You can use one of following keys:<br>
             * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,
             * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera
             * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,
             * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,
             * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows
             * NT, Symbian, webOS</tt><br>
             *
             * @returns {Number} the version as float or <tt>NaN</tt> if User-Agent doesn't contain this version.
             *          Be careful when comparing this value with '==' operator!
             * @function MobileDetect#version
             */
            version: function (key) {
                return impl.getVersion(key, this.ua);
            },

            /**
             * Get the version (as String) of the given property in the User-Agent.
             * <br>
             *
             * @param {String} key a key defining a thing which has a version.<br>
             *        You can use one of following keys:<br>
             * <br><tt>Mobile, Build, Version, VendorID, iPad, iPhone, iPod, Kindle, Chrome, Coast,
             * Dolfin, Firefox, Fennec, IE, NetFront, NokiaBrowser, Opera, Opera Mini, Opera
             * Mobi, UC Browser, MQQBrowser, MicroMessenger, baiduboxapp, baidubrowser, Iron,
             * Safari, Skyfire, Tizen, Webkit, Gecko, Trident, Presto, iOS, Android,
             * BlackBerry, BREW, Java, Windows Phone OS, Windows Phone, Windows CE, Windows
             * NT, Symbian, webOS</tt><br>
             *
             * @returns {String} the "raw" version as String or <tt>null</tt> if User-Agent doesn't contain this version.
             *
             * @function MobileDetect#versionStr
             */
            versionStr: function (key) {
                return impl.getVersionStr(key, this.ua);
            },

            /**
             * Global test key against userAgent, os, phone, tablet and some other properties of userAgent string.
             *
             * @param {String} key the key (case-insensitive) of a userAgent, an operating system, phone or
             *        tablet family.<br>
             *        For a complete list of possible values, see {@link MobileDetect#userAgent},
             *        {@link MobileDetect#os}, {@link MobileDetect#phone}, {@link MobileDetect#tablet}.<br>
             *        Additionally you have following keys:<br>
             * <br><tt>Bot, MobileBot, DesktopMode, TV, WebKit, Console, Watch</tt><br>
             *
             * @returns {boolean} <tt>true</tt> when the given key is one of the defined keys of userAgent, os, phone,
             *                    tablet or one of the listed additional keys, otherwise <tt>false</tt>
             * @function MobileDetect#is
             */
            is: function (key) {
                return equalIC(key, this.userAgent()) ||
                       equalIC(key, this.os()) ||
                       equalIC(key, this.phone()) ||
                       equalIC(key, this.tablet()) ||
                       equalIC(key, impl.findMatch(impl.mobileDetectRules.utils, this.ua));
            },

            /**
             * Do a quick test against navigator::userAgent.
             *
             * @param {String|RegExp} pattern the pattern, either as String or RegExp
             *                        (a string will be converted to a case-insensitive RegExp).
             * @returns {boolean} <tt>true</tt> when the pattern matches, otherwise <tt>false</tt>
             * @function MobileDetect#match
             */
            match: function (pattern) {
                if (!(pattern instanceof RegExp)) {
                    pattern = new RegExp(pattern, 'i');
                }
                return pattern.test(this.ua);
            },

            /**
             * Checks whether the mobile device can be considered as phone regarding <code>screen.width</code>.
             * <br>
             * Obviously this method makes sense in browser environments only (not for Node.js)!
             * @param {number} [maxPhoneWidth] the maximum logical pixels (aka. CSS-pixels) to be considered as phone.<br>
             *        The argument is optional and if not present or falsy, the value of the constructor is taken.
             * @returns {boolean|undefined} <code>undefined</code> if screen size wasn't detectable, else <code>true</code>
             *          when screen.width is less or equal to maxPhoneWidth, otherwise <code>false</code>.<br>
             *          Will always return <code>undefined</code> server-side.
             */
            isPhoneSized: function (maxPhoneWidth) {
                return MobileDetect.isPhoneSized(maxPhoneWidth || this.maxPhoneWidth);
            },

            /**
             * Returns the mobile grade ('A', 'B', 'C').
             *
             * @returns {String} one of the mobile grades ('A', 'B', 'C').
             * @function MobileDetect#mobileGrade
             */
            mobileGrade: function () {
                if (this._cache.grade === undefined) {
                    this._cache.grade = impl.mobileGrade(this);
                }
                return this._cache.grade;
            }
        };

        // environment-dependent
        if (typeof window !== 'undefined' && window.screen) {
            MobileDetect.isPhoneSized = function (maxPhoneWidth) {
                return maxPhoneWidth < 0 ? undefined : impl.getDeviceSmallerSide() <= maxPhoneWidth;
            };
        } else {
            MobileDetect.isPhoneSized = function () { };
        }

        // should not be replaced by a completely new object - just overwrite existing methods
        MobileDetect._impl = impl;

        return MobileDetect;
    }); // end of call of define()
})((function (undefined) {
    if (typeof define === 'function' && define.amd) {
        return define;
    } else if (typeof module !== 'undefined' && module.exports) {
        return function (factory) { module.exports = factory(); };
    } else if (typeof window !== 'undefined') {
        return function (factory) { window.MobileDetect = factory(); };
    } else {
        // please file a bug if you get this error!
        throw new Error('unknown environment');
    }
})());

(function (jQuery, window, undefined) {
    "use strict";

    var matched, browser;

    jQuery.uaMatch = function (ua) {
        ua = ua.toLowerCase();

        var match = /(chrome)[ \/]([\w.]+)/.exec(ua) ||
            /(webkit)[ \/]([\w.]+)/.exec(ua) ||
            /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua) ||
            /(msie) ([\w.]+)/.exec(ua) ||
            ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua) ||
            [];

        var platform_match = /(ipad)/.exec(ua) ||
            /(iphone)/.exec(ua) ||
            /(android)/.exec(ua) ||
            [];

        var browser = match[1] || "";

        if (ua.indexOf("like gecko") != -1 && ua.indexOf('webkit') == -1 && ua.indexOf('opera') == -1) {
            browser = "msie";
        }

        return {
            browser: browser,
            version: match[2] || "0",
            platform: platform_match[0] || ""
        };
    };

    matched = jQuery.uaMatch(window.navigator.userAgent);
    browser = {};

    if (matched.browser) {
        browser[matched.browser] = true;
        browser.version = matched.version;
    }

    if (matched.platform) {
        browser[matched.platform] = true;
    }

    // Chrome is Webkit, but Webkit is also Safari.
    if (browser.chrome) {
        browser.webkit = true;
    } else if (browser.webkit) {
        browser.safari = true;
    }

    var md = new MobileDetect(window.navigator.userAgent);

    browser.mobile = md.mobile();

    jQuery.browser = browser;

})(jQuery, window);


/*globals jQuery, define, exports, require, window, document, postMessage */
(function (factory) {
	"use strict";
	if (typeof define === 'function' && define.amd) {
		define(['jquery'], factory);
	}
	else if(typeof exports === 'object') {
		factory(require('jquery'));
	}
	else {
		factory(jQuery);
	}
}(function ($, undefined) {
	"use strict";
/*!
 * jsTree 3.0.8
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */

	// prevent another load? maybe there is a better way?
	if($.jstree) {
		return;
	}

	/**
	 * ### jsTree core functionality
	 */

	// internal variables
	var instance_counter = 0,
		ccp_node = false,
		ccp_mode = false,
		ccp_inst = false,
		themes_loaded = [],
		src = $('script:last').attr('src'),
		_d = document, _node = _d.createElement('LI'), _temp1, _temp2;

	_node.setAttribute('role', 'treeitem');
	_temp1 = _d.createElement('I');
	_temp1.className = 'jstree-icon jstree-ocl';
	_temp1.setAttribute('role', 'presentation');
	_node.appendChild(_temp1);
	_temp1 = _d.createElement('A');
	_temp1.className = 'jstree-anchor';
	_temp1.setAttribute('href','#');
	_temp1.setAttribute('tabindex','-1');
	_temp2 = _d.createElement('I');
	_temp2.className = 'jstree-icon jstree-themeicon';
	_temp2.setAttribute('role', 'presentation');
	_temp1.appendChild(_temp2);
	_node.appendChild(_temp1);
	_temp1 = _temp2 = null;


	/**
	 * holds all jstree related functions and variables, including the actual class and methods to create, access and manipulate instances.
	 * @name $.jstree
	 */
	$.jstree = {
		/** 
		 * specifies the jstree version in use
		 * @name $.jstree.version
		 */
		version : '3.0.8',
		/**
		 * holds all the default options used when creating new instances
		 * @name $.jstree.defaults
		 */
		defaults : {
			/**
			 * configure which plugins will be active on an instance. Should be an array of strings, where each element is a plugin name. The default is `[]`
			 * @name $.jstree.defaults.plugins
			 */
			plugins : []
		},
		/**
		 * stores all loaded jstree plugins (used internally)
		 * @name $.jstree.plugins
		 */
		plugins : {},
		path : src && src.indexOf('/') !== -1 ? src.replace(/\/[^\/]+$/,'') : '',
		idregex : /[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g
	};
	/**
	 * creates a jstree instance
	 * @name $.jstree.create(el [, options])
	 * @param {DOMElement|jQuery|String} el the element to create the instance on, can be jQuery extended or a selector
	 * @param {Object} options options for this instance (extends `$.jstree.defaults`)
	 * @return {jsTree} the new instance
	 */
	$.jstree.create = function (el, options) {
		var tmp = new $.jstree.core(++instance_counter),
			opt = options;
		options = $.extend(true, {}, $.jstree.defaults, options);
		if(opt && opt.plugins) {
			options.plugins = opt.plugins;
		}
		$.each(options.plugins, function (i, k) {
			if(i !== 'core') {
				tmp = tmp.plugin(k, options[k]);
			}
		});
		tmp.init(el, options);
		return tmp;
	};
	/**
	 * remove all traces of jstree from the DOM and destroy all instances
	 * @name $.jstree.destroy()
	 */
	$.jstree.destroy = function () {
		$('.jstree:jstree').jstree('destroy');
		$(document).off('.jstree');
	};
	/**
	 * the jstree class constructor, used only internally
	 * @private
	 * @name $.jstree.core(id)
	 * @param {Number} id this instance's index
	 */
	$.jstree.core = function (id) {
		this._id = id;
		this._cnt = 0;
		this._wrk = null;
		this._data = {
			core : {
				themes : {
					name : false,
					dots : false,
					icons : false
				},
				selected : [],
				last_error : {},
				working : false,
				worker_queue : [],
				focused : null
			}
		};
	};
	/**
	 * get a reference to an existing instance
	 *
	 * __Examples__
	 *
	 *	// provided a container with an ID of "tree", and a nested node with an ID of "branch"
	 *	// all of there will return the same instance
	 *	$.jstree.reference('tree');
	 *	$.jstree.reference('#tree');
	 *	$.jstree.reference($('#tree'));
	 *	$.jstree.reference(document.getElementByID('tree'));
	 *	$.jstree.reference('branch');
	 *	$.jstree.reference('#branch');
	 *	$.jstree.reference($('#branch'));
	 *	$.jstree.reference(document.getElementByID('branch'));
	 *
	 * @name $.jstree.reference(needle)
	 * @param {DOMElement|jQuery|String} needle
	 * @return {jsTree|null} the instance or `null` if not found
	 */
	$.jstree.reference = function (needle) {
		var tmp = null,
			obj = null;
		if(needle && needle.id) { needle = needle.id; }

		if(!obj || !obj.length) {
			try { obj = $(needle); } catch (ignore) { }
		}
		if(!obj || !obj.length) {
			try { obj = $('#' + needle.replace($.jstree.idregex,'\\$&')); } catch (ignore) { }
		}
		if(obj && obj.length && (obj = obj.closest('.jstree')).length && (obj = obj.data('jstree'))) {
			tmp = obj;
		}
		else {
			$('.jstree').each(function () {
				var inst = $(this).data('jstree');
				if(inst && inst._model.data[needle]) {
					tmp = inst;
					return false;
				}
			});
		}
		return tmp;
	};
	/**
	 * Create an instance, get an instance or invoke a command on a instance. 
	 * 
	 * If there is no instance associated with the current node a new one is created and `arg` is used to extend `$.jstree.defaults` for this new instance. There would be no return value (chaining is not broken).
	 * 
	 * If there is an existing instance and `arg` is a string the command specified by `arg` is executed on the instance, with any additional arguments passed to the function. If the function returns a value it will be returned (chaining could break depending on function).
	 * 
	 * If there is an existing instance and `arg` is not a string the instance itself is returned (similar to `$.jstree.reference`).
	 * 
	 * In any other case - nothing is returned and chaining is not broken.
	 *
	 * __Examples__
	 *
	 *	$('#tree1').jstree(); // creates an instance
	 *	$('#tree2').jstree({ plugins : [] }); // create an instance with some options
	 *	$('#tree1').jstree('open_node', '#branch_1'); // call a method on an existing instance, passing additional arguments
	 *	$('#tree2').jstree(); // get an existing instance (or create an instance)
	 *	$('#tree2').jstree(true); // get an existing instance (will not create new instance)
	 *	$('#branch_1').jstree().select_node('#branch_1'); // get an instance (using a nested element and call a method)
	 *
	 * @name $().jstree([arg])
	 * @param {String|Object} arg
	 * @return {Mixed}
	 */
	$.fn.jstree = function (arg) {
		// check for string argument
		var is_method	= (typeof arg === 'string'),
			args		= Array.prototype.slice.call(arguments, 1),
			result		= null;
		if(arg === true && !this.length) { return false; }
		this.each(function () {
			// get the instance (if there is one) and method (if it exists)
			var instance = $.jstree.reference(this),
				method = is_method && instance ? instance[arg] : null;
			// if calling a method, and method is available - execute on the instance
			result = is_method && method ?
				method.apply(instance, args) :
				null;
			// if there is no instance and no method is being called - create one
			if(!instance && !is_method && (arg === undefined || $.isPlainObject(arg))) {
				$(this).data('jstree', new $.jstree.create(this, arg));
			}
			// if there is an instance and no method is called - return the instance
			if( (instance && !is_method) || arg === true ) {
				result = instance || false;
			}
			// if there was a method call which returned a result - break and return the value
			if(result !== null && result !== undefined) {
				return false;
			}
		});
		// if there was a method call with a valid return value - return that, otherwise continue the chain
		return result !== null && result !== undefined ?
			result : this;
	};
	/**
	 * used to find elements containing an instance
	 *
	 * __Examples__
	 *
	 *	$('div:jstree').each(function () {
	 *		$(this).jstree('destroy');
	 *	});
	 *
	 * @name $(':jstree')
	 * @return {jQuery}
	 */
	$.expr[':'].jstree = $.expr.createPseudo(function(search) {
		return function(a) {
			return $(a).hasClass('jstree') &&
				$(a).data('jstree') !== undefined;
		};
	});

	/**
	 * stores all defaults for the core
	 * @name $.jstree.defaults.core
	 */
	$.jstree.defaults.core = {
		/**
		 * data configuration
		 * 
		 * If left as `false` the HTML inside the jstree container element is used to populate the tree (that should be an unordered list with list items).
		 *
		 * You can also pass in a HTML string or a JSON array here.
		 * 
		 * It is possible to pass in a standard jQuery-like AJAX config and jstree will automatically determine if the response is JSON or HTML and use that to populate the tree. 
		 * In addition to the standard jQuery ajax options here you can suppy functions for `data` and `url`, the functions will be run in the current instance's scope and a param will be passed indicating which node is being loaded, the return value of those functions will be used.
		 * 
		 * The last option is to specify a function, that function will receive the node being loaded as argument and a second param which is a function which should be called with the result.
		 *
		 * __Examples__
		 *
		 *	// AJAX
		 *	$('#tree').jstree({
		 *		'core' : {
		 *			'data' : {
		 *				'url' : '/get/children/',
		 *				'data' : function (node) {
		 *					return { 'id' : node.id };
		 *				}
		 *			}
		 *		});
		 *
		 *	// direct data
		 *	$('#tree').jstree({
		 *		'core' : {
		 *			'data' : [
		 *				'Simple root node',
		 *				{
		 *					'id' : 'node_2',
		 *					'text' : 'Root node with options',
		 *					'state' : { 'opened' : true, 'selected' : true },
		 *					'children' : [ { 'text' : 'Child 1' }, 'Child 2']
		 *				}
		 *			]
		 *		});
		 *	
		 *	// function
		 *	$('#tree').jstree({
		 *		'core' : {
		 *			'data' : function (obj, callback) {
		 *				callback.call(this, ['Root 1', 'Root 2']);
		 *			}
		 *		});
		 * 
		 * @name $.jstree.defaults.core.data
		 */
		data			: false,
		/**
		 * configure the various strings used throughout the tree
		 *
		 * You can use an object where the key is the string you need to replace and the value is your replacement.
		 * Another option is to specify a function which will be called with an argument of the needed string and should return the replacement.
		 * If left as `false` no replacement is made.
		 *
		 * __Examples__
		 *
		 *	$('#tree').jstree({
		 *		'core' : {
		 *			'strings' : {
		 *				'Loading ...' : 'Please wait ...'
		 *			}
		 *		}
		 *	});
		 *
		 * @name $.jstree.defaults.core.strings
		 */
		strings			: false,
		/**
		 * determines what happens when a user tries to modify the structure of the tree
		 * If left as `false` all operations like create, rename, delete, move or copy are prevented.
		 * You can set this to `true` to allow all interactions or use a function to have better control.
		 *
		 * __Examples__
		 *
		 *	$('#tree').jstree({
		 *		'core' : {
		 *			'check_callback' : function (operation, node, node_parent, node_position, more) {
		 *				// operation can be 'create_node', 'rename_node', 'delete_node', 'move_node' or 'copy_node'
		 *				// in case of 'rename_node' node_position is filled with the new node name
		 *				return operation === 'rename_node' ? true : false;
		 *			}
		 *		}
		 *	});
		 * 
		 * @name $.jstree.defaults.core.check_callback
		 */
		check_callback	: false,
		/**
		 * a callback called with a single object parameter in the instance's scope when something goes wrong (operation prevented, ajax failed, etc)
		 * @name $.jstree.defaults.core.error
		 */
		error			: $.noop,
		/**
		 * the open / close animation duration in milliseconds - set this to `false` to disable the animation (default is `200`)
		 * @name $.jstree.defaults.core.animation
		 */
		animation		: 200,
		/**
		 * a boolean indicating if multiple nodes can be selected
		 * @name $.jstree.defaults.core.multiple
		 */
		multiple		: true,
		/**
		 * theme configuration object
		 * @name $.jstree.defaults.core.themes
		 */
		themes			: {
			/**
			 * the name of the theme to use (if left as `false` the default theme is used)
			 * @name $.jstree.defaults.core.themes.name
			 */
			name			: false,
			/**
			 * the URL of the theme's CSS file, leave this as `false` if you have manually included the theme CSS (recommended). You can set this to `true` too which will try to autoload the theme.
			 * @name $.jstree.defaults.core.themes.url
			 */
			url				: false,
			/**
			 * the location of all jstree themes - only used if `url` is set to `true`
			 * @name $.jstree.defaults.core.themes.dir
			 */
			dir				: false,
			/**
			 * a boolean indicating if connecting dots are shown
			 * @name $.jstree.defaults.core.themes.dots
			 */
			dots			: true,
			/**
			 * a boolean indicating if node icons are shown
			 * @name $.jstree.defaults.core.themes.icons
			 */
			icons			: true,
			/**
			 * a boolean indicating if the tree background is striped
			 * @name $.jstree.defaults.core.themes.stripes
			 */
			stripes			: false,
			/**
			 * a string (or boolean `false`) specifying the theme variant to use (if the theme supports variants)
			 * @name $.jstree.defaults.core.themes.variant
			 */
			variant			: false,
			/**
			 * a boolean specifying if a reponsive version of the theme should kick in on smaller screens (if the theme supports it). Defaults to `false`.
			 * @name $.jstree.defaults.core.themes.responsive
			 */
			responsive		: false
		},
		/**
		 * if left as `true` all parents of all selected nodes will be opened once the tree loads (so that all selected nodes are visible to the user)
		 * @name $.jstree.defaults.core.expand_selected_onload
		 */
		expand_selected_onload : true,
		/**
		 * if left as `true` web workers will be used to parse incoming JSON data where possible, so that the UI will not be blocked by large requests. Workers are however about 30% slower. Defaults to `true`
		 * @name $.jstree.defaults.core.worker
		 */
		worker : true,
		/**
		 * Force node text to plain text (and escape HTML). Defaults to `false`
		 * @name $.jstree.defaults.core.force_text
		 */
		force_text : false
	};
	$.jstree.core.prototype = {
		/**
		 * used to decorate an instance with a plugin. Used internally.
		 * @private
		 * @name plugin(deco [, opts])
		 * @param  {String} deco the plugin to decorate with
		 * @param  {Object} opts options for the plugin
		 * @return {jsTree}
		 */
		plugin : function (deco, opts) {
			var Child = $.jstree.plugins[deco];
			if(Child) {
				this._data[deco] = {};
				Child.prototype = this;
				return new Child(opts, this);
			}
			return this;
		},
		/**
		 * used to decorate an instance with a plugin. Used internally.
		 * @private
		 * @name init(el, optons)
		 * @param {DOMElement|jQuery|String} el the element we are transforming
		 * @param {Object} options options for this instance
		 * @trigger init.jstree, loading.jstree, loaded.jstree, ready.jstree, changed.jstree
		 */
		init : function (el, options) {
			this._model = {
				data : {
					'#' : {
						id : '#',
						parent : null,
						parents : [],
						children : [],
						children_d : [],
						state : { loaded : false }
					}
				},
				changed : [],
				force_full_redraw : false,
				redraw_timeout : false,
				default_state : {
					loaded : true,
					opened : false,
					selected : false,
					disabled : false
				}
			};

			this.element = $(el).addClass('jstree jstree-' + this._id);
			this.settings = options;
			this.element.bind("destroyed", $.proxy(this.teardown, this));

			this._data.core.ready = false;
			this._data.core.loaded = false;
			this._data.core.rtl = (this.element.css("direction") === "rtl");
			this.element[this._data.core.rtl ? 'addClass' : 'removeClass']("jstree-rtl");
			this.element.attr('role','tree');
			if(this.settings.core.multiple) {
				this.element.attr('aria-multiselectable', true);
			}
			if(!this.element.attr('tabindex')) {
				this.element.attr('tabindex','0');
			}

			this.bind();
			/**
			 * triggered after all events are bound
			 * @event
			 * @name init.jstree
			 */
			this.trigger("init");

			this._data.core.original_container_html = this.element.find(" > ul > li").clone(true);
			this._data.core.original_container_html
				.find("li").addBack()
				.contents().filter(function() {
					return this.nodeType === 3 && (!this.nodeValue || /^\s+$/.test(this.nodeValue));
				})
				.remove();
			this.element.html("<"+"ul class='jstree-container-ul jstree-children' role='group'><"+"li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>" + this.get_string("Loading ...") + "</a></li></ul>");
			this.element.attr('aria-activedescendant','j' + this._id + '_loading');
			this._data.core.li_height = this.get_container_ul().children("li").first().height() || 24;
			/**
			 * triggered after the loading text is shown and before loading starts
			 * @event
			 * @name loading.jstree
			 */
			this.trigger("loading");
			this.load_node('#');
		},
		/**
		 * destroy an instance
		 * @name destroy()
		 * @param  {Boolean} keep_html if not set to `true` the container will be emptied, otherwise the current DOM elements will be kept intact
		 */
		destroy : function (keep_html) {
			if(this._wrk) {
				try {
					window.URL.revokeObjectURL(this._wrk);
					this._wrk = null;
				}
				catch (ignore) { }
			}
			if(!keep_html) { this.element.empty(); }
			this.element.unbind("destroyed", this.teardown);
			this.teardown();
		},
		/**
		 * part of the destroying of an instance. Used internally.
		 * @private
		 * @name teardown()
		 */
		teardown : function () {
			this.unbind();
			this.element
				.removeClass('jstree')
				.removeData('jstree')
				.find("[class^='jstree']")
					.addBack()
					.attr("class", function () { return this.className.replace(/jstree[^ ]*|$/ig,''); });
			this.element = null;
		},
		/**
		 * bind all events. Used internally.
		 * @private
		 * @name bind()
		 */
		bind : function () {
			var word = '',
				tout = null;
			this.element
				.on("dblclick.jstree", function () {
						if(document.selection && document.selection.empty) {
							document.selection.empty();
						}
						else {
							if(window.getSelection) {
								var sel = window.getSelection();
								try {
									sel.removeAllRanges();
									sel.collapse();
								} catch (ignore) { }
							}
						}
					})
				.on("click.jstree", ".jstree-ocl", $.proxy(function (e) {
						this.toggle_node(e.target);
					}, this))
				.on("click.jstree", ".jstree-anchor", $.proxy(function (e) {
						e.preventDefault();
						if(e.currentTarget !== document.activeElement) { $(e.currentTarget).focus(); }
						this.activate_node(e.currentTarget, e);
					}, this))
				.on('keydown.jstree', '.jstree-anchor', $.proxy(function (e) {
						if(e.target.tagName === "INPUT") { return true; }
						var o = null;
						if(this._data.core.rtl) {
							if(e.which === 37) { e.which = 39; }
							else if(e.which === 39) { e.which = 37; }
						}
						switch(e.which) {
							case 32: // aria defines space only with Ctrl
								if(e.ctrlKey) {
									e.type = "click";
									$(e.currentTarget).trigger(e);
								}
								break;
							case 13: // enter
								e.type = "click";
								$(e.currentTarget).trigger(e);
								break;
							case 37: // right
								e.preventDefault();
								if(this.is_open(e.currentTarget)) {
									this.close_node(e.currentTarget);
								}
								else {
									o = this.get_parent(e.currentTarget);
									if(o && o.id !== '#') { this.get_node(o, true).children('.jstree-anchor').focus(); }
								}
								break;
							case 38: // up
								e.preventDefault();
								o = this.get_prev_dom(e.currentTarget);
								if(o && o.length) { o.children('.jstree-anchor').focus(); }
								break;
							case 39: // left
								e.preventDefault();
								if(this.is_closed(e.currentTarget)) {
									this.open_node(e.currentTarget, function (o) { this.get_node(o, true).children('.jstree-anchor').focus(); });
								}
								else if (this.is_open(e.currentTarget)) {
									o = this.get_node(e.currentTarget, true).children('.jstree-children')[0];
									if(o) { $(this._firstChild(o)).children('.jstree-anchor').focus(); }
								}
								break;
							case 40: // down
								e.preventDefault();
								o = this.get_next_dom(e.currentTarget);
								if(o && o.length) { o.children('.jstree-anchor').focus(); }
								break;
							case 106: // aria defines * on numpad as open_all - not very common
								this.open_all();
								break;
							case 36: // home
								e.preventDefault();
								o = this._firstChild(this.get_container_ul()[0]);
								if(o) { $(o).children('.jstree-anchor').filter(':visible').focus(); }
								break;
							case 35: // end
								e.preventDefault();
								this.element.find('.jstree-anchor').filter(':visible').last().focus();
								break;
							/*
							// delete
							case 46:
								e.preventDefault();
								o = this.get_node(e.currentTarget);
								if(o && o.id && o.id !== '#') {
									o = this.is_selected(o) ? this.get_selected() : o;
									this.delete_node(o);
								}
								break;
							// f2
							case 113:
								e.preventDefault();
								o = this.get_node(e.currentTarget);
								if(o && o.id && o.id !== '#') {
									// this.edit(o);
								}
								break;
							default:
								// console.log(e.which);
								break;
							*/
						}
					}, this))
				.on("load_node.jstree", $.proxy(function (e, data) {
						if(data.status) {
							if(data.node.id === '#' && !this._data.core.loaded) {
								this._data.core.loaded = true;
								if(this._firstChild(this.get_container_ul()[0])) {
									this.element.attr('aria-activedescendant',this._firstChild(this.get_container_ul()[0]).id);
								}
								/**
								 * triggered after the root node is loaded for the first time
								 * @event
								 * @name loaded.jstree
								 */
								this.trigger("loaded");
							}
							if(!this._data.core.ready && !this.get_container_ul().find('.jstree-loading').length) {
								this._data.core.ready = true;
								if(this._data.core.selected.length) {
									if(this.settings.core.expand_selected_onload) {
										var tmp = [], i, j;
										for(i = 0, j = this._data.core.selected.length; i < j; i++) {
											tmp = tmp.concat(this._model.data[this._data.core.selected[i]].parents);
										}
										tmp = $.vakata.array_unique(tmp);
										for(i = 0, j = tmp.length; i < j; i++) {
											this.open_node(tmp[i], false, 0);
										}
									}
									this.trigger('changed', { 'action' : 'ready', 'selected' : this._data.core.selected });
								}
								/**
								 * triggered after all nodes are finished loading
								 * @event
								 * @name ready.jstree
								 */
								setTimeout($.proxy(function () { this.trigger("ready"); }, this), 0);
							}
						}
					}, this))
				// quick searching when the tree is focused
				.on('keypress.jstree', $.proxy(function (e) {
						if(e.target.tagName === "INPUT") { return true; }
						if(tout) { clearTimeout(tout); }
						tout = setTimeout(function () {
							word = '';
						}, 500);

						var chr = String.fromCharCode(e.which).toLowerCase(),
							col = this.element.find('.jstree-anchor').filter(':visible'),
							ind = col.index(document.activeElement) || 0,
							end = false;
						word += chr;

						// match for whole word from current node down (including the current node)
						if(word.length > 1) {
							col.slice(ind).each($.proxy(function (i, v) {
								if($(v).text().toLowerCase().indexOf(word) === 0) {
									$(v).focus();
									end = true;
									return false;
								}
							}, this));
							if(end) { return; }

							// match for whole word from the beginning of the tree
							col.slice(0, ind).each($.proxy(function (i, v) {
								if($(v).text().toLowerCase().indexOf(word) === 0) {
									$(v).focus();
									end = true;
									return false;
								}
							}, this));
							if(end) { return; }
						}
						// list nodes that start with that letter (only if word consists of a single char)
						if(new RegExp('^' + chr + '+$').test(word)) {
							// search for the next node starting with that letter
							col.slice(ind + 1).each($.proxy(function (i, v) {
								if($(v).text().toLowerCase().charAt(0) === chr) {
									$(v).focus();
									end = true;
									return false;
								}
							}, this));
							if(end) { return; }

							// search from the beginning
							col.slice(0, ind + 1).each($.proxy(function (i, v) {
								if($(v).text().toLowerCase().charAt(0) === chr) {
									$(v).focus();
									end = true;
									return false;
								}
							}, this));
							if(end) { return; }
						}
					}, this))
				// THEME RELATED
				.on("init.jstree", $.proxy(function () {
						var s = this.settings.core.themes;
						this._data.core.themes.dots			= s.dots;
						this._data.core.themes.stripes		= s.stripes;
						this._data.core.themes.icons		= s.icons;
						this.set_theme(s.name || "default", s.url);
						this.set_theme_variant(s.variant);
					}, this))
				.on("loading.jstree", $.proxy(function () {
						this[ this._data.core.themes.dots ? "show_dots" : "hide_dots" ]();
						this[ this._data.core.themes.icons ? "show_icons" : "hide_icons" ]();
						this[ this._data.core.themes.stripes ? "show_stripes" : "hide_stripes" ]();
					}, this))
				.on('blur.jstree', '.jstree-anchor', $.proxy(function (e) {
						this._data.core.focused = null;
						$(e.currentTarget).filter('.jstree-hovered').mouseleave();
					}, this))
				.on('focus.jstree', '.jstree-anchor', $.proxy(function (e) {
						var tmp = this.get_node(e.currentTarget);
						if(tmp && tmp.id) {
							this._data.core.focused = tmp.id;
						}
						this.element.find('.jstree-hovered').not(e.currentTarget).mouseleave();
						$(e.currentTarget).mouseenter();
					}, this))
				.on('focus.jstree', $.proxy(function () {
						if(!this._data.core.focused) {
							this.get_node(this.element.attr('aria-activedescendant'), true).find('> .jstree-anchor').focus();
						}
					}, this))
				.on('mouseenter.jstree', '.jstree-anchor', $.proxy(function (e) {
						this.hover_node(e.currentTarget);
					}, this))
				.on('mouseleave.jstree', '.jstree-anchor', $.proxy(function (e) {
						this.dehover_node(e.currentTarget);
					}, this));
		},
		/**
		 * part of the destroying of an instance. Used internally.
		 * @private
		 * @name unbind()
		 */
		unbind : function () {
			this.element.off('.jstree');
			$(document).off('.jstree-' + this._id);
		},
		/**
		 * trigger an event. Used internally.
		 * @private
		 * @name trigger(ev [, data])
		 * @param  {String} ev the name of the event to trigger
		 * @param  {Object} data additional data to pass with the event
		 */
		trigger : function (ev, data) {
			if(!data) {
				data = {};
			}
			data.instance = this;
			this.element.triggerHandler(ev.replace('.jstree','') + '.jstree', data);
		},
		/**
		 * returns the jQuery extended instance container
		 * @name get_container()
		 * @return {jQuery}
		 */
		get_container : function () {
			return this.element;
		},
		/**
		 * returns the jQuery extended main UL node inside the instance container. Used internally.
		 * @private
		 * @name get_container_ul()
		 * @return {jQuery}
		 */
		get_container_ul : function () {
			return this.element.children(".jstree-children").first();
		},
		/**
		 * gets string replacements (localization). Used internally.
		 * @private
		 * @name get_string(key)
		 * @param  {String} key
		 * @return {String}
		 */
		get_string : function (key) {
			var a = this.settings.core.strings;
			if($.isFunction(a)) { return a.call(this, key); }
			if(a && a[key]) { return a[key]; }
			return key;
		},
		/**
		 * gets the first child of a DOM node. Used internally.
		 * @private
		 * @name _firstChild(dom)
		 * @param  {DOMElement} dom
		 * @return {DOMElement}
		 */
		_firstChild : function (dom) {
			dom = dom ? dom.firstChild : null;
			while(dom !== null && dom.nodeType !== 1) {
				dom = dom.nextSibling;
			}
			return dom;
		},
		/**
		 * gets the next sibling of a DOM node. Used internally.
		 * @private
		 * @name _nextSibling(dom)
		 * @param  {DOMElement} dom
		 * @return {DOMElement}
		 */
		_nextSibling : function (dom) {
			dom = dom ? dom.nextSibling : null;
			while(dom !== null && dom.nodeType !== 1) {
				dom = dom.nextSibling;
			}
			return dom;
		},
		/**
		 * gets the previous sibling of a DOM node. Used internally.
		 * @private
		 * @name _previousSibling(dom)
		 * @param  {DOMElement} dom
		 * @return {DOMElement}
		 */
		_previousSibling : function (dom) {
			dom = dom ? dom.previousSibling : null;
			while(dom !== null && dom.nodeType !== 1) {
				dom = dom.previousSibling;
			}
			return dom;
		},
		/**
		 * get the JSON representation of a node (or the actual jQuery extended DOM node) by using any input (child DOM element, ID string, selector, etc)
		 * @name get_node(obj [, as_dom])
		 * @param  {mixed} obj
		 * @param  {Boolean} as_dom
		 * @return {Object|jQuery}
		 */
		get_node : function (obj, as_dom) {
			if(obj && obj.id) {
				obj = obj.id;
			}
			var dom;
			try {
				if(this._model.data[obj]) {
					obj = this._model.data[obj];
				}
				else if(typeof obj === "string" && this._model.data[obj.replace(/^#/, '')]) {
					obj = this._model.data[obj.replace(/^#/, '')];
				}
				else if(typeof obj === "string" && (dom = $('#' + obj.replace($.jstree.idregex,'\\$&'), this.element)).length && this._model.data[dom.closest('.jstree-node').attr('id')]) {
					obj = this._model.data[dom.closest('.jstree-node').attr('id')];
				}
				else if((dom = $(obj, this.element)).length && this._model.data[dom.closest('.jstree-node').attr('id')]) {
					obj = this._model.data[dom.closest('.jstree-node').attr('id')];
				}
				else if((dom = $(obj, this.element)).length && dom.hasClass('jstree')) {
					obj = this._model.data['#'];
				}
				else {
					return false;
				}

				if(as_dom) {
					obj = obj.id === '#' ? this.element : $('#' + obj.id.replace($.jstree.idregex,'\\$&'), this.element);
				}
				return obj;
			} catch (ex) { return false; }
		},
		/**
		 * get the path to a node, either consisting of node texts, or of node IDs, optionally glued together (otherwise an array)
		 * @name get_path(obj [, glue, ids])
		 * @param  {mixed} obj the node
		 * @param  {String} glue if you want the path as a string - pass the glue here (for example '/'), if a falsy value is supplied here, an array is returned
		 * @param  {Boolean} ids if set to true build the path using ID, otherwise node text is used
		 * @return {mixed}
		 */
		get_path : function (obj, glue, ids) {
			obj = obj.parents ? obj : this.get_node(obj);
			if(!obj || obj.id === '#' || !obj.parents) {
				return false;
			}
			var i, j, p = [];
			p.push(ids ? obj.id : obj.text);
			for(i = 0, j = obj.parents.length; i < j; i++) {
				p.push(ids ? obj.parents[i] : this.get_text(obj.parents[i]));
			}
			p = p.reverse().slice(1);
			return glue ? p.join(glue) : p;
		},
		/**
		 * get the next visible node that is below the `obj` node. If `strict` is set to `true` only sibling nodes are returned.
		 * @name get_next_dom(obj [, strict])
		 * @param  {mixed} obj
		 * @param  {Boolean} strict
		 * @return {jQuery}
		 */
		get_next_dom : function (obj, strict) {
			var tmp;
			obj = this.get_node(obj, true);
			if(obj[0] === this.element[0]) {
				tmp = this._firstChild(this.get_container_ul()[0]);
				while (tmp && tmp.offsetHeight === 0) {
					tmp = this._nextSibling(tmp);
				}
				return tmp ? $(tmp) : false;
			}
			if(!obj || !obj.length) {
				return false;
			}
			if(strict) {
				tmp = obj[0];
				do {
					tmp = this._nextSibling(tmp);
				} while (tmp && tmp.offsetHeight === 0);
				return tmp ? $(tmp) : false;
			}
			if(obj.hasClass("jstree-open")) {
				tmp = this._firstChild(obj.children('.jstree-children')[0]);
				while (tmp && tmp.offsetHeight === 0) {
					tmp = this._nextSibling(tmp);
				}
				if(tmp !== null) {
					return $(tmp);
				}
			}
			tmp = obj[0];
			do {
				tmp = this._nextSibling(tmp);
			} while (tmp && tmp.offsetHeight === 0);
			if(tmp !== null) {
				return $(tmp);
			}
			return obj.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first();
		},
		/**
		 * get the previous visible node that is above the `obj` node. If `strict` is set to `true` only sibling nodes are returned.
		 * @name get_prev_dom(obj [, strict])
		 * @param  {mixed} obj
		 * @param  {Boolean} strict
		 * @return {jQuery}
		 */
		get_prev_dom : function (obj, strict) {
			var tmp;
			obj = this.get_node(obj, true);
			if(obj[0] === this.element[0]) {
				tmp = this.get_container_ul()[0].lastChild;
				while (tmp && tmp.offsetHeight === 0) {
					tmp = this._previousSibling(tmp);
				}
				return tmp ? $(tmp) : false;
			}
			if(!obj || !obj.length) {
				return false;
			}
			if(strict) {
				tmp = obj[0];
				do {
					tmp = this._previousSibling(tmp);
				} while (tmp && tmp.offsetHeight === 0);
				return tmp ? $(tmp) : false;
			}
			tmp = obj[0];
			do {
				tmp = this._previousSibling(tmp);
			} while (tmp && tmp.offsetHeight === 0);
			if(tmp !== null) {
				obj = $(tmp);
				while(obj.hasClass("jstree-open")) {
					obj = obj.children(".jstree-children").first().children(".jstree-node:visible:last");
				}
				return obj;
			}
			tmp = obj[0].parentNode.parentNode;
			return tmp && tmp.className && tmp.className.indexOf('jstree-node') !== -1 ? $(tmp) : false;
		},
		/**
		 * get the parent ID of a node
		 * @name get_parent(obj)
		 * @param  {mixed} obj
		 * @return {String}
		 */
		get_parent : function (obj) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			return obj.parent;
		},
		/**
		 * get a jQuery collection of all the children of a node (node must be rendered)
		 * @name get_children_dom(obj)
		 * @param  {mixed} obj
		 * @return {jQuery}
		 */
		get_children_dom : function (obj) {
			obj = this.get_node(obj, true);
			if(obj[0] === this.element[0]) {
				return this.get_container_ul().children(".jstree-node");
			}
			if(!obj || !obj.length) {
				return false;
			}
			return obj.children(".jstree-children").children(".jstree-node");
		},
		/**
		 * checks if a node has children
		 * @name is_parent(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_parent : function (obj) {
			obj = this.get_node(obj);
			return obj && (obj.state.loaded === false || obj.children.length > 0);
		},
		/**
		 * checks if a node is loaded (its children are available)
		 * @name is_loaded(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_loaded : function (obj) {
			obj = this.get_node(obj);
			return obj && obj.state.loaded;
		},
		/**
		 * check if a node is currently loading (fetching children)
		 * @name is_loading(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_loading : function (obj) {
			obj = this.get_node(obj);
			return obj && obj.state && obj.state.loading;
		},
		/**
		 * check if a node is opened
		 * @name is_open(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_open : function (obj) {
			obj = this.get_node(obj);
			return obj && obj.state.opened;
		},
		/**
		 * check if a node is in a closed state
		 * @name is_closed(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_closed : function (obj) {
			obj = this.get_node(obj);
			return obj && this.is_parent(obj) && !obj.state.opened;
		},
		/**
		 * check if a node has no children
		 * @name is_leaf(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_leaf : function (obj) {
			return !this.is_parent(obj);
		},
		/**
		 * loads a node (fetches its children using the `core.data` setting). Multiple nodes can be passed to by using an array.
		 * @name load_node(obj [, callback])
		 * @param  {mixed} obj
		 * @param  {function} callback a function to be executed once loading is complete, the function is executed in the instance's scope and receives two arguments - the node and a boolean status
		 * @return {Boolean}
		 * @trigger load_node.jstree
		 */
		load_node : function (obj, callback) {
			var k, l, i, j, c;
			if($.isArray(obj)) {
				this._load_nodes(obj.slice(), callback);
				return true;
			}
			obj = this.get_node(obj);
			if(!obj) {
				if(callback) { callback.call(this, obj, false); }
				return false;
			}
			// if(obj.state.loading) { } // the node is already loading - just wait for it to load and invoke callback? but if called implicitly it should be loaded again?
			if(obj.state.loaded) {
				obj.state.loaded = false;
				for(k = 0, l = obj.children_d.length; k < l; k++) {
					for(i = 0, j = obj.parents.length; i < j; i++) {
						this._model.data[obj.parents[i]].children_d = $.vakata.array_remove_item(this._model.data[obj.parents[i]].children_d, obj.children_d[k]);
					}
					if(this._model.data[obj.children_d[k]].state.selected) {
						c = true;
						this._data.core.selected = $.vakata.array_remove_item(this._data.core.selected, obj.children_d[k]);
					}
					delete this._model.data[obj.children_d[k]];
				}
				obj.children = [];
				obj.children_d = [];
				if(c) {
					this.trigger('changed', { 'action' : 'load_node', 'node' : obj, 'selected' : this._data.core.selected });
				}
			}
			obj.state.loading = true;
			this.get_node(obj, true).addClass("jstree-loading").attr('aria-busy',true);
			this._load_node(obj, $.proxy(function (status) {
				obj = this._model.data[obj.id];
				obj.state.loading = false;
				obj.state.loaded = status;
				var dom = this.get_node(obj, true);
				if(obj.state.loaded && !obj.children.length && dom && dom.length && !dom.hasClass('jstree-leaf')) {
					dom.removeClass('jstree-closed jstree-open').addClass('jstree-leaf');
				}
				dom.removeClass("jstree-loading").attr('aria-busy',false);
				/**
				 * triggered after a node is loaded
				 * @event
				 * @name load_node.jstree
				 * @param {Object} node the node that was loading
				 * @param {Boolean} status was the node loaded successfully
				 */
				this.trigger('load_node', { "node" : obj, "status" : status });
				if(callback) {
					callback.call(this, obj, status);
				}
			}, this));
			return true;
		},
		/**
		 * load an array of nodes (will also load unavailable nodes as soon as the appear in the structure). Used internally.
		 * @private
		 * @name _load_nodes(nodes [, callback])
		 * @param  {array} nodes
		 * @param  {function} callback a function to be executed once loading is complete, the function is executed in the instance's scope and receives one argument - the array passed to _load_nodes
		 */
		_load_nodes : function (nodes, callback, is_callback) {
			var r = true,
				c = function () { this._load_nodes(nodes, callback, true); },
				m = this._model.data, i, j;
			for(i = 0, j = nodes.length; i < j; i++) {
				if(m[nodes[i]] && (!m[nodes[i]].state.loaded || !is_callback)) {
					if(!this.is_loading(nodes[i])) {
						this.load_node(nodes[i], c);
					}
					r = false;
				}
			}
			if(r) {
				if(callback && !callback.done) {
					callback.call(this, nodes);
					callback.done = true;
				}
			}
		},
		/**
		 * loads all unloaded nodes
		 * @name load_all([obj, callback])
		 * @param {mixed} obj the node to load recursively, omit to load all nodes in the tree
		 * @param {function} callback a function to be executed once loading all the nodes is complete,
		 * @trigger load_all.jstree
		 */
		load_all : function (obj, callback) {
			if(!obj) { obj = '#'; }
			obj = this.get_node(obj);
			if(!obj) { return false; }
			var to_load = [],
				m = this._model.data,
				c = m[obj.id].children_d,
				i, j;
			if(obj.state && !obj.state.loaded) {
				to_load.push(obj.id);
			}
			for(i = 0, j = c.length; i < j; i++) {
				if(m[c[i]] && m[c[i]].state && !m[c[i]].state.loaded) {
					to_load.push(c[i]);
				}
			}
			if(to_load.length) {
				this._load_nodes(to_load, function () {
					this.load_all(obj, callback);
				});
			}
			else {
				/**
				 * triggered after a load_all call completes
				 * @event
				 * @name load_all.jstree
				 * @param {Object} node the recursively loaded node
				 */
				if(callback) { callback.call(this, obj); }
				this.trigger('load_all', { "node" : obj });
			}
		},
		/**
		 * handles the actual loading of a node. Used only internally.
		 * @private
		 * @name _load_node(obj [, callback])
		 * @param  {mixed} obj
		 * @param  {function} callback a function to be executed once loading is complete, the function is executed in the instance's scope and receives one argument - a boolean status
		 * @return {Boolean}
		 */
		_load_node : function (obj, callback) {
			var s = this.settings.core.data, t;
			// use original HTML
			if(!s) {
				if(obj.id === '#') {
					return this._append_html_data(obj, this._data.core.original_container_html.clone(true), function (status) {
						callback.call(this, status);
					});
				}
				else {
					return callback.call(this, false);
				}
				// return callback.call(this, obj.id === '#' ? this._append_html_data(obj, this._data.core.original_container_html.clone(true)) : false);
			}
			if($.isFunction(s)) {
				return s.call(this, obj, $.proxy(function (d) {
					if(d === false) {
						callback.call(this, false);
					}
					this[typeof d === 'string' ? '_append_html_data' : '_append_json_data'](obj, typeof d === 'string' ? $(d) : d, function (status) {
						callback.call(this, status);
					});
					// return d === false ? callback.call(this, false) : callback.call(this, this[typeof d === 'string' ? '_append_html_data' : '_append_json_data'](obj, typeof d === 'string' ? $(d) : d));
				}, this));
			}
			if(typeof s === 'object') {
				if(s.url) {
					s = $.extend(true, {}, s);
					if($.isFunction(s.url)) {
						s.url = s.url.call(this, obj);
					}
					if($.isFunction(s.data)) {
						s.data = s.data.call(this, obj);
					}
					return $.ajax(s)
						.done($.proxy(function (d,t,x) {
								var type = x.getResponseHeader('Content-Type');
								if(type.indexOf('json') !== -1 || typeof d === "object") {
									return this._append_json_data(obj, d, function (status) { callback.call(this, status); });
									//return callback.call(this, this._append_json_data(obj, d));
								}
								if(type.indexOf('html') !== -1 || typeof d === "string") {
									return this._append_html_data(obj, $(d), function (status) { callback.call(this, status); });
									// return callback.call(this, this._append_html_data(obj, $(d)));
								}
								this._data.core.last_error = { 'error' : 'ajax', 'plugin' : 'core', 'id' : 'core_04', 'reason' : 'Could not load node', 'data' : JSON.stringify({ 'id' : obj.id, 'xhr' : x }) };
								this.settings.core.error.call(this, this._data.core.last_error);
								return callback.call(this, false);
							}, this))
						.fail($.proxy(function (f) {
								callback.call(this, false);
								this._data.core.last_error = { 'error' : 'ajax', 'plugin' : 'core', 'id' : 'core_04', 'reason' : 'Could not load node', 'data' : JSON.stringify({ 'id' : obj.id, 'xhr' : f }) };
								this.settings.core.error.call(this, this._data.core.last_error);
							}, this));
				}
				t = ($.isArray(s) || $.isPlainObject(s)) ? JSON.parse(JSON.stringify(s)) : s;
				if(obj.id === '#') {
					return this._append_json_data(obj, t, function (status) {
						callback.call(this, status);
					});
				}
				else {
					this._data.core.last_error = { 'error' : 'nodata', 'plugin' : 'core', 'id' : 'core_05', 'reason' : 'Could not load node', 'data' : JSON.stringify({ 'id' : obj.id }) };
					this.settings.core.error.call(this, this._data.core.last_error);
					return callback.call(this, false);
				}
				//return callback.call(this, (obj.id === "#" ? this._append_json_data(obj, t) : false) );
			}
			if(typeof s === 'string') {
				if(obj.id === '#') {
					return this._append_html_data(obj, $(s), function (status) {
						callback.call(this, status);
					});
				}
				else {
					this._data.core.last_error = { 'error' : 'nodata', 'plugin' : 'core', 'id' : 'core_06', 'reason' : 'Could not load node', 'data' : JSON.stringify({ 'id' : obj.id }) };
					this.settings.core.error.call(this, this._data.core.last_error);
					return callback.call(this, false);
				}
				//return callback.call(this, (obj.id === "#" ? this._append_html_data(obj, $(s)) : false) );
			}
			return callback.call(this, false);
		},
		/**
		 * adds a node to the list of nodes to redraw. Used only internally.
		 * @private
		 * @name _node_changed(obj [, callback])
		 * @param  {mixed} obj
		 */
		_node_changed : function (obj) {
			obj = this.get_node(obj);
			if(obj) {
				this._model.changed.push(obj.id);
			}
		},
		/**
		 * appends HTML content to the tree. Used internally.
		 * @private
		 * @name _append_html_data(obj, data)
		 * @param  {mixed} obj the node to append to
		 * @param  {String} data the HTML string to parse and append
		 * @trigger model.jstree, changed.jstree
		 */
		_append_html_data : function (dom, data, cb) {
			dom = this.get_node(dom);
			dom.children = [];
			dom.children_d = [];
			var dat = data.is('ul') ? data.children() : data,
				par = dom.id,
				chd = [],
				dpc = [],
				m = this._model.data,
				p = m[par],
				s = this._data.core.selected.length,
				tmp, i, j;
			dat.each($.proxy(function (i, v) {
				tmp = this._parse_model_from_html($(v), par, p.parents.concat());
				if(tmp) {
					chd.push(tmp);
					dpc.push(tmp);
					if(m[tmp].children_d.length) {
						dpc = dpc.concat(m[tmp].children_d);
					}
				}
			}, this));
			p.children = chd;
			p.children_d = dpc;
			for(i = 0, j = p.parents.length; i < j; i++) {
				m[p.parents[i]].children_d = m[p.parents[i]].children_d.concat(dpc);
			}
			/**
			 * triggered when new data is inserted to the tree model
			 * @event
			 * @name model.jstree
			 * @param {Array} nodes an array of node IDs
			 * @param {String} parent the parent ID of the nodes
			 */
			this.trigger('model', { "nodes" : dpc, 'parent' : par });
			if(par !== '#') {
				this._node_changed(par);
				this.redraw();
			}
			else {
				this.get_container_ul().children('.jstree-initial-node').remove();
				this.redraw(true);
			}
			if(this._data.core.selected.length !== s) {
				this.trigger('changed', { 'action' : 'model', 'selected' : this._data.core.selected });
			}
			cb.call(this, true);
		},
		/**
		 * appends JSON content to the tree. Used internally.
		 * @private
		 * @name _append_json_data(obj, data)
		 * @param  {mixed} obj the node to append to
		 * @param  {String} data the JSON object to parse and append
		 * @param  {Boolean} force_processing internal param - do not set
		 * @trigger model.jstree, changed.jstree
		 */
		_append_json_data : function (dom, data, cb, force_processing) {
			dom = this.get_node(dom);
			dom.children = [];
			dom.children_d = [];
			// *%$@!!!
			if(data.d) {
				data = data.d;
				if(typeof data === "string") {
					data = JSON.parse(data);
				}
			}
			if(!$.isArray(data)) { data = [data]; }
			var w = null,
				args = {
					'df'	: this._model.default_state,
					'dat'	: data,
					'par'	: dom.id,
					'm'		: this._model.data,
					't_id'	: this._id,
					't_cnt'	: this._cnt,
					'sel'	: this._data.core.selected
				},
				func = function (data, undefined) {
					if(data.data) { data = data.data; }
					var dat = data.dat,
						par = data.par,
						chd = [],
						dpc = [],
						add = [],
						df = data.df,
						t_id = data.t_id,
						t_cnt = data.t_cnt,
						m = data.m,
						p = m[par],
						sel = data.sel,
						tmp, i, j, rslt,
						parse_flat = function (d, p, ps) {
							if(!ps) { ps = []; }
							else { ps = ps.concat(); }
							if(p) { ps.unshift(p); }
							var tid = d.id.toString(),
								i, j, c, e,
								tmp = {
									id			: tid,
									text		: d.text || '',
									icon		: d.icon !== undefined ? d.icon : true,
									parent		: p,
									parents		: ps,
									children	: d.children || [],
									children_d	: d.children_d || [],
									data		: d.data,
									state		: { },
									li_attr		: { id : false },
									a_attr		: { href : '#' },
									original	: false
								};
							for(i in df) {
								if(df.hasOwnProperty(i)) {
									tmp.state[i] = df[i];
								}
							}
							if(d && d.data && d.data.jstree && d.data.jstree.icon) {
								tmp.icon = d.data.jstree.icon;
							}
							if(d && d.data) {
								tmp.data = d.data;
								if(d.data.jstree) {
									for(i in d.data.jstree) {
										if(d.data.jstree.hasOwnProperty(i)) {
											tmp.state[i] = d.data.jstree[i];
										}
									}
								}
							}
							if(d && typeof d.state === 'object') {
								for (i in d.state) {
									if(d.state.hasOwnProperty(i)) {
										tmp.state[i] = d.state[i];
									}
								}
							}
							if(d && typeof d.li_attr === 'object') {
								for (i in d.li_attr) {
									if(d.li_attr.hasOwnProperty(i)) {
										tmp.li_attr[i] = d.li_attr[i];
									}
								}
							}
							if(!tmp.li_attr.id) {
								tmp.li_attr.id = tid;
							}
							if(d && typeof d.a_attr === 'object') {
								for (i in d.a_attr) {
									if(d.a_attr.hasOwnProperty(i)) {
										tmp.a_attr[i] = d.a_attr[i];
									}
								}
							}
							if(d && d.children && d.children === true) {
								tmp.state.loaded = false;
								tmp.children = [];
								tmp.children_d = [];
							}
							m[tmp.id] = tmp;
							for(i = 0, j = tmp.children.length; i < j; i++) {
								c = parse_flat(m[tmp.children[i]], tmp.id, ps);
								e = m[c];
								tmp.children_d.push(c);
								if(e.children_d.length) {
									tmp.children_d = tmp.children_d.concat(e.children_d);
								}
							}
							delete d.data;
							delete d.children;
							m[tmp.id].original = d;
							if(tmp.state.selected) {
								add.push(tmp.id);
							}
							return tmp.id;
						},
						parse_nest = function (d, p, ps) {
							if(!ps) { ps = []; }
							else { ps = ps.concat(); }
							if(p) { ps.unshift(p); }
							var tid = false, i, j, c, e, tmp;
							do {
								tid = 'j' + t_id + '_' + (++t_cnt);
							} while(m[tid]);

							tmp = {
								id			: false,
								text		: typeof d === 'string' ? d : '',
								icon		: typeof d === 'object' && d.icon !== undefined ? d.icon : true,
								parent		: p,
								parents		: ps,
								children	: [],
								children_d	: [],
								data		: null,
								state		: { },
								li_attr		: { id : false },
								a_attr		: { href : '#' },
								original	: false
							};
							for(i in df) {
								if(df.hasOwnProperty(i)) {
									tmp.state[i] = df[i];
								}
							}
							if(d && d.id) { tmp.id = d.id.toString(); }
							if(d && d.text) { tmp.text = d.text; }
							if(d && d.data && d.data.jstree && d.data.jstree.icon) {
								tmp.icon = d.data.jstree.icon;
							}
							if(d && d.data) {
								tmp.data = d.data;
								if(d.data.jstree) {
									for(i in d.data.jstree) {
										if(d.data.jstree.hasOwnProperty(i)) {
											tmp.state[i] = d.data.jstree[i];
										}
									}
								}
							}
							if(d && typeof d.state === 'object') {
								for (i in d.state) {
									if(d.state.hasOwnProperty(i)) {
										tmp.state[i] = d.state[i];
									}
								}
							}
							if(d && typeof d.li_attr === 'object') {
								for (i in d.li_attr) {
									if(d.li_attr.hasOwnProperty(i)) {
										tmp.li_attr[i] = d.li_attr[i];
									}
								}
							}
							if(tmp.li_attr.id && !tmp.id) {
								tmp.id = tmp.li_attr.id.toString();
							}
							if(!tmp.id) {
								tmp.id = tid;
							}
							if(!tmp.li_attr.id) {
								tmp.li_attr.id = tmp.id;
							}
							if(d && typeof d.a_attr === 'object') {
								for (i in d.a_attr) {
									if(d.a_attr.hasOwnProperty(i)) {
										tmp.a_attr[i] = d.a_attr[i];
									}
								}
							}
							if(d && d.children && d.children.length) {
								for(i = 0, j = d.children.length; i < j; i++) {
									c = parse_nest(d.children[i], tmp.id, ps);
									e = m[c];
									tmp.children.push(c);
									if(e.children_d.length) {
										tmp.children_d = tmp.children_d.concat(e.children_d);
									}
								}
								tmp.children_d = tmp.children_d.concat(tmp.children);
							}
							if(d && d.children && d.children === true) {
								tmp.state.loaded = false;
								tmp.children = [];
								tmp.children_d = [];
							}
							delete d.data;
							delete d.children;
							tmp.original = d;
							m[tmp.id] = tmp;
							if(tmp.state.selected) {
								add.push(tmp.id);
							}
							return tmp.id;
						};

					if(dat.length && dat[0].id !== undefined && dat[0].parent !== undefined) {
						// Flat JSON support (for easy import from DB):
						// 1) convert to object (foreach)
						for(i = 0, j = dat.length; i < j; i++) {
							if(!dat[i].children) {
								dat[i].children = [];
							}
							m[dat[i].id.toString()] = dat[i];
						}
						// 2) populate children (foreach)
						for(i = 0, j = dat.length; i < j; i++) {
							m[dat[i].parent.toString()].children.push(dat[i].id.toString());
							// populate parent.children_d
							p.children_d.push(dat[i].id.toString());
						}
						// 3) normalize && populate parents and children_d with recursion
						for(i = 0, j = p.children.length; i < j; i++) {
							tmp = parse_flat(m[p.children[i]], par, p.parents.concat());
							dpc.push(tmp);
							if(m[tmp].children_d.length) {
								dpc = dpc.concat(m[tmp].children_d);
							}
						}
						for(i = 0, j = p.parents.length; i < j; i++) {
							m[p.parents[i]].children_d = m[p.parents[i]].children_d.concat(dpc);
						}
						// ?) three_state selection - p.state.selected && t - (if three_state foreach(dat => ch) -> foreach(parents) if(parent.selected) child.selected = true;
						rslt = {
							'cnt' : t_cnt,
							'mod' : m,
							'sel' : sel,
							'par' : par,
							'dpc' : dpc,
							'add' : add
						};
					}
					else {
						for(i = 0, j = dat.length; i < j; i++) {
							tmp = parse_nest(dat[i], par, p.parents.concat());
							if(tmp) {
								chd.push(tmp);
								dpc.push(tmp);
								if(m[tmp].children_d.length) {
									dpc = dpc.concat(m[tmp].children_d);
								}
							}
						}
						p.children = chd;
						p.children_d = dpc;
						for(i = 0, j = p.parents.length; i < j; i++) {
							m[p.parents[i]].children_d = m[p.parents[i]].children_d.concat(dpc);
						}
						rslt = {
							'cnt' : t_cnt,
							'mod' : m,
							'sel' : sel,
							'par' : par,
							'dpc' : dpc,
							'add' : add
						};
					}
					if(typeof window === 'undefined' || typeof window.document === 'undefined') {
						postMessage(rslt);
					}
					else {
						return rslt;
					}
				},
				rslt = function (rslt, worker) {
					this._cnt = rslt.cnt;
					this._model.data = rslt.mod; // breaks the reference in load_node - careful

					if(worker) {
						var i, j, a = rslt.add, r = rslt.sel, s = this._data.core.selected.slice(), m = this._model.data;
						// if selection was changed while calculating in worker
						if(r.length !== s.length || $.vakata.array_unique(r.concat(s)).length !== r.length) {
							// deselect nodes that are no longer selected
							for(i = 0, j = r.length; i < j; i++) {
								if($.inArray(r[i], a) === -1 && $.inArray(r[i], s) === -1) {
									m[r[i]].state.selected = false;
								}
							}
							// select nodes that were selected in the mean time
							for(i = 0, j = s.length; i < j; i++) {
								if($.inArray(s[i], r) === -1) {
									m[s[i]].state.selected = true;
								}
							}
						}
					}
					if(rslt.add.length) {
						this._data.core.selected = this._data.core.selected.concat(rslt.add);
					}

					this.trigger('model', { "nodes" : rslt.dpc, 'parent' : rslt.par });

					if(rslt.par !== '#') {
						this._node_changed(rslt.par);
						this.redraw();
					}
					else {
						// this.get_container_ul().children('.jstree-initial-node').remove();
						this.redraw(true);
					}
					if(rslt.add.length) {
						this.trigger('changed', { 'action' : 'model', 'selected' : this._data.core.selected });
					}
					cb.call(this, true);
				};
			if(this.settings.core.worker && window.Blob && window.URL && window.Worker) {
				try {
					if(this._wrk === null) {
						this._wrk = window.URL.createObjectURL(
							new window.Blob(
								['self.onmessage = ' + func.toString()],
								{type:"text/javascript"}
							)
						);
					}
					if(!this._data.core.working || force_processing) {
						this._data.core.working = true;
						w = new window.Worker(this._wrk);
						w.onmessage = $.proxy(function (e) {
							rslt.call(this, e.data, true);
							try { w.terminate(); w = null; } catch(ignore) { }
							if(this._data.core.worker_queue.length) {
								this._append_json_data.apply(this, this._data.core.worker_queue.shift());
							}
							else {
								this._data.core.working = false;
							}
						}, this);
						if(!args.par) {
							if(this._data.core.worker_queue.length) {
								this._append_json_data.apply(this, this._data.core.worker_queue.shift());
							}
							else {
								this._data.core.working = false;
							}
						}
						else {
							w.postMessage(args);
						}
					}
					else {
						this._data.core.worker_queue.push([dom, data, cb, true]);
					}
				}
				catch(e) {
					rslt.call(this, func(args), false);
					if(this._data.core.worker_queue.length) {
						this._append_json_data.apply(this, this._data.core.worker_queue.shift());
					}
					else {
						this._data.core.working = false;
					}
				}
			}
			else {
				rslt.call(this, func(args), false);
			}
		},
		/**
		 * parses a node from a jQuery object and appends them to the in memory tree model. Used internally.
		 * @private
		 * @name _parse_model_from_html(d [, p, ps])
		 * @param  {jQuery} d the jQuery object to parse
		 * @param  {String} p the parent ID
		 * @param  {Array} ps list of all parents
		 * @return {String} the ID of the object added to the model
		 */
		_parse_model_from_html : function (d, p, ps) {
			if(!ps) { ps = []; }
			else { ps = [].concat(ps); }
			if(p) { ps.unshift(p); }
			var c, e, m = this._model.data,
				data = {
					id			: false,
					text		: false,
					icon		: true,
					parent		: p,
					parents		: ps,
					children	: [],
					children_d	: [],
					data		: null,
					state		: { },
					li_attr		: { id : false },
					a_attr		: { href : '#' },
					original	: false
				}, i, tmp, tid;
			for(i in this._model.default_state) {
				if(this._model.default_state.hasOwnProperty(i)) {
					data.state[i] = this._model.default_state[i];
				}
			}
			tmp = $.vakata.attributes(d, true);
			$.each(tmp, function (i, v) {
				v = $.trim(v);
				if(!v.length) { return true; }
				data.li_attr[i] = v;
				if(i === 'id') {
					data.id = v.toString();
				}
			});
			tmp = d.children('a').first();
			if(tmp.length) {
				tmp = $.vakata.attributes(tmp, true);
				$.each(tmp, function (i, v) {
					v = $.trim(v);
					if(v.length) {
						data.a_attr[i] = v;
					}
				});
			}
			tmp = d.children("a").first().length ? d.children("a").first().clone() : d.clone();
			tmp.children("ins, i, ul").remove();
			tmp = tmp.html();
			tmp = $('<div />').html(tmp);
			data.text = this.settings.core.force_text ? tmp.text() : tmp.html();
			tmp = d.data();
			data.data = tmp ? $.extend(true, {}, tmp) : null;
			data.state.opened = d.hasClass('jstree-open');
			data.state.selected = d.children('a').hasClass('jstree-clicked');
			data.state.disabled = d.children('a').hasClass('jstree-disabled');
			if(data.data && data.data.jstree) {
				for(i in data.data.jstree) {
					if(data.data.jstree.hasOwnProperty(i)) {
						data.state[i] = data.data.jstree[i];
					}
				}
			}
			tmp = d.children("a").children(".jstree-themeicon");
			if(tmp.length) {
				data.icon = tmp.hasClass('jstree-themeicon-hidden') ? false : tmp.attr('rel');
			}
			if(data.state.icon) {
				data.icon = data.state.icon;
			}
			tmp = d.children("ul").children("li");
			do {
				tid = 'j' + this._id + '_' + (++this._cnt);
			} while(m[tid]);
			data.id = data.li_attr.id ? data.li_attr.id.toString() : tid;
			if(tmp.length) {
				tmp.each($.proxy(function (i, v) {
					c = this._parse_model_from_html($(v), data.id, ps);
					e = this._model.data[c];
					data.children.push(c);
					if(e.children_d.length) {
						data.children_d = data.children_d.concat(e.children_d);
					}
				}, this));
				data.children_d = data.children_d.concat(data.children);
			}
			else {
				if(d.hasClass('jstree-closed')) {
					data.state.loaded = false;
				}
			}
			if(data.li_attr['class']) {
				data.li_attr['class'] = data.li_attr['class'].replace('jstree-closed','').replace('jstree-open','');
			}
			if(data.a_attr['class']) {
				data.a_attr['class'] = data.a_attr['class'].replace('jstree-clicked','').replace('jstree-disabled','');
			}
			m[data.id] = data;
			if(data.state.selected) {
				this._data.core.selected.push(data.id);
			}
			return data.id;
		},
		/**
		 * parses a node from a JSON object (used when dealing with flat data, which has no nesting of children, but has id and parent properties) and appends it to the in memory tree model. Used internally.
		 * @private
		 * @name _parse_model_from_flat_json(d [, p, ps])
		 * @param  {Object} d the JSON object to parse
		 * @param  {String} p the parent ID
		 * @param  {Array} ps list of all parents
		 * @return {String} the ID of the object added to the model
		 */
		_parse_model_from_flat_json : function (d, p, ps) {
			if(!ps) { ps = []; }
			else { ps = ps.concat(); }
			if(p) { ps.unshift(p); }
			var tid = d.id.toString(),
				m = this._model.data,
				df = this._model.default_state,
				i, j, c, e,
				tmp = {
					id			: tid,
					text		: d.text || '',
					icon		: d.icon !== undefined ? d.icon : true,
					parent		: p,
					parents		: ps,
					children	: d.children || [],
					children_d	: d.children_d || [],
					data		: d.data,
					state		: { },
					li_attr		: { id : false },
					a_attr		: { href : '#' },
					original	: false
				};
			for(i in df) {
				if(df.hasOwnProperty(i)) {
					tmp.state[i] = df[i];
				}
			}
			if(d && d.data && d.data.jstree && d.data.jstree.icon) {
				tmp.icon = d.data.jstree.icon;
			}
			if(d && d.data) {
				tmp.data = d.data;
				if(d.data.jstree) {
					for(i in d.data.jstree) {
						if(d.data.jstree.hasOwnProperty(i)) {
							tmp.state[i] = d.data.jstree[i];
						}
					}
				}
			}
			if(d && typeof d.state === 'object') {
				for (i in d.state) {
					if(d.state.hasOwnProperty(i)) {
						tmp.state[i] = d.state[i];
					}
				}
			}
			if(d && typeof d.li_attr === 'object') {
				for (i in d.li_attr) {
					if(d.li_attr.hasOwnProperty(i)) {
						tmp.li_attr[i] = d.li_attr[i];
					}
				}
			}
			if(!tmp.li_attr.id) {
				tmp.li_attr.id = tid;
			}
			if(d && typeof d.a_attr === 'object') {
				for (i in d.a_attr) {
					if(d.a_attr.hasOwnProperty(i)) {
						tmp.a_attr[i] = d.a_attr[i];
					}
				}
			}
			if(d && d.children && d.children === true) {
				tmp.state.loaded = false;
				tmp.children = [];
				tmp.children_d = [];
			}
			m[tmp.id] = tmp;
			for(i = 0, j = tmp.children.length; i < j; i++) {
				c = this._parse_model_from_flat_json(m[tmp.children[i]], tmp.id, ps);
				e = m[c];
				tmp.children_d.push(c);
				if(e.children_d.length) {
					tmp.children_d = tmp.children_d.concat(e.children_d);
				}
			}
			delete d.data;
			delete d.children;
			m[tmp.id].original = d;
			if(tmp.state.selected) {
				this._data.core.selected.push(tmp.id);
			}
			return tmp.id;
		},
		/**
		 * parses a node from a JSON object and appends it to the in memory tree model. Used internally.
		 * @private
		 * @name _parse_model_from_json(d [, p, ps])
		 * @param  {Object} d the JSON object to parse
		 * @param  {String} p the parent ID
		 * @param  {Array} ps list of all parents
		 * @return {String} the ID of the object added to the model
		 */
		_parse_model_from_json : function (d, p, ps) {
			if(!ps) { ps = []; }
			else { ps = ps.concat(); }
			if(p) { ps.unshift(p); }
			var tid = false, i, j, c, e, m = this._model.data, df = this._model.default_state, tmp;
			do {
				tid = 'j' + this._id + '_' + (++this._cnt);
			} while(m[tid]);

			tmp = {
				id			: false,
				text		: typeof d === 'string' ? d : '',
				icon		: typeof d === 'object' && d.icon !== undefined ? d.icon : true,
				parent		: p,
				parents		: ps,
				children	: [],
				children_d	: [],
				data		: null,
				state		: { },
				li_attr		: { id : false },
				a_attr		: { href : '#' },
				original	: false
			};
			for(i in df) {
				if(df.hasOwnProperty(i)) {
					tmp.state[i] = df[i];
				}
			}
			if(d && d.id) { tmp.id = d.id.toString(); }
			if(d && d.text) { tmp.text = d.text; }
			if(d && d.data && d.data.jstree && d.data.jstree.icon) {
				tmp.icon = d.data.jstree.icon;
			}
			if(d && d.data) {
				tmp.data = d.data;
				if(d.data.jstree) {
					for(i in d.data.jstree) {
						if(d.data.jstree.hasOwnProperty(i)) {
							tmp.state[i] = d.data.jstree[i];
						}
					}
				}
			}
			if(d && typeof d.state === 'object') {
				for (i in d.state) {
					if(d.state.hasOwnProperty(i)) {
						tmp.state[i] = d.state[i];
					}
				}
			}
			if(d && typeof d.li_attr === 'object') {
				for (i in d.li_attr) {
					if(d.li_attr.hasOwnProperty(i)) {
						tmp.li_attr[i] = d.li_attr[i];
					}
				}
			}
			if(tmp.li_attr.id && !tmp.id) {
				tmp.id = tmp.li_attr.id.toString();
			}
			if(!tmp.id) {
				tmp.id = tid;
			}
			if(!tmp.li_attr.id) {
				tmp.li_attr.id = tmp.id;
			}
			if(d && typeof d.a_attr === 'object') {
				for (i in d.a_attr) {
					if(d.a_attr.hasOwnProperty(i)) {
						tmp.a_attr[i] = d.a_attr[i];
					}
				}
			}
			if(d && d.children && d.children.length) {
				for(i = 0, j = d.children.length; i < j; i++) {
					c = this._parse_model_from_json(d.children[i], tmp.id, ps);
					e = m[c];
					tmp.children.push(c);
					if(e.children_d.length) {
						tmp.children_d = tmp.children_d.concat(e.children_d);
					}
				}
				tmp.children_d = tmp.children_d.concat(tmp.children);
			}
			if(d && d.children && d.children === true) {
				tmp.state.loaded = false;
				tmp.children = [];
				tmp.children_d = [];
			}
			delete d.data;
			delete d.children;
			tmp.original = d;
			m[tmp.id] = tmp;
			if(tmp.state.selected) {
				this._data.core.selected.push(tmp.id);
			}
			return tmp.id;
		},
		/**
		 * redraws all nodes that need to be redrawn. Used internally.
		 * @private
		 * @name _redraw()
		 * @trigger redraw.jstree
		 */
		_redraw : function () {
			var nodes = this._model.force_full_redraw ? this._model.data['#'].children.concat([]) : this._model.changed.concat([]),
				f = document.createElement('UL'), tmp, i, j, fe = this._data.core.focused;
			for(i = 0, j = nodes.length; i < j; i++) {
				tmp = this.redraw_node(nodes[i], true, this._model.force_full_redraw);
				if(tmp && this._model.force_full_redraw) {
					f.appendChild(tmp);
				}
			}
			if(this._model.force_full_redraw) {
				f.className = this.get_container_ul()[0].className;
				f.setAttribute('role','group');
				this.element.empty().append(f);
				//this.get_container_ul()[0].appendChild(f);
			}
			if(fe !== null) {
				tmp = this.get_node(fe, true);
				if(tmp && tmp.length && tmp.children('.jstree-anchor')[0] !== document.activeElement) {
					tmp.children('.jstree-anchor').focus();
				}
				else {
					this._data.core.focused = null;
				}
			}
			this._model.force_full_redraw = false;
			this._model.changed = [];
			/**
			 * triggered after nodes are redrawn
			 * @event
			 * @name redraw.jstree
			 * @param {array} nodes the redrawn nodes
			 */
			this.trigger('redraw', { "nodes" : nodes });
		},
		/**
		 * redraws all nodes that need to be redrawn or optionally - the whole tree
		 * @name redraw([full])
		 * @param {Boolean} full if set to `true` all nodes are redrawn.
		 */
		redraw : function (full) {
			if(full) {
				this._model.force_full_redraw = true;
			}
			//if(this._model.redraw_timeout) {
			//	clearTimeout(this._model.redraw_timeout);
			//}
			//this._model.redraw_timeout = setTimeout($.proxy(this._redraw, this),0);
			this._redraw();
		},
		/**
		 * redraws a single node. Used internally.
		 * @private
		 * @name redraw_node(node, deep, is_callback, force_render)
		 * @param {mixed} node the node to redraw
		 * @param {Boolean} deep should child nodes be redrawn too
		 * @param {Boolean} is_callback is this a recursion call
		 * @param {Boolean} force_render should children of closed parents be drawn anyway
		 */
		redraw_node : function (node, deep, is_callback, force_render) {
			var obj = this.get_node(node),
				par = false,
				ind = false,
				old = false,
				i = false,
				j = false,
				k = false,
				c = '',
				d = document,
				m = this._model.data,
				f = false,
				s = false,
				tmp = null;
			if(!obj) { return false; }
			if(obj.id === '#') {  return this.redraw(true); }
			deep = deep || obj.children.length === 0;
			node = !document.querySelector ? document.getElementById(obj.id) : this.element[0].querySelector('#' + ("0123456789".indexOf(obj.id[0]) !== -1 ? '\\3' + obj.id[0] + ' ' + obj.id.substr(1).replace($.jstree.idregex,'\\$&') : obj.id.replace($.jstree.idregex,'\\$&')) ); //, this.element);
			if(!node) {
				deep = true;
				//node = d.createElement('LI');
				if(!is_callback) {
					par = obj.parent !== '#' ? $('#' + obj.parent.replace($.jstree.idregex,'\\$&'), this.element)[0] : null;
					if(par !== null && (!par || !m[obj.parent].state.opened)) {
						return false;
					}
					ind = $.inArray(obj.id, par === null ? m['#'].children : m[obj.parent].children);
				}
			}
			else {
				node = $(node);
				if(!is_callback) {
					par = node.parent().parent()[0];
					if(par === this.element[0]) {
						par = null;
					}
					ind = node.index();
				}
				// m[obj.id].data = node.data(); // use only node's data, no need to touch jquery storage
				if(!deep && obj.children.length && !node.children('.jstree-children').length) {
					deep = true;
				}
				if(!deep) {
					old = node.children('.jstree-children')[0];
				}
				f = node.children('.jstree-anchor')[0] === document.activeElement;
				node.remove();
				//node = d.createElement('LI');
				//node = node[0];
			}
			node = _node.cloneNode(true);
			// node is DOM, deep is boolean

			c = 'jstree-node ';
			for(i in obj.li_attr) {
				if(obj.li_attr.hasOwnProperty(i)) {
					if(i === 'id') { continue; }
					if(i !== 'class') {
						node.setAttribute(i, obj.li_attr[i]);
					}
					else {
						c += obj.li_attr[i];
					}
				}
			}
			if(!obj.a_attr.id) {
				obj.a_attr.id = obj.id + '_anchor';
			}
			node.setAttribute('aria-selected', !!obj.state.selected);
			node.setAttribute('aria-level', obj.parents.length);
			node.setAttribute('aria-labelledby', obj.a_attr.id);
			if(obj.state.disabled) {
				node.setAttribute('aria-disabled', true);
			}

			if(obj.state.loaded && !obj.children.length) {
				c += ' jstree-leaf';
			}
			else {
				c += obj.state.opened && obj.state.loaded ? ' jstree-open' : ' jstree-closed';
				node.setAttribute('aria-expanded', (obj.state.opened && obj.state.loaded) );
			}
			if(obj.parent !== null && m[obj.parent].children[m[obj.parent].children.length - 1] === obj.id) {
				c += ' jstree-last';
			}
			node.id = obj.id;
			node.className = c;
			c = ( obj.state.selected ? ' jstree-clicked' : '') + ( obj.state.disabled ? ' jstree-disabled' : '');
			for(j in obj.a_attr) {
				if(obj.a_attr.hasOwnProperty(j)) {
					if(j === 'href' && obj.a_attr[j] === '#') { continue; }
					if(j !== 'class') {
						node.childNodes[1].setAttribute(j, obj.a_attr[j]);
					}
					else {
						c += ' ' + obj.a_attr[j];
					}
				}
			}
			if(c.length) {
				node.childNodes[1].className = 'jstree-anchor ' + c;
			}
			if((obj.icon && obj.icon !== true) || obj.icon === false) {
				if(obj.icon === false) {
					node.childNodes[1].childNodes[0].className += ' jstree-themeicon-hidden';
				}
				else if(obj.icon.indexOf('/') === -1 && obj.icon.indexOf('.') === -1) {
					node.childNodes[1].childNodes[0].className += ' ' + obj.icon + ' jstree-themeicon-custom';
				}
				else {
					node.childNodes[1].childNodes[0].style.backgroundImage = 'url('+obj.icon+')';
					node.childNodes[1].childNodes[0].style.backgroundPosition = 'center center';
					node.childNodes[1].childNodes[0].style.backgroundSize = 'auto';
					node.childNodes[1].childNodes[0].className += ' jstree-themeicon-custom';
				}
			}

			if(this.settings.core.force_text) {
				node.childNodes[1].appendChild(d.createTextNode(obj.text));
			}
			else {
				node.childNodes[1].innerHTML += obj.text;
			}

			if(deep && obj.children.length && (obj.state.opened || force_render) && obj.state.loaded) {
				k = d.createElement('UL');
				k.setAttribute('role', 'group');
				k.className = 'jstree-children';
				for(i = 0, j = obj.children.length; i < j; i++) {
					k.appendChild(this.redraw_node(obj.children[i], deep, true));
				}
				node.appendChild(k);
			}
			if(old) {
				node.appendChild(old);
			}
			if(!is_callback) {
				// append back using par / ind
				if(!par) {
					par = this.element[0];
				}
				for(i = 0, j = par.childNodes.length; i < j; i++) {
					if(par.childNodes[i] && par.childNodes[i].className && par.childNodes[i].className.indexOf('jstree-children') !== -1) {
						tmp = par.childNodes[i];
						break;
					}
				}
				if(!tmp) {
					tmp = d.createElement('UL');
					tmp.setAttribute('role', 'group');
					tmp.className = 'jstree-children';
					par.appendChild(tmp);
				}
				par = tmp;

				if(ind < par.childNodes.length) {
					par.insertBefore(node, par.childNodes[ind]);
				}
				else {
					par.appendChild(node);
				}
				if(f) {
					node.childNodes[1].focus();
				}
			}
			if(obj.state.opened && !obj.state.loaded) {
				obj.state.opened = false;
				setTimeout($.proxy(function () {
					this.open_node(obj.id, false, 0);
				}, this), 0);
			}
			return node;
		},
		/**
		 * opens a node, revaling its children. If the node is not loaded it will be loaded and opened once ready.
		 * @name open_node(obj [, callback, animation])
		 * @param {mixed} obj the node to open
		 * @param {Function} callback a function to execute once the node is opened
		 * @param {Number} animation the animation duration in milliseconds when opening the node (overrides the `core.animation` setting). Use `false` for no animation.
		 * @trigger open_node.jstree, after_open.jstree, before_open.jstree
		 */
		open_node : function (obj, callback, animation) {
			var t1, t2, d, t;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.open_node(obj[t1], callback, animation);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			animation = animation === undefined ? this.settings.core.animation : animation;
			if(!this.is_closed(obj)) {
				if(callback) {
					callback.call(this, obj, false);
				}
				return false;
			}
			if(!this.is_loaded(obj)) {
				if(this.is_loading(obj)) {
					return setTimeout($.proxy(function () {
						this.open_node(obj, callback, animation);
					}, this), 500);
				}
				this.load_node(obj, function (o, ok) {
					return ok ? this.open_node(o, callback, animation) : (callback ? callback.call(this, o, false) : false);
				});
			}
			else {
				d = this.get_node(obj, true);
				t = this;
				if(d.length) {
					if(obj.children.length && !this._firstChild(d.children('.jstree-children')[0])) {
						this.redraw_node(obj, true, false, true);
						d = this.get_node(obj, true);
					}
					if(!animation) {
						this.trigger('before_open', { "node" : obj });
						d[0].className = d[0].className.replace('jstree-closed', 'jstree-open');
						d[0].setAttribute("aria-expanded", true);
					}
					else {
						this.trigger('before_open', { "node" : obj });
						d
							.children(".jstree-children").css("display","none").end()
							.removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded", true)
							.children(".jstree-children").stop(true, true)
								.slideDown(animation, function () {
									this.style.display = "";
									t.trigger("after_open", { "node" : obj });
								});
					}
				}
				obj.state.opened = true;
				if(callback) {
					callback.call(this, obj, true);
				}
				if(!d.length) {
					/**
					 * triggered when a node is about to be opened (if the node is supposed to be in the DOM, it will be, but it won't be visible yet)
					 * @event
					 * @name before_open.jstree
					 * @param {Object} node the opened node
					 */
					this.trigger('before_open', { "node" : obj });
				}
				/**
				 * triggered when a node is opened (if there is an animation it will not be completed yet)
				 * @event
				 * @name open_node.jstree
				 * @param {Object} node the opened node
				 */
				this.trigger('open_node', { "node" : obj });
				if(!animation || !d.length) {
					/**
					 * triggered when a node is opened and the animation is complete
					 * @event
					 * @name after_open.jstree
					 * @param {Object} node the opened node
					 */
					this.trigger("after_open", { "node" : obj });
				}
			}
		},
		/**
		 * opens every parent of a node (node should be loaded)
		 * @name _open_to(obj)
		 * @param {mixed} obj the node to reveal
		 * @private
		 */
		_open_to : function (obj) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			var i, j, p = obj.parents;
			for(i = 0, j = p.length; i < j; i+=1) {
				if(i !== '#') {
					this.open_node(p[i], false, 0);
				}
			}
			return $('#' + obj.id.replace($.jstree.idregex,'\\$&'), this.element);
		},
		/**
		 * closes a node, hiding its children
		 * @name close_node(obj [, animation])
		 * @param {mixed} obj the node to close
		 * @param {Number} animation the animation duration in milliseconds when closing the node (overrides the `core.animation` setting). Use `false` for no animation.
		 * @trigger close_node.jstree, after_close.jstree
		 */
		close_node : function (obj, animation) {
			var t1, t2, t, d;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.close_node(obj[t1], animation);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			if(this.is_closed(obj)) {
				return false;
			}
			animation = animation === undefined ? this.settings.core.animation : animation;
			t = this;
			d = this.get_node(obj, true);
			if(d.length) {
				if(!animation) {
					d[0].className = d[0].className.replace('jstree-open', 'jstree-closed');
					d.attr("aria-expanded", false).children('.jstree-children').remove();
				}
				else {
					d
						.children(".jstree-children").attr("style","display:block !important").end()
						.removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded", false)
						.children(".jstree-children").stop(true, true).slideUp(animation, function () {
							this.style.display = "";
							d.children('.jstree-children').remove();
							t.trigger("after_close", { "node" : obj });
						});
				}
			}
			obj.state.opened = false;
			/**
			 * triggered when a node is closed (if there is an animation it will not be complete yet)
			 * @event
			 * @name close_node.jstree
			 * @param {Object} node the closed node
			 */
			this.trigger('close_node',{ "node" : obj });
			if(!animation || !d.length) {
				/**
				 * triggered when a node is closed and the animation is complete
				 * @event
				 * @name after_close.jstree
				 * @param {Object} node the closed node
				 */
				this.trigger("after_close", { "node" : obj });
			}
		},
		/**
		 * toggles a node - closing it if it is open, opening it if it is closed
		 * @name toggle_node(obj)
		 * @param {mixed} obj the node to toggle
		 */
		toggle_node : function (obj) {
			var t1, t2;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.toggle_node(obj[t1]);
				}
				return true;
			}
			if(this.is_closed(obj)) {
				return this.open_node(obj);
			}
			if(this.is_open(obj)) {
				return this.close_node(obj);
			}
		},
		/**
		 * opens all nodes within a node (or the tree), revaling their children. If the node is not loaded it will be loaded and opened once ready.
		 * @name open_all([obj, animation, original_obj])
		 * @param {mixed} obj the node to open recursively, omit to open all nodes in the tree
		 * @param {Number} animation the animation duration in milliseconds when opening the nodes, the default is no animation
		 * @param {jQuery} reference to the node that started the process (internal use)
		 * @trigger open_all.jstree
		 */
		open_all : function (obj, animation, original_obj) {
			if(!obj) { obj = '#'; }
			obj = this.get_node(obj);
			if(!obj) { return false; }
			var dom = obj.id === '#' ? this.get_container_ul() : this.get_node(obj, true), i, j, _this;
			if(!dom.length) {
				for(i = 0, j = obj.children_d.length; i < j; i++) {
					if(this.is_closed(this._model.data[obj.children_d[i]])) {
						this._model.data[obj.children_d[i]].state.opened = true;
					}
				}
				return this.trigger('open_all', { "node" : obj });
			}
			original_obj = original_obj || dom;
			_this = this;
			dom = this.is_closed(obj) ? dom.find('.jstree-closed').addBack() : dom.find('.jstree-closed');
			dom.each(function () {
				_this.open_node(
					this,
					function(node, status) { if(status && this.is_parent(node)) { this.open_all(node, animation, original_obj); } },
					animation || 0
				);
			});
			if(original_obj.find('.jstree-closed').length === 0) {
				/**
				 * triggered when an `open_all` call completes
				 * @event
				 * @name open_all.jstree
				 * @param {Object} node the opened node
				 */
				this.trigger('open_all', { "node" : this.get_node(original_obj) });
			}
		},
		/**
		 * closes all nodes within a node (or the tree), revaling their children
		 * @name close_all([obj, animation])
		 * @param {mixed} obj the node to close recursively, omit to close all nodes in the tree
		 * @param {Number} animation the animation duration in milliseconds when closing the nodes, the default is no animation
		 * @trigger close_all.jstree
		 */
		close_all : function (obj, animation) {
			if(!obj) { obj = '#'; }
			obj = this.get_node(obj);
			if(!obj) { return false; }
			var dom = obj.id === '#' ? this.get_container_ul() : this.get_node(obj, true),
				_this = this, i, j;
			if(!dom.length) {
				for(i = 0, j = obj.children_d.length; i < j; i++) {
					this._model.data[obj.children_d[i]].state.opened = false;
				}
				return this.trigger('close_all', { "node" : obj });
			}
			dom = this.is_open(obj) ? dom.find('.jstree-open').addBack() : dom.find('.jstree-open');
			$(dom.get().reverse()).each(function () { _this.close_node(this, animation || 0); });
			/**
			 * triggered when an `close_all` call completes
			 * @event
			 * @name close_all.jstree
			 * @param {Object} node the closed node
			 */
			this.trigger('close_all', { "node" : obj });
		},
		/**
		 * checks if a node is disabled (not selectable)
		 * @name is_disabled(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		is_disabled : function (obj) {
			obj = this.get_node(obj);
			return obj && obj.state && obj.state.disabled;
		},
		/**
		 * enables a node - so that it can be selected
		 * @name enable_node(obj)
		 * @param {mixed} obj the node to enable
		 * @trigger enable_node.jstree
		 */
		enable_node : function (obj) {
			var t1, t2;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.enable_node(obj[t1]);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			obj.state.disabled = false;
			this.get_node(obj,true).children('.jstree-anchor').removeClass('jstree-disabled').attr('aria-disabled', false);
			/**
			 * triggered when an node is enabled
			 * @event
			 * @name enable_node.jstree
			 * @param {Object} node the enabled node
			 */
			this.trigger('enable_node', { 'node' : obj });
		},
		/**
		 * disables a node - so that it can not be selected
		 * @name disable_node(obj)
		 * @param {mixed} obj the node to disable
		 * @trigger disable_node.jstree
		 */
		disable_node : function (obj) {
			var t1, t2;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.disable_node(obj[t1]);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			obj.state.disabled = true;
			this.get_node(obj,true).children('.jstree-anchor').addClass('jstree-disabled').attr('aria-disabled', true);
			/**
			 * triggered when an node is disabled
			 * @event
			 * @name disable_node.jstree
			 * @param {Object} node the disabled node
			 */
			this.trigger('disable_node', { 'node' : obj });
		},
		/**
		 * called when a node is selected by the user. Used internally.
		 * @private
		 * @name activate_node(obj, e)
		 * @param {mixed} obj the node
		 * @param {Object} e the related event
		 * @trigger activate_node.jstree, changed.jstree
		 */
		activate_node : function (obj, e) {
			if(this.is_disabled(obj)) {
				return false;
			}

			// ensure last_clicked is still in the DOM, make it fresh (maybe it was moved?) and make sure it is still selected, if not - make last_clicked the last selected node
			this._data.core.last_clicked = this._data.core.last_clicked && this._data.core.last_clicked.id !== undefined ? this.get_node(this._data.core.last_clicked.id) : null;
			if(this._data.core.last_clicked && !this._data.core.last_clicked.state.selected) { this._data.core.last_clicked = null; }
			if(!this._data.core.last_clicked && this._data.core.selected.length) { this._data.core.last_clicked = this.get_node(this._data.core.selected[this._data.core.selected.length - 1]); }

			if(!this.settings.core.multiple || (!e.metaKey && !e.ctrlKey && !e.shiftKey) || (e.shiftKey && (!this._data.core.last_clicked || !this.get_parent(obj) || this.get_parent(obj) !== this._data.core.last_clicked.parent ) )) {
				if(!this.settings.core.multiple && (e.metaKey || e.ctrlKey || e.shiftKey) && this.is_selected(obj)) {
					this.deselect_node(obj, false, e);
				}
				else {
					this.deselect_all(true);
					this.select_node(obj, false, false, e);
					this._data.core.last_clicked = this.get_node(obj);
				}
			}
			else {
				if(e.shiftKey) {
					var o = this.get_node(obj).id,
						l = this._data.core.last_clicked.id,
						p = this.get_node(this._data.core.last_clicked.parent).children,
						c = false,
						i, j;
					for(i = 0, j = p.length; i < j; i += 1) {
						// separate IFs work whem o and l are the same
						if(p[i] === o) {
							c = !c;
						}
						if(p[i] === l) {
							c = !c;
						}
						if(c || p[i] === o || p[i] === l) {
							this.select_node(p[i], true, false, e);
						}
						else {
							this.deselect_node(p[i], true, e);
						}
					}
					this.trigger('changed', { 'action' : 'select_node', 'node' : this.get_node(obj), 'selected' : this._data.core.selected, 'event' : e });
				}
				else {
					if(!this.is_selected(obj)) {
						this.select_node(obj, false, false, e);
					}
					else {
						this.deselect_node(obj, false, e);
					}
				}
			}
			/**
			 * triggered when an node is clicked or intercated with by the user
			 * @event
			 * @name activate_node.jstree
			 * @param {Object} node
			 */
			this.trigger('activate_node', { 'node' : this.get_node(obj) });
		},
		/**
		 * applies the hover state on a node, called when a node is hovered by the user. Used internally.
		 * @private
		 * @name hover_node(obj)
		 * @param {mixed} obj
		 * @trigger hover_node.jstree
		 */
		hover_node : function (obj) {
			obj = this.get_node(obj, true);
			if(!obj || !obj.length || obj.children('.jstree-hovered').length) {
				return false;
			}
			var o = this.element.find('.jstree-hovered'), t = this.element;
			if(o && o.length) { this.dehover_node(o); }

			obj.children('.jstree-anchor').addClass('jstree-hovered');
			/**
			 * triggered when an node is hovered
			 * @event
			 * @name hover_node.jstree
			 * @param {Object} node
			 */
			this.trigger('hover_node', { 'node' : this.get_node(obj) });
			setTimeout(function () { t.attr('aria-activedescendant', obj[0].id); }, 0);
		},
		/**
		 * removes the hover state from a nodecalled when a node is no longer hovered by the user. Used internally.
		 * @private
		 * @name dehover_node(obj)
		 * @param {mixed} obj
		 * @trigger dehover_node.jstree
		 */
		dehover_node : function (obj) {
			obj = this.get_node(obj, true);
			if(!obj || !obj.length || !obj.children('.jstree-hovered').length) {
				return false;
			}
			obj.children('.jstree-anchor').removeClass('jstree-hovered');
			/**
			 * triggered when an node is no longer hovered
			 * @event
			 * @name dehover_node.jstree
			 * @param {Object} node
			 */
			this.trigger('dehover_node', { 'node' : this.get_node(obj) });
		},
		/**
		 * select a node
		 * @name select_node(obj [, supress_event, prevent_open])
		 * @param {mixed} obj an array can be used to select multiple nodes
		 * @param {Boolean} supress_event if set to `true` the `changed.jstree` event won't be triggered
		 * @param {Boolean} prevent_open if set to `true` parents of the selected node won't be opened
		 * @trigger select_node.jstree, changed.jstree
		 */
		select_node : function (obj, supress_event, prevent_open, e) {
			var dom, t1, t2, th;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.select_node(obj[t1], supress_event, prevent_open, e);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			dom = this.get_node(obj, true);
			if(!obj.state.selected) {
				obj.state.selected = true;
				this._data.core.selected.push(obj.id);
				if(!prevent_open) {
					dom = this._open_to(obj);
				}
				if(dom && dom.length) {
					dom.attr('aria-selected', true).children('.jstree-anchor').addClass('jstree-clicked');
				}
				/**
				 * triggered when an node is selected
				 * @event
				 * @name select_node.jstree
				 * @param {Object} node
				 * @param {Array} selected the current selection
				 * @param {Object} event the event (if any) that triggered this select_node
				 */
				this.trigger('select_node', { 'node' : obj, 'selected' : this._data.core.selected, 'event' : e });
				if(!supress_event) {
					/**
					 * triggered when selection changes
					 * @event
					 * @name changed.jstree
					 * @param {Object} node
					 * @param {Object} action the action that caused the selection to change
					 * @param {Array} selected the current selection
					 * @param {Object} event the event (if any) that triggered this changed event
					 */
					this.trigger('changed', { 'action' : 'select_node', 'node' : obj, 'selected' : this._data.core.selected, 'event' : e });
				}
			}
		},
		/**
		 * deselect a node
		 * @name deselect_node(obj [, supress_event])
		 * @param {mixed} obj an array can be used to deselect multiple nodes
		 * @param {Boolean} supress_event if set to `true` the `changed.jstree` event won't be triggered
		 * @trigger deselect_node.jstree, changed.jstree
		 */
		deselect_node : function (obj, supress_event, e) {
			var t1, t2, dom;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.deselect_node(obj[t1], supress_event, e);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			dom = this.get_node(obj, true);
			if(obj.state.selected) {
				obj.state.selected = false;
				this._data.core.selected = $.vakata.array_remove_item(this._data.core.selected, obj.id);
				if(dom.length) {
					dom.attr('aria-selected', false).children('.jstree-anchor').removeClass('jstree-clicked');
				}
				/**
				 * triggered when an node is deselected
				 * @event
				 * @name deselect_node.jstree
				 * @param {Object} node
				 * @param {Array} selected the current selection
				 * @param {Object} event the event (if any) that triggered this deselect_node
				 */
				this.trigger('deselect_node', { 'node' : obj, 'selected' : this._data.core.selected, 'event' : e });
				if(!supress_event) {
					this.trigger('changed', { 'action' : 'deselect_node', 'node' : obj, 'selected' : this._data.core.selected, 'event' : e });
				}
			}
		},
		/**
		 * select all nodes in the tree
		 * @name select_all([supress_event])
		 * @param {Boolean} supress_event if set to `true` the `changed.jstree` event won't be triggered
		 * @trigger select_all.jstree, changed.jstree
		 */
		select_all : function (supress_event) {
			var tmp = this._data.core.selected.concat([]), i, j;
			this._data.core.selected = this._model.data['#'].children_d.concat();
			for(i = 0, j = this._data.core.selected.length; i < j; i++) {
				if(this._model.data[this._data.core.selected[i]]) {
					this._model.data[this._data.core.selected[i]].state.selected = true;
				}
			}
			this.redraw(true);
			/**
			 * triggered when all nodes are selected
			 * @event
			 * @name select_all.jstree
			 * @param {Array} selected the current selection
			 */
			this.trigger('select_all', { 'selected' : this._data.core.selected });
			if(!supress_event) {
				this.trigger('changed', { 'action' : 'select_all', 'selected' : this._data.core.selected, 'old_selection' : tmp });
			}
		},
		/**
		 * deselect all selected nodes
		 * @name deselect_all([supress_event])
		 * @param {Boolean} supress_event if set to `true` the `changed.jstree` event won't be triggered
		 * @trigger deselect_all.jstree, changed.jstree
		 */
		deselect_all : function (supress_event) {
			var tmp = this._data.core.selected.concat([]), i, j;
			for(i = 0, j = this._data.core.selected.length; i < j; i++) {
				if(this._model.data[this._data.core.selected[i]]) {
					this._model.data[this._data.core.selected[i]].state.selected = false;
				}
			}
			this._data.core.selected = [];
			this.element.find('.jstree-clicked').removeClass('jstree-clicked').parent().attr('aria-selected', false);
			/**
			 * triggered when all nodes are deselected
			 * @event
			 * @name deselect_all.jstree
			 * @param {Object} node the previous selection
			 * @param {Array} selected the current selection
			 */
			this.trigger('deselect_all', { 'selected' : this._data.core.selected, 'node' : tmp });
			if(!supress_event) {
				this.trigger('changed', { 'action' : 'deselect_all', 'selected' : this._data.core.selected, 'old_selection' : tmp });
			}
		},
		/**
		 * checks if a node is selected
		 * @name is_selected(obj)
		 * @param  {mixed}  obj
		 * @return {Boolean}
		 */
		is_selected : function (obj) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			return obj.state.selected;
		},
		/**
		 * get an array of all selected nodes
		 * @name get_selected([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 */
		get_selected : function (full) {
			return full ? $.map(this._data.core.selected, $.proxy(function (i) { return this.get_node(i); }, this)) : this._data.core.selected.slice();
		},
		/**
		 * get an array of all top level selected nodes (ignoring children of selected nodes)
		 * @name get_top_selected([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 */
		get_top_selected : function (full) {
			var tmp = this.get_selected(true),
				obj = {}, i, j, k, l;
			for(i = 0, j = tmp.length; i < j; i++) {
				obj[tmp[i].id] = tmp[i];
			}
			for(i = 0, j = tmp.length; i < j; i++) {
				for(k = 0, l = tmp[i].children_d.length; k < l; k++) {
					if(obj[tmp[i].children_d[k]]) {
						delete obj[tmp[i].children_d[k]];
					}
				}
			}
			tmp = [];
			for(i in obj) {
				if(obj.hasOwnProperty(i)) {
					tmp.push(i);
				}
			}
			return full ? $.map(tmp, $.proxy(function (i) { return this.get_node(i); }, this)) : tmp;
		},
		/**
		 * get an array of all bottom level selected nodes (ignoring selected parents)
		 * @name get_bottom_selected([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 */
		get_bottom_selected : function (full) {
			var tmp = this.get_selected(true),
				obj = [], i, j;
			for(i = 0, j = tmp.length; i < j; i++) {
				if(!tmp[i].children.length) {
					obj.push(tmp[i].id);
				}
			}
			return full ? $.map(obj, $.proxy(function (i) { return this.get_node(i); }, this)) : obj;
		},
		/**
		 * gets the current state of the tree so that it can be restored later with `set_state(state)`. Used internally.
		 * @name get_state()
		 * @private
		 * @return {Object}
		 */
		get_state : function () {
			var state	= {
				'core' : {
					'open' : [],
					'scroll' : {
						'left' : this.element.scrollLeft(),
						'top' : this.element.scrollTop()
					},
					/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
					'selected' : []
				}
			}, i;
			for(i in this._model.data) {
				if(this._model.data.hasOwnProperty(i)) {
					if(i !== '#') {
						if(this._model.data[i].state.opened) {
							state.core.open.push(i);
						}
						if(this._model.data[i].state.selected) {
							state.core.selected.push(i);
						}
					}
				}
			}
			return state;
		},
		/**
		 * sets the state of the tree. Used internally.
		 * @name set_state(state [, callback])
		 * @private
		 * @param {Object} state the state to restore
		 * @param {Function} callback an optional function to execute once the state is restored.
		 * @trigger set_state.jstree
		 */
		set_state : function (state, callback) {
			if(state) {
				if(state.core) {
					var res, n, t, _this;
					if(state.core.open) {
						if(!$.isArray(state.core.open)) {
							delete state.core.open;
							this.set_state(state, callback);
							return false;
						}
						res = true;
						n = false;
						t = this;
						$.each(state.core.open.concat([]), function (i, v) {
							n = t.get_node(v);
							if(n) {
								if(t.is_loaded(v)) {
									if(t.is_closed(v)) {
										t.open_node(v, false, 0);
									}
									if(state && state.core && state.core.open) {
										$.vakata.array_remove_item(state.core.open, v);
									}
								}
								else {
									if(!t.is_loading(v)) {
										t.open_node(v, $.proxy(function (o, s) {
											if(!s && state && state.core && state.core.open) {
												$.vakata.array_remove_item(state.core.open, o.id);
											}
											this.set_state(state, callback);
										}, t), 0);
									}
									// there will be some async activity - so wait for it
									res = false;
								}
							}
						});
						if(res) {
							delete state.core.open;
							this.set_state(state, callback);
						}
						return false;
					}
					if(state.core.scroll) {
						if(state.core.scroll && state.core.scroll.left !== undefined) {
							this.element.scrollLeft(state.core.scroll.left);
						}
						if(state.core.scroll && state.core.scroll.top !== undefined) {
							this.element.scrollTop(state.core.scroll.top);
						}
						delete state.core.scroll;
						this.set_state(state, callback);
						return false;
					}
					/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
					if(state.core.selected) {
						_this = this;
						this.deselect_all();
						$.each(state.core.selected, function (i, v) {
							_this.select_node(v);
						});
						delete state.core.selected;
						this.set_state(state, callback);
						return false;
					}
					if($.isEmptyObject(state.core)) {
						delete state.core;
						this.set_state(state, callback);
						return false;
					}
				}
				if($.isEmptyObject(state)) {
					state = null;
					if(callback) { callback.call(this); }
					/**
					 * triggered when a `set_state` call completes
					 * @event
					 * @name set_state.jstree
					 */
					this.trigger('set_state');
					return false;
				}
				return true;
			}
			return false;
		},
		/**
		 * refreshes the tree - all nodes are reloaded with calls to `load_node`.
		 * @name refresh()
		 * @param {Boolean} skip_loading an option to skip showing the loading indicator
		 * @param {Mixed} forget_state if set to `true` state will not be reapplied, if set to a function (receiving the current state as argument) the result of that function will be used as state
		 * @trigger refresh.jstree
		 */
		refresh : function (skip_loading, forget_state) {
			this._data.core.state = forget_state === true ? {} : this.get_state();
			if(forget_state && $.isFunction(forget_state)) { this._data.core.state = forget_state.call(this, this._data.core.state); }
			this._cnt = 0;
			this._model.data = {
				'#' : {
					id : '#',
					parent : null,
					parents : [],
					children : [],
					children_d : [],
					state : { loaded : false }
				}
			};
			var c = this.get_container_ul()[0].className;
			if(!skip_loading) {
				this.element.html("<"+"ul class='"+c+"' role='group'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>" + this.get_string("Loading ...") + "</a></li></ul>");
				this.element.attr('aria-activedescendant','j'+this._id+'_loading');
			}
			this.load_node('#', function (o, s) {
				if(s) {
					this.get_container_ul()[0].className = c;
					if(this._firstChild(this.get_container_ul()[0])) {
						this.element.attr('aria-activedescendant',this._firstChild(this.get_container_ul()[0]).id);
					}
					this.set_state($.extend(true, {}, this._data.core.state), function () {
						/**
						 * triggered when a `refresh` call completes
						 * @event
						 * @name refresh.jstree
						 */
						this.trigger('refresh');
					});
				}
				this._data.core.state = null;
			});
		},
		/**
		 * refreshes a node in the tree (reload its children) all opened nodes inside that node are reloaded with calls to `load_node`.
		 * @name refresh_node(obj)
		 * @param  {mixed} obj the node
		 * @trigger refresh_node.jstree
		 */
		refresh_node : function (obj) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			var opened = [], to_load = [], s = this._data.core.selected.concat([]);
			to_load.push(obj.id);
			if(obj.state.opened === true) { opened.push(obj.id); }
			this.get_node(obj, true).find('.jstree-open').each(function() { opened.push(this.id); });
			this._load_nodes(to_load, $.proxy(function (nodes) {
				this.open_node(opened, false, 0);
				this.select_node(this._data.core.selected);
				/**
				 * triggered when a node is refreshed
				 * @event
				 * @name refresh_node.jstree
				 * @param {Object} node - the refreshed node
				 * @param {Array} nodes - an array of the IDs of the nodes that were reloaded
				 */
				this.trigger('refresh_node', { 'node' : obj, 'nodes' : nodes });
			}, this));
		},
		/**
		 * set (change) the ID of a node
		 * @name set_id(obj, id)
		 * @param  {mixed} obj the node
		 * @param  {String} id the new ID
		 * @return {Boolean}
		 */
		set_id : function (obj, id) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			var i, j, m = this._model.data;
			id = id.toString();
			// update parents (replace current ID with new one in children and children_d)
			m[obj.parent].children[$.inArray(obj.id, m[obj.parent].children)] = id;
			for(i = 0, j = obj.parents.length; i < j; i++) {
				m[obj.parents[i]].children_d[$.inArray(obj.id, m[obj.parents[i]].children_d)] = id;
			}
			// update children (replace current ID with new one in parent and parents)
			for(i = 0, j = obj.children.length; i < j; i++) {
				m[obj.children[i]].parent = id;
			}
			for(i = 0, j = obj.children_d.length; i < j; i++) {
				m[obj.children_d[i]].parents[$.inArray(obj.id, m[obj.children_d[i]].parents)] = id;
			}
			i = $.inArray(obj.id, this._data.core.selected);
			if(i !== -1) { this._data.core.selected[i] = id; }
			// update model and obj itself (obj.id, this._model.data[KEY])
			i = this.get_node(obj.id, true);
			if(i) {
				i.attr('id', id);
			}
			delete m[obj.id];
			obj.id = id;
			m[id] = obj;
			return true;
		},
		/**
		 * get the text value of a node
		 * @name get_text(obj)
		 * @param  {mixed} obj the node
		 * @return {String}
		 */
		get_text : function (obj) {
			obj = this.get_node(obj);
			return (!obj || obj.id === '#') ? false : obj.text;
		},
		/**
		 * set the text value of a node. Used internally, please use `rename_node(obj, val)`.
		 * @private
		 * @name set_text(obj, val)
		 * @param  {mixed} obj the node, you can pass an array to set the text on multiple nodes
		 * @param  {String} val the new text value
		 * @return {Boolean}
		 * @trigger set_text.jstree
		 */
		set_text : function (obj, val) {
			var t1, t2;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.set_text(obj[t1], val);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			obj.text = val;
			if(this.get_node(obj, true).length) {
				this.redraw_node(obj.id);
			}
			/**
			 * triggered when a node text value is changed
			 * @event
			 * @name set_text.jstree
			 * @param {Object} obj
			 * @param {String} text the new value
			 */
			this.trigger('set_text',{ "obj" : obj, "text" : val });
			return true;
		},
		/**
		 * gets a JSON representation of a node (or the whole tree)
		 * @name get_json([obj, options])
		 * @param  {mixed} obj
		 * @param  {Object} options
		 * @param  {Boolean} options.no_state do not return state information
		 * @param  {Boolean} options.no_id do not return ID
		 * @param  {Boolean} options.no_children do not include children
		 * @param  {Boolean} options.no_data do not include node data
		 * @param  {Boolean} options.flat return flat JSON instead of nested
		 * @return {Object}
		 */
		get_json : function (obj, options, flat) {
			obj = this.get_node(obj || '#');
			if(!obj) { return false; }
			if(options && options.flat && !flat) { flat = []; }
			var tmp = {
				'id' : obj.id,
				'text' : obj.text,
				'icon' : this.get_icon(obj),
				'li_attr' : $.extend(true, {}, obj.li_attr),
				'a_attr' : $.extend(true, {}, obj.a_attr),
				'state' : {},
				'data' : options && options.no_data ? false : $.extend(true, {}, obj.data)
				//( this.get_node(obj, true).length ? this.get_node(obj, true).data() : obj.data ),
			}, i, j;
			if(options && options.flat) {
				tmp.parent = obj.parent;
			}
			else {
				tmp.children = [];
			}
			if(!options || !options.no_state) {
				for(i in obj.state) {
					if(obj.state.hasOwnProperty(i)) {
						tmp.state[i] = obj.state[i];
					}
				}
			}
			if(options && options.no_id) {
				delete tmp.id;
				if(tmp.li_attr && tmp.li_attr.id) {
					delete tmp.li_attr.id;
				}
				if(tmp.a_attr && tmp.a_attr.id) {
					delete tmp.a_attr.id;
				}
			}
			if(options && options.flat && obj.id !== '#') {
				flat.push(tmp);
			}
			if(!options || !options.no_children) {
				for(i = 0, j = obj.children.length; i < j; i++) {
					if(options && options.flat) {
						this.get_json(obj.children[i], options, flat);
					}
					else {
						tmp.children.push(this.get_json(obj.children[i], options));
					}
				}
			}
			return options && options.flat ? flat : (obj.id === '#' ? tmp.children : tmp);
		},
		/**
		 * create a new node (do not confuse with load_node)
		 * @name create_node([obj, node, pos, callback, is_loaded])
		 * @param  {mixed}   par       the parent node (to create a root node use either "#" (string) or `null`)
		 * @param  {mixed}   node      the data for the new node (a valid JSON object, or a simple string with the name)
		 * @param  {mixed}   pos       the index at which to insert the node, "first" and "last" are also supported, default is "last"
		 * @param  {Function} callback a function to be called once the node is created
		 * @param  {Boolean} is_loaded internal argument indicating if the parent node was succesfully loaded
		 * @return {String}            the ID of the newly create node
		 * @trigger model.jstree, create_node.jstree
		 */
		create_node : function (par, node, pos, callback, is_loaded) {
			if(par === null) { par = "#"; }
			par = this.get_node(par);
			if(!par) { return false; }
			pos = pos === undefined ? "last" : pos;
			if(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {
				return this.load_node(par, function () { this.create_node(par, node, pos, callback, true); });
			}
			if(!node) { node = { "text" : this.get_string('New node') }; }
			if(node.text === undefined) { node.text = this.get_string('New node'); }
			var tmp, dpc, i, j;

			if(par.id === '#') {
				if(pos === "before") { pos = "first"; }
				if(pos === "after") { pos = "last"; }
			}
			switch(pos) {
				case "before":
					tmp = this.get_node(par.parent);
					pos = $.inArray(par.id, tmp.children);
					par = tmp;
					break;
				case "after" :
					tmp = this.get_node(par.parent);
					pos = $.inArray(par.id, tmp.children) + 1;
					par = tmp;
					break;
				case "inside":
				case "first":
					pos = 0;
					break;
				case "last":
					pos = par.children.length;
					break;
				default:
					if(!pos) { pos = 0; }
					break;
			}
			if(pos > par.children.length) { pos = par.children.length; }
			if(!node.id) { node.id = true; }
			if(!this.check("create_node", node, par, pos)) {
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			if(node.id === true) { delete node.id; }
			node = this._parse_model_from_json(node, par.id, par.parents.concat());
			if(!node) { return false; }
			tmp = this.get_node(node);
			dpc = [];
			dpc.push(node);
			dpc = dpc.concat(tmp.children_d);
			this.trigger('model', { "nodes" : dpc, "parent" : par.id });

			par.children_d = par.children_d.concat(dpc);
			for(i = 0, j = par.parents.length; i < j; i++) {
				this._model.data[par.parents[i]].children_d = this._model.data[par.parents[i]].children_d.concat(dpc);
			}
			node = tmp;
			tmp = [];
			for(i = 0, j = par.children.length; i < j; i++) {
				tmp[i >= pos ? i+1 : i] = par.children[i];
			}
			tmp[pos] = node.id;
			par.children = tmp;

			this.redraw_node(par, true);
			if(callback) { callback.call(this, this.get_node(node)); }
			/**
			 * triggered when a node is created
			 * @event
			 * @name create_node.jstree
			 * @param {Object} node
			 * @param {String} parent the parent's ID
			 * @param {Number} position the position of the new node among the parent's children
			 */
			this.trigger('create_node', { "node" : this.get_node(node), "parent" : par.id, "position" : pos });
			return node.id;
		},
		/**
		 * set the text value of a node
		 * @name rename_node(obj, val)
		 * @param  {mixed} obj the node, you can pass an array to rename multiple nodes to the same name
		 * @param  {String} val the new text value
		 * @return {Boolean}
		 * @trigger rename_node.jstree
		 */
		rename_node : function (obj, val) {
			var t1, t2, old;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.rename_node(obj[t1], val);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			old = obj.text;
			if(!this.check("rename_node", obj, this.get_parent(obj), val)) {
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			this.set_text(obj, val); // .apply(this, Array.prototype.slice.call(arguments))
			/**
			 * triggered when a node is renamed
			 * @event
			 * @name rename_node.jstree
			 * @param {Object} node
			 * @param {String} text the new value
			 * @param {String} old the old value
			 */
			this.trigger('rename_node', { "node" : obj, "text" : val, "old" : old });
			return true;
		},
		/**
		 * remove a node
		 * @name delete_node(obj)
		 * @param  {mixed} obj the node, you can pass an array to delete multiple nodes
		 * @return {Boolean}
		 * @trigger delete_node.jstree, changed.jstree
		 */
		delete_node : function (obj) {
			var t1, t2, par, pos, tmp, i, j, k, l, c;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.delete_node(obj[t1]);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			par = this.get_node(obj.parent);
			pos = $.inArray(obj.id, par.children);
			c = false;
			if(!this.check("delete_node", obj, par, pos)) {
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			if(pos !== -1) {
				par.children = $.vakata.array_remove(par.children, pos);
			}
			tmp = obj.children_d.concat([]);
			tmp.push(obj.id);
			for(k = 0, l = tmp.length; k < l; k++) {
				for(i = 0, j = obj.parents.length; i < j; i++) {
					pos = $.inArray(tmp[k], this._model.data[obj.parents[i]].children_d);
					if(pos !== -1) {
						this._model.data[obj.parents[i]].children_d = $.vakata.array_remove(this._model.data[obj.parents[i]].children_d, pos);
					}
				}
				if(this._model.data[tmp[k]].state.selected) {
					c = true;
					pos = $.inArray(tmp[k], this._data.core.selected);
					if(pos !== -1) {
						this._data.core.selected = $.vakata.array_remove(this._data.core.selected, pos);
					}
				}
			}
			/**
			 * triggered when a node is deleted
			 * @event
			 * @name delete_node.jstree
			 * @param {Object} node
			 * @param {String} parent the parent's ID
			 */
			this.trigger('delete_node', { "node" : obj, "parent" : par.id });
			if(c) {
				this.trigger('changed', { 'action' : 'delete_node', 'node' : obj, 'selected' : this._data.core.selected, 'parent' : par.id });
			}
			for(k = 0, l = tmp.length; k < l; k++) {
				delete this._model.data[tmp[k]];
			}
			this.redraw_node(par, true);
			return true;
		},
		/**
		 * check if an operation is premitted on the tree. Used internally.
		 * @private
		 * @name check(chk, obj, par, pos)
		 * @param  {String} chk the operation to check, can be "create_node", "rename_node", "delete_node", "copy_node" or "move_node"
		 * @param  {mixed} obj the node
		 * @param  {mixed} par the parent
		 * @param  {mixed} pos the position to insert at, or if "rename_node" - the new name
		 * @param  {mixed} more some various additional information, for example if a "move_node" operations is triggered by DND this will be the hovered node
		 * @return {Boolean}
		 */
		check : function (chk, obj, par, pos, more) {
			obj = obj && obj.id ? obj : this.get_node(obj);
			par = par && par.id ? par : this.get_node(par);
			var tmp = chk.match(/^move_node|copy_node|create_node$/i) ? par : obj,
				chc = this.settings.core.check_callback;
			if(chk === "move_node" || chk === "copy_node") {
				if((!more || !more.is_multi) && (obj.id === par.id || $.inArray(obj.id, par.children) === pos || $.inArray(par.id, obj.children_d) !== -1)) {
					this._data.core.last_error = { 'error' : 'check', 'plugin' : 'core', 'id' : 'core_01', 'reason' : 'Moving parent inside child', 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
					return false;
				}
			}
			if(tmp && tmp.data) { tmp = tmp.data; }
			if(tmp && tmp.functions && (tmp.functions[chk] === false || tmp.functions[chk] === true)) {
				if(tmp.functions[chk] === false) {
					this._data.core.last_error = { 'error' : 'check', 'plugin' : 'core', 'id' : 'core_02', 'reason' : 'Node data prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
				}
				return tmp.functions[chk];
			}
			if(chc === false || ($.isFunction(chc) && chc.call(this, chk, obj, par, pos, more) === false) || (chc && chc[chk] === false)) {
				this._data.core.last_error = { 'error' : 'check', 'plugin' : 'core', 'id' : 'core_03', 'reason' : 'User config for core.check_callback prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
				return false;
			}
			return true;
		},
		/**
		 * get the last error
		 * @name last_error()
		 * @return {Object}
		 */
		last_error : function () {
			return this._data.core.last_error;
		},
		/**
		 * move a node to a new parent
		 * @name move_node(obj, par [, pos, callback, is_loaded])
		 * @param  {mixed} obj the node to move, pass an array to move multiple nodes
		 * @param  {mixed} par the new parent
		 * @param  {mixed} pos the position to insert at (besides integer values, "first" and "last" are supported, as well as "before" and "after"), defaults to integer `0`
		 * @param  {function} callback a function to call once the move is completed, receives 3 arguments - the node, the new parent and the position
		 * @param  {Boolean} internal parameter indicating if the parent node has been loaded
		 * @param  {Boolean} internal parameter indicating if the tree should be redrawn
		 * @trigger move_node.jstree
		 */
		move_node : function (obj, par, pos, callback, is_loaded, skip_redraw) {
			var t1, t2, old_par, old_pos, new_par, old_ins, is_multi, dpc, tmp, i, j, k, l, p;

			par = this.get_node(par);
			pos = pos === undefined ? 0 : pos;
			if(!par) { return false; }
			if(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {
				return this.load_node(par, function () { this.move_node(obj, par, pos, callback, true); });
			}

			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					if(this.move_node(obj[t1], par, pos, callback, is_loaded, true)) {
						par = obj[t1];
						pos = "after";
					}
				}
				this.redraw();
				return true;
			}
			obj = obj && obj.id ? obj : this.get_node(obj);

			if(!obj || obj.id === '#') { return false; }

			old_par = (obj.parent || '#').toString();
			new_par = (!pos.toString().match(/^(before|after)$/) || par.id === '#') ? par : this.get_node(par.parent);
			old_ins = obj.instance ? obj.instance : (this._model.data[obj.id] ? this : $.jstree.reference(obj.id));
			is_multi = !old_ins || !old_ins._id || (this._id !== old_ins._id);
			old_pos = old_ins && old_ins._id && old_par && old_ins._model.data[old_par] && old_ins._model.data[old_par].children ? $.inArray(obj.id, old_ins._model.data[old_par].children) : -1;
			if(is_multi) {
				if(this.copy_node(obj, par, pos, callback, is_loaded)) {
					if(old_ins) { old_ins.delete_node(obj); }
					return true;
				}
				return false;
			}
			//var m = this._model.data;
			if(par.id === '#') {
				if(pos === "before") { pos = "first"; }
				if(pos === "after") { pos = "last"; }
			}
			switch(pos) {
				case "before":
					pos = $.inArray(par.id, new_par.children);
					break;
				case "after" :
					pos = $.inArray(par.id, new_par.children) + 1;
					break;
				case "inside":
				case "first":
					pos = 0;
					break;
				case "last":
					pos = new_par.children.length;
					break;
				default:
					if(!pos) { pos = 0; }
					break;
			}
			if(pos > new_par.children.length) { pos = new_par.children.length; }
			if(!this.check("move_node", obj, new_par, pos, { 'core' : true, 'is_multi' : (old_ins && old_ins._id && old_ins._id !== this._id), 'is_foreign' : (!old_ins || !old_ins._id) })) {
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			if(obj.parent === new_par.id) {
				dpc = new_par.children.concat();
				tmp = $.inArray(obj.id, dpc);
				if(tmp !== -1) {
					dpc = $.vakata.array_remove(dpc, tmp);
					if(pos > tmp) { pos--; }
				}
				tmp = [];
				for(i = 0, j = dpc.length; i < j; i++) {
					tmp[i >= pos ? i+1 : i] = dpc[i];
				}
				tmp[pos] = obj.id;
				new_par.children = tmp;
				this._node_changed(new_par.id);
				this.redraw(new_par.id === '#');
			}
			else {
				// clean old parent and up
				tmp = obj.children_d.concat();
				tmp.push(obj.id);
				for(i = 0, j = obj.parents.length; i < j; i++) {
					dpc = [];
					p = old_ins._model.data[obj.parents[i]].children_d;
					for(k = 0, l = p.length; k < l; k++) {
						if($.inArray(p[k], tmp) === -1) {
							dpc.push(p[k]);
						}
					}
					old_ins._model.data[obj.parents[i]].children_d = dpc;
				}
				old_ins._model.data[old_par].children = $.vakata.array_remove_item(old_ins._model.data[old_par].children, obj.id);

				// insert into new parent and up
				for(i = 0, j = new_par.parents.length; i < j; i++) {
					this._model.data[new_par.parents[i]].children_d = this._model.data[new_par.parents[i]].children_d.concat(tmp);
				}
				dpc = [];
				for(i = 0, j = new_par.children.length; i < j; i++) {
					dpc[i >= pos ? i+1 : i] = new_par.children[i];
				}
				dpc[pos] = obj.id;
				new_par.children = dpc;
				new_par.children_d.push(obj.id);
				new_par.children_d = new_par.children_d.concat(obj.children_d);

				// update object
				obj.parent = new_par.id;
				tmp = new_par.parents.concat();
				tmp.unshift(new_par.id);
				p = obj.parents.length;
				obj.parents = tmp;

				// update object children
				tmp = tmp.concat();
				for(i = 0, j = obj.children_d.length; i < j; i++) {
					this._model.data[obj.children_d[i]].parents = this._model.data[obj.children_d[i]].parents.slice(0,p*-1);
					Array.prototype.push.apply(this._model.data[obj.children_d[i]].parents, tmp);
				}

				if(old_par === '#' || new_par.id === '#') {
					this._model.force_full_redraw = true;
				}
				if(!this._model.force_full_redraw) {
					this._node_changed(old_par);
					this._node_changed(new_par.id);
				}
				if(!skip_redraw) {
					this.redraw();
				}
			}
			if(callback) { callback.call(this, obj, new_par, pos); }
			/**
			 * triggered when a node is moved
			 * @event
			 * @name move_node.jstree
			 * @param {Object} node
			 * @param {String} parent the parent's ID
			 * @param {Number} position the position of the node among the parent's children
			 * @param {String} old_parent the old parent of the node
			 * @param {Number} old_position the old position of the node
			 * @param {Boolean} is_multi do the node and new parent belong to different instances
			 * @param {jsTree} old_instance the instance the node came from
			 * @param {jsTree} new_instance the instance of the new parent
			 */
			this.trigger('move_node', { "node" : obj, "parent" : new_par.id, "position" : pos, "old_parent" : old_par, "old_position" : old_pos, 'is_multi' : (old_ins && old_ins._id && old_ins._id !== this._id), 'is_foreign' : (!old_ins || !old_ins._id), 'old_instance' : old_ins, 'new_instance' : this });
			return true;
		},
		/**
		 * copy a node to a new parent
		 * @name copy_node(obj, par [, pos, callback, is_loaded])
		 * @param  {mixed} obj the node to copy, pass an array to copy multiple nodes
		 * @param  {mixed} par the new parent
		 * @param  {mixed} pos the position to insert at (besides integer values, "first" and "last" are supported, as well as "before" and "after"), defaults to integer `0`
		 * @param  {function} callback a function to call once the move is completed, receives 3 arguments - the node, the new parent and the position
		 * @param  {Boolean} internal parameter indicating if the parent node has been loaded
		 * @param  {Boolean} internal parameter indicating if the tree should be redrawn
		 * @trigger model.jstree copy_node.jstree
		 */
		copy_node : function (obj, par, pos, callback, is_loaded, skip_redraw) {
			var t1, t2, dpc, tmp, i, j, node, old_par, new_par, old_ins, is_multi;

			par = this.get_node(par);
			pos = pos === undefined ? 0 : pos;
			if(!par) { return false; }
			if(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {
				return this.load_node(par, function () { this.copy_node(obj, par, pos, callback, true); });
			}

			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					tmp = this.copy_node(obj[t1], par, pos, callback, is_loaded, true);
					if(tmp) {
						par = tmp;
						pos = "after";
					}
				}
				this.redraw();
				return true;
			}
			obj = obj && obj.id ? obj : this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }

			old_par = (obj.parent || '#').toString();
			new_par = (!pos.toString().match(/^(before|after)$/) || par.id === '#') ? par : this.get_node(par.parent);
			old_ins = obj.instance ? obj.instance : (this._model.data[obj.id] ? this : $.jstree.reference(obj.id));
			is_multi = !old_ins || !old_ins._id || (this._id !== old_ins._id);
			if(par.id === '#') {
				if(pos === "before") { pos = "first"; }
				if(pos === "after") { pos = "last"; }
			}
			switch(pos) {
				case "before":
					pos = $.inArray(par.id, new_par.children);
					break;
				case "after" :
					pos = $.inArray(par.id, new_par.children) + 1;
					break;
				case "inside":
				case "first":
					pos = 0;
					break;
				case "last":
					pos = new_par.children.length;
					break;
				default:
					if(!pos) { pos = 0; }
					break;
			}
			if(pos > new_par.children.length) { pos = new_par.children.length; }
			if(!this.check("copy_node", obj, new_par, pos, { 'core' : true, 'is_multi' : (old_ins && old_ins._id && old_ins._id !== this._id), 'is_foreign' : (!old_ins || !old_ins._id) })) {
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			node = old_ins ? old_ins.get_json(obj, { no_id : true, no_data : true, no_state : true }) : obj;
			if(!node) { return false; }
			if(node.id === true) { delete node.id; }
			node = this._parse_model_from_json(node, new_par.id, new_par.parents.concat());
			if(!node) { return false; }
			tmp = this.get_node(node);
			if(obj && obj.state && obj.state.loaded === false) { tmp.state.loaded = false; }
			dpc = [];
			dpc.push(node);
			dpc = dpc.concat(tmp.children_d);
			this.trigger('model', { "nodes" : dpc, "parent" : new_par.id });

			// insert into new parent and up
			for(i = 0, j = new_par.parents.length; i < j; i++) {
				this._model.data[new_par.parents[i]].children_d = this._model.data[new_par.parents[i]].children_d.concat(dpc);
			}
			dpc = [];
			for(i = 0, j = new_par.children.length; i < j; i++) {
				dpc[i >= pos ? i+1 : i] = new_par.children[i];
			}
			dpc[pos] = tmp.id;
			new_par.children = dpc;
			new_par.children_d.push(tmp.id);
			new_par.children_d = new_par.children_d.concat(tmp.children_d);

			if(new_par.id === '#') {
				this._model.force_full_redraw = true;
			}
			if(!this._model.force_full_redraw) {
				this._node_changed(new_par.id);
			}
			if(!skip_redraw) {
				this.redraw(new_par.id === '#');
			}
			if(callback) { callback.call(this, tmp, new_par, pos); }
			/**
			 * triggered when a node is copied
			 * @event
			 * @name copy_node.jstree
			 * @param {Object} node the copied node
			 * @param {Object} original the original node
			 * @param {String} parent the parent's ID
			 * @param {Number} position the position of the node among the parent's children
			 * @param {String} old_parent the old parent of the node
			 * @param {Number} old_position the position of the original node
			 * @param {Boolean} is_multi do the node and new parent belong to different instances
			 * @param {jsTree} old_instance the instance the node came from
			 * @param {jsTree} new_instance the instance of the new parent
			 */
			this.trigger('copy_node', { "node" : tmp, "original" : obj, "parent" : new_par.id, "position" : pos, "old_parent" : old_par, "old_position" : old_ins && old_ins._id && old_par && old_ins._model.data[old_par] && old_ins._model.data[old_par].children ? $.inArray(obj.id, old_ins._model.data[old_par].children) : -1,'is_multi' : (old_ins && old_ins._id && old_ins._id !== this._id), 'is_foreign' : (!old_ins || !old_ins._id), 'old_instance' : old_ins, 'new_instance' : this });
			return tmp.id;
		},
		/**
		 * cut a node (a later call to `paste(obj)` would move the node)
		 * @name cut(obj)
		 * @param  {mixed} obj multiple objects can be passed using an array
		 * @trigger cut.jstree
		 */
		cut : function (obj) {
			if(!obj) { obj = this._data.core.selected.concat(); }
			if(!$.isArray(obj)) { obj = [obj]; }
			if(!obj.length) { return false; }
			var tmp = [], o, t1, t2;
			for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
				o = this.get_node(obj[t1]);
				if(o && o.id && o.id !== '#') { tmp.push(o); }
			}
			if(!tmp.length) { return false; }
			ccp_node = tmp;
			ccp_inst = this;
			ccp_mode = 'move_node';
			/**
			 * triggered when nodes are added to the buffer for moving
			 * @event
			 * @name cut.jstree
			 * @param {Array} node
			 */
			this.trigger('cut', { "node" : obj });
		},
		/**
		 * copy a node (a later call to `paste(obj)` would copy the node)
		 * @name copy(obj)
		 * @param  {mixed} obj multiple objects can be passed using an array
		 * @trigger copy.jstre
		 */
		copy : function (obj) {
			if(!obj) { obj = this._data.core.selected.concat(); }
			if(!$.isArray(obj)) { obj = [obj]; }
			if(!obj.length) { return false; }
			var tmp = [], o, t1, t2;
			for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
				o = this.get_node(obj[t1]);
				if(o && o.id && o.id !== '#') { tmp.push(o); }
			}
			if(!tmp.length) { return false; }
			ccp_node = tmp;
			ccp_inst = this;
			ccp_mode = 'copy_node';
			/**
			 * triggered when nodes are added to the buffer for copying
			 * @event
			 * @name copy.jstree
			 * @param {Array} node
			 */
			this.trigger('copy', { "node" : obj });
		},
		/**
		 * get the current buffer (any nodes that are waiting for a paste operation)
		 * @name get_buffer()
		 * @return {Object} an object consisting of `mode` ("copy_node" or "move_node"), `node` (an array of objects) and `inst` (the instance)
		 */
		get_buffer : function () {
			return { 'mode' : ccp_mode, 'node' : ccp_node, 'inst' : ccp_inst };
		},
		/**
		 * check if there is something in the buffer to paste
		 * @name can_paste()
		 * @return {Boolean}
		 */
		can_paste : function () {
			return ccp_mode !== false && ccp_node !== false; // && ccp_inst._model.data[ccp_node];
		},
		/**
		 * copy or move the previously cut or copied nodes to a new parent
		 * @name paste(obj [, pos])
		 * @param  {mixed} obj the new parent
		 * @param  {mixed} pos the position to insert at (besides integer, "first" and "last" are supported), defaults to integer `0`
		 * @trigger paste.jstree
		 */
		paste : function (obj, pos) {
			obj = this.get_node(obj);
			if(!obj || !ccp_mode || !ccp_mode.match(/^(copy_node|move_node)$/) || !ccp_node) { return false; }
			if(this[ccp_mode](ccp_node, obj, pos)) {
				/**
				 * triggered when paste is invoked
				 * @event
				 * @name paste.jstree
				 * @param {String} parent the ID of the receiving node
				 * @param {Array} node the nodes in the buffer
				 * @param {String} mode the performed operation - "copy_node" or "move_node"
				 */
				this.trigger('paste', { "parent" : obj.id, "node" : ccp_node, "mode" : ccp_mode });
			}
			ccp_node = false;
			ccp_mode = false;
			ccp_inst = false;
		},
		/**
		 * clear the buffer of previously copied or cut nodes
		 * @name clear_buffer()
		 * @trigger clear_buffer.jstree
		 */
		clear_buffer : function () {
			ccp_node = false;
			ccp_mode = false;
			ccp_inst = false;
			/**
			 * triggered when the copy / cut buffer is cleared
			 * @event
			 * @name clear_buffer.jstree
			 */
			this.trigger('clear_buffer');
		},
		/**
		 * put a node in edit mode (input field to rename the node)
		 * @name edit(obj [, default_text])
		 * @param  {mixed} obj
		 * @param  {String} default_text the text to populate the input with (if omitted the node text value is used)
		 */
		edit : function (obj, default_text) {
			obj = this.get_node(obj);
			if(!obj) { return false; }
			if(this.settings.core.check_callback === false) {
				this._data.core.last_error = { 'error' : 'check', 'plugin' : 'core', 'id' : 'core_07', 'reason' : 'Could not edit node because of check_callback' };
				this.settings.core.error.call(this, this._data.core.last_error);
				return false;
			}
			default_text = typeof default_text === 'string' ? default_text : obj.text;
			this.set_text(obj, "");
			obj = this._open_to(obj);

			var rtl = this._data.core.rtl,
				w  = this.element.width(),
				a  = obj.children('.jstree-anchor'),
				s  = $('<span>'),
				/*!
				oi = obj.children("i:visible"),
				ai = a.children("i:visible"),
				w1 = oi.width() * oi.length,
				w2 = ai.width() * ai.length,
				*/
				t  = default_text,
				h1 = $("<"+"div />", { css : { "position" : "absolute", "top" : "-200px", "left" : (rtl ? "0px" : "-1000px"), "visibility" : "hidden" } }).appendTo("body"),
				h2 = $("<"+"input />", {
						"value" : t,
						"class" : "jstree-rename-input",
						// "size" : t.length,
						"css" : {
							"padding" : "0",
							"border" : "1px solid silver",
							"box-sizing" : "border-box",
							"display" : "inline-block",
							"height" : (this._data.core.li_height) + "px",
							"lineHeight" : (this._data.core.li_height) + "px",
							"width" : "150px" // will be set a bit further down
						},
						"blur" : $.proxy(function () {
							var i = s.children(".jstree-rename-input"),
								v = i.val();
							if(v === "") { v = t; }
							h1.remove();
							s.replaceWith(a);
							s.remove();
							this.set_text(obj, t);
							if(this.rename_node(obj, $('<div></div>').text(v)[this.settings.core.force_text ? 'text' : 'html']()) === false) {
								this.set_text(obj, t); // move this up? and fix #483
							}
						}, this),
						"keydown" : function (event) {
							var key = event.which;
							if(key === 27) {
								this.value = t;
							}
							if(key === 27 || key === 13 || key === 37 || key === 38 || key === 39 || key === 40 || key === 32) {
								event.stopImmediatePropagation();
							}
							if(key === 27 || key === 13) {
								event.preventDefault();
								this.blur();
							}
						},
						"click" : function (e) { e.stopImmediatePropagation(); },
						"mousedown" : function (e) { e.stopImmediatePropagation(); },
						"keyup" : function (event) {
							h2.width(Math.min(h1.text("pW" + this.value).width(),w));
						},
						"keypress" : function(event) {
							if(event.which === 13) { return false; }
						}
					}),
				fn = {
						fontFamily		: a.css('fontFamily')		|| '',
						fontSize		: a.css('fontSize')			|| '',
						fontWeight		: a.css('fontWeight')		|| '',
						fontStyle		: a.css('fontStyle')		|| '',
						fontStretch		: a.css('fontStretch')		|| '',
						fontVariant		: a.css('fontVariant')		|| '',
						letterSpacing	: a.css('letterSpacing')	|| '',
						wordSpacing		: a.css('wordSpacing')		|| ''
				};
			s.attr('class', a.attr('class')).append(a.contents().clone()).append(h2);
			a.replaceWith(s);
			h1.css(fn);
			h2.css(fn).width(Math.min(h1.text("pW" + h2[0].value).width(),w))[0].select();
		},


		/**
		 * changes the theme
		 * @name set_theme(theme_name [, theme_url])
		 * @param {String} theme_name the name of the new theme to apply
		 * @param {mixed} theme_url  the location of the CSS file for this theme. Omit or set to `false` if you manually included the file. Set to `true` to autoload from the `core.themes.dir` directory.
		 * @trigger set_theme.jstree
		 */
		set_theme : function (theme_name, theme_url) {
			if(!theme_name) { return false; }
			if(theme_url === true) {
				var dir = this.settings.core.themes.dir;
				if(!dir) { dir = $.jstree.path + '/themes'; }
				theme_url = dir + '/' + theme_name + '/style.css';
			}
			if(theme_url && $.inArray(theme_url, themes_loaded) === -1) {
				$('head').append('<'+'link rel="stylesheet" href="' + theme_url + '" type="text/css" />');
				themes_loaded.push(theme_url);
			}
			if(this._data.core.themes.name) {
				this.element.removeClass('jstree-' + this._data.core.themes.name);
			}
			this._data.core.themes.name = theme_name;
			this.element.addClass('jstree-' + theme_name);
			this.element[this.settings.core.themes.responsive ? 'addClass' : 'removeClass' ]('jstree-' + theme_name + '-responsive');
			/**
			 * triggered when a theme is set
			 * @event
			 * @name set_theme.jstree
			 * @param {String} theme the new theme
			 */
			this.trigger('set_theme', { 'theme' : theme_name });
		},
		/**
		 * gets the name of the currently applied theme name
		 * @name get_theme()
		 * @return {String}
		 */
		get_theme : function () { return this._data.core.themes.name; },
		/**
		 * changes the theme variant (if the theme has variants)
		 * @name set_theme_variant(variant_name)
		 * @param {String|Boolean} variant_name the variant to apply (if `false` is used the current variant is removed)
		 */
		set_theme_variant : function (variant_name) {
			if(this._data.core.themes.variant) {
				this.element.removeClass('jstree-' + this._data.core.themes.name + '-' + this._data.core.themes.variant);
			}
			this._data.core.themes.variant = variant_name;
			if(variant_name) {
				this.element.addClass('jstree-' + this._data.core.themes.name + '-' + this._data.core.themes.variant);
			}
		},
		/**
		 * gets the name of the currently applied theme variant
		 * @name get_theme()
		 * @return {String}
		 */
		get_theme_variant : function () { return this._data.core.themes.variant; },
		/**
		 * shows a striped background on the container (if the theme supports it)
		 * @name show_stripes()
		 */
		show_stripes : function () { this._data.core.themes.stripes = true; this.get_container_ul().addClass("jstree-striped"); },
		/**
		 * hides the striped background on the container
		 * @name hide_stripes()
		 */
		hide_stripes : function () { this._data.core.themes.stripes = false; this.get_container_ul().removeClass("jstree-striped"); },
		/**
		 * toggles the striped background on the container
		 * @name toggle_stripes()
		 */
		toggle_stripes : function () { if(this._data.core.themes.stripes) { this.hide_stripes(); } else { this.show_stripes(); } },
		/**
		 * shows the connecting dots (if the theme supports it)
		 * @name show_dots()
		 */
		show_dots : function () { this._data.core.themes.dots = true; this.get_container_ul().removeClass("jstree-no-dots"); },
		/**
		 * hides the connecting dots
		 * @name hide_dots()
		 */
		hide_dots : function () { this._data.core.themes.dots = false; this.get_container_ul().addClass("jstree-no-dots"); },
		/**
		 * toggles the connecting dots
		 * @name toggle_dots()
		 */
		toggle_dots : function () { if(this._data.core.themes.dots) { this.hide_dots(); } else { this.show_dots(); } },
		/**
		 * show the node icons
		 * @name show_icons()
		 */
		show_icons : function () { this._data.core.themes.icons = true; this.get_container_ul().removeClass("jstree-no-icons"); },
		/**
		 * hide the node icons
		 * @name hide_icons()
		 */
		hide_icons : function () { this._data.core.themes.icons = false; this.get_container_ul().addClass("jstree-no-icons"); },
		/**
		 * toggle the node icons
		 * @name toggle_icons()
		 */
		toggle_icons : function () { if(this._data.core.themes.icons) { this.hide_icons(); } else { this.show_icons(); } },
		/**
		 * set the node icon for a node
		 * @name set_icon(obj, icon)
		 * @param {mixed} obj
		 * @param {String} icon the new icon - can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class
		 */
		set_icon : function (obj, icon) {
			var t1, t2, dom, old;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.set_icon(obj[t1], icon);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			old = obj.icon;
			obj.icon = icon;
			dom = this.get_node(obj, true).children(".jstree-anchor").children(".jstree-themeicon");
			if(icon === false) {
				this.hide_icon(obj);
			}
			else if(icon === true) {
				dom.removeClass('jstree-themeicon-custom ' + old).css("background","").removeAttr("rel");
				if(old === false) { this.show_icon(obj); }
			}
			else if(icon.indexOf("/") === -1 && icon.indexOf(".") === -1) {
				dom.removeClass(old).css("background","");
				dom.addClass(icon + ' jstree-themeicon-custom').attr("rel",icon);
				if(old === false) { this.show_icon(obj); }
			}
			else {
				dom.removeClass(old).css("background","");
				dom.addClass('jstree-themeicon-custom').css("background", "url('" + icon + "') center center no-repeat").attr("rel",icon);
				if(old === false) { this.show_icon(obj); }
			}
			return true;
		},
		/**
		 * get the node icon for a node
		 * @name get_icon(obj)
		 * @param {mixed} obj
		 * @return {String}
		 */
		get_icon : function (obj) {
			obj = this.get_node(obj);
			return (!obj || obj.id === '#') ? false : obj.icon;
		},
		/**
		 * hide the icon on an individual node
		 * @name hide_icon(obj)
		 * @param {mixed} obj
		 */
		hide_icon : function (obj) {
			var t1, t2;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.hide_icon(obj[t1]);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj === '#') { return false; }
			obj.icon = false;
			this.get_node(obj, true).children(".jstree-anchor").children(".jstree-themeicon").addClass('jstree-themeicon-hidden');
			return true;
		},
		/**
		 * show the icon on an individual node
		 * @name show_icon(obj)
		 * @param {mixed} obj
		 */
		show_icon : function (obj) {
			var t1, t2, dom;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.show_icon(obj[t1]);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj === '#') { return false; }
			dom = this.get_node(obj, true);
			obj.icon = dom.length ? dom.children(".jstree-anchor").children(".jstree-themeicon").attr('rel') : true;
			if(!obj.icon) { obj.icon = true; }
			dom.children(".jstree-anchor").children(".jstree-themeicon").removeClass('jstree-themeicon-hidden');
			return true;
		}
	};

	// helpers
	$.vakata = {};
	// collect attributes
	$.vakata.attributes = function(node, with_values) {
		node = $(node)[0];
		var attr = with_values ? {} : [];
		if(node && node.attributes) {
			$.each(node.attributes, function (i, v) {
				if($.inArray(v.name.toLowerCase(),['style','contenteditable','hasfocus','tabindex']) !== -1) { return; }
				if(v.value !== null && $.trim(v.value) !== '') {
					if(with_values) { attr[v.name] = v.value; }
					else { attr.push(v.name); }
				}
			});
		}
		return attr;
	};
	$.vakata.array_unique = function(array) {
		var a = [], i, j, l;
		for(i = 0, l = array.length; i < l; i++) {
			for(j = 0; j <= i; j++) {
				if(array[i] === array[j]) {
					break;
				}
			}
			if(j === i) { a.push(array[i]); }
		}
		return a;
	};
	// remove item from array
	$.vakata.array_remove = function(array, from, to) {
		var rest = array.slice((to || from) + 1 || array.length);
		array.length = from < 0 ? array.length + from : from;
		array.push.apply(array, rest);
		return array;
	};
	// remove item from array
	$.vakata.array_remove_item = function(array, item) {
		var tmp = $.inArray(item, array);
		return tmp !== -1 ? $.vakata.array_remove(array, tmp) : array;
	};

/**
 * ### Checkbox plugin
 *
 * This plugin renders checkbox icons in front of each node, making multiple selection much easier. 
 * It also supports tri-state behavior, meaning that if a node has a few of its children checked it will be rendered as undetermined, and state will be propagated up.
 */

	var _i = document.createElement('I');
	_i.className = 'jstree-icon jstree-checkbox';
	_i.setAttribute('role', 'presentation');
	/**
	 * stores all defaults for the checkbox plugin
	 * @name $.jstree.defaults.checkbox
	 * @plugin checkbox
	 */
	$.jstree.defaults.checkbox = {
		/**
		 * a boolean indicating if checkboxes should be visible (can be changed at a later time using `show_checkboxes()` and `hide_checkboxes`). Defaults to `true`.
		 * @name $.jstree.defaults.checkbox.visible
		 * @plugin checkbox
		 */
		visible				: true,
		/**
		 * a boolean indicating if checkboxes should cascade down and have an undetermined state. Defaults to `true`.
		 * @name $.jstree.defaults.checkbox.three_state
		 * @plugin checkbox
		 */
		three_state			: true,
		/**
		 * a boolean indicating if clicking anywhere on the node should act as clicking on the checkbox. Defaults to `true`.
		 * @name $.jstree.defaults.checkbox.whole_node
		 * @plugin checkbox
		 */
		whole_node			: true,
		/**
		 * a boolean indicating if the selected style of a node should be kept, or removed. Defaults to `true`.
		 * @name $.jstree.defaults.checkbox.keep_selected_style
		 * @plugin checkbox
		 */
		keep_selected_style	: true,
		/**
		 * This setting controls how cascading and undetermined nodes are applied. 
		 * If 'up' is in the string - cascading up is enabled, if 'down' is in the string - cascading down is enabled, if 'undetermined' is in the string - undetermined nodes will be used. 
		 * If `three_state` is set to `true` this setting is automatically set to 'up+down+undetermined'. Defaults to ''.
		 * @name $.jstree.defaults.checkbox.cascade
		 * @plugin checkbox
		 */
		cascade				: '',
		/**
		 * This setting controls if checkbox are bound to the general tree selection or to an internal array maintained by the checkbox plugin. Defaults to `true`, only set to `false` if you know exactly what you are doing. 
		 * @name $.jstree.defaults.checkbox.tie_selection
		 * @plugin checkbox
		 */
		tie_selection		: true
	};
	$.jstree.plugins.checkbox = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);
			this._data.checkbox.uto = false;
			this._data.checkbox.selected = [];
			if(this.settings.checkbox.three_state) {
				this.settings.checkbox.cascade = 'up+down+undetermined';
			}
			this.element
				.on("init.jstree", $.proxy(function () {
						this._data.checkbox.visible = this.settings.checkbox.visible;
						if(!this.settings.checkbox.keep_selected_style) {
							this.element.addClass('jstree-checkbox-no-clicked');
						}
						if(this.settings.checkbox.tie_selection) {
							this.element.addClass('jstree-checkbox-selection');
						}
					}, this))
				.on("loading.jstree", $.proxy(function () {
						this[ this._data.checkbox.visible ? 'show_checkboxes' : 'hide_checkboxes' ]();
					}, this));
			if(this.settings.checkbox.cascade.indexOf('undetermined') !== -1) {
				this.element
					.on('changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree', $.proxy(function () {
							// only if undetermined is in setting
							if(this._data.checkbox.uto) { clearTimeout(this._data.checkbox.uto); }
							this._data.checkbox.uto = setTimeout($.proxy(this._undetermined, this), 50);
						}, this));
			}
			if(!this.settings.checkbox.tie_selection) {
				this.element
					.on('model.jstree', $.proxy(function (e, data) {
						var m = this._model.data,
							p = m[data.parent],
							dpc = data.nodes,
							i, j;
						for(i = 0, j = dpc.length; i < j; i++) {
							m[dpc[i]].state.checked = (m[dpc[i]].original && m[dpc[i]].original.state && m[dpc[i]].original.state.checked);
							if(m[dpc[i]].state.checked) {
								this._data.checkbox.selected.push(dpc[i]);
							}
						}
					}, this));
			}
			if(this.settings.checkbox.cascade.indexOf('up') !== -1 || this.settings.checkbox.cascade.indexOf('down') !== -1) {
				this.element
					.on('model.jstree', $.proxy(function (e, data) {
							var m = this._model.data,
								p = m[data.parent],
								dpc = data.nodes,
								chd = [],
								c, i, j, k, l, tmp, s = this.settings.checkbox.cascade, t = this.settings.checkbox.tie_selection;

							if(s.indexOf('down') !== -1) {
								// apply down
								if(p.state[ t ? 'selected' : 'checked' ]) {
									for(i = 0, j = dpc.length; i < j; i++) {
										m[dpc[i]].state[ t ? 'selected' : 'checked' ] = true;
									}
									this._data[ t ? 'core' : 'checkbox' ].selected = this._data[ t ? 'core' : 'checkbox' ].selected.concat(dpc);
								}
								else {
									for(i = 0, j = dpc.length; i < j; i++) {
										if(m[dpc[i]].state[ t ? 'selected' : 'checked' ]) {
											for(k = 0, l = m[dpc[i]].children_d.length; k < l; k++) {
												m[m[dpc[i]].children_d[k]].state[ t ? 'selected' : 'checked' ] = true;
											}
											this._data[ t ? 'core' : 'checkbox' ].selected = this._data[ t ? 'core' : 'checkbox' ].selected.concat(m[dpc[i]].children_d);
										}
									}
								}
							}

							if(s.indexOf('up') !== -1) {
								// apply up
								for(i = 0, j = p.children_d.length; i < j; i++) {
									if(!m[p.children_d[i]].children.length) {
										chd.push(m[p.children_d[i]].parent);
									}
								}
								chd = $.vakata.array_unique(chd);
								for(k = 0, l = chd.length; k < l; k++) {
									p = m[chd[k]];
									while(p && p.id !== '#') {
										c = 0;
										for(i = 0, j = p.children.length; i < j; i++) {
											c += m[p.children[i]].state[ t ? 'selected' : 'checked' ];
										}
										if(c === j) {
											p.state[ t ? 'selected' : 'checked' ] = true;
											this._data[ t ? 'core' : 'checkbox' ].selected.push(p.id);
											tmp = this.get_node(p, true);
											if(tmp && tmp.length) {
												tmp.attr('aria-selected', true).children('.jstree-anchor').addClass( t ? 'jstree-clicked' : 'jstree-checked');
											}
										}
										else {
											break;
										}
										p = this.get_node(p.parent);
									}
								}
							}

							this._data[ t ? 'core' : 'checkbox' ].selected = $.vakata.array_unique(this._data[ t ? 'core' : 'checkbox' ].selected);
						}, this))
					.on(this.settings.checkbox.tie_selection ? 'select_node.jstree' : 'check_node.jstree', $.proxy(function (e, data) {
							var obj = data.node,
								m = this._model.data,
								par = this.get_node(obj.parent),
								dom = this.get_node(obj, true),
								i, j, c, tmp, s = this.settings.checkbox.cascade, t = this.settings.checkbox.tie_selection;

							// apply down
							if(s.indexOf('down') !== -1) {
								this._data[ t ? 'core' : 'checkbox' ].selected = $.vakata.array_unique(this._data[ t ? 'core' : 'checkbox' ].selected.concat(obj.children_d));
								for(i = 0, j = obj.children_d.length; i < j; i++) {
									tmp = m[obj.children_d[i]];
									tmp.state[ t ? 'selected' : 'checked' ] = true;
									if(tmp && tmp.original && tmp.original.state && tmp.original.state.undetermined) {
										tmp.original.state.undetermined = false;
									}
								}
							}

							// apply up
							if(s.indexOf('up') !== -1) {
								while(par && par.id !== '#') {
									c = 0;
									for(i = 0, j = par.children.length; i < j; i++) {
										c += m[par.children[i]].state[ t ? 'selected' : 'checked' ];
									}
									if(c === j) {
										par.state[ t ? 'selected' : 'checked' ] = true;
										this._data[ t ? 'core' : 'checkbox' ].selected.push(par.id);
										tmp = this.get_node(par, true);
										if(tmp && tmp.length) {
											tmp.attr('aria-selected', true).children('.jstree-anchor').addClass(t ? 'jstree-clicked' : 'jstree-checked');
										}
									}
									else {
										break;
									}
									par = this.get_node(par.parent);
								}
							}

							// apply down (process .children separately?)
							if(s.indexOf('down') !== -1 && dom.length) {
								dom.find('.jstree-anchor').addClass(t ? 'jstree-clicked' : 'jstree-checked').parent().attr('aria-selected', true);
							}
						}, this))
					.on(this.settings.checkbox.tie_selection ? 'deselect_all.jstree' : 'uncheck_all.jstree', $.proxy(function (e, data) {
							var obj = this.get_node('#'),
								m = this._model.data,
								i, j, tmp;
							for(i = 0, j = obj.children_d.length; i < j; i++) {
								tmp = m[obj.children_d[i]];
								if(tmp && tmp.original && tmp.original.state && tmp.original.state.undetermined) {
									tmp.original.state.undetermined = false;
								}
							}
						}, this))
					.on(this.settings.checkbox.tie_selection ? 'deselect_node.jstree' : 'uncheck_node.jstree', $.proxy(function (e, data) {
							var obj = data.node,
								dom = this.get_node(obj, true),
								i, j, tmp, s = this.settings.checkbox.cascade, t = this.settings.checkbox.tie_selection;
							if(obj && obj.original && obj.original.state && obj.original.state.undetermined) {
								obj.original.state.undetermined = false;
							}

							// apply down
							if(s.indexOf('down') !== -1) {
								for(i = 0, j = obj.children_d.length; i < j; i++) {
									tmp = this._model.data[obj.children_d[i]];
									tmp.state[ t ? 'selected' : 'checked' ] = false;
									if(tmp && tmp.original && tmp.original.state && tmp.original.state.undetermined) {
										tmp.original.state.undetermined = false;
									}
								}
							}

							// apply up
							if(s.indexOf('up') !== -1) {
								for(i = 0, j = obj.parents.length; i < j; i++) {
									tmp = this._model.data[obj.parents[i]];
									tmp.state[ t ? 'selected' : 'checked' ] = false;
									if(tmp && tmp.original && tmp.original.state && tmp.original.state.undetermined) {
										tmp.original.state.undetermined = false;
									}
									tmp = this.get_node(obj.parents[i], true);
									if(tmp && tmp.length) {
										tmp.attr('aria-selected', false).children('.jstree-anchor').removeClass(t ? 'jstree-clicked' : 'jstree-checked');
									}
								}
							}
							tmp = [];
							for(i = 0, j = this._data[ t ? 'core' : 'checkbox' ].selected.length; i < j; i++) {
								// apply down + apply up
								if(
									(s.indexOf('down') === -1 || $.inArray(this._data[ t ? 'core' : 'checkbox' ].selected[i], obj.children_d) === -1) &&
									(s.indexOf('up') === -1 || $.inArray(this._data[ t ? 'core' : 'checkbox' ].selected[i], obj.parents) === -1)
								) {
									tmp.push(this._data[ t ? 'core' : 'checkbox' ].selected[i]);
								}
							}
							this._data[ t ? 'core' : 'checkbox' ].selected = $.vakata.array_unique(tmp);

							// apply down (process .children separately?)
							if(s.indexOf('down') !== -1 && dom.length) {
								dom.find('.jstree-anchor').removeClass(t ? 'jstree-clicked' : 'jstree-checked').parent().attr('aria-selected', false);
							}
						}, this));
			}
			if(this.settings.checkbox.cascade.indexOf('up') !== -1) {
				this.element
					.on('delete_node.jstree', $.proxy(function (e, data) {
							// apply up (whole handler)
							var p = this.get_node(data.parent),
								m = this._model.data,
								i, j, c, tmp, t = this.settings.checkbox.tie_selection;
							while(p && p.id !== '#') {
								c = 0;
								for(i = 0, j = p.children.length; i < j; i++) {
									c += m[p.children[i]].state[ t ? 'selected' : 'checked' ];
								}
								if(c === j) {
									p.state[ t ? 'selected' : 'checked' ] = true;
									this._data[ t ? 'core' : 'checkbox' ].selected.push(p.id);
									tmp = this.get_node(p, true);
									if(tmp && tmp.length) {
										tmp.attr('aria-selected', true).children('.jstree-anchor').addClass(t ? 'jstree-clicked' : 'jstree-checked');
									}
								}
								else {
									break;
								}
								p = this.get_node(p.parent);
							}
						}, this))
					.on('move_node.jstree', $.proxy(function (e, data) {
							// apply up (whole handler)
							var is_multi = data.is_multi,
								old_par = data.old_parent,
								new_par = this.get_node(data.parent),
								m = this._model.data,
								p, c, i, j, tmp, t = this.settings.checkbox.tie_selection;
							if(!is_multi) {
								p = this.get_node(old_par);
								while(p && p.id !== '#') {
									c = 0;
									for(i = 0, j = p.children.length; i < j; i++) {
										c += m[p.children[i]].state[ t ? 'selected' : 'checked' ];
									}
									if(c === j) {
										p.state[ t ? 'selected' : 'checked' ] = true;
										this._data[ t ? 'core' : 'checkbox' ].selected.push(p.id);
										tmp = this.get_node(p, true);
										if(tmp && tmp.length) {
											tmp.attr('aria-selected', true).children('.jstree-anchor').addClass(t ? 'jstree-clicked' : 'jstree-checked');
										}
									}
									else {
										break;
									}
									p = this.get_node(p.parent);
								}
							}
							p = new_par;
							while(p && p.id !== '#') {
								c = 0;
								for(i = 0, j = p.children.length; i < j; i++) {
									c += m[p.children[i]].state[ t ? 'selected' : 'checked' ];
								}
								if(c === j) {
									if(!p.state[ t ? 'selected' : 'checked' ]) {
										p.state[ t ? 'selected' : 'checked' ] = true;
										this._data[ t ? 'core' : 'checkbox' ].selected.push(p.id);
										tmp = this.get_node(p, true);
										if(tmp && tmp.length) {
											tmp.attr('aria-selected', true).children('.jstree-anchor').addClass(t ? 'jstree-clicked' : 'jstree-checked');
										}
									}
								}
								else {
									if(p.state[ t ? 'selected' : 'checked' ]) {
										p.state[ t ? 'selected' : 'checked' ] = false;
										this._data[ t ? 'core' : 'checkbox' ].selected = $.vakata.array_remove_item(this._data[ t ? 'core' : 'checkbox' ].selected, p.id);
										tmp = this.get_node(p, true);
										if(tmp && tmp.length) {
											tmp.attr('aria-selected', false).children('.jstree-anchor').removeClass(t ? 'jstree-clicked' : 'jstree-checked');
										}
									}
									else {
										break;
									}
								}
								p = this.get_node(p.parent);
							}
						}, this));
			}
		};
		/**
		 * set the undetermined state where and if necessary. Used internally.
		 * @private
		 * @name _undetermined()
		 * @plugin checkbox
		 */
		this._undetermined = function () {
			var i, j, m = this._model.data, t = this.settings.checkbox.tie_selection, s = this._data[ t ? 'core' : 'checkbox' ].selected, p = [], tt = this;
			for(i = 0, j = s.length; i < j; i++) {
				if(m[s[i]] && m[s[i]].parents) {
					p = p.concat(m[s[i]].parents);
				}
			}
			// attempt for server side undetermined state
			this.element.find('.jstree-closed').not(':has(.jstree-children)')
				.each(function () {
					var tmp = tt.get_node(this), tmp2;
					if(!tmp.state.loaded) {
						if(tmp.original && tmp.original.state && tmp.original.state.undetermined && tmp.original.state.undetermined === true) {
							p.push(tmp.id);
							p = p.concat(tmp.parents);
						}
					}
					else {
						for(i = 0, j = tmp.children_d.length; i < j; i++) {
							tmp2 = m[tmp.children_d[i]];
							if(!tmp2.state.loaded && tmp2.original && tmp2.original.state && tmp2.original.state.undetermined && tmp2.original.state.undetermined === true) {
								p.push(tmp2.id);
								p = p.concat(tmp2.parents);
							}
						}
					}
				});
			p = $.vakata.array_unique(p);
			p = $.vakata.array_remove_item(p,'#');

			this.element.find('.jstree-undetermined').removeClass('jstree-undetermined');
			for(i = 0, j = p.length; i < j; i++) {
				if(!m[p[i]].state[ t ? 'selected' : 'checked' ]) {
					s = this.get_node(p[i], true);
					if(s && s.length) {
						s.children('.jstree-anchor').children('.jstree-checkbox').addClass('jstree-undetermined');
					}
				}
			}
		};
		this.redraw_node = function(obj, deep, is_callback, force_render) {
			obj = parent.redraw_node.apply(this, arguments);
			if(obj) {
				var i, j, tmp = null;
				for(i = 0, j = obj.childNodes.length; i < j; i++) {
					if(obj.childNodes[i] && obj.childNodes[i].className && obj.childNodes[i].className.indexOf("jstree-anchor") !== -1) {
						tmp = obj.childNodes[i];
						break;
					}
				}
				if(tmp) {
					if(!this.settings.checkbox.tie_selection && this._model.data[obj.id].state.checked) { tmp.className += ' jstree-checked'; }
					tmp.insertBefore(_i.cloneNode(false), tmp.childNodes[0]);
				}
			}
			if(!is_callback && this.settings.checkbox.cascade.indexOf('undetermined') !== -1) {
				if(this._data.checkbox.uto) { clearTimeout(this._data.checkbox.uto); }
				this._data.checkbox.uto = setTimeout($.proxy(this._undetermined, this), 50);
			}
			return obj;
		};
		/**
		 * show the node checkbox icons
		 * @name show_checkboxes()
		 * @plugin checkbox
		 */
		this.show_checkboxes = function () { this._data.core.themes.checkboxes = true; this.get_container_ul().removeClass("jstree-no-checkboxes"); };
		/**
		 * hide the node checkbox icons
		 * @name hide_checkboxes()
		 * @plugin checkbox
		 */
		this.hide_checkboxes = function () { this._data.core.themes.checkboxes = false; this.get_container_ul().addClass("jstree-no-checkboxes"); };
		/**
		 * toggle the node icons
		 * @name toggle_checkboxes()
		 * @plugin checkbox
		 */
		this.toggle_checkboxes = function () { if(this._data.core.themes.checkboxes) { this.hide_checkboxes(); } else { this.show_checkboxes(); } };
		/**
		 * checks if a node is in an undetermined state
		 * @name is_undetermined(obj)
		 * @param  {mixed} obj
		 * @return {Boolean}
		 */
		this.is_undetermined = function (obj) {
			obj = this.get_node(obj);
			var s = this.settings.checkbox.cascade, i, j, t = this.settings.checkbox.tie_selection, d = this._data[ t ? 'core' : 'checkbox' ].selected, m = this._model.data;
			if(!obj || obj.state[ t ? 'selected' : 'checked' ] === true || s.indexOf('undetermined') === -1 || (s.indexOf('down') === -1 && s.indexOf('up') === -1)) {
				return false;
			}
			if(!obj.state.loaded && obj.original.state.undetermined === true) {
				return true;
			}
			for(i = 0, j = obj.children_d.length; i < j; i++) {
				if($.inArray(obj.children_d[i], d) !== -1 || (!m[obj.children_d[i]].state.loaded && m[obj.children_d[i]].original.state.undetermined)) {
					return true;
				}
			}
			return false;
		};

		this.activate_node = function (obj, e) {
			if(this.settings.checkbox.tie_selection && (this.settings.checkbox.whole_node || $(e.target).hasClass('jstree-checkbox'))) {
				e.ctrlKey = true;
			}
			if(this.settings.checkbox.tie_selection || (!this.settings.checkbox.whole_node && !$(e.target).hasClass('jstree-checkbox'))) {
				return parent.activate_node.call(this, obj, e);
			}
			if(this.is_checked(obj)) {
				this.uncheck_node(obj, e);
			}
			else {
				this.check_node(obj, e);
			}
			this.trigger('activate_node', { 'node' : this.get_node(obj) });
		};

		/**
		 * check a node (only if tie_selection in checkbox settings is false, otherwise select_node will be called internally)
		 * @name check_node(obj)
		 * @param {mixed} obj an array can be used to check multiple nodes
		 * @trigger check_node.jstree
		 * @plugin checkbox
		 */
		this.check_node = function (obj, e) {
			if(this.settings.checkbox.tie_selection) { return this.select_node(obj, false, true, e); }
			var dom, t1, t2, th;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.check_node(obj[t1], e);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			dom = this.get_node(obj, true);
			if(!obj.state.checked) {
				obj.state.checked = true;
				this._data.checkbox.selected.push(obj.id);
				if(dom && dom.length) {
					dom.children('.jstree-anchor').addClass('jstree-checked');
				}
				/**
				 * triggered when an node is checked (only if tie_selection in checkbox settings is false)
				 * @event
				 * @name check_node.jstree
				 * @param {Object} node
				 * @param {Array} selected the current selection
				 * @param {Object} event the event (if any) that triggered this check_node
				 * @plugin checkbox
				 */
				this.trigger('check_node', { 'node' : obj, 'selected' : this._data.checkbox.selected, 'event' : e });
			}
		};
		/**
		 * uncheck a node (only if tie_selection in checkbox settings is false, otherwise deselect_node will be called internally)
		 * @name deselect_node(obj)
		 * @param {mixed} obj an array can be used to deselect multiple nodes
		 * @trigger uncheck_node.jstree
		 * @plugin checkbox
		 */
		this.uncheck_node = function (obj, e) {
			if(this.settings.checkbox.tie_selection) { return this.deselect_node(obj, false, e); }
			var t1, t2, dom;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.uncheck_node(obj[t1], e);
				}
				return true;
			}
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') {
				return false;
			}
			dom = this.get_node(obj, true);
			if(obj.state.checked) {
				obj.state.checked = false;
				this._data.checkbox.selected = $.vakata.array_remove_item(this._data.checkbox.selected, obj.id);
				if(dom.length) {
					dom.children('.jstree-anchor').removeClass('jstree-checked');
				}
				/**
				 * triggered when an node is unchecked (only if tie_selection in checkbox settings is false)
				 * @event
				 * @name uncheck_node.jstree
				 * @param {Object} node
				 * @param {Array} selected the current selection
				 * @param {Object} event the event (if any) that triggered this uncheck_node
				 * @plugin checkbox
				 */
				this.trigger('uncheck_node', { 'node' : obj, 'selected' : this._data.checkbox.selected, 'event' : e });
			}
		};
		/**
		 * checks all nodes in the tree (only if tie_selection in checkbox settings is false, otherwise select_all will be called internally)
		 * @name check_all()
		 * @trigger check_all.jstree, changed.jstree
		 * @plugin checkbox
		 */
		this.check_all = function () {
			if(this.settings.checkbox.tie_selection) { return this.select_all(); }
			var tmp = this._data.checkbox.selected.concat([]), i, j;
			this._data.checkbox.selected = this._model.data['#'].children_d.concat();
			for(i = 0, j = this._data.checkbox.selected.length; i < j; i++) {
				if(this._model.data[this._data.checkbox.selected[i]]) {
					this._model.data[this._data.checkbox.selected[i]].state.checked = true;
				}
			}
			this.redraw(true);
			/**
			 * triggered when all nodes are checked (only if tie_selection in checkbox settings is false)
			 * @event
			 * @name check_all.jstree
			 * @param {Array} selected the current selection
			 * @plugin checkbox
			 */
			this.trigger('check_all', { 'selected' : this._data.checkbox.selected });
		};
		/**
		 * uncheck all checked nodes (only if tie_selection in checkbox settings is false, otherwise deselect_all will be called internally)
		 * @name uncheck_all()
		 * @trigger uncheck_all.jstree
		 * @plugin checkbox
		 */
		this.uncheck_all = function () {
			if(this.settings.checkbox.tie_selection) { return this.deselect_all(); }
			var tmp = this._data.checkbox.selected.concat([]), i, j;
			for(i = 0, j = this._data.checkbox.selected.length; i < j; i++) {
				if(this._model.data[this._data.checkbox.selected[i]]) {
					this._model.data[this._data.checkbox.selected[i]].state.checked = false;
				}
			}
			this._data.checkbox.selected = [];
			this.element.find('.jstree-checked').removeClass('jstree-checked');
			/**
			 * triggered when all nodes are unchecked (only if tie_selection in checkbox settings is false)
			 * @event
			 * @name uncheck_all.jstree
			 * @param {Object} node the previous selection
			 * @param {Array} selected the current selection
			 * @plugin checkbox
			 */
			this.trigger('uncheck_all', { 'selected' : this._data.checkbox.selected, 'node' : tmp });
		};
		/**
		 * checks if a node is checked (if tie_selection is on in the settings this function will return the same as is_selected)
		 * @name is_checked(obj)
		 * @param  {mixed}  obj
		 * @return {Boolean}
		 * @plugin checkbox
		 */
		this.is_checked = function (obj) {
			if(this.settings.checkbox.tie_selection) { return this.is_selected(obj); }
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			return obj.state.checked;
		};
		/**
		 * get an array of all checked nodes (if tie_selection is on in the settings this function will return the same as get_selected)
		 * @name get_checked([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 * @plugin checkbox
		 */
		this.get_checked = function (full) {
			if(this.settings.checkbox.tie_selection) { return this.get_selected(full); }
			return full ? $.map(this._data.checkbox.selected, $.proxy(function (i) { return this.get_node(i); }, this)) : this._data.checkbox.selected;
		};
		/**
		 * get an array of all top level checked nodes (ignoring children of checked nodes) (if tie_selection is on in the settings this function will return the same as get_top_selected)
		 * @name get_top_checked([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 * @plugin checkbox
		 */
		this.get_top_checked = function (full) {
			if(this.settings.checkbox.tie_selection) { return this.get_top_selected(full); }
			var tmp = this.get_checked(true),
				obj = {}, i, j, k, l;
			for(i = 0, j = tmp.length; i < j; i++) {
				obj[tmp[i].id] = tmp[i];
			}
			for(i = 0, j = tmp.length; i < j; i++) {
				for(k = 0, l = tmp[i].children_d.length; k < l; k++) {
					if(obj[tmp[i].children_d[k]]) {
						delete obj[tmp[i].children_d[k]];
					}
				}
			}
			tmp = [];
			for(i in obj) {
				if(obj.hasOwnProperty(i)) {
					tmp.push(i);
				}
			}
			return full ? $.map(tmp, $.proxy(function (i) { return this.get_node(i); }, this)) : tmp;
		};
		/**
		 * get an array of all bottom level checked nodes (ignoring selected parents) (if tie_selection is on in the settings this function will return the same as get_bottom_selected)
		 * @name get_bottom_checked([full])
		 * @param  {mixed}  full if set to `true` the returned array will consist of the full node objects, otherwise - only IDs will be returned
		 * @return {Array}
		 * @plugin checkbox
		 */
		this.get_bottom_checked = function (full) {
			if(this.settings.checkbox.tie_selection) { return this.get_bottom_selected(full); }
			var tmp = this.get_checked(true),
				obj = [], i, j;
			for(i = 0, j = tmp.length; i < j; i++) {
				if(!tmp[i].children.length) {
					obj.push(tmp[i].id);
				}
			}
			return full ? $.map(obj, $.proxy(function (i) { return this.get_node(i); }, this)) : obj;
		};
	};

	// include the checkbox plugin by default
	// $.jstree.defaults.plugins.push("checkbox");

/**
 * ### Contextmenu plugin
 *
 * Shows a context menu when a node is right-clicked.
 */

	/**
	 * stores all defaults for the contextmenu plugin
	 * @name $.jstree.defaults.contextmenu
	 * @plugin contextmenu
	 */
	$.jstree.defaults.contextmenu = {
		/**
		 * a boolean indicating if the node should be selected when the context menu is invoked on it. Defaults to `true`.
		 * @name $.jstree.defaults.contextmenu.select_node
		 * @plugin contextmenu
		 */
		select_node : true,
		/**
		 * a boolean indicating if the menu should be shown aligned with the node. Defaults to `true`, otherwise the mouse coordinates are used.
		 * @name $.jstree.defaults.contextmenu.show_at_node
		 * @plugin contextmenu
		 */
		show_at_node : true,
		/**
		 * an object of actions, or a function that accepts a node and a callback function and calls the callback function with an object of actions available for that node (you can also return the items too).
		 * 
		 * Each action consists of a key (a unique name) and a value which is an object with the following properties (only label and action are required):
		 * 
		 * * `separator_before` - a boolean indicating if there should be a separator before this item
		 * * `separator_after` - a boolean indicating if there should be a separator after this item
		 * * `_disabled` - a boolean indicating if this action should be disabled
		 * * `label` - a string - the name of the action (could be a function returning a string)
		 * * `action` - a function to be executed if this item is chosen
		 * * `icon` - a string, can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class
		 * * `shortcut` - keyCode which will trigger the action if the menu is open (for example `113` for rename, which equals F2)
		 * * `shortcut_label` - shortcut label (like for example `F2` for rename)
		 * 
		 * @name $.jstree.defaults.contextmenu.items
		 * @plugin contextmenu
		 */
		items : function (o, cb) { // Could be an object directly
			return {
				"create" : {
					"separator_before"	: false,
					"separator_after"	: true,
					"_disabled"			: false, //(this.check("create_node", data.reference, {}, "last")),
					"label"				: "Create",
					"action"			: function (data) {
						var inst = $.jstree.reference(data.reference),
							obj = inst.get_node(data.reference);
						inst.create_node(obj, {}, "last", function (new_node) {
							setTimeout(function () { inst.edit(new_node); },0);
						});
					}
				},
				"rename" : {
					"separator_before"	: false,
					"separator_after"	: false,
					"_disabled"			: false, //(this.check("rename_node", data.reference, this.get_parent(data.reference), "")),
					"label"				: "Rename",
					/*
					"shortcut"			: 113,
					"shortcut_label"	: 'F2',
					"icon"				: "glyphicon glyphicon-leaf",
					*/
					"action"			: function (data) {
						var inst = $.jstree.reference(data.reference),
							obj = inst.get_node(data.reference);
						inst.edit(obj);
					}
				},
				"remove" : {
					"separator_before"	: false,
					"icon"				: false,
					"separator_after"	: false,
					"_disabled"			: false, //(this.check("delete_node", data.reference, this.get_parent(data.reference), "")),
					"label"				: "Delete",
					"action"			: function (data) {
						var inst = $.jstree.reference(data.reference),
							obj = inst.get_node(data.reference);
						if(inst.is_selected(obj)) {
							inst.delete_node(inst.get_selected());
						}
						else {
							inst.delete_node(obj);
						}
					}
				},
				"ccp" : {
					"separator_before"	: true,
					"icon"				: false,
					"separator_after"	: false,
					"label"				: "Edit",
					"action"			: false,
					"submenu" : {
						"cut" : {
							"separator_before"	: false,
							"separator_after"	: false,
							"label"				: "Cut",
							"action"			: function (data) {
								var inst = $.jstree.reference(data.reference),
									obj = inst.get_node(data.reference);
								if(inst.is_selected(obj)) {
									inst.cut(inst.get_selected());
								}
								else {
									inst.cut(obj);
								}
							}
						},
						"copy" : {
							"separator_before"	: false,
							"icon"				: false,
							"separator_after"	: false,
							"label"				: "Copy",
							"action"			: function (data) {
								var inst = $.jstree.reference(data.reference),
									obj = inst.get_node(data.reference);
								if(inst.is_selected(obj)) {
									inst.copy(inst.get_selected());
								}
								else {
									inst.copy(obj);
								}
							}
						},
						"paste" : {
							"separator_before"	: false,
							"icon"				: false,
							"_disabled"			: function (data) {
								return !$.jstree.reference(data.reference).can_paste();
							},
							"separator_after"	: false,
							"label"				: "Paste",
							"action"			: function (data) {
								var inst = $.jstree.reference(data.reference),
									obj = inst.get_node(data.reference);
								inst.paste(obj);
							}
						}
					}
				}
			};
		}
	};

	$.jstree.plugins.contextmenu = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);

			var last_ts = 0;
			this.element
				.on("contextmenu.jstree", ".jstree-anchor", $.proxy(function (e) {
						e.preventDefault();
						last_ts = e.ctrlKey ? e.timeStamp : 0;
						if(!this.is_loading(e.currentTarget)) {
							this.show_contextmenu(e.currentTarget, e.pageX, e.pageY, e);
						}
					}, this))
				.on("click.jstree", ".jstree-anchor", $.proxy(function (e) {
						if(this._data.contextmenu.visible && (!last_ts || e.timeStamp - last_ts > 250)) { // work around safari & macOS ctrl+click
							$.vakata.context.hide();
						}
					}, this));
			/*
			if(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {
				var el = null, tm = null;
				this.element
					.on("touchstart", ".jstree-anchor", function (e) {
						el = e.currentTarget;
						tm = +new Date();
						$(document).one("touchend", function (e) {
							e.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);
							e.currentTarget = e.target;
							tm = ((+(new Date())) - tm);
							if(e.target === el && tm > 600 && tm < 1000) {
								e.preventDefault();
								$(el).trigger('contextmenu', e);
							}
							el = null;
							tm = null;
						});
					});
			}
			*/
			$(document).on("context_hide.vakata.jstree", $.proxy(function () { this._data.contextmenu.visible = false; }, this));
		};
		this.teardown = function () {
			if(this._data.contextmenu.visible) {
				$.vakata.context.hide();
			}
			parent.teardown.call(this);
		};

		/**
		 * prepare and show the context menu for a node
		 * @name show_contextmenu(obj [, x, y])
		 * @param {mixed} obj the node
		 * @param {Number} x the x-coordinate relative to the document to show the menu at
		 * @param {Number} y the y-coordinate relative to the document to show the menu at
		 * @param {Object} e the event if available that triggered the contextmenu
		 * @plugin contextmenu
		 * @trigger show_contextmenu.jstree
		 */
		this.show_contextmenu = function (obj, x, y, e) {
			obj = this.get_node(obj);
			if(!obj || obj.id === '#') { return false; }
			var s = this.settings.contextmenu,
				d = this.get_node(obj, true),
				a = d.children(".jstree-anchor"),
				o = false,
				i = false;
			if(s.show_at_node || x === undefined || y === undefined) {
				o = a.offset();
				x = o.left;
				y = o.top + this._data.core.li_height;
			}
			if(this.settings.contextmenu.select_node && !this.is_selected(obj)) {
				this.activate_node(obj, e);
			}

			i = s.items;
			if($.isFunction(i)) {
				i = i.call(this, obj, $.proxy(function (i) {
					this._show_contextmenu(obj, x, y, i);
				}, this));
			}
			if($.isPlainObject(i)) {
				this._show_contextmenu(obj, x, y, i);
			}
		};
		/**
		 * show the prepared context menu for a node
		 * @name _show_contextmenu(obj, x, y, i)
		 * @param {mixed} obj the node
		 * @param {Number} x the x-coordinate relative to the document to show the menu at
		 * @param {Number} y the y-coordinate relative to the document to show the menu at
		 * @param {Number} i the object of items to show
		 * @plugin contextmenu
		 * @trigger show_contextmenu.jstree
		 * @private
		 */
		this._show_contextmenu = function (obj, x, y, i) {
			var d = this.get_node(obj, true),
				a = d.children(".jstree-anchor");
			$(document).one("context_show.vakata.jstree", $.proxy(function (e, data) {
				var cls = 'jstree-contextmenu jstree-' + this.get_theme() + '-contextmenu';
				$(data.element).addClass(cls);
			}, this));
			this._data.contextmenu.visible = true;
			$.vakata.context.show(a, { 'x' : x, 'y' : y }, i);
			/**
			 * triggered when the contextmenu is shown for a node
			 * @event
			 * @name show_contextmenu.jstree
			 * @param {Object} node the node
			 * @param {Number} x the x-coordinate of the menu relative to the document
			 * @param {Number} y the y-coordinate of the menu relative to the document
			 * @plugin contextmenu
			 */
			this.trigger('show_contextmenu', { "node" : obj, "x" : x, "y" : y });
		};
	};

	// contextmenu helper
	(function ($) {
		var right_to_left = false,
			vakata_context = {
				element		: false,
				reference	: false,
				position_x	: 0,
				position_y	: 0,
				items		: [],
				html		: "",
				is_visible	: false
			};

		$.vakata.context = {
			settings : {
				hide_onmouseleave	: 0,
				icons				: true
			},
			_trigger : function (event_name) {
				$(document).triggerHandler("context_" + event_name + ".vakata", {
					"reference"	: vakata_context.reference,
					"element"	: vakata_context.element,
					"position"	: {
						"x" : vakata_context.position_x,
						"y" : vakata_context.position_y
					}
				});
			},
			_execute : function (i) {
				i = vakata_context.items[i];
				return i && (!i._disabled || ($.isFunction(i._disabled) && !i._disabled({ "item" : i, "reference" : vakata_context.reference, "element" : vakata_context.element }))) && i.action ? i.action.call(null, {
							"item"		: i,
							"reference"	: vakata_context.reference,
							"element"	: vakata_context.element,
							"position"	: {
								"x" : vakata_context.position_x,
								"y" : vakata_context.position_y
							}
						}) : false;
			},
			_parse : function (o, is_callback) {
				if(!o) { return false; }
				if(!is_callback) {
					vakata_context.html		= "";
					vakata_context.items	= [];
				}
				var str = "",
					sep = false,
					tmp;

				if(is_callback) { str += "<"+"ul>"; }
				$.each(o, function (i, val) {
					if(!val) { return true; }
					vakata_context.items.push(val);
					if(!sep && val.separator_before) {
						str += "<"+"li class='vakata-context-separator'><"+"a href='#' " + ($.vakata.context.settings.icons ? '' : 'style="margin-left:0px;"') + ">&#160;<"+"/a><"+"/li>";
					}
					sep = false;
					str += "<"+"li class='" + (val._class || "") + (val._disabled === true || ($.isFunction(val._disabled) && val._disabled({ "item" : val, "reference" : vakata_context.reference, "element" : vakata_context.element })) ? " vakata-contextmenu-disabled " : "") + "' "+(val.shortcut?" data-shortcut='"+val.shortcut+"' ":'')+">";
					str += "<"+"a href='#' rel='" + (vakata_context.items.length - 1) + "'>";
					if($.vakata.context.settings.icons) {
						str += "<"+"i ";
						if(val.icon) {
							if(val.icon.indexOf("/") !== -1 || val.icon.indexOf(".") !== -1) { str += " style='background:url(\"" + val.icon + "\") center center no-repeat' "; }
							else { str += " class='" + val.icon + "' "; }
						}
						str += "><"+"/i><"+"span class='vakata-contextmenu-sep'>&#160;<"+"/span>";
					}
					str += ($.isFunction(val.label) ? val.label({ "item" : i, "reference" : vakata_context.reference, "element" : vakata_context.element }) : val.label) + (val.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'">'+ (val.shortcut_label || '') +'</span>':'') + "<"+"/a>";
					if(val.submenu) {
						tmp = $.vakata.context._parse(val.submenu, true);
						if(tmp) { str += tmp; }
					}
					str += "<"+"/li>";
					if(val.separator_after) {
						str += "<"+"li class='vakata-context-separator'><"+"a href='#' " + ($.vakata.context.settings.icons ? '' : 'style="margin-left:0px;"') + ">&#160;<"+"/a><"+"/li>";
						sep = true;
					}
				});
				str  = str.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");
				if(is_callback) { str += "</ul>"; }
				/**
				 * triggered on the document when the contextmenu is parsed (HTML is built)
				 * @event
				 * @plugin contextmenu
				 * @name context_parse.vakata
				 * @param {jQuery} reference the element that was right clicked
				 * @param {jQuery} element the DOM element of the menu itself
				 * @param {Object} position the x & y coordinates of the menu
				 */
				if(!is_callback) { vakata_context.html = str; $.vakata.context._trigger("parse"); }
				return str.length > 10 ? str : false;
			},
			_show_submenu : function (o) {
				o = $(o);
				if(!o.length || !o.children("ul").length) { return; }
				var e = o.children("ul"),
					x = o.offset().left + o.outerWidth(),
					y = o.offset().top,
					w = e.width(),
					h = e.height(),
					dw = $(window).width() + $(window).scrollLeft(),
					dh = $(window).height() + $(window).scrollTop();
				//        -       
				if(right_to_left) {
					o[x - (w + 10 + o.outerWidth()) < 0 ? "addClass" : "removeClass"]("vakata-context-left");
				}
				else {
					o[x + w + 10 > dw ? "addClass" : "removeClass"]("vakata-context-right");
				}
				if(y + h + 10 > dh) {
					e.css("bottom","-1px");
				}
				e.show();
			},
			show : function (reference, position, data) {
				var o, e, x, y, w, h, dw, dh, cond = true;
				if(vakata_context.element && vakata_context.element.length) {
					vakata_context.element.width('');
				}
				switch(cond) {
					case (!position && !reference):
						return false;
					case (!!position && !!reference):
						vakata_context.reference	= reference;
						vakata_context.position_x	= position.x;
						vakata_context.position_y	= position.y;
						break;
					case (!position && !!reference):
						vakata_context.reference	= reference;
						o = reference.offset();
						vakata_context.position_x	= o.left + reference.outerHeight();
						vakata_context.position_y	= o.top;
						break;
					case (!!position && !reference):
						vakata_context.position_x	= position.x;
						vakata_context.position_y	= position.y;
						break;
				}
				if(!!reference && !data && $(reference).data('vakata_contextmenu')) {
					data = $(reference).data('vakata_contextmenu');
				}
				if($.vakata.context._parse(data)) {
					vakata_context.element.html(vakata_context.html);
				}
				if(vakata_context.items.length) {
					vakata_context.element.appendTo("body");
					e = vakata_context.element;
					x = vakata_context.position_x;
					y = vakata_context.position_y;
					w = e.width();
					h = e.height();
					dw = $(window).width() + $(window).scrollLeft();
					dh = $(window).height() + $(window).scrollTop();
					if(right_to_left) {
						x -= e.outerWidth();
						if(x < $(window).scrollLeft() + 20) {
							x = $(window).scrollLeft() + 20;
						}
					}
					if(x + w + 20 > dw) {
						x = dw - (w + 20);
					}
					if(y + h + 20 > dh) {
						y = dh - (h + 20);
					}

					vakata_context.element
						.css({ "left" : x, "top" : y })
						.show()
						.find('a').first().focus().parent().addClass("vakata-context-hover");
					vakata_context.is_visible = true;
					/**
					 * triggered on the document when the contextmenu is shown
					 * @event
					 * @plugin contextmenu
					 * @name context_show.vakata
					 * @param {jQuery} reference the element that was right clicked
					 * @param {jQuery} element the DOM element of the menu itself
					 * @param {Object} position the x & y coordinates of the menu
					 */
					$.vakata.context._trigger("show");
				}
			},
			hide : function () {
				if(vakata_context.is_visible) {
					vakata_context.element.hide().find("ul").hide().end().find(':focus').blur().end().detach();
					vakata_context.is_visible = false;
					/**
					 * triggered on the document when the contextmenu is hidden
					 * @event
					 * @plugin contextmenu
					 * @name context_hide.vakata
					 * @param {jQuery} reference the element that was right clicked
					 * @param {jQuery} element the DOM element of the menu itself
					 * @param {Object} position the x & y coordinates of the menu
					 */
					$.vakata.context._trigger("hide");
				}
			}
		};
		$(function () {
			right_to_left = $("body").css("direction") === "rtl";
			var to = false;

			vakata_context.element = $("<ul class='vakata-context'></ul>");
			vakata_context.element
				.on("mouseenter", "li", function (e) {
					e.stopImmediatePropagation();

					if($.contains(this, e.relatedTarget)) {
						//   delegate mouseleave -
						// $(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
						return;
					}

					if(to) { clearTimeout(to); }
					vakata_context.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end();

					$(this)
						.siblings().find("ul").hide().end().end()
						.parentsUntil(".vakata-context", "li").addBack().addClass("vakata-context-hover");
					$.vakata.context._show_submenu(this);
				})
				//  -   ?
				.on("mouseleave", "li", function (e) {
					if($.contains(this, e.relatedTarget)) { return; }
					$(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover");
				})
				.on("mouseleave", function (e) {
					$(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
					if($.vakata.context.settings.hide_onmouseleave) {
						to = setTimeout(
							(function (t) {
								return function () { $.vakata.context.hide(); };
							}(this)), $.vakata.context.settings.hide_onmouseleave);
					}
				})
				.on("click", "a", function (e) {
					e.preventDefault();
				//})
				//.on("mouseup", "a", function (e) {
					if(!$(this).blur().parent().hasClass("vakata-context-disabled") && $.vakata.context._execute($(this).attr("rel")) !== false) {
						$.vakata.context.hide();
					}
				})
				.on('keydown', 'a', function (e) {
						var o = null;
						switch(e.which) {
							case 13:
							case 32:
								e.type = "mouseup";
								e.preventDefault();
								$(e.currentTarget).trigger(e);
								break;
							case 37:
								if(vakata_context.is_visible) {
									vakata_context.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children('a').focus();
									e.stopImmediatePropagation();
									e.preventDefault();
								}
								break;
							case 38:
								if(vakata_context.is_visible) {
									o = vakata_context.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();
									if(!o.length) { o = vakata_context.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last(); }
									o.addClass("vakata-context-hover").children('a').focus();
									e.stopImmediatePropagation();
									e.preventDefault();
								}
								break;
							case 39:
								if(vakata_context.is_visible) {
									vakata_context.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children('a').focus();
									e.stopImmediatePropagation();
									e.preventDefault();
								}
								break;
							case 40:
								if(vakata_context.is_visible) {
									o = vakata_context.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first();
									if(!o.length) { o = vakata_context.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first(); }
									o.addClass("vakata-context-hover").children('a').focus();
									e.stopImmediatePropagation();
									e.preventDefault();
								}
								break;
							case 27:
								$.vakata.context.hide();
								e.preventDefault();
								break;
							default:
								//console.log(e.which);
								break;
						}
					})
				.on('keydown', function (e) {
					e.preventDefault();
					var a = vakata_context.element.find('.vakata-contextmenu-shortcut-' + e.which).parent();
					if(a.parent().not('.vakata-context-disabled')) {
						a.click();
					}
				});

			$(document)
				.on("mousedown.vakata.jstree", function (e) {
					if(vakata_context.is_visible && !$.contains(vakata_context.element[0], e.target)) { $.vakata.context.hide(); }
				})
				.on("context_show.vakata.jstree", function (e, data) {
					vakata_context.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");
					if(right_to_left) {
						vakata_context.element.addClass("vakata-context-rtl").css("direction", "rtl");
					}
					// also apply a RTL class?
					vakata_context.element.find("ul").hide().end();
				});
		});
	}($));
	// $.jstree.defaults.plugins.push("contextmenu");

/**
 * ### Drag'n'drop plugin
 *
 * Enables dragging and dropping of nodes in the tree, resulting in a move or copy operations.
 */

	/**
	 * stores all defaults for the drag'n'drop plugin
	 * @name $.jstree.defaults.dnd
	 * @plugin dnd
	 */
	$.jstree.defaults.dnd = {
		/**
		 * a boolean indicating if a copy should be possible while dragging (by pressint the meta key or Ctrl). Defaults to `true`.
		 * @name $.jstree.defaults.dnd.copy
		 * @plugin dnd
		 */
		copy : true,
		/**
		 * a number indicating how long a node should remain hovered while dragging to be opened. Defaults to `500`.
		 * @name $.jstree.defaults.dnd.open_timeout
		 * @plugin dnd
		 */
		open_timeout : 500,
		/**
		 * a function invoked each time a node is about to be dragged, invoked in the tree's scope and receives the nodes about to be dragged as an argument (array) - return `false` to prevent dragging
		 * @name $.jstree.defaults.dnd.is_draggable
		 * @plugin dnd
		 */
		is_draggable : true,
		/**
		 * a boolean indicating if checks should constantly be made while the user is dragging the node (as opposed to checking only on drop), default is `true`
		 * @name $.jstree.defaults.dnd.check_while_dragging
		 * @plugin dnd
		 */
		check_while_dragging : true,
		/**
		 * a boolean indicating if nodes from this tree should only be copied with dnd (as opposed to moved), default is `false`
		 * @name $.jstree.defaults.dnd.always_copy
		 * @plugin dnd
		 */
		always_copy : false,
		/**
		 * when dropping a node "inside", this setting indicates the position the node should go to - it can be an integer or a string: "first" (same as 0) or "last", default is `0`
		 * @name $.jstree.defaults.dnd.inside_pos
		 * @plugin dnd
		 */
		inside_pos : 0
	};
	// TODO: now check works by checking for each node individually, how about max_children, unique, etc?
	$.jstree.plugins.dnd = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);

			this.element
				.on('mousedown.jstree touchstart.jstree', '.jstree-anchor', $.proxy(function (e) {
					var obj = this.get_node(e.target),
						mlt = this.is_selected(obj) ? this.get_selected().length : 1;
					if(obj && obj.id && obj.id !== "#" && (e.which === 1 || e.type === "touchstart") &&
						(this.settings.dnd.is_draggable === true || ($.isFunction(this.settings.dnd.is_draggable) && this.settings.dnd.is_draggable.call(this, (mlt > 1 ? this.get_selected(true) : [obj]))))
					) {
						this.element.trigger('mousedown.jstree');
						return $.vakata.dnd.start(e, { 'jstree' : true, 'origin' : this, 'obj' : this.get_node(obj,true), 'nodes' : mlt > 1 ? this.get_selected() : [obj.id] }, '<div id="jstree-dnd" class="jstree-' + this.get_theme() + ' jstree-' + this.get_theme() + '-' + this.get_theme_variant() + ' ' + ( this.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ) + '"><i class="jstree-icon jstree-er"></i>' + (mlt > 1 ? mlt + ' ' + this.get_string('nodes') : this.get_text(e.currentTarget, true)) + '<ins class="jstree-copy" style="display:none;">+</ins></div>');
					}
				}, this));
		};
	};

	$(function() {
		// bind only once for all instances
		var lastmv = false,
			laster = false,
			opento = false,
			marker = $('<div id="jstree-marker">&#160;</div>').hide(); //.appendTo('body');

		$(document)
			.on('dnd_start.vakata.jstree', function (e, data) {
				lastmv = false;
				if(!data || !data.data || !data.data.jstree) { return; }
				marker.appendTo('body'); //.show();
			})
			.on('dnd_move.vakata.jstree', function (e, data) {
				if(opento) { clearTimeout(opento); }
				if(!data || !data.data || !data.data.jstree) { return; }

				// if we are hovering the marker image do nothing (can happen on "inside" drags)
				if(data.event.target.id && data.event.target.id === 'jstree-marker') {
					return;
				}

				var ins = $.jstree.reference(data.event.target),
					ref = false,
					off = false,
					rel = false,
					l, t, h, p, i, o, ok, t1, t2, op, ps, pr, ip, tm;
				// if we are over an instance
				if(ins && ins._data && ins._data.dnd) {
					marker.attr('class', 'jstree-' + ins.get_theme() + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ));
					data.helper
						.children().attr('class', 'jstree-' + ins.get_theme() + ' jstree-' + ins.get_theme() + '-' + ins.get_theme_variant() + ' ' + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ))
						.find('.jstree-copy').first()[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? 'show' : 'hide' ]();


					// if are hovering the container itself add a new root node
					if( (data.event.target === ins.element[0] || data.event.target === ins.get_container_ul()[0]) && ins.get_container_ul().children().length === 0) {
						ok = true;
						for(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {
							ok = ok && ins.check( (data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey)) ) ? "copy_node" : "move_node"), (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), '#', 'last', { 'dnd' : true, 'ref' : ins.get_node('#'), 'pos' : 'i', 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) });
							if(!ok) { break; }
						}
						if(ok) {
							lastmv = { 'ins' : ins, 'par' : '#', 'pos' : 'last' };
							marker.hide();
							data.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');
							return;
						}
					}
					else {
						// if we are hovering a tree node
						ref = $(data.event.target).closest('.jstree-anchor');
						if(ref && ref.length && ref.parent().is('.jstree-closed, .jstree-open, .jstree-leaf')) {
							off = ref.offset();
							rel = data.event.pageY - off.top;
							h = ref.height();
							if(rel < h / 3) {
								o = ['b', 'i', 'a'];
							}
							else if(rel > h - h / 3) {
								o = ['a', 'i', 'b'];
							}
							else {
								o = rel > h / 2 ? ['i', 'a', 'b'] : ['i', 'b', 'a'];
							}
							$.each(o, function (j, v) {
								switch(v) {
									case 'b':
										l = off.left - 6;
										t = off.top;
										p = ins.get_parent(ref);
										i = ref.parent().index();
										break;
									case 'i':
										ip = ins.settings.dnd.inside_pos;
										tm = ins.get_node(ref.parent());
										l = off.left - 2;
										t = off.top + h / 2 + 1;
										p = tm.id;
										i = ip === 'first' ? 0 : (ip === 'last' ? tm.children.length : Math.min(ip, tm.children.length));
										break;
									case 'a':
										l = off.left - 6;
										t = off.top + h;
										p = ins.get_parent(ref);
										i = ref.parent().index() + 1;
										break;
								}
								ok = true;
								for(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {
									op = data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? "copy_node" : "move_node";
									ps = i;
									if(op === "move_node" && v === 'a' && (data.data.origin && data.data.origin === ins) && p === ins.get_parent(data.data.nodes[t1])) {
										pr = ins.get_node(p);
										if(ps > $.inArray(data.data.nodes[t1], pr.children)) {
											ps -= 1;
										}
									}
									ok = ok && ( (ins && ins.settings && ins.settings.dnd && ins.settings.dnd.check_while_dragging === false) || ins.check(op, (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), p, ps, { 'dnd' : true, 'ref' : ins.get_node(ref.parent()), 'pos' : v, 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) }) );
									if(!ok) {
										if(ins && ins.last_error) { laster = ins.last_error(); }
										break;
									}
								}
								if(v === 'i' && ref.parent().is('.jstree-closed') && ins.settings.dnd.open_timeout) {
									opento = setTimeout((function (x, z) { return function () { x.open_node(z); }; }(ins, ref)), ins.settings.dnd.open_timeout);
								}
								if(ok) {
									lastmv = { 'ins' : ins, 'par' : p, 'pos' : v === 'i' && ip === 'last' && i === 0 && !ins.is_loaded(tm) ? 'last' : i };
									marker.css({ 'left' : l + 'px', 'top' : t + 'px' }).show();
									data.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');
									laster = {};
									o = true;
									return false;
								}
							});
							if(o === true) { return; }
						}
					}
				}
				lastmv = false;
				data.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');
				marker.hide();
			})
			.on('dnd_scroll.vakata.jstree', function (e, data) {
				if(!data || !data.data || !data.data.jstree) { return; }
				marker.hide();
				lastmv = false;
				data.helper.find('.jstree-icon').first().removeClass('jstree-ok').addClass('jstree-er');
			})
			.on('dnd_stop.vakata.jstree', function (e, data) {
				if(opento) { clearTimeout(opento); }
				if(!data || !data.data || !data.data.jstree) { return; }
				marker.hide().detach();
				var i, j, nodes = [];
				if(lastmv) {
					for(i = 0, j = data.data.nodes.length; i < j; i++) {
						nodes[i] = data.data.origin ? data.data.origin.get_node(data.data.nodes[i]) : data.data.nodes[i];
						if(data.data.origin) {
							nodes[i].instance = data.data.origin;
						}
					}
					lastmv.ins[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? 'copy_node' : 'move_node' ](nodes, lastmv.par, lastmv.pos);
					for(i = 0, j = nodes.length; i < j; i++) {
						if(nodes[i].instance) {
							nodes[i].instance = null;
						}
					}
				}
				else {
					i = $(data.event.target).closest('.jstree');
					if(i.length && laster && laster.error && laster.error === 'check') {
						i = i.jstree(true);
						if(i) {
							i.settings.core.error.call(this, laster);
						}
					}
				}
			})
			.on('keyup.jstree keydown.jstree', function (e, data) {
				data = $.vakata.dnd._get();
				if(data && data.data && data.data.jstree) {
					data.helper.find('.jstree-copy').first()[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (e.metaKey || e.ctrlKey))) ? 'show' : 'hide' ]();
				}
			});
	});

	// helpers
	(function ($) {
		// private variable
		var vakata_dnd = {
			element	: false,
			target	: false,
			is_down	: false,
			is_drag	: false,
			helper	: false,
			helper_w: 0,
			data	: false,
			init_x	: 0,
			init_y	: 0,
			scroll_l: 0,
			scroll_t: 0,
			scroll_e: false,
			scroll_i: false,
			is_touch: false
		};
		$.vakata.dnd = {
			settings : {
				scroll_speed		: 10,
				scroll_proximity	: 20,
				helper_left			: 5,
				helper_top			: 10,
				threshold			: 5,
				threshold_touch		: 50
			},
			_trigger : function (event_name, e) {
				var data = $.vakata.dnd._get();
				data.event = e;
				$(document).triggerHandler("dnd_" + event_name + ".vakata", data);
			},
			_get : function () {
				return {
					"data"		: vakata_dnd.data,
					"element"	: vakata_dnd.element,
					"helper"	: vakata_dnd.helper
				};
			},
			_clean : function () {
				if(vakata_dnd.helper) { vakata_dnd.helper.remove(); }
				if(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }
				vakata_dnd = {
					element	: false,
					target	: false,
					is_down	: false,
					is_drag	: false,
					helper	: false,
					helper_w: 0,
					data	: false,
					init_x	: 0,
					init_y	: 0,
					scroll_l: 0,
					scroll_t: 0,
					scroll_e: false,
					scroll_i: false,
					is_touch: false
				};
				$(document).off("mousemove.vakata.jstree touchmove.vakata.jstree", $.vakata.dnd.drag);
				$(document).off("mouseup.vakata.jstree touchend.vakata.jstree", $.vakata.dnd.stop);
			},
			_scroll : function (init_only) {
				if(!vakata_dnd.scroll_e || (!vakata_dnd.scroll_l && !vakata_dnd.scroll_t)) {
					if(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }
					return false;
				}
				if(!vakata_dnd.scroll_i) {
					vakata_dnd.scroll_i = setInterval($.vakata.dnd._scroll, 100);
					return false;
				}
				if(init_only === true) { return false; }

				var i = vakata_dnd.scroll_e.scrollTop(),
					j = vakata_dnd.scroll_e.scrollLeft();
				vakata_dnd.scroll_e.scrollTop(i + vakata_dnd.scroll_t * $.vakata.dnd.settings.scroll_speed);
				vakata_dnd.scroll_e.scrollLeft(j + vakata_dnd.scroll_l * $.vakata.dnd.settings.scroll_speed);
				if(i !== vakata_dnd.scroll_e.scrollTop() || j !== vakata_dnd.scroll_e.scrollLeft()) {
					/**
					 * triggered on the document when a drag causes an element to scroll
					 * @event
					 * @plugin dnd
					 * @name dnd_scroll.vakata
					 * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start
					 * @param {DOM} element the DOM element being dragged
					 * @param {jQuery} helper the helper shown next to the mouse
					 * @param {jQuery} event the element that is scrolling
					 */
					$.vakata.dnd._trigger("scroll", vakata_dnd.scroll_e);
				}
			},
			start : function (e, data, html) {
				if(e.type === "touchstart" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {
					e.pageX = e.originalEvent.changedTouches[0].pageX;
					e.pageY = e.originalEvent.changedTouches[0].pageY;
					e.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);
				}
				if(vakata_dnd.is_drag) { $.vakata.dnd.stop({}); }
				try {
					e.currentTarget.unselectable = "on";
					e.currentTarget.onselectstart = function() { return false; };
					if(e.currentTarget.style) { e.currentTarget.style.MozUserSelect = "none"; }
				} catch(ignore) { }
				vakata_dnd.init_x	= e.pageX;
				vakata_dnd.init_y	= e.pageY;
				vakata_dnd.data		= data;
				vakata_dnd.is_down	= true;
				vakata_dnd.element	= e.currentTarget;
				vakata_dnd.target	= e.target;
				vakata_dnd.is_touch	= e.type === "touchstart";
				if(html !== false) {
					vakata_dnd.helper = $("<div id='vakata-dnd'></div>").html(html).css({
						"display"		: "block",
						"margin"		: "0",
						"padding"		: "0",
						"position"		: "absolute",
						"top"			: "-2000px",
						"lineHeight"	: "16px",
						"zIndex"		: "10000"
					});
				}
				$(document).on("mousemove.vakata.jstree touchmove.vakata.jstree", $.vakata.dnd.drag);
				$(document).on("mouseup.vakata.jstree touchend.vakata.jstree", $.vakata.dnd.stop);
				return false;
			},
			drag : function (e) {
				if(e.type === "touchmove" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {
					e.pageX = e.originalEvent.changedTouches[0].pageX;
					e.pageY = e.originalEvent.changedTouches[0].pageY;
					e.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);
				}
				if(!vakata_dnd.is_down) { return; }
				if(!vakata_dnd.is_drag) {
					if(
						Math.abs(e.pageX - vakata_dnd.init_x) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold) ||
						Math.abs(e.pageY - vakata_dnd.init_y) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold)
					) {
						if(vakata_dnd.helper) {
							vakata_dnd.helper.appendTo("body");
							vakata_dnd.helper_w = vakata_dnd.helper.outerWidth();
						}
						vakata_dnd.is_drag = true;
						/**
						 * triggered on the document when a drag starts
						 * @event
						 * @plugin dnd
						 * @name dnd_start.vakata
						 * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start
						 * @param {DOM} element the DOM element being dragged
						 * @param {jQuery} helper the helper shown next to the mouse
						 * @param {Object} event the event that caused the start (probably mousemove)
						 */
						$.vakata.dnd._trigger("start", e);
					}
					else { return; }
				}

				var d  = false, w  = false,
					dh = false, wh = false,
					dw = false, ww = false,
					dt = false, dl = false,
					ht = false, hl = false;

				vakata_dnd.scroll_t = 0;
				vakata_dnd.scroll_l = 0;
				vakata_dnd.scroll_e = false;
				$($(e.target).parentsUntil("body").addBack().get().reverse())
					.filter(function () {
						return	(/^auto|scroll$/).test($(this).css("overflow")) &&
								(this.scrollHeight > this.offsetHeight || this.scrollWidth > this.offsetWidth);
					})
					.each(function () {
						var t = $(this), o = t.offset();
						if(this.scrollHeight > this.offsetHeight) {
							if(o.top + t.height() - e.pageY < $.vakata.dnd.settings.scroll_proximity)	{ vakata_dnd.scroll_t = 1; }
							if(e.pageY - o.top < $.vakata.dnd.settings.scroll_proximity)				{ vakata_dnd.scroll_t = -1; }
						}
						if(this.scrollWidth > this.offsetWidth) {
							if(o.left + t.width() - e.pageX < $.vakata.dnd.settings.scroll_proximity)	{ vakata_dnd.scroll_l = 1; }
							if(e.pageX - o.left < $.vakata.dnd.settings.scroll_proximity)				{ vakata_dnd.scroll_l = -1; }
						}
						if(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {
							vakata_dnd.scroll_e = $(this);
							return false;
						}
					});

				if(!vakata_dnd.scroll_e) {
					d  = $(document); w = $(window);
					dh = d.height(); wh = w.height();
					dw = d.width(); ww = w.width();
					dt = d.scrollTop(); dl = d.scrollLeft();
					if(dh > wh && e.pageY - dt < $.vakata.dnd.settings.scroll_proximity)		{ vakata_dnd.scroll_t = -1;  }
					if(dh > wh && wh - (e.pageY - dt) < $.vakata.dnd.settings.scroll_proximity)	{ vakata_dnd.scroll_t = 1; }
					if(dw > ww && e.pageX - dl < $.vakata.dnd.settings.scroll_proximity)		{ vakata_dnd.scroll_l = -1; }
					if(dw > ww && ww - (e.pageX - dl) < $.vakata.dnd.settings.scroll_proximity)	{ vakata_dnd.scroll_l = 1; }
					if(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {
						vakata_dnd.scroll_e = d;
					}
				}
				if(vakata_dnd.scroll_e) { $.vakata.dnd._scroll(true); }

				if(vakata_dnd.helper) {
					ht = parseInt(e.pageY + $.vakata.dnd.settings.helper_top, 10);
					hl = parseInt(e.pageX + $.vakata.dnd.settings.helper_left, 10);
					if(dh && ht + 25 > dh) { ht = dh - 50; }
					if(dw && hl + vakata_dnd.helper_w > dw) { hl = dw - (vakata_dnd.helper_w + 2); }
					vakata_dnd.helper.css({
						left	: hl + "px",
						top		: ht + "px"
					});
				}
				/**
				 * triggered on the document when a drag is in progress
				 * @event
				 * @plugin dnd
				 * @name dnd_move.vakata
				 * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start
				 * @param {DOM} element the DOM element being dragged
				 * @param {jQuery} helper the helper shown next to the mouse
				 * @param {Object} event the event that caused this to trigger (most likely mousemove)
				 */
				$.vakata.dnd._trigger("move", e);
				return false;
			},
			stop : function (e) {
				if(e.type === "touchend" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {
					e.pageX = e.originalEvent.changedTouches[0].pageX;
					e.pageY = e.originalEvent.changedTouches[0].pageY;
					e.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);
				}
				if(vakata_dnd.is_drag) {
					/**
					 * triggered on the document when a drag stops (the dragged element is dropped)
					 * @event
					 * @plugin dnd
					 * @name dnd_stop.vakata
					 * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start
					 * @param {DOM} element the DOM element being dragged
					 * @param {jQuery} helper the helper shown next to the mouse
					 * @param {Object} event the event that caused the stop
					 */
					$.vakata.dnd._trigger("stop", e);
				}
				else {
					if(e.type === "touchend" && e.target === vakata_dnd.target) {
						var to = setTimeout(function () { $(e.target).click(); }, 100);
						$(e.target).one('click', function() { if(to) { clearTimeout(to); } });
					}
				}
				$.vakata.dnd._clean();
				return false;
			}
		};
	}($));

	// include the dnd plugin by default
	// $.jstree.defaults.plugins.push("dnd");


/**
 * ### Search plugin
 *
 * Adds search functionality to jsTree.
 */

	/**
	 * stores all defaults for the search plugin
	 * @name $.jstree.defaults.search
	 * @plugin search
	 */
	$.jstree.defaults.search = {
		/**
		 * a jQuery-like AJAX config, which jstree uses if a server should be queried for results. 
		 * 
		 * A `str` (which is the search string) parameter will be added with the request. The expected result is a JSON array with nodes that need to be opened so that matching nodes will be revealed.
		 * Leave this setting as `false` to not query the server. You can also set this to a function, which will be invoked in the instance's scope and receive 2 parameters - the search string and the callback to call with the array of nodes to load.
		 * @name $.jstree.defaults.search.ajax
		 * @plugin search
		 */
		ajax : false,
		/**
		 * Indicates if the search should be fuzzy or not (should `chnd3` match `child node 3`). Default is `false`.
		 * @name $.jstree.defaults.search.fuzzy
		 * @plugin search
		 */
		fuzzy : false,
		/**
		 * Indicates if the search should be case sensitive. Default is `false`.
		 * @name $.jstree.defaults.search.case_sensitive
		 * @plugin search
		 */
		case_sensitive : false,
		/**
		 * Indicates if the tree should be filtered (by default) to show only matching nodes (keep in mind this can be a heavy on large trees in old browsers). 
		 * This setting can be changed at runtime when calling the search method. Default is `false`.
		 * @name $.jstree.defaults.search.show_only_matches
		 * @plugin search
		 */
		show_only_matches : false,
		/**
		 * Indicates if all nodes opened to reveal the search result, should be closed when the search is cleared or a new search is performed. Default is `true`.
		 * @name $.jstree.defaults.search.close_opened_onclear
		 * @plugin search
		 */
		close_opened_onclear : true,
		/**
		 * Indicates if only leaf nodes should be included in search results. Default is `false`.
		 * @name $.jstree.defaults.search.search_leaves_only
		 * @plugin search
		 */
		search_leaves_only : false,
		/**
		 * If set to a function it wil be called in the instance's scope with two arguments - search string and node (where node will be every node in the structure, so use with caution).
		 * If the function returns a truthy value the node will be considered a match (it might not be displayed if search_only_leaves is set to true and the node is not a leaf). Default is `false`.
		 * @name $.jstree.defaults.search.search_callback
		 * @plugin search
		 */
		search_callback : false
	};

	$.jstree.plugins.search = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);

			this._data.search.str = "";
			this._data.search.dom = $();
			this._data.search.res = [];
			this._data.search.opn = [];
			this._data.search.som = false;

			this.element
				.on('before_open.jstree', $.proxy(function (e, data) {
						var i, j, f, r = this._data.search.res, s = [], o = $();
						if(r && r.length) {
							this._data.search.dom = $(this.element[0].querySelectorAll('#' + $.map(r, function (v) { return "0123456789".indexOf(v[0]) !== -1 ? '\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\$&') : v.replace($.jstree.idregex,'\\$&'); }).join(', #')));
							this._data.search.dom.children(".jstree-anchor").addClass('jstree-search');
							if(this._data.search.som && this._data.search.res.length) {
								for(i = 0, j = r.length; i < j; i++) {
									s = s.concat(this.get_node(r[i]).parents);
								}
								s = $.vakata.array_remove_item($.vakata.array_unique(s),'#');
								o = s.length ? $(this.element[0].querySelectorAll('#' + $.map(s, function (v) { return "0123456789".indexOf(v[0]) !== -1 ? '\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\$&') : v.replace($.jstree.idregex,'\\$&'); }).join(', #'))) : $();

								this.element.find(".jstree-node").hide().filter('.jstree-last').filter(function() { return this.nextSibling; }).removeClass('jstree-last');
								o = o.add(this._data.search.dom);
								o.parentsUntil(".jstree").addBack().show()
									.filter(".jstree-children").each(function () { $(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last"); });
							}
						}
					}, this))
				.on("search.jstree", $.proxy(function (e, data) {
						if(this._data.search.som) {
							if(data.nodes.length) {
								this.element.find(".jstree-node").hide().filter('.jstree-last').filter(function() { return this.nextSibling; }).removeClass('jstree-last');
								data.nodes.parentsUntil(".jstree").addBack().show()
									.filter(".jstree-children").each(function () { $(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last"); });
							}
						}
					}, this))
				.on("clear_search.jstree", $.proxy(function (e, data) {
						if(this._data.search.som && data.nodes.length) {
							this.element.find(".jstree-node").css("display","").filter('.jstree-last').filter(function() { return this.nextSibling; }).removeClass('jstree-last');
						}
					}, this));
		};
		/**
		 * used to search the tree nodes for a given string
		 * @name search(str [, skip_async])
		 * @param {String} str the search string
		 * @param {Boolean} skip_async if set to true server will not be queried even if configured
		 * @param {Boolean} show_only_matches if set to true only matching nodes will be shown (keep in mind this can be very slow on large trees or old browsers)
		 * @plugin search
		 * @trigger search.jstree
		 */
		this.search = function (str, skip_async, show_only_matches) {
			if(str === false || $.trim(str.toString()) === "") {
				return this.clear_search();
			}
			str = str.toString();
			var s = this.settings.search,
				a = s.ajax ? s.ajax : false,
				f = null,
				r = [],
				p = [], i, j;
			if(this._data.search.res.length) {
				this.clear_search();
			}
			if(show_only_matches === undefined) {
				show_only_matches = s.show_only_matches;
			}
			if(!skip_async && a !== false) {
				if($.isFunction(a)) {
					return a.call(this, str, $.proxy(function (d) {
							if(d && d.d) { d = d.d; }
							this._load_nodes(!$.isArray(d) ? [] : $.vakata.array_unique(d), function () {
								this.search(str, true, show_only_matches);
							}, true);
						}, this));
				}
				else {
					a = $.extend({}, a);
					if(!a.data) { a.data = {}; }
					a.data.str = str;
					return $.ajax(a)
						.fail($.proxy(function () {
							this._data.core.last_error = { 'error' : 'ajax', 'plugin' : 'search', 'id' : 'search_01', 'reason' : 'Could not load search parents', 'data' : JSON.stringify(a) };
							this.settings.core.error.call(this, this._data.core.last_error);
						}, this))
						.done($.proxy(function (d) {
							if(d && d.d) { d = d.d; }
							this._load_nodes(!$.isArray(d) ? [] : $.vakata.array_unique(d), function () {
								this.search(str, true, show_only_matches);
							}, true);
						}, this));
				}
			}
			this._data.search.str = str;
			this._data.search.dom = $();
			this._data.search.res = [];
			this._data.search.opn = [];
			this._data.search.som = show_only_matches;

			f = new $.vakata.search(str, true, { caseSensitive : s.case_sensitive, fuzzy : s.fuzzy });

			$.each(this._model.data, function (i, v) {
				if(v.text && ( (s.search_callback && s.search_callback.call(this, str, v)) || (!s.search_callback && f.search(v.text).isMatch) ) && (!s.search_leaves_only || (v.state.loaded && v.children.length === 0)) ) {
					r.push(i);
					p = p.concat(v.parents);
				}
			});
			if(r.length) {
				p = $.vakata.array_unique(p);
				this._search_open(p);
				this._data.search.dom = $(this.element[0].querySelectorAll('#' + $.map(r, function (v) { return "0123456789".indexOf(v[0]) !== -1 ? '\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\$&') : v.replace($.jstree.idregex,'\\$&'); }).join(', #')));
				this._data.search.res = r;
				this._data.search.dom.children(".jstree-anchor").addClass('jstree-search');
			}
			/**
			 * triggered after search is complete
			 * @event
			 * @name search.jstree
			 * @param {jQuery} nodes a jQuery collection of matching nodes
			 * @param {String} str the search string
			 * @param {Array} res a collection of objects represeing the matching nodes
			 * @plugin search
			 */
			this.trigger('search', { nodes : this._data.search.dom, str : str, res : this._data.search.res, show_only_matches : show_only_matches });
		};
		/**
		 * used to clear the last search (removes classes and shows all nodes if filtering is on)
		 * @name clear_search()
		 * @plugin search
		 * @trigger clear_search.jstree
		 */
		this.clear_search = function () {
			this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");
			if(this.settings.search.close_opened_onclear) {
				this.close_node(this._data.search.opn, 0);
			}
			/**
			 * triggered after search is complete
			 * @event
			 * @name clear_search.jstree
			 * @param {jQuery} nodes a jQuery collection of matching nodes (the result from the last search)
			 * @param {String} str the search string (the last search string)
			 * @param {Array} res a collection of objects represeing the matching nodes (the result from the last search)
			 * @plugin search
			 */
			this.trigger('clear_search', { 'nodes' : this._data.search.dom, str : this._data.search.str, res : this._data.search.res });
			this._data.search.str = "";
			this._data.search.res = [];
			this._data.search.opn = [];
			this._data.search.dom = $();
		};
		/**
		 * opens nodes that need to be opened to reveal the search results. Used only internally.
		 * @private
		 * @name _search_open(d)
		 * @param {Array} d an array of node IDs
		 * @plugin search
		 */
		this._search_open = function (d) {
			var t = this;
			$.each(d.concat([]), function (i, v) {
				if(v === "#") { return true; }
				try { v = $('#' + v.replace($.jstree.idregex,'\\$&'), t.element); } catch(ignore) { }
				if(v && v.length) {
					if(t.is_closed(v)) {
						t._data.search.opn.push(v[0].id);
						t.open_node(v, function () { t._search_open(d); }, 0);
					}
				}
			});
		};
	};

	// helpers
	(function ($) {
		// from http://kiro.me/projects/fuse.html
		$.vakata.search = function(pattern, txt, options) {
			options = options || {};
			if(options.fuzzy !== false) {
				options.fuzzy = true;
			}
			pattern = options.caseSensitive ? pattern : pattern.toLowerCase();
			var MATCH_LOCATION	= options.location || 0,
				MATCH_DISTANCE	= options.distance || 100,
				MATCH_THRESHOLD	= options.threshold || 0.6,
				patternLen = pattern.length,
				matchmask, pattern_alphabet, match_bitapScore, search;
			if(patternLen > 32) {
				options.fuzzy = false;
			}
			if(options.fuzzy) {
				matchmask = 1 << (patternLen - 1);
				pattern_alphabet = (function () {
					var mask = {},
						i = 0;
					for (i = 0; i < patternLen; i++) {
						mask[pattern.charAt(i)] = 0;
					}
					for (i = 0; i < patternLen; i++) {
						mask[pattern.charAt(i)] |= 1 << (patternLen - i - 1);
					}
					return mask;
				}());
				match_bitapScore = function (e, x) {
					var accuracy = e / patternLen,
						proximity = Math.abs(MATCH_LOCATION - x);
					if(!MATCH_DISTANCE) {
						return proximity ? 1.0 : accuracy;
					}
					return accuracy + (proximity / MATCH_DISTANCE);
				};
			}
			search = function (text) {
				text = options.caseSensitive ? text : text.toLowerCase();
				if(pattern === text || text.indexOf(pattern) !== -1) {
					return {
						isMatch: true,
						score: 0
					};
				}
				if(!options.fuzzy) {
					return {
						isMatch: false,
						score: 1
					};
				}
				var i, j,
					textLen = text.length,
					scoreThreshold = MATCH_THRESHOLD,
					bestLoc = text.indexOf(pattern, MATCH_LOCATION),
					binMin, binMid,
					binMax = patternLen + textLen,
					lastRd, start, finish, rd, charMatch,
					score = 1,
					locations = [];
				if (bestLoc !== -1) {
					scoreThreshold = Math.min(match_bitapScore(0, bestLoc), scoreThreshold);
					bestLoc = text.lastIndexOf(pattern, MATCH_LOCATION + patternLen);
					if (bestLoc !== -1) {
						scoreThreshold = Math.min(match_bitapScore(0, bestLoc), scoreThreshold);
					}
				}
				bestLoc = -1;
				for (i = 0; i < patternLen; i++) {
					binMin = 0;
					binMid = binMax;
					while (binMin < binMid) {
						if (match_bitapScore(i, MATCH_LOCATION + binMid) <= scoreThreshold) {
							binMin = binMid;
						} else {
							binMax = binMid;
						}
						binMid = Math.floor((binMax - binMin) / 2 + binMin);
					}
					binMax = binMid;
					start = Math.max(1, MATCH_LOCATION - binMid + 1);
					finish = Math.min(MATCH_LOCATION + binMid, textLen) + patternLen;
					rd = new Array(finish + 2);
					rd[finish + 1] = (1 << i) - 1;
					for (j = finish; j >= start; j--) {
						charMatch = pattern_alphabet[text.charAt(j - 1)];
						if (i === 0) {
							rd[j] = ((rd[j + 1] << 1) | 1) & charMatch;
						} else {
							rd[j] = ((rd[j + 1] << 1) | 1) & charMatch | (((lastRd[j + 1] | lastRd[j]) << 1) | 1) | lastRd[j + 1];
						}
						if (rd[j] & matchmask) {
							score = match_bitapScore(i, j - 1);
							if (score <= scoreThreshold) {
								scoreThreshold = score;
								bestLoc = j - 1;
								locations.push(bestLoc);
								if (bestLoc > MATCH_LOCATION) {
									start = Math.max(1, 2 * MATCH_LOCATION - bestLoc);
								} else {
									break;
								}
							}
						}
					}
					if (match_bitapScore(i + 1, MATCH_LOCATION) > scoreThreshold) {
						break;
					}
					lastRd = rd;
				}
				return {
					isMatch: bestLoc >= 0,
					score: score
				};
			};
			return txt === true ? { 'search' : search } : search(txt);
		};
	}($));

	// include the search plugin by default
	// $.jstree.defaults.plugins.push("search");

/**
 * ### Sort plugin
 *
 * Automatically sorts all siblings in the tree according to a sorting function.
 */

	/**
	 * the settings function used to sort the nodes.
	 * It is executed in the tree's context, accepts two nodes as arguments and should return `1` or `-1`.
	 * @name $.jstree.defaults.sort
	 * @plugin sort
	 */
	$.jstree.defaults.sort = function (a, b) {
		//return this.get_type(a) === this.get_type(b) ? (this.get_text(a) > this.get_text(b) ? 1 : -1) : this.get_type(a) >= this.get_type(b);
		return this.get_text(a) > this.get_text(b) ? 1 : -1;
	};
	$.jstree.plugins.sort = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);
			this.element
				.on("model.jstree", $.proxy(function (e, data) {
						this.sort(data.parent, true);
					}, this))
				.on("rename_node.jstree create_node.jstree", $.proxy(function (e, data) {
						this.sort(data.parent || data.node.parent, false);
						this.redraw_node(data.parent || data.node.parent, true);
					}, this))
				.on("move_node.jstree copy_node.jstree", $.proxy(function (e, data) {
						this.sort(data.parent, false);
						this.redraw_node(data.parent, true);
					}, this));
		};
		/**
		 * used to sort a node's children
		 * @private
		 * @name sort(obj [, deep])
		 * @param  {mixed} obj the node
		 * @param {Boolean} deep if set to `true` nodes are sorted recursively.
		 * @plugin sort
		 * @trigger search.jstree
		 */
		this.sort = function (obj, deep) {
			var i, j;
			obj = this.get_node(obj);
			if(obj && obj.children && obj.children.length) {
				obj.children.sort($.proxy(this.settings.sort, this));
				if(deep) {
					for(i = 0, j = obj.children_d.length; i < j; i++) {
						this.sort(obj.children_d[i], false);
					}
				}
			}
		};
	};

	// include the sort plugin by default
	// $.jstree.defaults.plugins.push("sort");

/**
 * ### State plugin
 *
 * Saves the state of the tree (selected nodes, opened nodes) on the user's computer using available options (localStorage, cookies, etc)
 */

	var to = false;
	/**
	 * stores all defaults for the state plugin
	 * @name $.jstree.defaults.state
	 * @plugin state
	 */
	$.jstree.defaults.state = {
		/**
		 * A string for the key to use when saving the current tree (change if using multiple trees in your project). Defaults to `jstree`.
		 * @name $.jstree.defaults.state.key
		 * @plugin state
		 */
		key		: 'jstree',
		/**
		 * A space separated list of events that trigger a state save. Defaults to `changed.jstree open_node.jstree close_node.jstree`.
		 * @name $.jstree.defaults.state.events
		 * @plugin state
		 */
		events	: 'changed.jstree open_node.jstree close_node.jstree',
		/**
		 * Time in milliseconds after which the state will expire. Defaults to 'false' meaning - no expire.
		 * @name $.jstree.defaults.state.ttl
		 * @plugin state
		 */
		ttl		: false,
		/**
		 * A function that will be executed prior to restoring state with one argument - the state object. Can be used to clear unwanted parts of the state.
		 * @name $.jstree.defaults.state.filter
		 * @plugin state
		 */
		filter	: false
	};
	$.jstree.plugins.state = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);
			var bind = $.proxy(function () {
				this.element.on(this.settings.state.events, $.proxy(function () {
					if(to) { clearTimeout(to); }
					to = setTimeout($.proxy(function () { this.save_state(); }, this), 100);
				}, this));
			}, this);
			this.element
				.on("ready.jstree", $.proxy(function (e, data) {
						this.element.one("restore_state.jstree", bind);
						if(!this.restore_state()) { bind(); }
					}, this));
		};
		/**
		 * save the state
		 * @name save_state()
		 * @plugin state
		 */
		this.save_state = function () {
			var st = { 'state' : this.get_state(), 'ttl' : this.settings.state.ttl, 'sec' : +(new Date()) };
			$.vakata.storage.set(this.settings.state.key, JSON.stringify(st));
		};
		/**
		 * restore the state from the user's computer
		 * @name restore_state()
		 * @plugin state
		 */
		this.restore_state = function () {
			var k = $.vakata.storage.get(this.settings.state.key);
			if(!!k) { try { k = JSON.parse(k); } catch(ex) { return false; } }
			if(!!k && k.ttl && k.sec && +(new Date()) - k.sec > k.ttl) { return false; }
			if(!!k && k.state) { k = k.state; }
			if(!!k && $.isFunction(this.settings.state.filter)) { k = this.settings.state.filter.call(this, k); }
			if(!!k) {
				this.element.one("set_state.jstree", function (e, data) { data.instance.trigger('restore_state', { 'state' : $.extend(true, {}, k) }); });
				this.set_state(k);
				return true;
			}
			return false;
		};
		/**
		 * clear the state on the user's computer
		 * @name clear_state()
		 * @plugin state
		 */
		this.clear_state = function () {
			return $.vakata.storage.del(this.settings.state.key);
		};
	};

	(function ($, undefined) {
		$.vakata.storage = {
			// simply specifying the functions in FF throws an error
			set : function (key, val) { return window.localStorage.setItem(key, val); },
			get : function (key) { return window.localStorage.getItem(key); },
			del : function (key) { return window.localStorage.removeItem(key); }
		};
	}($));

	// include the state plugin by default
	// $.jstree.defaults.plugins.push("state");

/**
 * ### Types plugin
 *
 * Makes it possible to add predefined types for groups of nodes, which make it possible to easily control nesting rules and icon for each group.
 */

	/**
	 * An object storing all types as key value pairs, where the key is the type name and the value is an object that could contain following keys (all optional).
	 * 
	 * * `max_children` the maximum number of immediate children this node type can have. Do not specify or set to `-1` for unlimited.
	 * * `max_depth` the maximum number of nesting this node type can have. A value of `1` would mean that the node can have children, but no grandchildren. Do not specify or set to `-1` for unlimited.
	 * * `valid_children` an array of node type strings, that nodes of this type can have as children. Do not specify or set to `-1` for no limits.
	 * * `icon` a string - can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class. Omit to use the default icon from your theme.
	 *
	 * There are two predefined types:
	 * 
	 * * `#` represents the root of the tree, for example `max_children` would control the maximum number of root nodes.
	 * * `default` represents the default node - any settings here will be applied to all nodes that do not have a type specified.
	 * 
	 * @name $.jstree.defaults.types
	 * @plugin types
	 */
	$.jstree.defaults.types = {
		'#' : {},
		'default' : {}
	};

	$.jstree.plugins.types = function (options, parent) {
		this.init = function (el, options) {
			var i, j;
			if(options && options.types && options.types['default']) {
				for(i in options.types) {
					if(i !== "default" && i !== "#" && options.types.hasOwnProperty(i)) {
						for(j in options.types['default']) {
							if(options.types['default'].hasOwnProperty(j) && options.types[i][j] === undefined) {
								options.types[i][j] = options.types['default'][j];
							}
						}
					}
				}
			}
			parent.init.call(this, el, options);
			this._model.data['#'].type = '#';
		};
		this.refresh = function (skip_loading, forget_state) {
			parent.refresh.call(this, skip_loading, forget_state);
			this._model.data['#'].type = '#';
		};
		this.bind = function () {
			this.element
				.on('model.jstree', $.proxy(function (e, data) {
						var m = this._model.data,
							dpc = data.nodes,
							t = this.settings.types,
							i, j, c = 'default';
						for(i = 0, j = dpc.length; i < j; i++) {
							c = 'default';
							if(m[dpc[i]].original && m[dpc[i]].original.type && t[m[dpc[i]].original.type]) {
								c = m[dpc[i]].original.type;
							}
							if(m[dpc[i]].data && m[dpc[i]].data.jstree && m[dpc[i]].data.jstree.type && t[m[dpc[i]].data.jstree.type]) {
								c = m[dpc[i]].data.jstree.type;
							}
							m[dpc[i]].type = c;
							if(m[dpc[i]].icon === true && t[c].icon !== undefined) {
								m[dpc[i]].icon = t[c].icon;
							}
						}
						m['#'].type = '#';
					}, this));
			parent.bind.call(this);
		};
		this.get_json = function (obj, options, flat) {
			var i, j,
				m = this._model.data,
				opt = options ? $.extend(true, {}, options, {no_id:false}) : {},
				tmp = parent.get_json.call(this, obj, opt, flat);
			if(tmp === false) { return false; }
			if($.isArray(tmp)) {
				for(i = 0, j = tmp.length; i < j; i++) {
					tmp[i].type = tmp[i].id && m[tmp[i].id] && m[tmp[i].id].type ? m[tmp[i].id].type : "default";
					if(options && options.no_id) {
						delete tmp[i].id;
						if(tmp[i].li_attr && tmp[i].li_attr.id) {
							delete tmp[i].li_attr.id;
						}
						if(tmp[i].a_attr && tmp[i].a_attr.id) {
							delete tmp[i].a_attr.id;
						}
					}
				}
			}
			else {
				tmp.type = tmp.id && m[tmp.id] && m[tmp.id].type ? m[tmp.id].type : "default";
				if(options && options.no_id) {
					tmp = this._delete_ids(tmp);
				}
			}
			return tmp;
		};
		this._delete_ids = function (tmp) {
			if($.isArray(tmp)) {
				for(var i = 0, j = tmp.length; i < j; i++) {
					tmp[i] = this._delete_ids(tmp[i]);
				}
				return tmp;
			}
			delete tmp.id;
			if(tmp.li_attr && tmp.li_attr.id) {
				delete tmp.li_attr.id;
			}
			if(tmp.a_attr && tmp.a_attr.id) {
				delete tmp.a_attr.id;
			}
			if(tmp.children && $.isArray(tmp.children)) {
				tmp.children = this._delete_ids(tmp.children);
			}
			return tmp;
		};
		this.check = function (chk, obj, par, pos, more) {
			if(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }
			obj = obj && obj.id ? obj : this.get_node(obj);
			par = par && par.id ? par : this.get_node(par);
			var m = obj && obj.id ? $.jstree.reference(obj.id) : null, tmp, d, i, j;
			m = m && m._model && m._model.data ? m._model.data : null;
			switch(chk) {
				case "create_node":
				case "move_node":
				case "copy_node":
					if(chk !== 'move_node' || $.inArray(obj.id, par.children) === -1) {
						tmp = this.get_rules(par);
						if(tmp.max_children !== undefined && tmp.max_children !== -1 && tmp.max_children === par.children.length) {
							this._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_01', 'reason' : 'max_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
							return false;
						}
						if(tmp.valid_children !== undefined && tmp.valid_children !== -1 && $.inArray((obj.type || 'default'), tmp.valid_children) === -1) {
							this._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_02', 'reason' : 'valid_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
							return false;
						}
						if(m && obj.children_d && obj.parents) {
							d = 0;
							for(i = 0, j = obj.children_d.length; i < j; i++) {
								d = Math.max(d, m[obj.children_d[i]].parents.length);
							}
							d = d - obj.parents.length + 1;
						}
						if(d <= 0 || d === undefined) { d = 1; }
						do {
							if(tmp.max_depth !== undefined && tmp.max_depth !== -1 && tmp.max_depth < d) {
								this._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_03', 'reason' : 'max_depth prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
								return false;
							}
							par = this.get_node(par.parent);
							tmp = this.get_rules(par);
							d++;
						} while(par);
					}
					break;
			}
			return true;
		};
		/**
		 * used to retrieve the type settings object for a node
		 * @name get_rules(obj)
		 * @param {mixed} obj the node to find the rules for
		 * @return {Object}
		 * @plugin types
		 */
		this.get_rules = function (obj) {
			obj = this.get_node(obj);
			if(!obj) { return false; }
			var tmp = this.get_type(obj, true);
			if(tmp.max_depth === undefined) { tmp.max_depth = -1; }
			if(tmp.max_children === undefined) { tmp.max_children = -1; }
			if(tmp.valid_children === undefined) { tmp.valid_children = -1; }
			return tmp;
		};
		/**
		 * used to retrieve the type string or settings object for a node
		 * @name get_type(obj [, rules])
		 * @param {mixed} obj the node to find the rules for
		 * @param {Boolean} rules if set to `true` instead of a string the settings object will be returned
		 * @return {String|Object}
		 * @plugin types
		 */
		this.get_type = function (obj, rules) {
			obj = this.get_node(obj);
			return (!obj) ? false : ( rules ? $.extend({ 'type' : obj.type }, this.settings.types[obj.type]) : obj.type);
		};
		/**
		 * used to change a node's type
		 * @name set_type(obj, type)
		 * @param {mixed} obj the node to change
		 * @param {String} type the new type
		 * @plugin types
		 */
		this.set_type = function (obj, type) {
			var t, t1, t2, old_type, old_icon;
			if($.isArray(obj)) {
				obj = obj.slice();
				for(t1 = 0, t2 = obj.length; t1 < t2; t1++) {
					this.set_type(obj[t1], type);
				}
				return true;
			}
			t = this.settings.types;
			obj = this.get_node(obj);
			if(!t[type] || !obj) { return false; }
			old_type = obj.type;
			old_icon = this.get_icon(obj);
			obj.type = type;
			if(old_icon === true || (t[old_type] && t[old_type].icon !== undefined && old_icon === t[old_type].icon)) {
				this.set_icon(obj, t[type].icon !== undefined ? t[type].icon : true);
			}
			return true;
		};
	};
	// include the types plugin by default
	// $.jstree.defaults.plugins.push("types");

/**
 * ### Unique plugin
 *
 * Enforces that no nodes with the same name can coexist as siblings.
 */

	/**
	 * stores all defaults for the unique plugin
	 * @name $.jstree.defaults.unique
	 * @plugin unique
	 */
	$.jstree.defaults.unique = {
		/**
		 * Indicates if the comparison should be case sensitive. Default is `false`.
		 * @name $.jstree.defaults.unique.case_sensitive
		 * @plugin unique
		 */
		case_sensitive : false,
		/**
		 * A callback executed in the instance's scope when a new node is created and the name is already taken, the two arguments are the conflicting name and the counter. The default will produce results like `New node (2)`.
		 * @name $.jstree.defaults.unique.duplicate
		 * @plugin unique
		 */
		duplicate : function (name, counter) {
			return name + ' (' + counter + ')';
		}
	};

	$.jstree.plugins.unique = function (options, parent) {
		this.check = function (chk, obj, par, pos, more) {
			if(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }
			obj = obj && obj.id ? obj : this.get_node(obj);
			par = par && par.id ? par : this.get_node(par);
			if(!par || !par.children) { return true; }
			var n = chk === "rename_node" ? pos : obj.text,
				c = [],
				s = this.settings.unique.case_sensitive,
				m = this._model.data, i, j;
			for(i = 0, j = par.children.length; i < j; i++) {
				c.push(s ? m[par.children[i]].text : m[par.children[i]].text.toLowerCase());
			}
			if(!s) { n = n.toLowerCase(); }
			switch(chk) {
				case "delete_node":
					return true;
				case "rename_node":
					i = ($.inArray(n, c) === -1 || (obj.text && obj.text[ s ? 'toString' : 'toLowerCase']() === n));
					if(!i) {
						this._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_01', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
					}
					return i;
				case "create_node":
					i = ($.inArray(n, c) === -1);
					if(!i) {
						this._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_04', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
					}
					return i;
				case "copy_node":
					i = ($.inArray(n, c) === -1);
					if(!i) {
						this._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_02', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
					}
					return i;
				case "move_node":
					i = (obj.parent === par.id || $.inArray(n, c) === -1);
					if(!i) {
						this._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_03', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };
					}
					return i;
			}
			return true;
		};
		this.create_node = function (par, node, pos, callback, is_loaded) {
			if(!node || node.text === undefined) {
				if(par === null) {
					par = "#";
				}
				par = this.get_node(par);
				if(!par) {
					return parent.create_node.call(this, par, node, pos, callback, is_loaded);
				}
				pos = pos === undefined ? "last" : pos;
				if(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {
					return parent.create_node.call(this, par, node, pos, callback, is_loaded);
				}
				if(!node) { node = {}; }
				var tmp, n, dpc, i, j, m = this._model.data, s = this.settings.unique.case_sensitive, cb = this.settings.unique.duplicate;
				n = tmp = this.get_string('New node');
				dpc = [];
				for(i = 0, j = par.children.length; i < j; i++) {
					dpc.push(s ? m[par.children[i]].text : m[par.children[i]].text.toLowerCase());
				}
				i = 1;
				while($.inArray(s ? n : n.toLowerCase(), dpc) !== -1) {
					n = cb.call(this, tmp, (++i)).toString();
				}
				node.text = n;
			}
			return parent.create_node.call(this, par, node, pos, callback, is_loaded);
		};
	};

	// include the unique plugin by default
	// $.jstree.defaults.plugins.push("unique");


/**
 * ### Wholerow plugin
 *
 * Makes each node appear block level. Making selection easier. May cause slow down for large trees in old browsers.
 */

	var div = document.createElement('DIV');
	div.setAttribute('unselectable','on');
	div.setAttribute('role','presentation');
	div.className = 'jstree-wholerow';
	div.innerHTML = '&#160;';
	$.jstree.plugins.wholerow = function (options, parent) {
		this.bind = function () {
			parent.bind.call(this);

			this.element
				.on('ready.jstree set_state.jstree', $.proxy(function () {
						this.hide_dots();
					}, this))
				.on("init.jstree loading.jstree ready.jstree", $.proxy(function () {
						//div.style.height = this._data.core.li_height + 'px';
						this.get_container_ul().addClass('jstree-wholerow-ul');
					}, this))
				.on("deselect_all.jstree", $.proxy(function (e, data) {
						this.element.find('.jstree-wholerow-clicked').removeClass('jstree-wholerow-clicked');
					}, this))
				.on("changed.jstree", $.proxy(function (e, data) {
						this.element.find('.jstree-wholerow-clicked').removeClass('jstree-wholerow-clicked');
						var tmp = false, i, j;
						for(i = 0, j = data.selected.length; i < j; i++) {
							tmp = this.get_node(data.selected[i], true);
							if(tmp && tmp.length) {
								tmp.children('.jstree-wholerow').addClass('jstree-wholerow-clicked');
							}
						}
					}, this))
				.on("open_node.jstree", $.proxy(function (e, data) {
						this.get_node(data.node, true).find('.jstree-clicked').parent().children('.jstree-wholerow').addClass('jstree-wholerow-clicked');
					}, this))
				.on("hover_node.jstree dehover_node.jstree", $.proxy(function (e, data) {
						if(e.type === "hover_node" && this.is_disabled(data.node)) { return; }
						this.get_node(data.node, true).children('.jstree-wholerow')[e.type === "hover_node"?"addClass":"removeClass"]('jstree-wholerow-hovered');
					}, this))
				.on("contextmenu.jstree", ".jstree-wholerow", $.proxy(function (e) {
						e.preventDefault();
						var tmp = $.Event('contextmenu', { metaKey : e.metaKey, ctrlKey : e.ctrlKey, altKey : e.altKey, shiftKey : e.shiftKey, pageX : e.pageX, pageY : e.pageY });
						$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(tmp);
					}, this))
				.on("click.jstree", ".jstree-wholerow", function (e) {
						e.stopImmediatePropagation();
						var tmp = $.Event('click', { metaKey : e.metaKey, ctrlKey : e.ctrlKey, altKey : e.altKey, shiftKey : e.shiftKey });
						$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(tmp).focus();
					})
				.on("click.jstree", ".jstree-leaf > .jstree-ocl", $.proxy(function (e) {
						e.stopImmediatePropagation();
						var tmp = $.Event('click', { metaKey : e.metaKey, ctrlKey : e.ctrlKey, altKey : e.altKey, shiftKey : e.shiftKey });
						$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(tmp).focus();
					}, this))
				.on("mouseover.jstree", ".jstree-wholerow, .jstree-icon", $.proxy(function (e) {
						e.stopImmediatePropagation();
						if(!this.is_disabled(e.currentTarget)) {
							this.hover_node(e.currentTarget);
						}
						return false;
					}, this))
				.on("mouseleave.jstree", ".jstree-node", $.proxy(function (e) {
						this.dehover_node(e.currentTarget);
					}, this));
		};
		this.teardown = function () {
			if(this.settings.wholerow) {
				this.element.find(".jstree-wholerow").remove();
			}
			parent.teardown.call(this);
		};
		this.redraw_node = function(obj, deep, callback, force_render) {
			obj = parent.redraw_node.apply(this, arguments);
			if(obj) {
				var tmp = div.cloneNode(true);
				//tmp.style.height = this._data.core.li_height + 'px';
				if($.inArray(obj.id, this._data.core.selected) !== -1) { tmp.className += ' jstree-wholerow-clicked'; }
				if(this._data.core.focused && this._data.core.focused === obj.id) { tmp.className += ' jstree-wholerow-hovered'; }
				obj.insertBefore(tmp, obj.childNodes[0]);
			}
			return obj;
		};
	};
	// include the wholerow plugin by default
	// $.jstree.defaults.plugins.push("wholerow");


(function ($) {
	if(document.registerElement && Object && Object.create) {
		var proto = Object.create(HTMLElement.prototype);
		proto.createdCallback = function () {
			var c = { core : {}, plugins : [] }, i;
			for(i in $.jstree.plugins) {
				if($.jstree.plugins.hasOwnProperty(i) && this.attributes[i]) {
					c.plugins.push(i);
					if(this.getAttribute(i) && JSON.parse(this.getAttribute(i))) {
						c[i] = JSON.parse(this.getAttribute(i));
					}
				}
			}
			for(i in $.jstree.defaults.core) {
				if($.jstree.defaults.core.hasOwnProperty(i) && this.attributes[i]) {
					c.core[i] = JSON.parse(this.getAttribute(i)) || this.getAttribute(i);
				}
			}
			jQuery(this).jstree(c);
		};
		// proto.attributeChangedCallback = function (name, previous, value) { };
		try {
			document.registerElement("vakata-jstree", { prototype: proto });
		} catch(ignore) { }
	}
}(jQuery));
}));
window.localizationGlossary={"SettingsSaved":"Settings saved.","AddUser":"Add User","Users":"Users","Delete":"Delete","Administrator":"Administrator","Password":"Password","DeleteImage":"Delete Image","MessageThankYouForSupporting":"Thank you for supporting Emby.","MessagePleaseSupportProject":"Please support Emby.","DeleteImageConfirmation":"Are you sure you wish to delete this image?","FileReadCancelled":"The file read has been canceled.","FileNotFound":"File not found.","FileReadError":"An error occurred while reading the file.","DeleteUser":"Delete User","DeleteUserConfirmation":"Are you sure you wish to delete this user?","PasswordResetHeader":"Reset Password","PasswordResetComplete":"The password has been reset.","PinCodeResetComplete":"The pin code has been reset.","PasswordResetConfirmation":"Are you sure you wish to reset the password?","PinCodeResetConfirmation":"Are you sure you wish to reset the pin code?","HeaderPinCodeReset":"Reset Pin Code","PasswordSaved":"Password saved.","PasswordMatchError":"Password and password confirmation must match.","OptionRelease":"Official Release","OptionBeta":"Beta","OptionDev":"Dev (Unstable)","UninstallPluginHeader":"Uninstall Plugin","UninstallPluginConfirmation":"Are you sure you wish to uninstall {0}?","NoPluginConfigurationMessage":"This plugin has nothing to configure.","NoPluginsInstalledMessage":"You have no plugins installed.","BrowsePluginCatalogMessage":"Browse our plugin catalog to view available plugins.","MessageKeyEmailedTo":"Key emailed to {0}.","MessageKeysLinked":"Keys linked.","HeaderConfirmation":"Confirmation","MessageKeyUpdated":"Thank you. Your supporter key has been updated.","MessageKeyRemoved":"Thank you. Your supporter key has been removed.","HeaderSupportTheTeam":"Support the Emby Team","TextEnjoyBonusFeatures":"Enjoy Bonus Features","TitleLiveTV":"Live TV","TitleSync":"Sync","ButtonDonate":"Donate","HeaderMyMedia":"My Media","TitleNotifications":"Notifications","ErrorLaunchingChromecast":"There was an error launching chromecast. Please ensure your device is connected to your wireless network.","MessageErrorLoadingSupporterInfo":"There was an error loading supporter information. Please try again later.","MessageLinkYourSupporterKey":"Link your supporter key with up to {0} Emby Connect members to enjoy free access to the following apps:","HeaderConfirmRemoveUser":"Remove User","MessageSwipeDownOnRemoteControl":"Welcome to remote control. Swipe down anywhere on this screen to go back to where you came from.","MessageConfirmRemoveConnectSupporter":"Are you sure you wish to remove additional supporter benefits from this user?","ValueTimeLimitSingleHour":"Time limit: 1 hour","ValueTimeLimitMultiHour":"Time limit: {0} hours","HeaderUsers":"Users","PluginCategoryGeneral":"General","PluginCategoryContentProvider":"Content Providers","PluginCategoryScreenSaver":"Screen Savers","PluginCategoryTheme":"Themes","PluginCategorySync":"Sync","PluginCategorySocialIntegration":"Social Networks","PluginCategoryNotifications":"Notifications","PluginCategoryMetadata":"Metadata","PluginCategoryLiveTV":"Live TV","PluginCategoryChannel":"Channels","HeaderSearch":"Search","ValueDateCreated":"Date created: {0}","LabelArtist":"Artist","LabelMovie":"Movie","LabelMusicVideo":"Music Video","LabelEpisode":"Episode","LabelSeries":"Series","LabelStopping":"Stopping","LabelCancelled":"(cancelled)","LabelFailed":"(failed)","ButtonHelp":"Help","ButtonSave":"Save","ButtonDownload":"Download","SyncJobStatusQueued":"Queued","SyncJobStatusConverting":"Converting","SyncJobStatusFailed":"Failed","SyncJobStatusCancelled":"Cancelled","SyncJobStatusCompleted":"Synced","SyncJobStatusReadyToTransfer":"Ready to Transfer","SyncJobStatusTransferring":"Transferring","SyncJobStatusCompletedWithError":"Synced with errors","SyncJobItemStatusReadyToTransfer":"Ready to Transfer","LabelCollection":"Collection","HeaderAddToCollection":"Add to Collection","NewCollectionNameExample":"Example: Star Wars Collection","OptionSearchForInternetMetadata":"Search the internet for artwork and metadata","LabelSelectCollection":"Select collection:","HeaderDevices":"Devices","ButtonScheduledTasks":"Scheduled tasks","MessageItemsAdded":"Items added","ButtonAddToCollection":"Add to collection","HeaderSelectCertificatePath":"Select Certificate Path","ConfirmMessageScheduledTaskButton":"This operation normally runs automatically as a scheduled task. It can also be run manually here. To configure the scheduled task, see:","HeaderSupporterBenefit":"A supporter membership provides additional benefits such as access to sync, premium plugins, internet channel content, and more. {0}Learn more{1}.","LabelSyncNoTargetsHelp":"It looks like you don't currently have any apps that support sync.","HeaderWelcomeToProjectServerDashboard":"Welcome to the Emby Server Dashboard","HeaderWelcomeToProjectWebClient":"Welcome to the Emby Web Client","ButtonTakeTheTour":"Take the tour","HeaderWelcomeBack":"Welcome back!","TitlePlugins":"Plugins","ButtonTakeTheTourToSeeWhatsNew":"Take the tour to see what's new","MessageNoSyncJobsFound":"No sync jobs found. Create sync jobs using the Sync buttons found throughout the web interface.","HeaderLibraryAccess":"Library Access","HeaderChannelAccess":"Channel Access","HeaderDeviceAccess":"Device Access","HeaderSelectDevices":"Select Devices","ButtonCancelItem":"Cancel item","ButtonQueueForRetry":"Queue for retry","ButtonReenable":"Re-enable","ButtonLearnMore":"Learn more","SyncJobItemStatusSyncedMarkForRemoval":"Marked for removal","LabelAbortedByServerShutdown":"(Aborted by server shutdown)","LabelScheduledTaskLastRan":"Last ran {0}, taking {1}.","HeaderDeleteTaskTrigger":"Delete Task Trigger","HeaderTaskTriggers":"Task Triggers","MessageDeleteTaskTrigger":"Are you sure you wish to delete this task trigger?","MessageNoPluginsInstalled":"You have no plugins installed.","LabelVersionInstalled":"{0} installed","LabelNumberReviews":"{0} Reviews","LabelFree":"Free","HeaderPlaybackError":"Playback Error","MessagePlaybackErrorNotAllowed":"You're currently not authorized to play this content. Please contact your system administrator for details.","MessagePlaybackErrorNoCompatibleStream":"No compatible streams are currently available. Please try again later or contact your system administrator for details.","MessagePlaybackErrorRateLimitExceeded":"Your playback rate limit has been exceeded. Please contact your system administrator for details.","MessagePlaybackErrorPlaceHolder":"The content chosen is not playable from this device.","HeaderSelectAudio":"Select Audio","HeaderSelectSubtitles":"Select Subtitles","ButtonMarkForRemoval":"Remove from device","ButtonUnmarkForRemoval":"Cancel removal from device","LabelDefaultStream":"(Default)","LabelForcedStream":"(Forced)","LabelDefaultForcedStream":"(Default/Forced)","LabelUnknownLanguage":"Unknown language","MessageConfirmSyncJobItemCancellation":"Are you sure you wish to cancel this item?","ButtonMute":"Mute","ButtonUnmute":"Unmute","ButtonStop":"Stop","ButtonNextTrack":"Next Track","ButtonPause":"Pause","ButtonPlay":"Play","ButtonEdit":"Edit","ButtonQueue":"Queue","ButtonPlayTrailer":"Play trailer","ButtonPlaylist":"Playlist","ButtonPreviousTrack":"Previous Track","LabelEnabled":"Enabled","LabelDisabled":"Disabled","ButtonMoreInformation":"More Information","LabelNoUnreadNotifications":"No unread notifications.","ButtonViewNotifications":"View notifications","ButtonMarkTheseRead":"Mark these read","ButtonClose":"Close","LabelAllPlaysSentToPlayer":"All plays will be sent to the selected player.","MessageInvalidUser":"Invalid username or password. Please try again.","HeaderLoginFailure":"Login Failure","HeaderAllRecordings":"All Recordings","RecommendationBecauseYouLike":"Because you like {0}","RecommendationBecauseYouWatched":"Because you watched {0}","RecommendationDirectedBy":"Directed by {0}","RecommendationStarring":"Starring {0}","HeaderConfirmRecordingCancellation":"Confirm Recording Cancellation","MessageConfirmRecordingCancellation":"Are you sure you wish to cancel this recording?","MessageRecordingCancelled":"Recording cancelled.","HeaderConfirmSeriesCancellation":"Confirm Series Cancellation","MessageConfirmSeriesCancellation":"Are you sure you wish to cancel this series?","MessageSeriesCancelled":"Series cancelled.","HeaderConfirmRecordingDeletion":"Confirm Recording Deletion","MessageConfirmRecordingDeletion":"Are you sure you wish to delete this recording?","MessageRecordingDeleted":"Recording deleted.","ButonCancelRecording":"Cancel Recording","MessageRecordingSaved":"Recording saved.","OptionSunday":"Sunday","OptionMonday":"Monday","OptionTuesday":"Tuesday","OptionWednesday":"Wednesday","OptionThursday":"Thursday","OptionFriday":"Friday","OptionSaturday":"Saturday","OptionEveryday":"Every day","OptionWeekend":"Weekends","OptionWeekday":"Weekdays","HeaderConfirmDeletion":"Confirm Deletion","MessageConfirmPathSubstitutionDeletion":"Are you sure you wish to delete this path substitution?","LiveTvUpdateAvailable":"(Update available)","LabelVersionUpToDate":"Up to date!","ButtonResetTuner":"Reset tuner","HeaderResetTuner":"Reset Tuner","MessageConfirmResetTuner":"Are you sure you wish to reset this tuner? Any active players or recordings will be abruptly stopped.","ButtonCancelSeries":"Cancel Series","HeaderSeriesRecordings":"Series Recordings","LabelAnytime":"Any time","StatusRecording":"Recording","StatusWatching":"Watching","StatusRecordingProgram":"Recording {0}","StatusWatchingProgram":"Watching {0}","HeaderSplitMedia":"Split Media Apart","MessageConfirmSplitMedia":"Are you sure you wish to split the media sources into separate items?","HeaderError":"Error","MessageChromecastConnectionError":"Your Chromecast receiver is unable to connect to your Emby Server. Please check their connections and try again.","MessagePleaseSelectOneItem":"Please select at least one item.","MessagePleaseSelectTwoItems":"Please select at least two items.","MessageTheFollowingItemsWillBeGrouped":"The following titles will be grouped into one item:","MessageConfirmItemGrouping":"Emby apps will automatically choose the optimal version to play based on device and network performance. Are you sure you wish to continue?","HeaderResume":"Resume","HeaderMyViews":"My Views","HeaderLibraryFolders":"Media Folders","HeaderLatestMedia":"Latest Media","ButtonMoreItems":"More...","ButtonMore":"More","HeaderFavoriteMovies":"Favorite Movies","HeaderFavoriteShows":"Favorite Shows","HeaderFavoriteEpisodes":"Favorite Episodes","HeaderFavoriteGames":"Favorite Games","HeaderRatingsDownloads":"Rating / Downloads","HeaderConfirmProfileDeletion":"Confirm Profile Deletion","MessageConfirmProfileDeletion":"Are you sure you wish to delete this profile?","HeaderSelectServerCachePath":"Select Server Cache Path","HeaderSelectTranscodingPath":"Select Transcoding Temporary Path","HeaderSelectImagesByNamePath":"Select Images By Name Path","HeaderSelectMetadataPath":"Select Metadata Path","HeaderSelectServerCachePathHelp":"Browse or enter the path to use for server cache files. The folder must be writeable.","HeaderSelectTranscodingPathHelp":"Browse or enter the path to use for transcoding temporary files. The folder must be writeable.","HeaderSelectImagesByNamePathHelp":"Browse or enter the path to your items by name folder. The folder must be writeable.","HeaderSelectMetadataPathHelp":"Browse or enter the path you'd like to store metadata within. The folder must be writeable.","HeaderSelectChannelDownloadPath":"Select Channel Download Path","HeaderSelectChannelDownloadPathHelp":"Browse or enter the path to use for storing channel cache files. The folder must be writeable.","OptionNewCollection":"New...","ButtonAdd":"Add","ButtonRemove":"Remove","LabelChapterDownloaders":"Chapter downloaders:","LabelChapterDownloadersHelp":"Enable and rank your preferred chapter downloaders in order of priority. Lower priority downloaders will only be used to fill in missing information.","HeaderFavoriteAlbums":"Favorite Albums","HeaderLatestChannelMedia":"Latest Channel Items","ButtonOrganizeFile":"Organize File","ButtonDeleteFile":"Delete File","HeaderOrganizeFile":"Organize File","HeaderDeleteFile":"Delete File","StatusSkipped":"Skipped","StatusFailed":"Failed","StatusSuccess":"Success","MessageFileWillBeDeleted":"The following file will be deleted:","MessageSureYouWishToProceed":"Are you sure you wish to proceed?","MessageDuplicatesWillBeDeleted":"In addition the following dupliates will be deleted:","MessageFollowingFileWillBeMovedFrom":"The following file will be moved from:","MessageDestinationTo":"to:","HeaderSelectWatchFolder":"Select Watch Folder","HeaderSelectWatchFolderHelp":"Browse or enter the path to your watch folder. The folder must be writeable.","OrganizePatternResult":"Result: {0}","HeaderRestart":"Restart","HeaderShutdown":"Shutdown","MessageConfirmRestart":"Are you sure you wish to restart Emby Server?","MessageConfirmShutdown":"Are you sure you wish to shutdown Emby Server?","ButtonUpdateNow":"Update Now","ValueItemCount":"{0} item","ValueItemCountPlural":"{0} items","NewVersionOfSomethingAvailable":"A new version of {0} is available!","VersionXIsAvailableForDownload":"Version {0} is now available for download.","LabelVersionNumber":"Version {0}","LabelPlayMethodTranscoding":"Transcoding","LabelPlayMethodDirectStream":"Direct Streaming","LabelPlayMethodDirectPlay":"Direct Playing","LabelAudioCodec":"Audio: {0}","LabelVideoCodec":"Video: {0}","LabelLocalAccessUrl":"Local access: {0}","LabelRemoteAccessUrl":"Remote access: {0}","LabelRunningOnPort":"Running on http port {0}.","LabelRunningOnPorts":"Running on http port {0}, and https port {1}.","HeaderLatestFromChannel":"Latest from {0}","LabelUnknownLanaguage":"Unknown language","HeaderCurrentSubtitles":"Current Subtitles","MessageDownloadQueued":"The download has been queued.","MessageAreYouSureDeleteSubtitles":"Are you sure you wish to delete this subtitle file?","ButtonRemoteControl":"Remote Control","HeaderLatestTvRecordings":"Latest Recordings","ButtonOk":"Ok","ButtonCancel":"Cancel","ButtonRefresh":"Refresh","LabelCurrentPath":"Current path:","HeaderSelectMediaPath":"Select Media Path","HeaderSelectPath":"Select Path","ButtonNetwork":"Network","MessageDirectoryPickerInstruction":"Network paths can be entered manually in the event the Network button fails to locate your devices. For example, {0} or {1}.","HeaderMenu":"Menu","ButtonOpen":"Open","ButtonOpenInNewTab":"Open in new tab","ButtonShuffle":"Shuffle","ButtonInstantMix":"Instant mix","ButtonResume":"Resume","HeaderScenes":"Scenes","HeaderAudioTracks":"Audio Tracks","HeaderLibraries":"Libraries","HeaderSubtitles":"Subtitles","HeaderVideoQuality":"Video Quality","MessageErrorPlayingVideo":"There was an error playing the video.","MessageEnsureOpenTuner":"Please ensure there is an open tuner availalble.","ButtonHome":"Home","ButtonDashboard":"Dashboard","ButtonReports":"Reports","ButtonMetadataManager":"Metadata Manager","HeaderTime":"Time","HeaderName":"Name","HeaderAlbum":"Album","HeaderAlbumArtist":"Album Artist","HeaderArtist":"Artist","LabelAddedOnDate":"Added {0}","ButtonStart":"Start","HeaderChannels":"Channels","HeaderMediaFolders":"Media Folders","HeaderBlockItemsWithNoRating":"Block content with no rating information:","OptionBlockOthers":"Others","OptionBlockTvShows":"TV Shows","OptionBlockTrailers":"Trailers","OptionBlockMusic":"Music","OptionBlockMovies":"Movies","OptionBlockBooks":"Books","OptionBlockGames":"Games","OptionBlockLiveTvPrograms":"Live TV Programs","OptionBlockLiveTvChannels":"Live TV Channels","OptionBlockChannelContent":"Internet Channel Content","ButtonRevoke":"Revoke","MessageConfirmRevokeApiKey":"Are you sure you wish to revoke this api key? The application's connection to Emby Server will be abruptly terminated.","HeaderConfirmRevokeApiKey":"Revoke Api Key","ValueContainer":"Container: {0}","ValueAudioCodec":"Audio Codec: {0}","ValueVideoCodec":"Video Codec: {0}","ValueCodec":"Codec: {0}","ValueConditions":"Conditions: {0}","LabelAll":"All","HeaderDeleteImage":"Delete Image","MessageFileNotFound":"File not found.","MessageFileReadError":"An error occurred reading this file.","ButtonNextPage":"Next Page","ButtonPreviousPage":"Previous Page","ButtonMoveLeft":"Move left","ButtonMoveRight":"Move right","ButtonBrowseOnlineImages":"Browse online images","HeaderDeleteItem":"Delete Item","ConfirmDeleteItem":"Deleting this item will delete it from both the file system and your media library. Are you sure you wish to continue?","MessagePleaseEnterNameOrId":"Please enter a name or an external Id.","MessageValueNotCorrect":"The value entered is not correct. Please try again.","MessageItemSaved":"Item saved.","MessagePleaseAcceptTermsOfServiceBeforeContinuing":"Please accept the terms of service before continuing.","OptionEnded":"Ended","OptionContinuing":"Continuing","OptionOff":"Off","OptionOn":"On","ButtonSettings":"Settings","ButtonUninstall":"Uninstall","HeaderFields":"Fields","HeaderFieldsHelp":"Slide a field to 'off' to lock it and prevent it's data from being changed.","HeaderLiveTV":"Live TV","MissingLocalTrailer":"Missing local trailer.","MissingPrimaryImage":"Missing primary image.","MissingBackdropImage":"Missing backdrop image.","MissingLogoImage":"Missing logo image.","MissingEpisode":"Missing episode.","OptionScreenshots":"Screenshots","OptionBackdrops":"Backdrops","OptionImages":"Images","OptionKeywords":"Keywords","OptionTags":"Tags","OptionStudios":"Studios","OptionName":"Name","OptionOverview":"Overview","OptionGenres":"Genres","OptionParentalRating":"Parental Rating","OptionPeople":"People","OptionRuntime":"Runtime","OptionProductionLocations":"Production Locations","OptionBirthLocation":"Birth Location","LabelAllChannels":"All channels","LabelLiveProgram":"LIVE","LabelNewProgram":"NEW","LabelPremiereProgram":"PREMIERE","LabelHDProgram":"HD","HeaderChangeFolderType":"Change Content Type","HeaderChangeFolderTypeHelp":"To change the type, please remove and rebuild the folder with the new type.","HeaderAlert":"Alert","MessagePleaseRestart":"Please restart to finish updating.","ButtonRestart":"Restart","MessagePleaseRefreshPage":"Please refresh this page to receive new updates from the server.","ButtonHide":"Hide","MessageSettingsSaved":"Settings saved.","ButtonSignOut":"Sign Out","ButtonMyProfile":"My Profile","ButtonMyPreferences":"My Preferences","MessageBrowserDoesNotSupportWebSockets":"This browser does not support web sockets. For a better experience, try a newer browser such as Chrome, Firefox, IE10+, Safari (iOS) or Opera.","LabelInstallingPackage":"Installing {0}","LabelPackageInstallCompleted":"{0} installation completed.","LabelPackageInstallFailed":"{0} installation failed.","LabelPackageInstallCancelled":"{0} installation cancelled.","TabServer":"Server","TabUsers":"Users","TabLibrary":"Library","TabMetadata":"Metadata","TabDLNA":"DLNA","TabLiveTV":"Live TV","TabAutoOrganize":"Auto-Organize","TabPlugins":"Plugins","TabAdvanced":"Advanced","TabHelp":"Help","TabScheduledTasks":"Scheduled Tasks","ButtonFullscreen":"Fullscreen","ButtonAudioTracks":"Audio Tracks","ButtonSubtitles":"Subtitles","ButtonScenes":"Scenes","ButtonQuality":"Quality","HeaderNotifications":"Notifications","HeaderSelectPlayer":"Select Player:","ButtonSelect":"Select","ButtonNew":"New","MessageInternetExplorerWebm":"For best results with Internet Explorer please install the WebM playback plugin.","HeaderVideoError":"Video Error","ButtonAddToPlaylist":"Add to playlist","HeaderAddToPlaylist":"Add to Playlist","LabelName":"Name:","ButtonSubmit":"Submit","LabelSelectPlaylist":"Playlist:","OptionNewPlaylist":"New playlist...","MessageAddedToPlaylistSuccess":"Ok","ButtonView":"View","ButtonViewSeriesRecording":"View series recording","ValueOriginalAirDate":"Original air date: {0}","ButtonRemoveFromPlaylist":"Remove from playlist","HeaderSpecials":"Specials","HeaderTrailers":"Trailers","HeaderAudio":"Audio","HeaderResolution":"Resolution","HeaderVideo":"Video","HeaderRuntime":"Runtime","HeaderCommunityRating":"Community rating","HeaderPasswordReset":"Password Reset","HeaderParentalRating":"Parental rating","HeaderReleaseDate":"Release date","HeaderDateAdded":"Date added","HeaderSeries":"Series","HeaderSeason":"Season","HeaderSeasonNumber":"Season number","HeaderNetwork":"Network","HeaderYear":"Year","HeaderGameSystem":"Game system","HeaderPlayers":"Players","HeaderEmbeddedImage":"Embedded image","HeaderTrack":"Track","HeaderDisc":"Disc","OptionMovies":"Movies","OptionCollections":"Collections","OptionSeries":"Series","OptionSeasons":"Seasons","OptionEpisodes":"Episodes","OptionGames":"Games","OptionGameSystems":"Game systems","OptionMusicArtists":"Music artists","OptionMusicAlbums":"Music albums","OptionMusicVideos":"Music videos","OptionSongs":"Songs","OptionHomeVideos":"Home videos","OptionBooks":"Books","OptionAdultVideos":"Adult videos","ButtonUp":"Up","ButtonDown":"Down","LabelMetadataReaders":"Metadata readers:","LabelMetadataReadersHelp":"Rank your preferred local metadata sources in order of priority. The first file found will be read.","LabelMetadataDownloaders":"Metadata downloaders:","LabelMetadataDownloadersHelp":"Enable and rank your preferred metadata downloaders in order of priority. Lower priority downloaders will only be used to fill in missing information.","LabelMetadataSavers":"Metadata savers:","LabelMetadataSaversHelp":"Choose the file formats to save your metadata to.","LabelImageFetchers":"Image fetchers:","LabelImageFetchersHelp":"Enable and rank your preferred image fetchers in order of priority.","ButtonQueueAllFromHere":"Queue all from here","ButtonPlayAllFromHere":"Play all from here","LabelDynamicExternalId":"{0} Id:","HeaderIdentify":"Identify Item","PersonTypePerson":"Person","LabelTitleDisplayOrder":"Title display order:","OptionSortName":"Sort name","OptionReleaseDate":"Release date","LabelSeasonNumber":"Season number:","LabelDiscNumber":"Disc number","LabelParentNumber":"Parent number","LabelEpisodeNumber":"Episode number:","LabelTrackNumber":"Track number:","LabelNumber":"Number:","LabelReleaseDate":"Release date:","LabelEndDate":"End date:","LabelYear":"Year:","LabelDateOfBirth":"Date of birth:","LabelBirthYear":"Birth year:","LabelBirthDate":"Birth date:","LabelDeathDate":"Death date:","HeaderRemoveMediaLocation":"Remove Media Location","MessageConfirmRemoveMediaLocation":"Are you sure you wish to remove this location?","HeaderRenameMediaFolder":"Rename Media Folder","LabelNewName":"New name:","HeaderAddMediaFolder":"Add Media Folder","HeaderAddMediaFolderHelp":"Name (Movies, Music, TV, etc):","HeaderRemoveMediaFolder":"Remove Media Folder","MessageTheFollowingLocationWillBeRemovedFromLibrary":"The following media locations will be removed from your library:","MessageAreYouSureYouWishToRemoveMediaFolder":"Are you sure you wish to remove this media folder?","ButtonRename":"Rename","ButtonChangeType":"Change type","HeaderMediaLocations":"Media Locations","LabelContentTypeValue":"Content type: {0}","LabelPathSubstitutionHelp":"Optional: Path substitution can map server paths to network shares that clients can access for direct playback.","FolderTypeUnset":"Unset (mixed content)","FolderTypeMovies":"Movies","FolderTypeMusic":"Music","FolderTypeAdultVideos":"Adult videos","FolderTypePhotos":"Photos","FolderTypeMusicVideos":"Music videos","FolderTypeHomeVideos":"Home videos","FolderTypeGames":"Games","FolderTypeBooks":"Books","FolderTypeTvShows":"TV","TabMovies":"Movies","TabSeries":"Series","TabEpisodes":"Episodes","TabTrailers":"Trailers","TabGames":"Games","TabAlbums":"Albums","TabSongs":"Songs","TabMusicVideos":"Music Videos","BirthPlaceValue":"Birth place: {0}","DeathDateValue":"Died: {0}","BirthDateValue":"Born: {0}","HeaderLatestReviews":"Latest Reviews","HeaderPluginInstallation":"Plugin Installation","MessageAlreadyInstalled":"This version is already installed.","ValueReviewCount":"{0} Reviews","MessageYouHaveVersionInstalled":"You currently have version {0} installed.","MessageTrialExpired":"The trial period for this feature has expired","MessageTrialWillExpireIn":"The trial period for this feature will expire in {0} day(s)","MessageInstallPluginFromApp":"This plugin must be installed from with in the app you intend to use it in.","ValuePriceUSD":"Price: {0} (USD)","MessageFeatureIncludedWithSupporter":"You are registered for this feature, and will be able to continue using it with an active supporter membership.","MessageChangeRecurringPlanConfirm":"After completing this transaction you will need to cancel your previous recurring donation from within your PayPal account. Thank you for supporting Emby.","MessageSupporterMembershipExpiredOn":"Your supporter membership expired on {0}.","MessageYouHaveALifetimeMembership":"You have a lifetime supporter membership. You can provide additional donations on a one-time or recurring basis using the options below. Thank you for supporting Emby.","MessageYouHaveAnActiveRecurringMembership":"You have an active {0} membership. You can upgrade your plan using the options below.","ButtonDelete":"Delete","HeaderEmbyAccountAdded":"Emby Account Added","MessageEmbyAccountAdded":"The Emby account has been added to this user.","MessagePendingEmbyAccountAdded":"The Emby account has been added to this user. An email will be sent to the owner of the account. The invitation will need to be confirmed by clicking a link within the email.","HeaderEmbyAccountRemoved":"Emby Account Removed","MessageEmbyAccontRemoved":"The Emby account has been removed from this user.","TooltipLinkedToEmbyConnect":"Linked to Emby Connect","HeaderUnrated":"Unrated","ValueDiscNumber":"Disc {0}","HeaderUnknownDate":"Unknown Date","HeaderUnknownYear":"Unknown Year","ValueMinutes":"{0} min","ButtonPlayExternalPlayer":"Play with external player","HeaderSelectExternalPlayer":"Select External Player","HeaderExternalPlayerPlayback":"External Player Playback","ButtonImDone":"I'm Done","OptionWatched":"Watched","OptionUnwatched":"Unwatched","ExternalPlayerPlaystateOptionsHelp":"Specify how you would like to resume playing this video next time.","LabelMarkAs":"Mark as:","OptionInProgress":"In-Progress","LabelResumePoint":"Resume point:","ValueOneMovie":"1 movie","ValueMovieCount":"{0} movies","ValueOneTrailer":"1 trailer","ValueTrailerCount":"{0} trailers","ValueOneSeries":"1 series","ValueSeriesCount":"{0} series","ValueOneEpisode":"1 episode","ValueEpisodeCount":"{0} episodes","ValueOneGame":"1 game","ValueGameCount":"{0} games","ValueOneAlbum":"1 album","ValueAlbumCount":"{0} albums","ValueOneSong":"1 song","ValueSongCount":"{0} songs","ValueOneMusicVideo":"1 music video","ValueMusicVideoCount":"{0} music videos","HeaderOffline":"Offline","HeaderUnaired":"Unaired","HeaderMissing":"Missing","ButtonWebsite":"Website","TooltipFavorite":"Favorite","TooltipLike":"Like","TooltipDislike":"Dislike","TooltipPlayed":"Played","ValueSeriesYearToPresent":"{0}-Present","ValueAwards":"Awards: {0}","ValueBudget":"Budget: {0}","ValueRevenue":"Revenue: {0}","ValuePremiered":"Premiered {0}","ValuePremieres":"Premieres {0}","ValueStudio":"Studio: {0}","ValueStudios":"Studios: {0}","ValueStatus":"Status: {0}","ValueSpecialEpisodeName":"Special - {0}","LabelLimit":"Limit:","ValueLinks":"Links: {0}","HeaderPeople":"People","HeaderCastAndCrew":"Cast & Crew","ValueArtist":"Artist: {0}","ValueArtists":"Artists: {0}","HeaderTags":"Tags","MediaInfoCameraMake":"Camera make","MediaInfoCameraModel":"Camera model","MediaInfoAltitude":"Altitude","MediaInfoAperture":"Aperture","MediaInfoExposureTime":"Exposure time","MediaInfoFocalLength":"Focal length","MediaInfoOrientation":"Orientation","MediaInfoIsoSpeedRating":"Iso speed rating","MediaInfoLatitude":"Latitude","MediaInfoLongitude":"Longitude","MediaInfoShutterSpeed":"Shutter speed","MediaInfoSoftware":"Software","HeaderIfYouLikeCheckTheseOut":"If you like {0}, check these out...","HeaderPlotKeywords":"Plot Keywords","HeaderMovies":"Movies","HeaderAlbums":"Albums","HeaderGames":"Games","HeaderBooks":"Books","HeaderEpisodes":"Episodes","HeaderSeasons":"Seasons","HeaderTracks":"Tracks","HeaderItems":"Items","HeaderOtherItems":"Other Items","ButtonFullReview":"Full review","ValueAsRole":"as {0}","ValueGuestStar":"Guest star","MediaInfoSize":"Size","MediaInfoPath":"Path","MediaInfoFormat":"Format","MediaInfoContainer":"Container","MediaInfoDefault":"Default","MediaInfoForced":"Forced","MediaInfoExternal":"External","MediaInfoTimestamp":"Timestamp","MediaInfoPixelFormat":"Pixel format","MediaInfoBitDepth":"Bit depth","MediaInfoSampleRate":"Sample rate","MediaInfoBitrate":"Bitrate","MediaInfoChannels":"Channels","MediaInfoLayout":"Layout","MediaInfoLanguage":"Language","MediaInfoCodec":"Codec","MediaInfoProfile":"Profile","MediaInfoLevel":"Level","MediaInfoAspectRatio":"Aspect ratio","MediaInfoResolution":"Resolution","MediaInfoAnamorphic":"Anamorphic","MediaInfoInterlaced":"Interlaced","MediaInfoFramerate":"Framerate","MediaInfoStreamTypeAudio":"Audio","MediaInfoStreamTypeData":"Data","MediaInfoStreamTypeVideo":"Video","MediaInfoStreamTypeSubtitle":"Subtitle","MediaInfoStreamTypeEmbeddedImage":"Embedded Image","MediaInfoRefFrames":"Ref frames","TabPlayback":"Playback","TabNotifications":"Notifications","TabExpert":"Expert","HeaderSelectCustomIntrosPath":"Select Custom Intros Path","HeaderRateAndReview":"Rate and Review","HeaderThankYou":"Thank You","MessageThankYouForYourReview":"Thank you for your review.","LabelYourRating":"Your rating:","LabelFullReview":"Full review:","LabelShortRatingDescription":"Short rating summary:","OptionIRecommendThisItem":"I recommend this item","WebClientTourContent":"View your recently added media, next episodes, and more. The green circles indicate how many unplayed items you have.","WebClientTourMovies":"Play movies, trailers and more from any device with a web browser","WebClientTourMouseOver":"Hold the mouse over any poster for quick access to important information","WebClientTourTapHold":"Tap and hold or right click any poster for a context menu","WebClientTourMetadataManager":"Click edit to open the metadata manager","WebClientTourPlaylists":"Easily create playlists and instant mixes, and play them on any device","WebClientTourCollections":"Create movie collections to group box sets together","WebClientTourUserPreferences1":"User preferences allow you to customize the way your library is presented in all of your Emby apps","WebClientTourUserPreferences2":"Configure your audio and subtitle language settings once, for every Emby app","WebClientTourUserPreferences3":"Design the web client home page to your liking","WebClientTourUserPreferences4":"Configure backdrops, theme songs and external players","WebClientTourMobile1":"The web client works great on smartphones and tablets...","WebClientTourMobile2":"and easily controls other devices and Emby apps","WebClientTourMySync":"Sync your personal media to your devices for offline viewing.","MessageEnjoyYourStay":"Enjoy your stay","DashboardTourDashboard":"The server dashboard allows you to monitor your server and your users. You'll always know who is doing what and where they are.","DashboardTourHelp":"In-app help provides easy buttons to open wiki pages relating to the on-screen content.","DashboardTourUsers":"Easily create user accounts for your friends and family, each with their own permissions, library access, parental controls and more.","DashboardTourCinemaMode":"Cinema mode brings the theater experience straight to your living room with the ability to play trailers and custom intros before the main feature.","DashboardTourChapters":"Enable chapter image generation for your videos for a more pleasing presentation while viewing.","DashboardTourSubtitles":"Automatically download subtitles for your videos in any language.","DashboardTourPlugins":"Install plugins such as internet video channels, live tv, metadata scanners, and more.","DashboardTourNotifications":"Automatically send notifications of server events to your mobile device, email and more.","DashboardTourScheduledTasks":"Easily manage long running operations with scheduled tasks. Decide when they run, and how often.","DashboardTourMobile":"The Emby Server dashboard works great on smartphones and tablets. Manage your server from the palm of your hand anytime, anywhere.","DashboardTourSync":"Sync your personal media to your devices for offline viewing.","MessageRefreshQueued":"Refresh queued","TabDevices":"Devices","TabExtras":"Extras","DeviceLastUsedByUserName":"Last used by {0}","HeaderDeleteDevice":"Delete Device","DeleteDeviceConfirmation":"Are you sure you wish to delete this device? It will reappear the next time a user signs in with it.","LabelEnableCameraUploadFor":"Enable camera upload for:","HeaderSelectUploadPath":"Select Upload Path","LabelEnableCameraUploadForHelp":"Uploads will occur automatically in the background when signed into Emby.","ErrorMessageStartHourGreaterThanEnd":"End time must be greater than the start time.","ButtonLibraryAccess":"Library access","ButtonParentalControl":"Parental control","HeaderInvitationSent":"Invitation Sent","MessageInvitationSentToUser":"An email has been sent to {0}, inviting them to accept your sharing invitation.","MessageInvitationSentToNewUser":"An email has been sent to {0} inviting them to sign up with Emby.","HeaderConnectionFailure":"Connection Failure","MessageUnableToConnectToServer":"We're unable to connect to the selected server right now. Please ensure it is running and try again.","ButtonSelectServer":"Select server","MessagePluginConfigurationRequiresLocalAccess":"To configure this plugin please sign in to your local server directly.","MessageLoggedOutParentalControl":"Access is currently restricted. Please try again later.","DefaultErrorMessage":"There was an error processing the request. Please try again later.","ButtonAccept":"Accept","ButtonReject":"Reject","HeaderForgotPassword":"Forgot Password","MessageContactAdminToResetPassword":"Please contact your system administrator to reset your password.","MessageForgotPasswordInNetworkRequired":"Please try again within your home network to initiate the password reset process.","MessageForgotPasswordFileCreated":"The following file has been created on your server and contains instructions on how to proceed:","MessageForgotPasswordFileExpiration":"The reset pin will expire at {0}.","MessageInvalidForgotPasswordPin":"An invalid or expired pin was entered. Please try again.","MessagePasswordResetForUsers":"Passwords have been removed for the following users:","HeaderInviteGuest":"Invite Guest","ButtonLinkMyEmbyAccount":"Link my account now","MessageConnectAccountRequiredToInviteGuest":"In order to invite guests you need to first link your Emby account to this server.","ButtonSync":"Sync","SyncMedia":"Sync Media","HeaderCancelSyncJob":"Cancel Sync","CancelSyncJobConfirmation":"Cancelling the sync job will remove synced media from the device during the next sync process. Are you sure you wish to proceed?","TabSync":"Sync","MessagePleaseSelectDeviceToSyncTo":"Please select a device to sync to.","MessageSyncJobCreated":"Sync job created.","LabelSyncTo":"Sync to:","LabelSyncJobName":"Sync job name:","LabelQuality":"Quality:","HeaderSettings":"Settings","OptionAutomaticallySyncNewContent":"Automatically sync new content","OptionAutomaticallySyncNewContentHelp":"New content added to this category will be automatically synced to the device.","OptionSyncUnwatchedVideosOnly":"Sync unwatched videos only","OptionSyncUnwatchedVideosOnlyHelp":"Only unwatched videos will be synced, and videos will be removed from the device as they are watched.","LabelItemLimit":"Item limit:","LabelItemLimitHelp":"Optional. Set a limit to the number of items that will be synced.","MessageBookPluginRequired":"Requires installation of the Bookshelf plugin","MessageGamePluginRequired":"Requires installation of the GameBrowser plugin","MessageUnsetContentHelp":"Content will be displayed as plain folders. For best results use the metadata manager to set the content types of sub-folders.","SyncJobItemStatusQueued":"Queued","SyncJobItemStatusConverting":"Converting","SyncJobItemStatusTransferring":"Transferring","SyncJobItemStatusSynced":"Synced","SyncJobItemStatusFailed":"Failed","SyncJobItemStatusRemovedFromDevice":"Removed from device","SyncJobItemStatusCancelled":"Cancelled","LabelProfile":"Profile:","LabelBitrateMbps":"Bitrate (Mbps):"}
window.appMode='cordova';window.dashboardVersion='635661107749984106';
var Logger={log:function(str){console.log(str);}};var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;b&&h.mixIn(b);h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)});h.init.prototype=h;h.$super=this;return h},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[];this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;b=b.sigBytes;this.clamp();if(j%4)for(var g=0;g<b;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;g<b;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);this.sigBytes+=b;return this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<32-8*(h%4);b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var h=[],a=0;a<b;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16));g.push((k&15).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j+=2)g[j>>>3]|=parseInt(b.substr(j,2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;j<b;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;j<a;j++)g[j>>>2]|=(b.charCodeAt(j)&255)<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data");}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((m|0)-this._minBufferSize,0);b=m*k;j=s.min(4*b,j);if(b){for(var l=0;l<b;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b);a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return(new b.init(g)).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return(new k.HMAC.init(b,g)).finalize(a)}}});var k=m.algo={};return m}(Math);(function(s){function p(a,k,b,h,l,j,m){a=a+(k&b|~k&h)+l+m;return(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){a=a+(k&h|b&~h)+l+m;return(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){a=a+(k^b^h)+l+m;return(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){a=a+(b^(k|~h))+l+m;return(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0;b[1]=b[1]+d|0;b[2]=b[2]+e|0;b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/4294967296);k[(h+64>>>9<<4)+15]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;k[(h+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;a.sigBytes=4*(k.length+1);this._process();a=this._hash;k=a.words;for(b=0;4>b;b++)h=k[b],k[b]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360;return a},clone:function(){var a=t.clone.call(this);a._hash=this._hash.clone();return a}});r.MD5=t._createHelper(q);r.HmacMD5=t._createHmacHelper(q)})(Math);var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,f)).finalize(b)}}});var s=p.algo={};return p}(Math);(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();(function(globalScope,localStorage,sessionStorage){function myStore(defaultObject){var self=this;self.localData={};var isDefaultAvailable;if(defaultObject){try{defaultObject.setItem('_test','0');isDefaultAvailable=true;}catch(e){}}
self.setItem=function(name,value){if(isDefaultAvailable){defaultObject.setItem(name,value);}else{self.localData[name]=value;}};self.getItem=function(name){if(isDefaultAvailable){return defaultObject.getItem(name);}
return self.localData[name];};self.removeItem=function(name){if(isDefaultAvailable){defaultObject.removeItem(name);}else{self.localData[name]=null;}};}
globalScope.store=new myStore(localStorage);globalScope.sessionStore=new myStore(sessionStorage);})(window,window.localStorage,window.sessionStorage);(function(globalScope,navigator){function networkStatus(){var self=this;self.isNetworkAvailable=function(){var online=navigator.onLine;if(online==null){online=true;}
return online;};self.isAnyLocalNetworkAvailable=function(){return self.isNetworkAvailable();};}
globalScope.NetworkStatus=new networkStatus();})(window,window.navigator);(function(globalScope){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.generateDeviceId=function(){var keys=[];keys.push(navigator.userAgent);keys.push((navigator.cpuClass||""));var randomId='';randomId=store.getItem('randomId');if(!randomId){randomId=new Date().getTime();store.setItem('randomId',randomId.toString());}
keys.push(randomId);return CryptoJS.SHA1(keys.join('|')).toString();};})(window);(function(globalScope,JSON){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.CredentialProvider=function(){var self=this;var credentials;var key='servercredentials3';function ensure(){credentials=credentials||JSON.parse(store.getItem(key)||'{}');credentials.servers=credentials.servers||[];}
function get(){ensure();return credentials;}
function set(data){if(data){credentials=data;store.setItem(key,JSON.stringify(data));}else{self.clear();}}
self.clear=function(){credentials=null;store.removeItem(key);};self.credentials=function(data){if(data){set(data);}
return get();};self.addOrUpdateServer=function(list,server){var existing=list.filter(function(s){return s.Id==server.Id;})[0];if(existing){existing.DateLastAccessed=Math.max(existing.DateLastAccessed||0,server.DateLastAccessed||0);if(server.AccessToken){existing.AccessToken=server.AccessToken;existing.UserId=server.UserId;}
if(server.ExchangeToken){existing.ExchangeToken=server.ExchangeToken;}
if(server.RemoteAddress){existing.RemoteAddress=server.RemoteAddress;}
if(server.LocalAddress){existing.LocalAddress=server.LocalAddress;}
if(server.Name){existing.Name=server.Name;}
if(server.WakeOnLanInfos&&server.WakeOnLanInfos.length){existing.WakeOnLanInfos=server.WakeOnLanInfos;}}
else{list.push(server);}};};})(window,window.JSON);(function(globalScope){globalScope.AjaxApi={param:function(params){return jQuery.param(params);},ajax:function(request){return jQuery.ajax(request);}};})(window);(function(globalScope){globalScope.Events={on:function(obj,eventName,selector,fn){Logger.log('event.on '+eventName);jQuery(obj).on(eventName,selector,fn);},off:function(obj,eventName,selector,fn){Logger.log('event.off '+eventName);jQuery(obj).off(eventName,selector,fn);},trigger:function(obj,eventName,params){Logger.log('event.trigger '+eventName);jQuery(obj).trigger(eventName,params);}};})(window);(function(globalScope){globalScope.DeferredBuilder={Deferred:function(){return jQuery.Deferred();},when:function(promises){return jQuery.when(promises);}};})(window);(function(globalScope,JSON,WebSocket,setTimeout,devicePixelRatio,FileReader){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.ApiClient=function(logger,serverAddress,clientName,applicationVersion,deviceName,deviceId){if(!serverAddress){throw new Error("Must supply a serverAddress");}
logger.log('ApiClient serverAddress: '+serverAddress);logger.log('ApiClient clientName: '+clientName);logger.log('ApiClient applicationVersion: '+applicationVersion);logger.log('ApiClient deviceName: '+deviceName);logger.log('ApiClient deviceId: '+deviceId);var self=this;var currentUserId;var accessToken;var webSocket;var serverInfo;self.serverAddress=function(val){if(val!=null){var changed=val!=serverAddress;serverAddress=val;if(changed){Events.trigger(this,'serveraddresschanged');}}
return serverAddress;};self.serverInfo=function(info){serverInfo=info||serverInfo;return serverInfo;};var currentUser;self.getCurrentUser=function(){if(currentUser!=null){var deferred=DeferredBuilder.Deferred();deferred.resolveWith(null,[currentUser]);return deferred.promise();}
return self.getUser(self.getCurrentUserId()).done(function(user){currentUser=user;});};self.getCurrentUserId=function(){return currentUserId;};self.accessToken=function(){return accessToken;};self.setCurrentUserId=function(userId,token){currentUserId=userId;currentUser=null;accessToken=token;};self.deviceName=function(){return deviceName;};self.deviceId=function(){return deviceId;};self.clearAuthenticationInfo=function(){accessToken=null;currentUserId=null;};self.setAuthenticationInfo=function(accessKey,userId){accessToken=accessKey;currentUserId=userId;};self.encodeName=function(name){name=name.split('/').join('-');name=name.split('&').join('-');name=name.split('?').join('-');var val=AjaxApi.param({name:name});return val.substring(val.indexOf('=')+1).replace("'",'%27');};function onRequestFail(e){Events.trigger(self,'requestfail',[{url:this.url,status:e.status,errorCode:e.getResponseHeader("X-Application-Error-Code")}]);}
function onRetryRequestFail(request){Events.trigger(self,'requestfail',[{url:request.url}]);}
self.ajax=function(request,includeAuthorization){if(!request){throw new Error("Request cannot be null");}
if(includeAuthorization!==false){if(clientName){var auth='MediaBrowser Client="'+clientName+'", Device="'+deviceName+'", DeviceId="'+deviceId+'", Version="'+applicationVersion+'"';if(currentUserId){auth+=', UserId="'+currentUserId+'"';}
request.headers={Authorization:auth};}
if(accessToken){request.headers['X-MediaBrowser-Token']=accessToken;}}
if(!self.enableAutomaticNetwork||!self.serverInfo()||self.connectionMode==null){logger.log('Requesting url without automatic networking: '+request.url);return AjaxApi.ajax(request).fail(onRequestFail);}
var deferred=DeferredBuilder.Deferred();self.ajaxWithFailover(request,deferred,true);return deferred.promise();};function switchConnectionMode(connectionMode){var newConnectionMode;if(connectionMode==MediaBrowser.ConnectionMode.Local&&serverInfo.RemoteAddress){newConnectionMode=MediaBrowser.ConnectionMode.Remote;}
else if(connectionMode==MediaBrowser.ConnectionMode.Remote&&serverInfo.LocalAddress){newConnectionMode=MediaBrowser.ConnectionMode.Local;}
else{newConnectionMode=connectionMode;}
return newConnectionMode;}
function tryReconnectInternal(deferred,connectionMode,currentRetryCount){var url=connectionMode==MediaBrowser.ConnectionMode.Local?self.serverInfo().LocalAddress:self.serverInfo().RemoteAddress;logger.log("Attempting reconnection to "+url);AjaxApi.ajax({type:"GET",url:url+"/system/info/public",dataType:"json",timeout:15000}).done(function(){logger.log("Reconnect succeeeded to "+url);self.connectionMode=connectionMode;self.serverAddress(url);deferred.resolve();}).fail(function(){logger.log("Reconnect attempt failed to "+url);if(currentRetryCount<=6){var newConnectionMode=switchConnectionMode(connectionMode);setTimeout(function(){tryReconnectInternal(deferred,newConnectionMode,currentRetryCount+1);},500);}else{deferred.reject();}});}
function tryReconnect(){var deferred=DeferredBuilder.Deferred();setTimeout(function(){tryReconnectInternal(deferred,self.connectionMode,0);},500);return deferred.promise();}
function replaceServerAddress(url,oldBaseUrl,newBaseUrl){return url.replace(oldBaseUrl,newBaseUrl);}
self.ajaxWithFailover=function(request,deferred,enableReconnection,replaceUrl){if(replaceUrl){var baseUrl=self.connectionMode==MediaBrowser.ConnectionMode.Local?self.serverInfo().LocalAddress:self.serverInfo().RemoteAddress;request.url=replaceServerAddress(request.url,baseUrl);}
logger.log("Requesting "+request.url);request.timeout=15000;AjaxApi.ajax(request).done(function(response){deferred.resolve(response,0);}).fail(function(e,textStatus){logger.log("Request failed with textStatus "+textStatus+" to "+request.url);var statusCode=parseInt(e.status||'0');var isUserErrorCode=statusCode>=400&&statusCode<500;if(enableReconnection&&!isUserErrorCode){tryReconnect().done(function(){logger.log("Reconnect succeesed");self.ajaxWithFailover(request,deferred,false,true);}).fail(function(){logger.log("Reconnect failed");onRetryRequestFail(request);deferred.reject();});}else{onRetryRequestFail(request);deferred.reject();}});};self.get=function(url){return self.ajax({type:"GET",url:url});};self.getJSON=function(url){return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUrl=function(name,params){if(!name){throw new Error("Url name cannot be empty");}
var url=serverAddress;if(name.charAt(0)!='/'){url+='/';}
url+=name;if(params){url+="?"+AjaxApi.param(params);}
return url;};self.enableAutomaticNetworking=function(server,connectionMode){logger.log('Begin enableAutomaticNetworking');self.serverInfo(server);self.connectionMode=connectionMode;self.enableAutomaticNetwork=true;var url=connectionMode==MediaBrowser.ConnectionMode.Local?self.serverInfo().LocalAddress:self.serverInfo().RemoteAddress;logger.log('Setting server address to '+url);self.serverAddress(url);};self.isWebSocketSupported=function(){return WebSocket!=null;};self.openWebSocket=function(){if(!accessToken){throw new Error("Cannot open web socket without access token.");}
var url=serverAddress.replace('http','ws');url+="?api_key="+accessToken;url+="&deviceId="+deviceId;webSocket=new WebSocket(url);webSocket.onmessage=function(msg){msg=JSON.parse(msg.data);Events.trigger(self,'websocketmessage',[msg]);};webSocket.onopen=function(){logger.log('web socket connection opened');setTimeout(function(){Events.trigger(self,'websocketopen');},0);};webSocket.onerror=function(){setTimeout(function(){Events.trigger(self,'websocketerror');},0);};webSocket.onclose=function(){setTimeout(function(){Events.trigger(self,'websocketclose');},0);};};self.closeWebSocket=function(){if(webSocket&&webSocket.readyState===WebSocket.OPEN){webSocket.close();}};self.sendWebSocketMessage=function(name,data){logger.log('Sending web socket message: '+name);var msg={MessageType:name};if(data){msg.Data=data;}
msg=JSON.stringify(msg);webSocket.send(msg);};self.isWebSocketOpen=function(){return webSocket&&webSocket.readyState===WebSocket.OPEN;};self.isWebSocketOpenOrConnecting=function(){return webSocket&&(webSocket.readyState===WebSocket.OPEN||webSocket.readyState===WebSocket.CONNECTING);};self.getProductNews=function(options){options=options||{};var url=self.getUrl("News/Product",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getItem=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getRootFolder=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Items/Root");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNotificationSummary=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Notifications/"+userId+"/Summary");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNotifications=function(userId,options){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Notifications/"+userId,options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.markNotificationsRead=function(userId,idList,isRead){if(!userId){throw new Error("null userId");}
if(!idList){throw new Error("null idList");}
var suffix=isRead?"Read":"Unread";var params={UserId:userId,Ids:idList.join(',')};var url=self.getUrl("Notifications/"+userId+"/"+suffix,params);return self.ajax({type:"POST",url:url});};self.logout=function(){var done=function(){self.setCurrentUserId(null,null);};if(accessToken){var url=self.getUrl("Sessions/Logout");return self.ajax({type:"POST",url:url}).done(done);}
var deferred=DeferredBuilder.Deferred();deferred.resolveWith(null,[]);return deferred.promise().done(done);};function getRemoteImagePrefix(options){var urlPrefix;if(options.artist){urlPrefix="Artists/"+self.encodeName(options.artist);delete options.artist;}else if(options.person){urlPrefix="Persons/"+self.encodeName(options.person);delete options.person;}else if(options.genre){urlPrefix="Genres/"+self.encodeName(options.genre);delete options.genre;}else if(options.musicGenre){urlPrefix="MusicGenres/"+self.encodeName(options.musicGenre);delete options.musicGenre;}else if(options.gameGenre){urlPrefix="GameGenres/"+self.encodeName(options.gameGenre);delete options.gameGenre;}else if(options.studio){urlPrefix="Studios/"+self.encodeName(options.studio);delete options.studio;}else{urlPrefix="Items/"+options.itemId;delete options.itemId;}
return urlPrefix;}
self.getRemoteImageProviders=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages/Providers",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailableRemoteImages=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.downloadRemoteImage=function(options){if(!options){throw new Error("null options");}
var urlPrefix=getRemoteImagePrefix(options);var url=self.getUrl(urlPrefix+"/RemoteImages/Download",options);return self.ajax({type:"POST",url:url});};self.getLiveTvInfo=function(options){var url=self.getUrl("LiveTv/Info",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvGuideInfo=function(options){var url=self.getUrl("LiveTv/GuideInfo",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvChannel=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Channels/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvChannels=function(options){var url=self.getUrl("LiveTv/Channels",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvPrograms=function(options){options=options||{};if(options.channelIds&&options.channelIds.length>1800){return self.ajax({type:"POST",url:self.getUrl("LiveTv/Programs"),data:JSON.stringify(options),contentType:"application/json",dataType:"json"});}else{return self.ajax({type:"GET",url:self.getUrl("LiveTv/Programs",options),dataType:"json"});}};self.getLiveTvRecommendedPrograms=function(options){options=options||{};return self.ajax({type:"GET",url:self.getUrl("LiveTv/Programs/Recommended",options),dataType:"json"});};self.getLiveTvRecordings=function(options){var url=self.getUrl("LiveTv/Recordings",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecordingGroups=function(options){var url=self.getUrl("LiveTv/Recordings/Groups",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecordingGroup=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Recordings/Groups/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvRecording=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Recordings/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvProgram=function(id,userId){if(!id){throw new Error("null id");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("LiveTv/Programs/"+id,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.deleteLiveTvRecording=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Recordings/"+id);return self.ajax({type:"DELETE",url:url});};self.cancelLiveTvTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Timers/"+id);return self.ajax({type:"DELETE",url:url});};self.getLiveTvTimers=function(options){var url=self.getUrl("LiveTv/Timers",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLiveTvTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Timers/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNewLiveTvTimerDefaults=function(options){options=options||{};var url=self.getUrl("LiveTv/Timers/Defaults",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.createLiveTvTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/Timers");return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updateLiveTvTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/Timers/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.resetLiveTvTuner=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/Tuners/"+id+"/Reset");return self.ajax({type:"POST",url:url});};self.getLiveTvSeriesTimers=function(options){var url=self.getUrl("LiveTv/SeriesTimers",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getFileOrganizationResults=function(options){var url=self.getUrl("Library/FileOrganization",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.deleteOriginalFileFromOrganizationResult=function(id){var url=self.getUrl("Library/FileOrganizations/"+id+"/File");return self.ajax({type:"DELETE",url:url});};self.clearOrganizationLog=function(){var url=self.getUrl("Library/FileOrganizations");return self.ajax({type:"DELETE",url:url});};self.performOrganization=function(id){var url=self.getUrl("Library/FileOrganizations/"+id+"/Organize");return self.ajax({type:"POST",url:url});};self.performEpisodeOrganization=function(id,options){var url=self.getUrl("Library/FileOrganizations/"+id+"/Episode/Organize",options||{});return self.ajax({type:"POST",url:url});};self.getLiveTvSeriesTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/SeriesTimers/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.cancelLiveTvSeriesTimer=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("LiveTv/SeriesTimers/"+id);return self.ajax({type:"DELETE",url:url});};self.createLiveTvSeriesTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/SeriesTimers");return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updateLiveTvSeriesTimer=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("LiveTv/SeriesTimers/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.getSystemInfo=function(){var url=self.getUrl("System/Info");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPublicSystemInfo=function(){var url=self.getUrl("System/Info/Public");return self.ajax({type:"GET",url:url,dataType:"json"},false);};self.getInstantMixFromSong=function(itemId,options){var url=self.getUrl("Songs/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromAlbum=function(itemId,options){var url=self.getUrl("Albums/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromArtist=function(options){var url=self.getUrl("Artists/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromMusicGenre=function(options){var url=self.getUrl("MusicGenres/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getInstantMixFromPlaylist=function(itemId,options){var url=self.getUrl("Playlists/"+itemId+"/InstantMix",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getEpisodes=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Episodes",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDisplayPreferences=function(id,userId,app){var url=self.getUrl("DisplayPreferences/"+id,{userId:userId,client:app});return self.ajax({type:"GET",url:url,dataType:"json"});};self.updateDisplayPreferences=function(id,obj,userId,app){var url=self.getUrl("DisplayPreferences/"+id,{userId:userId,client:app});return self.ajax({type:"POST",url:url,data:JSON.stringify(obj),contentType:"application/json"});};self.getSeasons=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Seasons",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarMovies=function(itemId,options){var url=self.getUrl("Movies/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarTrailers=function(itemId,options){var url=self.getUrl("Trailers/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarShows=function(itemId,options){var url=self.getUrl("Shows/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarAlbums=function(itemId,options){var url=self.getUrl("Albums/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSimilarGames=function(itemId,options){var url=self.getUrl("Games/"+itemId+"/Similar",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCultures=function(){var url=self.getUrl("Localization/cultures");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCountries=function(){var url=self.getUrl("Localization/countries");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPluginSecurityInfo=function(){var url=self.getUrl("Plugins/SecurityInfo");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDirectoryContents=function(path,options){if(!path){throw new Error("null path");}
options=options||{};options.path=path;var url=self.getUrl("Environment/DirectoryContents",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNetworkShares=function(path){if(!path){throw new Error("null path");}
var options={};options.path=path;var url=self.getUrl("Environment/NetworkShares",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getParentPath=function(path){if(!path){throw new Error("null path");}
var options={};options.path=path;var url=self.getUrl("Environment/ParentPath",options);return self.ajax({type:"GET",url:url});};self.getDrives=function(){var url=self.getUrl("Environment/Drives");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNetworkDevices=function(){var url=self.getUrl("Environment/NetworkDevices");return self.ajax({type:"GET",url:url,dataType:"json"});};self.cancelPackageInstallation=function(installationId){if(!installationId){throw new Error("null installationId");}
var url=self.getUrl("Packages/Installing/"+installationId);return self.ajax({type:"DELETE",url:url});};self.refreshItem=function(itemId,options){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId+"/Refresh",options||{});return self.ajax({type:"POST",url:url});};self.installPlugin=function(name,guid,updateClass,version){if(!name){throw new Error("null name");}
if(!updateClass){throw new Error("null updateClass");}
var options={updateClass:updateClass,AssemblyGuid:guid};if(version){options.version=version;}
var url=self.getUrl("Packages/Installed/"+name,options);return self.ajax({type:"POST",url:url});};self.restartServer=function(){var url=self.getUrl("System/Restart");return self.ajax({type:"POST",url:url});};self.shutdownServer=function(){var url=self.getUrl("System/Shutdown");return self.ajax({type:"POST",url:url});};self.getPackageInfo=function(name,guid){if(!name){throw new Error("null name");}
var options={AssemblyGuid:guid};var url=self.getUrl("Packages/"+name,options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailableApplicationUpdate=function(){var url=self.getUrl("Packages/Updates",{PackageType:"System"});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailablePluginUpdates=function(){var url=self.getUrl("Packages/Updates",{PackageType:"UserInstalled"});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getVirtualFolders=function(){var url="Library/VirtualFolders";url=self.getUrl(url);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPhysicalPaths=function(){var url=self.getUrl("Library/PhysicalPaths");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getServerConfiguration=function(){var url=self.getUrl("System/Configuration");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNamedConfiguration=function(name){var url=self.getUrl("System/Configuration/"+name);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getScheduledTasks=function(options){options=options||{};var url=self.getUrl("ScheduledTasks",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.startScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/Running/"+id);return self.ajax({type:"POST",url:url});};self.getScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getNextUpEpisodes=function(options){var url=self.getUrl("Shows/NextUp",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.stopScheduledTask=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("ScheduledTasks/Running/"+id);return self.ajax({type:"DELETE",url:url});};self.getPluginConfiguration=function(id){if(!id){throw new Error("null Id");}
var url=self.getUrl("Plugins/"+id+"/Configuration");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAvailablePlugins=function(options){options=options||{};options.PackageType="UserInstalled";var url=self.getUrl("Packages",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.uninstallPlugin=function(id){if(!id){throw new Error("null Id");}
var url=self.getUrl("Plugins/"+id);return self.ajax({type:"DELETE",url:url});};self.removeVirtualFolder=function(name,refreshLibrary){if(!name){throw new Error("null name");}
var url="Library/VirtualFolders";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,name:name});return self.ajax({type:"DELETE",url:url});};self.addVirtualFolder=function(name,type,refreshLibrary){if(!name){throw new Error("null name");}
var options={};if(type){options.collectionType=type;}
options.refreshLibrary=refreshLibrary?true:false;options.name=name;var url="Library/VirtualFolders";url=self.getUrl(url,options);return self.ajax({type:"POST",url:url});};self.renameVirtualFolder=function(name,newName,refreshLibrary){if(!name){throw new Error("null name");}
var url="Library/VirtualFolders/Name";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,newName:newName,name:name});return self.ajax({type:"POST",url:url});};self.addMediaPath=function(virtualFolderName,mediaPath,refreshLibrary){if(!virtualFolderName){throw new Error("null virtualFolderName");}
if(!mediaPath){throw new Error("null mediaPath");}
var url="Library/VirtualFolders/Paths";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,path:mediaPath,name:virtualFolderName});return self.ajax({type:"POST",url:url});};self.removeMediaPath=function(virtualFolderName,mediaPath,refreshLibrary){if(!virtualFolderName){throw new Error("null virtualFolderName");}
if(!mediaPath){throw new Error("null mediaPath");}
var url="Library/VirtualFolders/Paths";url=self.getUrl(url,{refreshLibrary:refreshLibrary?true:false,path:mediaPath,name:virtualFolderName});return self.ajax({type:"DELETE",url:url});};self.deleteUser=function(id){if(!id){throw new Error("null id");}
var url=self.getUrl("Users/"+id);return self.ajax({type:"DELETE",url:url});};self.deleteUserImage=function(userId,imageType,imageIndex){if(!userId){throw new Error("null userId");}
if(!imageType){throw new Error("null imageType");}
var url=self.getUrl("Users/"+userId+"/Images/"+imageType);if(imageIndex!=null){url+="/"+imageIndex;}
return self.ajax({type:"DELETE",url:url});};self.deleteItemImage=function(itemId,imageType,imageIndex){if(!imageType){throw new Error("null imageType");}
var url=self.getUrl("Items/"+itemId+"/Images");url+="/"+imageType;if(imageIndex!=null){url+="/"+imageIndex;}
return self.ajax({type:"DELETE",url:url});};self.deleteItem=function(itemId){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId);return self.ajax({type:"DELETE",url:url});};self.stopActiveEncodings=function(playSessionId){var options={deviceId:deviceId};if(playSessionId){options.PlaySessionId=playSessionId;}
var url=self.getUrl("Videos/ActiveEncodings",options);return self.ajax({type:"DELETE",url:url});};self.reportCapabilities=function(options){var url=self.getUrl("Sessions/Capabilities/Full");return self.ajax({type:"POST",url:url,data:JSON.stringify(options),contentType:"application/json"});};self.updateItemImageIndex=function(itemId,imageType,imageIndex,newIndex){if(!imageType){throw new Error("null imageType");}
var options={newIndex:newIndex};var url=self.getUrl("Items/"+itemId+"/Images/"+imageType+"/"+imageIndex+"/Index",options);return self.ajax({type:"POST",url:url});};self.getItemImageInfos=function(itemId){var url=self.getUrl("Items/"+itemId+"/Images");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getCriticReviews=function(itemId,options){if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Items/"+itemId+"/CriticReviews",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSessions=function(options){var url=self.getUrl("Sessions",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.uploadUserImage=function(userId,imageType,file){if(!userId){throw new Error("null userId");}
if(!imageType){throw new Error("null imageType");}
if(!file){throw new Error("File must be an image.");}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){throw new Error("File must be an image.");}
var deferred=DeferredBuilder.Deferred();var reader=new FileReader();reader.onerror=function(){deferred.reject();};reader.onabort=function(){deferred.reject();};reader.onload=function(e){var data=e.target.result.split(',')[1];var url=self.getUrl("Users/"+userId+"/Images/"+imageType);self.ajax({type:"POST",url:url,data:data,contentType:"image/"+file.name.substring(file.name.lastIndexOf('.')+1)}).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});};reader.readAsDataURL(file);return deferred.promise();};self.uploadItemImage=function(itemId,imageType,file){if(!itemId){throw new Error("null itemId");}
if(!imageType){throw new Error("null imageType");}
if(!file){throw new Error("File must be an image.");}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){throw new Error("File must be an image.");}
var url=self.getUrl("Items/"+itemId+"/Images");url+="/"+imageType;var deferred=DeferredBuilder.Deferred();var reader=new FileReader();reader.onerror=function(){deferred.reject();};reader.onabort=function(){deferred.reject();};reader.onload=function(e){var data=e.target.result.split(',')[1];self.ajax({type:"POST",url:url,data:data,contentType:"image/"+file.name.substring(file.name.lastIndexOf('.')+1)}).done(function(result){deferred.resolveWith(null,[result]);}).fail(function(){deferred.reject();});};reader.readAsDataURL(file);return deferred.promise();};self.getInstalledPlugins=function(){var url=self.getUrl("Plugins");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUser=function(id){if(!id){throw new Error("Must supply a userId");}
var url=self.getUrl("Users/"+id);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getStudio=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Studios/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Genres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getMusicGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("MusicGenres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGameGenre=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("GameGenres/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getArtist=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Artists/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPerson=function(name,userId){if(!name){throw new Error("null name");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Persons/"+self.encodeName(name),options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPublicUsers=function(){var url=self.getUrl("users/public");return self.ajax({type:"GET",url:url,dataType:"json"},false);};self.getUsers=function(options){var url=self.getUrl("users",options||{});return self.ajax({type:"GET",url:url,dataType:"json"});};self.getParentalRatings=function(){var url=self.getUrl("Localization/ParentalRatings");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDefaultImageQuality=function(imageType){return imageType.toLowerCase()=='backdrop'?80:90;};function normalizeImageOptions(options){var ratio=devicePixelRatio||1;if(ratio){if(options.minScale){ratio=Math.max(options.minScale,ratio);}
if(options.width){options.width=Math.round(options.width*ratio);}
if(options.height){options.height=Math.round(options.height*ratio);}
if(options.maxWidth){options.maxWidth=Math.round(options.maxWidth*ratio);}
if(options.maxHeight){options.maxHeight=Math.round(options.maxHeight*ratio);}}
options.quality=options.quality||self.getDefaultImageQuality(options.type);}
self.getUserImageUrl=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};var url="Users/"+userId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
normalizeImageOptions(options);delete options.type;delete options.index;return self.getUrl(url,options);};self.getImageUrl=function(itemId,options){if(!itemId){throw new Error("itemId cannot be empty");}
options=options||{};var url="Items/"+itemId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
options.quality=options.quality||(options.type.toLowerCase()=='backdrop'?80:90);delete options.type;delete options.index;return self.getUrl(url,options);};self.getScaledImageUrl=function(itemId,options){if(!itemId){throw new Error("itemId cannot be empty");}
options=options||{};var url="Items/"+itemId+"/Images/"+options.type;if(options.index!=null){url+="/"+options.index;}
normalizeImageOptions(options);delete options.type;delete options.index;delete options.minScale;return self.getUrl(url,options);};self.getThumbImageUrl=function(item,options){if(!item){throw new Error("null item");}
options=options||{};options.imageType="thumb";var itemId=item.ImageTags&&item.ImageTags.Thumb?item.Id:item.ParentThumbItemId;return itemId?self.getImageUrl(itemId,options):null;};self.authenticateUserByName=function(name,password){if(!name){throw new Error("null name");}
var url=self.getUrl("Users/authenticatebyname");var postData={password:CryptoJS.SHA1(password||"").toString(),Username:name};return self.ajax({type:"POST",url:url,data:JSON.stringify(postData),dataType:"json",contentType:"application/json"}).done(function(result){Events.trigger(self,'authenticated',[result]);});};self.updateUserPassword=function(userId,currentPassword,newPassword){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Password");return self.ajax({type:"POST",url:url,data:{currentPassword:CryptoJS.SHA1(currentPassword).toString(),newPassword:CryptoJS.SHA1(newPassword).toString()}});};self.updateEasyPassword=function(userId,newPassword){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/EasyPassword");return self.ajax({type:"POST",url:url,data:{newPassword:CryptoJS.SHA1(newPassword).toString()}});};self.resetUserPassword=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/Password");var postData={};postData.resetPassword=true;return self.ajax({type:"POST",url:url,data:postData});};self.resetEasyPassword=function(userId){if(!userId){throw new Error("null userId");}
var url=self.getUrl("Users/"+userId+"/EasyPassword");var postData={};postData.resetPassword=true;return self.ajax({type:"POST",url:url,data:postData});};self.updateServerConfiguration=function(configuration){if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("System/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateNamedConfiguration=function(name,configuration){if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("System/Configuration/"+name);return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateItem=function(item){if(!item){throw new Error("null item");}
var url=self.getUrl("Items/"+item.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(item),contentType:"application/json"});};self.updatePluginSecurityInfo=function(info){var url=self.getUrl("Plugins/SecurityInfo");return self.ajax({type:"POST",url:url,data:JSON.stringify(info),contentType:"application/json"});};self.createUser=function(name){var url=self.getUrl("Users/New");return self.ajax({type:"POST",url:url,data:{Name:name},dataType:"json"});};self.updateUser=function(user){if(!user){throw new Error("null user");}
var url=self.getUrl("Users/"+user.Id);return self.ajax({type:"POST",url:url,data:JSON.stringify(user),contentType:"application/json"});};self.updateUserPolicy=function(userId,policy){if(!userId){throw new Error("null userId");}
if(!policy){throw new Error("null policy");}
var url=self.getUrl("Users/"+userId+"/Policy");return self.ajax({type:"POST",url:url,data:JSON.stringify(policy),contentType:"application/json"});};self.updateUserConfiguration=function(userId,configuration){if(!userId){throw new Error("null userId");}
if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("Users/"+userId+"/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.updateScheduledTaskTriggers=function(id,triggers){if(!id){throw new Error("null id");}
if(!triggers){throw new Error("null triggers");}
var url=self.getUrl("ScheduledTasks/"+id+"/Triggers");return self.ajax({type:"POST",url:url,data:JSON.stringify(triggers),contentType:"application/json"});};self.updatePluginConfiguration=function(id,configuration){if(!id){throw new Error("null Id");}
if(!configuration){throw new Error("null configuration");}
var url=self.getUrl("Plugins/"+id+"/Configuration");return self.ajax({type:"POST",url:url,data:JSON.stringify(configuration),contentType:"application/json"});};self.getAncestorItems=function(itemId,userId){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Items/"+itemId+"/Ancestors",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getItems=function(userId,options){var url;if((typeof userId).toString().toLowerCase()=='string'){url=self.getUrl("Users/"+userId+"/Items",options);}else{url=self.getUrl("Items",options);}
return self.ajax({type:"GET",url:url,dataType:"json"});};self.getUserViews=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};var url=self.getUrl("Users/"+userId+"/Views",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getArtists=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Artists",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAlbumArtists=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Artists/AlbumArtists",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Genres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getMusicGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("MusicGenres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getGameGenres=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("GameGenres",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getPeople=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Persons",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getStudios=function(userId,options){if(!userId){throw new Error("null userId");}
options=options||{};options.userId=userId;var url=self.getUrl("Studios",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getLocalTrailers=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/LocalTrailers");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getAdditionalVideoParts=function(userId,itemId){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Videos/"+itemId+"/AdditionalParts",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getThemeMedia=function(userId,itemId,inherit){if(!itemId){throw new Error("null itemId");}
var options={};if(userId){options.userId=userId;}
options.InheritFromParent=inherit||false;var url=self.getUrl("Items/"+itemId+"/ThemeMedia",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSearchHints=function(options){var url=self.getUrl("Search/Hints",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.getSpecialFeatures=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/SpecialFeatures");return self.ajax({type:"GET",url:url,dataType:"json"});};self.getDateParamValue=function(date){function formatDigit(i){return i<10?"0"+i:i;}
var d=date;return""+d.getFullYear()+formatDigit(d.getMonth()+1)+formatDigit(d.getDate())+formatDigit(d.getHours())+formatDigit(d.getMinutes())+formatDigit(d.getSeconds());};self.markPlayed=function(userId,itemId,date){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var options={};if(date){options.DatePlayed=self.getDateParamValue(date);}
var url=self.getUrl("Users/"+userId+"/PlayedItems/"+itemId,options);return self.ajax({type:"POST",url:url,dataType:"json"});};self.markUnplayed=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/PlayedItems/"+itemId);return self.ajax({type:"DELETE",url:url,dataType:"json"});};self.updateFavoriteStatus=function(userId,itemId,isFavorite){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/FavoriteItems/"+itemId);var method=isFavorite?"POST":"DELETE";return self.ajax({type:method,url:url,dataType:"json"});};self.updateUserItemRating=function(userId,itemId,likes){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/Rating",{likes:likes});return self.ajax({type:"POST",url:url,dataType:"json"});};self.getItemCounts=function(userId){var options={};if(userId){options.userId=userId;}
var url=self.getUrl("Items/Counts",options);return self.ajax({type:"GET",url:url,dataType:"json"});};self.clearUserItemRating=function(userId,itemId){if(!userId){throw new Error("null userId");}
if(!itemId){throw new Error("null itemId");}
var url=self.getUrl("Users/"+userId+"/Items/"+itemId+"/Rating");return self.ajax({type:"DELETE",url:url,dataType:"json"});};self.reportPlaybackStart=function(options){if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/Playing");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.reportPlaybackProgress=function(options){if(!options){throw new Error("null options");}
if(self.isWebSocketOpen()){var deferred=DeferredBuilder.Deferred();var msg=JSON.stringify(options);self.sendWebSocketMessage("ReportPlaybackProgress",msg);deferred.resolveWith(null,[]);return deferred.promise();}
var url=self.getUrl("Sessions/Playing/Progress");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.reportPlaybackStopped=function(options){if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/Playing/Stopped");return self.ajax({type:"POST",data:JSON.stringify(options),contentType:"application/json",url:url});};self.sendPlayCommand=function(sessionId,options){if(!sessionId){throw new Error("null sessionId");}
if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/"+sessionId+"/Playing",options);return self.ajax({type:"POST",url:url});};self.sendCommand=function(sessionId,command){if(!sessionId){throw new Error("null sessionId");}
if(!command){throw new Error("null command");}
var url=self.getUrl("Sessions/"+sessionId+"/Command");var ajaxOptions={type:"POST",url:url};ajaxOptions.data=JSON.stringify(command);ajaxOptions.contentType="application/json";return self.ajax(ajaxOptions);};self.sendMessageCommand=function(sessionId,options){if(!sessionId){throw new Error("null sessionId");}
if(!options){throw new Error("null options");}
var url=self.getUrl("Sessions/"+sessionId+"/Message",options);return self.ajax({type:"POST",url:url});};self.sendPlayStateCommand=function(sessionId,command,options){if(!sessionId){throw new Error("null sessionId");}
if(!command){throw new Error("null command");}
var url=self.getUrl("Sessions/"+sessionId+"/Playing/"+command,options||{});return self.ajax({type:"POST",url:url});};self.createPackageReview=function(review){var url=self.getUrl("Packages/Reviews/"+review.id,review);return self.ajax({type:"POST",url:url,});};self.getPackageReviews=function(packageId,minRating,maxRating,limit){if(!packageId){throw new Error("null packageId");}
var options={};if(minRating){options.MinRating=minRating;}
if(maxRating){options.MaxRating=maxRating;}
if(limit){options.Limit=limit;}
var url=self.getUrl("Packages/"+packageId+"/Reviews",options);return self.ajax({type:"GET",url:url,dataType:"json"});};};})(window,window.JSON,window.WebSocket,window.setTimeout,window.devicePixelRatio,window.FileReader);(function(globalScope){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
function replaceAll(str,find,replace){return str.split(find).join(replace);}
var connectService={cleanPassword:function(password){password=password||'';password=replaceAll(password,"&","&amp;");password=replaceAll(password,"/","&#092;");password=replaceAll(password,"!","&#33;");password=replaceAll(password,"$","&#036;");password=replaceAll(password,"\"","&quot;");password=replaceAll(password,"<","&lt;");password=replaceAll(password,">","&gt;");password=replaceAll(password,"'","&#39;");return password;}};globalScope.MediaBrowser.ConnectService=connectService;})(window);(function(globalScope){globalScope.ServerDiscovery={findServers:function(timeoutMs){var deferred=DeferredBuilder.Deferred();var servers=[];deferred.resolveWith(null,[servers]);return deferred.promise();}};})(window);(function(globalScope){if(!globalScope.MediaBrowser){globalScope.MediaBrowser={};}
globalScope.MediaBrowser.ConnectionState={Unavailable:0,ServerSelection:1,ServerSignIn:2,SignedIn:3,ConnectSignIn:4};globalScope.MediaBrowser.ConnectionMode={Local:0,Remote:1,Manual:2};globalScope.MediaBrowser.ConnectionManager=function(logger,credentialProvider,appName,appVersion,deviceName,deviceId,capabilities){logger.log('Begin MediaBrowser.ConnectionManager constructor');var self=this;var apiClients=[];function mergeServers(list1,list2){for(var i=0,length=list2.length;i<length;i++){credentialProvider.addOrUpdateServer(list1,list2[i]);}
return list1;}
function resolveWithFailure(deferred){deferred.resolveWith(null,[{State:MediaBrowser.ConnectionState.Unavailable,ConnectUser:self.connectUser()}]);}
function updateServerInfo(server,systemInfo){server.Name=systemInfo.ServerName;server.Id=systemInfo.Id;if(systemInfo.LocalAddress){server.LocalAddress=systemInfo.LocalAddress;}
if(systemInfo.WanAddress){server.RemoteAddress=systemInfo.WanAddress;}
if(systemInfo.MacAddress){server.WakeOnLanInfos=[{MacAddress:systemInfo.MacAddress}];}}
function tryConnect(url,timeout){url+="/system/info/public";logger.log('tryConnect url: '+url);return AjaxApi.ajax({type:"GET",url:url,dataType:"json",timeout:timeout||15000});}
var connectUser;self.connectUser=function(){return connectUser;};self.appVersion=function(){return appVersion;};self.deviceId=function(){return deviceId;};self.currentApiClient=function(){return apiClients[0];};self.connectUserId=function(){return credentialProvider.credentials().ConnectUserId;};self.connectToken=function(){return credentialProvider.credentials().ConnectAccessToken;};self.addApiClient=function(apiClient,enableAutomaticNetworking){apiClients.push(apiClient);return apiClient.getPublicSystemInfo().done(function(systemInfo){var server=credentialProvider.credentials().servers.filter(function(s){return s.Id==systemInfo.Id;})[0]||{};updateServerInfo(server,systemInfo);apiClient.serverInfo(server);Events.trigger(self,'apiclientcreated',[apiClient]);if(enableAutomaticNetworking){self.connectToServer(server);}});};function onConnectUserSignIn(user){connectUser=user;Events.trigger(self,'connectusersignedin',[user]);}
function getOrAddApiClient(server,connectionMode){var apiClient=self.getApiClient(server.Id);if(!apiClient){var url=self.getServerAddress(server,connectionMode);apiClient=new MediaBrowser.ApiClient(logger,url,appName,appVersion,deviceName,deviceId);apiClients.push(apiClient);apiClient.serverInfo(server);Events.on(apiClient,'authenticated',function(e,result){onAuthenticated(this,result,{},true);});Events.trigger(self,'apiclientcreated',[apiClient]);}
if(server.AccessToken){apiClient.setAuthenticationInfo(server.AccessToken,server.UserId);}
else{apiClient.clearAuthenticationInfo();}
logger.log('returning instance from getOrAddApiClient');return apiClient;}
self.getOrCreateApiClient=function(serverId){var apiClient=self.getApiClient(serverId);if(apiClient){return apiClient;}
var credentials=credentialProvider.credentials();var server=credentials.servers.filter(function(s){return stringEqualsIgnoreCase(s.Id,serverId);})[0];return getOrAddApiClient(server,server.LastConnectionMode);};function onAuthenticated(apiClient,result,options,saveCredentials){var server=apiClient.serverInfo();var credentials=credentialProvider.credentials();server.DateLastAccessed=new Date().getTime();if(saveCredentials){server.UserId=result.User.Id;server.AccessToken=result.AccessToken;}else{server.UserId=null;server.AccessToken=null;}
credentialProvider.addOrUpdateServer(credentials.servers,server);saveUserInfoIntoCredentials(server,result.User);credentialProvider.credentials(credentials);afterConnected(apiClient,options);onLocalUserSignIn(result.User);}
function saveUserInfoIntoCredentials(server,user){}
function afterConnected(apiClient,options){options=options||{};if(options.reportCapabilities!==false){apiClient.reportCapabilities(capabilities);}
if(options.enableWebSocket!==false){if(!apiClient.isWebSocketOpenOrConnecting&&apiClient.isWebSocketSupported()){logger.log('calling apiClient.openWebSocket');apiClient.openWebSocket();}}}
function onLocalUserSignIn(user){Events.trigger(self,'localusersignedin',[user]);}
function ensureConnectUser(credentials){var deferred=DeferredBuilder.Deferred();if(connectUser&&connectUser.Id==credentials.ConnectUserId){deferred.resolveWith(null,[[]]);}
else if(credentials.ConnectUserId&&credentials.ConnectAccessToken){connectUser=null;getConnectUser(credentials.ConnectUserId,credentials.ConnectAccessToken).done(function(user){onConnectUserSignIn(user);deferred.resolveWith(null,[[]]);}).fail(function(){deferred.resolveWith(null,[[]]);});}else{deferred.resolveWith(null,[[]]);}
return deferred.promise();}
function getConnectUser(userId,accessToken){if(!userId){throw new Error("null userId");}
if(!accessToken){throw new Error("null accessToken");}
var url="https://connect.mediabrowser.tv/service/user?id="+userId;return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Application":appName+"/"+appVersion,"X-Connect-UserToken":accessToken}});}
function addAuthenticationInfoFromConnect(server,connectionMode,credentials){if(!server.ExchangeToken){throw new Error("server.ExchangeToken cannot be null");}
if(!credentials.ConnectUserId){throw new Error("credentials.ConnectUserId cannot be null");}
var url=self.getServerAddress(server,connectionMode);url+="/Connect/Exchange?format=json&ConnectUserId="+credentials.ConnectUserId;return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-MediaBrowser-Token":server.ExchangeToken}}).done(function(auth){server.UserId=auth.LocalUserId;server.AccessToken=auth.AccessToken;}).fail(function(){server.UserId=null;server.AccessToken=null;});}
function validateAuthentication(server,connectionMode){var deferred=DeferredBuilder.Deferred();var url=self.getServerAddress(server,connectionMode);AjaxApi.ajax({type:"GET",url:url+"/system/info",dataType:"json",headers:{"X-MediaBrowser-Token":server.AccessToken}}).done(function(systemInfo){updateServerInfo(server,systemInfo);if(server.UserId){AjaxApi.ajax({type:"GET",url:url+"/users/"+server.UserId,dataType:"json",headers:{"X-MediaBrowser-Token":server.AccessToken}}).done(function(user){onLocalUserSignIn(user);deferred.resolveWith(null,[[]]);}).fail(function(){server.UserId=null;server.AccessToken=null;deferred.resolveWith(null,[[]]);});}}).fail(function(){server.UserId=null;server.AccessToken=null;deferred.resolveWith(null,[[]]);});return deferred.promise();}
function getImageUrl(localUser){if(connectUser&&connectUser.ImageUrl){return{url:connectUser.ImageUrl};}
if(localUser&&localUser.PrimaryImageTag){var apiClient=self.getApiClient(localUser);var url=apiClient.getUserImageUrl(localUser.Id,{tag:localUser.PrimaryImageTag,type:"Primary"});return{url:url,supportsParams:true};}
return{url:null,supportsParams:false};}
self.user=function(){var deferred=DeferredBuilder.Deferred();var localUser;function onLocalUserDone(){var image=getImageUrl(localUser);deferred.resolveWith(null,[{localUser:localUser,name:connectUser?connectUser.Name:(localUser?localUser.Name:null),canManageServer:localUser&&localUser.Policy.IsAdministrator,imageUrl:image.url,supportsImageParams:image.supportsParams}]);}
function onEnsureConnectUserDone(){var apiClient=self.currentApiClient();if(apiClient&&apiClient.getCurrentUserId()){apiClient.getCurrentUser().done(function(u){localUser=u;}).always(onLocalUserDone);}else{onLocalUserDone();}}
var credentials=credentialProvider.credentials();if(credentials.ConnectUserId&&credentials.ConnectAccessToken&&!(self.currentApiClient()&&self.currentApiClient().getCurrentUserId())){ensureConnectUser(credentials).always(onEnsureConnectUserDone);}else{onEnsureConnectUserDone();}
return deferred.promise();};self.isLoggedIntoConnect=function(){if(!self.connectToken()||!self.connectUserId()){return false;}
return true;};self.logout=function(){var promises=[];for(var i=0,length=apiClients.length;i<length;i++){var apiClient=apiClients[i];if(apiClient.accessToken()){promises.push(logoutOfServer(apiClient));}}
return DeferredBuilder.when(promises).done(function(){var credentials=credentialProvider.credentials();var servers=credentials.servers.filter(function(u){return u.UserLinkType!="Guest";});for(var j=0,numServers=servers.length;j<numServers;j++){var server=servers[j];server.UserId=null;server.AccessToken=null;server.ExchangeToken=null;var serverUsers=server.Users||[];for(var k=0,numUsers=serverUsers.length;k<numUsers;k++){serverUsers[k].IsSignedInOffline=false;}}
credentials.servers=servers;credentials.ConnectAccessToken=null;credentials.ConnectUserId=null;credentialProvider.credentials(credentials);if(connectUser){connectUser=null;Events.trigger(self,'connectusersignedout');}});};function logoutOfServer(apiClient){var serverInfo=apiClient.serverInfo()||{};var logoutInfo={serverId:serverInfo.Id};return apiClient.logout().always(function(){Events.trigger(self,'localusersignedout',[logoutInfo]);});}
function getConnectServers(credentials){logger.log('Begin getConnectServers');var deferred=DeferredBuilder.Deferred();if(!credentials.ConnectAccessToken||!credentials.ConnectUserId){deferred.resolveWith(null,[[]]);return deferred.promise();}
var url="https://connect.mediabrowser.tv/service/servers?userId="+credentials.ConnectUserId;AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Application":appName+"/"+appVersion,"X-Connect-UserToken":credentials.ConnectAccessToken}}).done(function(servers){servers=servers.map(function(i){return{ExchangeToken:i.AccessKey,ConnectServerId:i.Id,Id:i.SystemId,Name:i.Name,RemoteAddress:i.Url,LocalAddress:i.LocalAddress,UserLinkType:(i.UserType||'').toLowerCase()=="guest"?"Guest":"LinkedUser"};});deferred.resolveWith(null,[servers]);}).fail(function(){deferred.resolveWith(null,[[]]);});return deferred.promise();}
self.getAvailableServers=function(){logger.log('Begin getAvailableServers');var credentials=credentialProvider.credentials();var deferred=DeferredBuilder.Deferred();var connectServersPromise=getConnectServers(credentials);var findServersPromise=findServers();connectServersPromise.done(function(connectServers){findServersPromise.done(function(foundServers){var servers=credentials.servers.slice(0);mergeServers(servers,foundServers);mergeServers(servers,connectServers);servers=filterServers(servers,connectServers);servers.sort(function(a,b){return b.DateLastAccessed-a.DateLastAccessed;});credentials.servers=servers;credentialProvider.credentials(credentials);deferred.resolveWith(null,[servers]);});});return deferred.promise();};function filterServers(servers,connectServers){return servers.filter(function(server){if(!server.ExchangeToken){return true;}
return connectServers.filter(function(connectServer){return server.Id==connectServer.Id;}).length>0;});}
function findServers(){var deferred=DeferredBuilder.Deferred();ServerDiscovery.findServers(2000).done(function(foundServers){var servers=foundServers.map(function(foundServer){return{Id:foundServer.Id,LocalAddress:foundServer.Address,Name:foundServer.Name,ManualAddress:convertEndpointAddressToManualAddress(foundServer)};});deferred.resolveWith(null,[servers]);});return deferred.promise();}
function convertEndpointAddressToManualAddress(info){if(info.Address&&info.EndpointAddress){var address=info.EndpointAddress.split(":")[0];var parts=info.Address.split(":");if(parts.length>1){var portString=parts[parts.length-1];if(!isNaN(parseInt(portString))){address+=":"+portString;}}
return normalizeAddress(address);}
return null;}
self.connect=function(){logger.log('Begin connect');var deferred=DeferredBuilder.Deferred();var isResolved=false;if(capabilities.SupportsOfflineAccess){if(!NetworkStatus.isNetworkAvailable()){deferred.resolveWith(null,[self.getOffineResult()]);isResolved=true;}}
if(!isResolved){self.getAvailableServers().done(function(servers){self.connectToServers(servers).done(function(result){deferred.resolveWith(null,[result]);});});}
return deferred.promise();};self.getOffineResult=function(){};self.connectToServers=function(servers){logger.log('Begin connectToServers, with '+servers.length+' servers');var deferred=DeferredBuilder.Deferred();if(servers.length==1){self.connectToServer(servers[0]).done(function(result){if(result.State==MediaBrowser.ConnectionState.Unavailable){result.State=result.ConnectUser==null?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection;}
logger.log('resolving connectToServers with result.State: '+result.State);deferred.resolveWith(null,[result]);});}else{var firstServer=servers[0];if(firstServer){self.connectToServer(firstServer).done(function(result){if(result.State==MediaBrowser.ConnectionState.SignedIn){deferred.resolveWith(null,[result]);}else{deferred.resolveWith(null,[{Servers:servers,State:(!servers.length&&!self.connectUser())?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection,ConnectUser:self.connectUser()}]);}});}else{deferred.resolveWith(null,[{Servers:servers,State:(!servers.length&&!self.connectUser())?MediaBrowser.ConnectionState.ConnectSignIn:MediaBrowser.ConnectionState.ServerSelection,ConnectUser:self.connectUser()}]);}}
return deferred.promise();};function beginWakeServer(server){}
self.connectToServer=function(server,options){var deferred=DeferredBuilder.Deferred();var tests=[];if(server.LastConnectionMode!=null){tests.push(server.LastConnectionMode);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Manual)==-1){tests.push(MediaBrowser.ConnectionMode.Manual);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Local)==-1){tests.push(MediaBrowser.ConnectionMode.Local);}
if(tests.indexOf(MediaBrowser.ConnectionMode.Remote)==-1){tests.push(MediaBrowser.ConnectionMode.Remote);}
var isLocalNetworkAvailable=NetworkStatus.isAnyLocalNetworkAvailable();var sendWakeOnLan=server.WakeOnLanInfos&&server.WakeOnLanInfos.length&&isLocalNetworkAvailable;if(sendWakeOnLan){beginWakeServer(server);}
var wakeOnLanSendTime=new Date().getTime();testNextConnectionMode(tests,0,isLocalNetworkAvailable,server,wakeOnLanSendTime,options,deferred);return deferred.promise();};function stringEqualsIgnoreCase(str1,str2){return(str1||'').toLowerCase()==(str2||'').toLowerCase();}
function testNextConnectionMode(tests,index,isLocalNetworkAvailable,server,wakeOnLanSendTime,options,deferred){if(index>=tests.length){logger.log('Tested all connection modes. Failing server connection.');resolveWithFailure(deferred);return;}
var mode=tests[index];var address=self.getServerAddress(server,mode);var enableRetry=false;var skipTest=false;var timeout=15000;if(mode==MediaBrowser.ConnectionMode.Local){if(!isLocalNetworkAvailable){skipTest=true;}
enableRetry=true;timeout=5000;}
else if(mode==MediaBrowser.ConnectionMode.Manual){if(stringEqualsIgnoreCase(address,server.LocalAddress)||stringEqualsIgnoreCase(address,server.RemoteAddress)){skipTest=true;}}
if(skipTest||!address){testNextConnectionMode(tests,index+1,isLocalNetworkAvailable,server,wakeOnLanSendTime,options,deferred);return;}
logger.log('testing connection mode '+mode+' with server '+server.Name);tryConnect(address,timeout).done(function(result){logger.log('calling onSuccessfulConnection with connection mode '+mode+' with server '+server.Name);onSuccessfulConnection(server,result,mode,options,deferred);}).fail(function(){logger.log('test failed for connection mode '+mode+' with server '+server.Name);if(enableRetry){var sleepTime=10000-(new Date().getTime()-wakeOnLanSendTime);testNextConnectionMode(tests,index+1,isLocalNetworkAvailable,server,wakeOnLanSendTime,options,deferred);}else{testNextConnectionMode(tests,index+1,isLocalNetworkAvailable,server,wakeOnLanSendTime,options,deferred);}});}
function onSuccessfulConnection(server,systemInfo,connectionMode,options,deferred){var credentials=credentialProvider.credentials();if(credentials.ConnectAccessToken){ensureConnectUser(credentials).done(function(){if(server.ExchangeToken){addAuthenticationInfoFromConnect(server,connectionMode,credentials).always(function(){afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);});}else{afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);}});}
else{afterConnectValidated(server,credentials,systemInfo,connectionMode,true,options,deferred);}}
function afterConnectValidated(server,credentials,systemInfo,connectionMode,verifyLocalAuthentication,options,deferred){if(verifyLocalAuthentication&&server.AccessToken){validateAuthentication(server,connectionMode).done(function(){afterConnectValidated(server,credentials,systemInfo,connectionMode,false,options,deferred);});return;}
updateServerInfo(server,systemInfo);server.DateLastAccessed=new Date().getTime();server.LastConnectionMode=connectionMode;credentialProvider.addOrUpdateServer(credentials.servers,server);credentialProvider.credentials(credentials);var result={Servers:[]};result.ApiClient=getOrAddApiClient(server,connectionMode);result.State=server.AccessToken?MediaBrowser.ConnectionState.SignedIn:MediaBrowser.ConnectionState.ServerSignIn;result.Servers.push(server);result.ApiClient.enableAutomaticNetworking(server,connectionMode);if(result.State==MediaBrowser.ConnectionState.SignedIn){afterConnected(result.ApiClient,options);}
deferred.resolveWith(null,[result]);Events.trigger(self,'connected',[result]);}
self.getServerAddress=function(server,mode){switch(mode){case MediaBrowser.ConnectionMode.Local:return server.LocalAddress;case MediaBrowser.ConnectionMode.Manual:return server.ManualAddress;case MediaBrowser.ConnectionMode.Remote:return server.RemoteAddress;default:throw new Error("Unexpected ConnectionMode");}};function normalizeAddress(address){if(address.toLowerCase().indexOf('http')!=0){address="http://"+address;}
return address;}
self.connectToAddress=function(address){address=normalizeAddress(address);var deferred=DeferredBuilder.Deferred();tryConnect(address,15000).done(function(publicInfo){logger.log('connectToAddress '+address+' succeeded');var server={ManualAddress:address,LastConnectionMode:MediaBrowser.ConnectionMode.Manual};updateServerInfo(server,publicInfo);self.connectToServer(server).done(function(result){deferred.resolveWith(null,[result]);});}).fail(function(){logger.log('connectToAddress '+address+' failed');resolveWithFailure(deferred);});return deferred.promise();};self.loginToConnect=function(username,password){if(!username){throw new Error("null username");}
if(!password){throw new Error("null password");}
var md5=self.getConnectPasswordHash(password);return AjaxApi.ajax({type:"POST",url:"https://connect.mediabrowser.tv/service/user/authenticate",data:{nameOrEmail:username,password:md5},dataType:"json",contentType:'application/x-www-form-urlencoded; charset=UTF-8',headers:{"X-Application":appName+"/"+appVersion}}).done(function(result){var credentials=credentialProvider.credentials();credentials.ConnectAccessToken=result.AccessToken;credentials.ConnectUserId=result.User.Id;credentialProvider.credentials(credentials);onConnectUserSignIn(result.User);});};self.getConnectPasswordHash=function(password){password=globalScope.MediaBrowser.ConnectService.cleanPassword(password);return CryptoJS.MD5(password).toString();};self.getApiClient=function(item){if(item.ServerId){item=item.ServerId;}
return apiClients.filter(function(a){var serverInfo=a.serverInfo();return!serverInfo||serverInfo.Id==item;})[0];};self.getUserInvitations=function(){var connectToken=self.connectToken();if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/servers?userId="+self.connectUserId()+"&status=Waiting";return AjaxApi.ajax({type:"GET",url:url,dataType:"json",headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};self.deleteServer=function(serverId){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/serverAuthorizations?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"DELETE",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}}).done(function(){var credentials=credentialProvider.credentials();credentials.servers=credentials.servers.filter(function(s){return s.ConnectServerId!=serverId;});credentialProvider.credentials(credentials);});};self.rejectServer=function(serverId){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/serverAuthorizations?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"DELETE",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};self.acceptServer=function(serverId){var connectToken=self.connectToken();if(!serverId){throw new Error("null serverId");}
if(!connectToken){throw new Error("null connectToken");}
if(!self.connectUserId()){throw new Error("null connectUserId");}
var url="https://connect.mediabrowser.tv/service/ServerAuthorizations/accept?serverId="+serverId+"&userId="+self.connectUserId();return AjaxApi.ajax({type:"GET",url:url,headers:{"X-Connect-UserToken":connectToken,"X-Application":appName+"/"+appVersion}});};return self;};})(window,window.Logger);var SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^\#-~| |!])/g;var hiddenPre=document.createElement("pre");function htmlDecode(value){if(!value){return'';}
hiddenPre.innerHTML=value.replace(/</g,"&lt;");return hiddenPre.textContent;}
function htmlEncode(value){return value.replace(/&/g,'&amp;').replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return'&#'+(((hi-0xD800)*0x400)+(low-0xDC00)+0x10000)+';';}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return'&#'+value.charCodeAt(0)+';';}).replace(/</g,'&lt;').replace(/>/g,'&gt;');}
Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest);};String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1;};$.fn.checked=function(value){if(value===true||value===false){return $(this).each(function(){this.checked=value;});}else{return $(this).is(':checked');}};$.fn.buttonEnabled=function(enabled){return enabled?this.attr('disabled','').removeAttr('disabled'):this.attr('disabled','disabled');};$.fn.dateTimeVal=function(val){if(val!=null){var now=val;var year=now.getFullYear();var month=now.getMonth().toString().length===1?'0'+(now.getMonth()+1).toString():now.getMonth()+1;var date=now.getDate().toString().length===1?'0'+(now.getDate()).toString():now.getDate();var hours=now.getHours().toString().length===1?'0'+now.getHours().toString():now.getHours();var minutes=now.getMinutes().toString().length===1?'0'+now.getMinutes().toString():now.getMinutes();var seconds=now.getSeconds().toString().length===1?'0'+now.getSeconds().toString():now.getSeconds();var formattedDateTime=year+'-'+month+'-'+date+'T'+hours+':'+minutes+':'+seconds;return this.val(formattedDateTime);}
return this.val();};if(!Array.prototype.filter){Array.prototype.filter=function(fun){"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!="function")
throw new TypeError();var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisp,val,i,t))
res.push(val);}}
return res;};}
var WebNotifications={show:function(data){if(window.Notification){var level=Notification.permissionLevel?Notification.permissionLevel():Notification.permission;if(level==="granted"){var notif=new Notification(data.title,data);if(notif.show){notif.show();}
if(data.timeout){setTimeout(function(){if(notif.close){notif.close();}
else if(notif.cancel){notif.cancel();}},data.timeout);}
return notif;}else if(level==="default"){Notification.requestPermission(function(){return WebNotifications.show(data);});}}
else if(window.webkitNotifications){if(!webkitNotifications.checkPermission()){var notif=webkitNotifications.createNotification(data.icon,data.title,data.body);notif.show();if(data.timeout){setTimeout(function(){if(notif.close){notif.close();}
else if(notif.cancel){notif.cancel();}},data.timeout);}
return notif;}else{webkitNotifications.requestPermission(function(){return WebNotifications.show(data);});}}},requestPermission:function(){if(window.webkitNotifications){if(!webkitNotifications.checkPermission()){}else{webkitNotifications.requestPermission(function(){});}}
else if(window.Notification){var level=Notification.permissionLevel?Notification.permissionLevel():Notification.permission;if(level==="default"){Notification.requestPermission(function(){});}}},supported:function(){return window.Notification||window.webkitNotifications;}};function humane_date(date_str){var time_formats=[[90,'a minute'],[3600,'minutes',60],[5400,'an hour'],[86400,'hours',3600],[129600,'a day'],[604800,'days',86400],[907200,'a week'],[2628000,'weeks',604800],[3942000,'a month'],[31536000,'months',2628000],[47304000,'a year'],[3153600000,'years',31536000]];var dt=new Date;var date=parseISO8601Date(date_str,{toLocal:true});var seconds=((dt-date)/1000);var token=' ago';var i=0;var format;if(seconds<0){seconds=Math.abs(seconds);token='';}
while(format=time_formats[i++]){if(seconds<format[0]){if(format.length==2){return format[1]+token;}else{return Math.round(seconds/format[2])+' '+format[1]+token;}}}
if(seconds>4730400000)
return Math.round(seconds/4730400000)+' centuries'+token;return date_str;};function humane_elapsed(firstDateStr,secondDateStr){var dt1=new Date(firstDateStr);var dt2=new Date(secondDateStr);var seconds=(dt2.getTime()-dt1.getTime())/1000;var numdays=Math.floor((seconds%31536000)/86400);var numhours=Math.floor(((seconds%31536000)%86400)/3600);var numminutes=Math.floor((((seconds%31536000)%86400)%3600)/60);var numseconds=Math.round((((seconds%31536000)%86400)%3600)%60);var elapsedStr='';elapsedStr+=numdays==1?numdays+' day ':'';elapsedStr+=numdays>1?numdays+' days ':'';elapsedStr+=numhours==1?numhours+' hour ':'';elapsedStr+=numhours>1?numhours+' hours ':'';elapsedStr+=numminutes==1?numminutes+' minute ':'';elapsedStr+=numminutes>1?numminutes+' minutes ':'';elapsedStr+=elapsedStr.length>0?'and ':'';elapsedStr+=numseconds==1?numseconds+' second':'';elapsedStr+=numseconds==0||numseconds>1?numseconds+' seconds':'';return elapsedStr;}
function getWindowUrl(win){return(win||window).location.href;}
function getWindowLocationSearch(win){var search=(win||window).location.search;if(!search){var index=window.location.href.indexOf('?');if(index!=-1){search=window.location.href.substring(index);}}
return search||'';}
function getParameterByName(name,url){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS,"i");var results=regex.exec(url||getWindowLocationSearch());if(results==null)
return"";else
return decodeURIComponent(results[1].replace(/\+/g," "));}
function replaceQueryString(url,param,value){var re=new RegExp("([?|&])"+param+"=.*?(&|$)","i");if(url.match(re))
return url.replace(re,'$1'+param+"="+value+'$2');else{if(url.indexOf('?')==-1){return url+'?'+param+"="+value;}
return url+'&'+param+"="+value;}}
function parseISO8601Date(s,options){options=options||{};var re=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?(Z|([+-])(\d{2}):(\d{2}))?/;var d=s.match(re);if(!d){throw"Couldn't parse ISO 8601 date string '"+s+"'";}
var a=[1,2,3,4,5,6,10,11];for(var i in a){d[a[i]]=parseInt(d[a[i]],10);}
d[7]=parseFloat(d[7]);var ms=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]);if(d[7]>0){ms+=Math.round(d[7]*1000);}
if(d[8]!="Z"&&d[10]){var offset=d[10]*60*60*1000;if(d[11]){offset+=d[11]*60*1000;}
if(d[9]=="-"){ms-=offset;}else{ms+=offset;}}else if(!options.toLocal){ms+=new Date().getTimezoneOffset()*60000;}
return new Date(ms);}
(function($,window,undefined){function queryStringToObject(qstr){var result={},nvPairs=((qstr||"").replace(/^\?/,"").split(/&/)),i,pair,n,v;for(i=0;i<nvPairs.length;i++){var pstr=nvPairs[i];if(pstr){pair=pstr.split(/=/);n=pair[0];v=pair[1];if(result[n]===undefined){result[n]=v;}else{if(typeof result[n]!=="object"){result[n]=[result[n]];}
result[n].push(v);}}}
return result;}
$(document).bind("pagebeforechange",function(e,data){if(typeof data.toPage==="string"){var u=$.mobile.path.parseUrl(data.toPage);if($.mobile.path.isEmbeddedPage(u)){var u2=$.mobile.path.parseUrl(u.hash.replace(/^#/,""));if(u2.search){if(!data.options.dataUrl){data.options.dataUrl=data.toPage;}
data.options.pageData=queryStringToObject(u2.search);data.toPage=u.hrefNoHash+"#"+u2.pathname;}}}});})(jQuery,window);function ticks_to_human(str){var in_seconds=(str/10000000);var hours=Math.floor(in_seconds/3600);var minutes=Math.floor((in_seconds-(hours*3600))/60);var seconds='0'+Math.round(in_seconds-(hours*3600)-(minutes*60));var time='';if(hours>0)time+=hours+":";if(minutes<10&&hours==0)time+=minutes;else time+=('0'+minutes).substr(-2);time+=":"+seconds.substr(-2);return time;};(function(window){window.Globalize={translate:function(key){var val=window.localizationGlossary[key]||key;for(var i=1;i<arguments.length;i++){val=val.replace('{'+(i-1)+'}',arguments[i]);}
return val;}};})(window);(function(){var supportTouch=$.support.touch,scrollEvent="touchmove scroll",touchStartEvent=supportTouch?"touchstart":"mousedown",touchStopEvent=supportTouch?"touchend":"mouseup",touchMoveEvent=supportTouch?"touchmove":"mousemove";$.event.special.swipeupdown={setup:function(){var thisObject=this;var $this=$(thisObject);$this.bind(touchStartEvent,function(event){var data=event.originalEvent.touches?event.originalEvent.touches[0]:event,start={time:(new Date).getTime(),coords:[data.pageX,data.pageY],origin:$(event.target)},stop;function moveHandler(event){if(!start){return;}
var data=event.originalEvent.touches?event.originalEvent.touches[0]:event;stop={time:(new Date).getTime(),coords:[data.pageX,data.pageY]};if(Math.abs(start.coords[1]-stop.coords[1])>10){event.preventDefault();}}
$this.bind(touchMoveEvent,moveHandler).one(touchStopEvent,function(event){$this.unbind(touchMoveEvent,moveHandler);if(start&&stop){if(stop.time-start.time<1000&&Math.abs(start.coords[1]-stop.coords[1])>30&&Math.abs(start.coords[0]-stop.coords[0])<75){start.origin.trigger("swipeupdown").trigger(start.coords[1]>stop.coords[1]?"swipeup":"swipedown");}}
start=stop=undefined;});});}};$.each({swipedown:"swipeupdown",swipeup:"swipeupdown"},function(event,sourceEvent){$.event.special[event]={setup:function(){$(this).bind(sourceEvent,$.noop);}};});})();(function(){$.ajaxSetup({crossDomain:true});if($.browser.msie){$.ajaxSetup({cache:false});}})();$.support.cors=true;$(document).one('click',WebNotifications.requestPermission);var Dashboard={jQueryMobileInit:function(){$.mobile.popup.prototype.options.transition="fade";$.mobile.defaultPageTransition="none";$.mobile.panel.prototype.options.classes.modalOpen="largePanelModalOpen ui-panel-dismiss-open";$.mobile.panel.prototype.options.classes.panel="largePanel ui-panel";},isRunningInCordova:function(){return window.appMode=='cordova';},onRequestFail:function(e,data){if(data.status==401){var url=data.url.toLowerCase();if(url.indexOf('/password')==-1&&url.indexOf('/authenticate')==-1&&!$($.mobile.activePage).is('.standalonePage')){if(data.errorCode=="ParentalControl"){Dashboard.alert({message:Globalize.translate('MessageLoggedOutParentalControl'),callback:function(){Dashboard.logout(false);}});}else{Dashboard.logout(false);}}
return;}
Dashboard.hideLoadingMsg();if(!Dashboard.suppressAjaxErrors){setTimeout(function(){var msg=data.errorCode||Dashboard.defaultErrorMessage;Dashboard.showError(msg);},500);}},onApiClientServerAddressChanged:function(){Dashboard.serverAddress(ApiClient.serverAddress());},getCurrentUser:function(){if(!Dashboard.getUserPromise){var userId=Dashboard.getCurrentUserId();Dashboard.getUserPromise=ConnectionManager.currentApiClient().getUser(userId).fail(Dashboard.logout);}
return Dashboard.getUserPromise;},validateCurrentUser:function(){Dashboard.getUserPromise=null;if(Dashboard.getCurrentUserId()){Dashboard.getCurrentUser();}},getAccessToken:function(){return store.getItem('token');},serverAddress:function(val){if(val!=null){console.log('Setting server address to: '+val);store.setItem('serverAddress',val);}
var address=store.getItem('serverAddress');if(!address&&!Dashboard.isConnectMode()){var urlLower=getWindowUrl().toLowerCase();var index=urlLower.indexOf('/web');if(index==-1){index=urlLower.indexOf('/dashboard');}
if(index!=-1){address=urlLower.substring(0,index);return address;}
var loc=window.location;address=loc.protocol+'//'+loc.hostname;if(loc.port){address+=':'+loc.port;}}
return address;},getCurrentUserId:function(){var autoLoginUserId=getParameterByName('u');var storedUserId=store.getItem("userId");if(autoLoginUserId&&autoLoginUserId!=storedUserId){var token=getParameterByName('t');Dashboard.setCurrentUser(autoLoginUserId,token);}
return autoLoginUserId||storedUserId;},setCurrentUser:function(userId,token){store.setItem("userId",userId);store.setItem("token",token);var apiClient=ConnectionManager.currentApiClient();if(apiClient){apiClient.setCurrentUserId(userId,token);}
Dashboard.getUserPromise=null;},isConnectMode:function(){if(Dashboard.isRunningInCordova()){return true;}
var url=getWindowUrl().toLowerCase();return url.indexOf('mediabrowser.tv')!=-1||url.indexOf('emby.media')!=-1;},logout:function(logoutWithServer){store.removeItem("userId");store.removeItem("token");store.removeItem("serverAddress");var loginPage=!Dashboard.isConnectMode()?'login.html':'connectlogin.html';if(logoutWithServer===false){window.location=loginPage;}else{ConnectionManager.logout().done(function(){window.location=loginPage;});}},importCss:function(url){if(document.createStyleSheet){document.createStyleSheet(url);}
else{$('<link rel="stylesheet" type="text/css" href="'+url+'" />').appendTo('head');}},showError:function(message){$.mobile.loading('show',{text:message,textonly:true,textVisible:true});setTimeout(function(){$.mobile.loading('hide');},3000);},updateSystemInfo:function(info){Dashboard.lastSystemInfo=info;Dashboard.ensureWebSocket();if(!Dashboard.initialServerVersion){Dashboard.initialServerVersion=info.Version;}
if(info.HasPendingRestart){Dashboard.hideDashboardVersionWarning();Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showServerRestartWarning(info);}});}else{Dashboard.hideServerRestartWarning();if(Dashboard.initialServerVersion!=info.Version){Dashboard.showDashboardRefreshNotification();}}
Dashboard.showInProgressInstallations(info.InProgressInstallations);},showInProgressInstallations:function(installations){installations=installations||[];for(var i=0,length=installations.length;i<length;i++){var installation=installations[i];var percent=installation.PercentComplete||0;if(percent<100){Dashboard.showPackageInstallNotification(installation,"progress");}}
if(installations.length){Dashboard.ensureInstallRefreshInterval();}else{Dashboard.stopInstallRefreshInterval();}},ensureInstallRefreshInterval:function(){if(!Dashboard.installRefreshInterval){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SystemInfoStart","0,500");}
Dashboard.installRefreshInterval=1;}},stopInstallRefreshInterval:function(){if(Dashboard.installRefreshInterval){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SystemInfoStop");}
Dashboard.installRefreshInterval=null;}},cancelInstallation:function(id){ApiClient.cancelPackageInstallation(id).always(Dashboard.refreshSystemInfoFromServer);},showServerRestartWarning:function(systemInfo){var html='<span style="margin-right: 1em;">'+Globalize.translate('MessagePleaseRestart')+'</span>';if(systemInfo.CanSelfRestart){html+='<button type="button" data-icon="refresh" onclick="$(this).buttonEnabled(false);Dashboard.restartServer();" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonRestart')+'</button>';}
Dashboard.showFooterNotification({id:"serverRestartWarning",html:html,forceShow:true,allowHide:false});},hideServerRestartWarning:function(){$('#serverRestartWarning').remove();},showDashboardRefreshNotification:function(){var html='<span style="margin-right: 1em;">'+Globalize.translate('MessagePleaseRefreshPage')+'</span>';html+='<button type="button" data-icon="refresh" onclick="$(this).buttonEnabled(false);Dashboard.reloadPage();" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonRefresh')+'</button>';Dashboard.showFooterNotification({id:"dashboardVersionWarning",html:html,forceShow:true,allowHide:false});},reloadPage:function(){var currentUrl=getWindowUrl().toLowerCase();if(currentUrl.indexOf('configurationpage')!=-1){window.location.href="dashboard.html";}else{window.location.href=getWindowUrl();}},hideDashboardVersionWarning:function(){$('#dashboardVersionWarning').remove();},showFooterNotification:function(options){var removeOnHide=!options.id;options.id=options.id||"notification"+new Date().getTime()+parseInt(Math.random());var footer=$("#footer").css("top","initial").show();var parentElem=$('#footerNotifications',footer);var elem=$('#'+options.id,parentElem);if(!elem.length){elem=$('<p id="'+options.id+'" class="footerNotification"></p>').appendTo(parentElem);}
var onclick=removeOnHide?"$(\"#"+options.id+"\").trigger(\"notification.remove\").remove();":"$(\"#"+options.id+"\").trigger(\"notification.hide\").hide();";if(options.allowHide!==false){options.html+="<span style='margin-left: 1em;'><button type='button' onclick='"+onclick+"' data-icon='delete' data-iconpos='notext' data-mini='true' data-inline='true' data-theme='b'>"+Globalize.translate('ButtonHide')+"</button></span>";}
if(options.forceShow){elem.slideDown(400);}
elem.html(options.html).trigger("create");if(options.timeout){setTimeout(function(){if(removeOnHide){elem.trigger("notification.remove").remove();}else{elem.trigger("notification.hide").hide();}},options.timeout);}
footer.on("notification.remove notification.hide",function(e){setTimeout(function(){if(!parentElem.html()){footer.slideUp();}},50);});},getConfigurationPageUrl:function(name){return"ConfigurationPage?name="+encodeURIComponent(name);},navigate:function(url,preserveQueryString){var queryString=getWindowLocationSearch();if(preserveQueryString&&queryString){url+=queryString;}
$.mobile.changePage(url);},showLoadingMsg:function(){$.mobile.loading("show");},hideLoadingMsg:function(){$.mobile.loading("hide");},processPluginConfigurationUpdateResult:function(){Dashboard.hideLoadingMsg();Dashboard.alert("Settings saved.");},defaultErrorMessage:Globalize.translate('DefaultErrorMessage'),processServerConfigurationUpdateResult:function(result){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('MessageSettingsSaved'));},alert:function(options){if(typeof options=="string"){var message=options;$.mobile.loading('show',{text:message,textonly:true,textVisible:true});setTimeout(function(){$.mobile.loading('hide');},3000);return;}
if(navigator.notification&&navigator.notification.alert){navigator.notification.alert(options.message,options.callback||function(){},options.title||Globalize.translate('HeaderAlert'));}else{Dashboard.confirmInternal(options.message,options.title||Globalize.translate('HeaderAlert'),false,options.callback);}},confirm:function(message,title,callback){if(navigator.notification&&navigator.notification.confirm){var buttonLabels=[Globalize.translate('ButtonOk'),Globalize.translate('ButtonCancel')];navigator.notification.confirm(options.message,function(index){options.callback(index==1);},options.title||Globalize.translate('HeaderAlert'),buttonLabels.join(','));}else{Dashboard.confirmInternal(message,title,true,callback);}},confirmInternal:function(message,title,showCancel,callback){$('.confirmFlyout').popup("close").remove();var html='<div data-role="popup" class="confirmFlyout" style="max-width:500px;" data-theme="a">';html+='<div class="ui-bar-a" style="text-align:center;">';html+='<h3 style="padding: 0 1em;">'+title+'</h3>';html+='</div>';html+='<div style="padding: 1em;">';html+='<div style="padding: 1em .25em;margin: 0;">';html+=message;html+='</div>';html+='<p><button type="button" data-icon="check" onclick="$(\'.confirmFlyout\')[0].confirm=true;$(\'.confirmFlyout\').popup(\'close\');" data-theme="b">'+Globalize.translate('ButtonOk')+'</button></p>';if(showCancel){html+='<p><button type="button" data-icon="delete" onclick="$(\'.confirmFlyout\').popup(\'close\');" data-theme="a">'+Globalize.translate('ButtonCancel')+'</button></p>';}
html+='</div>';html+='</div>';$(document.body).append(html);$('.confirmFlyout').popup({history:false}).trigger('create').popup("open").on("popupafterclose",function(){if(callback){callback(this.confirm==true);}
$(this).off("popupafterclose").remove();});},refreshSystemInfoFromServer:function(){if(Dashboard.getAccessToken()){ApiClient.getSystemInfo().done(function(info){Dashboard.updateSystemInfo(info);});}},restartServer:function(){Dashboard.suppressAjaxErrors=true;Dashboard.showLoadingMsg();ApiClient.restartServer().done(function(){setTimeout(function(){Dashboard.reloadPageWhenServerAvailable();},250);}).fail(function(){Dashboard.suppressAjaxErrors=false;});},reloadPageWhenServerAvailable:function(retryCount){ApiClient.getJSON(ApiClient.getUrl("System/Info")).done(function(info){if(!info.HasPendingRestart){Dashboard.reloadPage();}else{Dashboard.retryReload(retryCount);}}).fail(function(){Dashboard.retryReload(retryCount);});},retryReload:function(retryCount){setTimeout(function(){retryCount=retryCount||0;retryCount++;if(retryCount<10){Dashboard.reloadPageWhenServerAvailable(retryCount);}else{Dashboard.suppressAjaxErrors=false;}},500);},showUserFlyout:function(context){ConnectionManager.user().done(function(user){var html='<div data-role="panel" data-position="right" data-display="overlay" id="userFlyout" data-position-fixed="true" data-theme="a">';html+='<h3>';var imgWidth=48;if(user.imageUrl){var url=user.imageUrl;if(user.supportsImageParams){url+="&width="+(imgWidth*Math.max(devicePixelRatio||1,2));}
html+='<img style="max-width:'+imgWidth+'px;vertical-align:middle;margin-right:.5em;border-radius: 50px;" src="'+url+'" />';}
html+=user.name;html+='</h3>';html+='<form>';var isConnectMode=Dashboard.isConnectMode();if(user.localUser&&user.localUser.Policy.EnableUserPreferenceAccess){html+='<p><a data-mini="true" data-role="button" href="mypreferencesdisplay.html?userId='+user.localUser.Id+'" data-icon="gear">'+Globalize.translate('ButtonMyPreferences')+'</button></a>';}
if(isConnectMode){html+='<p><a data-mini="true" data-role="button" href="selectserver.html" data-icon="cloud" data-ajax="false">'+Globalize.translate('ButtonSelectServer')+'</button></a>';}
html+='<p><button data-mini="true" type="button" onclick="Dashboard.logout();" data-icon="lock">'+Globalize.translate('ButtonSignOut')+'</button></p>';html+='</form>';html+='</div>';$(document.body).append(html);var elem=$('#userFlyout').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});});},getPluginSecurityInfo:function(){if(!Dashboard.getPluginSecurityInfoPromise){var deferred=$.Deferred();ApiClient.ajax({type:"GET",url:ApiClient.getUrl("Plugins/SecurityInfo"),dataType:'json',error:function(){}}).done(function(result){deferred.resolveWith(null,[result]);});Dashboard.getPluginSecurityInfoPromise=deferred;}
return Dashboard.getPluginSecurityInfoPromise;},resetPluginSecurityInfo:function(){Dashboard.getPluginSecurityInfoPromise=null;Dashboard.validateCurrentUser();},ensureHeader:function(page){if(page.hasClass('standalonePage')&&!page.hasClass('noHeaderPage')){Dashboard.renderHeader(page);}},renderHeader:function(page){var header=$('.header',page);if(!header.length){var headerHtml='';headerHtml+='<div class="header">';headerHtml+='<a class="logo" href="index.html" style="text-decoration:none;font-size: 22px;">';if(page.hasClass('standalonePage')){headerHtml+='<img class="imgLogoIcon" src="css/images/mblogoicon.png" />';headerHtml+='<span class="logoLibraryMenuButtonText">EMBY</span>';}
headerHtml+='</a>';headerHtml+='</div>';page.prepend(headerHtml);}},ensureToolsMenu:function(page,user){var sidebar=$('.toolsSidebar',page);if(!sidebar.length){var html='<div class="content-secondary toolsSidebar">';html+='<div class="sidebarLinks">';var items=Dashboard.getToolsMenuLinks(page);var i,length,item;var menuHtml='';for(i=0,length=items.length;i<length;i++){item=items[i];if(!user.Policy.IsAdministrator){break;}
if(item.divider){menuHtml+="<div class='sidebarDivider ui-bar-inherit'></div>";}
if(item.href){var style=item.color?' style="color:'+item.color+'"':'';if(item.selected){menuHtml+='<a class="sidebarLink selectedSidebarLink" href="'+item.href+'">';}else{menuHtml+='<a class="sidebarLink" href="'+item.href+'">';}
menuHtml+='<span class="fa '+item.icon+' sidebarLinkIcon"'+style+'></span>';menuHtml+='<span class="sidebarLinkText">';menuHtml+=item.name;menuHtml+='</span>';menuHtml+='</a>';}else{menuHtml+='<div class="sidebarHeader">';menuHtml+=item.name;menuHtml+='</div>';}}
html+=menuHtml;html+='</div>';html+='</div>';html+='<div data-role="panel" id="dashboardPanel" class="dashboardPanel" data-position="left" data-display="overlay" data-position-fixed="true" data-theme="a">';html+='<p class="libraryPanelHeader" style="margin: 15px 0 15px 15px;"><a href="index.html" class="imageLink"><img src="css/images/mblogoicon.png" /><span style="color:#333;">EMBY</span></a></p>';html+='<div class="sidebarLinks">';html+=menuHtml;html+='</div>';html+='</div>';$('.content-primary',page).before(html);$(page).trigger('create');}},getToolsMenuLinks:function(page){var pageElem=page[0];var isServicesPage=page.hasClass('appServicesPage');var context=getParameterByName('context');return[{name:Globalize.translate('TabServer'),href:"dashboard.html",selected:page.hasClass("dashboardHomePage"),icon:'fa-dashboard',color:'#38c'},{name:Globalize.translate('TabDevices'),href:"devices.html",selected:page.hasClass("devicesPage"),icon:'fa-tablet',color:'#ECA403'},{name:Globalize.translate('TabUsers'),href:"userprofiles.html",selected:page.hasClass("userProfilesPage"),icon:'fa-users',color:'#679C34'},{name:Globalize.translate('TabLibrary'),divider:true,href:"library.html",selected:page.hasClass("mediaLibraryPage"),icon:'fa-film'},{name:Globalize.translate('TabMetadata'),href:"metadata.html",selected:page.hasClass('metadataConfigurationPage'),icon:'fa-file-text'},{name:Globalize.translate('TabPlayback'),href:"playbackconfiguration.html",selected:page.hasClass('playbackConfigurationPage'),icon:'fa-play-circle'},{name:Globalize.translate('TabSync'),href:"syncactivity.html",selected:page.hasClass('syncConfigurationPage')||(isServicesPage&&context=='sync'),icon:'fa-cloud'},{divider:true,name:Globalize.translate('TabExtras')},{name:Globalize.translate('TabAutoOrganize'),href:"autoorganizelog.html",selected:page.hasClass("organizePage"),icon:'fa-files-o',color:'#01C0DD'},{name:Globalize.translate('TabDLNA'),href:"dlnasettings.html",selected:page.hasClass("dlnaPage"),icon:'fa-film',color:'#E5342E'},{name:Globalize.translate('TabLiveTV'),href:"livetvstatus.html",selected:page.hasClass("liveTvSettingsPage")||(isServicesPage&&context=='livetv'),icon:'fa-video-camera',color:'#293AAE'},{name:Globalize.translate('TabNotifications'),href:"notificationsettings.html",selected:page.hasClass("notificationConfigurationPage"),icon:'fa-wifi',color:'brown'},{name:Globalize.translate('TabPlugins'),href:"plugins.html",selected:page.hasClass("pluginConfigurationPage"),icon:'fa-plus-circle',color:'#9D22B1'},{divider:true,name:Globalize.translate('TabExpert')},{name:Globalize.translate('TabAdvanced'),href:"advanced.html",selected:page.hasClass("advancedConfigurationPage"),icon:'fa-gears',color:'#F16834'},{name:Globalize.translate('TabScheduledTasks'),href:"scheduledtasks.html",selected:page.hasClass("scheduledTasksConfigurationPage"),icon:'fa-clock-o',color:'#38c'},{name:Globalize.translate('TabHelp'),divider:true,href:"support.html",selected:pageElem.id=="supportPage"||pageElem.id=="logPage"||pageElem.id=="supporterPage"||pageElem.id=="supporterKeyPage"||pageElem.id=="aboutPage",icon:'fa-info-circle',color:'#679C34'}];},ensureWebSocket:function(){if(ApiClient.isWebSocketOpenOrConnecting()||!ApiClient.isWebSocketSupported()){return;}
ApiClient.openWebSocket();ApiClient.reportCapabilities(Dashboard.capabilities());},processGeneralCommand:function(cmd){switch(cmd.Name){case'GoHome':Dashboard.navigate('index.html');break;case'GoToSettings':Dashboard.navigate('dashboard.html');break;case'DisplayContent':Dashboard.onBrowseCommand(cmd.Arguments);break;case'GoToSearch':Search.showSearchPanel($.mobile.activePage);break;case'DisplayMessage':{var args=cmd.Arguments;if(args.TimeoutMs&&WebNotifications.supported()){var notification={title:args.Header,body:args.Text,timeout:args.TimeoutMs};WebNotifications.show(notification);}
else{Dashboard.showFooterNotification({html:"<div><b>"+args.Header+"</b></div>"+args.Text,timeout:args.TimeoutMs});}
break;}
case'VolumeUp':case'VolumeDown':case'Mute':case'Unmute':case'ToggleMute':case'SetVolume':case'SetAudioStreamIndex':case'SetSubtitleStreamIndex':case'ToggleFullscreen':break;default:console.log('Unrecognized command: '+cmd.Name);break;}},onWebSocketMessageReceived:function(e,data){var msg=data;if(msg.MessageType==="LibraryChanged"){Dashboard.processLibraryUpdateNotification(msg.Data);}
else if(msg.MessageType==="ServerShuttingDown"){Dashboard.hideServerRestartWarning();}
else if(msg.MessageType==="ServerRestarting"){Dashboard.hideServerRestartWarning();}
else if(msg.MessageType==="UserDeleted"){Dashboard.validateCurrentUser();}
else if(msg.MessageType==="SystemInfo"){Dashboard.updateSystemInfo(msg.Data);}
else if(msg.MessageType==="RestartRequired"){Dashboard.updateSystemInfo(msg.Data);}
else if(msg.MessageType==="UserUpdated"||msg.MessageType==="UserConfigurationUpdated"){Dashboard.validateCurrentUser();var user=msg.Data;if(user.Id==Dashboard.getCurrentUserId()){$('.currentUsername').html(user.Name);}}
else if(msg.MessageType==="PackageInstallationCompleted"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"completed");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="PackageInstallationFailed"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"failed");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="PackageInstallationCancelled"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"cancelled");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="PackageInstalling"){Dashboard.getCurrentUser().done(function(currentUser){if(currentUser.Policy.IsAdministrator){Dashboard.showPackageInstallNotification(msg.Data,"progress");Dashboard.refreshSystemInfoFromServer();}});}
else if(msg.MessageType==="GeneralCommand"){var cmd=msg.Data;}},onBrowseCommand:function(cmd){var url;var type=(cmd.ItemType||"").toLowerCase();if(type=="genre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="musicgenre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="gamegenre"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="studio"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="person"){url="itembynamedetails.html?id="+cmd.ItemId;}
else if(type=="musicartist"){url="itembynamedetails.html?id="+cmd.ItemId;}
if(url){Dashboard.navigate(url);return;}
ApiClient.getItem(Dashboard.getCurrentUserId(),cmd.ItemId).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,null,''));});},showPackageInstallNotification:function(installation,status){var html='';if(status=='completed'){html+='<img src="css/images/notifications/done.png" class="notificationIcon" />';}
else if(status=='cancelled'){html+='<img src="css/images/notifications/info.png" class="notificationIcon" />';}
else if(status=='failed'){html+='<img src="css/images/notifications/error.png" class="notificationIcon" />';}
else if(status=='progress'){html+='<img src="css/images/notifications/download.png" class="notificationIcon" />';}
html+='<span style="margin-right: 1em;">';if(status=='completed'){html+=Globalize.translate('LabelPackageInstallCompleted').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='cancelled'){html+=Globalize.translate('LabelPackageInstallCancelled').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='failed'){html+=Globalize.translate('LabelPackageInstallFailed').replace('{0}',installation.Name+' '+installation.Version);}
else if(status=='progress'){html+=Globalize.translate('LabelInstallingPackage').replace('{0}',installation.Name+' '+installation.Version);}
html+='</span>';if(status=='progress'){var percentComplete=Math.round(installation.PercentComplete||0);html+='<progress style="margin-right: 1em;" max="100" value="'+percentComplete+'" title="'+percentComplete+'%">';html+=''+percentComplete+'%';html+='</progress>';if(percentComplete<100){var btnId="btnCancel"+installation.Id;html+='<button id="'+btnId+'" type="button" data-icon="delete" onclick="$(\''+btnId+'\').buttonEnabled(false);Dashboard.cancelInstallation(\''+installation.Id+'\');" data-theme="b" data-inline="true" data-mini="true">'+Globalize.translate('ButtonCancel')+'</button>';}}
var timeout=0;if(status=='cancelled'){timeout=2000;}
var forceShow=status!="progress";var allowHide=status!="progress"&&status!='cancelled';Dashboard.showFooterNotification({html:html,id:installation.Id,timeout:timeout,forceShow:forceShow,allowHide:allowHide});},processLibraryUpdateNotification:function(data){var newItems=data.ItemsAdded;if(!newItems.length){return;}
ApiClient.getItems(Dashboard.getCurrentUserId(),{Recursive:true,Limit:3,Filters:"IsNotFolder",SortBy:"DateCreated",SortOrder:"Descending",ImageTypes:"Primary",Ids:newItems.join(',')}).done(function(result){var items=result.Items;for(var i=0,length=Math.min(items.length,2);i<length;i++){var item=items[i];var notification={title:"New "+item.Type,body:item.Name,timeout:5000};var imageTags=item.ImageTags||{};if(imageTags.Primary){notification.icon=ApiClient.getScaledImageUrl(item.Id,{width:60,tag:imageTags.Primary,type:"Primary"});}
WebNotifications.show(notification);}});},ensurePageTitle:function(page){if(!page.hasClass('type-interior')){return;}
if($('.pageTitle',page).length){return;}
var parent=$('.content-primary',page);if(!parent.length){parent=$('.ui-content',page)[0];}
var helpUrl=page.attr('data-helpurl');var html='<div>';html+='<h1 class="pageTitle" style="display:inline-block;">'+(document.title||'&nbsp;')+'</h1>';if(helpUrl){html+='<a href="'+helpUrl+'" target="_blank" class="accentButton accentButton-g" style="margin-top:-10px;"><i class="fa fa-info-circle"></i>'+Globalize.translate('ButtonHelp')+'</a>';}
html+='</div>';$(parent).prepend(html);},setPageTitle:function(title){$('.pageTitle',$.mobile.activePage).html(title);if(title){document.title=title;}},getDisplayTime:function(ticks){var ticksPerHour=36000000000;var ticksPerMinute=600000000;var ticksPerSecond=10000000;var parts=[];var hours=ticks/ticksPerHour;hours=Math.floor(hours);if(hours){parts.push(hours);}
ticks-=(hours*ticksPerHour);var minutes=ticks/ticksPerMinute;minutes=Math.floor(minutes);ticks-=(minutes*ticksPerMinute);if(minutes<10&&hours){minutes='0'+minutes;}
parts.push(minutes);var seconds=ticks/ticksPerSecond;seconds=Math.floor(seconds);if(seconds<10){seconds='0'+seconds;}
parts.push(seconds);return parts.join(':');},populateLanguages:function(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>";}
$(select).html(html).selectmenu("refresh");},populateCountries:function(select,allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>";}
$(select).html(html).selectmenu("refresh");},getSupportedRemoteCommands:function(){return["GoHome","GoToSettings","VolumeUp","VolumeDown","Mute","Unmute","ToggleMute","SetVolume","SetAudioStreamIndex","SetSubtitleStreamIndex","DisplayContent","GoToSearch","DisplayMessage"];},isServerlessPage:function(){var url=getWindowUrl().toLowerCase();return url.indexOf('connectlogin.html')!=-1||url.indexOf('selectserver.html')!=-1;},capabilities:function(){return{PlayableMediaTypes:"Audio,Video",SupportedCommands:Dashboard.getSupportedRemoteCommands().join(','),SupportsPersistentIdentifier:false,SupportsMediaControl:true,SupportedLiveMediaTypes:['Audio','Video']};}};(function(){function generateDeviceName(){var name="Web Browser";if($.browser.chrome){name="Chrome";}else if($.browser.safari){name="Safari";}else if($.browser.webkit){name="WebKit";}else if($.browser.msie){name="Internet Explorer";}else if($.browser.opera){name="Opera";}else if($.browser.firefox||$.browser.mozilla){name="Firefox";}
if($.browser.version){name+=" "+$.browser.version;}
if($.browser.ipad){name+=" Ipad";}else if($.browser.iphone){name+=" Iphone";}else if($.browser.android){name+=" Android";}
return name;}
if(!window.WebSocket){alert(Globalize.translate('MessageBrowserDoesNotSupportWebSockets'));}
function initializeApiClient(apiClient){$(apiClient).off('.dashboard').on("websocketmessage.dashboard",Dashboard.onWebSocketMessageReceived).on('requestfail.dashboard',Dashboard.onRequestFail).on('serveraddresschanged.dashboard',Dashboard.onApiClientServerAddressChanged);}
var appVersion=window.dashboardVersion;var appName;var deviceName;var deviceId;if(window.device){appName="Emby Mobile";deviceName=device.model;deviceId=device.uuid;}else{appName="Emby Web Client";deviceName=generateDeviceName();deviceId=MediaBrowser.generateDeviceId();}
var credentialProvider=new MediaBrowser.CredentialProvider();var capabilities=Dashboard.capabilities();window.ConnectionManager=new MediaBrowser.ConnectionManager(Logger,credentialProvider,appName,appVersion,deviceName,deviceId,capabilities);if(Dashboard.isConnectMode()){$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});if(!Dashboard.isServerlessPage()){if(Dashboard.serverAddress()&&Dashboard.getCurrentUserId()&&Dashboard.getAccessToken()){window.ApiClient=new MediaBrowser.ApiClient(Logger,Dashboard.serverAddress(),appName,appVersion,deviceName,deviceId);ApiClient.setCurrentUserId(Dashboard.getCurrentUserId(),Dashboard.getAccessToken());initializeApiClient(ApiClient);ConnectionManager.addApiClient(ApiClient,true).fail(Dashboard.logout);}else{Dashboard.logout();return;}}}else{window.ApiClient=new MediaBrowser.ApiClient(Logger,Dashboard.serverAddress(),appName,appVersion,deviceName,deviceId);ApiClient.setCurrentUserId(Dashboard.getCurrentUserId(),Dashboard.getAccessToken());initializeApiClient(ApiClient);ConnectionManager.addApiClient(ApiClient);}
if(window.ApiClient){Dashboard.importCss(ApiClient.getUrl('Branding/Css'));ApiClient.getDefaultImageQuality=function(imageType){var quality=90;var isBackdrop=imageType.toLowerCase()=='backdrop';if(isBackdrop){quality-=10;}
if($.browser.safari&&$.browser.mobile){quality-=10;if(isBackdrop){quality-=10;}}
return quality;};}})();(function(){function onReady(){var videoPlayerHtml='<div id="mediaPlayer" data-theme="b" class="ui-bar-b" style="display: none;">';videoPlayerHtml+='<div class="videoBackdrop">';videoPlayerHtml+='<div id="videoPlayer">';videoPlayerHtml+='<div id="videoElement">';videoPlayerHtml+='<div id="play" class="status"></div>';videoPlayerHtml+='<div id="pause" class="status"></div>';videoPlayerHtml+='</div>';videoPlayerHtml+='<div class="videoTopControls hiddenOnIdle">';videoPlayerHtml+='<div class="videoTopControlsLogo"></div>';videoPlayerHtml+='<div class="videoAdvancedControls">';videoPlayerHtml+='<button class="mediaButton videoTrackControl previousTrackButton" title="Previous video" type="button" onclick="MediaPlayer.previousTrack();" data-icon="previous-track" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonPreviousTrack')+'</button>';videoPlayerHtml+='<button class="mediaButton videoTrackControl nextTrackButton" title="Next video" type="button" onclick="MediaPlayer.nextTrack();" data-icon="next-track" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonNextTrack')+'</button>';videoPlayerHtml+='<button class="mediaButton videoAudioButton" title="Audio tracks" type="button" data-icon="audiocd" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonAudioTracks')+'</button>';videoPlayerHtml+='<div data-role="popup" class="videoAudioPopup videoPlayerPopup" data-history="false" data-theme="b"></div>';videoPlayerHtml+='<button class="mediaButton videoSubtitleButton" title="Subtitles" type="button" data-icon="subtitles" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonFullscreen')+'</button>';videoPlayerHtml+='<div data-role="popup" class="videoSubtitlePopup videoPlayerPopup" data-history="false" data-theme="b"></div>';videoPlayerHtml+='<button class="mediaButton videoChaptersButton" title="Scenes" type="button" data-icon="video" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonScenes')+'</button>';videoPlayerHtml+='<div data-role="popup" class="videoChaptersPopup videoPlayerPopup" data-history="false" data-theme="b"></div>';videoPlayerHtml+='<button class="mediaButton videoQualityButton" title="Quality" type="button" data-icon="gear" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonQuality')+'</button>';videoPlayerHtml+='<div data-role="popup" class="videoQualityPopup videoPlayerPopup" data-history="false" data-theme="b"></div>';videoPlayerHtml+='<button class="mediaButton" title="Stop" type="button" onclick="MediaPlayer.stop();" data-icon="delete" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonStop')+'</button>';videoPlayerHtml+='</div>';videoPlayerHtml+='</div>';videoPlayerHtml+='<div class="videoControls hiddenOnIdle">';videoPlayerHtml+='<button id="video-previousTrackButton" class="mediaButton previousTrackButton videoTrackControl" title="Previous Track" type="button" onclick="MediaPlayer.previousTrack();" data-icon="previous-track" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonPreviousTrack')+'</button>';videoPlayerHtml+='<button id="video-playButton" class="mediaButton" title="Play" type="button" onclick="MediaPlayer.unpause();" data-icon="play" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonPlay')+'</button>';videoPlayerHtml+='<button id="video-pauseButton" class="mediaButton" title="Pause" type="button" onclick="MediaPlayer.pause();" data-icon="pause" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonPause')+'</button>';videoPlayerHtml+='<button id="video-nextTrackButton" class="mediaButton nextTrackButton videoTrackControl" title="Next Track" type="button" onclick="MediaPlayer.nextTrack();" data-icon="next-track" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonNextTrack')+'</button>';videoPlayerHtml+='<div class="positionSliderContainer sliderContainer">';videoPlayerHtml+='<input type="range" class="mediaSlider positionSlider slider" step=".001" min="0" max="100" value="0" style="display:none;" data-mini="true" data-theme="a" data-highlight="true" />';videoPlayerHtml+='</div>';videoPlayerHtml+='<div class="currentTime">--:--</div>';videoPlayerHtml+='<div class="nowPlayingInfo hiddenOnIdle">';videoPlayerHtml+='<div class="nowPlayingImage"></div>';videoPlayerHtml+='<div class="nowPlayingText"></div>';videoPlayerHtml+='</div>';videoPlayerHtml+='<button id="video-muteButton" class="mediaButton muteButton" title="Mute" type="button" onclick="MediaPlayer.mute();" data-icon="audio" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonMute')+'</button>';videoPlayerHtml+='<button id="video-unmuteButton" class="mediaButton unmuteButton" title="Unmute" type="button" onclick="MediaPlayer.unMute();" data-icon="volume-off" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonUnmute')+'</button>';videoPlayerHtml+='<div class="volumeSliderContainer sliderContainer">';videoPlayerHtml+='<input type="range" class="mediaSlider volumeSlider slider" step=".05" min="0" max="1" value="0" style="display:none;" data-mini="true" data-theme="a" data-highlight="true" />';videoPlayerHtml+='</div>';videoPlayerHtml+='<button onclick="MediaPlayer.toggleFullscreen();" id="video-fullscreenButton" class="mediaButton fullscreenButton" title="Fullscreen" type="button" data-icon="expand" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonFullscreen')+'</button>';videoPlayerHtml+='</div>';videoPlayerHtml+='</div>';videoPlayerHtml+='</div>';videoPlayerHtml+='</div>';$(document.body).append(videoPlayerHtml);var mediaPlayerElem=$('#mediaPlayer',document.body);mediaPlayerElem.trigger('create');var footerHtml='<div id="footer" data-theme="b" class="ui-bar-b">';footerHtml+='<div id="footerNotifications"></div>';footerHtml+='</div>';$(document.body).append(footerHtml);var footerElem=$('#footer',document.body);footerElem.trigger('create');$(window).on("beforeunload",function(){var apiClient=ConnectionManager.currentApiClient();if(apiClient&&apiClient.isWebSocketOpen()&&!MediaPlayer.isPlaying()){console.log('Sending close web socket command');apiClient.closeWebSocket();}});$(document).on('contextmenu','.ui-popup-screen',function(e){$('.ui-popup').popup('close');e.preventDefault();return false;});function isTouchDevice(){return(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));}
if(isTouchDevice()){$(document.body).addClass('touch');}}
if(Dashboard.isRunningInCordova()){document.addEventListener("deviceready",function(){$(onReady);},false);}else{$(onReady);}})();Dashboard.jQueryMobileInit();$(document).on('pagecreate',".page",function(){var page=$(this);var current=page.data('theme');if(current){return;}
var newTheme;if(page.hasClass('libraryPage')){newTheme='b';}else{newTheme='a';}
current=page.page("option","theme");if(current&&current!=newTheme){page.page("option","theme",newTheme);}}).on('pagebeforeshow',".page",function(){var page=$(this);var isConnectMode=Dashboard.isConnectMode();if(isConnectMode&&!page.hasClass('connectLoginPage')){if(!ConnectionManager.isLoggedIntoConnect()){console.log('Not logged into connect. Redirecting to login.');Dashboard.logout();return;}}
var apiClient=ConnectionManager.currentApiClient();if(Dashboard.getAccessToken()&&Dashboard.getCurrentUserId()){if(apiClient){Dashboard.getCurrentUser().done(function(user){var isSettingsPage=page.hasClass('type-interior');if(!user.Policy.IsAdministrator&&isSettingsPage){window.location.replace("index.html");return;}
if(isSettingsPage){Dashboard.ensureToolsMenu(page,user);}});}
Dashboard.ensureHeader(page);Dashboard.ensurePageTitle(page);}
else{if(this.id!=="loginPage"&&!page.hasClass('forgotPasswordPage')&&!page.hasClass('wizardPage')&&!isConnectMode){console.log('Not logged into server. Redirecting to login.');Dashboard.logout();return;}
Dashboard.ensureHeader(page);Dashboard.ensurePageTitle(page);}
if(apiClient&&!apiClient.isWebSocketOpen()){Dashboard.refreshSystemInfoFromServer();}});var LibraryBrowser=(function(window,document,$,screen,store){var pageSizeKey='pagesize_v4';var defaultBackground="#333";return{getDefaultPageSize:function(key,defaultValue){var saved=store.getItem(key||pageSizeKey);if(saved){return parseInt(saved);}
if(defaultValue){return defaultValue;}
var isChrome=$.browser.chrome;return isChrome?200:100;},getDefaultItemsView:function(view,mobileView){return $.browser.mobile?mobileView:view;},loadSavedQueryValues:function(key,query){var values=store.getItem(key+'_'+Dashboard.getCurrentUserId());if(values){values=JSON.parse(values);return $.extend(query,values);}
return query;},saveQueryValues:function(key,query){var values={};if(query.SortBy){values.SortBy=query.SortBy;}
if(query.SortOrder){values.SortOrder=query.SortOrder;}
try{store.setItem(key+'_'+Dashboard.getCurrentUserId(),JSON.stringify(values));}catch(e){}},saveViewSetting:function(key,value){try{store.setItem(key+'_'+Dashboard.getCurrentUserId()+'_view',value);}catch(e){}},getSavedViewSetting:function(key){var deferred=$.Deferred();var val=store.getItem(key+'_'+Dashboard.getCurrentUserId()+'_view');deferred.resolveWith(null,[val]);return deferred.promise();},getDateParamValue:function(date){function formatDigit(i){return i<10?"0"+i:i;}
var d=date;return""+d.getFullYear()+formatDigit(d.getMonth()+1)+formatDigit(d.getDate())+formatDigit(d.getHours())+formatDigit(d.getMinutes())+formatDigit(d.getSeconds());},playAllFromHere:function(fn,index){fn(index,100,"MediaSources,Chapters").done(function(result){MediaController.play({items:result.Items});});},queueAllFromHere:function(query,index){fn(index,100,"MediaSources,Chapters").done(function(result){MediaController.queue({items:result.Items});});},getItemCountsHtml:function(options,item){var counts=[];var childText;if(item.Type=='Playlist'){childText='';if(item.CumulativeRunTimeTicks){var minutes=item.CumulativeRunTimeTicks/600000000;minutes=minutes||1;childText+=Globalize.translate('ValueMinutes',Math.round(minutes));}else{childText+=Globalize.translate('ValueMinutes',0);}
counts.push(childText);}
else if(options.context=="movies"){if(item.MovieCount){childText=item.MovieCount==1?Globalize.translate('ValueOneMovie'):Globalize.translate('ValueMovieCount',item.MovieCount);counts.push(childText);}
if(item.TrailerCount){childText=item.TrailerCount==1?Globalize.translate('ValueOneTrailer'):Globalize.translate('ValueTrailerCount',item.TrailerCount);counts.push(childText);}}else if(options.context=="tv"){if(item.SeriesCount){childText=item.SeriesCount==1?Globalize.translate('ValueOneSeries'):Globalize.translate('ValueSeriesCount',item.SeriesCount);counts.push(childText);}
if(item.EpisodeCount){childText=item.EpisodeCount==1?Globalize.translate('ValueOneEpisode'):Globalize.translate('ValueEpisodeCount',item.EpisodeCount);counts.push(childText);}}else if(options.context=="games"){if(item.GameCount){childText=item.GameCount==1?Globalize.translate('ValueOneGame'):Globalize.translate('ValueGameCount',item.GameCount);counts.push(childText);}}else if(options.context=="music"){if(item.AlbumCount){childText=item.AlbumCount==1?Globalize.translate('ValueOneAlbum'):Globalize.translate('ValueAlbumCount',item.AlbumCount);counts.push(childText);}
if(item.SongCount){childText=item.SongCount==1?Globalize.translate('ValueOneSong'):Globalize.translate('ValueSongCount',item.SongCount);counts.push(childText);}
if(item.MusicVideoCount){childText=item.MusicVideoCount==1?Globalize.translate('ValueOneMusicVideo'):Globalize.translate('ValueMusicVideoCount',item.MusicVideoCount);counts.push(childText);}}
return counts.join('  ');},getArtistLinksHtml:function(artists,cssClass){var html=[];for(var i=0,length=artists.length;i<length;i++){var artist=artists[i];var css=cssClass?(' class="'+cssClass+'"'):'';html.push('<a'+css+' href="itembynamedetails.html?context=music&id='+artist.Id+'">'+artist.Name+'</a>');}
html=html.join(' / ');return html;},showPlayMenu:function(positionTo,itemId,itemType,isFolder,mediaType,resumePositionTicks,showAddToPlaylist){var externalPlayers=ExternalPlayer.getExternalPlayers();if(!resumePositionTicks&&mediaType!="Audio"&&!isFolder){if(!externalPlayers.length||mediaType!="Video"){MediaController.play(itemId);return;}}
$('.playFlyout').popup("close").remove();var html='<div data-role="popup" class="playFlyout" data-history="false" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';html+='<li><a href="#" onclick="MediaController.play(\''+itemId+'\');LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonPlay')+'</a></li>';if(!isFolder&&externalPlayers.length){html+='<li><a href="#" onclick="LibraryBrowser.closePlayMenu();ExternalPlayer.showMenu(\''+itemId+'\');">'+Globalize.translate('ButtonPlayExternalPlayer')+'</a></li>';}
if(resumePositionTicks){html+='<li><a href="#" onclick="MediaController.play({ids:[\''+itemId+'\'],startPositionTicks:'+resumePositionTicks+'});LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonResume')+'</a></li>';}
if(MediaController.canQueueMediaType(mediaType,itemType)){html+='<li><a href="#" onclick="MediaController.queue(\''+itemId+'\');LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonQueue')+'</a></li>';}
if(itemType=="Audio"||itemType=="MusicAlbum"||itemType=="MusicArtist"||itemType=="MusicGenre"){html+='<li><a href="#" onclick="MediaController.instantMix(\''+itemId+'\');LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonInstantMix')+'</a></li>';}
if(isFolder||itemType=="MusicArtist"||itemType=="MusicGenre"){html+='<li><a href="#" onclick="MediaController.shuffle(\''+itemId+'\');LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonShuffle')+'</a></li>';}
if(showAddToPlaylist){html+='<li><a href="#" onclick="PlaylistManager.showPanel([\''+itemId+'\']);LibraryBrowser.closePlayMenu();">'+Globalize.translate('ButtonAddToPlaylist')+'</a></li>';}
html+='</ul>';html+='</div>';$($.mobile.activePage).append(html);$('.playFlyout').popup({positionTo:positionTo||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();}).parents(".ui-popup-container");},closePlayMenu:function(){$('.playFlyout').popup("close").remove();},getMoreCommands:function(item,user){var commands=[];if(BoxSetEditor.supportsAddingToCollection(item)){commands.push('addtocollection');}
if(PlaylistManager.supportsPlaylists(item)){commands.push('playlist');}
if(item.Type=='BoxSet'||item.Type=='Playlist'){commands.push('delete');}
else if(item.CanDelete){commands.push('delete');}
if(user.Policy.IsAdministrator){if(item.Type!="Recording"&&item.Type!="Program"){commands.push('edit');}}
commands.push('refresh');if(SyncManager.isAvailable(item,user)){commands.push('sync');}
if(item.CanDownload){commands.push('download');}
return commands;},refreshItem:function(itemId){ApiClient.refreshItem(itemId,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllImages:false,ReplaceAllMetadata:true});Dashboard.alert(Globalize.translate('MessageRefreshQueued'));},deleteItem:function(itemId){setTimeout(function(){var msg="<p>"+Globalize.translate('ConfirmDeleteItem')+"</p>";Dashboard.confirm(msg,Globalize.translate('HeaderDeleteItem'),function(result){if(result){ApiClient.deleteItem(itemId);$(LibraryBrowser).trigger('itemdeleting',[itemId]);}});},250);},showMoreCommands:function(positionTo,itemId,commands){$('.playFlyout').popup("close").remove();var html='<div data-role="popup" class="playFlyout" data-history="false" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';if(commands.indexOf('addtocollection')!=-1){html+='<li data-icon="plus"><a href="#" onclick="$(\'.playFlyout\').popup(\'close\');BoxSetEditor.showPanel([\''+itemId+'\']);">'+Globalize.translate('ButtonAddToCollection')+'</a></li>';}
if(commands.indexOf('playlist')!=-1){html+='<li data-icon="plus"><a href="#" onclick="$(\'.playFlyout\').popup(\'close\');PlaylistManager.showPanel([\''+itemId+'\']);">'+Globalize.translate('ButtonAddToPlaylist')+'</a></li>';}
if(commands.indexOf('delete')!=-1){html+='<li data-icon="delete"><a class="btnMoreMenuDelete" href="#" onclick="$(\'.playFlyout\').popup(\'close\');LibraryBrowser.deleteItem([\''+itemId+'\']);">'+Globalize.translate('ButtonDelete')+'</a></li>';}
if(commands.indexOf('download')!=-1){var downloadHref=ApiClient.getUrl("Items/"+itemId+"/Download",{api_key:ApiClient.accessToken()});html+='<li data-icon="arrow-d"><a class="btnMoreMenuDownload" data-ajax="false" href="'+downloadHref+'" onclick="$(\'.playFlyout\').popup(\'close\');">'+Globalize.translate('ButtonDownload')+'</a></li>';}
if(commands.indexOf('edit')!=-1){html+='<li data-icon="edit"><a href="edititemmetadata.html?id='+itemId+'">'+Globalize.translate('ButtonEdit')+'</a></li>';}
if(commands.indexOf('refresh')!=-1){html+='<li data-icon="refresh"><a class="btnMoreMenuRefresh" href="#">'+Globalize.translate('ButtonRefresh')+'</a></li>';}
html+='</ul>';html+='</div>';$($.mobile.activePage).append(html);var elem=$('.playFlyout').popup({positionTo:positionTo||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnMoreMenuRefresh',elem).on('click',function(){$('.playFlyout').popup('close');ApiClient.refreshItem(itemId,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllImages:false,ReplaceAllMetadata:true}).done(function(){});});},getHref:function(item,context,topParentId){var href=LibraryBrowser.getHrefInternal(item,context);if(context){href+=href.indexOf('?')==-1?"?context=":"&context=";href+=context;}
if(topParentId==null&&context!='playlists'){topParentId=LibraryMenu.getTopParentId();}
if(topParentId){href+=href.indexOf('?')==-1?"?topParentId=":"&topParentId=";href+=topParentId;}
return href;},getHrefInternal:function(item,context){if(!item){throw new Error('item cannot be null');}
if(item.url){return item.url;}
var id=item.Id||item.ItemId;if(item.CollectionType=='livetv'){return'livetvsuggested.html';}
if(item.CollectionType=='channels'){return'channelslatest.html';}
if(context!='folders'){if(item.CollectionType=='movies'){return'moviesrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='boxsets'){return'collections.html?topParentId='+item.Id;}
if(item.CollectionType=='tvshows'){return'tvrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='music'){return'musicrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='games'){return'gamesrecommended.html?topParentId='+item.Id;}
if(item.CollectionType=='playlists'){return'playlists.html?topParentId='+item.Id;}
if(item.CollectionType=='photos'){return'photos.html?topParentId='+item.Id;}}
if(item.Type=='CollectionFolder'){return'itemlist.html?topParentId='+item.Id+'&parentid='+item.Id;}
if(item.Type=="PhotoAlbum"&&context=='photos'){return"photos.html?parentId="+id;}
if(item.Type=="Playlist"){return"playlistedit.html?id="+id;}
if(item.Type=="TvChannel"){return"livetvchannel.html?id="+id;}
if(item.Type=="Channel"){return"channelitems.html?id="+id;}
if(item.Type=="ChannelFolderItem"){return"channelitems.html?id="+item.ChannelId+'&folderId='+item.Id;}
if(item.Type=="Program"){return"livetvprogram.html?id="+id;}
if(item.Type=="Series"){return"itemdetails.html?id="+id;}
if(item.Type=="Season"){return"itemdetails.html?id="+id;}
if(item.Type=="BoxSet"){return"itemdetails.html?id="+id;}
if(item.Type=="MusicAlbum"){return"itemdetails.html?id="+id;}
if(item.Type=="GameSystem"){return"itemdetails.html?id="+id;}
if(item.Type=="Genre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="MusicGenre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="GameGenre"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Studio"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Person"){return"itembynamedetails.html?id="+id;}
if(item.Type=="Recording"){return"livetvrecording.html?id="+id;}
if(item.Type=="MusicArtist"){return"itembynamedetails.html?id="+id;}
if(item.IsFolder){return id?"itemlist.html?parentId="+id:"#";}
return"itemdetails.html?id="+id;},getImageUrl:function(item,type,index,options){options=options||{};options.type=type;options.index=index;if(type=='Backdrop'){options.tag=item.BackdropImageTags[index];}else if(type=='Screenshot'){options.tag=item.ScreenshotImageTags[index];}else if(type=='Primary'){options.tag=item.PrimaryImageTag||item.ImageTags[type];}else{options.tag=item.ImageTags[type];}
return ApiClient.getScaledImageUrl(item.Id||item.ItemId,options);},getListViewIndex:function(item,options){if(options.index=='disc'){return item.ParentIndexNumber==null?'':Globalize.translate('ValueDiscNumber',item.ParentIndexNumber);}
var sortBy=(options.sortBy||'').toLowerCase();var code,name;if(sortBy.indexOf('sortname')==0){if(item.Type=='Episode')return'';name=(item.SortName||item.Name||'?')[0].toUpperCase();code=name.charCodeAt(0);if(code<65||code>90){return'#';}
return name.toUpperCase();}
if(sortBy.indexOf('officialrating')==0){return item.OfficialRating||Globalize.translate('HeaderUnrated');}
if(sortBy.indexOf('communityrating')==0){if(item.CommunityRating==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.CommunityRating);}
if(sortBy.indexOf('criticrating')==0){if(item.CriticRating==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.CriticRating);}
if(sortBy.indexOf('metascore')==0){if(item.Metascore==null){return Globalize.translate('HeaderUnrated');}
return Math.floor(item.Metascore);}
if(sortBy.indexOf('albumartist')==0){if(!item.AlbumArtist)return'';name=item.AlbumArtist[0].toUpperCase();code=name.charCodeAt(0);if(code<65||code>90){return'#';}
return name.toUpperCase();}
return'';},getUserDataCssClass:function(key){if(!key)return'';return'libraryItemUserData'+key.replace(new RegExp(' ','g'),'');},getListViewHtml:function(options){var outerHtml="";outerHtml+='<ul data-role="listview" class="itemsListview">';if(options.title){outerHtml+='<li data-role="list-divider">';outerHtml+=options.title;outerHtml+='</li>';}
var index=0;var groupTitle='';outerHtml+=options.items.map(function(item){var html='';if(options.showIndex!==false){var itemGroupTitle=LibraryBrowser.getListViewIndex(item,options);if(itemGroupTitle!=groupTitle){html+='<li data-role="list-divider">';html+=itemGroupTitle;html+='</li>';groupTitle=itemGroupTitle;}}
var dataAttributes=LibraryBrowser.getItemDataAttributes(item,options,index);var cssClass=options.smallIcon?'ui-li-has-icon listItem':'ui-li-has-thumb listItem';if(item.UserData){cssClass+=' '+LibraryBrowser.getUserDataCssClass(item.UserData.Key);}
var href=LibraryBrowser.getHref(item,options.context);html+='<li class="'+cssClass+'"'+dataAttributes+' data-itemid="'+item.Id+'" data-playlistitemid="'+(item.PlaylistItemId||'')+'" data-href="'+href+'">';var defaultAction=options.defaultAction;if(defaultAction=='play'||defaultAction=='playallfromhere'){if(item.PlayAccess!='Full'){defaultAction=null;}}
var defaultActionAttribute=defaultAction?(' data-action="'+defaultAction+'" class="itemWithAction"'):'';html+='<a'+defaultActionAttribute+' href="'+href+'">';var imgUrl;var downloadWidth=options.smallIcon?70:80;var minScale=item.Type=='Episode'||item.Type=='Game'||options.smallIcon?2:1.5;if(item.ImageTags.Primary){imgUrl=ApiClient.getScaledImageUrl(item.Id,{width:downloadWidth,tag:item.ImageTags.Primary,type:"Primary",index:0,minScale:minScale});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",width:downloadWidth,tag:item.AlbumPrimaryImageTag,minScale:minScale});}
else if(item.AlbumId&&item.SeriesPrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Primary",width:downloadWidth,tag:item.SeriesPrimaryImageTag,minScale:minScale});}
else if(item.ParentPrimaryImageTag){imgUrl=ApiClient.getImageUrl(item.ParentPrimaryImageItemId,{type:"Primary",width:downloadWidth,tag:item.ParentPrimaryImageTag,minScale:minScale});}
if(imgUrl){var minLazyIndex=16;if(options.smallIcon){if(index<minLazyIndex){html+='<div class="listviewIcon ui-li-icon" style="background-image:url(\''+imgUrl+'\');"></div>';}else{html+='<div class="listviewIcon ui-li-icon lazy" data-src="'+imgUrl+'"></div>';}}else{if(index<minLazyIndex){html+='<div class="listviewImage ui-li-thumb" style="background-image:url(\''+imgUrl+'\');"></div>';}else{html+='<div class="listviewImage ui-li-thumb lazy" data-src="'+imgUrl+'"></div>';}}}
var textlines=[];if(item.Type=='Episode'){textlines.push(item.SeriesName||'&nbsp;');}else if(item.Type=='MusicAlbum'){textlines.push(item.AlbumArtist||'&nbsp;');}
var displayName=LibraryBrowser.getPosterViewDisplayName(item);if(options.showIndexNumber&&item.IndexNumber!=null){displayName=item.IndexNumber+". "+displayName;}
textlines.push(displayName);if(item.Type=='Audio'){textlines.push(item.ArtistItems.map(function(a){return a.Name;}).join(', ')||'&nbsp;');}
if(item.Type=='Game'){textlines.push(item.GameSystem||'&nbsp;');}
else if(item.Type=='MusicGenre'){textlines.push('&nbsp;');}
else if(item.Type=='MusicArtist'){textlines.push('&nbsp;');}
else{textlines.push(LibraryBrowser.getMiscInfoHtml(item));}
html+='<h3>';html+=textlines[0];html+='</h3>';if(textlines.length>1){html+='<p>';html+=textlines[1];html+='</p>';}
html+='<div class="ui-li-aside">';html+=textlines[2]||LibraryBrowser.getRatingHtml(item,false);html+='</div>';if(item.Type=='Series'||item.Type=='Season'||item.Type=='BoxSet'||item.MediaType=='Video'){if(item.UserData.UnplayedItemCount){}else if(item.UserData.Played&&item.Type!='TvChannel'){html+='<div class="playedIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}}
html+='</a>';html+='<a href="#" data-icon="ellipsis-v" class="listviewMenuButton ui-btn ui-icon-ellipsis-v ui-btn-icon-notext ui-btn-inline">';html+='</a>';html+='</li>';index++;return html;}).join('');outerHtml+='</ul>';return outerHtml;},getItemDataAttributes:function(item,options,index){var atts=[];var itemCommands=LibraryBrowser.getItemCommands(item,options);atts.push('data-itemid="'+item.Id+'"');atts.push('data-commands="'+itemCommands.join(',')+'"');atts.push('data-context="'+(options.context||'')+'"');atts.push('data-itemtype="'+item.Type+'"');atts.push('data-mediatype="'+(item.MediaType||'')+'"');if(item.UserData.PlaybackPositionTicks){atts.push('data-positionticks="'+(item.UserData.PlaybackPositionTicks||0)+'"');}
atts.push('data-playaccess="'+(item.PlayAccess||'')+'"');atts.push('data-locationtype="'+(item.LocationType||'')+'"');atts.push('data-index="'+index+'"');var html=atts.join(' ');if(html){html=' '+html;}
return html;},getItemCommands:function(item,options){var itemCommands=[];if(item.Type!="Recording"&&item.Type!="Program"){itemCommands.push('edit');}
if(item.LocalTrailerCount){itemCommands.push('trailer');}
if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"||item.Type=="MusicGenre"){itemCommands.push('instantmix');}
if(item.IsFolder||item.Type=="MusicArtist"||item.Type=="MusicGenre"){itemCommands.push('shuffle');}
if(PlaylistManager.supportsPlaylists(item)){if(options.showRemoveFromPlaylist){itemCommands.push('removefromplaylist');}else{itemCommands.push('playlist');}}
if(BoxSetEditor.supportsAddingToCollection(item)){itemCommands.push('addtocollection');}
if(options.playFromHere){itemCommands.push('playfromhere');itemCommands.push('queuefromhere');}
if(item.Type=='Playlist'||item.Type=='BoxSet'){if(item.CanDelete){itemCommands.push('delete');}}
if(SyncManager.isAvailable(item)){itemCommands.push('sync');}
return itemCommands;},getPosterViewHtml:function(options){var items=options.items;var currentIndexValue;options.shape=options.shape||"portrait";var html="";var primaryImageAspectRatio;if(options.shape=='auto'||options.shape=='autohome'){primaryImageAspectRatio=LibraryBrowser.getAveragePrimaryImageAspectRatio(items);if(primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1.777777778)<.3){options.shape=options.shape=='auto'?'backdrop':'backdrop';}else if(primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1)<.33){options.coverImage=true;options.shape='square';}else if(primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-1.3333334)<.01){options.coverImage=true;options.shape='square';}else if(primaryImageAspectRatio&&primaryImageAspectRatio>1.9){options.shape='banner';options.coverImage=true;}else if(primaryImageAspectRatio&&Math.abs(primaryImageAspectRatio-0.6666667)<.2){options.shape=options.shape=='auto'?'portrait':'portrait';}else{options.shape=options.defaultShape||(options.shape=='auto'?'portrait':'portrait');}}
for(var i=0,length=items.length;i<length;i++){var item=items[i];primaryImageAspectRatio=LibraryBrowser.getAveragePrimaryImageAspectRatio([item]);if(options.showPremiereDateIndex){var futureDateText;if(item.PremiereDate){try{futureDateText=LibraryBrowser.getFutureDateText(parseISO8601Date(item.PremiereDate,{toLocal:true}),true);}catch(err){}}
var val=futureDateText||Globalize.translate('HeaderUnknownDate');if(val!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader" style="text-align:center;">'+val+'</h2>';currentIndexValue=val;}}
else if(options.showStartDateIndex){var futureDateText;if(item.StartDate){try{futureDateText=LibraryBrowser.getFutureDateText(parseISO8601Date(item.StartDate,{toLocal:true}),true);}catch(err){}}
var val=futureDateText||Globalize.translate('HeaderUnknownDate');if(val!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader" style="text-align:center;">'+val+'</h2>';currentIndexValue=val;}}else if(options.timeline){var year=item.ProductionYear||Globalize.translate('HeaderUnknownYear');if(year!=currentIndexValue){html+='<h2 class="timelineHeader detailSectionHeader">'+year+'</h2>';currentIndexValue=year;}}
var imgUrl=null;var background=null;var width=null;var height=null;var forceName=false;var downloadHeight=576;var enableImageEnhancers=options.enableImageEnhancers!==false;if(options.autoThumb&&item.ImageTags&&item.ImageTags.Primary&&item.PrimaryImageAspectRatio&&item.PrimaryImageAspectRatio>=1.5){height=400;width=primaryImageAspectRatio?Math.round(height*primaryImageAspectRatio):null;imgUrl=ApiClient.getImageUrl(item.Id,{type:"Primary",height:height,width:width,tag:item.ImageTags.Primary,enableImageEnhancers:enableImageEnhancers});}else if(options.autoThumb&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:downloadHeight,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(options.preferBackdrop&&item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:downloadHeight,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:downloadHeight,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(options.preferBanner&&item.ImageTags&&item.ImageTags.Banner){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Banner",maxWidth:700,tag:item.ImageTags.Banner,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.SeriesThumbImageTag&&options.inheritThumb!==false){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Thumb",maxWidth:downloadHeight,tag:item.SeriesThumbImageTag,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.ParentThumbItemId&&options.inheritThumb!==false){imgUrl=ApiClient.getThumbImageUrl(item.ParentThumbItemId,{type:"Thumb",maxWidth:downloadHeight,enableImageEnhancers:enableImageEnhancers});}else if(options.preferThumb&&item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:downloadHeight,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});forceName=true;}else if(item.ImageTags&&item.ImageTags.Primary){height=400;width=primaryImageAspectRatio?Math.round(height*primaryImageAspectRatio):null;imgUrl=ApiClient.getImageUrl(item.Id,{type:"Primary",height:height,width:width,tag:item.ImageTags.Primary,enableImageEnhancers:enableImageEnhancers});}
else if(item.ParentPrimaryImageTag){height=400;imgUrl=ApiClient.getImageUrl(item.ParentPrimaryImageItemId,{type:"Primary",height:height,tag:item.ParentPrimaryImageTag,enableImageEnhancers:enableImageEnhancers});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){height=220;width=primaryImageAspectRatio?Math.round(height*primaryImageAspectRatio):null;imgUrl=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:height,width:width,tag:item.AlbumPrimaryImageTag,enableImageEnhancers:enableImageEnhancers});}
else if(item.Type=='Season'&&item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:downloadHeight,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:downloadHeight,tag:item.BackdropImageTags[0],enableImageEnhancers:enableImageEnhancers});}else if(item.ImageTags&&item.ImageTags.Thumb){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:downloadHeight,tag:item.ImageTags.Thumb,enableImageEnhancers:enableImageEnhancers});}else if(item.SeriesThumbImageTag){imgUrl=ApiClient.getScaledImageUrl(item.SeriesId,{type:"Thumb",maxWidth:downloadHeight,tag:item.SeriesThumbImageTag,enableImageEnhancers:enableImageEnhancers});}else if(item.ParentThumbItemId){imgUrl=ApiClient.getThumbImageUrl(item,{type:"Thumb",maxWidth:downloadHeight,enableImageEnhancers:enableImageEnhancers});}else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"){if(item.Name&&options.showTitle){imgUrl='css/images/items/list/audio.png';}
background=defaultBackground;}else if(item.Type=="Recording"||item.Type=="Program"||item.Type=="TvChannel"){if(item.Name&&options.showTitle){imgUrl='css/images/items/list/collection.png';}
background=defaultBackground;}else if(item.MediaType=="Video"||item.Type=="Season"||item.Type=="Series"){if(item.Name&&options.showTitle){imgUrl='css/images/items/list/video.png';}
background=defaultBackground;}else if(item.Type=="Person"){if(item.Name&&options.showTitle){imgUrl='css/images/items/list/person.png';}
background=defaultBackground;}else{if(item.Name&&options.showTitle){imgUrl='css/images/items/list/collection.png';}
background=defaultBackground;}
var cssClass="card";if(options.transparent!==false){cssClass+=" transparentCard";}
cssClass+=' '+options.shape+'Card';var mediaSourceCount=item.MediaSourceCount||1;var href=options.linkItem===false?'#':LibraryBrowser.getHref(item,options.context);if(item.UserData){cssClass+=' '+LibraryBrowser.getUserDataCssClass(item.UserData.Key);}
if(options.showChildCountIndicator&&item.ChildCount){cssClass+=' groupedCard';}
if(options.showTitle&&!options.overlayText){cssClass+=' bottomPaddedCard';}
var dataAttributes=LibraryBrowser.getItemDataAttributes(item,options,i);var defaultAction=options.defaultAction;if(defaultAction=='play'||defaultAction=='playallfromhere'){if(item.PlayAccess!='Full'){defaultAction=null;}}
var defaultActionAttribute=defaultAction?(' data-action="'+defaultAction+'"'):'';html+='<div'+dataAttributes+' class="'+cssClass+'">';var style="";if(imgUrl&&!options.lazy){style+='background-image:url(\''+imgUrl+'\');';}
if(background){style+="background-color:"+background+";";}
var imageCssClass='cardImage';if(options.coverImage){imageCssClass+=" coveredCardImage";}
if(options.centerImage){imageCssClass+=" centeredCardImage";}
var dataSrc="";if(options.lazy&&imgUrl){imageCssClass+=" lazy";dataSrc=' data-src="'+imgUrl+'"';}
var cardboxCssClass='cardBox';if(options.cardLayout){cardboxCssClass+=' visualCardBox';}
html+='<div class="'+cardboxCssClass+'">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var anchorCssClass="cardContent";if(options.defaultAction){anchorCssClass+=' itemWithAction';}
html+='<a class="'+anchorCssClass+'" href="'+href+'"'+defaultActionAttribute+'>';html+='<div class="'+imageCssClass+'" style="'+style+'"'+dataSrc+'></div>';html+='<div class="cardOverlayTarget"></div>';if(item.LocationType=="Offline"||item.LocationType=="Virtual"){if(options.showLocationTypeIndicator!==false){html+=LibraryBrowser.getOfflineIndicatorHtml(item);}}else if(options.showUnplayedIndicator!==false){html+=LibraryBrowser.getPlayedIndicatorHtml(item);}else if(options.showChildCountIndicator){html+=LibraryBrowser.getGroupCountIndicator(item);}
if(mediaSourceCount>1){html+='<div class="mediaSourceIndicator">'+mediaSourceCount+'</div>';}
if(item.IsUnidentified){html+='<div class="unidentifiedIndicator"><div class="ui-icon-alert ui-btn-icon-notext"></div></div>';}
var progressHtml=options.showProgress===false||item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));var footerOverlayed=false;if(options.overlayText||(forceName&&!options.showTitle)){html+=LibraryBrowser.getCardFooterText(item,options,imgUrl,forceName,'cardFooter',progressHtml);footerOverlayed=true;}
else if(progressHtml){html+='<div class="cardFooter">';html+="<div class='cardProgress cardText'>";html+=progressHtml;html+="</div>";html+="</div>";progressHtml='';}
html+='</a>';html+='</div>';if(!options.overlayText&&!footerOverlayed){html+=LibraryBrowser.getCardFooterText(item,options,imgUrl,forceName,'cardFooter outerCardFooter',progressHtml);}
html+='</div>';html+="</div>";}
return html;},getCardFooterText:function(item,options,imgUrl,forceName,footerClass,progressHtml){var html='';html+='<div class="'+footerClass+'">';if(options.cardLayout){html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="listviewMenuButton ui-btn ui-icon-ellipsis-v ui-btn-icon-notext ui-btn-inline ui-shadow ui-corner-all" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 4px 0 0;"></button>';html+="</div>";}
var name=LibraryBrowser.getPosterViewDisplayName(item,options.displayAsSpecial);if(!imgUrl&&!options.showTitle){html+="<div class='cardDefaultText'>";html+=htmlEncode(name);html+="</div>";}
var cssClass=options.centerText?"cardText cardTextCentered":"cardText";var lines=[];if(options.showParentTitle){lines.push(item.EpisodeTitle?item.Name:(item.SeriesName||item.Album||item.AlbumArtist||item.GameSystem||""));}
if(options.showTitle||forceName){lines.push(htmlEncode(name));}
if(options.showItemCounts){var itemCountHtml=LibraryBrowser.getItemCountsHtml(options,item);lines.push(itemCountHtml);}
if(options.textLines){var additionalLines=options.textLines(item);for(var i=0,length=additionalLines.length;i<length;i++){lines.push(additionalLines[i]);}}
if(options.showSongCount){var songLine='';if(item.SongCount){songLine=item.SongCount==1?Globalize.translate('ValueOneSong'):Globalize.translate('ValueSongCount',item.SongCount);}
lines.push(songLine);}
if(options.showPremiereDate&&item.PremiereDate){try{lines.push(LibraryBrowser.getPremiereDateText(item));}catch(err){lines.push('');}}
if(options.showYear){lines.push(item.ProductionYear||'');}
if(options.showSeriesYear){if(item.Status=="Continuing"){lines.push(Globalize.translate('ValueSeriesYearToPresent',item.ProductionYear||''));}else{lines.push(item.ProductionYear||'');}}
if(options.showProgramAirInfo){var date=parseISO8601Date(item.StartDate,{toLocal:true});var text=item.StartDate?date.toLocaleString():'';lines.push(text||'&nbsp;');lines.push(item.ChannelName||'&nbsp;');}
html+=LibraryBrowser.getCardTextLines(lines,cssClass,!options.overlayText);if(options.overlayText){if(progressHtml){html+="<div class='cardText cardProgress'>";html+=progressHtml;html+="</div>";}}
html+="</div>";return html;},getCardTextLines:function(lines,cssClass,forceLines){var html='';var valid=0;var i,length;for(i=0,length=lines.length;i<length;i++){var text=lines[i];if(text){html+="<div class='"+cssClass+"'>";html+=text;html+="</div>";valid++;}}
if(forceLines){while(valid<length){html+="<div class='"+cssClass+"'>&nbsp;</div>";valid++;}}
return html;},getFutureDateText:function(date){var weekday=[];weekday[0]=Globalize.translate('OptionSunday');weekday[1]=Globalize.translate('OptionMonday');weekday[2]=Globalize.translate('OptionTuesday');weekday[3]=Globalize.translate('OptionWednesday');weekday[4]=Globalize.translate('OptionThursday');weekday[5]=Globalize.translate('OptionFriday');weekday[6]=Globalize.translate('OptionSaturday');var day=weekday[date.getDay()];date=date.toLocaleDateString();if(date.toLowerCase().indexOf(day.toLowerCase())==-1){return day+" "+date;}
return date;},getPremiereDateText:function(item,date){if(!date){var text='';if(item.AirTime){text+=item.AirTime;}
if(item.SeriesStudio){if(text){text+=" on "+item.SeriesStudio;}else{text+=item.SeriesStudio;}}
return text;}
var day=LibraryBrowser.getFutureDateText(date);if(item.AirTime){day+=" at "+item.AirTime;}
if(item.SeriesStudio){day+=" on "+item.SeriesStudio;}
return day;},getPosterViewDisplayName:function(item,displayAsSpecial,includeParentInfo){if(!item){throw new Error("null item passed into getPosterViewDisplayName");}
var name=item.EpisodeTitle||item.Name;if(item.Type=="TvChannel"){if(item.Number){return item.Number+' '+name;}
return name;}
if(displayAsSpecial&&item.Type=="Episode"&&item.ParentIndexNumber==0){name=Globalize.translate('ValueSpecialEpisodeName',name);}else if(item.Type=="Episode"&&item.IndexNumber!=null&&item.ParentIndexNumber!=null){var displayIndexNumber=item.IndexNumber;var number="E"+displayIndexNumber;if(includeParentInfo!==false){number="S"+item.ParentIndexNumber+", "+number;}
if(item.IndexNumberEnd){displayIndexNumber=item.IndexNumberEnd;number+="-"+displayIndexNumber;}
name=number+" - "+name;}
return name;},getOfflineIndicatorHtml:function(item){if(item.LocationType=="Offline"){return'<div class="posterRibbon offlinePosterRibbon">'+Globalize.translate('HeaderOffline')+'</div>';}
try{var date=parseISO8601Date(item.PremiereDate,{toLocal:true});if(item.PremiereDate&&(new Date().getTime()<date.getTime())){return'<div class="posterRibbon unairedPosterRibbon">'+Globalize.translate('HeaderUnaired')+'</div>';}}catch(err){}
if(item.IsFolder){return'';}
return'<div class="posterRibbon missingPosterRibbon">'+Globalize.translate('HeaderMissing')+'</div>';},getPlayedIndicatorHtml:function(item){if(item.Type=="Series"||item.Type=="Season"||item.Type=="BoxSet"||item.MediaType=="Video"||item.MediaType=="Game"||item.MediaType=="Book"){if(item.UserData.UnplayedItemCount){return'<div class="playedIndicator">'+item.UserData.UnplayedItemCount+'</div>';}
if(item.Type!='TvChannel'){if(item.UserData.PlayedPercentage&&item.UserData.PlayedPercentage>=100||(item.UserData&&item.UserData.Played)){return'<div class="playedIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}}}
return'';},getGroupCountIndicator:function(item){if(item.ChildCount){return'<div class="playedIndicator">'+item.ChildCount+'</div>';}
return'';},getAveragePrimaryImageAspectRatio:function(items){var values=[];for(var i=0,length=items.length;i<length;i++){var ratio=items[i].PrimaryImageAspectRatio||0;if(!ratio){continue;}
values[values.length]=ratio;}
if(!values.length){return null;}
values.sort(function(a,b){return a-b;});var half=Math.floor(values.length/2);var result;if(values.length%2)
result=values[half];else
result=(values[half-1]+values[half])/2.0;if(Math.abs(0.66666666667-result)<=.15){return 0.66666666667;}
if(Math.abs(1.777777778-result)<=.2){return 1.777777778;}
if(Math.abs(1-result)<=.15){return 1;}
if(Math.abs(1.33333333333-result)<=.15){return 1.33333333333;}
return result;},metroColors:["#6FBD45","#4BB3DD","#4164A5","#E12026","#800080","#E1B222","#008040","#0094FF","#FF00C7","#FF870F","#7F0037"],getRandomMetroColor:function(){var index=Math.floor(Math.random()*(LibraryBrowser.metroColors.length-1));return LibraryBrowser.metroColors[index];},getMetroColor:function(str){if(str){var character=String(str.substr(0,1).charCodeAt());var sum=0;for(var i=0;i<character.length;i++){sum+=parseInt(character.charAt(i));}
var index=String(sum).substr(-1);return LibraryBrowser.metroColors[index];}else{return LibraryBrowser.getRandomMetroColor();}},renderName:function(item,nameElem,linkToElement,context){var name=LibraryBrowser.getPosterViewDisplayName(item,false,false);Dashboard.setPageTitle(name);if(linkToElement){nameElem.html('<a class="detailPageParentLink" href="'+LibraryBrowser.getHref(item,context)+'">'+name+'</a>').trigger('create');}else{nameElem.html(name);}},renderParentName:function(item,parentNameElem,context){var html=[];var contextParam=context?('&context='+context):'';if(item.AlbumArtists){html.push(LibraryBrowser.getArtistLinksHtml(item.AlbumArtists,"detailPageParentLink"));}else if(item.ArtistItems&&item.ArtistItems.length&&item.Type=="MusicVideo"){html.push(LibraryBrowser.getArtistLinksHtml(item.ArtistItems,"detailPageParentLink"));}else if(item.SeriesName&&item.Type=="Episode"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeriesId+contextParam+'">'+item.SeriesName+'</a>');}
if(item.SeriesName&&item.Type=="Season"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeriesId+contextParam+'">'+item.SeriesName+'</a>');}else if(item.ParentIndexNumber!=null&&item.Type=="Episode"){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.SeasonId+contextParam+'">'+item.SeasonName+'</a>');}else if(item.Album&&item.Type=="Audio"&&(item.AlbumId||item.ParentId)){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+(item.AlbumId||item.ParentId)+contextParam+'">'+item.Album+'</a>');}else if(item.Album&&item.Type=="MusicVideo"&&item.AlbumId){html.push('<a class="detailPageParentLink" href="itemdetails.html?id='+item.AlbumId+contextParam+'">'+item.Album+'</a>');}else if(item.Album){html.push(item.Album);}
if(html.length){parentNameElem.show().html(html.join(' - ')).trigger('create');}else{parentNameElem.hide();}},renderLinks:function(linksElem,item){var links=[];if(item.HomePageUrl){links.push('<a class="textlink" href="'+item.HomePageUrl+'" target="_blank">'+Globalize.translate('ButtonWebsite')+'</a>');}
if(item.ExternalUrls){for(var i=0,length=item.ExternalUrls.length;i<length;i++){var url=item.ExternalUrls[i];links.push('<a class="textlink" href="'+url.Url+'" target="_blank">'+url.Name+'</a>');}}
if(links.length){var html=links.join('&nbsp;&nbsp;/&nbsp;&nbsp;');html=Globalize.translate('ValueLinks',html);$(linksElem).html(html).trigger('create');}else{$(linksElem).hide();}},getDefaultPageSizeSelections:function(){return[20,50,100,200,300,400,500];},getQueryPagingHtml:function(options){var startIndex=options.startIndex;var limit=options.limit;var totalRecordCount=options.totalRecordCount;if(limit&&options.updatePageSizeSetting!==false){try{store.setItem(options.pageSizeKey||pageSizeKey,limit);}catch(e){}}
var html='';var recordsEnd=Math.min(startIndex+limit,totalRecordCount);var showControls=totalRecordCount>20||limit<totalRecordCount;html+='<div class="listPaging">';html+='<span style="margin-right: 10px;vertical-align:middle;">';var startAtDisplay=totalRecordCount?startIndex+1:0;html+=startAtDisplay+'-'+recordsEnd+' of '+totalRecordCount;html+='</span>';if(showControls||options.viewButton||options.addSelectionButton||options.additionalButtonsHtml){html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">';if(showControls){html+='<button data-icon="arrow-l" data-iconpos="notext" data-inline="true" data-mini="true" class="btnPreviousPage" '+(startIndex?'':'disabled')+'>'+Globalize.translate('ButtonPreviousPage')+'</button>';html+='<button data-icon="arrow-r" data-iconpos="notext" data-inline="true" data-mini="true" class="btnNextPage" '+(startIndex+limit>=totalRecordCount?'disabled':'')+'>'+Globalize.translate('ButtonNextPage')+'</button>';}
html+=(options.additionalButtonsHtml||'');if(options.addSelectionButton){html+='<button data-mini="true" data-icon="check" data-inline="true" data-iconpos="notext" title="'+Globalize.translate('ButtonSelect')+'" class="btnToggleSelections">'+Globalize.translate('ButtonSelect')+'</button>';}
if(options.viewButton){html+='<button data-icon="ellipsis-v" data-iconpos="notext" data-inline="true" data-mini="true" onclick="$(\'.viewPanel\', $(this).parents(\'.page\')).panel(\'toggle\');">'+Globalize.translate('ButtonView')+'</button>';}
html+='</div>';if(showControls&&options.showLimit!==false){var id="selectPageSize";var pageSizes=options.pageSizes||LibraryBrowser.getDefaultPageSizeSelections();var optionsHtml=pageSizes.map(function(val){if(limit==val){return'<option value="'+val+'" selected="selected">'+val+'</option>';}else{return'<option value="'+val+'">'+val+'</option>';}}).join('');html+='<div class="pageSizeContainer"><label style="font-size:inherit;" class="labelPageSize" for="'+id+'">'+Globalize.translate('LabelLimit')+'</label><select class="selectPageSize" id="'+id+'" data-inline="true" data-mini="true">'+optionsHtml+'</select></div>';}}
html+='</div>';return html;},getPagingHtml:function(query,totalRecordCount,updatePageSizeSetting,pageSizes,showLimit){if(query.Limit&&updatePageSizeSetting!==false){try{store.setItem(pageSizeKey,query.Limit);}catch(e){}}
var html='';var recordsEnd=Math.min(query.StartIndex+query.Limit,totalRecordCount);var showControls=totalRecordCount>20||query.Limit<totalRecordCount;html+='<div class="listPaging">';html+='<span style="margin-right: 10px;vertical-align:middle;">';var startAtDisplay=totalRecordCount?query.StartIndex+1:0;html+=startAtDisplay+'-'+recordsEnd+' of '+totalRecordCount;html+='</span>';if(showControls){html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">';html+='<button type="button" data-icon="arrow-l" data-iconpos="notext" data-inline="true" data-mini="true" class="btnPreviousPage" '+(query.StartIndex?'':'disabled')+'>'+Globalize.translate('ButtonPreviousPage')+'</button>';html+='<button type="button" data-icon="arrow-r" data-iconpos="notext" data-inline="true" data-mini="true" class="btnNextPage" '+(query.StartIndex+query.Limit>=totalRecordCount?'disabled':'')+'>'+Globalize.translate('ButtonNextPage')+'</button>';html+='</div>';if(showLimit!==false){var id="selectPageSize"+new Date().getTime();var options='';function getOption(val){if(query.Limit==val){return'<option value="'+val+'" selected="selected">'+val+'</option>';}else{return'<option value="'+val+'">'+val+'</option>';}}
pageSizes=pageSizes||[20,50,100,200,300,400,500];for(var j=0,length=pageSizes.length;j<length;j++){options+=getOption(pageSizes[j]);}
html+='<div class="pageSizeContainer"><label style="font-size:inherit;" class="labelPageSize" for="'+id+'">'+Globalize.translate('LabelLimit')+'</label><select class="selectPageSize" id="'+id+'" data-inline="true" data-mini="true">'+options+'</select></div>';}}
html+='</div>';return html;},getRatingHtml:function(item,metascore){var html="";if(item.CommunityRating){html+="<div class='starRating' title='"+item.CommunityRating+"'></div>";html+='<div class="starRatingValue">';html+=item.CommunityRating.toFixed(1);html+='</div>';}
if(item.CriticRating!=null){if(item.CriticRating>=60){html+='<div class="fresh rottentomatoesicon" title="Rotten Tomatoes"></div>';}else{html+='<div class="rotten rottentomatoesicon" title="Rotten Tomatoes"></div>';}
html+='<div class="criticRating" title="Rotten Tomatoes">'+item.CriticRating+'%</div>';}
if(item.Metascore&&metascore!==false){if(item.Metascore>=60){html+='<div class="metascore metascorehigh" title="Metascore">'+item.Metascore+'</div>';}
else if(item.Metascore>=40){html+='<div class="metascore metascoremid" title="Metascore">'+item.Metascore+'</div>';}else{html+='<div class="metascore metascorelow" title="Metascore">'+item.Metascore+'</div>';}}
return html;},getItemProgressBarHtml:function(item){if(item.Type=="Recording"&&item.CompletionPercentage){return'<progress class="itemProgressBar recordingProgressBar" min="0" max="100" value="'+item.CompletionPercentage+'"></progress>';}
var pct=item.PlayedPercentage;if(pct&&pct<100){return'<progress class="itemProgressBar" min="0" max="100" value="'+pct+'"></progress>';}
return null;},getUserDataButtonHtml:function(method,itemId,btnCssClass,icon,tooltip){btnCssClass+=" imageButton";return'<button data-itemid="'+itemId+'" class="'+btnCssClass+'" type="button" onclick="LibraryBrowser.'+method+'(this);return false;" title="'+tooltip+'"><div class="fa '+icon+'"></div></button>';},getUserDataIconsHtml:function(item){var html='';var userData=item.UserData||{};var itemId=item.Id;var type=item.Type;var tooltipPlayed=Globalize.translate('TooltipPlayed');if((item.MediaType||item.IsFolder)&&type!="TvChannel"&&type!="MusicArtist"){if(userData.Played){html+=LibraryBrowser.getUserDataButtonHtml('markPlayed',itemId,'btnUserItemRating btnUserItemRating','fa-check',tooltipPlayed);}else{html+=LibraryBrowser.getUserDataButtonHtml('markPlayed',itemId,'btnUserItemRating btnUserItemRatingOff','fa-check',tooltipPlayed);}}
var tooltipLike=Globalize.translate('TooltipLike');var tooltipDislike=Globalize.translate('TooltipDislike');if(typeof userData.Likes=="undefined"){html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating btnUserItemRatingOff','fa-thumbs-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating btnUserItemRatingOff','fa-thumbs-up',tooltipLike);}
else if(userData.Likes){html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating btnUserItemRatingOff','fa-thumbs-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating','fa-thumbs-up',tooltipLike);}
else{html+=LibraryBrowser.getUserDataButtonHtml('markDislike',itemId,'btnUserItemRating','fa-thumbs-down',tooltipDislike);html+=LibraryBrowser.getUserDataButtonHtml('markLike',itemId,'btnUserItemRating btnUserItemRatingOff','fa-thumbs-up',tooltipLike);}
var tooltipFavorite=Globalize.translate('TooltipFavorite');if(userData.IsFavorite){html+=LibraryBrowser.getUserDataButtonHtml('markFavorite',itemId,'btnUserItemRating','fa-heart',tooltipFavorite);}else{html+=LibraryBrowser.getUserDataButtonHtml('markFavorite',itemId,'btnUserItemRating btnUserItemRatingOff','fa-heart',tooltipFavorite);}
return html;},markPlayed:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);var markAsPlayed=$link.hasClass('btnUserItemRatingOff');if(markAsPlayed){ApiClient.markPlayed(Dashboard.getCurrentUserId(),id);$link.removeClass('btnUserItemRatingOff');}else{ApiClient.markUnplayed(Dashboard.getCurrentUserId(),id);$link.addClass('btnUserItemRatingOff');}},markFavorite:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);var markAsFavorite=$link.hasClass('btnUserItemRatingOff');ApiClient.updateFavoriteStatus(Dashboard.getCurrentUserId(),id,markAsFavorite);if(markAsFavorite){$link.removeClass('btnUserItemRatingOff');}else{$link.addClass('btnUserItemRatingOff');}},markLike:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);if($link.hasClass('btnUserItemRatingOff')){ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),id,true);$link.removeClass('btnUserItemRatingOff');}else{ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),id);$link.addClass('btnUserItemRatingOff');}
$link.prev().addClass('btnUserItemRatingOff');},markDislike:function(link){var id=link.getAttribute('data-itemid');var $link=$(link);if($link.hasClass('btnUserItemRatingOff')){ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),id,false);$link.removeClass('btnUserItemRatingOff');}else{ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),id);$link.addClass('btnUserItemRatingOff');}
$link.next().addClass('btnUserItemRatingOff');},getDetailImageHtml:function(item,href,preferThumb){var imageTags=item.ImageTags||{};if(item.PrimaryImageTag){imageTags.Primary=item.PrimaryImageTag;}
var html='';var url;var imageHeight=360;if(preferThumb&&imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});}
else if(imageTags.Primary){url=ApiClient.getScaledImageUrl(item.Id,{type:"Primary",height:imageHeight,tag:item.ImageTags.Primary});}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){url=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",height:imageHeight,tag:item.BackdropImageTags[0]});}
else if(imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});}
else if(imageTags.Disc){url=ApiClient.getScaledImageUrl(item.Id,{type:"Disc",height:imageHeight,tag:item.ImageTags.Disc});}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){url=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:imageHeight,tag:item.AlbumPrimaryImageTag});}
else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicGenre"){url="css/images/items/detail/audio.png";}
else if(item.MediaType=="Game"||item.Type=="GameGenre"){url="css/images/items/detail/game.png";}
else if(item.Type=="Person"){url="css/images/items/detail/person.png";}
else if(item.Type=="Genre"||item.Type=="Studio"){url="css/images/items/detail/video.png";}
else if(item.Type=="TvChannel"){url="css/images/items/detail/tv.png";}
else{url="css/images/items/detail/video.png";}
html+='<div style="position:relative;">';if(href){html+="<a class='itemDetailGalleryLink' href='"+href+"'>";}
html+="<img class='itemDetailImage' src='"+url+"' />";if(href){html+="</a>";}
var progressHtml=item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));if(progressHtml){html+='<div class="detailImageProgressContainer">';html+=progressHtml;html+="</div>";}
html+="</div>";return html;},renderDetailImage:function(elem,item,href,preferThumb){var imageTags=item.ImageTags||{};if(item.PrimaryImageTag){imageTags.Primary=item.PrimaryImageTag;}
var html='';var url;var shape='portrait';var imageHeight=360;var detectRatio=false;if(preferThumb&&imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});shape='thumb';}
else if(imageTags.Primary){url=ApiClient.getScaledImageUrl(item.Id,{type:"Primary",height:imageHeight,tag:item.ImageTags.Primary});detectRatio=true;}
else if(item.BackdropImageTags&&item.BackdropImageTags.length){url=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",height:imageHeight,tag:item.BackdropImageTags[0]});shape='thumb';}
else if(imageTags.Thumb){url=ApiClient.getScaledImageUrl(item.Id,{type:"Thumb",height:imageHeight,tag:item.ImageTags.Thumb});shape='thumb';}
else if(imageTags.Disc){url=ApiClient.getScaledImageUrl(item.Id,{type:"Disc",height:imageHeight,tag:item.ImageTags.Disc});shape='square';}
else if(item.AlbumId&&item.AlbumPrimaryImageTag){url=ApiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",height:imageHeight,tag:item.AlbumPrimaryImageTag});shape='square';}
else if(item.MediaType=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicGenre"){url="css/images/items/detail/audio.png";shape='square';}
else if(item.MediaType=="Game"||item.Type=="GameGenre"){url="css/images/items/detail/game.png";shape='square';}
else if(item.Type=="Person"){url="css/images/items/detail/person.png";shape='square';}
else if(item.Type=="Genre"||item.Type=="Studio"){url="css/images/items/detail/video.png";shape='square';}
else if(item.Type=="TvChannel"){url="css/images/items/detail/tv.png";shape='square';}
else{url="css/images/items/detail/video.png";shape='square';}
html+='<div style="position:relative;">';if(href){html+="<a class='itemDetailGalleryLink' href='"+href+"'>";}
if(detectRatio&&item.PrimaryImageAspectRatio){if(item.PrimaryImageAspectRatio>=1.48){shape='thumb';}else if(item.PrimaryImageAspectRatio>=.85&&item.PrimaryImageAspectRatio<=1.34){shape='square';}}
html+="<img class='itemDetailImage' src='"+url+"' />";if(href){html+="</a>";}
var progressHtml=item.IsFolder?'':LibraryBrowser.getItemProgressBarHtml((item.Type=='Recording'?item:item.UserData));if(progressHtml){html+='<div class="detailImageProgressContainer">';html+=progressHtml;html+="</div>";}
html+="</div>";elem.html(html);var page=$(elem).parents('.page');var detailContentEffectedByImage=$('.detailContentEffectedByImage',page);if(shape=='thumb'){detailContentEffectedByImage.addClass('detailContentEffectedByThumbImage');detailContentEffectedByImage.removeClass('detailContentEffectedBySquareImage');detailContentEffectedByImage.removeClass('detailContentEffectedByPortraitImage');elem.addClass('thumbDetailImageContainer');elem.removeClass('portraitDetailImageContainer');elem.removeClass('squareDetailImageContainer');}
else if(shape=='square'){detailContentEffectedByImage.removeClass('detailContentEffectedByThumbImage');detailContentEffectedByImage.addClass('detailContentEffectedBySquareImage');detailContentEffectedByImage.removeClass('detailContentEffectedByPortraitImage');elem.removeClass('thumbDetailImageContainer');elem.removeClass('portraitDetailImageContainer');elem.addClass('squareDetailImageContainer');}else{detailContentEffectedByImage.removeClass('detailContentEffectedByThumbImage');detailContentEffectedByImage.removeClass('detailContentEffectedBySquareImage');detailContentEffectedByImage.addClass('detailContentEffectedByPortraitImage');elem.removeClass('thumbDetailImageContainer');elem.addClass('portraitDetailImageContainer');elem.removeClass('squareDetailImageContainer');}},getMiscInfoHtml:function(item){var miscInfo=[];var text,date;if(item.Type=="Episode"||item.MediaType=='Photo'){if(item.PremiereDate){try{date=parseISO8601Date(item.PremiereDate,{toLocal:true});text=date.toLocaleDateString();miscInfo.push(text);}
catch(e){console.log("Error parsing date: "+item.PremiereDate);}}}
if(item.StartDate){try{date=parseISO8601Date(item.StartDate,{toLocal:true});text=date.toLocaleDateString();miscInfo.push(text);if(item.Type!="Recording"){text=LiveTvHelpers.getDisplayTime(date);miscInfo.push(text);}}
catch(e){console.log("Error parsing date: "+item.PremiereDate);}}
if(item.ProductionYear&&item.Type=="Series"){if(item.Status=="Continuing"){miscInfo.push(Globalize.translate('ValueSeriesYearToPresent',item.ProductionYear));}
else if(item.ProductionYear){text=item.ProductionYear;if(item.EndDate){try{var endYear=parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();if(endYear!=item.ProductionYear){text+="-"+parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();}}
catch(e){console.log("Error parsing date: "+item.EndDate);}}
miscInfo.push(text);}}
if(item.Type!="Series"&&item.Type!="Episode"&&item.MediaType!='Photo'){if(item.ProductionYear){miscInfo.push(item.ProductionYear);}
else if(item.PremiereDate){try{text=parseISO8601Date(item.PremiereDate,{toLocal:true}).getFullYear();miscInfo.push(text);}
catch(e){console.log("Error parsing date: "+item.PremiereDate);}}}
var minutes;if(item.RunTimeTicks&&item.Type!="Series"){if(item.Type=="Audio"){miscInfo.push(Dashboard.getDisplayTime(item.RunTimeTicks));}else{minutes=item.RunTimeTicks/600000000;minutes=minutes||1;miscInfo.push(Math.round(minutes)+"min");}}
if(item.OfficialRating&&item.Type!=="Season"&&item.Type!=="Episode"){miscInfo.push(item.OfficialRating);}
if(item.Video3DFormat){miscInfo.push("3D");}
if(item.MediaType=='Photo'&&item.Width&&item.Height){miscInfo.push(item.Width+"x"+item.Height);}
return miscInfo.join('&nbsp;&nbsp;&nbsp;&nbsp;');},renderOverview:function(elem,item){var overview=item.Overview||'';elem.html(overview).trigger('create');$('a',elem).each(function(){$(this).attr("target","_blank");});if(overview){elem.removeClass('empty');}else{elem.addClass('empty');}},renderStudios:function(elem,item,context){if(item.Studios&&item.Studios.length&&item.Type!="Series"){var html='';for(var i=0,length=item.Studios.length;i<length;i++){if(i>0){html+='&nbsp;&nbsp;/&nbsp;&nbsp;';}
html+='<a class="textlink" href="itembynamedetails.html?context='+context+'&id='+item.Studios[i].Id+'">'+item.Studios[i].Name+'</a>';}
var translationKey=item.Studios.length>1?"ValueStudios":"ValueStudio";html=Globalize.translate(translationKey,html);elem.show().html(html).trigger('create');}else{elem.hide();}},renderGenres:function(elem,item,context,limit){var html='';var genres=item.Genres||[];for(var i=0,length=genres.length;i<length;i++){if(limit&&i>=limit){break;}
if(i>0){html+='<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>';}
var param=item.Type=="Audio"||item.Type=="MusicArtist"||item.Type=="MusicAlbum"?"musicgenre":"genre";if(item.MediaType=="Game"){param="gamegenre";}
html+='<a class="textlink" href="itembynamedetails.html?context='+context+'&'+param+'='+ApiClient.encodeName(genres[i])+'">'+genres[i]+'</a>';}
elem.html(html).trigger('create');},renderPremiereDate:function(elem,item){if(item.PremiereDate){try{var date=parseISO8601Date(item.PremiereDate,{toLocal:true});var translationKey=new Date().getTime()>date.getTime()?"ValuePremiered":"ValuePremieres";elem.show().html(Globalize.translate(translationKey,date.toLocaleDateString()));}catch(err){elem.hide();}}else{elem.hide();}},renderBudget:function(elem,item){if(item.Budget){elem.show().html(Globalize.translate('ValueBudget','$'+item.Budget));}else{elem.hide();}},renderRevenue:function(elem,item){if(item.Revenue){elem.show().html(Globalize.translate('ValueRevenue','$'+item.Revenue));}else{elem.hide();}},renderAwardSummary:function(elem,item){if(item.AwardSummary){elem.show().html(Globalize.translate('ValueAwards',item.AwardSummary));}else{elem.hide();}},renderDetailPageBackdrop:function(page,item){var screenWidth=Math.max(screen.height,screen.width);var imgUrl;if(item.BackdropImageTags&&item.BackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:screenWidth,tag:item.BackdropImageTags[0]});$('#itemBackdrop',page).removeClass('noBackdrop').css('background-image','url("'+imgUrl+'")');}
else if(item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){imgUrl=ApiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:'Backdrop',index:0,tag:item.ParentBackdropImageTags[0],maxWidth:screenWidth});$('#itemBackdrop',page).removeClass('noBackdrop').css('background-image','url("'+imgUrl+'")');}
else{$('#itemBackdrop',page).addClass('noBackdrop').css('background-image','none');}}};})(window,document,jQuery,screen,window.store);(function($,document,window){var showOverlayTimeout;function onHoverOut(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
$('.cardOverlayTarget:visible',this).each(function(){var elem=this;$(this).animate({"height":"0"},"fast",function(){$(elem).hide();});});$('.cardOverlayTarget:visible',this).stop().animate({"height":"0"},function(){$(this).hide();});}
function getOverlayHtml(item,currentUser,card,commands){var html='';html+='<div class="cardOverlayInner">';var className=card.className.toLowerCase();var isMiniItem=className.indexOf('mini')!=-1;var isSmallItem=isMiniItem||className.indexOf('small')!=-1;var isPortrait=className.indexOf('portrait')!=-1;var isSquare=className.indexOf('square')!=-1;var parentName=isSmallItem||isMiniItem||isPortrait?null:item.SeriesName;var name=LibraryBrowser.getPosterViewDisplayName(item,true);html+='<div style="margin-bottom:1em;">';var logoHeight=isSmallItem||isMiniItem?20:26;var maxLogoWidth=isPortrait?100:200;var imgUrl;if(parentName&&item.ParentLogoItemId){imgUrl=ApiClient.getScaledImageUrl(item.ParentLogoItemId,{height:logoHeight,type:'logo',tag:item.ParentLogoImageTag});html+='<img src="'+imgUrl+'" style="max-height:'+logoHeight+'px;max-width:100%;" />';}
else if(item.ImageTags.Logo){imgUrl=ApiClient.getScaledImageUrl(item.Id,{height:logoHeight,type:'logo',tag:item.ImageTags.Logo});html+='<img src="'+imgUrl+'" style="max-height:'+logoHeight+'px;max-width:100%;" />';}
else{html+=parentName||name;}
html+='</div>';if(parentName){html+='<p>';html+=name;html+='</p>';}else if(!isSmallItem&&!isMiniItem){html+='<p class="itemMiscInfo" style="white-space:nowrap;">';html+=LibraryBrowser.getMiscInfoHtml(item);html+='</p>';}
if(!isMiniItem){html+='<div style="margin:1em 0 .75em;">';if(isPortrait){html+='<div class="itemCommunityRating">';html+=LibraryBrowser.getRatingHtml(item,false);html+='</div>';html+='<div class="userDataIcons" style="margin:.5em 0 0em;">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</div>';}else{html+='<span class="itemCommunityRating" style="vertical-align:middle;">';html+=LibraryBrowser.getRatingHtml(item,false);html+='</span>';html+='<span class="userDataIcons" style="vertical-align:middle;">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</span>';}
html+='</div>';}
html+='<div>';var buttonMargin=isPortrait||isSquare?"margin:0 4px 0 0;":"margin:0 10px 0 0;";var buttonCount=0;if(MediaController.canPlay(item)){var resumePosition=(item.UserData||{}).PlaybackPositionTicks||0;html+='<button type="button" class="btnPlayItem" data-itemid="'+item.Id+'" data-itemtype="'+item.Type+'" data-isfolder="'+item.IsFolder+'" data-mediatype="'+item.MediaType+'" data-resumeposition="'+resumePosition+'" data-mini="true" data-inline="true" data-icon="play" data-iconpos="notext" title="'+Globalize.translate('ButtonPlay')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonPlay')+'</button>';buttonCount++;}
if(commands.indexOf('trailer')!=-1){html+='<button type="button" data-mini="true" data-inline="true" data-icon="video" data-iconpos="notext" class="btnPlayTrailer" data-itemid="'+item.Id+'" title="'+Globalize.translate('ButtonPlayTrailer')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonPlayTrailer')+'</button>';buttonCount++;}
html+='<button data-role="button" class="btnMoreCommands" data-mini="true" data-inline="true" data-icon="ellipsis-v" data-iconpos="notext" title="'+Globalize.translate('ButtonMore')+'" style="'+buttonMargin+'">'+Globalize.translate('ButtonMore')+'</button>';buttonCount++;html+='</div>';html+='</div>';return html;}
function closeContextMenu(){$('.tapHoldMenu').popup('close');}
function onTrailerButtonClick(){var id=this.getAttribute('data-itemid');ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),id).done(function(trailers){MediaController.play({items:trailers});});closeContextMenu();return false;}
function onPlayItemButtonClick(){var id=this.getAttribute('data-itemid');var type=this.getAttribute('data-itemtype');var isFolder=this.getAttribute('data-isfolder')=='true';var mediaType=this.getAttribute('data-mediatype');var resumePosition=parseInt(this.getAttribute('data-resumeposition'));closeContextMenu();LibraryBrowser.showPlayMenu(this,id,type,isFolder,mediaType,resumePosition);return false;}
function onMoreButtonClick(){var card=$(this).parents('.card')[0];closeContextMenu();showContextMenu(card,{showPlayOptions:false});return false;}
function onAddToCollectionButtonClick(){var id=this.getAttribute('data-itemid');closeContextMenu();BoxSetEditor.showPanel([id]);return false;}
function onAddToPlaylistButtonClick(){var id=this.getAttribute('data-itemid');closeContextMenu();PlaylistManager.showPanel([id]);return false;}
function onShuffleButtonClick(){var id=this.getAttribute('data-itemid');MediaController.shuffle(id);closeContextMenu();return false;}
function onInstantMixButtonClick(){var id=this.getAttribute('data-itemid');MediaController.instantMix(id);closeContextMenu();return false;}
function onQueueButtonClick(){var id=this.getAttribute('data-itemid');MediaController.queue(id);closeContextMenu();return false;}
function onPlayButtonClick(){var id=this.getAttribute('data-itemid');MediaController.play(id);closeContextMenu();return false;}
function onDeleteButtonClick(){var id=this.getAttribute('data-itemid');closeContextMenu();LibraryBrowser.deleteItem(id);return false;}
function onSyncButtonClick(){var id=this.getAttribute('data-itemid');closeContextMenu();SyncManager.showMenu({items:[{Id:id}]});return false;}
function onExternalPlayerButtonClick(){closeContextMenu();var id=this.getAttribute('data-itemid');ExternalPlayer.showMenu(id);return false;}
function onPlayAllFromHereButtonClick(){var index=this.getAttribute('data-index');var page=$(this).parents('.page');var itemsContainer=$('.hasContextMenu',page).parents('.itemsContainer');closeContextMenu();itemsContainer.trigger('playallfromhere',[index]);return false;}
function onQueueAllFromHereButtonClick(){var index=this.getAttribute('data-index');var page=$(this).parents('.page');var itemsContainer=$('.hasContextMenu',page).parents('.itemsContainer');closeContextMenu();itemsContainer.trigger('queueallfromhere',[index]);return false;}
function onRemoveFromPlaylistButtonClick(){var playlistItemId=this.getAttribute('data-playlistitemid');var page=$(this).parents('.page');var itemsContainer=$('.hasContextMenu',page).parents('.itemsContainer');itemsContainer.trigger('removefromplaylist',[playlistItemId]);closeContextMenu();return false;}
function onResumeButtonClick(){var id=this.getAttribute('data-itemid');MediaController.play({ids:[id],startPositionTicks:parseInt(this.getAttribute('data-ticks'))});closeContextMenu();return false;}
function onCardTapHold(e){showContextMenu(this,{});e.preventDefault();return false;}
function showContextMenu(card,options){closeContextMenu();var displayContextItem=card;if($(card).hasClass('listviewMenuButton')){card=$(card).parents('.listItem,.card')[0];}
var itemId=card.getAttribute('data-itemid');var playlistItemId=card.getAttribute('data-playlistitemid');var commands=card.getAttribute('data-commands').split(',');var itemType=card.getAttribute('data-itemtype');var mediaType=card.getAttribute('data-mediatype');var playbackPositionTicks=parseInt(card.getAttribute('data-positionticks')||'0');var playAccess=card.getAttribute('data-playaccess');var locationType=card.getAttribute('data-locationtype');var index=card.getAttribute('data-index');$(card).addClass('hasContextMenu');Dashboard.getCurrentUser().done(function(user){var html='<div data-role="popup" class="tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 240px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';var href=card.getAttribute('data-href')||card.href||$('a',card).attr('href');if(commands.indexOf('addtocollection')!=-1){html+='<li data-icon="plus"><a href="#" class="btnAddToCollection" data-itemid="'+itemId+'">'+Globalize.translate('ButtonAddToCollection')+'</a></li>';}
if(commands.indexOf('playlist')!=-1){html+='<li data-icon="plus"><a href="#" class="btnAddToPlaylist" data-itemid="'+itemId+'">'+Globalize.translate('ButtonAddToPlaylist')+'</a></li>';}
if(commands.indexOf('delete')!=-1){html+='<li data-icon="delete"><a href="#" class="btnDelete" data-itemId="'+itemId+'">'+Globalize.translate('ButtonDelete')+'</a></li>';}
if(user.Policy.IsAdministrator&&commands.indexOf('edit')!=-1){html+='<li data-icon="edit"><a href="edititemmetadata.html?id='+itemId+'">'+Globalize.translate('ButtonEdit')+'</a></li>';}
if(commands.indexOf('instantmix')!=-1){html+='<li data-icon="recycle"><a href="#" class="btnInstantMix" data-itemid="'+itemId+'">'+Globalize.translate('ButtonInstantMix')+'</a></li>';}
html+='<li><a href="'+href+'">'+Globalize.translate('ButtonOpen')+'</a></li>';if(options.showPlayOptions!==false){if(MediaController.canPlayByAttributes(itemType,mediaType,playAccess,locationType)){html+='<li data-icon="play"><a href="#" class="btnPlay" data-itemid="'+itemId+'">'+Globalize.translate('ButtonPlay')+'</a></li>';if(commands.indexOf('playfromhere')!=-1){html+='<li data-icon="play"><a href="#" class="btnPlayAllFromHere" data-index="'+index+'">'+Globalize.translate('ButtonPlayAllFromHere')+'</a></li>';}}
if(mediaType=='Video'&&ExternalPlayer.getExternalPlayers().length){html+='<li data-icon="play"><a href="#" class="btnExternalPlayer" data-itemid="'+itemId+'">'+Globalize.translate('ButtonPlayExternalPlayer')+'</a></li>';}
if(playbackPositionTicks&&mediaType!="Audio"){html+='<li data-icon="play"><a href="#" class="btnResume" data-ticks="'+playbackPositionTicks+'" data-itemid="'+itemId+'">'+Globalize.translate('ButtonResume')+'</a></li>';}
if(commands.indexOf('trailer')!=-1){html+='<li data-icon="video"><a href="#" class="btnPlayTrailer" data-itemid="'+itemId+'">'+Globalize.translate('ButtonPlayTrailer')+'</a></li>';}}
if(MediaController.canQueueMediaType(mediaType,itemType)){html+='<li data-icon="plus"><a href="#" class="btnQueue" data-itemid="'+itemId+'">'+Globalize.translate('ButtonQueue')+'</a></li>';if(commands.indexOf('queuefromhere')!=-1){html+='<li data-icon="plus"><a href="#" class="btnQueueAllFromHere" data-index="'+index+'">'+Globalize.translate('ButtonQueueAllFromHere')+'</a></li>';}}
if(commands.indexOf('shuffle')!=-1){html+='<li data-icon="recycle"><a href="#" class="btnShuffle" data-itemid="'+itemId+'">'+Globalize.translate('ButtonShuffle')+'</a></li>';}
if(commands.indexOf('removefromplaylist')!=-1){html+='<li data-icon="delete"><a href="#" class="btnRemoveFromPlaylist" data-playlistitemid="'+playlistItemId+'">'+Globalize.translate('ButtonRemoveFromPlaylist')+'</a></li>';}
if(commands.indexOf('sync')!=-1){html+='<li data-icon="cloud"><a href="#" class="btnSync" data-itemId="'+itemId+'">'+Globalize.translate('ButtonSync')+'</a></li>';}
html+='</ul>';html+='</div>';$($.mobile.activePage).append(html);var elem=$('.tapHoldMenu').popup({positionTo:displayContextItem}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();$(card).removeClass('hasContextMenu');});$('.btnPlay',elem).on('click',onPlayButtonClick);$('.btnResume',elem).on('click',onResumeButtonClick);$('.btnQueue',elem).on('click',onQueueButtonClick);$('.btnInstantMix',elem).on('click',onInstantMixButtonClick);$('.btnShuffle',elem).on('click',onShuffleButtonClick);$('.btnPlayTrailer',elem).on('click',onTrailerButtonClick);$('.btnAddToPlaylist',elem).on('click',onAddToPlaylistButtonClick);$('.btnRemoveFromPlaylist',elem).on('click',onRemoveFromPlaylistButtonClick);$('.btnPlayAllFromHere',elem).on('click',onPlayAllFromHereButtonClick);$('.btnQueueAllFromHere',elem).on('click',onQueueAllFromHereButtonClick);$('.btnExternalPlayer',elem).on('click',onExternalPlayerButtonClick);$('.btnDelete',elem).on('click',onDeleteButtonClick);$('.btnSync',elem).on('click',onSyncButtonClick);$('.btnAddToCollection',elem).on('click',onAddToCollectionButtonClick);});}
function onListViewMenuButtonClick(e){showContextMenu(this,{});e.preventDefault();return false;}
function onGroupedCardClick(e){var target=$(e.target);var card=this;var itemId=card.getAttribute('data-itemid');var context=card.getAttribute('data-context');$(card).addClass('hasContextMenu');var userId=Dashboard.getCurrentUserId();var promise1=ApiClient.getItem(userId,itemId);var options={Limit:parseInt($('.playedIndicator',card).html()||'10'),Fields:"PrimaryImageAspectRatio,DateCreated",ParentId:itemId,GroupItems:false};var promise2=ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options));$.when(promise1,promise2).done(function(response1,response2){var item=response1[0];var latestItems=response2[0];if(latestItems.length==1){if(!target.is('a,button')){var first=latestItems[0];Dashboard.navigate(LibraryBrowser.getHref(first,context));return;}}
var html='<div data-role="popup" class="groupingMenu" data-theme="a">';html+='<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>';html+='<div>';html+='<ul data-role="listview">';var href=card.href||LibraryBrowser.getHref(item,context);var header=Globalize.translate('HeaderLatestFromChannel').replace('{0}','<a href="'+href+'">'+item.Name+'</a>');html+='<li data-role="list-divider">'+header+'</li>';html+='</ul>';html+='<div class="groupingMenuScroller">';html+='<ul data-role="listview">';html+=latestItems.map(function(latestItem){var itemHtml='';href=LibraryBrowser.getHref(latestItem,context);itemHtml+='<li class="ui-li-has-thumb"><a href="'+href+'">';var imgUrl;if(latestItem.ImageTags.Primary){var width=latestItem.Type=='Episode'?160:80;imgUrl=ApiClient.getScaledImageUrl(latestItem.Id,{width:width,tag:latestItem.ImageTags.Primary,type:"Primary",index:0});}
if(imgUrl){itemHtml+='<div class="listviewImage ui-li-thumb" style="background-image:url(\''+imgUrl+'\');"></div>';}
itemHtml+='<h3>';itemHtml+=LibraryBrowser.getPosterViewDisplayName(latestItem);itemHtml+='</h3>';var date=parseISO8601Date(latestItem.DateCreated,{toLocal:true});itemHtml+='<p>';itemHtml+=Globalize.translate('LabelAddedOnDate').replace('{0}',date.toLocaleDateString());itemHtml+='</p>';itemHtml+='</a></li>';return itemHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';html+='</div>';$($.mobile.activePage).append(html);$('.groupingMenu').popup().trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();$(card).removeClass('hasContextMenu');});});e.preventDefault();return false;}
$.fn.createCardMenus=function(){var preventHover=false;function onShowTimerExpired(elem){elem=$('a',elem)[0];if($(elem).hasClass('hasContextMenu')){return;}
if($('.itemSelectionPanel:visible',elem).length){return;}
var innerElem=$('.cardOverlayTarget',elem);var dataElement=elem;while(!dataElement.getAttribute('data-itemid')){dataElement=dataElement.parentNode;}
var id=dataElement.getAttribute('data-itemid');var commands=dataElement.getAttribute('data-commands').split(',');var promise1=ApiClient.getItem(Dashboard.getCurrentUserId(),id);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var item=response1[0];var user=response2[0];var card=$(elem);if(!card.hasClass('card')){card=card.parents('.card');}
innerElem.html(getOverlayHtml(item,user,card[0],commands)).trigger('create');$('.btnPlayItem',innerElem).on('click',onPlayItemButtonClick);$('.btnPlayTrailer',innerElem).on('click',onTrailerButtonClick);$('.btnMoreCommands',innerElem).on('click',onMoreButtonClick);});innerElem.show().each(function(){this.style.height=0;}).animate({"height":"100%"},"fast");}
function onHoverIn(){if(preventHover===true){preventHover=false;return;}
if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
var elem=this;showOverlayTimeout=setTimeout(function(){onShowTimerExpired(elem);},1000);}
function preventTouchHover(){preventHover=true;}
return this.off('.cardMenu').on('contextmenu.cardMenu','.card',onCardTapHold).off('.latestgroupings').on('click.latestgroupings','.groupedCard',onGroupedCardClick).off('.dotmenu').on('click.dotmenu','.listviewMenuButton',onListViewMenuButtonClick).off('.cardHoverMenu').on('mouseenter.cardHoverMenu','.card:not(.bannerCard)',onHoverIn).on('mouseleave.cardHoverMenu','.card:not(.bannerCard)',onHoverOut).on("touchstart.cardHoverMenu",'.card:not(.bannerCard)',preventTouchHover);};function toggleSelections(page){Dashboard.showLoadingMsg();var selectionCommands=$('.selectionCommands',page);if(selectionCommands.is(':visible')){selectionCommands.hide();$('.itemSelectionPanel',page).hide();}else{selectionCommands.show();var panels=$('.itemSelectionPanel',page).show();if(!panels.length){var index=0;$('.cardContent',page).each(function(){var chkItemSelectId='chkItemSelect'+index;$(this).append('<div class="itemSelectionPanel" onclick="return false;"><div class="ui-checkbox"><label class="ui-btn ui-corner-all ui-btn-inherit ui-btn-icon-left ui-checkbox-off" for="'+chkItemSelectId+'">Select</label><input id="'+chkItemSelectId+'" type="checkbox" class="chkItemSelect" data-enhanced="true" /></div></div>');index++;});$('.itemsContainer',page).trigger('create');}
$('.chkItemSelect:checked',page).checked(false).checkboxradio('refresh');}
Dashboard.hideLoadingMsg();}
function hideSelections(page){$('.selectionCommands',page).hide();$('.itemSelectionPanel',page).hide();}
function getSelectedItems(page){var selection=$('.chkItemSelect:checked',page);return selection.parents('.card').map(function(){return this.getAttribute('data-itemid');}).get();}
function sync(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
SyncManager.showMenu({items:selection});$(SyncManager).off('jobsubmit.librarylist').on('jobsubmit.librarylist',function(){hideSelections(page);});}
function combineVersions(page){var selection=getSelectedItems(page);if(selection.length<2){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectTwoItems'),title:Globalize.translate('HeaderError')});return;}
var names=$('.chkItemSelect:checked',page).parents('.card').get().reverse().map(function(e){return $('.cardText',e).html();}).join('<br/>');var msg=Globalize.translate('MessageTheFollowingItemsWillBeGrouped')+"<br/><br/>"+names;msg+="<br/><br/>"+Globalize.translate('MessageConfirmItemGrouping');Dashboard.confirm(msg,"Group Versions",function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Videos/MergeVersions",{Ids:selection.join(',')})}).done(function(){Dashboard.hideLoadingMsg();hideSelections(page);$('.itemsContainer',page).trigger('needsrefresh');});}});}
function addToCollection(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
BoxSetEditor.showPanel(selection);}
function addToPlaylist(page){var selection=getSelectedItems(page);if(selection.length<1){Dashboard.alert({message:Globalize.translate('MessagePleaseSelectOneItem'),title:Globalize.translate('HeaderError')});return;}
PlaylistManager.showPanel(selection);}
function onItemWithActionClick(e){var elem=this;var action=elem.getAttribute('data-action');var elemWithAttributes=elem;if(action){while(!elemWithAttributes.getAttribute('data-itemid')){elemWithAttributes=elemWithAttributes.parentNode;}}
var index;var itemsContainer;var itemId=elemWithAttributes.getAttribute('data-itemid');if(action=='play'){MediaController.play(itemId);}
else if(action=='playallfromhere'){index=elemWithAttributes.getAttribute('data-index');itemsContainer=$(elem).parents('.itemsContainer');closeContextMenu();itemsContainer.trigger('playallfromhere',[index]);}
else if(action=='setplaylistindex'){index=elemWithAttributes.getAttribute('data-index');closeContextMenu();MediaController.currentPlaylistIndex(index);}
else if(action=='photoslideshow'){if(!$(elem).hasClass('card')){elem=$(elem).parents('.card')[0];}
itemsContainer=$(elem).parents('.itemsContainer');index=$('.card',itemsContainer).get().indexOf(elem);closeContextMenu();itemsContainer.trigger('photoslideshow',[index]);}
return false;}
$(document).on('pageinit',".libraryPage",function(){var page=this;$('.btnAddToPlaylist',page).on('click',function(){addToPlaylist(page);});$('.btnMergeVersions',page).on('click',function(){combineVersions(page);});$('.btnSyncItems',page).on('click',function(){sync(page);});$('.btnAddToCollection',page).on('click',function(){addToCollection(page);});$('.viewTabButton',page).on('click',function(){$('.viewTabButton',page).removeClass('ui-btn-active');$(this).addClass('ui-btn-active');$('.viewTab',page).hide();$('.'+this.getAttribute('data-tab'),page).show();});var viewPanel=$('.viewPanel',page);$('#selectPageSize',viewPanel).html(LibraryBrowser.getDefaultPageSizeSelections().map(function(i){return'<option value="'+i+'">'+i+'</option>';}).join('')).selectmenu('refresh');$(page).on('click','.btnToggleSelections',function(){toggleSelections(page);}).on('click','.itemWithAction',onItemWithActionClick);$('.itemsContainer',page).createCardMenus();}).on('pagebeforeshow',".libraryPage",function(){var page=this;hideSelections(page);$('.viewTabButton:first',page).trigger('click');});function renderUserDataChanges(card,userData){if(userData.Played){if(!$('.playedIndicator',card).length){$('<div class="playedIndicator"></div>').insertAfter($('.cardOverlayTarget',card));}
$('.playedIndicator',card).html('<div class="ui-icon-check ui-btn-icon-notext"></div>');$('.cardProgress',card).remove();}
else if(userData.UnplayedItemCount){if(!$('.playedIndicator',card).length){$('<div class="playedIndicator"></div>').insertAfter($('.cardOverlayTarget',card));}
$('.playedIndicator',card).html(userData.UnplayedItemCount);}
else{$('.playedIndicator',card).remove();var progressHtml=LibraryBrowser.getItemProgressBarHtml(userData);$('.cardProgress',card).html(progressHtml);}}
function onUserDataChanged(userData){var cssClass=LibraryBrowser.getUserDataCssClass(userData.Key);if(!cssClass){return;}
$('.'+cssClass).each(function(){var mediaType=this.getAttribute('data-mediatype');if(mediaType=='Video'){this.setAttribute('data-positionticks',(userData.PlaybackPositionTicks||0));if($(this).hasClass('card')){renderUserDataChanges(this,userData);}}});}
function onWebSocketMessage(e,data){var msg=data;if(msg.MessageType==="UserDataChanged"){if(msg.Data.UserId==Dashboard.getCurrentUserId()){for(var i=0,length=msg.Data.UserDataList.length;i<length;i++){onUserDataChanged(msg.Data.UserDataList[i]);}}}}
function initializeApiClient(apiClient){$(apiClient).off('websocketmessage.librarylist',onWebSocketMessage).on('websocketmessage.librarylist',onWebSocketMessage);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});})(jQuery,document,window);(function($,document,window){function getNode(item,folderState,selected){var htmlName=getNodeInnerHtml(item);var node={id:item.Id,text:htmlName,state:{opened:item.IsFolder&&folderState=='open',selected:selected},li_attr:{}};if(item.IsFolder){node.children=[{text:'Loading...',icon:false}];node.icon=false;}
else{node.icon=false;}
if(node.state.opened){node.li_attr.loadedFromServer=true;}
if(selected){selectedNodeId=item.Id;}
return node;}
function getNodeInnerHtml(item){var name=item.Name;if(item.Number){name=item.Number+" - "+name;}
if(item.IndexNumber!=null&&item.Type!="Season"){name=item.IndexNumber+" - "+name;}
var cssClass="editorNode";if(item.LocationType=="Offline"){cssClass+=" offlineEditorNode";}
var htmlName="<div class='"+cssClass+"'>";if(item.LockData){htmlName+='<img src="css/images/editor/lock.png" />';}
htmlName+=name;if(!item.LocalTrailerCount&&item.Type=="Movie"){htmlName+='<img src="css/images/editor/missingtrailer.png" title="'+Globalize.translate('MissingLocalTrailer')+'" />';}
if(!item.ImageTags||!item.ImageTags.Primary){htmlName+='<img src="css/images/editor/missingprimaryimage.png" title="'+Globalize.translate('MissingPrimaryImage')+'" />';}
if(!item.BackdropImageTags||!item.BackdropImageTags.length){if(item.Type!=="Episode"&&item.Type!=="Season"&&item.MediaType!=="Audio"&&item.Type!=="TvChannel"&&item.Type!=="MusicAlbum"){htmlName+='<img src="css/images/editor/missingbackdrop.png" title="'+Globalize.translate('MissingBackdropImage')+'" />';}}
if(!item.ImageTags||!item.ImageTags.Logo){if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="Series"||item.Type=="MusicArtist"||item.Type=="BoxSet"){htmlName+='<img src="css/images/editor/missinglogo.png" title="'+Globalize.translate('MissingLogoImage')+'" />';}}
if(item.Type=="Episode"&&item.LocationType=="Virtual"){try{if(item.PremiereDate&&(new Date().getTime()>=parseISO8601Date(item.PremiereDate,{toLocal:true}).getTime())){htmlName+='<img src="css/images/editor/missing.png" title="'+Globalize.translate('MissingEpisode')+'" />';}}catch(err){}}
htmlName+="</div>";return htmlName;}
function loadChildrenOfRootNode(page,scope,callback){var promise2=ApiClient.getLiveTvChannels({limit:0});$.when(promise2).done(function(response2){var result=response2;var nodes=[];nodes.push({id:'MediaFolders',text:Globalize.translate('HeaderMediaFolders'),state:{opened:true},li_attr:{itemtype:'mediafolders',loadedFromServer:true},icon:false});if(result.TotalRecordCount){nodes.push({id:'livetv',text:Globalize.translate('HeaderLiveTV'),state:{opened:false},li_attr:{itemtype:'livetv'},children:[{text:'Loading...',icon:false}],icon:false});}
callback.call(scope,nodes);nodesToLoad.push('MediaFolders');});}
function loadLiveTvChannels(service,openItems,callback){ApiClient.getLiveTvChannels({ServiceName:service}).done(function(result){var nodes=result.Items.map(function(i){var state=openItems.indexOf(i.Id)==-1?'closed':'open';return getNode(i,state,false);});callback(nodes);});}
function loadMediaFolders(page,scope,openItems,callback){ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders")).done(function(result){var nodes=result.Items.map(function(n){var state=openItems.indexOf(n.Id)==-1?'closed':'open';return getNode(n,state,false);});callback.call(scope,nodes);for(var i=0,length=nodes.length;i<length;i++){if(nodes[i].state.opened){nodesToLoad.push(nodes[i].id);}}});}
function loadNode(page,scope,node,openItems,selectedId,currentUser,callback){var id=node.id;if(id=='#'){loadChildrenOfRootNode(page,scope,callback);return;}
if(id=='livetv'){loadLiveTvChannels(id,openItems,callback);return;}
if(id=='MediaFolders'){loadMediaFolders(page,scope,openItems,callback);return;}
var query={ParentId:id,Fields:'Settings'};var itemtype=node.li_attr.itemtype;if(itemtype!="Season"&&itemtype!="Series"){query.SortBy="SortName";}
ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){var nodes=result.Items.map(function(n){var state=openItems.indexOf(n.Id)==-1?'closed':'open';return getNode(n,state,n.Id==selectedId);});callback.call(scope,nodes);for(var i=0,length=nodes.length;i<length;i++){if(nodes[i].state.opened){nodesToLoad.push(nodes[i].id);}}});}
function scrollToNode(page,id){var elem=$('#'+id,page)[0];if(elem){}}
function initializeTree(page,currentUser,openItems,selectedId){nodesToLoad=[];selectedNodeId=null;$.jstree.destroy();$('.libraryTree',page).jstree({"plugins":["wholerow"],core:{check_callback:true,data:function(node,callback){loadNode(page,this,node,openItems,selectedId,currentUser,callback);},themes:{variant:'large'}}}).off('select_node.jstree').on('select_node.jstree',function(event,data){var node=data.node;var eventData={id:node.id,itemType:node.li_attr.itemtype};if(eventData.itemType!='livetv'&&eventData.itemType!='mediafolders'){$(this).trigger('itemclicked',[eventData]);}}).off('open_node.jstree').on('open_node.jstree',function(event,data){var node=data.node;if(node.children&&node.children){loadNodesToLoad(page,node);}
if(node.li_attr&&node.id!='#'&&!node.li_attr.loadedFromServer){node.li_attr.loadedFromServer=true;$.jstree.reference(".libraryTree",page).load_node(node.id,loadNodeCallback);}}).off('load_node.jstree').on('load_node.jstree',function(event,data){var node=data.node;if(node.children&&node.children){loadNodesToLoad(page,node);}
if(node.li_attr&&node.id!='#'&&!node.li_attr.loadedFromServer){node.li_attr.loadedFromServer=true;$.jstree.reference(".libraryTree",page).load_node(node.id,loadNodeCallback);}});}
function loadNodesToLoad(page,node){var children=node.children;for(var i=0,length=children.length;i<length;i++){var child=children[i];if(nodesToLoad.indexOf(child)!=-1){nodesToLoad=nodesToLoad.filter(function(n){return n!=child;});$.jstree.reference(".libraryTree",page).load_node(child,loadNodeCallback);}}}
function loadNodeCallback(node){if(selectedNodeId&&node.children&&node.children.indexOf(selectedNodeId)!=-1){setTimeout(function(){scrollToNode($.mobile.activePage,selectedNodeId);},500);}}
var nodesToLoad=[];var selectedNodeId;function updateEditorNode(page,item){var elem=$('#'+item.Id+'>a',page)[0];if(elem==null){return;}
$('.editorNode',elem).remove();$(elem).append(getNodeInnerHtml(item));if(item.IsFolder){var tree=jQuery.jstree._reference(".libraryTree");var currentNode=tree._get_node(null,false);tree.refresh(currentNode);}}
$(document).on('itemsaved',".metadataEditorPage",function(e,item){updateEditorNode(this,item);}).on('pagebeforeshow',".metadataEditorPage",function(){window.MetadataEditor=new metadataEditor();var page=this;Dashboard.getCurrentUser().done(function(user){var id=MetadataEditor.currentItemId;if(id){ApiClient.getAncestorItems(id,user.Id).done(function(ancestors){var ids=ancestors.map(function(i){return i.Id;});initializeTree(page,user,ids,id);});}else{initializeTree(page,user,[]);}});}).on('pagebeforehide',".metadataEditorPage",function(){var page=this;$('.libraryTree',page).off('select_node.jstree');});function metadataEditor(){var self=this;function ensureInitialValues(){if(self.currentItemType||self.currentItemId){return;}
var url=window.location.hash||getWindowUrl();var id=getParameterByName('id',url);if(id){self.currentItemId=id;self.currentItemType=null;}};self.getItemPromise=function(){var currentItemType=self.currentItemType;var currentItemId=self.currentItemId;if(currentItemType=="TvChannel"){return ApiClient.getLiveTvChannel(currentItemId);}
if(currentItemId){return ApiClient.getItem(Dashboard.getCurrentUserId(),currentItemId);}
return ApiClient.getRootFolder(Dashboard.getCurrentUserId());};self.getEditQueryString=function(item){var query="id="+item.Id;var context=getParameterByName('context');if(context){query+="&context="+context;}
return query;};ensureInitialValues();}})(jQuery,document,window);(function(window,document,$){function renderHeader(user){var html='<div class="viewMenuBar ui-bar-b">';if($.browser.safari&&$.browser.mobile&&window.navigator.standalone){html+='<a data-rel="back" data-role="none" href="#" class="headerButton headerButtonLeft headerBackButton"><div class="fa fa-arrow-circle-o-left"></div></a>';}
html+='<button type="button" data-role="none" title="Menu" class="headerButton dashboardMenuButton barsMenuButton headerButtonLeft">';html+='<div class="barMenuInner fa fa-bars">';html+='</div>';html+='</button>';html+='<button type="button" data-role="none" title="Menu" class="headerButton libraryMenuButton barsMenuButton headerButtonLeft">';html+='<div class="barMenuInner fa fa-bars">';html+='</div>';html+='</button>';html+='<div class="libraryMenuButtonText headerButton"><span>EMBY</span></div>';if(user.localUser){html+='<div class="viewMenuSearch"><form class="viewMenuSearchForm">';html+='<input type="text" data-role="none" data-type="search" class="headerSearchInput" autocomplete="off" spellcheck="off" />';html+='<div class="searchInputIcon fa fa-search"></div>';html+='<button data-role="none" type="button" data-iconpos="notext" class="imageButton btnCloseSearch" style="display:none;"><i class="fa fa-close"></i></button>';html+='</form></div>';}
html+='<div class="viewMenuSecondary">';if(user.localUser){html+='<button id="btnCast" class="btnCast btnDefaultCast headerButton headerButtonRight" type="button" data-role="none"><div class="headerSelectedPlayer"></div><div class="btnCastImage"></div></button>';html+='<button onclick="Search.showSearchPanel($.mobile.activePage);" type="button" data-role="none" class="headerButton headerButtonRight headerSearchButton"><div class="fa fa-search" style="font-size:21px;"></div></button>';}else{html+='<button id="btnCast" class="btnCast btnDefaultCast headerButton headerButtonRight" type="button" data-role="none" style="visibility:hidden;"><div class="headerSelectedPlayer"></div><div class="btnCastImage"></div></button>';}
html+='<a class="headerButton headerButtonRight headerUserButton" href="#" onclick="Dashboard.showUserFlyout(this);">';if(user.imageUrl){var userButtonHeight=26;var url=user.imageUrl;if(user.supportsImageParams){url+="&height="+(userButtonHeight*Math.max(devicePixelRatio||1,2));}
html+='<img src="'+url+'" style="border-radius: 1000px; height:'+userButtonHeight+'px;" />';}else{html+='<div class="fa fa-user"></div>';}
html+='</a>';if(user.canManageServer){html+='<a href="dashboard.html" class="headerButton headerButtonRight dashboardEntryHeaderButton"><div class="fa fa-cog"></div></a>';}
html+='</div>';html+='</div>';$(document.body).prepend(html);$('.viewMenuBar').trigger('create');$(document).trigger('headercreated');bindMenuEvents();}
function bindMenuEvents(){if($.browser.mobile){$('.libraryMenuButton').on('mousedown',function(){showLibraryMenu(false);});$('.dashboardMenuButton').on('mousedown',function(){showDashboardMenu(false);});}else{$('.libraryMenuButton').createHoverTouch().on('hovertouch',showLibraryMenu);$('.dashboardMenuButton').createHoverTouch().on('hovertouch',showDashboardMenu);}}
function getItemHref(item,context){return LibraryBrowser.getHref(item,context);}
function getViewsHtml(){var html='';html+='<div class="libraryMenuOptions">';html+='</div>';html+='<div class="libraryMenuDivider"></div>';html+='<div class="adminMenuOptions">';html+='<a class="sidebarLink lnkMediaFolder" data-itemid="dashboard" href="dashboard.html"><span class="fa fa-cog sidebarLinkIcon"></span>'+Globalize.translate('ButtonDashboard')+'</a>';html+='<a class="sidebarLink lnkMediaFolder editorViewMenu" data-itemid="editor" href="edititemmetadata.html"><span class="fa fa-edit sidebarLinkIcon"></span>'+Globalize.translate('ButtonMetadataManager')+'</a>';html+='<a class="sidebarLink lnkMediaFolder" data-itemid="reports" href="reports.html"><span class="fa fa-bar-chart sidebarLinkIcon"></span>'+Globalize.translate('ButtonReports')+'</a>';html+='</div>';html+='<a class="sidebarLink lnkMediaFolder syncViewMenu" data-itemid="mysync" href="mysync.html"><span class="fa fa-cloud sidebarLinkIcon"></span>'+Globalize.translate('ButtonSync')+'</a>';return html;}
function showLibraryMenu(){var page=$.mobile.activePage;var panel;ConnectionManager.user().done(function(user){panel=getLibraryMenu(user);updateLibraryNavLinks(page);$(panel).panel('toggle').off('mouseleave.librarymenu').on('mouseleave.librarymenu',function(){$(this).panel("close");});});}
function showDashboardMenu(){var page=$.mobile.activePage;var panel=getDashboardMenu(page);$(panel).panel('toggle').off('mouseleave.librarymenu').on('mouseleave.librarymenu',function(){$(this).panel("close");});}
function updateLibraryMenu(panel){var apiClient=ConnectionManager.currentApiClient();if(!apiClient){$('.adminMenuOptions').hide();$('.syncViewMenu').hide();return;}
var userId=Dashboard.getCurrentUserId();apiClient.getUserViews(userId).done(function(result){var items=result.Items;var html=items.map(function(i){var iconCssClass='fa';var itemId=i.Id;if(i.CollectionType=="channels"){itemId="channels";}
else if(i.CollectionType=="livetv"){itemId="livetv";}
if(i.Type=='Channel'){}
if(i.CollectionType=="photos"){iconCssClass+=' fa-photo';}
else if(i.CollectionType=="music"||i.CollectionType=="musicvideos"){iconCssClass+=' fa-music';}
else if(i.CollectionType=="books"){iconCssClass+=' fa-book';}
else if(i.CollectionType=="playlists"){iconCssClass+=' fa-list';}
else if(i.CollectionType=="games"){iconCssClass+=' fa-gamepad';}
else if(i.CollectionType=="movies"){iconCssClass+=' fa-film';}
else if(i.CollectionType=="channels"||i.Type=='Channel'){iconCssClass+=' fa-globe';}
else if(i.CollectionType=="tvshows"||i.CollectionType=="livetv"){iconCssClass+=' fa-video-camera';}
else{iconCssClass+=' fa-folder-open-o';}
return'<a data-itemid="'+itemId+'" class="lnkMediaFolder sidebarLink" href="'+getItemHref(i,i.CollectionType)+'"><span class="'+iconCssClass+' sidebarLinkIcon"></span><span class="sectionName">'+i.Name+'</span></a>';}).join('');var elem=$('.libraryMenuOptions').html(html);$('.sidebarLink',elem).on('click',function(){var section=$('.sectionName',this)[0];var text=section?section.innerHTML:this.innerHTML;$('.libraryMenuButtonText').html(text);});});Dashboard.getCurrentUser().done(function(user){if(user.Policy.IsAdministrator){$('.adminMenuOptions').show();}else{$('.adminMenuOptions').hide();}
if(user.Policy.EnableSync){$('.syncViewMenu').show();}else{$('.syncViewMenu').hide();}});}
var requiresLibraryMenuRefresh=false;function getLibraryMenu(user){var panel=$('#libraryPanel');if(!panel.length){var html='';html+='<div data-role="panel" id="libraryPanel" class="libraryPanel" data-position="left" data-display="overlay" data-position-fixed="true" data-theme="b">';html+='<div class="sidebarLinks librarySidebarLinks">';var homeHref=ConnectionManager.currentApiClient()?'index.html':'selectserver.html';html+='<a class="lnkMediaFolder sidebarLink" style="margin-top:.5em;padding-left:1em;display:block;color:#fff;text-decoration:none;" href="'+homeHref+'">';html+='<img style="max-width:36px;vertical-align:middle;margin-right:1em;" src="css/images/mblogoicon.png" />';html+=Globalize.translate('ButtonHome');html+='</a>';html+='<div class="libraryMenuDivider" style="margin-top:0;"></div>';html+=getViewsHtml();html+='</div>';html+='</div>';$(document.body).append(html);panel=$('#libraryPanel').panel({}).trigger('create');updateLibraryMenu();}
else if(requiresLibraryMenuRefresh){updateLibraryMenu();requiresLibraryMenuRefresh=false;}
return panel;}
function getDashboardMenu(page){var panel=$('#dashboardPanel',page);if(!panel.length){var html='';html+='<div data-role="panel" id="dashboardPanel" class="dashboardPanel" data-position="left" data-display="overlay" data-position-fixed="true" data-theme="b">';html+='<div style="margin: 0 -1em;">';html+='</div>';html+='</div>';$(document.body).append(html);panel=$('#dashboardPanel').panel({}).trigger('create');}
return panel;}
function setLibraryMenuText(text){$('.libraryMenuButtonText').html('<span>'+text+'</span>');}
function getTopParentId(){return getParameterByName('topParentId')||null;}
window.LibraryMenu={showLibraryMenu:showLibraryMenu,getTopParentId:getTopParentId,setText:setLibraryMenuText};function updateCastIcon(){var info=MediaController.getPlayerInfo();if(info.isLocalPlayer){$('.btnCast').addClass('btnDefaultCast').removeClass('btnActiveCast');$('.headerSelectedPlayer').html('');}else{$('.btnCast').removeClass('btnDefaultCast').addClass('btnActiveCast');$('.headerSelectedPlayer').html((info.deviceName||info.name));}}
function updateLibraryNavLinks(page){page=$(page);var isLiveTvPage=page.hasClass('liveTvPage');var isChannelsPage=page.hasClass('channelsPage');var isEditorPage=page.hasClass('metadataEditorPage');var isReportsPage=page.hasClass('reportsPage');var isMySyncPage=page.hasClass('mySyncPage');var id=isLiveTvPage||isChannelsPage||isEditorPage||isReportsPage||isMySyncPage||page.hasClass('allLibraryPage')?'':getTopParentId()||'';$('.lnkMediaFolder').each(function(){var itemId=this.getAttribute('data-itemid');if(isChannelsPage&&itemId=='channels'){$(this).addClass('selectedMediaFolder');}
else if(isLiveTvPage&&itemId=='livetv'){$(this).addClass('selectedMediaFolder');}
else if(isEditorPage&&itemId=='editor'){$(this).addClass('selectedMediaFolder');}
else if(isReportsPage&&itemId=='reports'){$(this).addClass('selectedMediaFolder');}
else if(isMySyncPage&&itemId=='mysync'){$(this).addClass('selectedMediaFolder');}
else if(id&&itemId==id){$(this).addClass('selectedMediaFolder');}
else{$(this).removeClass('selectedMediaFolder');}});var context=getParameterByName('context');if(context!=='playlists'){$('.scopedLibraryViewNav a',page).each(function(){var src=this.href;if(src.indexOf('#')!=-1){return;}
src=replaceQueryString(src,'topParentId',id);this.href=src;});}}
function updateContextText(page){var name=page.getAttribute('data-contextname');if(name){$('.libraryMenuButtonText').html('<span>'+name+'</span>');}
else if($(page).hasClass('allLibraryPage')||$(page).hasClass('type-interior')){$('.libraryMenuButtonText').html('<span class="logoLibraryMenuButtonText">EMBY</span>');}}
function onWebSocketMessage(e,data){var msg=data;if(msg.MessageType==="UserConfigurationUpdated"){if(msg.Data.Id==Dashboard.getCurrentUserId()){requiresLibraryMenuRefresh=true;}}}
$(document).on('pageinit',".page",function(){var page=this;$('.libraryViewNav',page).wrapInner('<div class="libraryViewNavInner"></div>');$('.libraryViewNav a',page).each(function(){this.innerHTML='<span class="libraryViewNavLinkContent">'+this.innerHTML+'</span>';});}).on('pagebeforeshow',".page:not(.standalonePage)",function(){var page=this;if(!$('.viewMenuBar').length){ConnectionManager.user().done(function(user){renderHeader(user);updateCastIcon();updateLibraryNavLinks(page);updateContextText(page);});}else{updateContextText(page);updateLibraryNavLinks(page);}
var jpage=$(page);if(jpage.hasClass('libraryPage')){$(document.body).addClass('libraryDocument').removeClass('dashboardDocument');}
else if(jpage.hasClass('type-interior')){$(document.body).addClass('dashboardDocument').removeClass('libraryDocument');}else{$(document.body).removeClass('dashboardDocument').removeClass('libraryDocument');}}).on('pagebeforeshow',".page",function(){var page=this;if($(page).hasClass('standalonePage')){$('.viewMenuBar').hide();}else{$('.viewMenuBar').show();}}).on('pageshow',".libraryPage",function(){var page=this;var elem=$('.libraryViewNavInner .ui-btn-active:visible',page);if(elem.length){elem[0].scrollIntoView();$(document).scrollTop(0);}});function initializeApiClient(apiClient){$(apiClient).off('websocketmessage.librarymenu',onWebSocketMessage).on('websocketmessage.librarymenu',onWebSocketMessage);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});$(function(){$(MediaController).on('playerchange',function(){updateCastIcon();});});})(window,document,jQuery);$.fn.createHoverTouch=function(){var preventHover=false;var timerId;function startTimer(elem){stopTimer();timerId=setTimeout(function(){$(elem).trigger('hovertouch');},300);}
function stopTimer(elem){if(timerId){clearTimeout(timerId);timerId=null;}}
return $(this).on('mouseenter',function(){if(preventHover===true){preventHover=false;return;}
startTimer(this);}).on('mouseleave',function(){stopTimer(this);}).on('touchstart',function(){preventHover=true;}).on('click',function(){preventHover=true;if(preventHover){$(this).trigger('hovertouch');stopTimer(this);preventHover=false;}});};(function($,window,store){function setMirrorModeEnabled(enabled){var val=enabled?'1':'0';store.setItem('displaymirror--'+Dashboard.getCurrentUserId(),val);}
function isMirrorModeEnabled(){return(store.getItem('displaymirror--'+Dashboard.getCurrentUserId())||'')!='0';}
var currentDisplayInfo;function mirrorItem(info){var item=info.item;MediaController.getCurrentPlayer().displayContent({ItemName:item.Name,ItemId:item.Id,ItemType:item.Type,Context:info.context});}
function mirrorIfEnabled(info){if(isMirrorModeEnabled()){var player=MediaController.getPlayerInfo();if(!player.isLocalPlayer&&player.supportedCommands.indexOf('DisplayContent')!=-1){mirrorItem(info);}}}
function monitorPlayer(player){$(player).on('playbackstart.mediacontroller',function(e,state){var info={QueueableMediaTypes:state.NowPlayingItem.MediaType,ItemId:state.NowPlayingItem.Id,NowPlayingItem:state.NowPlayingItem};info=$.extend(info,state.PlayState);ApiClient.reportPlaybackStart(info);}).on('playbackstop.mediacontroller',function(e,state){var stopInfo={itemId:state.NowPlayingItem.Id,mediaSourceId:state.PlayState.MediaSourceId,positionTicks:state.PlayState.PositionTicks};if(state.PlayState.LiveStreamId){stopInfo.LiveStreamId=state.PlayState.LiveStreamId;}
if(state.PlayState.PlaySessionId){stopInfo.PlaySessionId=state.PlayState.PlaySessionId;}
ApiClient.reportPlaybackStopped(stopInfo);});}
function mediaController(){var self=this;var currentPlayer;var currentTargetInfo;var players=[];var keys=new bindKeys(self);$(window).on("keydown",keys.keyBinding).on("keypress keyup",keys.keyPrevent);self.registerPlayer=function(player){players.push(player);if(player.isLocalPlayer){monitorPlayer(player);}};self.getPlayerInfo=function(){return{name:currentPlayer.name,isLocalPlayer:currentPlayer.isLocalPlayer,id:currentTargetInfo.id,deviceName:currentTargetInfo.deviceName,playableMediaTypes:currentTargetInfo.playableMediaTypes,supportedCommands:currentTargetInfo.supportedCommands};};self.setActivePlayer=function(player,targetInfo){if(typeof(player)==='string'){player=players.filter(function(p){return p.name==player;})[0];}
if(!player){throw new Error('null player');}
currentPlayer=player;currentTargetInfo=targetInfo||player.getCurrentTargetInfo();console.log('Active player: '+JSON.stringify(currentTargetInfo));$(self).trigger('playerchange');};self.setDefaultPlayerActive=function(){self.setActivePlayer(self.getDefaultPlayer());};self.removeActivePlayer=function(name){if(self.getPlayerInfo().name==name){self.setDefaultPlayerActive();}};self.getTargets=function(){var deferred=$.Deferred();var promises=players.map(function(p){return p.getTargets();});$.when.apply($,promises).done(function(){var targets=[];for(var i=0;i<arguments.length;i++){var subTargets=arguments[i];for(var j=0;j<subTargets.length;j++){targets.push(subTargets[j]);}}
targets=targets.sort(function(a,b){var aVal=a.isLocalPlayer?0:1;var bVal=b.isLocalPlayer?0:1;aVal=aVal.toString()+a.name;bVal=bVal.toString()+b.name;return aVal.localeCompare(bVal);});deferred.resolveWith(null,[targets]);});return deferred.promise();};self.play=function(options){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.play(options);};self.shuffle=function(id){currentPlayer.shuffle(id);};self.instantMix=function(id){currentPlayer.instantMix(id);};self.queue=function(options){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.queue(options);};self.queueNext=function(options){if(typeof(options)==='string'){options={ids:[options]};}
currentPlayer.queueNext(options);};self.canPlay=function(item){return self.canPlayByAttributes(item.Type,item.MediaType,item.PlayAccess,item.LocationType);};self.canPlayByAttributes=function(itemType,mediaType,playAccess,locationType){if(playAccess!='Full'){return false;}
if(locationType=="Virtual"){return false;}
if(itemType=="Program"){return false;}
if(itemType=="MusicGenre"||itemType=="Season"||itemType=="Series"||itemType=="BoxSet"||itemType=="MusicAlbum"||itemType=="MusicArtist"||itemType=="Playlist"){return true;}
return self.getPlayerInfo().playableMediaTypes.indexOf(mediaType)!=-1;};self.canQueueMediaType=function(mediaType,itemType){if(itemType=='MusicAlbum'||itemType=='MusicArtist'||itemType=='MusicGenre'){mediaType='Audio';}
return currentPlayer.canQueueMediaType(mediaType);};self.getLocalPlayer=function(){return currentPlayer.isLocalPlayer?currentPlayer:players.filter(function(p){return p.isLocalPlayer;})[0];};self.getDefaultPlayer=function(){return currentPlayer.isLocalPlayer?currentPlayer:players.filter(function(p){return p.isDefaultPlayer;})[0];};self.getCurrentPlayer=function(){return currentPlayer;};self.pause=function(){currentPlayer.pause();};self.stop=function(){currentPlayer.stop();};self.unpause=function(){currentPlayer.unpause();};self.seek=function(position){currentPlayer.seek(position);};self.currentPlaylistIndex=function(i){currentPlayer.currentPlaylistIndex(i);};self.removeFromPlaylist=function(i){currentPlayer.removeFromPlaylist(i);};self.nextTrack=function(){currentPlayer.nextTrack();};self.previousTrack=function(){currentPlayer.previousTrack();};self.mute=function(){currentPlayer.mute();};self.unMute=function(){currentPlayer.unMute();};self.toggleMute=function(){currentPlayer.toggleMute();};self.volumeDown=function(){currentPlayer.volumeDown();};self.volumeUp=function(){currentPlayer.volumeUp();};self.shuffle=function(id){currentPlayer.shuffle(id);};self.playlist=function(){return currentPlayer.playlist||[];};self.sendCommand=function(cmd,player){player=player||self.getLocalPlayer();console.log('MediaController received command: '+cmd.Name);switch(cmd.Name){case'VolumeUp':player.volumeUp();break;case'VolumeDown':player.volumeDown();break;case'Mute':player.mute();break;case'Unmute':player.unMute();break;case'ToggleMute':player.toggleMute();break;case'SetVolume':player.setVolume(cmd.Arguments.Volume);break;case'SetAudioStreamIndex':player.setAudioStreamIndex(parseInt(cmd.Arguments.Index));break;case'SetSubtitleStreamIndex':player.setSubtitleStreamIndex(parseInt(cmd.Arguments.Index));break;case'ToggleFullscreen':player.toggleFullscreen();break;default:{if(player.isLocalPlayer){Dashboard.processGeneralCommand(cmd);}else{player.sendCommand(cmd);}
break;}}};}
window.MediaController=new mediaController();function onWebSocketMessageReceived(e,msg){var localPlayer;if(msg.MessageType==="Play"){localPlayer=MediaController.getLocalPlayer();if(msg.Data.PlayCommand=="PlayNext"){localPlayer.queueNext({ids:msg.Data.ItemIds});}
else if(msg.Data.PlayCommand=="PlayLast"){localPlayer.queue({ids:msg.Data.ItemIds});}
else{localPlayer.play({ids:msg.Data.ItemIds,startPositionTicks:msg.Data.StartPositionTicks});}}
else if(msg.MessageType==="ServerShuttingDown"){MediaController.setDefaultPlayerActive();}
else if(msg.MessageType==="ServerRestarting"){MediaController.setDefaultPlayerActive();}
else if(msg.MessageType==="Playstate"){localPlayer=MediaController.getLocalPlayer();if(msg.Data.Command==='Stop'){localPlayer.stop();}
else if(msg.Data.Command==='Pause'){localPlayer.pause();}
else if(msg.Data.Command==='Unpause'){localPlayer.unpause();}
else if(msg.Data.Command==='Seek'){localPlayer.seek(msg.Data.SeekPositionTicks);}
else if(msg.Data.Command==='NextTrack'){localPlayer.nextTrack();}
else if(msg.Data.Command==='PreviousTrack'){localPlayer.previousTrack();}}
else if(msg.MessageType==="GeneralCommand"){var cmd=msg.Data;localPlayer=MediaController.getLocalPlayer();MediaController.sendCommand(cmd,localPlayer);}}
function initializeApiClient(apiClient){$(apiClient).on("websocketmessage",onWebSocketMessageReceived);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});function getTargetsHtml(targets){var playerInfo=MediaController.getPlayerInfo();var html='';html+='<form>';html+='<h3>'+Globalize.translate('HeaderSelectPlayer')+'</h3>';html+='<fieldset data-role="controlgroup" data-mini="true">';var checkedHtml;for(var i=0,length=targets.length;i<length;i++){var target=targets[i];var id='radioPlayerTarget'+i;var isChecked=target.id==playerInfo.id;checkedHtml=isChecked?' checked="checked"':'';var mirror=(!target.isLocalPlayer&&target.supportedCommands.indexOf('DisplayContent')!=-1)?'true':'false';html+='<input type="radio" class="radioSelectPlayerTarget" name="radioSelectPlayerTarget" data-mirror="'+mirror+'" data-commands="'+target.supportedCommands.join(',')+'" data-mediatypes="'+target.playableMediaTypes.join(',')+'" data-playername="'+target.playerName+'" data-targetid="'+target.id+'" data-targetname="'+target.name+'" data-devicename="'+(target.deviceName||'')+'" id="'+id+'" value="'+target.id+'"'+checkedHtml+'>';html+='<label for="'+id+'" style="font-weight:normal;">'+target.name;if(target.appName&&target.appName!=target.name){html+='<br/><span>'+target.appName+'</span>';}
html+='</label>';}
html+='</fieldset>';html+='<p class="fieldDescription">'+Globalize.translate('LabelAllPlaysSentToPlayer')+'</p>';checkedHtml=isMirrorModeEnabled()?' checked="checked"':'';html+='<div style="margin-top:1.5em;" class="fldMirrorMode"><label for="chkEnableMirrorMode">Enable display mirroring</label><input type="checkbox" class="chkEnableMirrorMode" id="chkEnableMirrorMode" data-mini="true"'+checkedHtml+' /></div>';html+='</form>';return html;}
function showPlayerSelection(page){var promise=MediaController.getTargets();var html='<div data-role="panel" data-position="right" data-display="overlay" data-position-fixed="true" id="playerSelectionPanel" data-theme="a">';html+='<div class="players"></div>';html+='<br/>';html+='<p><a href="nowplaying.html" data-role="button" data-icon="remote" data-transition="slideup">'+Globalize.translate('ButtonRemoteControl')+'</a></p>';html+='</div>';$(document.body).append(html);var elem=$('#playerSelectionPanel').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});promise.done(function(targets){$('.players',elem).html(getTargetsHtml(targets)).trigger('create');$('.chkEnableMirrorMode',elem).on('change',function(){setMirrorModeEnabled(this.checked);if(this.checked&&currentDisplayInfo){mirrorItem(currentDisplayInfo);}});$('.radioSelectPlayerTarget',elem).on('change',function(){var supportsMirror=this.getAttribute('data-mirror')=='true';if(supportsMirror){$('.fldMirrorMode',elem).show();}else{$('.fldMirrorMode',elem).hide();}}).each(function(){if(this.checked){$(this).trigger('change');}}).on('change',function(){var playerName=this.getAttribute('data-playername');var targetId=this.getAttribute('data-targetid');var targetName=this.getAttribute('data-targetname');var deviceName=this.getAttribute('data-deviceName');var playableMediaTypes=this.getAttribute('data-mediatypes').split(',');var supportedCommands=this.getAttribute('data-commands').split(',');MediaController.setActivePlayer(playerName,{id:targetId,name:targetName,playableMediaTypes:playableMediaTypes,supportedCommands:supportedCommands,deviceName:deviceName});if(currentDisplayInfo){mirrorIfEnabled(currentDisplayInfo);}});});}
function bindKeys(controller){var self=this;var keyResult={};self.keyBinding=function(e){if(bypass())return;console.log("keyCode",e.keyCode);if(keyResult[e.keyCode]){e.preventDefault();keyResult[e.keyCode](e);}};self.keyPrevent=function(e){if(bypass())return;var codes=[32,38,40,37,39,81,77,65,84,83,70];if(codes.indexOf(e.keyCode)!=-1){e.preventDefault();}};keyResult[32]=function(){var player=controller.getCurrentPlayer();player.getPlayerState().done(function(result){var state=result;if(state.NowPlayingItem&&state.PlayState){if(state.PlayState.IsPaused){player.unpause();}else{player.pause();}}});};var bypass=function(){var active=document.activeElement;var type=active.type||active.tagName.toLowerCase();return(type==="text"||type==="select"||type==="textarea"||type=="password");};}
$(document).on('headercreated',function(){$('.btnCast').on('click',function(){showPlayerSelection($.mobile.activePage);});});$(document).on('pagebeforeshow',".page",function(){var page=this;currentDisplayInfo=null;}).on('displayingitem',".libraryPage",function(e,info){var page=this;currentDisplayInfo=info;mirrorIfEnabled(info);});})(jQuery,window,window.store);(function(window,chrome,console){var DEVICE_STATE={'IDLE':0,'ACTIVE':1,'WARNING':2,'ERROR':3,};var PLAYER_STATE={'IDLE':'IDLE','LOADING':'LOADING','LOADED':'LOADED','PLAYING':'PLAYING','PAUSED':'PAUSED','STOPPED':'STOPPED','SEEKING':'SEEKING','ERROR':'ERROR'};var PlayerName='Chromecast';var messageNamespace='urn:x-cast:com.google.cast.mediabrowser.v3';var cPlayer={deviceState:DEVICE_STATE.IDLE};var CastPlayer=function(){this.deviceState=DEVICE_STATE.IDLE;this.currentMediaSession=null;this.session=null;this.castPlayerState=PLAYER_STATE.IDLE;this.hasReceivers=false;this.errorHandler=this.onError.bind(this);this.mediaStatusUpdateHandler=this.onMediaStatusUpdate.bind(this);this.initializeCastPlayer();};CastPlayer.prototype.initializeCastPlayer=function(){if(!chrome){return;}
if(!chrome.cast||!chrome.cast.isAvailable){setTimeout(this.initializeCastPlayer.bind(this),1000);return;}
var applicationID="F4EB2E8E";var sessionRequest=new chrome.cast.SessionRequest(applicationID);var apiConfig=new chrome.cast.ApiConfig(sessionRequest,this.sessionListener.bind(this),this.receiverListener.bind(this));console.log('chromecast.initialize');chrome.cast.initialize(apiConfig,this.onInitSuccess.bind(this),this.errorHandler);};CastPlayer.prototype.onInitSuccess=function(){this.isInitialized=true;console.log("chromecast init success");};CastPlayer.prototype.onError=function(){console.log("chromecast error");};CastPlayer.prototype.sessionListener=function(e){this.session=e;if(this.session){console.log('sessionListener '+JSON.stringify(e));if(this.session.media[0]){this.onMediaDiscovered('activeSession',this.session.media[0]);}
this.onSessionConnected(e);}};CastPlayer.prototype.messageListener=function(namespace,message){message=JSON.parse(message);if(message.type=='playbackerror'){var errorCode=message.data;setTimeout(function(){Dashboard.alert({message:Globalize.translate('MessagePlaybackError'+errorCode),title:Globalize.translate('HeaderPlaybackError')});},300);}
else if(message.type=='connectionerror'){setTimeout(function(){Dashboard.alert({message:Globalize.translate('MessageChromecastConnectionError'),title:Globalize.translate('HeaderError')});},300);}
else if(message.type&&message.type.indexOf('playback')==0){$(this).trigger(message.type,[message.data]);}};CastPlayer.prototype.receiverListener=function(e){if(e==='available'){console.log("chromecast receiver found");this.hasReceivers=true;}
else{console.log("chromecast receiver list empty");this.hasReceivers=false;}};CastPlayer.prototype.sessionUpdateListener=function(isAlive){console.log('sessionUpdateListener alive: '+isAlive);if(isAlive){}
else{this.session=null;this.deviceState=DEVICE_STATE.IDLE;this.castPlayerState=PLAYER_STATE.IDLE;this.currentMediaSession=null;MediaController.removeActivePlayer(PlayerName);}};CastPlayer.prototype.launchApp=function(){console.log("chromecast launching app...");chrome.cast.requestSession(this.onRequestSessionSuccess.bind(this),this.onLaunchError.bind(this));};CastPlayer.prototype.onRequestSessionSuccess=function(e){console.log("chromecast session success: "+e.sessionId);this.onSessionConnected(e);};CastPlayer.prototype.onSessionConnected=function(session){this.session=session;this.deviceState=DEVICE_STATE.ACTIVE;this.session.addMessageListener(messageNamespace,this.messageListener.bind(this));this.session.addMediaListener(this.sessionMediaListener.bind(this));this.session.addUpdateListener(this.sessionUpdateListener.bind(this));$(this).trigger('connect');MediaController.setActivePlayer(PlayerName);this.sendMessage({options:{},command:'Identify'});};CastPlayer.prototype.sessionMediaListener=function(e){console.log('sessionMediaListener');this.currentMediaSession=e;this.currentMediaSession.addUpdateListener(this.mediaStatusUpdateHandler);};CastPlayer.prototype.onLaunchError=function(){console.log("chromecast launch error");this.deviceState=DEVICE_STATE.ERROR;MediaController.removeActivePlayer(PlayerName);};CastPlayer.prototype.stopApp=function(){this.session.stop(this.onStopAppSuccess.bind(this,'Session stopped'),this.errorHandler);};CastPlayer.prototype.onStopAppSuccess=function(message){console.log(message);this.deviceState=DEVICE_STATE.IDLE;this.castPlayerState=PLAYER_STATE.IDLE;this.currentMediaSession=null;};CastPlayer.prototype.loadMedia=function(options,command){if(!this.session){console.log("no session");return;}
options.items=options.items.map(function(i){return{Id:i.Id,Name:i.Name,Type:i.Type,MediaType:i.MediaType,IsFolder:i.IsFolder};});this.sendMessage({options:options,command:command});};var endpointInfo;function getEndpointInfo(){if(endpointInfo){var deferred=$.Deferred();deferred.resolveWith(null,[endpointInfo]);return deferred.promise();}
return ApiClient.getJSON(ApiClient.getUrl('System/Endpoint')).done(function(info){endpointInfo=info;});}
CastPlayer.prototype.sendMessage=function(message){var player=this;var bitrateSetting=AppSettings.maxChromecastBitrate();var receiverName=null;if(castPlayer.session&&castPlayer.session.receiver&&castPlayer.session.receiver.friendlyName){receiverName=castPlayer.session.receiver.friendlyName;}
message=$.extend(message,{userId:Dashboard.getCurrentUserId(),deviceId:ApiClient.deviceId(),accessToken:ApiClient.accessToken(),serverAddress:ApiClient.serverAddress(),maxBitrate:bitrateSetting,receiverName:receiverName});getEndpointInfo().done(function(endpoint){if(endpoint.IsLocal||endpoint.IsInNetwork){ApiClient.getSystemInfo().done(function(info){message.serverAddress=info.LocalAddress;player.sendMessageInternal(message);});}else{player.sendMessageInternal(message);}});};CastPlayer.prototype.sendMessageInternal=function(message){message=JSON.stringify(message);this.session.sendMessage(messageNamespace,message,this.onPlayCommandSuccess.bind(this),this.errorHandler);};CastPlayer.prototype.onPlayCommandSuccess=function(){console.log('Message was sent to receiver ok.');};CastPlayer.prototype.onMediaDiscovered=function(how,mediaSession){console.log("chromecast new media session ID:"+mediaSession.mediaSessionId+' ('+how+')');this.currentMediaSession=mediaSession;if(how=='loadMedia'){this.castPlayerState=PLAYER_STATE.PLAYING;}
if(how=='activeSession'){this.castPlayerState=mediaSession.playerState;}
this.currentMediaSession.addUpdateListener(this.mediaStatusUpdateHandler);};CastPlayer.prototype.onLoadMediaError=function(e){console.log("chromecast media error");this.castPlayerState=PLAYER_STATE.IDLE;};CastPlayer.prototype.onMediaStatusUpdate=function(e){if(e==false){this.castPlayerState=PLAYER_STATE.IDLE;}
console.log("chromecast updating media: "+e);};CastPlayer.prototype.playMedia=function(){if(!this.currentMediaSession){return;}
this.currentMediaSession.play(null,this.mediaCommandSuccessCallback.bind(this,"playing started for "+this.currentMediaSession.sessionId),this.errorHandler);};CastPlayer.prototype.pauseMedia=function(){if(!this.currentMediaSession){return;}
this.currentMediaSession.pause(null,this.mediaCommandSuccessCallback.bind(this,"paused "+this.currentMediaSession.sessionId),this.errorHandler);};CastPlayer.prototype.stopMedia=function(){if(!this.currentMediaSession){return;}
this.currentMediaSession.stop(null,this.mediaCommandSuccessCallback.bind(this,"stopped "+this.currentMediaSession.sessionId),this.errorHandler);this.castPlayerState=PLAYER_STATE.STOPPED;};CastPlayer.prototype.setReceiverVolume=function(mute,vol){if(!this.currentMediaSession){return;}
if(!mute){this.session.setReceiverVolumeLevel((vol||1),this.mediaCommandSuccessCallback.bind(this),this.errorHandler);}
else{this.session.setReceiverMuted(true,this.mediaCommandSuccessCallback.bind(this),this.errorHandler);}};CastPlayer.prototype.mute=function(){this.audio=false;this.setReceiverVolume(true);};CastPlayer.prototype.seekMedia=function(event){var pos=parseInt(event);var curr=pos/10000000;if(!this.currentMediaSession){return;}
var request=new chrome.cast.media.SeekRequest();request.currentTime=curr;this.currentMediaSession.seek(request,this.onSeekSuccess.bind(this,'media seek done'),this.errorHandler);this.castPlayerState=PLAYER_STATE.SEEKING;};CastPlayer.prototype.onSeekSuccess=function(info){console.log(info);this.castPlayerState=PLAYER_STATE.PLAYING;};CastPlayer.prototype.mediaCommandSuccessCallback=function(info,e){console.log(info);};var castPlayer=new CastPlayer();function chromecastPlayer(){var self=this;self.name=PlayerName;self.getItemsForPlayback=function(query){var userId=Dashboard.getCurrentUserId();query.Limit=query.Limit||100;query.ExcludeLocationTypes="Virtual";return ApiClient.getItems(userId,query);};$(castPlayer).on("connect",function(e){console.log('cc: connect');self.lastPlayerData={};});$(castPlayer).on("playbackstart",function(e,data){console.log('cc: playbackstart');castPlayer.initializeCastPlayer();var state=self.getPlayerStateInternal(data);$(self).trigger("playbackstart",[state]);});$(castPlayer).on("playbackstop",function(e,data){console.log('cc: playbackstop');var state=self.getPlayerStateInternal(data);$(self).trigger("playbackstop",[state]);self.lastPlayerData={};});$(castPlayer).on("playbackprogress",function(e,data){console.log('cc: positionchange');var state=self.getPlayerStateInternal(data);$(self).trigger("positionchange",[state]);});self.play=function(options){Dashboard.getCurrentUser().done(function(user){if(options.items){self.playWithCommand(options,'PlayNow');}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){options.items=result.Items;self.playWithCommand(options,'PlayNow');});}});};self.playWithCommand=function(options,command){if(!options.items){ApiClient.getItem(Dashboard.getCurrentUserId(),options.ids[0]).done(function(item){options.items=[item];self.playWithCommand(options,command);});return;}
castPlayer.loadMedia(options,command);};self.unpause=function(){castPlayer.playMedia();};self.pause=function(){castPlayer.pauseMedia();};self.shuffle=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){self.playWithCommand({items:[item]},'Shuffle');});};self.instantMix=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){self.playWithCommand({items:[item]},'InstantMix');});};self.canQueueMediaType=function(mediaType){return mediaType=="Audio";};self.queue=function(options){self.playWithCommnd(options,'PlayLast');};self.queueNext=function(options){self.playWithCommand(options,'PlayNext');};self.stop=function(){castPlayer.stopMedia();};self.displayContent=function(options){castPlayer.sendMessage({options:options,command:'DisplayContent'});};self.mute=function(){castPlayer.mute();};self.unMute=function(){self.setVolume(getCurrentVolume()+2);};self.toggleMute=function(){var state=self.lastPlayerData||{};state=state.PlayState||{};if(state.IsMuted){self.unMute();}else{self.mute();}};self.getTargets=function(){var targets=[];if(castPlayer.hasReceivers){targets.push(self.getCurrentTargetInfo());}
return targets;};self.getCurrentTargetInfo=function(){var appName=null;if(castPlayer.session&&castPlayer.session.receiver&&castPlayer.session.receiver.friendlyName){appName=castPlayer.session.receiver.friendlyName;}
return{name:PlayerName,id:PlayerName,playerName:PlayerName,playableMediaTypes:["Audio","Video"],isLocalPlayer:false,appName:PlayerName,deviceName:appName,supportedCommands:["VolumeUp","VolumeDown","Mute","Unmute","ToggleMute","SetVolume","SetAudioStreamIndex","SetSubtitleStreamIndex","DisplayContent"]};};self.seek=function(position){castPlayer.seekMedia(position);};self.setAudioStreamIndex=function(index){castPlayer.sendMessage({options:{index:index},command:'SetAudioStreamIndex'});};self.setSubtitleStreamIndex=function(index){castPlayer.sendMessage({options:{index:index},command:'SetSubtitleStreamIndex'});};self.nextTrack=function(){castPlayer.sendMessage({options:{},command:'NextTrack'});};self.previousTrack=function(){castPlayer.sendMessage({options:{},command:'PreviousTrack'});};self.beginPlayerUpdates=function(){};self.endPlayerUpdates=function(){};function getCurrentVolume(){var state=self.lastPlayerData||{};state=state.PlayState||{};return state.VolumeLevel==null?100:state.VolumeLevel;}
self.volumeDown=function(){self.setVolume(getCurrentVolume()-2);};self.volumeUp=function(){self.setVolume(getCurrentVolume()+2);};self.setVolume=function(vol){vol=Math.min(vol,100);vol=Math.max(vol,0);castPlayer.setReceiverVolume(false,(vol/100));};self.getPlayerState=function(){var deferred=$.Deferred();var result=self.getPlayerStateInternal();deferred.resolveWith(null,[result]);return deferred.promise();};self.lastPlayerData={};self.getPlayerStateInternal=function(data){data=data||self.lastPlayerData;self.lastPlayerData=data;console.log(JSON.stringify(data));return data;};}
MediaController.registerPlayer(new chromecastPlayer());$(MediaController).on('playerchange',function(){if(MediaController.getPlayerInfo().name==PlayerName){if(castPlayer.deviceState!=DEVICE_STATE.ACTIVE&&castPlayer.isInitialized){castPlayer.launchApp();}}});})(window,window.chrome,console);(function($,document){function getElement(){var elem=$('.backdropContainer');if(!elem.length){elem=$('<div class="backdropContainer"></div>').prependTo(document.body);}
return elem;}
function getRandom(min,max){return Math.floor(Math.random()*(max-min)+min);}
function getBackdropItemIds(apiClient,userId,types,parentId){var key='backdrops2_'+userId+(types||'')+(parentId||'');var deferred=$.Deferred();var data=sessionStore.getItem(key);if(data){console.log('Found backdrop id list in cache. Key: '+key)
data=JSON.parse(data);deferred.resolveWith(null,[data]);}else{var options={SortBy:"IsFavoriteOrLiked,Random",Limit:20,Recursive:true,IncludeItemTypes:types,ImageTypes:"Backdrop",ParentId:parentId};apiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var images=result.Items.map(function(i){return{id:i.Id,tag:i.BackdropImageTags[0]};});sessionStore.setItem(key,JSON.stringify(images));deferred.resolveWith(null,[images]);});}
return deferred.promise();}
function showBackdrop(type,parentId){var apiClient=ConnectionManager.currentApiClient();if(!apiClient){return;}
getBackdropItemIds(apiClient,Dashboard.getCurrentUserId(),type,parentId).done(function(images){if(images.length){var index=getRandom(0,images.length-1);var item=images[index];var screenWidth=$(window).width();var imgUrl=apiClient.getScaledImageUrl(item.id,{type:"Backdrop",tag:item.tag,maxWidth:screenWidth,quality:80});getElement().css('backgroundImage','url(\''+imgUrl+'\')');}else{clearBackdrop();}});}
function clearBackdrop(){$('.backdropContainer').css('backgroundImage','');}
function enabled(){if($.browser.msie){return false;}
var userId=Dashboard.getCurrentUserId();var val=store.getItem('enableBackdrops-'+userId);return val=='1'||(val!='0'&&!$.browser.mobile);}
function setBackdrops(page,items){var images=items.filter(function(i){return i.BackdropImageTags.length>0;}).map(function(i){return{id:i.Id,tag:i.BackdropImageTags[0]};});if(images.length){$(page).addClass('backdropPage');var index=getRandom(0,images.length-1);var item=images[index];var screenWidth=$(window).width();var imgUrl=ApiClient.getScaledImageUrl(item.id,{type:"Backdrop",tag:item.tag,maxWidth:screenWidth,quality:80});getElement().css('backgroundImage','url(\''+imgUrl+'\')');}else{$(page).removeClass('backdropPage');}}
$(document).on('pagebeforeshow',".page",function(){var page=this;var $page=$(page);if(!$page.hasClass('staticBackdropPage')){if($page.hasClass('backdropPage')){if(enabled()){var type=page.getAttribute('data-backdroptype');var parentId=$page.hasClass('globalBackdropPage')?'':LibraryMenu.getTopParentId();showBackdrop(type,parentId);}else{$page.removeClass('backdropPage');clearBackdrop();}}else{clearBackdrop();}}});window.Backdrops={setBackdrops:setBackdrops};})(jQuery,document);(function(window,$){var currentDialogOptions;function submitJob(userId,syncOptions,form){if(!userId){throw new Error('userId cannot be null');}
if(!syncOptions){throw new Error('syncOptions cannot be null');}
if(!form){throw new Error('form cannot be null');}
var target=$('#selectSyncTarget',form).val();if(!target){Dashboard.alert(Globalize.translate('MessagePleaseSelectDeviceToSyncTo'));return;}
var options={userId:userId,TargetId:target,ParentId:syncOptions.ParentId,Category:syncOptions.Category};setJobValues(options,form);if(syncOptions.items&&syncOptions.items.length){options.ItemIds=(syncOptions.items||[]).map(function(i){return i.Id||i;}).join(',');}
ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Sync/Jobs"),data:JSON.stringify(options),contentType:"application/json"}).done(function(){$('.syncPanel').panel('close');$(window.SyncManager).trigger('jobsubmit');Dashboard.alert(Globalize.translate('MessageSyncJobCreated'));});}
function setJobValues(job,form){var bitrate=$('#txtBitrate',form).val()||null;if(bitrate){bitrate=parseFloat(bitrate)*1000000;}
job.Name=$('#txtSyncJobName',form).val();job.Quality=$('#selectQuality',form).val()||null;job.Profile=$('#selectProfile',form).val()||null;job.Bitrate=bitrate;job.ItemLimit=$('#txtItemLimit',form).val()||null;job.SyncNewContent=$('#chkSyncNewContent',form).checked();job.UnwatchedOnly=$('#chkUnwatchedOnly',form).checked();}
function renderForm(options){var elem=options.elem;var dialogOptions=options.dialogOptions;var targets=dialogOptions.Targets;var html='';if(options.showName||dialogOptions.Options.indexOf('Name')!=-1){html+='<p>';html+='<label for="txtSyncJobName">'+Globalize.translate('LabelSyncJobName')+'</label>';html+='<input type="text" id="txtSyncJobName" class="txtSyncJobName" required="required" />';html+='</p>';}
html+='<div>';html+='<label for="selectSyncTarget">'+Globalize.translate('LabelSyncTo')+'</label>';if(options.readOnlySyncTarget){html+='<input type="text" id="selectSyncTarget" readonly="readonly" />';}else{html+='<select id="selectSyncTarget" required="required" data-mini="true">';html+=targets.map(function(t){return'<option value="'+t.Id+'">'+t.Name+'</option>';}).join('');html+='</select>';if(!targets.length){html+='<div class="fieldDescription">'+Globalize.translate('LabelSyncNoTargetsHelp')+'</div>';html+='<div class="fieldDescription"><a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank">'+Globalize.translate('ButtonLearnMore')+'</a></div>';}}
html+='</div>';html+='<div class="fldProfile" style="display:none;">';html+='<br/>';html+='<label for="selectProfile">'+Globalize.translate('LabelProfile')+'</label>';html+='<select id="selectProfile" data-mini="true">';html+='</select>';html+='<div class="fieldDescription profileDescription"></div>';html+='</div>';html+='<div class="fldQuality" style="display:none;">';html+='<br/>';html+='<label for="selectQuality">'+Globalize.translate('LabelQuality')+'</label>';html+='<select id="selectQuality" data-mini="true" required="required">';html+='</select>';html+='<div class="fieldDescription qualityDescription"></div>';html+='</div>';html+='<div class="fldBitrate" style="display:none;">';html+='<br/>';html+='<div>';html+='<label for="txtBitrate">'+Globalize.translate('LabelBitrateMbps')+'</label>';html+='<input type="number" id="txtBitrate" step=".1" min=".1" />';html+='</div>';html+='</div>';if(dialogOptions.Options.indexOf('SyncNewContent')!=-1){html+='<br/>';html+='<div>';html+='<label for="chkSyncNewContent">'+Globalize.translate('OptionAutomaticallySyncNewContent')+'</label>';html+='<input type="checkbox" id="chkSyncNewContent" data-mini="true" checked="checked" />';html+='<div class="fieldDescription">'+Globalize.translate('OptionAutomaticallySyncNewContentHelp')+'</div>';html+='</div>';}
if(dialogOptions.Options.indexOf('UnwatchedOnly')!=-1){html+='<br/>';html+='<div>';html+='<label for="chkUnwatchedOnly">'+Globalize.translate('OptionSyncUnwatchedVideosOnly')+'</label>';html+='<input type="checkbox" id="chkUnwatchedOnly" data-mini="true" />';html+='<div class="fieldDescription">'+Globalize.translate('OptionSyncUnwatchedVideosOnlyHelp')+'</div>';html+='</div>';}
if(dialogOptions.Options.indexOf('ItemLimit')!=-1){html+='<br/>';html+='<div>';html+='<label for="txtItemLimit">'+Globalize.translate('LabelItemLimit')+'</label>';html+='<input type="number" id="txtItemLimit" step="1" min="1" />';html+='<div class="fieldDescription">'+Globalize.translate('LabelItemLimitHelp')+'</div>';html+='</div>';}
$(elem).html(html).trigger('create');$('#selectSyncTarget',elem).on('change',function(){loadQualityOptions(elem,this.value,options.dialogOptionsFn);}).trigger('change');$('#selectProfile',elem).on('change',function(){onProfileChange(elem,this.value);}).trigger('change');$('#selectQuality',elem).on('change',function(){onQualityChange(elem,this.value);}).trigger('change');}
function showSyncMenu(options){var userId=Dashboard.getCurrentUserId();var dialogOptionsQuery={UserId:userId,ItemIds:(options.items||[]).map(function(i){return i.Id||i;}).join(','),ParentId:options.ParentId,Category:options.Category};ApiClient.getJSON(ApiClient.getUrl('Sync/Options',dialogOptionsQuery)).done(function(dialogOptions){currentDialogOptions=dialogOptions;var html='<div data-role="panel" data-position="right" data-display="overlay" class="syncPanel" data-position-fixed="true" data-theme="a">';html+='<div>';html+='<form class="formSubmitSyncRequest">';html+='<div style="margin:1em 0 1.5em;">';html+='<h1 style="margin: 0;display:inline-block;vertical-align:middle;">'+Globalize.translate('SyncMedia')+'</h1>';html+='<a class="accentButton accentButton-g" style="display:inline-block;vertical-align:middle;margin-top:0;margin-left: 20px;" href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank">';html+='<i class="fa fa-info-circle"></i>';html+=Globalize.translate('ButtonHelp');html+='</a>';html+='</div>';html+='<div class="formFields"></div>';html+='<br/>';html+='<p>';html+='<button type="submit" data-icon="cloud" data-theme="b">'+Globalize.translate('ButtonSync')+'</button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';$(document.body).append(html);var elem=$('.syncPanel').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});$('form',elem).on('submit',function(){submitJob(userId,options,this);return false;});renderForm({elem:$('.formFields',elem),dialogOptions:dialogOptions,dialogOptionsFn:getTargetDialogOptionsFn(dialogOptionsQuery)});});}
function getTargetDialogOptionsFn(query){return function(targetId){query.TargetId=targetId;return ApiClient.getJSON(ApiClient.getUrl('Sync/Options',query));};}
function onProfileChange(form,profileId){var options=currentDialogOptions||{};var option=(options.ProfileOptions||[]).filter(function(o){return o.Id==profileId;})[0];if(option){$('.profileDescription',form).html(option.Description||'');setQualityFieldVisible(form,options.QualityOptions.length>0&&option.EnableQualityOptions&&options.Options.indexOf('Quality')!=-1);}else{$('.profileDescription',form).html('');setQualityFieldVisible(form,options.QualityOptions.length>0&&options.Options.indexOf('Quality')!=-1);}}
function onQualityChange(form,qualityId){var options=currentDialogOptions||{};var option=(options.QualityOptions||[]).filter(function(o){return o.Id==qualityId;})[0];if(option){$('.qualityDescription',form).html(option.Description||'');}else{$('.qualityDescription',form).html('');}
if(qualityId=='custom'){$('.fldBitrate',form).show();$('#txtBitrate',form).attr('required','required');}else{$('.fldBitrate',form).hide();$('#txtBitrate',form).removeAttr('required').val('');}}
function loadQualityOptions(form,targetId,dialogOptionsFn){dialogOptionsFn(targetId).done(function(options){renderTargetDialogOptions(form,options);});}
function setQualityFieldVisible(form,visible){if(visible){$('.fldQuality',form).show();$('#selectQuality',form).attr('required','required');}else{$('.fldQuality',form).hide();$('#selectQuality',form).removeAttr('required');}}
function renderTargetDialogOptions(form,options){currentDialogOptions=options;if(options.ProfileOptions.length&&options.Options.indexOf('Profile')!=-1){$('.fldProfile',form).show();$('#selectProfile',form).attr('required','required');}else{$('.fldProfile',form).hide();$('#selectProfile',form).removeAttr('required');}
setQualityFieldVisible(options.QualityOptions.length>0);$('#selectProfile',form).html(options.ProfileOptions.map(function(o){var selectedAttribute=o.IsDefault?' selected="selected"':'';return'<option value="'+o.Id+'"'+selectedAttribute+'>'+o.Name+'</option>';}).join('')).trigger('change').selectmenu('refresh');$('#selectQuality',form).html(options.QualityOptions.map(function(o){var selectedAttribute=o.IsDefault?' selected="selected"':'';return'<option value="'+o.Id+'"'+selectedAttribute+'>'+o.Name+'</option>';}).join('')).trigger('change').selectmenu('refresh');}
function isAvailable(item,user){return item.SupportsSync;}
window.SyncManager={showMenu:showSyncMenu,isAvailable:isAvailable,renderForm:renderForm,setJobValues:setJobValues};function showSyncButtonsPerUser(page){var apiClient=ConnectionManager.currentApiClient();if(!apiClient){return;}
Dashboard.getCurrentUser().done(function(user){if(user.Policy.EnableSync){$('.categorySyncButton',page).show();}else{$('.categorySyncButton',page).hide();}});}
function onCategorySyncButtonClick(page,button){var category=button.getAttribute('data-category');var parentId=LibraryMenu.getTopParentId();SyncManager.showMenu({ParentId:parentId,Category:category});}
$(document).on('pageinit',".libraryPage",function(){var page=this;$('.categorySyncButton',page).on('click',function(){onCategorySyncButtonClick(page,this);});}).on('pagebeforeshow',".libraryPage",function(){var page=this;showSyncButtonsPerUser(page);});})(window,jQuery);(function(){function renderJob(page,job,dialogOptions){var html='';html+='<div>';html+=Globalize.translate('ValueDateCreated',parseISO8601Date(job.DateCreated,{toLocal:true}).toLocaleString());html+='</div>';html+='<br/>';html+='<div class="formFields"></div>';html+='<br/>';html+='<br/>';html+='<button type="submit" data-icon="check">'+Globalize.translate('ButtonSave')+'</button>';$('.syncJobForm',page).html(html).trigger('create');SyncManager.renderForm({elem:$('.formFields',page),dialogOptions:dialogOptions,dialogOptionsFn:getTargetDialogOptionsFn(dialogOptions),showName:true,readOnlySyncTarget:true});fillJobValues(page,job,dialogOptions);}
function getTargetDialogOptionsFn(dialogOptions){return function(targetId){var deferred=$.Deferred();deferred.resolveWith(null,[dialogOptions]);return deferred.promise();};}
function getJobItemHtml(jobItem,index){var html='';var cssClass='ui-li-has-thumb listItem';html+='<li class="'+cssClass+'"'+' data-itemid="'+jobItem.Id+'" data-status="'+jobItem.Status+'" data-remove="'+jobItem.IsMarkedForRemoval+'">';var hasActions=['Queued','Cancelled','Failed','ReadyToTransfer','Transferring','Converting','Synced'].indexOf(jobItem.Status)!=-1;html+='<a href="#">';var imgUrl;if(jobItem.PrimaryImageItemId){imgUrl=ApiClient.getImageUrl(jobItem.PrimaryImageItemId,{type:"Primary",width:80,tag:jobItem.PrimaryImageTag,minScale:1.5});}
if(imgUrl){if(index<10){html+='<div class="listviewImage ui-li-thumb" style="background-image:url(\''+imgUrl+'\');"></div>';}else{html+='<div class="listviewImage ui-li-thumb lazy" data-src="'+imgUrl+'"></div>';}}
html+='<h3>';html+=jobItem.ItemName;html+='</h3>';if(jobItem.Status=='Failed'){html+='<p style="color:red;">';}else{html+='<p>';}
html+=Globalize.translate('SyncJobItemStatus'+jobItem.Status);if(jobItem.Status=='Synced'&&jobItem.IsMarkedForRemoval){html+='<br/>';html+=Globalize.translate('SyncJobItemStatusSyncedMarkForRemoval');}
html+='</p>';html+='</a>';if(hasActions){html+='<a href="#" data-icon="ellipsis-v" class="listviewMenuButton btnJobItemMenu">';}else{html+='<a href="#" data-icon="ellipsis-v" class="listviewMenuButton btnJobItemMenu" style="visibility:hidden;">';}
html+='</a>';html+='</li>';return html;}
function renderJobItems(page,items){var html='';html+='<ul data-role="listview" class="itemsListview">';html+='<li data-role="list-divider">';html+=Globalize.translate('HeaderItems');html+='</li>';var index=0;html+=items.map(function(i){return getJobItemHtml(i,index++);}).join('');html+='</ul>';var elem=$('.jobItems',page).html(html).trigger('create');$(".lazy",elem).unveil(200);$('.btnJobItemMenu',elem).on('click',function(){showJobItemMenu(this);});}
function showJobItemMenu(elem){var page=$(elem).parents('.page');var listItem=$(elem).parents('li');var id=listItem.attr('data-itemid');var status=listItem.attr('data-status');var remove=listItem.attr('data-remove').toLowerCase()=='true';$('.jobMenu',page).popup("close").remove();var html='<div data-role="popup" class="jobMenu tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';if(status=='Failed'){html+='<li data-icon="check"><a href="#" class="btnRetryJobItem" data-id="'+id+'">'+Globalize.translate('ButtonQueueForRetry')+'</a></li>';}
else if(status=='Cancelled'){html+='<li data-icon="check"><a href="#" class="btnRetryJobItem" data-id="'+id+'">'+Globalize.translate('ButtonReenable')+'</a></li>';}
else if(status=='Queued'||status=='Transferring'||status=='Converting'||status=='ReadyToTransfer'){html+='<li data-icon="delete"><a href="#" class="btnCancelJobItem" data-id="'+id+'">'+Globalize.translate('ButtonCancelItem')+'</a></li>';}
else if(status=='Synced'&&remove){html+='<li data-icon="check"><a href="#" class="btnUnmarkForRemoval" data-id="'+id+'">'+Globalize.translate('ButtonUnmarkForRemoval')+'</a></li>';}
else if(status=='Synced'){html+='<li data-icon="check"><a href="#" class="btnMarkForRemoval" data-id="'+id+'">'+Globalize.translate('ButtonMarkForRemoval')+'</a></li>';}
html+='</ul>';html+='</div>';page.append(html);var flyout=$('.jobMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnCancelJobItem',flyout).on('click',function(){cancelJobItem(page,this.getAttribute('data-id'));});$('.btnRetryJobItem',flyout).on('click',function(){retryJobItem(page,this.getAttribute('data-id'));});$('.btnUnmarkForRemoval',flyout).on('click',function(){unMarkForRemoval(page,this.getAttribute('data-id'));});$('.btnMarkForRemoval',flyout).on('click',function(){markForRemoval(page,this.getAttribute('data-id'));});}
function cancelJobItem(page,jobItemId){$('.jobMenu',page).popup('close');Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl('Sync/JobItems/'+jobItemId)}).done(function(){loadJob(page);});}
function markForRemoval(page,jobItemId){$('.jobMenu',page).popup('close');ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Sync/JobItems/'+jobItemId+'/MarkForRemoval')}).done(function(){loadJob(page);});}
function unMarkForRemoval(page,jobItemId){$('.jobMenu',page).popup('close');ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Sync/JobItems/'+jobItemId+'/UnmarkForRemoval')}).done(function(){loadJob(page);});}
function retryJobItem(page,jobItemId){$('.jobMenu',page).popup('close');ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Sync/JobItems/'+jobItemId+'/Enable')}).done(function(){loadJob(page);});}
function fillJobValues(page,job,editOptions){$('#txtSyncJobName',page).val(job.Name);$('#selectProfile',page).val(job.Profile||'').trigger('change').selectmenu('refresh');$('#selectQuality',page).val(job.Quality||'').trigger('change').selectmenu('refresh');$('#chkUnwatchedOnly',page).checked(job.UnwatchedOnly).checkboxradio('refresh');$('#chkSyncNewContent',page).checked(job.SyncNewContent).checkboxradio('refresh');$('#txtItemLimit',page).val(job.ItemLimit);if(job.Bitrate){$('#txtBitrate',page).val(job.Bitrate/1000000);}else{$('#txtBitrate',page).val('');}
var target=editOptions.Targets.filter(function(t){return t.Id==job.TargetId;})[0];var targetName=target?target.Name:'';$('#selectSyncTarget',page).val(targetName);}
var _jobOptions;function loadJob(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getJSON(ApiClient.getUrl('Sync/Jobs/'+id)).done(function(job){ApiClient.getJSON(ApiClient.getUrl('Sync/Options',{UserId:job.UserId,ItemIds:(job.RequestedItemIds&&job.RequestedItemIds.length?job.RequestedItemIds.join(''):null),ParentId:job.ParentId,Category:job.Category,TargetId:job.TargetId})).done(function(options){_jobOptions=options;renderJob(page,job,options);Dashboard.hideLoadingMsg();});});ApiClient.getJSON(ApiClient.getUrl('Sync/JobItems',{JobId:id,AddMetadata:true})).done(function(result){renderJobItems(page,result.Items);Dashboard.hideLoadingMsg();});}
function loadJobInfo(page,job,jobItems){renderJob(page,job,_jobOptions);renderJobItems(page,jobItems);Dashboard.hideLoadingMsg();}
function saveJob(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getJSON(ApiClient.getUrl('Sync/Jobs/'+id)).done(function(job){SyncManager.setJobValues(job,page);ApiClient.ajax({url:ApiClient.getUrl('Sync/Jobs/'+id),type:'POST',data:JSON.stringify(job),contentType:"application/json"}).done(function(){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('SettingsSaved'));});});}
function onWebSocketMessage(e,msg){var page=$.mobile.activePage;if(msg.MessageType=="SyncJob"){loadJobInfo(page,msg.Data.Job,msg.Data.JobItems);}}
function startListening(page){var startParams="0,1500";startParams+=","+getParameterByName('id');if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SyncJobStart",startParams);}}
function stopListening(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SyncJobStop","");}}
$(document).on('pageshow',".syncJobPage",function(){var page=this;loadJob(page);startListening(page);$(ApiClient).on("websocketmessage.syncJobPage",onWebSocketMessage);}).on('pagehide',".syncJobPage",function(){var page=this;stopListening();$(ApiClient).off(".syncJobPage");});window.SyncJobPage={onSubmit:function(){var form=this;var page=$(form).parents('.page');saveJob(page);return false;}};})();(function($,document){function reloadList(page){Dashboard.showLoadingMsg();var promise1=ApiClient.getAvailablePlugins({TargetSystems:'Server'});var promise2=ApiClient.getInstalledPlugins();$.when(promise1,promise2).done(function(response1,response2){renderInstalled(page,response1[0],response2[0]);renderCatalog(page,response1[0],response2[0]);});}
function getCategories(){var context=getParameterByName('context');var categories=[];if(context=='sync'){categories.push('Sync');}
else if(context=='livetv'){categories.push('Live TV');}
else if(context=='notifications'){categories.push('Notifications');}
return categories;}
function renderInstalled(page,availablePlugins,installedPlugins){var category=getCategories()[0];installedPlugins=installedPlugins.filter(function(i){var catalogEntry=availablePlugins.filter(function(a){return a.guid==i.Id;})[0];return catalogEntry&&catalogEntry.category==category;});PluginsPage.renderPlugins(page,installedPlugins);}
function renderCatalog(page,availablePlugins,installedPlugins){var categories=getCategories();PluginCatalog.renderCatalog({catalogElement:$('.catalog',page),availablePlugins:availablePlugins,installedPlugins:installedPlugins,categories:categories,showCategory:false,context:getParameterByName('context'),targetSystem:'Server'});}
$(document).on('pagebeforeshow pageinit pageshow',"#appServicesPage",function(){var page=this;var context=getParameterByName('context');$('.sectionTabs',page).hide();$('.'+context+'SectionTabs',page).show();if(context=='sync'){Dashboard.setPageTitle(Globalize.translate('TitleSync'));page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Sync');}
else if(context=='livetv'){Dashboard.setPageTitle(Globalize.translate('TitleLiveTV'));page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Live%20TV');}
else if(context=='notifications'){Dashboard.setPageTitle(Globalize.translate('TitleNotifications'));page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Notifications');}}).on('pageshow',"#appServicesPage",function(){var page=this;reloadList(page);var context=getParameterByName('context');Dashboard.getPluginSecurityInfo().done(function(pluginSecurityInfo){if(pluginSecurityInfo.IsMBSupporter||context!='sync'){$('.syncPromotion',page).hide();}else{$('.syncPromotion',page).show();}});});})(jQuery,document);(function($,document){var lastPlaylistId='';function redirectToPlaylist(id){var context=getParameterByName('context');ApiClient.getItem(Dashboard.getCurrentUserId(),id).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,context));});}
function onAddToPlaylistFormSubmit(){Dashboard.showLoadingMsg();var panel=$(this).parents('.newPlaylistPanel');var playlistId=$('select.selectPlaylistToAddTo',panel).val();if(playlistId){lastPlaylistId=playlistId;addToPlaylist(panel,playlistId);}else{createPlaylist(panel);}
return false;}
function getNewPlaylistPanel(){Dashboard.showLoadingMsg();$('.newPlaylistPanel').panel('destroy').remove();var html='<div data-role="panel" data-position="right" data-display="overlay" class="newPlaylistPanel" data-position-fixed="true" data-theme="a">';html+='<h3>'+Globalize.translate('HeaderAddToPlaylist')+'</h3>';html+='<br />';html+='<form class="addToPlaylistForm">';var selectId='selectPlaylistToAddTo'+new Date().getTime();html+='<div>';html+='<label for="'+selectId+'">'+Globalize.translate('LabelSelectPlaylist')+'</label>';html+='<select id="'+selectId+'" class="selectPlaylistToAddTo" data-mini="true">';html+='</select>';html+='</div>';html+='<br />';html+='<div class="fldNewPlaylist" style="display:none;">';html+='<label for="txtNewPlaylistName">'+Globalize.translate('LabelName')+'</label>';html+='<input type="text" id="txtNewPlaylistName" />';html+='</div>';html+='<p>';html+='<input class="fldSelectedItemIds" type="hidden" />';html+='<button type="submit" data-icon="plus" data-mini="true" data-theme="b">'+Globalize.translate('ButtonSubmit')+'</button>';html+='</p>';html+='</form>';html+='</div>';$(document.body).append(html);var elem=$('.newPlaylistPanel').panel({}).trigger('create').on("panelclose",function(){$(this).off("panelclose").remove();});var select=$('#'+selectId,elem).on('change',function(){if(this.value){$('.fldNewPlaylist',elem).hide();$('input',elem).removeAttr('required');}else{$('.fldNewPlaylist',elem).show();$('input',elem).attr('required','required');}}).trigger('change');ApiClient.getItems(Dashboard.getCurrentUserId(),{IncludeItemTypes:'Playlist',recursive:true,SortBy:'SortName'}).done(function(result){var selectHtml='<option value="">'+Globalize.translate('OptionNewPlaylist')+'</option>';selectHtml+=result.Items.map(function(o){return'<option value="'+o.Id+'">'+o.Name+'</option>';}).join('');select.html(selectHtml).selectmenu('refresh');select.val(lastPlaylistId||'').selectmenu('refresh').trigger('change');Dashboard.hideLoadingMsg();});$('form',elem).on('submit',onAddToPlaylistFormSubmit);return elem;}
function showNewPlaylistPanel(items){var panel=getNewPlaylistPanel().panel('toggle');$('.fldSelectedItemIds',panel).val(items.join(','));populatePlaylists(panel);}
function populatePlaylists(panel){var select=$('select.selectPlaylistToAddTo',panel);if(!select.length){$('#txtNewPlaylistName',panel).val('').focus();return;}
$('.newPlaylistInfo',panel).hide();var options={Recursive:true,IncludeItemTypes:"Playlist",SortBy:'SortName'};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var html='';html+='<option value="">'+Globalize.translate('OptionNewPlaylist')+'</option>';html+=result.Items.map(function(i){return'<option value="'+i.Id+'">'+i.Name+'</option>';});select.html(html).val('').selectmenu('refresh').trigger('change');});}
function createPlaylist(panel){var url=ApiClient.getUrl("Playlists",{Name:$('#txtNewPlaylistName',panel).val(),Ids:$('.fldSelectedItemIds',panel).val()||'',userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:url,dataType:"json"}).done(function(result){Dashboard.hideLoadingMsg();var id=result.Id;panel.panel('toggle');redirectToPlaylist(id);});}
function addToPlaylist(panel,id){var url=ApiClient.getUrl("Playlists/"+id+"/Items",{Ids:$('.fldSelectedItemIds',panel).val()||'',userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:url}).done(function(){Dashboard.hideLoadingMsg();panel.panel('toggle');Dashboard.alert(Globalize.translate('MessageAddedToPlaylistSuccess'));});}
window.PlaylistManager={showPanel:function(items){showNewPlaylistPanel(items);},supportsPlaylists:function(item){if(item.Type=='Program'){return false;}
return item.RunTimeTicks||item.IsFolder||item.Type=="Genre"||item.Type=="MusicGenre"||item.Type=="MusicArtist";}};})(jQuery,document);(function(document,setTimeout,clearTimeout,screen,store,$,setInterval,window){function mediaPlayer(){var self=this;var testableVideoElement=document.createElement('video');var currentProgressInterval;var canClientSeek;var currentPlaylistIndex=0;self.currentMediaElement=null;self.currentItem=null;self.currentMediaSource=null;self.currentDurationTicks=null;self.startTimeTicksOffset=null;self.playlist=[];self.isLocalPlayer=true;self.isDefaultPlayer=true;self.name='Html5 Player';self.getTargets=function(){var targets=[{name:'My Browser',id:ConnectionManager.deviceId(),playerName:self.name,playableMediaTypes:['Audio','Video'],isLocalPlayer:true,supportedCommands:Dashboard.getSupportedRemoteCommands()}];return targets;};var supportsAac=document.createElement('audio').canPlayType('audio/aac').replace(/no/,'');self.getVideoQualityOptions=function(videoWidth){var bitrateSetting=AppSettings.maxStreamingBitrate();var maxAllowedWidth=videoWidth||4096;var options=[];if(maxAllowedWidth>=1900){options.push({name:'1080p - 30Mbps',maxWidth:1920,bitrate:30000000});options.push({name:'1080p - 25Mbps',maxWidth:1920,bitrate:25000000});options.push({name:'1080p - 20Mbps',maxWidth:1920,bitrate:20000000});options.push({name:'1080p - 15Mbps',maxWidth:1920,bitrate:15000000});options.push({name:'1080p - 10Mbps',maxWidth:1920,bitrate:10000000});options.push({name:'1080p - 8Mbps',maxWidth:1920,bitrate:8000000});options.push({name:'1080p - 6Mbps',maxWidth:1920,bitrate:6000000});options.push({name:'1080p - 5Mbps',maxWidth:1920,bitrate:5000000});}else if(maxAllowedWidth>=1260){options.push({name:'720p - 10Mbps',maxWidth:1280,bitrate:10000000});options.push({name:'720p - 8Mbps',maxWidth:1280,bitrate:8000000});options.push({name:'720p - 6Mbps',maxWidth:1280,bitrate:6000000});options.push({name:'720p - 5Mbps',maxWidth:1280,bitrate:5000000});}else if(maxAllowedWidth>=460){options.push({name:'480p - 4Mbps',maxWidth:720,bitrate:4000000});options.push({name:'480p - 3Mbps',maxWidth:720,bitrate:3000000});options.push({name:'480p - 2.5Mbps',maxWidth:720,bitrate:2500000});options.push({name:'480p - 2Mbps',maxWidth:720,bitrate:2000000});options.push({name:'480p - 1.5Mbps',maxWidth:720,bitrate:1500000});}
if(maxAllowedWidth>=1260){options.push({name:'720p - 4Mbps',maxWidth:1280,bitrate:4000000});options.push({name:'720p - 3Mbps',maxWidth:1280,bitrate:3000000});options.push({name:'720p - 2Mbps',maxWidth:1280,bitrate:2000000});options.push({name:'720p - 1.5Mbps',maxWidth:1280,bitrate:1500001});options.push({name:'720p - 1Mbps',maxWidth:1280,bitrate:1000001});}
options.push({name:'480p - 1.0Mbps',maxWidth:720,bitrate:1000000});options.push({name:'480p - 720kbps',maxWidth:720,bitrate:720000});options.push({name:'480p - 420kbps',maxWidth:720,bitrate:420000});options.push({name:'360p',maxWidth:640,bitrate:400000});options.push({name:'240p',maxWidth:426,bitrate:320000});options.push({name:'144p',maxWidth:256,bitrate:192000});var i,length,option;var selectedIndex=-1;for(i=0,length=options.length;i<length;i++){option=options[i];if(selectedIndex==-1&&option.bitrate<=bitrateSetting){selectedIndex=i;}}
if(selectedIndex==-1){selectedIndex=options.length-1;}
options[selectedIndex].selected=true;return options;};self.getDeviceProfile=function(){var qualityOption=self.getVideoQualityOptions().filter(function(q){return q.selected;})[0];var bitrateSetting=AppSettings.maxStreamingBitrate();var canPlayWebm=self.canPlayWebm();var profile={};profile.MaxStreamingBitrate=bitrateSetting;profile.MaxStaticBitrate=40000000;profile.MusicStreamingTranscodingBitrate=Math.min(bitrateSetting,192000);profile.DirectPlayProfiles=[];profile.DirectPlayProfiles.push({Container:'mp4',Type:'Video',VideoCodec:'h264',AudioCodec:'aac,mp3'});if($.browser.chrome){profile.DirectPlayProfiles.push({Container:'mkv,m4v',Type:'Video',VideoCodec:'h264',AudioCodec:'aac,mp3'});}
profile.DirectPlayProfiles.push({Container:'mp3',Type:'Audio'});if(supportsAac){profile.DirectPlayProfiles.push({Container:'aac',Type:'Audio'});}
if(canPlayWebm){profile.DirectPlayProfiles.push({Container:'webm',Type:'Video'});profile.DirectPlayProfiles.push({Container:'webm,webma',Type:'Audio'});}
profile.TranscodingProfiles=[];profile.TranscodingProfiles.push({Container:'mp3',Type:'Audio',AudioCodec:'mp3',Context:'Streaming',Protocol:'http'});if(self.canPlayHls()){profile.TranscodingProfiles.push({Container:'ts',Type:'Video',AudioCodec:'aac',VideoCodec:'h264',Context:'Streaming',Protocol:'hls'});}
if(canPlayWebm){profile.TranscodingProfiles.push({Container:'webm',Type:'Video',AudioCodec:'vorbis',VideoCodec:'vpx',Context:'Streaming',Protocol:'http'});}
profile.TranscodingProfiles.push({Container:'mp4',Type:'Video',AudioCodec:'aac',VideoCodec:'h264',Context:'Streaming',Protocol:'http'});profile.ContainerProfiles=[];var audioConditions=[];var videoAudioAacConditions=[];var videoAudioMp3Conditions=[];var maxAudioChannels=$.browser.msie||$.browser.safari?'2':'6';var channelCondition={Condition:'LessThanEqual',Property:'AudioChannels',Value:maxAudioChannels};audioConditions.push(channelCondition);videoAudioAacConditions.push(channelCondition);videoAudioMp3Conditions.push(channelCondition);profile.CodecProfiles=[];profile.CodecProfiles.push({Type:'Audio',Conditions:audioConditions});if(videoAudioMp3Conditions.length){profile.CodecProfiles.push({Type:'VideoAudio',Codec:'mp3',Conditions:videoAudioMp3Conditions});}
videoAudioAacConditions.push({Condition:'NotEquals',Property:'AudioProfile',Value:'LC'});videoAudioAacConditions.push({Condition:'NotEquals',Property:'AudioProfile',Value:'HE-AAC'});profile.CodecProfiles.push({Type:'VideoAudio',Codec:'aac',Conditions:videoAudioAacConditions});profile.CodecProfiles.push({Type:'Video',Codec:'h264',Conditions:[{Condition:'NotEquals',Property:'IsAnamorphic',Value:'true',IsRequired:false},{Condition:'EqualsAny',Property:'VideoProfile',Value:'high|main|baseline|constrained baseline'},{Condition:'LessThanEqual',Property:'VideoLevel',Value:'41'},{Condition:'LessThanEqual',Property:'Width',Value:qualityOption.maxWidth}]});profile.CodecProfiles.push({Type:'Video',Codec:'vpx',Conditions:[{Condition:'NotEquals',Property:'IsAnamorphic',Value:'true',IsRequired:false},{Condition:'LessThanEqual',Property:'Width',Value:qualityOption.maxWidth}]});profile.SubtitleProfiles=[];if(self.supportsTextTracks()){profile.SubtitleProfiles.push({Format:'vtt',Method:'External'});}
return profile;};self.updateCanClientSeek=function(elem){var duration=elem.duration;canClientSeek=duration&&!isNaN(duration)&&duration!=Number.POSITIVE_INFINITY&&duration!=Number.NEGATIVE_INFINITY;};self.getCurrentSrc=function(mediaElement){return mediaElement.currentSrc;};self.getCurrentTicks=function(mediaElement){var playerTime=Math.floor(10000000*(mediaElement||self.currentMediaElement).currentTime);playerTime+=self.startTimeTicksOffset;return playerTime;};self.playNextAfterEnded=function(){self.nextTrack();};self.startProgressInterval=function(){clearProgressInterval();var intervalTime=ApiClient.isWebSocketOpen()?1200:5000;self.lastProgressReport=0;currentProgressInterval=setInterval(function(){if(self.currentMediaElement){if((new Date().getTime()-self.lastProgressReport)>intervalTime){self.lastProgressReport=new Date().getTime();sendProgressUpdate();}}},250);};self.getCurrentMediaExtension=function(currentSrc){currentSrc=currentSrc.split('?')[0];return currentSrc.substring(currentSrc.lastIndexOf('.'));};self.canPlayHls=function(){var media=testableVideoElement;if(media.canPlayType('application/x-mpegURL').replace(/no/,'')||media.canPlayType('application/vnd.apple.mpegURL').replace(/no/,'')){return true;}
return false;};self.changeStream=function(ticks,params){var element=self.currentMediaElement;if(canClientSeek&&params==null){element.currentTime=ticks/(1000*10000);return;}
params=params||{};var currentSrc=element.currentSrc;var playSessionId=getParameterByName('PlaySessionId',currentSrc);var liveStreamId=getParameterByName('LiveStreamId',currentSrc);if(params.AudioStreamIndex==null&&params.SubtitleStreamIndex==null&&params.Bitrate==null){currentSrc=replaceQueryString(currentSrc,'starttimeticks',ticks||0);changeStreamToUrl(element,playSessionId,currentSrc,ticks);return;}
var deviceProfile=self.getDeviceProfile();var audioStreamIndex=params.AudioStreamIndex==null?(getParameterByName('AudioStreamIndex',currentSrc)||null):params.AudioStreamIndex;if(typeof(audioStreamIndex)=='string'){audioStreamIndex=parseInt(audioStreamIndex);}
var subtitleStreamIndex=params.SubtitleStreamIndex==null?(getParameterByName('SubtitleStreamIndex',currentSrc)||null):params.SubtitleStreamIndex;if(typeof(subtitleStreamIndex)=='string'){subtitleStreamIndex=parseInt(subtitleStreamIndex);}
getPlaybackInfo(self.currentItem.Id,deviceProfile,ticks,self.currentMediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId).done(function(result){if(validatePlaybackInfoResult(result)){self.currentMediaSource=result.MediaSources[0];self.currentSubtitleStreamIndex=subtitleStreamIndex;currentSrc=ApiClient.getUrl(self.currentMediaSource.TranscodingUrl);changeStreamToUrl(element,playSessionId,currentSrc,ticks);}});};function changeStreamToUrl(element,playSessionId,url,newPositionTicks){clearProgressInterval();$(element).off('ended.playbackstopped').off('ended.playnext').one("play",function(){self.updateCanClientSeek(this);$(this).on('ended.playbackstopped',self.onPlaybackStopped).one('ended.playnext',self.playNextAfterEnded);self.startProgressInterval();sendProgressUpdate();});if(self.currentItem.MediaType=="Video"){ApiClient.stopActiveEncodings(playSessionId).done(function(){self.startTimeTicksOffset=newPositionTicks;element.src=url;});self.updateTextStreamUrls(newPositionTicks||0);}else{self.startTimeTicksOffset=newPositionTicks;element.src=url;element.play();}}
self.setCurrentTime=function(ticks,positionSlider,currentTimeElement){ticks=Math.floor(ticks);var timeText=Dashboard.getDisplayTime(ticks);if(self.currentDurationTicks){timeText+=" / "+Dashboard.getDisplayTime(self.currentDurationTicks);if(positionSlider){var percent=ticks/self.currentDurationTicks;percent*=100;positionSlider.val(percent).slider('enable').slider('refresh');}}else{if(positionSlider){positionSlider.slider('disable').slider('refresh');}}
if(currentTimeElement){currentTimeElement.html(timeText);}
var state=self.getPlayerStateInternal(self.currentMediaElement,self.currentItem,self.currentMediaSource);$(self).trigger('positionchange',[state]);};var supportsTextTracks;self.supportsTextTracks=function(){if(supportsTextTracks==null){supportsTextTracks=document.createElement('video').textTracks!=null;}
return supportsTextTracks;};self.canQueueMediaType=function(mediaType){return self.currentItem&&self.currentItem.MediaType==mediaType;};function translateItemsForPlayback(items){var deferred=$.Deferred();var firstItem=items[0];var promise;if(firstItem.Type=="Playlist"){promise=self.getItemsForPlayback({ParentId:firstItem.Id,});}
else if(firstItem.Type=="MusicArtist"){promise=self.getItemsForPlayback({ArtistIds:firstItem.Id,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio"});}
else if(firstItem.Type=="MusicGenre"){promise=self.getItemsForPlayback({Genres:firstItem.Name,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio"});}
else if(firstItem.IsFolder){promise=self.getItemsForPlayback({ParentId:firstItem.Id,Filters:"IsNotFolder",Recursive:true,SortBy:"SortName",MediaTypes:"Audio,Video"});}
if(promise){promise.done(function(result){deferred.resolveWith(null,[result.Items]);});}else{deferred.resolveWith(null,[items]);}
return deferred.promise();}
self.play=function(options){Dashboard.getCurrentUser().done(function(user){if(options.items){translateItemsForPlayback(options.items).done(function(items){self.playWithIntros(items,options,user);});}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){translateItemsForPlayback(result.Items).done(function(items){self.playWithIntros(items,options,user);});});}});};self.playWithIntros=function(items,options,user){var firstItem=items[0];if(options.startPositionTicks||firstItem.MediaType!=='Video'||!self.canAutoPlayVideo()){self.playInternal(firstItem,options.startPositionTicks,function(){self.setPlaylistState(0,items);});return;}
ApiClient.getJSON(ApiClient.getUrl('Users/'+user.Id+'/Items/'+firstItem.Id+'/Intros')).done(function(intros){items=intros.Items.concat(items);self.playInternal(items[0],options.startPositionTicks,function(){self.setPlaylistState(0,items);});});};function supportsDirectPlay(mediaSource){if(mediaSource.SupportsDirectPlay&&mediaSource.Protocol=='Http'&&!mediaSource.RequiredHttpHeaders.length){return true;}
return false;}
function getOptimalMediaSource(mediaType,versions){var optimalVersion=versions.filter(function(v){v.enableDirectPlay=supportsDirectPlay(v);return v.enableDirectPlay;})[0];if(!optimalVersion){optimalVersion=versions.filter(function(v){return v.SupportsDirectStream;})[0];}
return optimalVersion||versions.filter(function(s){return s.SupportsTranscoding;})[0];}
function getPlaybackInfo(itemId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex,liveStreamId){var postData={DeviceProfile:deviceProfile};var query={UserId:Dashboard.getCurrentUserId(),StartTimeTicks:startPosition||0};if(audioStreamIndex!=null){query.AudioStreamIndex=audioStreamIndex;}
if(subtitleStreamIndex!=null){query.SubtitleStreamIndex=subtitleStreamIndex;}
if(mediaSource){query.MediaSourceId=mediaSource.Id;}
if(liveStreamId){query.LiveStreamId=liveStreamId;}
return ApiClient.ajax({url:ApiClient.getUrl('Items/'+itemId+'/PlaybackInfo',query),type:'POST',data:JSON.stringify(postData),contentType:"application/json",dataType:"json"});}
function getLiveStream(itemId,playSessionId,deviceProfile,startPosition,mediaSource,audioStreamIndex,subtitleStreamIndex){var postData={DeviceProfile:deviceProfile,OpenToken:mediaSource.OpenToken};var query={UserId:Dashboard.getCurrentUserId(),StartTimeTicks:startPosition||0,ItemId:itemId,PlaySessionId:playSessionId};if(audioStreamIndex!=null){query.AudioStreamIndex=audioStreamIndex;}
if(subtitleStreamIndex!=null){query.SubtitleStreamIndex=subtitleStreamIndex;}
return ApiClient.ajax({url:ApiClient.getUrl('LiveStreams/Open',query),type:'POST',data:JSON.stringify(postData),contentType:"application/json",dataType:"json"});}
self.createStreamInfo=function(type,item,mediaSource,startPosition){var mediaUrl;var contentType;var startTimeTicksOffset=0;var startPositionInSeekParam=startPosition?(startPosition/10000000):0;var seekParam=startPositionInSeekParam?'#t='+startPositionInSeekParam:'';if(type=='Video'){contentType='video/'+mediaSource.Container;if(mediaSource.enableDirectPlay){mediaUrl=mediaSource.Path;}else{if(mediaSource.SupportsDirectStream){mediaUrl=ApiClient.getUrl('Videos/'+item.Id+'/stream.'+mediaSource.Container,{Static:true,mediaSourceId:mediaSource.Id,api_key:ApiClient.accessToken()});mediaUrl+=seekParam;}else{startTimeTicksOffset=startPosition||0;mediaUrl=ApiClient.getUrl(mediaSource.TranscodingUrl);if(mediaSource.TranscodingSubProtocol=='hls'){mediaUrl+=seekParam;contentType='application/x-mpegURL';}else{contentType='video/'+mediaSource.TranscodingContainer;}}}}else{contentType='audio/'+mediaSource.Container;if(mediaSource.enableDirectPlay){mediaUrl=mediaSource.Path;}else{var isDirectStream=mediaSource.SupportsDirectStream;if(isDirectStream){var outputContainer=(mediaSource.Container||'').toLowerCase();mediaUrl=ApiClient.getUrl('Audio/'+item.Id+'/stream.'+outputContainer,{mediaSourceId:mediaSource.Id,deviceId:ApiClient.deviceId(),api_key:ApiClient.accessToken()});mediaUrl+="&static=true"+seekParam;}else{contentType='audio/'+mediaSource.TranscodingContainer;mediaUrl=ApiClient.getUrl(mediaSource.TranscodingUrl);}
startTimeTicksOffset=startPosition||0;}}
return{url:mediaUrl,contentType:contentType,startTimeTicksOffset:startTimeTicksOffset,startPositionInSeekParam:startPositionInSeekParam};};self.playInternal=function(item,startPosition,callback){if(item==null){throw new Error("item cannot be null");}
if(self.isPlaying()){self.stop();}
if(item.MediaType!=='Audio'&&item.MediaType!=='Video'){throw new Error("Unrecognized media type");}
if(item.IsPlaceHolder){showPlaybackInfoErrorMessage('PlaceHolder');return;}
var deviceProfile=self.getDeviceProfile();Dashboard.showLoadingMsg();getPlaybackInfo(item.Id,deviceProfile,startPosition).done(function(playbackInfoResult){if(validatePlaybackInfoResult(playbackInfoResult)){var mediaSource=getOptimalMediaSource(item.MediaType,playbackInfoResult.MediaSources);if(mediaSource){if(mediaSource.RequiresOpening){getLiveStream(item.Id,playbackInfoResult.PlaySessionId,deviceProfile,startPosition,mediaSource,null,null).done(function(openLiveStreamResult){openLiveStreamResult.MediaSource.enableDirectPlay=supportsDirectPlay(openLiveStreamResult.MediaSource);playInternalPostMediaSourceSelection(item,openLiveStreamResult.MediaSource,startPosition,callback);});}else{playInternalPostMediaSourceSelection(item,mediaSource,startPosition,callback);}}else{Dashboard.hideLoadingMsg();showPlaybackInfoErrorMessage('NoCompatibleStream');}}});};function playInternalPostMediaSourceSelection(item,mediaSource,startPosition,callback){Dashboard.hideLoadingMsg();self.currentMediaSource=mediaSource;self.currentItem=item;if(item.MediaType==="Video"){self.playVideo(item,self.currentMediaSource,startPosition);}else if(item.MediaType==="Audio"){self.currentMediaElement=playAudio(item,self.currentMediaSource,startPosition);self.currentDurationTicks=self.currentMediaSource.RunTimeTicks;}
if(callback){callback();}}
function validatePlaybackInfoResult(result){if(result.ErrorCode){showPlaybackInfoErrorMessage(result.ErrorCode);return false;}
return true;}
function showPlaybackInfoErrorMessage(errorCode){setTimeout(function(){Dashboard.alert({message:Globalize.translate('MessagePlaybackError'+errorCode),title:Globalize.translate('HeaderPlaybackError')});},300);}
self.getNowPlayingNameHtml=function(playerState){var nowPlayingItem=playerState.NowPlayingItem;var topText=nowPlayingItem.Name;if(nowPlayingItem.MediaType=='Video'){if(nowPlayingItem.IndexNumber!=null){topText=nowPlayingItem.IndexNumber+" - "+topText;}
if(nowPlayingItem.ParentIndexNumber!=null){topText=nowPlayingItem.ParentIndexNumber+"."+topText;}}
var bottomText='';if(nowPlayingItem.Artists&&nowPlayingItem.Artists.length){bottomText=topText;topText=nowPlayingItem.Artists[0];}
else if(nowPlayingItem.SeriesName||nowPlayingItem.Album){bottomText=topText;topText=nowPlayingItem.SeriesName||nowPlayingItem.Album;}
else if(nowPlayingItem.ProductionYear){bottomText=nowPlayingItem.ProductionYear;}
return bottomText?topText+'<br/>'+bottomText:topText;};self.displayContent=function(options){Dashboard.onBrowseCommand(options);};self.getItemsForPlayback=function(query){var userId=Dashboard.getCurrentUserId();if(query.Ids&&query.Ids.split(',').length==1){var deferred=DeferredBuilder.Deferred();ApiClient.getItem(userId,query.Ids.split(',')).done(function(item){deferred.resolveWith(null,[{Items:[item],TotalRecordCount:1}]);});return deferred.promise();}
else{query.Limit=query.Limit||100;query.Fields=getItemFields;query.ExcludeLocationTypes="Virtual";return ApiClient.getItems(userId,query);}};self.removeFromPlaylist=function(index){self.playlist.remove(index);};self.currentPlaylistIndex=function(i){if(i==null){return currentPlaylistIndex;}
var newItem=self.playlist[i];self.playInternal(newItem,0,function(){self.setPlaylistState(i);});};self.setPlaylistState=function(i,items){if(!isNaN(i)){currentPlaylistIndex=i;}
if(items){self.playlist=items;}
if(self.updatePlaylistUi){self.updatePlaylistUi();}};self.nextTrack=function(){var newIndex=currentPlaylistIndex+1;var newItem=self.playlist[newIndex];if(newItem){console.log('playing next track');self.playInternal(newItem,0,function(){self.setPlaylistState(newIndex);});}};self.previousTrack=function(){var newIndex=currentPlaylistIndex-1;if(newIndex>=0){var newItem=self.playlist[newIndex];if(newItem){self.playInternal(newItem,0,function(){self.setPlaylistState(newIndex);});}}};self.queueItemsNext=function(items){var insertIndex=1;for(var i=0,length=items.length;i<length;i++){self.playlist.splice(insertIndex,0,items[i]);insertIndex++;}};self.queueItems=function(items){for(var i=0,length=items.length;i<length;i++){self.playlist.push(items[i]);}};self.queue=function(options){if(!self.currentMediaElement){self.play(options);return;}
Dashboard.getCurrentUser().done(function(user){if(options.items){translateItemsForPlayback(options.items).done(function(items){self.queueItems(items);});}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){translateItemsForPlayback(result.Items).done(function(items){self.queueItems(items);});});}});};self.queueNext=function(options){if(!self.currentMediaElement){self.play(options);return;}
Dashboard.getCurrentUser().done(function(user){if(options.items){self.queueItemsNext(options.items);}else{self.getItemsForPlayback({Ids:options.ids.join(',')}).done(function(result){options.items=result.Items;self.queueItemsNext(options.items);});}});};self.pause=function(){self.currentMediaElement.pause();};self.unpause=function(){self.currentMediaElement.play();};self.seek=function(position){self.changeStream(position);};self.mute=function(){self.setVolume(0);};self.unMute=function(){self.setVolume(self.getSavedVolume()*100);};self.volume=function(){return self.currentMediaElement.volume*100;};self.toggleMute=function(){if(self.currentMediaElement){console.log('MediaPlayer toggling mute');if(self.volume()){self.mute();}else{self.unMute();}}};self.volumeDown=function(){if(self.currentMediaElement){self.setVolume(Math.max(self.volume()-2,0));}};self.volumeUp=function(){if(self.currentMediaElement){self.setVolume(Math.min(self.volume()+2,100));}};self.setVolume=function(val){if(self.currentMediaElement){console.log('MediaPlayer setting volume to '+val);self.currentMediaElement.volume=val/100;self.onVolumeChanged(self.currentMediaElement);self.saveVolume();}};self.saveVolume=function(val){if(val){store.setItem("volume",val);}};self.getSavedVolume=function(){return store.getItem("volume")||0.5;};self.shuffle=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){var query={UserId:userId,Fields:getItemFields,Limit:100,Filters:"IsNotFolder",Recursive:true,SortBy:"Random"};if(item.Type=="MusicArtist"){query.MediaTypes="Audio";query.ArtistIds=item.Id;}
else if(item.Type=="MusicGenre"){query.MediaTypes="Audio";query.Genres=item.Name;}
else if(item.IsFolder){query.ParentId=id;}
else{return;}
self.getItemsForPlayback(query).done(function(result){self.play({items:result.Items});});});};self.instantMix=function(id){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,id).done(function(item){var promise;var itemLimit=100;if(item.Type=="MusicArtist"){promise=ApiClient.getInstantMixFromArtist({UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit,Id:id});}
else if(item.Type=="MusicGenre"){promise=ApiClient.getInstantMixFromMusicGenre({UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit,Id:id});}
else if(item.Type=="MusicAlbum"){promise=ApiClient.getInstantMixFromAlbum(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else if(item.Type=="Playlist"){promise=ApiClient.getInstantMixFromPlaylist(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else if(item.Type=="Audio"){promise=ApiClient.getInstantMixFromSong(id,{UserId:Dashboard.getCurrentUserId(),Fields:getItemFields,Limit:itemLimit});}
else{return;}
promise.done(function(result){self.play({items:result.Items});});});};self.stop=function(){var elem=self.currentMediaElement;if(elem){elem.pause();$(elem).off("ended.playnext").one("ended",function(){$(this).off();if(this.tagName.toLowerCase()!='audio'){$(this).remove();}
elem.src=null;elem.src="";self.currentMediaElement=null;self.currentItem=null;self.currentMediaSource=null;if($.browser.safari){elem.src='files/dummy.mp4';elem.play();}}).trigger("ended");}else{self.currentMediaElement=null;self.currentItem=null;self.currentMediaSource=null;}
if(self.isFullScreen()){self.exitFullScreen();}
self.resetEnhancements();};self.isPlaying=function(){return self.currentMediaElement!=null;};self.getPlayerState=function(){var deferred=$.Deferred();var result=self.getPlayerStateInternal(self.currentMediaElement,self.currentItem,self.currentMediaSource);deferred.resolveWith(null,[result]);return deferred.promise();};self.getPlayerStateInternal=function(playerElement,item,mediaSource){var state={PlayState:{}};if(playerElement){state.PlayState.VolumeLevel=playerElement.volume*100;state.PlayState.IsMuted=playerElement.volume==0;state.PlayState.IsPaused=playerElement.paused;state.PlayState.PositionTicks=self.getCurrentTicks(playerElement);var currentSrc=playerElement.currentSrc;if(currentSrc){var audioStreamIndex=getParameterByName('AudioStreamIndex',currentSrc);if(audioStreamIndex){state.PlayState.AudioStreamIndex=parseInt(audioStreamIndex);}
state.PlayState.SubtitleStreamIndex=self.currentSubtitleStreamIndex;state.PlayState.PlayMethod=getParameterByName('static',currentSrc)=='true'?'DirectStream':'Transcode';state.PlayState.LiveStreamId=getParameterByName('LiveStreamId',currentSrc);state.PlayState.PlaySessionId=getParameterByName('PlaySessionId',currentSrc);}}
if(mediaSource){state.PlayState.MediaSourceId=mediaSource.Id;state.NowPlayingItem={RunTimeTicks:mediaSource.RunTimeTicks};state.PlayState.CanSeek=mediaSource.RunTimeTicks&&mediaSource.RunTimeTicks>0;}
if(item){state.NowPlayingItem=state.NowPlayingItem||{};var nowPlayingItem=state.NowPlayingItem;nowPlayingItem.Id=item.Id;nowPlayingItem.MediaType=item.MediaType;nowPlayingItem.Type=item.Type;nowPlayingItem.Name=item.Name;nowPlayingItem.IndexNumber=item.IndexNumber;nowPlayingItem.IndexNumberEnd=item.IndexNumberEnd;nowPlayingItem.ParentIndexNumber=item.ParentIndexNumber;nowPlayingItem.ProductionYear=item.ProductionYear;nowPlayingItem.PremiereDate=item.PremiereDate;nowPlayingItem.SeriesName=item.SeriesName;nowPlayingItem.Album=item.Album;nowPlayingItem.Artists=item.Artists;var imageTags=item.ImageTags||{};if(item.SeriesPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.SeriesId;nowPlayingItem.PrimaryImageTag=item.SeriesPrimaryImageTag;}
else if(imageTags.Primary){nowPlayingItem.PrimaryImageItemId=item.Id;nowPlayingItem.PrimaryImageTag=imageTags.Primary;}
else if(item.AlbumPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.AlbumId;nowPlayingItem.PrimaryImageTag=item.AlbumPrimaryImageTag;}
else if(item.SeriesPrimaryImageTag){nowPlayingItem.PrimaryImageItemId=item.SeriesId;nowPlayingItem.PrimaryImageTag=item.SeriesPrimaryImageTag;}
if(item.BackdropImageTags&&item.BackdropImageTags.length){nowPlayingItem.BackdropItemId=item.Id;nowPlayingItem.BackdropImageTag=item.BackdropImageTags[0];}
if(imageTags.Thumb){nowPlayingItem.ThumbItemId=item.Id;nowPlayingItem.ThumbImageTag=imageTags.Thumb;}
if(imageTags.Logo){nowPlayingItem.LogoItemId=item.Id;nowPlayingItem.LogoImageTag=imageTags.Logo;}
else if(item.ParentLogoImageTag){nowPlayingItem.LogoItemId=item.ParentLogoItemId;nowPlayingItem.LogoImageTag=item.ParentLogoImageTag;}}
return state;};self.beginPlayerUpdates=function(){};self.endPlayerUpdates=function(){};self.onPlaybackStart=function(playerElement,item,mediaSource){self.updateCanClientSeek(playerElement);var state=self.getPlayerStateInternal(playerElement,item,mediaSource);$(self).trigger('playbackstart',[state]);self.startProgressInterval();};self.onVolumeChanged=function(playerElement){self.saveVolume(playerElement.volume);var state=self.getPlayerStateInternal(playerElement,self.currentItem,self.currentMediaSource);$(self).trigger('volumechange',[state]);};self.cleanup=function(){};self.onPlaybackStopped=function(){console.log('playback stopped');$('body').removeClass('bodyWithPopupOpen');var playerElement=this;$(playerElement).off('.mediaplayerevent').off('ended.playbackstopped');self.cleanup(playerElement);clearProgressInterval();var item=self.currentItem;var mediaSource=self.currentMediaSource;if(item.MediaType=="Video"){if(self.isFullScreen()){self.exitFullScreen();}
self.resetEnhancements();}
var state=self.getPlayerStateInternal(playerElement,item,mediaSource);$(self).trigger('playbackstop',[state]);};self.onPlaystateChange=function(playerElement){var state=self.getPlayerStateInternal(playerElement,self.currentItem,self.currentMediaSource);$(self).trigger('playstatechange',[state]);};$(window).on("beforeunload",function(){if(self.currentItem&&self.currentMediaElement&&currentProgressInterval){self.onPlaybackStopped.call(self.currentMediaElement);}});function sendProgressUpdate(){var element=self.currentMediaElement;var state=self.getPlayerStateInternal(element,self.currentItem,self.currentMediaSource);var info={QueueableMediaTypes:state.NowPlayingItem.MediaType,ItemId:state.NowPlayingItem.Id,NowPlayingItem:state.NowPlayingItem};info=$.extend(info,state.PlayState);ApiClient.reportPlaybackProgress(info);}
function clearProgressInterval(){if(currentProgressInterval){clearTimeout(currentProgressInterval);currentProgressInterval=null;}}
self.canPlayWebm=function(){return testableVideoElement.canPlayType('video/webm').replace(/no/,'');};self.canAutoPlayAudio=function(){if($.browser.android||($.browser.webkit&&!$.browser.chrome)){return false;}
return true;};function getAudioElement(){var elem=$('.mediaPlayerAudio');if(elem.length){return elem;}
var html='';var requiresControls=!self.canAutoPlayAudio();if(requiresControls){html+='<div class="mediaPlayerAudioContainer"><div class="mediaPlayerAudioContainerInner">';;}else{html+='<div class="mediaPlayerAudioContainer" style="display:none;"><div class="mediaPlayerAudioContainerInner">';;}
html+='<audio class="mediaPlayerAudio" crossorigin="anonymous" controls>';html+='</audio></div></div>';$(document.body).append(html);return $('.mediaPlayerAudio');}
function playAudio(item,mediaSource,startPositionTicks){var streamInfo=self.createStreamInfo('Audio',item,mediaSource,startPositionTicks);var audioUrl=streamInfo.url;self.startTimeTicksOffset=streamInfo.startTimeTicksOffset;var initialVolume=self.getSavedVolume();return getAudioElement().each(function(){this.src=audioUrl;this.volume=initialVolume;this.play();}).on("volumechange.mediaplayerevent",function(){console.log('audio element event: volumechange');self.onVolumeChanged(this);}).one("playing.mediaplayerevent",function(){console.log('audio element event: playing');$('.mediaPlayerAudioContainer').hide();$(this).on("ended.playbackstopped",self.onPlaybackStopped).one('ended.playnext',self.playNextAfterEnded);self.onPlaybackStart(this,item,mediaSource);}).on("pause.mediaplayerevent",function(){console.log('audio element event: pause');self.onPlaystateChange(this);self.setCurrentTime(self.getCurrentTicks());}).on("playing.mediaplayerevent",function(){console.log('audio element event: playing');self.onPlaystateChange(this);self.setCurrentTime(self.getCurrentTicks());}).on("timeupdate.mediaplayerevent",function(){self.setCurrentTime(self.getCurrentTicks(this));})[0];};var getItemFields="MediaSources,Chapters";self.getCurrentTargetInfo=function(){return self.getTargets()[0];};}
window.MediaPlayer=new mediaPlayer();window.MediaController.registerPlayer(window.MediaPlayer);window.MediaController.setActivePlayer(window.MediaPlayer);})(document,setTimeout,clearTimeout,screen,window.store,$,setInterval,window);(function(){function createVideoPlayer(self){var timeout;var initialVolume;var fullscreenExited=false;var idleState=true;var remoteFullscreen=false;var muteButton=null;var unmuteButton=null;var volumeSlider=null;var positionSlider;var isPositionSliderActive;var currentTimeElement;self.currentSubtitleStreamIndex=null;self.getCurrentSubtitleStream=function(){return self.getSubtitleStream(self.currentSubtitleStreamIndex);};self.getSubtitleStream=function(index){return self.currentMediaSource.MediaStreams.filter(function(s){return s.Type=='Subtitle'&&s.Index==index;})[0];};self.remoteFullscreen=function(){if(remoteFullscreen){exitFullScreenToWindow();}else{enterFullScreen();}
remoteFullscreen=!remoteFullscreen;};self.toggleFullscreen=function(){if(self.isFullScreen()){if(document.cancelFullScreen){document.cancelFullScreen();}
else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}
else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}
else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}
$('#videoPlayer').removeClass('fullscreenVideo');}else{requestFullScreen(document.body);}};self.resetEnhancements=function(){$("#mediaPlayer").hide();$('#videoPlayer').removeClass('fullscreenVideo').removeClass('idlePlayer');$('.hiddenOnIdle').removeClass("inactive");$("video").remove();};self.exitFullScreen=function(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.mozExitFullScreen){document.mozExitFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}
$('#videoPlayer').removeClass('fullscreenVideo');fullscreenExited=true;};self.isFullScreen=function(){return document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?true:false;};function onFlyoutClose(){$('.itemVideo').css('visibility','visible');}
function onPopupOpen(elem){elem.popup("open").parents(".ui-popup-container").css("margin-top",30);if($.browser.safari){$('.itemVideo').css('visibility','hidden');}}
self.showSubtitleMenu=function(){var elem=$('.videoSubtitlePopup').html(getSubtitleTracksHtml()).trigger('create').popup("option","positionTo",$('.videoSubtitleButton')).off('popupafterclose',onFlyoutClose).on('popupafterclose',onFlyoutClose);onPopupOpen(elem);};self.showQualityFlyout=function(){var elem=$('.videoQualityPopup').html(getQualityFlyoutHtml()).trigger('create').popup("option","positionTo",$('.videoQualityButton')).off('popupafterclose',onFlyoutClose).on('popupafterclose',onFlyoutClose);onPopupOpen(elem);};self.showChaptersFlyout=function(){var elem=$('.videoChaptersPopup').html(getChaptersFlyoutHtml()).trigger('create').popup("option","positionTo",$('.videoChaptersButton')).off('popupafterclose',onFlyoutClose).on('popupafterclose',onFlyoutClose);onPopupOpen(elem);};self.showAudioTracksFlyout=function(){var elem=$('.videoAudioPopup').html(getAudioTracksHtml()).trigger('create').popup("option","positionTo",$('.videoAudioButton')).off('popupafterclose',onFlyoutClose).on('popupafterclose',onFlyoutClose);onPopupOpen(elem);};self.setAudioStreamIndex=function(index){self.changeStream(self.getCurrentTicks(),{AudioStreamIndex:index});};self.setSubtitleStreamIndex=function(index){if(!self.supportsTextTracks()){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});self.currentSubtitleStreamIndex=index;return;}
var currentStream=self.getCurrentSubtitleStream();var newStream=self.getSubtitleStream(index);if(!currentStream&&!newStream)return;var selectedTrackElementIndex=-1;if(currentStream&&!newStream){if(currentStream.DeliveryMethod!='External'){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:-1});}}
else if(!currentStream&&newStream){if(newStream.DeliveryMethod=='External'){selectedTrackElementIndex=index;}else{self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});}}
else if(currentStream&&newStream){if(newStream.DeliveryMethod=='External'){selectedTrackElementIndex=index;if(currentStream.DeliveryMethod!='External'){self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:-1});}}else{self.changeStream(self.getCurrentTicks(),{SubtitleStreamIndex:index});}}
self.setCurrentTrackElement(selectedTrackElementIndex);self.currentSubtitleStreamIndex=index;};self.setCurrentTrackElement=function(index){var modes=['disabled','showing','hidden'];var textStreams=self.currentMediaSource.MediaStreams.filter(function(s){return s.DeliveryMethod=='External';});var newStream=textStreams.filter(function(s){return s.Index==index;})[0];var trackIndex=newStream?textStreams.indexOf(newStream):-1;console.log('Setting new text track index to: '+trackIndex);var allTracks=self.currentMediaElement.textTracks;for(var i=0;i<allTracks.length;i++){var mode;if(trackIndex==i){mode=1;}else{mode=0;}
console.log('Setting track '+i+' mode to: '+mode);var useNumericMode=false;if(!isNaN(allTracks[i].mode)){useNumericMode=true;}
if(useNumericMode){allTracks[i].mode=mode;}else{allTracks[i].mode=modes[mode];}}};self.updateTextStreamUrls=function(startPositionTicks){if(!self.supportsTextTracks()){return;}
var allTracks=self.currentMediaElement.textTracks;for(var i=0;i<allTracks.length;i++){var track=allTracks[i];try{while(track.cues.length){track.removeCue(track.cues[0]);}}catch(e){console.log('Error removing cue from textTrack');}}
$('track',self.currentMediaElement).each(function(){var currentSrc=this.src;currentSrc=replaceQueryString(currentSrc,'startPositionTicks',startPositionTicks);this.src=currentSrc;});};self.updateNowPlayingInfo=function(item){if(!item){throw new Error('item cannot be null');}
var mediaControls=$("#videoPlayer");var state=self.getPlayerStateInternal(self.currentMediaElement,item,self.currentMediaSource);var url="";if(state.NowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.PrimaryImageItemId,{type:"Primary",width:150,tag:state.NowPlayingItem.PrimaryImageTag});}
else if(state.NowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.PrimaryImageItemId,{type:"Primary",width:150,tag:state.NowPlayingItem.PrimaryImageTag});}
else if(state.NowPlayingItem.BackdropImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.BackdropItemId,{type:"Backdrop",height:300,tag:state.NowPlayingItem.BackdropImageTag,index:0});}
else if(state.NowPlayingItem.ThumbImageTag){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.ThumbImageItemId,{type:"Thumb",height:300,tag:state.NowPlayingItem.ThumbImageTag});}
var nowPlayingTextElement=$('.nowPlayingText',mediaControls);var nameHtml=self.getNowPlayingNameHtml(state);if(nameHtml.indexOf('<br/>')!=-1){nowPlayingTextElement.addClass('nowPlayingDoubleText');}else{nowPlayingTextElement.removeClass('nowPlayingDoubleText');}
if(url){$('.nowPlayingImage',mediaControls).html('<img src="'+url+'" />');}else{$('.nowPlayingImage',mediaControls).html('');}
if(state.NowPlayingItem.LogoItemId){url=ApiClient.getScaledImageUrl(state.NowPlayingItem.LogoItemId,{type:"Logo",height:42,tag:state.NowPlayingItem.LogoImageTag});$('.videoTopControlsLogo',mediaControls).html('<img src="'+url+'" />');}else{$('.videoTopControlsLogo',mediaControls).html('');}
nowPlayingTextElement.html(nameHtml);};function onPositionSliderChange(){isPositionSliderActive=false;var newPercent=parseInt(this.value);var newPositionTicks=(newPercent/100)*self.currentMediaSource.RunTimeTicks;self.changeStream(Math.floor(newPositionTicks));}
$(function(){var parent=$("#mediaPlayer");muteButton=$('.muteButton',parent);unmuteButton=$('.unmuteButton',parent);currentTimeElement=$('.currentTime',parent);positionSlider=$(".positionSlider",parent).on('slidestart',function(e){isPositionSliderActive=true;}).on('slidestop',onPositionSliderChange);volumeSlider=$('.volumeSlider',parent).on('slidestop',function(){var vol=this.value;updateVolumeButtons(vol);self.setVolume(vol*100);});$('.videoChaptersPopup').on('click','.mediaPopupOption',function(){var ticks=parseInt(this.getAttribute('data-positionticks')||'0');self.changeStream(ticks);$('.videoChaptersPopup').popup('close');});$('.videoAudioPopup').on('click','.mediaPopupOption',function(){if(!$(this).hasClass('selectedMediaPopupOption')){var index=parseInt(this.getAttribute('data-index'));self.setAudioStreamIndex(index);}
$('.videoAudioPopup').popup('close');});$('.videoSubtitlePopup').on('click','.mediaPopupOption',function(){$('.videoSubtitlePopup').popup('close');if(!$(this).hasClass('selectedMediaPopupOption')){var index=parseInt(this.getAttribute('data-index'));self.setSubtitleStreamIndex(index);}});$('.videoQualityPopup').on('click','.mediaPopupOption',function(){if(!$(this).hasClass('selectedMediaPopupOption')){var bitrate=parseInt(this.getAttribute('data-bitrate'));AppSettings.maxStreamingBitrate(bitrate);self.changeStream(self.getCurrentTicks(),{Bitrate:bitrate});}
$('.videoQualityPopup').popup('close');});var trackChange=false;var tooltip=$('<div id="slider-tooltip"></div>');$(".videoControls .positionSliderContainer .slider").on("change",function(e){if(!trackChange)return;var pct=$(this).val();var time=self.currentDurationTicks*(Number(pct)*.01);var tooltext=Dashboard.getDisplayTime(time);tooltip.text(tooltext);console.log("slidin",pct,self.currentDurationTicks,time);}).on("slidestart",function(e){trackChange=true;var handle=$(".videoControls .positionSliderContainer .ui-slider-handle");handle.after(tooltip);}).on("slidestop",function(e){trackChange=false;tooltip.remove();});$('.videoSubtitleButton').on('click',function(){self.showSubtitleMenu();});$('.videoQualityButton').on('click',function(){self.showQualityFlyout();});$('.videoAudioButton').on('click',function(){self.showAudioTracksFlyout();});$('.videoChaptersButton').on('click',function(){self.showChaptersFlyout();});});function idleHandler(){if(timeout){window.clearTimeout(timeout);}
if(idleState==true){$('.hiddenOnIdle').removeClass("inactive");$('#videoPlayer').removeClass('idlePlayer');}
idleState=false;timeout=window.setTimeout(function(){idleState=true;$('.hiddenOnIdle').addClass("inactive");$('#videoPlayer').addClass('idlePlayer');},4000);}
function updateVolumeButtons(vol){if(vol){muteButton.show();unmuteButton.hide();}else{muteButton.hide();unmuteButton.show();}}
function requestFullScreen(element){var requestMethod=element.requestFullscreen||element.webkitRequestFullscreen||element.webkitRequestFullScreen||element.mozRequestFullScreen;if(requestMethod){requestMethod.call(element);}else{enterFullScreen();}}
function enterFullScreen(){var player=$("#videoPlayer");player.addClass("fullscreenVideo");remoteFullscreen=true;}
function exitFullScreenToWindow(){var player=$("#videoPlayer");player.removeClass("fullscreenVideo");remoteFullscreen=false;}
function getChaptersFlyoutHtml(){var item=self.currentItem;var currentTicks=self.getCurrentTicks();var chapters=item.Chapters||[];var html='';html+='<div class="videoPlayerPopupContent">';html+='<ul data-role="listview" data-inset="true"><li data-role="list-divider">'+Globalize.translate('HeaderScenes')+'</li>';html+='</ul>';html+='<div class="videoPlayerPopupScroller">';html+='<ul data-role="listview" data-inset="true">';var index=0;html+=chapters.map(function(chapter){var cssClass="mediaPopupOption";var selected=false;if(currentTicks>=chapter.StartPositionTicks){var nextChapter=chapters[index+1];selected=!nextChapter||currentTicks<nextChapter.StartPositionTicks;}
var optionHtml='<li><a data-positionticks="'+chapter.StartPositionTicks+'" class="'+cssClass+'" href="#" style="padding-top:0;padding-bottom:0;">';var imgUrl="css/images/media/chapterflyout.png";if(chapter.ImageTag){optionHtml+='<img src="'+imgUrl+'" style="visibility:hidden;" />';imgUrl=ApiClient.getScaledImageUrl(item.Id,{width:160,tag:chapter.ImageTag,type:"Chapter",index:index});optionHtml+='<div class="videoChapterPopupImage" style="background-image:url(\''+imgUrl+'\');"></div>';}else{optionHtml+='<img src="'+imgUrl+'" />';}
optionHtml+='<p style="margin:12px 0 0;">';var textLines=[];textLines.push(chapter.Name);textLines.push(Dashboard.getDisplayTime(chapter.StartPositionTicks));optionHtml+=textLines.join('<br/>');optionHtml+='</p>';optionHtml+='</a></li>';index++;return optionHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';return html;}
function getAudioTracksHtml(){var streams=self.currentMediaSource.MediaStreams.filter(function(currentStream){return currentStream.Type=="Audio";});var currentIndex=getParameterByName('AudioStreamIndex',self.getCurrentSrc(self.currentMediaElement));var html='';html+='<div class="videoPlayerPopupContent">';html+='<ul data-role="listview" data-inset="true"><li data-role="list-divider">'+Globalize.translate('HeaderAudioTracks')+'</li>';html+='</ul>';html+='<div class="videoPlayerPopupScroller">';html+='<ul data-role="listview" data-inset="true">';html+=streams.map(function(stream){var cssClass="mediaPopupOption";var selected=stream.Index==currentIndex;if(selected){cssClass+=' selectedMediaPopupOption';}
var optionHtml='<li><a data-index="'+stream.Index+'" class="'+cssClass+'" href="#">';optionHtml+='<p style="margin:0;">';if(selected){optionHtml+='<img src="css/images/checkmarkgreen.png" style="width:18px;border-radius:3px;margin-right:.5em;vertical-align:middle;" />';}
var textLines=[];textLines.push(stream.Language||Globalize.translate('LabelUnknownLanguage'));var attributes=[];if(stream.Codec){attributes.push(stream.Codec);}
if(stream.Profile){attributes.push(stream.Profile);}
if(stream.BitRate){attributes.push((Math.floor(stream.BitRate/1000))+' kbps');}
if(stream.Channels){attributes.push(stream.Channels+' ch');}
if(stream.IsDefault){attributes.push('(D)');}
if(attributes.length){textLines.push(attributes.join('&nbsp;&#149;&nbsp;'));}
optionHtml+=textLines.join('<br/>');optionHtml+='</p>';optionHtml+='</a></li>';return optionHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';return html;}
function getSubtitleTracksHtml(){var streams=self.currentMediaSource.MediaStreams.filter(function(currentStream){return currentStream.Type=="Subtitle";});var currentIndex=self.currentSubtitleStreamIndex||-1;streams.unshift({Index:-1,Language:"Off"});var html='';html+='<div class="videoPlayerPopupContent">';html+='<ul data-role="listview" data-inset="true"><li data-role="list-divider">'+Globalize.translate('HeaderSubtitles')+'</li>';html+='</ul>';html+='<div class="videoPlayerPopupScroller">';html+='<ul data-role="listview" data-inset="true">';html+=streams.map(function(stream){var cssClass="mediaPopupOption";var selected=stream.Index==currentIndex;if(selected){cssClass+=' selectedMediaPopupOption';}
var optionHtml='<li><a data-index="'+stream.Index+'" class="'+cssClass+'" href="#">';optionHtml+='<p style="margin:0;">';if(selected){optionHtml+='<img src="css/images/checkmarkgreen.png" style="width:18px;border-radius:3px;margin-right:.5em;vertical-align:middle;" />';}
var textLines=[];textLines.push(stream.Language||Globalize.translate('LabelUnknownLanguage'));if(stream.Codec){textLines.push(stream.Codec);}
var attributes=[];if(stream.IsDefault){attributes.push('Default');}
if(stream.IsForced){attributes.push('Forced');}
if(stream.IsExternal){attributes.push('External');}
if(attributes.length){textLines.push(attributes.join('&nbsp;&#149;&nbsp;'));}
optionHtml+=textLines.join('<br/>');optionHtml+='</p>';optionHtml+='</a></li>';return optionHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';return html;}
function getQualityFlyoutHtml(){var currentSrc=self.getCurrentSrc(self.currentMediaElement).toLowerCase();var isStatic=currentSrc.indexOf('static=true')!=-1;var videoStream=self.currentMediaSource.MediaStreams.filter(function(stream){return stream.Type=="Video";})[0];var videoWidth=videoStream?videoStream.Width:null;var options=self.getVideoQualityOptions(videoWidth);if(isStatic){options[0].name="Direct";}
var html='';html+='<div class="videoPlayerPopupContent">';html+='<ul data-role="listview" data-inset="true"><li data-role="list-divider">'+Globalize.translate('HeaderVideoQuality')+'</li>';html+='</ul>';html+='<div class="videoPlayerPopupScroller">';html+='<ul data-role="listview" data-inset="true">';html+=options.map(function(option){var cssClass="mediaPopupOption";if(option.selected){cssClass+=' selectedMediaPopupOption';}
var optionHtml='<li><a data-bitrate="'+option.bitrate+'" class="'+cssClass+'" href="#">';optionHtml+='<p style="margin:0;">';if(option.selected){optionHtml+='<img src="css/images/checkmarkgreen.png" style="width:18px;border-radius:3px;margin-right:.5em;vertical-align:middle;" />';}
optionHtml+=option.name;optionHtml+='</p>';optionHtml+='</a></li>';return optionHtml;}).join('');html+='</ul>';html+='</div>';html+='</div>';return html;}
function bindEventsForPlayback(){var hideElementsOnIdle=!$.browser.mobile;if(hideElementsOnIdle){$('.itemVideo').off('mousemove.videoplayer keydown.videoplayer scroll.videoplayer',idleHandler);$('.itemVideo').on('mousemove.videoplayer keydown.videoplayer scroll.videoplayer',idleHandler).trigger('mousemove');}
$(document).on('webkitfullscreenchange.videoplayer mozfullscreenchange.videoplayer fullscreenchange.videoplayer',function(e){if(self.isFullScreen()){enterFullScreen();idleState=true;}else{exitFullScreenToWindow();}
fullscreenExited=self.isFullScreen()==false;}).on("msfullscreenchange.videoplayer",function(e){fullscreenExited=self.isFullScreen()==false;}).on("keyup.videoplayer",function(e){if(fullscreenExited){$("#videoPlayer",$("#mediaPlayer")).removeClass("fullscreenVideo");fullscreenExited=false;return;}
if(e.keyCode==27){self.stop();}});$(window).one("popstate.videoplayer",function(){self.stop();return;});if(hideElementsOnIdle){$(document.body).on("mousemove.videplayer","#itemVideo",function(){idleHandler(this);});}}
function unbindEventsForPlayback(){$(document).off('webkitfullscreenchange.videoplayer mozfullscreenchange.videoplayer fullscreenchange.videoplayer').off("msfullscreenchange.videoplayer").off("keyup.videoplayer");$(window).off("popstate.videoplayer");$(document.body).off("mousemove.videplayer");$('.itemVideo').off('mousemove.videoplayer keydown.videoplayer scroll.videoplayer');}
self.canAutoPlayVideo=function(){if($.browser.msie||$.browser.mobile){return false;}
return true;};self.cleanup=function(playerElement){if(playerElement.tagName.toLowerCase()=='video'){currentTimeElement.html('--:--');unbindEventsForPlayback();}};self.playVideo=function(item,mediaSource,startPosition){var streamInfo=self.createStreamInfo('Video',item,mediaSource,startPosition);if($.browser.safari&&!mediaSource.RunTimeTicks){Dashboard.showLoadingMsg();ApiClient.ajax({type:'GET',url:streamInfo.url.replace('master.m3u8','live.m3u8')}).always(function(){Dashboard.hideLoadingMsg();}).done(function(){self.playVideoInternal(item,mediaSource,startPosition,streamInfo);});}else{self.playVideoInternal(item,mediaSource,startPosition,streamInfo);}};self.playVideoInternal=function(item,mediaSource,startPosition,streamInfo){var videoUrl=streamInfo.url;var contentType=streamInfo.contentType;var startPositionInSeekParam=streamInfo.startPositionInSeekParam;self.startTimeTicksOffset=streamInfo.startTimeTicksOffset;var mediaStreams=mediaSource.MediaStreams||[];var subtitleStreams=mediaStreams.filter(function(s){return s.Type=='Subtitle';});var screenWidth=Math.max(screen.height,screen.width);var posterCode='';if(item.BackdropImageTags&&item.BackdropImageTags.length){posterCode=' poster="'+ApiClient.getScaledImageUrl(item.Id,{type:"Backdrop",index:0,maxWidth:screenWidth,tag:item.BackdropImageTags[0]})+'"';}
else if(item.ParentBackdropItemId&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length){posterCode=' poster="'+ApiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:'Backdrop',index:0,maxWidth:screenWidth,tag:item.ParentBackdropImageTags[0]})+'"';}
var html='';var requiresNativeControls=!self.canAutoPlayVideo();if(requiresNativeControls){html+='<video class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay" crossorigin="anonymous" controls="controls"'+posterCode+'>';}
else{html+='<video class="itemVideo" id="itemVideo" preload="metadata" crossorigin="anonymous" autoplay'+posterCode+'>';}
html+='<source type="'+contentType+'" src="'+videoUrl+'" />';var textStreams=subtitleStreams.filter(function(s){return s.DeliveryMethod=='External';});for(var i=0,length=textStreams.length;i<length;i++){var textStream=textStreams[i];var textStreamUrl=!textStream.IsExternalUrl?ApiClient.getUrl(textStream.DeliveryUrl):textStream.DeliveryUrl;var defaultAttribute=textStream.Index==mediaSource.DefaultSubtitleStreamIndex?' default':'';html+='<track kind="subtitles" src="'+textStreamUrl+'" srclang="'+(textStream.Language||'und')+'"'+defaultAttribute+'></track>';}
html+='</video>';var mediaPlayerContainer=$("#mediaPlayer").show();var videoControls=$('.videoControls',mediaPlayerContainer);$('#video-playButton',videoControls).hide();$('#video-pauseButton',videoControls).show();$('.videoTrackControl').hide();var videoElement=$('#videoElement',mediaPlayerContainer).prepend(html);$('.videoQualityButton',videoControls).show();if(mediaStreams.filter(function(s){return s.Type=="Audio";}).length){$('.videoAudioButton').show();}else{$('.videoAudioButton').hide();}
if(subtitleStreams.length){$('.videoSubtitleButton').show();}else{$('.videoSubtitleButton').hide();}
if(item.Chapters&&item.Chapters.length){$('.videoChaptersButton').show();}else{$('.videoChaptersButton').hide();}
if(requiresNativeControls){$('#video-fullscreenButton',videoControls).hide();}else{$('#video-fullscreenButton',videoControls).show();}
if($.browser.mobile){$('.volumeSliderContainer',videoControls).addClass('hide');$('.muteButton',videoControls).addClass('hide');$('.unmuteButton',videoControls).addClass('hide');}else{$('.volumeSliderContainer',videoControls).removeClass('hide');$('.muteButton',videoControls).removeClass('hide');$('.unmuteButton',videoControls).removeClass('hide');}
if(requiresNativeControls){videoControls.addClass('hide');}else{videoControls.removeClass('hide');}
var video=$("video",videoElement);initialVolume=self.getSavedVolume();video.each(function(){this.volume=initialVolume;});volumeSlider.val(initialVolume).slider('refresh');updateVolumeButtons(initialVolume);video.one("playing.mediaplayerevent",function(e){if(startPositionInSeekParam&&this.currentSrc&&this.currentSrc.toLowerCase().indexOf('.m3u8')!=-1){var element=this;setTimeout(function(){element.currentTime=startPositionInSeekParam;},3000);}}).on("volumechange.mediaplayerevent",function(e){var vol=this.volume;updateVolumeButtons(vol);}).one("playing.mediaplayerevent",function(){$(this).on("ended.playbackstopped",self.onPlaybackStopped).one('ended.playnext',self.playNextAfterEnded);self.onPlaybackStart(this,item,mediaSource);}).on("pause.mediaplayerevent",function(e){$('#video-playButton',videoControls).show();$('#video-pauseButton',videoControls).hide();$("#pause",videoElement).show().addClass("fadeOut");setTimeout(function(){$("#pause",videoElement).hide().removeClass("fadeOut");},300);}).on("playing.mediaplayerevent",function(e){$('#video-playButton',videoControls).hide();$('#video-pauseButton',videoControls).show();$("#play",videoElement).show().addClass("fadeOut");setTimeout(function(){$("#play",videoElement).hide().removeClass("fadeOut");},300);}).on("timeupdate.mediaplayerevent",function(){if(!isPositionSliderActive){self.setCurrentTime(self.getCurrentTicks(this),positionSlider,currentTimeElement);}}).on("error.mediaplayerevent",function(){self.stop();var errorCode=this.error?this.error.code:'';console.log('Html5 Video error code: '+errorCode);var errorMsg=Globalize.translate('MessageErrorPlayingVideo');if(item.Type=="TvChannel"){errorMsg+='<p>';errorMsg+=Globalize.translate('MessageEnsureOpenTuner');errorMsg+='</p>';}
if($.browser.msie&&!$.browser.mobile&&!self.canPlayWebm()){errorMsg+='<p>';errorMsg+='<a href="https://tools.google.com/dlpage/webmmf/" target="_blank">';errorMsg+=Globalize.translate('MessageInternetExplorerWebm');errorMsg+='</a>';errorMsg+='</p>';}
Dashboard.alert({title:Globalize.translate('HeaderVideoError'),message:errorMsg});}).on("click.mediaplayerevent",function(e){if(this.paused){self.unpause();}else{self.pause();}}).on("dblclick.mediaplayerevent",function(){self.toggleFullscreen();});bindEventsForPlayback();mediaPlayerContainer.trigger("create");fullscreenExited=false;self.currentSubtitleStreamIndex=mediaSource.DefaultSubtitleStreamIndex;$('body').addClass('bodyWithPopupOpen');self.currentMediaElement=video[0];self.currentDurationTicks=self.currentMediaSource.RunTimeTicks;self.updateNowPlayingInfo(item);};self.updatePlaylistUi=function(){var index=self.currentPlaylistIndex(null),length=self.playlist.length,requiresNativeControls=!self.canAutoPlayVideo(),controls=$(requiresNativeControls?'.videoAdvancedControls':'.videoControls');if(length<2){$('.videoTrackControl').hide();return;}
if(index===0){$('.previousTrackButton',controls).attr('disabled','disabled');}else{$('.previousTrackButton',controls).removeAttr('disabled');}
if((index+1)>=length){$('.nextTrackButton',controls).attr('disabled','disabled');}else{$('.nextTrackButton',controls).removeAttr('disabled');}
$('.videoTrackControl',controls).show();};}
createVideoPlayer(MediaPlayer);})();(function(window,document,$,setTimeout,clearTimeout){var currentPlayer;var currentTimeElement;var nowPlayingImageElement;var nowPlayingTextElement;var unmuteButton;var muteButton;var volumeSlider;var isVolumeSliderActive;var unpauseButton;var pauseButton;var positionSlider;var isPositionSliderActive;var lastPlayerState;function getNowPlayingBarHtml(){var html='';html+='<div class="nowPlayingBar" style="display:none;">';html+='<div style="display:inline-block;width:12px;"></div>';html+='<div class="nowPlayingImage"></div>';html+='<div class="nowPlayingText"></div>';html+='<a class="mediaButton remoteControlButton imageButton" href="nowplaying.html" data-transition="slideup" title="'+Globalize.translate('ButtonRemoteControl')+'"><i class="fa fa-tablet"></i></a>';html+='<a class="mediaButton playlistButton imageButton" href="nowplaying.html?tab=Playlist" data-transition="slideup" title="'+Globalize.translate('ButtonPlaylist')+'"><i class="fa fa-list"></i></a>';html+='<button class="mediaButton previousTrackButton imageButton" title="'+Globalize.translate('ButtonPreviousTrack')+'" type="button" data-role="none"><i class="fa fa-step-backward"></i></button>';html+='<button class="mediaButton unpauseButton imageButton" title="'+Globalize.translate('ButtonPlay')+'" type="button" data-role="none"><i class="fa fa-play"></i></button>';html+='<button class="mediaButton pauseButton imageButton" title="'+Globalize.translate('ButtonPause')+'" type="button" data-role="none"><i class="fa fa-pause"></i></button>';html+='<button class="mediaButton stopButton imageButton" title="'+Globalize.translate('ButtonStop')+'" type="button" data-role="none"><i class="fa fa-stop"></i></button>';html+='<button class="mediaButton nextTrackButton imageButton" title="'+Globalize.translate('ButtonNextTrack')+'" type="button" data-role="none"><i class="fa fa-step-forward"></i></button>';html+='<div id="mediaElement"></div>';html+='<div class="positionSliderContainer sliderContainer">';html+='<input type="range" class="mediaSlider positionSlider slider" step=".001" min="0" max="100" value="0" style="display:none;" data-mini="true" data-theme="a" data-highlight="true" />';html+='</div>';html+='<div class="currentTime"></div>';html+='<button class="mediaButton muteButton imageButton" title="'+Globalize.translate('ButtonMute')+'" type="button" data-role="none"><i class="fa fa-volume-up"></i></button>';html+='<button class="mediaButton unmuteButton imageButton" title="'+Globalize.translate('ButtonUnmute')+'" type="button" data-role="none"><i class="fa fa-volume-off"></i></button>';html+='<div class="volumeSliderContainer sliderContainer">';html+='<input type="range" class="mediaSlider volumeSlider slider" step=".05" min="0" max="100" value="0" style="display:none;" data-mini="true" data-theme="a" data-highlight="true" />';html+='</div>';html+='</div>';return html;}
function bindEvents(elem){currentTimeElement=$('.currentTime',elem);nowPlayingImageElement=$('.nowPlayingImage',elem);nowPlayingTextElement=$('.nowPlayingText',elem);$(elem).on('swipeup',function(){Dashboard.navigate('nowplaying.html');});unmuteButton=$('.unmuteButton',elem).on('click',function(){if(currentPlayer){currentPlayer.unMute();}});muteButton=$('.muteButton',elem).on('click',function(){if(currentPlayer){currentPlayer.mute();}});$('.stopButton',elem).on('click',function(){if(currentPlayer){currentPlayer.stop();}});pauseButton=$('.pauseButton',elem).on('click',function(){if(currentPlayer){currentPlayer.pause();}});unpauseButton=$('.unpauseButton',elem).on('click',function(){if(currentPlayer){currentPlayer.unpause();}});$('.nextTrackButton',elem).on('click',function(){if(currentPlayer){currentPlayer.nextTrack();}});$('.previousTrackButton',elem).on('click',function(){if(currentPlayer){currentPlayer.previousTrack();}});volumeSlider=$('.volumeSlider',elem).on('slidestart',function(){isVolumeSliderActive=true;}).on('slidestop',function(){isVolumeSliderActive=false;if(currentPlayer){currentPlayer.setVolume(this.value);}});positionSlider=$('.positionSlider',elem).on('slidestart',function(){isPositionSliderActive=true;}).on('slidestop',function(){isPositionSliderActive=false;if(currentPlayer&&lastPlayerState){var newPercent=parseFloat(this.value);var newPositionTicks=(newPercent/100)*lastPlayerState.NowPlayingItem.RunTimeTicks;currentPlayer.seek(Math.floor(newPositionTicks));}});}
function getNowPlayingBar(){var elem=$('.nowPlayingBar');if(elem.length){return elem;}
elem=$(getNowPlayingBarHtml()).insertBefore('#footerNotifications').trigger('create');bindEvents(elem);return elem;}
function showButton(button){button.removeClass('hide');}
function hideButton(button){button.addClass('hide');}
function updatePlayerState(state){if(state.NowPlayingItem&&!$($.mobile.activePage).hasClass('nowPlayingPage')){showNowPlayingBar();}else{hideNowPlayingBar();return;}
lastPlayerState=state;if(!muteButton){getNowPlayingBar();}
var playerInfo=MediaController.getPlayerInfo();var supportedCommands=playerInfo.supportedCommands;if(supportedCommands.indexOf('SetVolume')==-1){volumeSlider.prop('disabled','disabled');}else{volumeSlider.prop('disabled','');}
if(supportedCommands.indexOf('Mute')==-1){muteButton.prop('disabled','disabled');}else{muteButton.prop('disabled','');}
if(supportedCommands.indexOf('Unmute')==-1){unmuteButton.prop('disabled','disabled');}else{unmuteButton.prop('disabled','');}
var playState=state.PlayState||{};if(playState.IsPaused){hideButton(pauseButton);showButton(unpauseButton);}else{showButton(pauseButton);hideButton(unpauseButton);}
updatePlayerVolumeState(state);var nowPlayingItem=state.NowPlayingItem||{};if(!isPositionSliderActive){if(nowPlayingItem&&nowPlayingItem.RunTimeTicks){var pct=playState.PositionTicks/nowPlayingItem.RunTimeTicks;pct*=100;positionSlider.val(pct);}else{positionSlider.val(0);}
if(playState.CanSeek){positionSlider.slider("enable");}else{positionSlider.slider("disable");}
positionSlider.slider('refresh');}
var timeText=Dashboard.getDisplayTime(playState.PositionTicks);if(nowPlayingItem.RunTimeTicks){timeText+=" / "+Dashboard.getDisplayTime(nowPlayingItem.RunTimeTicks);}
currentTimeElement.html(timeText);updateNowPlayingInfo(state);}
function updatePlayerVolumeState(state){if(!muteButton){getNowPlayingBar();}
var playState=state.PlayState||{};if(playState.IsMuted){hideButton(muteButton);showButton(unmuteButton);}else{showButton(muteButton);hideButton(unmuteButton);}
if(!isVolumeSliderActive){volumeSlider.val(playState.VolumeLevel||0);}
volumeSlider.slider('refresh');}
var currentImgUrl;function updateNowPlayingInfo(state){var nameHtml=MediaPlayer.getNowPlayingNameHtml(state)||'';if(nameHtml.indexOf('<br/>')!=-1){nowPlayingTextElement.addClass('nowPlayingDoubleText');}else{nowPlayingTextElement.removeClass('nowPlayingDoubleText');}
nowPlayingTextElement.html(nameHtml);var url;var imgHeight=50;var nowPlayingItem=state.NowPlayingItem;if(nowPlayingItem.PrimaryImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.PrimaryImageItemId,{type:"Primary",height:imgHeight,tag:nowPlayingItem.PrimaryImageTag});}
else if(nowPlayingItem.BackdropImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.BackdropItemId,{type:"Backdrop",height:imgHeight,tag:nowPlayingItem.BackdropImageTag,index:0});}else if(nowPlayingItem.ThumbImageTag){url=ApiClient.getScaledImageUrl(nowPlayingItem.ThumbImageItemId,{type:"Thumb",height:imgHeight,tag:nowPlayingItem.ThumbImageTag});}
else if(nowPlayingItem.Type=="TvChannel"||nowPlayingItem.Type=="Recording"){url="css/images/items/detail/tv.png";}
else if(nowPlayingItem.MediaType=="Audio"){url="css/images/items/detail/audio.png";}
else{url="css/images/items/detail/video.png";}
if(url==currentImgUrl){return;}
currentImgUrl=url;nowPlayingImageElement.html('<img src="'+url+'" />');}
function onPlaybackStart(e,state){console.log('nowplaying event: '+e.type);var player=this;player.beginPlayerUpdates();onStateChanged.call(player,e,state);}
function showNowPlayingBar(){var nowPlayingBar=getNowPlayingBar();nowPlayingBar.show();}
function hideNowPlayingBar(){getNowPlayingBar().hide();}
function onPlaybackStopped(e,state){console.log('nowplaying event: '+e.type);var player=this;player.endPlayerUpdates();hideNowPlayingBar();}
function onStateChanged(e,state){var player=this;if(player.isDefaultPlayer&&state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'){return;}
updatePlayerState(state);}
function releaseCurrentPlayer(){if(currentPlayer){$(currentPlayer).off('.nowplayingbar');currentPlayer.endPlayerUpdates();currentPlayer=null;hideNowPlayingBar();}}
function onVolumeChanged(e){var player=this;player.getPlayerState().done(function(state){if(player.isDefaultPlayer&&state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'){return;}
updatePlayerVolumeState(state);});}
function bindToPlayer(player){releaseCurrentPlayer();currentPlayer=player;player.getPlayerState().done(function(state){if(state.NowPlayingItem){player.beginPlayerUpdates();}
onStateChanged.call(player,{type:'init'},state);});$(player).on('playbackstart.nowplayingbar',onPlaybackStart).on('playbackstop.nowplayingbar',onPlaybackStopped).on('volumechange.nowplayingbar',onVolumeChanged).on('playstatechange.nowplayingbar',onStateChanged).on('positionchange.nowplayingbar',onStateChanged);}
$(function(){$(MediaController).on('playerchange',function(){bindToPlayer(MediaController.getCurrentPlayer());});bindToPlayer(MediaController.getCurrentPlayer());});})(window,document,jQuery,setTimeout,clearTimeout);(function(window,document,$,setTimeout,clearTimeout){var currentPlayer;var lastPlayerState;var isPositionSliderActive;function populateChapters(elem,chapters,itemId,runtimeTicks){var html='';for(var i=0,length=chapters.length;i<length;i++){var chapter=chapters[i];html+='<div data-positionticks="'+chapter.StartPositionTicks+'" class="posterItem backdropPosterItem chapterPosterItem">';var imgUrl;if(chapter.ImageTag){imgUrl=ApiClient.getScaledImageUrl(itemId,{width:240,tag:chapter.ImageTag,type:"Chapter",index:i});}else{imgUrl="css/images/items/list/chapter.png";}
var dataSrc=' data-src="'+imgUrl+'"';html+='<div class="posterItemImage lazy"'+dataSrc+'>';html+='<div class="posterItemTextOverlay" style="position:absolute;bottom:0;left:0;right:0;">';if(chapter.Name){html+="<div class='posterItemText'>";html+=chapter.Name;html+="</div>";}
html+="<div class='posterItemProgress posterItemText'>";var pct=100*(chapter.StartPositionTicks/runtimeTicks);html+='<progress class="itemProgressBar" min="0" max="100" value="'+pct+'" style="opacity:.8;width:100%;"></progress>';html+="</div>";html+="</div>";html+="</div>";html+="</div>";}
elem.html(html).trigger('create').lazyChildren();}
function selectCurrentChapter(elem,positionTicks){var elems=$('.chapterPosterItem',elem).removeClass('currentChapter');var matches=elems.get().filter(function(i){var ticks=i.getAttribute('data-positionticks');return positionTicks>=ticks;});var chapterElem=matches[matches.length-1];$(chapterElem).addClass('currentChapter');chapterElem.scrollIntoView();elem[0].scrollLeft+=50;}
function showChapterMenu(page,item,currentPositionTicks){$('.chapterMenuOverlay',page).show();var elem=$('.chapterMenu',page).show();if(item.Id==elem.attr('data-itemid')){selectCurrentChapter(elem,currentPositionTicks);return;}
var innerElem=$('.chapterMenuInner',elem);populateChapters(innerElem,item.Chapters,item.Id,item.RunTimeTicks);elem.attr('data-itemid',item.Id);selectCurrentChapter(elem,currentPositionTicks);}
function hideChapterMenu(page){$('.chapterMenuOverlay',page).hide();$('.chapterMenu',page).hide();}
function showAudioMenu(page,item,currentIndex){var streams=(item.MediaStreams||[]).filter(function(i){return i.Type=='Audio';});var elem=$('#popupAudioTrackMenu',page);var html='<ul data-role="listview" data-inset="true" style="min-width: 210px;"><li data-role="list-divider">'+Globalize.translate('HeaderSelectAudio')+'</li>';html+=streams.map(function(s){var streamHtml='<li><a data-index="'+s.Index+'" href="#" class="lnkTrackOption">';streamHtml+='<h3>';if(s.Index==currentIndex){streamHtml+='<img src="css/images/checkmarkgreen.png" style="width:18px;border-radius:3px;margin-right:.5em;vertical-align:top;" />';}
streamHtml+=(s.Codec||'').toUpperCase();if(s.Profile){streamHtml+=' '+s.Profile;}
streamHtml+='</h3><p>';var extras=[];if(s.Language){extras.push(s.Language);}
if(s.Layout){extras.push(s.Layout);}
else if(s.Channels){extras.push(s.Channels+' ch');}
if(s.BitRate){extras.push((parseInt(s.BitRate/1000))+' kbps');}
streamHtml+=extras.join(' - ');streamHtml+='</p></a></li>';return streamHtml;}).join('');html+='</ul>';$('.trackList',elem).html(html).trigger('create');elem.popup('open');}
function showSubtitleMenu(page,item,currentIndex){var currentStreamImage='<img src="css/images/checkmarkgreen.png" style="width:18px;border-radius:3px;margin-right:.5em;vertical-align:top;" />';var streams=(item.MediaStreams||[]).filter(function(i){return i.Type=='Subtitle';});var elem=$('#popupSubtitleTrackMenu',page);var html='<ul data-role="listview" data-inset="true" style="min-width: 210px;"><li data-role="list-divider">'+Globalize.translate('HeaderSelectSubtitles')+'</li>';html+='<li><a href="#" data-index="-1" class="lnkTrackOption"><h3>';if(currentIndex==null){html+=currentStreamImage;}
html+='Off';html+='</h3></a></li>';html+=streams.map(function(s){var streamHtml='<li><a data-index="'+s.Index+'" href="#" class="lnkTrackOption">';streamHtml+='<h3>';if(s.Index==currentIndex){streamHtml+=currentStreamImage;}
streamHtml+=(s.Language||Globalize.translate('LabelUnknownLanguage'));if(s.IsDefault&&s.IsForced){streamHtml+=' '+Globalize.translate('LabelDefaultForcedStream');}
else if(s.IsDefault){streamHtml+=' '+Globalize.translate('LabelDefaultStream');}
else if(s.IsForced){streamHtml+=' '+Globalize.translate('LabelForcedStream');}
streamHtml+='</h3><p>';streamHtml+=(s.Codec||'').toUpperCase();streamHtml+='</p></a></li>';return streamHtml;}).join('');html+='</ul>';$('.trackList',elem).html(html).trigger('create');elem.popup('open');}
function bindEvents(page){$('.tabButton',page).on('click',function(){var elem=$('.'+this.getAttribute('data-tab'),page);elem.siblings('.tabContent').hide();elem.show();$('.tabButton',page).removeClass('ui-btn-active');$(this).addClass('ui-btn-active');});$('.chapterMenuOverlay',page).on('click',function(){hideChapterMenu(page);});$('.chapterMenu',page).on('click','.chapterPosterItem',function(){if(currentPlayer){var ticks=this.getAttribute('data-positionticks')||'0';currentPlayer.seek(parseInt(ticks));}
hideChapterMenu(page);});$('.btnCommand,.btnToggleFullscreen',page).on('click',function(){if(currentPlayer){MediaController.sendCommand({Name:this.getAttribute('data-command')},currentPlayer);}});$('#popupAudioTrackMenu',page).on('click','.lnkTrackOption',function(){if(currentPlayer&&lastPlayerState){var index=this.getAttribute('data-index');currentPlayer.setAudioStreamIndex(parseInt(index));$('#popupAudioTrackMenu',page).popup('close');}});$('#popupSubtitleTrackMenu',page).on('click','.lnkTrackOption',function(){if(currentPlayer&&lastPlayerState){var index=this.getAttribute('data-index');currentPlayer.setSubtitleStreamIndex(parseInt(index));$('#popupSubtitleTrackMenu',page).popup('close');}});$('.btnAudioTracks',page).on('click',function(){if(currentPlayer&&lastPlayerState&&lastPlayerState.PlayState){var currentIndex=lastPlayerState.PlayState.AudioStreamIndex;showAudioMenu(page,lastPlayerState.NowPlayingItem,currentIndex);}});$('.btnSubtitles',page).on('click',function(){if(currentPlayer&&lastPlayerState&&lastPlayerState.PlayState){var currentIndex=lastPlayerState.PlayState.SubtitleStreamIndex;showSubtitleMenu(page,lastPlayerState.NowPlayingItem,currentIndex);}});$('.btnChapters',page).on('click',function(){if(currentPlayer&&lastPlayerState){var currentPositionTicks=lastPlayerState.PlayState.PositionTicks;showChapterMenu(page,lastPlayerState.NowPlayingItem,currentPositionTicks);}});$('.btnStop',page).on('click',function(){if(currentPlayer){currentPlayer.stop();}});$('.btnPlay',page).on('click',function(){if(currentPlayer){currentPlayer.unpause();}});$('.btnPause',page).on('click',function(){if(currentPlayer){currentPlayer.pause();}});$('.btnNextTrack',page).on('click',function(){if(currentPlayer){currentPlayer.nextTrack();}});$('.btnPreviousTrack',page).on('click',function(){if(currentPlayer){currentPlayer.previousTrack();}});$('.positionSlider',page).on('slidestart',function(){isPositionSliderActive=true;}).on('slidestop',function(){isPositionSliderActive=false;if(currentPlayer&&lastPlayerState){var newPercent=parseFloat(this.value);var newPositionTicks=(newPercent/100)*lastPlayerState.NowPlayingItem.RunTimeTicks;currentPlayer.seek(Math.floor(newPositionTicks));}});$(page).on('swipedown',function(){document.title=new Date().getTime();history.back();});$(page).on('click','.lnkPlayFromIndex',function(){var index=parseInt(this.getAttribute('data-index'));MediaController.currentPlaylistIndex(index);loadPlaylist(page);}).on('click','.lnkRemoveFromPlaylist',function(){var index=parseInt(this.getAttribute('data-index'));MediaController.removeFromPlaylist(index);loadPlaylist(page);});}
function onPlaybackStart(e,state){var player=this;player.beginPlayerUpdates();onStateChanged.call(player,e,state);}
function onPlaybackStopped(e,state){var player=this;player.endPlayerUpdates();onStateChanged.call(player,e,{});}
function onStateChanged(e,state){updatePlayerState($.mobile.activePage,state);}
function showButton(button){button.removeClass('hide');}
function hideButton(button){button.addClass('hide');}
function hasStreams(item,type){return item&&item.MediaStreams&&item.MediaStreams.filter(function(i){return i.Type==type;}).length>0;}
function updatePlayerState(page,state){lastPlayerState=state;var item=state.NowPlayingItem;var playerInfo=MediaController.getPlayerInfo();var supportedCommands=playerInfo.supportedCommands;var playState=state.PlayState||{};$('.btnToggleFullscreen',page).buttonEnabled(item&&item.MediaType=='Video'&&supportedCommands.indexOf('ToggleFullscreen')!=-1);$('.btnAudioTracks',page).buttonEnabled(hasStreams(item,'Audio')&&supportedCommands.indexOf('SetAudioStreamIndex')!=-1);$('.btnSubtitles',page).buttonEnabled(hasStreams(item,'Subtitle')&&supportedCommands.indexOf('SetSubtitleStreamIndex')!=-1);if(item&&item.Chapters&&item.Chapters.length&&playState.CanSeek){$('.btnChapters',page).buttonEnabled(true);}else{$('.btnChapters',page).buttonEnabled(false);hideChapterMenu(page);}
$('.sendMessageElement',page).buttonEnabled(supportedCommands.indexOf('DisplayMessage')!=-1);$('.typeTextElement',page).buttonEnabled(supportedCommands.indexOf('SendString')!=-1);$('.btnStop',page).buttonEnabled(item!=null);$('.btnNextTrack',page).buttonEnabled(item!=null);$('.btnPreviousTrack',page).buttonEnabled(item!=null);var btnPause=$('.btnPause',page).buttonEnabled(item!=null);var btnPlay=$('.btnPlay',page).buttonEnabled(item!=null);if(playState.IsPaused){hideButton(btnPause);showButton(btnPlay);}else{showButton(btnPause);hideButton(btnPlay);}
if(!isPositionSliderActive){var positionSlider=$('.positionSlider',page);if(item&&item.RunTimeTicks){var pct=playState.PositionTicks/item.RunTimeTicks;pct*=100;positionSlider.val(pct);}else{positionSlider.val(0);}
if(playState.CanSeek){positionSlider.slider("enable");}else{positionSlider.slider("disable");}
positionSlider.slider('refresh');}
if(playState.PositionTicks==null){$('.positionTime',page).html('--:--');}else{$('.positionTime',page).html(Dashboard.getDisplayTime(playState.PositionTicks));}
if(item&&item.RunTimeTicks!=null){$('.runtime',page).html(Dashboard.getDisplayTime(item.RunTimeTicks));}else{$('.runtime',page).html('--:--');}
if(item&&item.MediaType=='Video'){$('.videoButton',page).css('visibility','visible');}else{$('.videoButton',page).css('visibility','hidden');}
updateNowPlayingInfo(page,state);}
var currentImgUrl;function updateNowPlayingInfo(page,state){var item=state.NowPlayingItem;$('.itemName',page).html(item?MediaPlayer.getNowPlayingNameHtml(state):'');var url;if(!item){}
else if(item.PrimaryImageTag){url=ApiClient.getScaledImageUrl(item.PrimaryImageItemId,{type:"Primary",height:300,tag:item.PrimaryImageTag});}
else if(item.BackdropImageTag){url=ApiClient.getScaledImageUrl(item.BackdropItemId,{type:"Backdrop",height:300,tag:item.BackdropImageTag,index:0});}else if(item.ThumbImageTag){url=ApiClient.getScaledImageUrl(item.ThumbImageItemId,{type:"Thumb",height:300,tag:item.ThumbImageTag});}
if(url==currentImgUrl){return;}
setImageUrl(page,url);}
function setImageUrl(page,url){currentImgUrl=url;$('.nowPlayingPageImage',page).html(url?'<img src="'+url+'" />':'');}
function updateSupportedCommands(page,commands){$('.btnCommand',page).each(function(){$(this).buttonEnabled(commands.indexOf(this.getAttribute('data-command'))!=-1);});}
function releaseCurrentPlayer(){if(currentPlayer){$(currentPlayer).off('.nowplayingpage');currentPlayer.endPlayerUpdates();currentPlayer=null;}}
function bindToPlayer(page,player){releaseCurrentPlayer();currentPlayer=player;player.getPlayerState().done(function(state){if(state.NowPlayingItem){player.beginPlayerUpdates();}
onStateChanged.call(player,{type:'init'},state);});$(player).on('playbackstart.nowplayingpage',onPlaybackStart).on('playbackstop.nowplayingpage',onPlaybackStopped).on('volumechange.nowplayingpage',onStateChanged).on('playstatechange.nowplayingpage',onStateChanged).on('positionchange.nowplayingpage',onStateChanged);var playerInfo=MediaController.getPlayerInfo();var supportedCommands=playerInfo.supportedCommands;updateSupportedCommands(page,supportedCommands);}
function showIntro(){if(store.getItem('remotecontrolswipedown')!='1'){Dashboard.alert({message:Globalize.translate('MessageSwipeDownOnRemoteControl'),title:Globalize.translate('HeaderAlert')});store.setItem('remotecontrolswipedown','1');}}
function loadPlaylist(page){var html='';html+=LibraryBrowser.getListViewHtml({items:MediaController.playlist(),smallIcon:true,defaultAction:'play'});$(".playlist",page).html(html).trigger('create').lazyChildren();}
$(document).on('pageinit',"#nowPlayingPage",function(){var page=this;bindEvents(page);}).on('pageshow',"#nowPlayingPage",function(){var page=this;var tab=getParameterByName('tab');if(tab){$('.tabButton'+tab,page).trigger('click');}else{$('.tabButton:first',page).trigger('click');}
$(function(){$(MediaController).on('playerchange.nowplayingpage',function(){bindToPlayer(page,MediaController.getCurrentPlayer());});bindToPlayer(page,MediaController.getCurrentPlayer());});showIntro();loadPlaylist(page);}).on('pagehide',"#nowPlayingPage",function(){releaseCurrentPlayer();$(MediaController).off('playerchange.nowplayingpage');lastPlayerState=null;});window.NowPlayingPage={onMessageSubmit:function(){var form=this;MediaController.sendCommand({Name:'DisplayMessage',Arguments:{Header:$('#txtMessageTitle',form).val(),Text:$('#txtMessageText',form).val()}},currentPlayer);$('input',form).val('');Dashboard.alert('Message sent.');return false;},onSendStringSubmit:function(){var form=this;MediaController.sendCommand({Name:'SendString',Arguments:{String:$('#txtTypeText',form).val()}},currentPlayer);$('input',form).val('');Dashboard.alert('Text sent.');return false;}};})(window,document,jQuery,setTimeout,clearTimeout);$.fn.taskButton=function(options){function pollTasks(button){ApiClient.getScheduledTasks({IsEnabled:true}).done(function(tasks){updateTasks(button,tasks);});}
function updateTasks(button,tasks){var task=tasks.filter(function(t){return t.Key==options.taskKey;})[0];if(options.panel){if(task){$(options.panel).show();}else{$(options.panel).hide();}}
if(!task){return;}
button.buttonEnabled(task.State=='Idle').attr('data-taskid',task.Id);var progress=(task.CurrentProgressPercentage||0).toFixed(1);if(options.progressElem){var progressElem=options.progressElem.val(progress);if(task.State=='Running'){progressElem.show();}else{progressElem.hide();}}
if(options.lastResultElem){var lastResult=task.LastExecutionResult?task.LastExecutionResult.Status:'';if(lastResult=="Failed"){options.lastResultElem.html('<span style="color:#FF0000;">'+Globalize.translate('LabelFailed')+'</span>');}
else if(lastResult=="Cancelled"){options.lastResultElem.html('<span style="color:#0026FF;">'+Globalize.translate('LabelCancelled')+'</span>');}
else if(lastResult=="Aborted"){options.lastResultElem.html('<span style="color:#FF0000;">'+Globalize.translate('LabelAbortedByServerShutdown')+'</span>');}else{options.lastResultElem.html(lastResult);}}}
function onScheduledTaskMessageConfirmed(instance,id){ApiClient.startScheduledTask(id).done(function(){pollTasks(instance);});}
function onButtonClick(instance,id){var key='scheduledTaskButton'+options.taskKey;var expectedValue='4';if(store.getItem(key)==expectedValue){onScheduledTaskMessageConfirmed(instance,id);}else{var msg=Globalize.translate('ConfirmMessageScheduledTaskButton');msg+='<br/>';msg+='<br/>';msg+='<a href="scheduledtasks.html">'+Globalize.translate('ButtonScheduledTasks')+'</a>';Dashboard.confirm(msg,Globalize.translate('HeaderConfirmation'),function(result){if(result){store.setItem(key,expectedValue);onScheduledTaskMessageConfirmed(instance,id);}});}}
var self=this;if(options.panel){$(options.panel).hide();}
if(options.mode=='off'){this.off(".taskbutton");$(ApiClient).off(".taskbutton");if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop");}}else if(this.length){this.on('click.taskbutton',function(){var button=this;var id=button.getAttribute('data-taskid');onButtonClick(self,id);});pollTasks(self);if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000");}
$(ApiClient).on("websocketmessage.taskbutton",function(e,msg){if(msg.MessageType=="ScheduledTasksInfo"){var tasks=msg.Data;updateTasks(self,tasks);}}).on('websocketopen.taskbutton',function(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000");}});}
return this;};(function(window,document,$){window.RatingDialog=function(page){var self=this;self.show=function(options){options=options||{};options.header=options.header||Globalize.translate('HeaderRateAndReview');var html='<div data-role="popup" id="popupRatingDialog" class="popup" style="min-width:400px;">';html+='<div class="ui-bar-a" style="text-align: center; padding: 0 20px;">';html+='<h3>'+options.header+'</h3>';html+='</div>';html+='<div style="padding: 1em;">';html+='<form>';html+='<div style="margin:0;">';html+='<label for="txtRatingDialogRating" >'+Globalize.translate('LabelYourRating')+'</label>';html+='<input id="txtRatingDialogRating" name="rating" type="number" required="required" min=0 max=5 step=1 value='+options.rating+' />';html+='<label for="txtRatingDialogTitle" >'+Globalize.translate('LabelShortRatingDescription')+'</label>';html+='<input id="txtRatingDialogTitle" name="title" type="text" maxlength=160 />';html+='<label for="txtRatingDialogRecommend" >'+Globalize.translate('OptionIRecommendThisItem')+'</label>';html+='<input id="txtRatingDialogRecommend" name="recommend" type="checkbox" checked />';html+='<label for="txtRatingDialogReview" >'+Globalize.translate('LabelFullReview')+'</label>';html+='<textarea id="txtRatingDialogReview" name="review" rows=8 style="height:inherit" ></textarea>';html+='</div>';html+='<p>';html+='<button type="submit" data-theme="b" data-icon="check">'+Globalize.translate('ButtonOk')+'</button>';html+='<button type="button" data-icon="delete" onclick="$(this).parents(\'.popup\').popup(\'close\');">'+Globalize.translate('ButtonCancel')+'</button>';html+='</p>';html+='<p id="errorMsg" style="display:none; color:red; font-weight:bold">';html+='</p>';html+='</form>';html+='</div>';html+='</div>';$(page).append(html);var popup=$('#popupRatingDialog').popup().trigger('create').on("popupafteropen",function(){$('#txtRatingDialogTitle',this).focus();}).popup("open").on("popupafterclose",function(){$('form',this).off("submit");$(this).off("popupafterclose").remove();});$('form',popup).on('submit',function(){if(options.callback){var review={id:options.id,rating:$('#txtRatingDialogRating',this).val(),title:$('#txtRatingDialogTitle',this).val(),recommend:$('#txtRatingDialogRecommend',this).checked(),review:$('#txtRatingDialogReview',this).val(),};options.callback(review);}else console.log("No callback function provided");return false;});};self.close=function(){$('#popupRatingDialog',page).popup("close");};};window.RatingHelpers={ratePackage:function(link){var id=link.getAttribute('data-id');var rating=link.getAttribute('data-rating');var dialog=new RatingDialog($.mobile.activePage);dialog.show({header:Globalize.translate('HeaderRateAndReview'),id:id,rating:rating,callback:function(review){console.log(review);dialog.close();ApiClient.createPackageReview(review).done(function(){Dashboard.alert({message:Globalize.translate('MessageThankYouForYourReview'),title:Globalize.translate('HeaderThankYou')});});}});},getStoreRatingHtml:function(rating,id,name,noLinks){var html="<div style='margin-left: 5px; margin-right: 5px; display: inline-block; vertical-align:middle;'>";if(!rating)rating=0;for(var i=1;i<=5;i++){var title=noLinks?rating+" stars":"Rate "+i+(i>1?" stars":" star");html+=noLinks?"":"<span data-id="+id+" data-name='"+name+"' data-rating="+i+" onclick='RatingHelpers.ratePackage(this);return false;' >";if(rating<=i-1){html+="<div class='storeStarRating emptyStarRating' title='"+title+"'></div>";}else if(rating<i){html+="<div class='storeStarRating halfStarRating' title='"+title+"'></div>";}else{html+="<div class='storeStarRating' title='"+title+"'></div>";}
html+=noLinks?"":"</span>";}
html+="</div>";return html;}};})(window,document,jQuery);(function($,document){$(document).on('pageshow',"#aboutPage",function(){var page=this;var elem=$('#appVersionNumber',page);elem.html(elem.html().replace('{0}',ConnectionManager.appVersion()));});})(jQuery,document);(function(window,document,$){function getPickerHtml(){var html='';html+='<a href="#">#</a>';html+='<a href="#">A</a>';html+='<a href="#">B</a>';html+='<a href="#">C</a>';html+='<a href="#">D</a>';html+='<a href="#">E</a>';html+='<a href="#">F</a>';html+='<a href="#">G</a>';html+='<a href="#">H</a>';html+='<a href="#">I</a>';html+='<a href="#">J</a>';html+='<a href="#">K</a>';html+='<a href="#">L</a>';html+='<a href="#">M</a>';html+='<a href="#">N</a>';html+='<a href="#">O</a>';html+='<a href="#">P</a>';html+='<a href="#">Q</a>';html+='<a href="#">R</a>';html+='<a href="#">S</a>';html+='<a href="#">T</a>';html+='<a href="#">U</a>';html+='<a href="#">V</a>';html+='<a href="#">W</a>';html+='<a href="#">X</a>';html+='<a href="#">Y</a>';html+='<a href="#">Z</a>';return html;}
$(document).on('pageinit',".libraryPage",function(){var page=this;var picker=$('.alphabetPicker',page);if(!picker.length){return;}
$('.itemsContainer',page).addClass('itemsContainerWithAlphaPicker');picker.html(getPickerHtml()).trigger('create').on('click','a',function(){var elem=$(this);var isSelected=elem.hasClass('selectedCharacter');$('.selectedCharacter',picker).removeClass('selectedCharacter');if(!isSelected){elem.addClass('selectedCharacter');picker.trigger('alphaselect',[this.innerHTML]);}else{picker.trigger('alphaclear');}});});$.fn.alphaValue=function(val){if(val==null){return $('.selectedCharacter',this).html();}
val=val.toLowerCase();$('.selectedCharacter',this).removeClass('selectedCharacter');$('a',this).each(function(){if(this.innerHTML.toLowerCase()==val){$(this).addClass('selectedCharacter');}else{$(this).removeClass('selectedCharacter');}});return this;};$.fn.alphaClear=function(val){return this.alphaValue('');};})(window,document,jQuery);(function($,document,window){function populateHistory(packageInfo,page){var html='';for(var i=0,length=Math.min(packageInfo.versions.length,10);i<length;i++){var version=packageInfo.versions[i];html+='<h2 style="margin:.5em 0;">'+version.versionStr+' ('+version.classification+')</h2>';html+='<div style="margin-bottom:1.5em;">'+version.description+'</div>';}
$('#revisionHistory',page).html(html);}
function populateVersions(packageInfo,page,installedPlugin){var html='';for(var i=0,length=packageInfo.versions.length;i<length;i++){var version=packageInfo.versions[i];html+='<option value="'+version.versionStr+'|'+version.classification+'">'+version.versionStr+' ('+version.classification+')</option>';}
var selectmenu=$('#selectVersion',page).html(html);if(!installedPlugin){$('#pCurrentVersion',page).hide().html("");}
var packageVersion=packageInfo.versions.filter(function(current){return current.classification=="Release";})[0];if(!packageVersion){packageVersion=packageInfo.versions.filter(function(current){return current.classification=="Beta";})[0];}
selectmenu.selectmenu('refresh');if(packageVersion){var val=packageVersion.versionStr+'|'+packageVersion.classification;selectmenu.val(val).selectmenu('refresh');}}
function populateReviews(id,page){ApiClient.getPackageReviews(id,null,null,3).done(function(positive){var html='';if(positive&&positive.length>0){html+='<div data-role="collapsible" data-collapsed="true" style="margin-top: 2em;" >';html+='<h3>'+Globalize.translate('HeaderLatestReviews')+'</h3>';html+="<div><br/>";for(var i=0;i<positive.length;i++){var review=positive[i];html+="<div>";html+="<span class='storeItemReviewText'>";html+=new Date(review.timestamp).toDateString();html+=" "+RatingHelpers.getStoreRatingHtml(review.rating,review.id,review.name,true);html+=" "+review.title;html+="</span>";if(review.review){html+="<p class='storeItemReviewText'>";html+=review.review;html+="</p>";}
html+="</div>";html+="<hr/>";}
html+="</div>";html+="</div>";}
$('#latestReviews',page).html(html).trigger('create');});}
function renderPackage(pkg,installedPlugins,pluginSecurityInfo,page){var installedPlugin=installedPlugins.filter(function(ip){return ip.Name==pkg.name;})[0];populateVersions(pkg,page,installedPlugin);populateHistory(pkg,page);if(pkg.totalRatings>0)populateReviews(pkg.id,page);$('.pluginName',page).html(pkg.name);if(pkg.targetSystem=='Server'){$("#btnInstallDiv",page).show();$("#nonServerMsg",page).hide();$("#pSelectVersion",page).show();}else{$("#btnInstallDiv",page).hide();$("#pSelectVersion",page).hide();var msg=Globalize.translate('MessageInstallPluginFromApp');$("#nonServerMsg",page).html(msg).show();}
if(pkg.shortDescription){$('#tagline',page).show().html(pkg.shortDescription);}else{$('#tagline',page).hide();}
$('#overview',page).html(pkg.overview||"");$('#developer',page).html(pkg.owner);if(pkg.isPremium){$('.premiumPackage',page).show();var regStatus="";if(pkg.isRegistered){regStatus+="<p style='color:green;'>";regStatus+=Globalize.translate('MessageFeatureIncludedWithSupporter');}else{var expDateTime=new Date(pkg.expDate).getTime();var nowTime=new Date().getTime();if(expDateTime<=nowTime){regStatus+="<p style='color:red;'>";regStatus+=Globalize.translate('MessageTrialExpired');}
else if(expDateTime>new Date(1970,1,1).getTime()){regStatus+="<p style='color:blue;'>";regStatus+=Globalize.translate('MessageTrialWillExpireIn').replace('{0}',Math.round(expDateTime-nowTime)/(86400000));}}
regStatus+="</p>";$('#regStatus',page).html(regStatus);if(pluginSecurityInfo.IsMBSupporter){$('#regInfo',page).html(pkg.regInfo||"");$('.premiumDescription',page).hide();$('.supporterDescription',page).hide();if(pkg.price>0){$('.premiumHasPrice',page).show();$('#featureId',page).val(pkg.featureId);$('#featureName',page).val(pkg.name);$('#amount',page).val(pkg.price);$('#regPrice',page).html("<h3>"+Globalize.translate('ValuePriceUSD').replace('{0}',"$"+pkg.price.toFixed(2))+"</h3>");var url="http://mb3admin.com/admin/service/user/getPayPalEmail?id="+pkg.owner;$.getJSON(url).done(function(dev){if(dev.payPalEmail){$('#payPalEmail',page).val(dev.payPalEmail);}else{$('#ppButton',page).hide();}});}else{$('.premiumHasPrice',page).hide();}}else{if(pkg.price){$('.premiumDescription',page).show();$('.supporterDescription',page).hide();$('#regInfo',page).html("");}else{$('.premiumDescription',page).hide();$('.supporterDescription',page).show();$('#regInfo',page).html("");}
$('#ppButton',page).hide();}}else{$('.premiumPackage',page).hide();}
var ratingHtml=RatingHelpers.getStoreRatingHtml(pkg.avgRating,pkg.id,pkg.name);ratingHtml+="<span class='storeReviewCount'>";ratingHtml+=" "+Globalize.translate('ValueReviewCount').replace('{0}',pkg.totalRatings);ratingHtml+="</span>";$('#ratingLine',page).html(ratingHtml);if(pkg.richDescUrl){$('#pViewWebsite',page).show();$('#pViewWebsite a',page)[0].href=pkg.richDescUrl;}else{$('#pViewWebsite',page).hide();}
if(pkg.previewImage||pkg.thumbImage){var color=pkg.tileColor||"#38c";var img=pkg.previewImage?pkg.previewImage:pkg.thumbImage;$('#pPreviewImage',page).show().html("<img src='"+img+"' style='max-width: 100%;-moz-box-shadow: 0 0 20px 3px "+color+";-webkit-box-shadow: 0 0 20px 3px "+color+";box-shadow: 0 0 20px 3px "+color+";' />");}else{$('#pPreviewImage',page).hide().html("");}
if(installedPlugin){var currentVersionText=Globalize.translate('MessageYouHaveVersionInstalled').replace('{0}','<strong>'+installedPlugin.Version+'</strong>');$('#pCurrentVersion',page).show().html(currentVersionText);}else{$('#pCurrentVersion',page).hide().html("");}
Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#addPluginPage",function(){var page=this;Dashboard.showLoadingMsg();var name=getParameterByName('name');var guid=getParameterByName('guid');var promise1=ApiClient.getPackageInfo(name,guid);var promise2=ApiClient.getInstalledPlugins();var promise3=ApiClient.getPluginSecurityInfo();$.when(promise1,promise2,promise3).done(function(response1,response2,response3){renderPackage(response1[0],response2[0],response3[0],page);});}).on('pagebeforeshow pageinit pageshow',"#addPluginPage",function(){var page=this;var context=getParameterByName('context');$('.syncTabs',page).hide();$('.pluginTabs',page).hide();$('.livetvTabs',page).hide();$('.notificationsTabs',page).hide();if(context=='sync'){$('.syncTabs',page).show();page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Sync');Dashboard.setPageTitle(Globalize.translate('TitleSync'));}
else if(context=='livetv'){$('.livetvTabs',page).show();Dashboard.setPageTitle(Globalize.translate('TitleLiveTV'));page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Live%20TV');}
else if(context=='notifications'){$('.notificationsTabs',page).show();Dashboard.setPageTitle(Globalize.translate('TitleNotifications'));page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Notifications');}
else{$('.pluginTabs',page).show();page.setAttribute('data-helpurl','https://github.com/MediaBrowser/Wiki/wiki/Plugins');Dashboard.setPageTitle(Globalize.translate('TitlePlugins'));}});function performInstallation(packageName,guid,updateClass,version){ApiClient.installPlugin(packageName,guid,updateClass,version).done(function(){Dashboard.hideLoadingMsg();});}
function addPluginpage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var page=$(this).parents('#addPluginPage');$('#btnInstall',page).buttonEnabled(false);var name=getParameterByName('name');var guid=getParameterByName('guid');ApiClient.getInstalledPlugins().done(function(plugins){var installedPlugin=plugins.filter(function(ip){return ip.Name==name;})[0];var vals=$('#selectVersion',page).val().split('|');var version=vals[0];if(installedPlugin&&installedPlugin.Version==version){Dashboard.hideLoadingMsg();Dashboard.alert({message:Globalize.translate('MessageAlreadyInstalled'),title:Globalize.translate('HeaderPluginInstallation')});}else{performInstallation(name,guid,vals[1],version);}});return false;};}
window.AddPluginPage=new addPluginpage();})(jQuery,document,window);(function($,document,window){function loadPage(page,config,systemInfo){var os=systemInfo.OperatingSystem.toLowerCase();if(os.indexOf('windows')!=-1){$('#windowsStartupDescription',page).show();}else{$('#windowsStartupDescription',page).hide();}
if(systemInfo.SupportsAutoRunAtStartup){$('#fldRunAtStartup',page).show();}else{$('#fldRunAtStartup',page).hide();}
$('#chkEnableAutomaticRestart',page).checked(config.EnableAutomaticRestart).checkboxradio("refresh");if(systemInfo.CanSelfRestart){$('#fldEnableAutomaticRestart',page).show();}else{$('#fldEnableAutomaticRestart',page).hide();}
$('#selectAutomaticUpdateLevel',page).val(config.SystemUpdateLevel).selectmenu('refresh').trigger('change');$('#chkDebugLog',page).checked(config.EnableDebugLevelLogging).checkboxradio("refresh");$('#chkRunAtStartup',page).checked(config.RunAtStartup).checkboxradio("refresh");$('#chkEnableDashboardResponseCache',page).checked(config.EnableDashboardResponseCaching).checkboxradio("refresh");$('#chkEnableMinification',page).checked(config.EnableDashboardResourceMinification).checkboxradio("refresh");$('#txtDashboardSourcePath',page).val(config.DashboardSourcePath).trigger('change');Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#advancedConfigurationPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getServerConfiguration();var promise2=ApiClient.getSystemInfo();$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});}).on('pageinit',"#advancedConfigurationPage",function(){var page=this;$('#selectAutomaticUpdateLevel',page).on('change',function(){if(this.value=="Dev"){$('#devBuildWarning',page).show();}else{$('#devBuildWarning',page).hide();}});$('#btnSelectDashboardSourcePath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtDashboardSourcePath',page).val(path);}
picker.close();}});});});function advancedConfigurationPage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getServerConfiguration().done(function(config){config.EnableDebugLevelLogging=$('#chkDebugLog',form).checked();config.RunAtStartup=$('#chkRunAtStartup',form).checked();config.SystemUpdateLevel=$('#selectAutomaticUpdateLevel',form).val();config.EnableAutomaticRestart=$('#chkEnableAutomaticRestart',form).checked();config.EnableDashboardResourceMinification=$('#chkEnableMinification',form).checked();config.EnableDashboardResponseCaching=$('#chkEnableDashboardResponseCache',form).checked();config.DashboardSourcePath=$('#txtDashboardSourcePath',form).val();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;};}
window.AdvancedConfigurationPage=new advancedConfigurationPage();})(jQuery,document,window);(function(window,$){function loadAdvancedConfig(page,config){$('#chkSaveMetadataHidden',page).checked(config.SaveMetadataHidden).checkboxradio("refresh");$('#txtMetadataPath',page).val(config.MetadataPath||'');$('#chkPeopleActors',page).checked(config.PeopleMetadataOptions.DownloadActorMetadata).checkboxradio("refresh");$('#chkPeopleComposers',page).checked(config.PeopleMetadataOptions.DownloadComposerMetadata).checkboxradio("refresh");$('#chkPeopleDirectors',page).checked(config.PeopleMetadataOptions.DownloadDirectorMetadata).checkboxradio("refresh");$('#chkPeopleProducers',page).checked(config.PeopleMetadataOptions.DownloadProducerMetadata).checkboxradio("refresh");$('#chkPeopleWriters',page).checked(config.PeopleMetadataOptions.DownloadWriterMetadata).checkboxradio("refresh");$('#chkPeopleOthers',page).checked(config.PeopleMetadataOptions.DownloadOtherPeopleMetadata).checkboxradio("refresh");$('#chkPeopleGuestStars',page).checked(config.PeopleMetadataOptions.DownloadGuestStarMetadata).checkboxradio("refresh");Dashboard.hideLoadingMsg();}
function loadMetadataConfig(page,config){$('#selectDateAdded',page).val((config.UseFileCreationTimeForDateAdded?'1':'0')).selectmenu("refresh");}
function loadTmdbConfig(page,config){$('#chkEnableTmdbUpdates',page).checked(config.EnableAutomaticUpdates).checkboxradio("refresh");}
function loadTvdbConfig(page,config){$('#chkEnableTvdbUpdates',page).checked(config.EnableAutomaticUpdates).checkboxradio("refresh");}
function loadFanartConfig(page,config){$('#chkEnableFanartUpdates',page).checked(config.EnableAutomaticUpdates).checkboxradio("refresh");$('#txtFanartApiKey',page).val(config.UserApiKey||'');}
function loadChapters(page,config,providers){if(providers.length){$('.noChapterProviders',page).hide();$('.chapterDownloadSettings',page).show();}else{$('.noChapterProviders',page).show();$('.chapterDownloadSettings',page).hide();}
$('#chkChaptersMovies',page).checked(config.EnableMovieChapterImageExtraction).checkboxradio("refresh");$('#chkChaptersEpisodes',page).checked(config.EnableEpisodeChapterImageExtraction).checkboxradio("refresh");$('#chkChaptersOtherVideos',page).checked(config.EnableOtherVideoChapterImageExtraction).checkboxradio("refresh");$('#chkDownloadChapterMovies',page).checked(config.DownloadMovieChapters).checkboxradio("refresh");$('#chkDownloadChapterEpisodes',page).checked(config.DownloadEpisodeChapters).checkboxradio("refresh");$('#chkExtractChaptersDuringLibraryScan',page).checked(config.ExtractDuringLibraryScan).checkboxradio("refresh");renderChapterFetchers(page,config,providers);Dashboard.hideLoadingMsg();}
function renderChapterFetchers(page,config,plugins){var html='';if(!plugins.length){$('.chapterFetchers',page).html(html).hide().trigger('create');return;}
var i,length,plugin,id;html+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">';html+=Globalize.translate('LabelChapterDownloaders');html+='</div>';html+='<div style="display:inline-block;width: 75%;vertical-align:top;">';html+='<div data-role="controlgroup" class="chapterFetcherGroup">';for(i=0,length=plugins.length;i<length;i++){plugin=plugins[i];id='chkChapterFetcher'+i;var isChecked=config.DisabledFetchers.indexOf(plugin.Name)==-1?' checked="checked"':'';html+='<input class="chkChapterFetcher" type="checkbox" name="'+id+'" id="'+id+'" data-pluginname="'+plugin.Name+'" data-mini="true"'+isChecked+'>';html+='<label for="'+id+'">'+plugin.Name+'</label>';}
html+='</div>';html+='</div>';if(plugins.length>1){html+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">';for(i=0,length=plugins.length;i<length;i++){html+='<div style="margin:6px 0;">';if(i==0){html+='<button data-inline="true" disabled="disabled" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Up</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Down</button>';}else if(i==(plugins.length-1)){html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Up</button>';html+='<button data-inline="true" disabled="disabled" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Down</button>';}
else{html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Up</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">Down</button>';}
html+='</div>';}}
html+='</div>';html+='<div class="fieldDescription">'+Globalize.translate('LabelChapterDownloadersHelp')+'</div>';var elem=$('.chapterFetchers',page).html(html).show().trigger('create');$('.btnDown',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.chapterFetcherGroup .ui-checkbox',page)[index];var insertAfter=$(elemToMove).next('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertAfter(insertAfter);$('.chapterFetcherGroup',page).controlgroup('destroy').controlgroup();});$('.btnUp',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.chapterFetcherGroup .ui-checkbox',page)[index];var insertBefore=$(elemToMove).prev('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertBefore(insertBefore);$('.chapterFetcherGroup',page).controlgroup('destroy').controlgroup();});}
$(document).on('pageinit',"#advancedMetadataConfigurationPage",function(){var page=this;$('#btnSelectMetadataPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtMetadataPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectMetadataPath'),instruction:Globalize.translate('HeaderSelectMetadataPathHelp')});});}).on('pageshow',"#advancedMetadataConfigurationPage",function(){var page=this;ApiClient.getServerConfiguration().done(function(configuration){loadAdvancedConfig(page,configuration);});ApiClient.getNamedConfiguration("metadata").done(function(metadata){loadMetadataConfig(page,metadata);});ApiClient.getNamedConfiguration("fanart").done(function(metadata){loadFanartConfig(page,metadata);});ApiClient.getNamedConfiguration("themoviedb").done(function(metadata){loadTmdbConfig(page,metadata);});ApiClient.getNamedConfiguration("tvdb").done(function(metadata){loadTvdbConfig(page,metadata);});var promise1=ApiClient.getNamedConfiguration("chapters");var promise2=ApiClient.getJSON(ApiClient.getUrl("Providers/Chapters"));$.when(promise1,promise2).done(function(response1,response2){loadChapters(page,response1[0],response2[0]);});});function saveFanart(form){ApiClient.getNamedConfiguration("fanart").done(function(config){config.EnableAutomaticUpdates=$('#chkEnableFanartUpdates',form).checked();config.UserApiKey=$('#txtFanartApiKey',form).val();ApiClient.updateNamedConfiguration("fanart",config);});}
function saveTvdb(form){ApiClient.getNamedConfiguration("tvdb").done(function(config){config.EnableAutomaticUpdates=$('#chkEnableTvdbUpdates',form).checked();ApiClient.updateNamedConfiguration("tvdb",config);});}
function saveTmdb(form){ApiClient.getNamedConfiguration("themoviedb").done(function(config){config.EnableAutomaticUpdates=$('#chkEnableTmdbUpdates',form).checked();ApiClient.updateNamedConfiguration("themoviedb",config);});}
function saveAdvancedConfig(form){ApiClient.getServerConfiguration().done(function(config){config.SaveMetadataHidden=$('#chkSaveMetadataHidden',form).checked();config.EnableTvDbUpdates=$('#chkEnableTvdbUpdates',form).checked();config.EnableTmdbUpdates=$('#chkEnableTmdbUpdates',form).checked();config.EnableFanArtUpdates=$('#chkEnableFanartUpdates',form).checked();config.MetadataPath=$('#txtMetadataPath',form).val();config.FanartApiKey=$('#txtFanartApiKey',form).val();config.PeopleMetadataOptions.DownloadActorMetadata=$('#chkPeopleActors',form).checked();config.PeopleMetadataOptions.DownloadComposerMetadata=$('#chkPeopleComposers',form).checked();config.PeopleMetadataOptions.DownloadDirectorMetadata=$('#chkPeopleDirectors',form).checked();config.PeopleMetadataOptions.DownloadGuestStarMetadata=$('#chkPeopleGuestStars',form).checked();config.PeopleMetadataOptions.DownloadProducerMetadata=$('#chkPeopleProducers',form).checked();config.PeopleMetadataOptions.DownloadWriterMetadata=$('#chkPeopleWriters',form).checked();config.PeopleMetadataOptions.DownloadOtherPeopleMetadata=$('#chkPeopleOthers',form).checked();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});}
function saveMetadata(form){ApiClient.getNamedConfiguration("metadata").done(function(config){config.UseFileCreationTimeForDateAdded=$('#selectDateAdded',form).val()=='1';ApiClient.updateNamedConfiguration("metadata",config);});}
function saveChapters(form){ApiClient.getNamedConfiguration("chapters").done(function(config){config.EnableMovieChapterImageExtraction=$('#chkChaptersMovies',form).checked();config.EnableEpisodeChapterImageExtraction=$('#chkChaptersEpisodes',form).checked();config.EnableOtherVideoChapterImageExtraction=$('#chkChaptersOtherVideos',form).checked();config.DownloadMovieChapters=$('#chkDownloadChapterMovies',form).checked();config.DownloadEpisodeChapters=$('#chkDownloadChapterEpisodes',form).checked();config.ExtractDuringLibraryScan=$('#chkExtractChaptersDuringLibraryScan',form).checked();config.DisabledFetchers=$('.chkChapterFetcher:not(:checked)',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.FetcherOrder=$('.chkChapterFetcher',form).get().map(function(c){return c.getAttribute('data-pluginname');});ApiClient.updateNamedConfiguration("chapters",config);});}
window.AdvancedMetadataConfigurationPage={onSubmit:function(){var form=this;Dashboard.showLoadingMsg();saveAdvancedConfig(form);saveChapters(form);saveMetadata(form);saveTmdb(form);saveTvdb(form);saveFanart(form);return false;}};})(window,jQuery);(function($,document,window){function updateSeasonPatternHelp(page,value){var resultValue=value.replace('%s','1').replace('%0s','01').replace('%00s','001');var replacementHtmlResult=Globalize.translate('OrganizePatternResult').replace('{0}',resultValue);$('.seasonFolderFieldDescription',page).html(replacementHtmlResult);}
function getEpisodeFileName(value,enableMultiEpisode){var seriesName="Series Name";var episodeTitle="Episode Four";var result=value.replace('%sn',seriesName).replace('%s.n',seriesName.replace(' ','.')).replace('%s_n',seriesName.replace(' ','_')).replace('%s','1').replace('%0s','01').replace('%00s','001').replace('%ext','mkv').replace('%en',episodeTitle).replace('%e.n',episodeTitle.replace(' ','.')).replace('%e_n',episodeTitle.replace(' ','_'));if(enableMultiEpisode){result=result.replace('%ed','5').replace('%0ed','05').replace('%00ed','005');}
return result.replace('%e','4').replace('%0e','04').replace('%00e','004');}
function updateEpisodePatternHelp(page,value){value=getEpisodeFileName(value,false);var replacementHtmlResult=Globalize.translate('OrganizePatternResult').replace('{0}',value);$('.episodePatternDescription',page).html(replacementHtmlResult);}
function updateMultiEpisodePatternHelp(page,value){value=getEpisodeFileName(value,true);var replacementHtmlResult=Globalize.translate('OrganizePatternResult').replace('{0}',value);$('.multiEpisodePatternDescription',page).html(replacementHtmlResult);}
function loadPage(page,config){var tvOptions=config.TvOptions;$('#chkEnableTvSorting',page).checked(tvOptions.IsEnabled).checkboxradio('refresh');$('#chkOverwriteExistingEpisodes',page).checked(tvOptions.OverwriteExistingEpisodes).checkboxradio('refresh');$('#chkDeleteEmptyFolders',page).checked(tvOptions.DeleteEmptyFolders).checkboxradio('refresh');$('#txtMinFileSize',page).val(tvOptions.MinFileSizeMb);$('#txtSeasonFolderPattern',page).val(tvOptions.SeasonFolderPattern).trigger('change');$('#txtSeasonZeroName',page).val(tvOptions.SeasonZeroFolderName);$('#txtWatchFolder',page).val(tvOptions.WatchLocations[0]||'');$('#txtEpisodePattern',page).val(tvOptions.EpisodeNamePattern).trigger('change');$('#txtMultiEpisodePattern',page).val(tvOptions.MultiEpisodeNamePattern).trigger('change');$('#txtDeleteLeftOverFiles',page).val(tvOptions.LeftOverFileExtensionsToDelete.join(';'));$('#copyOrMoveFile',page).val(tvOptions.CopyOriginalFile.toString()).selectmenu('refresh');}
$(document).on('pageinit',"#libraryFileOrganizerPage",function(){var page=this;$('#txtSeasonFolderPattern',page).on('change keyup',function(){updateSeasonPatternHelp(page,this.value);});$('#txtEpisodePattern',page).on('change keyup',function(){updateEpisodePatternHelp(page,this.value);});$('#txtMultiEpisodePattern',page).on('change keyup',function(){updateMultiEpisodePatternHelp(page,this.value);});$('#btnSelectWatchFolder',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtWatchFolder',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectWatchFolder'),instruction:Globalize.translate('HeaderSelectWatchFolderHelp')});});}).on('pageshow',"#libraryFileOrganizerPage",function(){var page=this;ApiClient.getNamedConfiguration('autoorganize').done(function(config){loadPage(page,config);});});window.LibraryFileOrganizerPage={onSubmit:function(){var form=this;ApiClient.getNamedConfiguration('autoorganize').done(function(config){var tvOptions=config.TvOptions;tvOptions.IsEnabled=$('#chkEnableTvSorting',form).checked();tvOptions.OverwriteExistingEpisodes=$('#chkOverwriteExistingEpisodes',form).checked();tvOptions.DeleteEmptyFolders=$('#chkDeleteEmptyFolders',form).checked();tvOptions.MinFileSizeMb=$('#txtMinFileSize',form).val();tvOptions.SeasonFolderPattern=$('#txtSeasonFolderPattern',form).val();tvOptions.SeasonZeroFolderName=$('#txtSeasonZeroName',form).val();tvOptions.EpisodeNamePattern=$('#txtEpisodePattern',form).val();tvOptions.MultiEpisodeNamePattern=$('#txtMultiEpisodePattern',form).val();tvOptions.LeftOverFileExtensionsToDelete=$('#txtDeleteLeftOverFiles',form).val().split(';');var watchLocation=$('#txtWatchFolder',form).val();tvOptions.WatchLocations=watchLocation?[watchLocation]:[];tvOptions.CopyOriginalFile=$('#copyOrMoveFile',form).val();ApiClient.updateNamedConfiguration('autoorganize',config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);(function($,document,window){var query={StartIndex:0,Limit:20};var currentResult;function showStatusMessage(id){var item=currentResult.Items.filter(function(i){return i.Id==id;})[0];Dashboard.alert({title:getStatusText(item,false),message:item.StatusMessage});}
function deleteOriginalFile(page,id){var item=currentResult.Items.filter(function(i){return i.Id==id;})[0];var message=Globalize.translate('MessageFileWillBeDeleted')+'<p style="word-wrap:break-word;">'+item.OriginalPath+'</p><p>'+Globalize.translate('MessageSureYouWishToProceed')+'</p>';Dashboard.confirm(message,Globalize.translate('HeaderDeleteFile'),function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.deleteOriginalFileFromOrganizationResult(id).done(function(){Dashboard.hideLoadingMsg();reloadItems(page);});}});}
function organizeEpsiodeWithCorrections(page,item){Dashboard.showLoadingMsg();ApiClient.getItems(null,{recursive:true,includeItemTypes:'Series',sortBy:'SortName'}).done(function(result){Dashboard.hideLoadingMsg();showEpisodeCorrectionPopup(page,item,result.Items);});}
function showEpisodeCorrectionPopup(page,item,allSeries){var popup=$('.episodeCorrectionPopup',page).popup("open");$('.inputFile',popup).html(item.OriginalFileName);$('#txtSeason',popup).val(item.ExtractedSeasonNumber);$('#txtEpisode',popup).val(item.ExtractedEpisodeNumber);$('#txtEndingEpisode',popup).val(item.ExtractedEndingEpisodeNumber);$('#hfResultId',popup).val(item.Id);var seriesHtml=allSeries.map(function(s){return'<option value="'+s.Id+'">'+s.Name+'</option>';}).join('');seriesHtml='<option value=""></option>'+seriesHtml;$('#selectSeries',popup).html(seriesHtml).selectmenu('refresh');}
function organizeFile(page,id){var item=currentResult.Items.filter(function(i){return i.Id==id;})[0];if(!item.TargetPath){if(item.Type=="Episode"){organizeEpsiodeWithCorrections(page,item);}
return;}
var message=Globalize.translate('MessageFollowingFileWillBeMovedFrom')+'<p style="word-wrap:break-word;">'+item.OriginalPath+'</p><p>'+Globalize.translate('MessageDestinationTo')+'</p><p style="word-wrap:break-word;">'+item.TargetPath+'</p>';if(item.DuplicatePaths.length){message+='<p><b>'+Globalize.translate('MessageDuplicatesWillBeDeleted')+'</b></p>';message+='<p style="word-wrap:break-word;">'+item.DuplicatePaths.join('<br/>')+'</p>';}
message+='<p>'+Globalize.translate('MessageSureYouWishToProceed')+'</p>';Dashboard.confirm(message,Globalize.translate('HeaderOrganizeFile'),function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.performOrganization(id).done(function(){Dashboard.hideLoadingMsg();reloadItems(page);});}});}
function submitEpisodeForm(form){Dashboard.showLoadingMsg();var page=$(form).parents('.page');var resultId=$('#hfResultId',form).val();var options={SeriesId:$('#selectSeries',form).val(),SeasonNumber:$('#txtSeason',form).val(),EpisodeNumber:$('#txtEpisode',form).val(),EndingEpisodeNumber:$('#txtEndingEpisode',form).val()};ApiClient.performEpisodeOrganization(resultId,options).done(function(){Dashboard.hideLoadingMsg();$('.episodeCorrectionPopup',page).popup("close");reloadItems(page);});}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getFileOrganizationResults(query).done(function(result){currentResult=result;renderResults(page,result);Dashboard.hideLoadingMsg();});}
function getStatusText(item,enhance){var status=item.Status;var color=null;if(status=='SkippedExisting'){status=Globalize.translate('StatusSkipped');}
else if(status=='Failure'){color='#cc0000';status=Globalize.translate('StatusFailed');}
if(status=='Success'){color='green';status=Globalize.translate('StatusSuccess');}
if(enhance&&enhance){if(item.StatusMessage){return'<a style="color:'+color+';" data-resultid="'+item.Id+'" href="#" class="btnShowStatusMessage">'+status+'</a>';}else{return'<span data-resultid="'+item.Id+'" style="color:'+color+';">'+status+'</span>';}}
return status;}
function renderResults(page,result){var rows=result.Items.map(function(item){var html='';html+='<tr>';html+='<td class="organizerButtonCell">';if(item.Status!='Success'){html+='<button data-resultid="'+item.Id+'" type="button" data-inline="true" data-icon="delete" data-mini="true" data-iconpos="notext" class="btnDeleteResult organizerButton" title="'+Globalize.translate('ButtonDeleteFile')+'">'+Globalize.translate('ButtonDeleteFile')+'</button>';html+='<button data-resultid="'+item.Id+'" type="button" data-inline="true" data-icon="action" data-mini="true" data-iconpos="notext" class="btnProcessResult organizerButton" title="'+Globalize.translate('ButtonOrganizeFile')+'">'+Globalize.translate('ButtonOrganizeFile')+'</button>';}
html+='</td>';html+='<td>';var date=parseISO8601Date(item.Date,{toLocal:true});html+=date.toLocaleDateString();html+='</td>';html+='<td>';var status=item.Status;if(status=='SkippedExisting'){html+='<div style="color:blue;">';html+=item.OriginalFileName;html+='</div>';}
else if(status=='Failure'){html+='<a data-resultid="'+item.Id+'" style="color:red;" href="#" class="btnShowStatusMessage">';html+=item.OriginalFileName;html+='</a>';}else{html+='<div style="color:green;">';html+=item.OriginalFileName;html+='</div>';}
html+='</td>';html+='<td>';html+=item.TargetPath||'';html+='</td>';html+='</tr>';return html;}).join('');var elem=$('.resultBody',page).html(rows).parents('.tblOrganizationResults').table("refresh").trigger('create');$('.btnShowStatusMessage',elem).on('click',function(){var id=this.getAttribute('data-resultid');showStatusMessage(id);});$('.btnProcessResult',elem).on('click',function(){var id=this.getAttribute('data-resultid');organizeFile(page,id);});$('.btnDeleteResult',elem).on('click',function(){var id=this.getAttribute('data-resultid');deleteOriginalFile(page,id);});var pagingHtml=LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,false,[],false);$('.listTopPaging',page).html(pagingHtml).trigger('create');if(result.TotalRecordCount>query.Limit&&result.TotalRecordCount>50){$('.listBottomPaging',page).html(pagingHtml).trigger('create');}else{$('.listBottomPaging',page).empty();}
$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});if(result.TotalRecordCount){$('.btnClearLog',page).show();}else{$('.btnClearLog',page).hide();}}
function onWebSocketMessage(e,msg){var page=$.mobile.activePage;if(msg.MessageType=="ScheduledTaskEnded"){var result=msg.Data;if(result.Key=='AutoOrganize'){reloadItems(page);}}}
$(document).on('pageinit',"#libraryFileOrganizerLogPage",function(){var page=this;$('.btnClearLog',page).on('click',function(){ApiClient.clearOrganizationLog().done(function(){reloadItems(page);});});}).on('pageshow',"#libraryFileOrganizerLogPage",function(){var page=this;reloadItems(page);$('.btnOrganize',page).taskButton({mode:'on',progressElem:$('.organizeProgress',page),panel:$('.organizeTaskPanel',page),taskKey:'AutoOrganize'});$(ApiClient).on("websocketmessage.autoorganizelog",onWebSocketMessage);}).on('pagehide',"#libraryFileOrganizerLogPage",function(){var page=this;currentResult=null;$('.btnOrganize',page).taskButton({mode:'off'});$(ApiClient).off(".autoorganizelog");});window.OrganizerLogPage={onEpisodeCorrectionFormSubmit:function(){submitEpisodeForm(this);return false;}};})(jQuery,document,window);(function($,document){var query={StartIndex:0};function reloadItems(page){Dashboard.showLoadingMsg();query.UserId=Dashboard.getCurrentUserId();ApiClient.getJSON(ApiClient.getUrl("Channels",query)).done(function(result){$(document).scrollTop(0);var html='';updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",context:'channels',showTitle:true,centerText:true,preferThumb:true});$('#items',page).html(html).lazyChildren();LibraryBrowser.saveQueryValues('channels',query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){}
$(document).on('pagebeforeshow',"#channelsPage",function(){LibraryBrowser.loadSavedQueryValues('channels',query);reloadItems(this);}).on('pageshow',"#channelsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function reloadItems(page){Sections.loadLatestChannelItems($(".items",page),Dashboard.getCurrentUserId());}
$(document).on('pagebeforeshow',"#channelsLatestPage",function(){reloadItems(this);});})(jQuery,document);(function($,document){var maxPageSize;var query={SortBy:"",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SyncInfo",StartIndex:0};function getPageSizes(){var sizes=[];if(!maxPageSize||maxPageSize>=10)sizes.push(10);if(!maxPageSize||maxPageSize>=20)sizes.push(20);if(!maxPageSize||maxPageSize>=30)sizes.push(30);if(!maxPageSize||maxPageSize>=40)sizes.push(40);if(!maxPageSize||maxPageSize>=50)sizes.push(50);if(!maxPageSize||maxPageSize>=100)sizes.push(100);return sizes;}
function getSavedQueryId(){return'channels-1-'+getParameterByName('id')+(getParameterByName('folderId')||'');}
function showLoadingMessage(page){$('#popupDialog',page).popup('open');}
function hideLoadingMessage(page){$('#popupDialog',page).popup('close');}
function reloadFeatures(page){var channelId=getParameterByName('id');ApiClient.getJSON(ApiClient.getUrl("Channels/"+channelId+"/Features",query)).done(function(features){if(features.CanFilter){$('.filterControls',page).show();}else{$('.filterControls',page).hide();}
if(features.SupportsSortOrderToggle){$('.sortOrderToggle',page).show();}else{$('.sortOrderToggle',page).hide();}
maxPageSize=features.MaxPageSize;if(maxPageSize){query.Limit=Math.min(maxPageSize,query.Limit||maxPageSize);}
updateSortOrders(page,features.DefaultSortFields);reloadItems(page);});}
function updateSortOrders(page,fields){updateSortOrder(page,fields,'Name');updateSortOrder(page,fields,'CommunityRating');updateSortOrder(page,fields,'PremiereDate');updateSortOrder(page,fields,'PlayCount');updateSortOrder(page,fields,'Runtime');updateSortOrder(page,fields,'DateCreated');}
function updateSortOrder(page,fields,name){var cssClass="sortby"+name;if(fields.indexOf(name)==-1){$('.'+cssClass,page).hide();}else{$('.'+cssClass,page).show();}}
function reloadItems(page){showLoadingMessage(page);var channelId=getParameterByName('id');var folderId=getParameterByName('folderId');query.UserId=Dashboard.getCurrentUserId();if(folderId){ApiClient.getItem(query.UserId,folderId).done(function(item){$('.categoryTitle',page).show().html(item.Name);$('.channelHeader',page).show().html('<a href="channelitems.html?id='+item.ChannelId+'">'+item.ChannelName+'</a>').trigger('create');});}else{ApiClient.getItem(query.UserId,channelId).done(function(item){$('.categoryTitle',page).hide().html(item.Name);$('.channelHeader',page).show().html('<a href="channelitems.html?id='+item.Id+'">'+item.Name+'</a>');});}
query.folderId=folderId;ApiClient.getJSON(ApiClient.getUrl("Channels/"+channelId+"/Items",query)).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,updatePageSizeSetting:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",defaultShape:'square',context:'channels',showTitle:true,centerText:true,coverImage:true});var elem=$('#items',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryId(),query);}).always(function(){hideLoadingMessage(page);});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWith);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#channelItemsPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#channelItemsPage",function(){}).on('pageshow',"#channelItemsPage",function(){var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;}
query.StartIndex=0;LibraryBrowser.loadSavedQueryValues(getSavedQueryId(),query);reloadFeatures(page);updateFilterControls(page);});})(jQuery,document);(function($,document,window){function populateDownloadList(page,config,downloadableList){if(downloadableList.length){$('.channelDownloading',page).show();}else{$('.channelDownloading',page).hide();}
var html='';html+='<div data-role="controlgroup">';for(var i=0,length=downloadableList.length;i<length;i++){var channel=downloadableList[i];var id='chkChannelDownload'+i;var isChecked=config.DownloadingChannels.indexOf(channel.Id)!=-1?' checked="checked"':'';html+='<input class="chkChannelDownload" type="checkbox" name="'+id+'" id="'+id+'" data-channelid="'+channel.Id+'"'+isChecked+'>';html+='<label for="'+id+'">'+channel.Name+'</label>';}
html+='</div>';$('.channelDownloadingList',page).html(html).trigger('create');}
function loadPage(page,config,allChannelFeatures){if(allChannelFeatures.length){$('.noChannelsHeader',page).hide();}else{$('.noChannelsHeader',page).show();}
var downloadableList=allChannelFeatures.filter(function(i){return i.SupportsContentDownloading;});populateDownloadList(page,config,downloadableList);$('#selectChannelResolution',page).val(config.PreferredStreamingWidth||'').selectmenu("refresh");$('#txtDownloadAge',page).val(config.MaxDownloadAge||'');$('#txtDownloadSizeLimit',page).val(config.DownloadSizeLimit||'');$('#txtCachePath',page).val(config.DownloadPath||'');Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#channelSettingsPage",function(){var page=this;$('#btnSelectCachePath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtCachePath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectChannelDownloadPath'),instruction:Globalize.translate('HeaderSelectChannelDownloadPathHelp')});});}).on('pageshow',"#channelSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getNamedConfiguration("channels");var promise2=ApiClient.getJSON(ApiClient.getUrl("Channels/Features"));$.when(promise1,promise2).done(function(response1,response2){var config=response1[0];var allFeatures=response2[0];loadPage(page,config,allFeatures);});});function onSubmit(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("channels").done(function(config){config.PreferredStreamingWidth=$('#selectChannelResolution',form).val()||null;config.MaxDownloadAge=$('#txtDownloadAge',form).val()||null;config.DownloadSizeLimit=$('#txtDownloadSizeLimit',form).val()||null;config.DownloadPath=$('#txtCachePath',form).val()||null;config.DownloadingChannels=$('.chkChannelDownload:checked',form).get().map(function(i){return i.getAttribute('data-channelid');});ApiClient.updateNamedConfiguration("channels",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}
window.ChannelSettingsPage={onSubmit:onSubmit};})(jQuery,document,window);(function(){function onLoggedIn(){Dashboard.navigate('selectserver.html');}
function login(page,username,password){Dashboard.showLoadingMsg();ConnectionManager.loginToConnect(username,password).done(function(){onLoggedIn();}).fail(function(){Dashboard.hideLoadingMsg();Dashboard.alert({message:Globalize.translate('MessageInvalidUser'),title:Globalize.translate('HeaderLoginFailure')});$('#txtManualPassword',page).val('');});}
function submit(page){var user=$('#txtManualName',page).val();var password=$('#txtManualPassword',page).val();login(page,user,password);}
window.ConnectLoginPage={onSubmit:function(){var page=$(this).parents('.page');submit(page);return false;}};})();(function($,document,window){var brandingConfigKey="branding";var currentBrandingOptions;var currentLanguage;function loadPage(page,config,languageOptions){if(Dashboard.lastSystemInfo){Dashboard.setPageTitle(Dashboard.lastSystemInfo.ServerName);}
refreshPageTitle(page);$('#txtServerName',page).val(config.ServerName||'');$('#selectLocalizationLanguage',page).html(languageOptions.map(function(l){return'<option value="'+l.Value+'">'+l.Name+'</option>';})).val(config.UICulture).selectmenu('refresh');currentLanguage=config.UICulture;$('#txtCachePath',page).val(config.CachePath||'');Dashboard.hideLoadingMsg();}
function refreshPageTitle(page){ApiClient.getSystemInfo().done(function(systemInfo){Dashboard.setPageTitle(systemInfo.ServerName);});}
$(document).on('pageshow',"#dashboardGeneralPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getServerConfiguration();var promise2=ApiClient.getJSON(ApiClient.getUrl("Localization/Options"));$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});ApiClient.getNamedConfiguration(brandingConfigKey).done(function(config){currentBrandingOptions=config;$('#txtLoginDisclaimer',page).val(config.LoginDisclaimer||'');$('#txtCustomCss',page).val(config.CustomCss||'');});}).on('pageinit',"#dashboardGeneralPage",function(){var page=this;$('#btnSelectCachePath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtCachePath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectServerCachePath'),instruction:Globalize.translate('HeaderSelectServerCachePathHelp')});});});window.DashboardGeneralPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;var page=$(form).parents('.page');ApiClient.getServerConfiguration().done(function(config){config.ServerName=$('#txtServerName',form).val();config.UICulture=$('#selectLocalizationLanguage',form).val();config.CachePath=$('#txtCachePath',form).val();if(config.UICulture!=currentLanguage){Dashboard.showDashboardRefreshNotification();}
ApiClient.updateServerConfiguration(config).done(function(){refreshPageTitle(page);ApiClient.getNamedConfiguration(brandingConfigKey).done(function(brandingConfig){brandingConfig.LoginDisclaimer=$('#txtLoginDisclaimer',form).val();brandingConfig.CustomCss=$('#txtCustomCss',form).val();var cssChanged=currentBrandingOptions&&brandingConfig.CustomCss!=currentBrandingOptions.CustomCss;ApiClient.updateNamedConfiguration(brandingConfigKey,brandingConfig).done(Dashboard.processServerConfigurationUpdateResult);if(cssChanged){Dashboard.showDashboardRefreshNotification();}});});});return false;}};})(jQuery,document,window);(function($,document,window){function loadPage(page,config){$('#txtPortNumber',page).val(config.HttpServerPortNumber);$('#txtPublicPort',page).val(config.PublicPort);$('#txtPublicHttpsPort',page).val(config.PublicHttpsPort);$('#chkEnableHttps',page).checked(config.EnableHttps).checkboxradio('refresh');$('#txtHttpsPort',page).val(config.HttpsPortNumber);$('#txtDdns',page).val(config.WanDdns||'');$('#txtCertificatePath',page).val(config.CertificatePath||'');$('#chkEnableUpnp',page).checked(config.EnableUPnP).checkboxradio('refresh');Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#dashboardHostingPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});}).on('pageinit',"#dashboardHostingPage",function(){var page=this;$('#btnSelectCertPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({includeFiles:true,includeDirectories:true,callback:function(path){if(path){$('#txtCertificatePath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectCertificatePath')});});});window.DashboardHostingPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getServerConfiguration().done(function(config){config.HttpServerPortNumber=$('#txtPortNumber',form).val();config.PublicPort=$('#txtPublicPort',form).val();config.PublicHttpsPort=$('#txtPublicHttpsPort',form).val();config.EnableHttps=$('#chkEnableHttps',form).checked();config.HttpsPortNumber=$('#txtHttpsPort',form).val();config.EnableUPnP=$('#chkEnableUpnp',form).checked();config.WanDdns=$('#txtDdns',form).val();config.CertificatePath=$('#txtCertificatePath',form).val();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);var DashboardPage={newsStartIndex:0,onPageShow:function(){var page=this;if(Dashboard.lastSystemInfo){Dashboard.setPageTitle(Dashboard.lastSystemInfo.ServerName);}
DashboardPage.newsStartIndex=0;Dashboard.showLoadingMsg();DashboardPage.pollForInfo(page);DashboardPage.startInterval();$(ApiClient).on("websocketmessage",DashboardPage.onWebSocketMessage).on("websocketopen",DashboardPage.onWebSocketOpen);DashboardPage.lastAppUpdateCheck=null;DashboardPage.lastPluginUpdateCheck=null;Dashboard.getPluginSecurityInfo().done(function(pluginSecurityInfo){DashboardPage.renderSupporterIcon(page,pluginSecurityInfo);});DashboardPage.reloadSystemInfo(page);DashboardPage.reloadNews(page);DashboardPage.sessionUpdateTimer=setInterval(DashboardPage.refreshSessionsLocally,60000);$('.activityItems',page).activityLogList();$('.swaggerLink',page).attr('href',ApiClient.getUrl('swagger-ui/index.html'));},onPageHide:function(){var page=this;$('.activityItems',page).activityLogList('destroy');$(ApiClient).off("websocketmessage",DashboardPage.onWebSocketMessage).off("websocketopen",DashboardPage.onWebSocketConnectionChange).off("websocketerror",DashboardPage.onWebSocketConnectionChange).off("websocketclose",DashboardPage.onWebSocketConnectionChange);DashboardPage.stopInterval();if(DashboardPage.sessionUpdateTimer){clearInterval(DashboardPage.sessionUpdateTimer);}},renderPaths:function(page,systemInfo){$('#cachePath',page).html(systemInfo.CachePath);$('#logPath',page).html(systemInfo.LogPath);$('#transcodingTemporaryPath',page).html(systemInfo.TranscodingTempPath);$('#metadataPath',page).html(systemInfo.InternalMetadataPath);},refreshSessionsLocally:function(){var list=DashboardPage.sessionsList;if(list){console.log('refreshSessionsLocally');DashboardPage.renderActiveConnections($.mobile.activePage,list);}},reloadSystemInfo:function(page){ApiClient.getSystemInfo().done(function(systemInfo){Dashboard.setPageTitle(systemInfo.ServerName);Dashboard.updateSystemInfo(systemInfo);$('#appVersionNumber',page).html(Globalize.translate('LabelVersionNumber').replace('{0}',systemInfo.Version));if(systemInfo.SupportsHttps){$('#ports',page).html(Globalize.translate('LabelRunningOnPorts','<b>'+systemInfo.HttpServerPortNumber+'</b>','<b>'+systemInfo.HttpsPortNumber+'</b>'));}else{$('#ports',page).html(Globalize.translate('LabelRunningOnPort','<b>'+systemInfo.HttpServerPortNumber+'</b>'));}
if(systemInfo.CanSelfRestart){$('.btnRestartContainer',page).removeClass('hide');}else{$('.btnRestartContainer',page).addClass('hide');}
DashboardPage.renderUrls(page,systemInfo);DashboardPage.renderPendingInstallations(page,systemInfo);if(systemInfo.CanSelfUpdate){$('#btnUpdateApplicationContainer',page).show();$('#btnManualUpdateContainer',page).hide();}else{$('#btnUpdateApplicationContainer',page).hide();$('#btnManualUpdateContainer',page).show();}
DashboardPage.renderPaths(page,systemInfo);DashboardPage.renderHasPendingRestart(page,systemInfo.HasPendingRestart);});},reloadNews:function(page){var query={StartIndex:DashboardPage.newsStartIndex,Limit:5};ApiClient.getProductNews(query).done(function(result){var html=result.Items.map(function(item){var itemHtml='';itemHtml+='<div class="newsItem">';itemHtml+='<a class="newsItemHeader" href="'+item.Link+'" target="_blank">'+item.Title+'</a>';var date=parseISO8601Date(item.Date,{toLocal:true});itemHtml+='<div class="newsItemDate">'+date.toLocaleDateString()+'</div>';itemHtml+='<div class="newsItemDescription">'+item.Description+'</div>';itemHtml+='</div>';return itemHtml;});var pagingHtml='';pagingHtml+='<div>';pagingHtml+=LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,false,[],false);pagingHtml+='</div>';html=html.join('')+pagingHtml;var elem=$('.latestNewsItems',page).html(html).trigger('create');$('.btnNextPage',elem).on('click',function(){DashboardPage.newsStartIndex+=query.Limit;DashboardPage.reloadNews(page);});$('.btnPreviousPage',elem).on('click',function(){DashboardPage.newsStartIndex-=query.Limit;DashboardPage.reloadNews(page);});});},startInterval:function(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStart","0,1500");ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","0,1000");}},stopInterval:function(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStop");ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop");}},onWebSocketMessage:function(e,msg){var page=$.mobile.activePage;if(msg.MessageType=="Sessions"){DashboardPage.renderInfo(page,msg.Data);}
else if(msg.MessageType=="RestartRequired"){DashboardPage.renderHasPendingRestart(page,true);}
else if(msg.MessageType=="ServerShuttingDown"){DashboardPage.renderHasPendingRestart(page,true);}
else if(msg.MessageType=="ServerRestarting"){DashboardPage.renderHasPendingRestart(page,true);}
else if(msg.MessageType=="ScheduledTasksInfo"){var tasks=msg.Data;DashboardPage.renderRunningTasks(page,tasks);}
else if(msg.MessageType=="PackageInstalling"||msg.MessageType=="PackageInstallationCompleted"){DashboardPage.pollForInfo(page,true);DashboardPage.reloadSystemInfo(page);}},onWebSocketOpen:function(){DashboardPage.startInterval();},pollForInfo:function(page,forceUpdate){ApiClient.getSessions().done(function(sessions){DashboardPage.renderInfo(page,sessions,forceUpdate);});ApiClient.getScheduledTasks().done(function(tasks){DashboardPage.renderRunningTasks(page,tasks);});},renderInfo:function(page,sessions,forceUpdate){DashboardPage.renderActiveConnections(page,sessions);DashboardPage.renderPluginUpdateInfo(page,forceUpdate);Dashboard.hideLoadingMsg();},renderActiveConnections:function(page,sessions){var html='';DashboardPage.sessionsList=sessions;var parentElement=$('.activeDevices',page);$('.card',parentElement).addClass('deadSession');for(var i=0,length=sessions.length;i<length;i++){var session=sessions[i];var rowId='session'+session.Id;var elem=$('#'+rowId,page);if(elem.length){DashboardPage.updateSession(elem,session);continue;}
var nowPlayingItem=session.NowPlayingItem;var className=nowPlayingItem?'card activeSession':'card activeSession';if(session.TranscodingInfo&&session.TranscodingInfo.CompletionPercentage){className+=' transcodingSession';}
html+='<div class="'+className+'" id="'+rowId+'">';html+='<div class="cardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';html+='<div class="cardContent">';html+='<div class="sessionNowPlayingContent"';var imgUrl=DashboardPage.getNowPlayingImageUrl(nowPlayingItem);if(imgUrl){html+=' data-src="'+imgUrl+'" style="display:inline-block;background-image:url(\''+imgUrl+'\');"';}
html+='></div>';html+='<div class="sessionNowPlayingInnerContent">';html+='<div class="sessionAppInfo">';var clientImage=DashboardPage.getClientImage(session);if(clientImage){html+=clientImage;}
html+='<div class="sessionAppName" style="display:inline-block;">';html+='<div class="sessionDeviceName">'+session.DeviceName+'</div>';html+='<div class="sessionAppSecondaryText">'+DashboardPage.getAppSecondaryText(session)+'</div>';html+='</div>';html+='</div>';html+='<div class="sessionUserInfo">';var userImage=DashboardPage.getUserImage(session);if(userImage){html+='<div class="sessionUserImage" data-src="'+userImage+'">';html+='<img src="'+userImage+'" />';}else{html+='<div class="sessionUserImage">';}
html+='</div>';html+='<div class="sessionUserName">';html+=DashboardPage.getUsersHtml(session);html+='</div>';html+='</div>';var nowPlayingName=DashboardPage.getNowPlayingName(session);html+='<div class="sessionNowPlayingInfo" data-imgsrc="'+nowPlayingName.image+'">';html+=nowPlayingName.html;html+='</div>';if(nowPlayingItem&&nowPlayingItem.RunTimeTicks){var position=session.PlayState.PositionTicks||0;var value=(100*position)/nowPlayingItem.RunTimeTicks;html+='<progress class="itemProgressBar playbackProgress" min="0" max="100" value="'+value+'"></progress>';}else{html+='<progress class="itemProgressBar playbackProgress" min="0" max="100" style="display:none;"></progress>';}
if(session.TranscodingInfo&&session.TranscodingInfo.CompletionPercentage){html+='<progress class="itemProgressBar transcodingProgress" min="0" max="100" value="'+session.TranscodingInfo.CompletionPercentage.toFixed(1)+'"></progress>';}else{html+='<progress class="itemProgressBar transcodingProgress" min="0" max="100" style="display:none;"></progress>';}
html+='</div>';html+='<div class="cardOverlayTarget">';html+='<div class="sessionNowPlayingStreamInfo">'+DashboardPage.getSessionNowPlayingStreamInfo(session)+'</div>';html+='<div class="sessionNowPlayingTime">'+DashboardPage.getSessionNowPlayingTime(session)+'</div>';if(session.TranscodingInfo&&session.TranscodingInfo.Framerate){html+='<div class="sessionTranscodingFramerate">'+session.TranscodingInfo.Framerate+' fps</div>';}else{html+='<div class="sessionTranscodingFramerate"></div>';}
html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';}
parentElement.append(html).createSessionItemMenus().trigger('create');$('.deadSession',parentElement).remove();},getSessionNowPlayingStreamInfo:function(session){var html='';html+='<div>';if(session.TranscodingInfo&&session.TranscodingInfo.IsAudioDirect&&session.TranscodingInfo.IsVideoDirect){html+=Globalize.translate('LabelPlayMethodDirectStream');}
else if(session.PlayState.PlayMethod=='Transcode'){html+=Globalize.translate('LabelPlayMethodTranscoding');}
else if(session.PlayState.PlayMethod=='DirectStream'){html+=Globalize.translate('LabelPlayMethodDirectStream');}
else if(session.PlayState.PlayMethod=='DirectPlay'){html+=Globalize.translate('LabelPlayMethodDirectPlay');}
html+='</div>';if(session.TranscodingInfo){html+='<br/>';var line=[];if(session.TranscodingInfo.Container){line.push(session.TranscodingInfo.Container);}
if(session.TranscodingInfo.Bitrate){if(session.TranscodingInfo.Bitrate>1000000){line.push((session.TranscodingInfo.Bitrate/1000000).toFixed(1)+' Mbps');}else{line.push(Math.floor(session.TranscodingInfo.Bitrate/1000)+' kbps');}}
if(line.length){html+='<div>'+line.join(' ')+'</div>';}
if(session.TranscodingInfo.VideoCodec){html+='<div>'+Globalize.translate('LabelVideoCodec').replace('{0}',session.TranscodingInfo.VideoCodec)+'</div>';}
if(session.TranscodingInfo.AudioCodec&&session.TranscodingInfo.AudioCodec!=session.TranscodingInfo.Container){html+='<div>'+Globalize.translate('LabelAudioCodec').replace('{0}',session.TranscodingInfo.AudioCodec)+'</div>';}}
return html;},getSessionNowPlayingTime:function(session){var html='';if(session.PlayState.PositionTicks){html+=Dashboard.getDisplayTime(session.PlayState.PositionTicks);}else{html+='--:--:--';}
html+=' / ';var nowPlayingItem=session.NowPlayingItem;if(nowPlayingItem&&nowPlayingItem.RunTimeTicks){html+=Dashboard.getDisplayTime(nowPlayingItem.RunTimeTicks);}else{html+='--:--:--';}
return html;},getAppSecondaryText:function(session){return session.ApplicationVersion;},getNowPlayingName:function(session){var imgUrl='';var nowPlayingItem=session.NowPlayingItem;if(!nowPlayingItem){return{html:'Last seen '+humane_date(session.LastActivityDate),image:imgUrl};}
var topText=nowPlayingItem.Name;var bottomText='';if(nowPlayingItem.Artists&&nowPlayingItem.Artists.length){bottomText=topText;topText=nowPlayingItem.Artists[0];}
else if(nowPlayingItem.SeriesName||nowPlayingItem.Album){bottomText=topText;topText=nowPlayingItem.SeriesName||nowPlayingItem.Album;}
else if(nowPlayingItem.ProductionYear){bottomText=nowPlayingItem.ProductionYear;}
if(nowPlayingItem.LogoItemId){imgUrl=ApiClient.getScaledImageUrl(nowPlayingItem.LogoItemId,{tag:session.LogoImageTag,maxHeight:24,maxWidth:130,type:'Logo'});topText='<img src="'+imgUrl+'" style="max-height:24px;max-width:130px;" />';}
var text=bottomText?topText+'<br/>'+bottomText:topText;return{html:text,image:imgUrl};},getUsersHtml:function(session){var html=[];if(session.UserId){html.push(session.UserName);}
for(var i=0,length=session.AdditionalUsers.length;i<length;i++){html.push(session.AdditionalUsers[i].UserName);}
return html.join(', ');},getUserImage:function(session){if(session.UserId&&session.UserPrimaryImageTag){return ApiClient.getUserImageUrl(session.UserId,{tag:session.UserPrimaryImageTag,height:24,type:'Primary'});}
return null;},updateSession:function(row,session){row.removeClass('deadSession');var nowPlayingItem=session.NowPlayingItem;if(nowPlayingItem){row.addClass('playingSession');}else{row.removeClass('playingSession');}
$('.sessionNowPlayingStreamInfo',row).html(DashboardPage.getSessionNowPlayingStreamInfo(session));$('.sessionNowPlayingTime',row).html(DashboardPage.getSessionNowPlayingTime(session));$('.sessionUserName',row).html(DashboardPage.getUsersHtml(session));$('.sessionAppSecondaryText',row).html(DashboardPage.getAppSecondaryText(session));$('.sessionTranscodingFramerate',row).html((session.TranscodingInfo&&session.TranscodingInfo.Framerate)?session.TranscodingInfo.Framerate+' fps':'');var nowPlayingName=DashboardPage.getNowPlayingName(session);var nowPlayingInfoElem=$('.sessionNowPlayingInfo',row);if(!nowPlayingName.image||nowPlayingName.image!=nowPlayingInfoElem.attr('data-imgsrc')){nowPlayingInfoElem.html(nowPlayingName.html);nowPlayingInfoElem.attr('data-imgsrc',nowPlayingName.image||'');}
if(nowPlayingItem&&nowPlayingItem.RunTimeTicks){var position=session.PlayState.PositionTicks||0;var value=(100*position)/nowPlayingItem.RunTimeTicks;$('.playbackProgress',row).show().val(value);}else{$('.playbackProgress',row).hide();}
if(session.TranscodingInfo&&session.TranscodingInfo.CompletionPercentage){row.addClass('transcodingSession');$('.transcodingProgress',row).show().val(session.TranscodingInfo.CompletionPercentage);}else{$('.transcodingProgress',row).hide();row.removeClass('transcodingSession');}
var imgUrl=DashboardPage.getNowPlayingImageUrl(nowPlayingItem)||'';var imgElem=$('.sessionNowPlayingContent',row)[0];if(imgUrl!=imgElem.getAttribute('data-src')){imgElem.style.backgroundImage=imgUrl?'url(\''+imgUrl+'\')':'';imgElem.setAttribute('data-src',imgUrl);}},getClientImage:function(connection){var clientLowered=connection.Client.toLowerCase();if(clientLowered=="dashboard"||clientLowered=="emby web client"){var device=connection.DeviceName.toLowerCase();var imgUrl;if(device.indexOf('chrome')!=-1){imgUrl='css/images/clients/chrome.png';}
else if(device.indexOf('firefox')!=-1){imgUrl='css/images/clients/firefox.png';}
else if(device.indexOf('internet explorer')!=-1){imgUrl='css/images/clients/ie.png';}
else if(device.indexOf('safari')!=-1){imgUrl='css/images/clients/safari.png';}
else{imgUrl='css/images/clients/html5.png';}
return"<img src='"+imgUrl+"' alt='Emby Web Client' />";}
if(clientLowered=="mb-classic"){return"<img src='css/images/clients/mbc.png' />";}
if(clientLowered=="emby theater"){return"<img src='css/images/clients/mb.png' />";}
if(clientLowered=="android"||clientLowered=="androidtv"){return"<img src='css/images/clients/android.png' />";}
if(clientLowered=="nuvue"){return"<img src='css/images/clients/nuvue.png' />";}
if(clientLowered=="roku"){return"<img src='css/images/clients/roku.jpg' />";}
if(clientLowered=="ios"){return"<img src='css/images/clients/ios.png' />";}
if(clientLowered=="windows rt"){return"<img src='css/images/clients/windowsrt.png' />";}
if(clientLowered=="windows phone"){return"<img src='css/images/clients/windowsphone.png' />";}
if(clientLowered=="dlna"){return"<img src='css/images/clients/dlna.png' />";}
if(clientLowered=="mbkinect"){return"<img src='css/images/clients/mbkinect.png' />";}
if(clientLowered=="kodi"||clientLowered=="xbmc"){return"<img src='css/images/clients/kodi.png' />";}
if(clientLowered=="chromecast"){return"<img src='css/images/chromecast/ic_media_route_on_holo_light.png' />";}
if(clientLowered=="chrome companion"){return"<img src='css/images/clients/chrome_companion.png' />";}
return null;},getNowPlayingImageUrl:function(item){if(item&&item.BackdropImageTag){return ApiClient.getScaledImageUrl(item.BackdropItemId,{type:"Backdrop",width:275,tag:item.BackdropImageTag});}
if(item&&item.ThumbImageTag){return ApiClient.getScaledImageUrl(item.ThumbItemId,{type:"Thumb",width:275,tag:item.ThumbImageTag});}
if(item&&item.PrimaryImageTag){return ApiClient.getScaledImageUrl(item.PrimaryImageItemId,{type:"Primary",width:275,tag:item.PrimaryImageTag});}
return null;},systemUpdateTaskKey:"SystemUpdateTask",renderRunningTasks:function(page,tasks){var html='';tasks=tasks.filter(function(t){return t.State!='Idle';});if(tasks.filter(function(t){return t.Key==DashboardPage.systemUpdateTaskKey;}).length){$('#btnUpdateApplication',page).buttonEnabled(false);}else{$('#btnUpdateApplication',page).buttonEnabled(true);}
if(!tasks.length){$('#runningTasksCollapsible',page).hide();}else{$('#runningTasksCollapsible',page).show();}
for(var i=0,length=tasks.length;i<length;i++){var task=tasks[i];html+='<p>';html+=task.Name+"<br/>";if(task.State=="Running"){var progress=(task.CurrentProgressPercentage||0).toFixed(1);html+='<progress max="100" value="'+progress+'" title="'+progress+'%">';html+=''+progress+'%';html+='</progress>';html+="<span style='color:#009F00;margin-left:5px;margin-right:5px;'>"+progress+"%</span>";html+='<button type="button" data-icon="stop" data-iconpos="notext" data-inline="true" data-mini="true" onclick="DashboardPage.stopTask(\''+task.Id+'\');">'+Globalize.translate('ButtonStop')+'</button>';}
else if(task.State=="Cancelling"){html+='<span style="color:#cc0000;">'+Globalize.translate('LabelStopping')+'</span>';}
html+='</p>';}
$('#divRunningTasks',page).html(html).trigger('create');},renderUrls:function(page,systemInfo){if(systemInfo.LocalAddress){var localAccessHtml=Globalize.translate('LabelLocalAccessUrl','<a href="'+systemInfo.LocalAddress+'" target="_blank">'+systemInfo.LocalAddress+'</a>');$('.localUrl',page).html(localAccessHtml).show().trigger('create');}else{$('.externalUrl',page).hide();}
if(systemInfo.WanAddress){var externalUrl=systemInfo.WanAddress;var remoteAccessHtml=Globalize.translate('LabelRemoteAccessUrl','<a href="'+externalUrl+'" target="_blank">'+externalUrl+'</a>');$('.externalUrl',page).html(remoteAccessHtml).show().trigger('create');}else{$('.externalUrl',page).hide();}},renderSupporterIcon:function(page,pluginSecurityInfo){var imgUrl,text;if(pluginSecurityInfo.IsMBSupporter){imgUrl="css/images/supporter/supporterbadge.png";text=Globalize.translate('MessageThankYouForSupporting');$('.supporterIconContainer',page).html('<a class="imageLink supporterIcon" href="supporter.html" title="'+text+'"><img src="'+imgUrl+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /></a><span style="position:relative;top:2px;text-decoration:none;">'+text+'</span>');}else{imgUrl="css/images/supporter/nonsupporterbadge.png";text=Globalize.translate('MessagePleaseSupportProject');$('.supporterIconContainer',page).html('<a class="imageLink supporterIcon" href="supporter.html" title="'+text+'"><img src="'+imgUrl+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /><span style="position:relative;top:2px;text-decoration:none;">'+text+'</span></a>');}},renderHasPendingRestart:function(page,hasPendingRestart){if(!hasPendingRestart){if(DashboardPage.lastAppUpdateCheck&&(new Date().getTime()-DashboardPage.lastAppUpdateCheck)<1800000){return;}
DashboardPage.lastAppUpdateCheck=new Date().getTime();ApiClient.getAvailableApplicationUpdate().done(function(packageInfo){var version=packageInfo[0];if(!version){$('#pUpToDate',page).show();$('#pUpdateNow',page).hide();}else{$('#pUpToDate',page).hide();$('#pUpdateNow',page).show();$('#newVersionNumber',page).html(Globalize.translate('VersionXIsAvailableForDownload').replace('{0}',version.versionStr));}});}else{$('#pUpToDate',page).hide();$('#pUpdateNow',page).hide();}},renderPendingInstallations:function(page,systemInfo){if(systemInfo.CompletedInstallations.length){$('#collapsiblePendingInstallations',page).show();}else{$('#collapsiblePendingInstallations',page).hide();return;}
var html='';for(var i=0,length=systemInfo.CompletedInstallations.length;i<length;i++){var update=systemInfo.CompletedInstallations[i];html+='<div><strong>'+update.Name+'</strong> ('+update.Version+')</div>';}
$('#pendingInstallations',page).html(html);},renderPluginUpdateInfo:function(page,forceUpdate){if(!forceUpdate&&DashboardPage.lastPluginUpdateCheck&&(new Date().getTime()-DashboardPage.lastPluginUpdateCheck)<1800000){return;}
DashboardPage.lastPluginUpdateCheck=new Date().getTime();ApiClient.getAvailablePluginUpdates().done(function(updates){var elem=$('#pPluginUpdates',page);if(updates.length){elem.show();}else{elem.hide();return;}
var html='';for(var i=0,length=updates.length;i<length;i++){var update=updates[i];html+='<p><strong>'+Globalize.translate('NewVersionOfSomethingAvailable').replace('{0}',update.name)+'</strong></p>';html+='<button type="button" data-icon="arrow-d" data-theme="b" onclick="DashboardPage.installPluginUpdate(this);" data-name="'+update.name+'" data-guid="'+update.guid+'" data-version="'+update.versionStr+'" data-classification="'+update.classification+'">'+Globalize.translate('ButtonUpdateNow')+'</button>';}
elem.html(html).trigger('create');});},installPluginUpdate:function(button){$(button).buttonEnabled(false);var name=button.getAttribute('data-name');var guid=button.getAttribute('data-guid');var version=button.getAttribute('data-version');var classification=button.getAttribute('data-classification');Dashboard.showLoadingMsg();ApiClient.installPlugin(name,guid,classification,version).done(function(){Dashboard.hideLoadingMsg();});},updateApplication:function(){var page=$.mobile.activePage;$('#btnUpdateApplication',page).buttonEnabled(false);Dashboard.showLoadingMsg();ApiClient.getScheduledTasks().done(function(tasks){var task=tasks.filter(function(t){return t.Key==DashboardPage.systemUpdateTaskKey;})[0];ApiClient.startScheduledTask(task.Id).done(function(){DashboardPage.pollForInfo(page);Dashboard.hideLoadingMsg();});});},stopTask:function(id){var page=$.mobile.activePage;ApiClient.stopScheduledTask(id).done(function(){DashboardPage.pollForInfo(page);});},restart:function(){Dashboard.confirm(Globalize.translate('MessageConfirmRestart'),Globalize.translate('HeaderRestart'),function(result){if(result){$('#btnRestartServer').buttonEnabled(false);$('#btnShutdown').buttonEnabled(false);Dashboard.restartServer();}});},shutdown:function(){Dashboard.confirm(Globalize.translate('MessageConfirmShutdown'),Globalize.translate('HeaderShutdown'),function(result){if(result){$('#btnRestartServer').buttonEnabled(false);$('#btnShutdown').buttonEnabled(false);ApiClient.shutdownServer();}});}};$(document).on('pagebeforeshow',"#dashboardPage",DashboardPage.onPageShow).on('pagehide',"#dashboardPage",DashboardPage.onPageHide);(function($,document,window){var showOverlayTimeout;function onHoverOut(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
$('.cardOverlayTarget:visible',this).each(function(){var elem=this;$(this).animate({"height":"0"},"fast",function(){$(elem).hide();});});$('.cardOverlayTarget:visible',this).stop().animate({"height":"0"},function(){$(this).hide();});}
$.fn.createSessionItemMenus=function(){function onShowTimerExpired(elem){if($('.itemSelectionPanel:visible',elem).length){return;}
var innerElem=$('.cardOverlayTarget',elem);innerElem.show().each(function(){this.style.height=0;}).animate({"height":"100%"},"fast");}
function onHoverIn(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
var elem=this;showOverlayTimeout=setTimeout(function(){onShowTimerExpired(elem);},1000);}
if(('ontouchstart'in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0)){return this;}
return this.off('.sessionItemMenu').on('mouseenter.sessionItemMenu','.playingSession',onHoverIn).on('mouseleave.sessionItemMenu','.playingSession',onHoverOut);};})(jQuery,document,window);(function($,document,window){function getEntryHtml(entry){var html='';html+='<div class="newsItem" style="padding: .5em 0;">';html+='<div class="notificationContent" style="display:block;">';var date=parseISO8601Date(entry.Date,{toLocal:true});var color=entry.Severity=='Error'||entry.Severity=='Fatal'||entry.Severity=='Warn'?'#cc0000':'green';html+='<div style="margin: 0;color:'+color+';">';if(entry.UserId&&entry.UserPrimaryImageTag){var userImgUrl=ApiClient.getUserImageUrl(entry.UserId,{type:'Primary',tag:entry.UserPrimaryImageTag,height:20});html+='<img src="'+userImgUrl+'" style="height:20px;vertical-align:middle;margin-right:5px;" />';}
html+=date.toLocaleDateString()+' '+date.toLocaleTimeString().toLowerCase();html+='</div>';html+='<div class="notificationName" style="margin:.5em 0 0;white-space:nowrap;">';html+=entry.Name;html+='</div>';entry.ShortOverview=entry.ShortOverview||'&nbsp;';if(entry.ShortOverview){html+='<div class="newsItemDescription" style="margin: .5em 0 0;">';if(entry.Overview){html+='<a href="#" class="btnShowOverview" style="text-decoration:none;font-weight:500;">';}
html+=entry.ShortOverview;if(entry.Overview){html+='</a>';}
html+='</div>';if(entry.Overview){html+='<div class="newsItemLongDescription" style="display:none;">'+entry.Overview+'</div>';}}
html+='</div>';html+='</div>';return html;}
function renderList(elem,result,startIndex,limit){var html=result.Items.map(getEntryHtml).join('');if(result.TotalRecordCount>limit){var query={StartIndex:startIndex,Limit:limit};html+=LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,false,limit,false);}
$(elem).html(html).trigger('create');$('.btnNextPage',elem).on('click',function(){reloadData(elem,startIndex+limit,limit);});$('.btnPreviousPage',elem).on('click',function(){reloadData(elem,startIndex-limit,limit);});$('.btnShowOverview',elem).on('click',function(){var item=$(this).parents('.newsItem');var overview=$('.newsItemLongDescription',item).html();var name=$('.notificationName',item).html();Dashboard.alert({message:'<div style="max-height:300px; overflow: auto;">'+overview+'</div>',title:name});});}
function reloadData(elem,startIndex,limit){if(startIndex==null){startIndex=parseInt(elem.getAttribute('data-activitystartindex')||'0');}
limit=limit||parseInt(elem.getAttribute('data-activitylimit')||'7');var minDate=new Date();minDate.setTime(minDate.getTime()-86400000);ApiClient.getJSON(ApiClient.getUrl('System/ActivityLog/Entries',{startIndex:startIndex,limit:limit,minDate:minDate.toISOString()})).done(function(result){elem.setAttribute('data-activitystartindex',startIndex);elem.setAttribute('data-activitylimit',limit);renderList(elem,result,startIndex,limit);});}
function createList(elem){elem.each(function(){reloadData(this);});$(ApiClient).on('websocketmessage.activityloglistener',function(e,data){var msg=data;if(msg.MessageType==="ActivityLogEntry"){elem.each(function(){reloadData(this);});}}).on('websocketopen.activityloglistener',function(e,data){startListening();});}
function startListening(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ActivityLogEntryStart","0,1500");}}
function stopListening(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ActivityLogEntryStop","0,1500");}}
function destroyList(elem){$(ApiClient).off('websocketopen.activityloglistener').off('websocketmessage.activityloglistener');stopListening();return this;}
$.fn.activityLogList=function(action){if(action=='destroy'){destroyList(this);}else{createList(this);}
startListening();return this;};})(jQuery,document,window);(function($,document,window){var welcomeDismissValue='11';var welcomeTourKey='welcomeTour';function dismissWelcome(page,userId){ApiClient.getDisplayPreferences('dashboard',userId,'dashboard').done(function(result){result.CustomPrefs[welcomeTourKey]=welcomeDismissValue;ApiClient.updateDisplayPreferences('dashboard',result,userId,'dashboard');$(page).off('pagebeforeshow.checktour');});}
function showWelcomeIfNeeded(page){var userId=Dashboard.getCurrentUserId();ApiClient.getDisplayPreferences('dashboard',userId,'dashboard').done(function(result){if(result.CustomPrefs[welcomeTourKey]==welcomeDismissValue){$('.welcomeMessage',page).hide();}else{var elem=$('.welcomeMessage',page).show();if(result.CustomPrefs[welcomeTourKey]){$('.tourHeader',elem).html(Globalize.translate('HeaderWelcomeBack'));$('.tourButtonText',elem).html(Globalize.translate('ButtonTakeTheTourToSeeWhatsNew'));}else{$('.tourHeader',elem).html(Globalize.translate('HeaderWelcomeToProjectServerDashboard'));$('.tourButtonText',elem).html(Globalize.translate('ButtonTakeTheTour'));}}});}
function takeTour(page,userId){$.swipebox([{href:'css/images/tour/dashboard/dashboard.png',title:Globalize.translate('DashboardTourDashboard')},{href:'css/images/tour/dashboard/help.png',title:Globalize.translate('DashboardTourHelp')},{href:'css/images/tour/dashboard/users.png',title:Globalize.translate('DashboardTourUsers')},{href:'css/images/tour/dashboard/sync.png',title:Globalize.translate('DashboardTourSync')},{href:'css/images/tour/dashboard/cinemamode.png',title:Globalize.translate('DashboardTourCinemaMode')},{href:'css/images/tour/dashboard/chapters.png',title:Globalize.translate('DashboardTourChapters')},{href:'css/images/tour/dashboard/subtitles.png',title:Globalize.translate('DashboardTourSubtitles')},{href:'css/images/tour/dashboard/plugins.png',title:Globalize.translate('DashboardTourPlugins')},{href:'css/images/tour/dashboard/notifications.png',title:Globalize.translate('DashboardTourNotifications')},{href:'css/images/tour/dashboard/scheduledtasks.png',title:Globalize.translate('DashboardTourScheduledTasks')},{href:'css/images/tour/dashboard/mobile.png',title:Globalize.translate('DashboardTourMobile')},{href:'css/images/tour/enjoy.jpg',title:Globalize.translate('MessageEnjoyYourStay')}],{afterClose:function(){dismissWelcome(page,userId);$('.welcomeMessage',page).hide();},hideBarsDelay:30000});}
$(document).on('pageinit',"#dashboardPage",function(){var page=this;var userId=Dashboard.getCurrentUserId();$('.btnTakeTour',page).on('click',function(){takeTour(page,userId);});}).on('pagebeforeshow.checktour',"#dashboardPage",function(){var page=this;showWelcomeIfNeeded(page);});})(jQuery,document,window);(function(){$(document).on('pagebeforeshow',".type-interior",function(){var page=this;Dashboard.getPluginSecurityInfo().done(function(pluginSecurityInfo){if(!$('.staticSupporterPromotion',page).length){$('.supporterPromotion',page).remove();if(!pluginSecurityInfo.IsMBSupporter){$('.content-primary',page).append('<div class="supporterPromotion"><a class="btn btnActionAccent" href="supporter.html" style="font-size:14px;"><div>'+Globalize.translate('HeaderSupportTheTeam')+'</div><div style="font-weight:normal;font-size:90%;margin-top:5px;">'+Globalize.translate('TextEnjoyBonusFeatures')+'</div></a></div>');}}});});})();(function(){function load(page,device,capabilities){if(capabilities.SupportsContentUploading){$('#fldCameraUploadPath',page).show();}else{$('#fldCameraUploadPath',page).hide();}
$('#txtCustomName',page).val(device.CustomName||'');$('#txtUploadPath',page).val(device.CameraUploadPath||'');$('.reportedName',page).html(device.ReportedName||'');}
function loadData(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');var promise1=ApiClient.getJSON(ApiClient.getUrl('Devices/Info',{Id:id}));var promise2=ApiClient.getJSON(ApiClient.getUrl('Devices/Capabilities',{Id:id}));$.when(promise1,promise2).done(function(response1,response2){load(page,response1[0],response2[0]);Dashboard.hideLoadingMsg();});}
function save(page){var id=getParameterByName('id');ApiClient.ajax({url:ApiClient.getUrl('Devices/Options',{Id:id}),type:'POST',data:JSON.stringify({CustomName:$('#txtCustomName',page).val(),CameraUploadPath:$('#txtUploadPath',page).val()}),contentType:"application/json"}).done(Dashboard.processServerConfigurationUpdateResult);}
$(document).on('pageinit',"#devicePage",function(){var page=this;$('#btnSelectUploadPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtUploadPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectUploadPath')});});}).on('pageshow',"#devicePage",function(){var page=this;loadData(page);});window.DevicePage={onSubmit:function(){var form=this;var page=$(form).parents('.page');save(page);return false;}};})();(function(){function deleteDevice(page,id){var msg=Globalize.translate('DeleteDeviceConfirmation');Dashboard.confirm(msg,Globalize.translate('HeaderDeleteDevice'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl('Devices',{Id:id})}).done(function(){loadData(page);});}});}
function load(page,devices){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="minus">';html+=devices.map(function(d){var deviceHtml='';deviceHtml+='<li>';deviceHtml+='<a href="device.html?id='+d.Id+'">';deviceHtml+='<h3>';deviceHtml+=d.Name;deviceHtml+='</h3>';if(d.AppName){deviceHtml+='<p style="color:blue;">';deviceHtml+=d.AppName;deviceHtml+='</p>';}
if(d.LastUserName){deviceHtml+='<p style="color:green;">';deviceHtml+=Globalize.translate('DeviceLastUsedByUserName',d.LastUserName);deviceHtml+='</p>';}
deviceHtml+='</a>';deviceHtml+='<a href="#" data-icon="minus" class="btnDeleteDevice" data-id="'+d.Id+'">';deviceHtml+=Globalize.translate('Delete');deviceHtml+='</a>';deviceHtml+='</li>';return deviceHtml;}).join('');html+='</ul>';var elem=$('.devicesList',page).html(html).trigger('create');$('.btnDeleteDevice',elem).on('click',function(){deleteDevice(page,this.getAttribute('data-id'));});}
function loadData(page){Dashboard.showLoadingMsg();ApiClient.getJSON(ApiClient.getUrl('Devices',{SupportsPersistentIdentifier:true})).done(function(result){load(page,result.Items);Dashboard.hideLoadingMsg();});}
$(document).on('pageshow',"#devicesPage",function(){var page=this;loadData(page);});})();(function(){function load(page,devices,config){if(devices.length){$('.noDevices',page).hide();$('.devicesUploadForm',page).show();}else{$('.noDevices',page).show();$('.devicesUploadForm',page).hide();}
$('#txtUploadPath',page).val(config.CameraUploadPath||'');$('#chkSubfolder',page).checked(config.EnableCameraUploadSubfolders).checkboxradio('refresh');loadDeviceList(page,devices,config);}
function loadDeviceList(page,devices,config){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>';html+=Globalize.translate('LabelEnableCameraUploadFor');html+='</legend>';var index=0;html+=devices.map(function(d){var deviceHtml='';var id="chk"+index;deviceHtml+='<label for="'+id+'">';deviceHtml+=d.Name;if(d.AppName){deviceHtml+='<br/><span>'+d.AppName+'</span>';}
deviceHtml+='</label>';var isChecked=config.EnabledCameraUploadDevices.indexOf(d.Id)!=-1;var checkedHtml=isChecked?' checked="checked"':'';deviceHtml+='<input type="checkbox" id="'+id+'" class="chkDevice" data-id="'+d.Id+'"'+checkedHtml+' />';index++;return deviceHtml;}).join('');html+='</fieldset>';html+='<div class="fieldDescription">';html+=Globalize.translate('LabelEnableCameraUploadForHelp');html+='</div>';$('.devicesList',page).html(html).trigger('create');}
function loadData(page){Dashboard.showLoadingMsg();var promise1=ApiClient.getNamedConfiguration("devices");var promise2=ApiClient.getJSON(ApiClient.getUrl('Devices',{SupportsContentUploading:true}));$.when(promise1,promise2).done(function(response1,response2){load(page,response2[0].Items,response1[0]);Dashboard.hideLoadingMsg();});}
function save(page){ApiClient.getNamedConfiguration("devices").done(function(config){config.CameraUploadPath=$('#txtUploadPath',page).val();config.EnabledCameraUploadDevices=$('.chkDevice:checked',page).get().map(function(c){return c.getAttribute('data-id');});config.EnableCameraUploadSubfolders=$('#chkSubfolder',page).checked();ApiClient.updateNamedConfiguration("devices",config).done(Dashboard.processServerConfigurationUpdateResult);});}
$(document).on('pageinit',"#devicesUploadPage",function(){var page=this;$('#btnSelectUploadPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtUploadPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectUploadPath')});});}).on('pageshow',"#devicesUploadPage",function(){var page=this;loadData(page);});window.DevicesUploadPage={onSubmit:function(){var form=this;var page=$(form).parents('.page');save(page);return false;}};})();(function(window,document,$){function refreshDirectoryBrowser(page,path,fileOptions){Dashboard.showLoadingMsg();if(path){$('.networkHeadline').hide();}else{$('.networkHeadline').show();}
var promise;var parentPathPromise=null;if(path==="Network"){promise=ApiClient.getNetworkDevices();}
else if(path){promise=ApiClient.getDirectoryContents(path,fileOptions);parentPathPromise=ApiClient.getParentPath(path);}else{promise=ApiClient.getDrives();}
if(!parentPathPromise){parentPathPromise=$.Deferred();parentPathPromise.resolveWith(null,[]);parentPathPromise=parentPathPromise.promise();}
$.when(promise,parentPathPromise).done(function(response1,response2){var folders=response1[0];var parentPath=response2&&response2.length?response2[0]||'':'';$('#txtDirectoryPickerPath',page).val(path||"");var html='';if(path){html+='<li><a class="lnkPath lnkDirectory" data-path="'+parentPath+'" href="#">..</a></li>';}
for(var i=0,length=folders.length;i<length;i++){var folder=folders[i];var cssClass=folder.Type=="File"?"lnkPath lnkFile":"lnkPath lnkDirectory";html+='<li><a class="'+cssClass+'" data-type="'+folder.Type+'" data-path="'+folder.Path+'" href="#">'+folder.Name+'</a></li>';}
if(!path){html+='<li><a class="lnkPath lnkDirectory" data-path="Network" href="#">'+Globalize.translate('ButtonNetwork')+'</a></li>';}
$('#ulDirectoryPickerList',page).html(html).listview('refresh');Dashboard.hideLoadingMsg();}).fail(function(){$('#txtDirectoryPickerPath',page).val("");$('#ulDirectoryPickerList',page).html('').listview('refresh');Dashboard.hideLoadingMsg();});}
window.DirectoryBrowser=function(page){var self=this;self.show=function(options){options=options||{};var fileOptions={includeDirectories:true};if(options.includeDirectories!=null){fileOptions.includeDirectories=options.includeDirectories;}
if(options.includeFiles!=null){fileOptions.includeFiles=options.includeFiles;}
options.header=options.header||Globalize.translate('HeaderSelectPath');options.instruction=options.instruction||"";var html='<div data-role="popup" id="popupDirectoryPicker" class="popup" style="min-width:65%;">';html+='<div class="ui-bar-a" style="text-align: center; padding: 0 20px;">';html+='<h3>'+options.header+'</h3>';html+='</div>';html+='<div data-role="content" class="ui-content">';html+='<form>';var instruction=options.instruction?options.instruction+'<br/><br/>':'';html+='<p class="directoryPickerHeadline">';html+=instruction;html+=Globalize.translate('MessageDirectoryPickerInstruction').replace('{0}','<b>\\\\server</b>').replace('{1}','<b>\\\\192.168.1.101</b>');html+='</p>';html+='<div style="margin:20px 0 0;">';html+='<label for="txtDirectoryPickerPath" class="lblDirectoryPickerPath">'+Globalize.translate('LabelCurrentPath')+'</label>';html+='<div style="width:82%;display:inline-block;"><input id="txtDirectoryPickerPath" name="txtDirectoryPickerPath" type="text" required="required" style="font-weight:bold;" /></div>';html+='<button class="btnRefreshDirectories" type="button" data-icon="refresh" data-inline="true" data-mini="true" data-iconpos="notext">'+Globalize.translate('ButtonRefresh')+'</button>';html+='</div>';html+='<div style="height: 180px; overflow-y: auto;">';html+='<ul id="ulDirectoryPickerList" data-role="listview" data-inset="true" data-auto-enhanced="false"></ul>';html+='</div>';html+='<p>';html+='<button type="submit" data-theme="b" data-icon="check" data-mini="true">'+Globalize.translate('ButtonOk')+'</button>';html+='<button type="button" data-icon="delete" onclick="$(this).parents(\'.popup\').popup(\'close\');" data-mini="true">'+Globalize.translate('ButtonCancel')+'</button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';$(page).append(html);var popup=$('#popupDirectoryPicker').popup().trigger('create').on("popupafteropen",function(){$('#popupDirectoryPicker input:first',this).focus();}).popup("open").on("popupafterclose",function(){$('form',this).off("submit");$(this).off("click").off("change").off("popupafterclose").remove();}).on("click",".lnkPath",function(){var path=this.getAttribute('data-path');if($(this).hasClass('lnkFile')){$('#txtDirectoryPickerPath',page).val(path);}else{refreshDirectoryBrowser(page,path,fileOptions);}}).on("click",".btnRefreshDirectories",function(){var path=$('#txtDirectoryPickerPath',page).val();refreshDirectoryBrowser(page,path,fileOptions);}).on("change","#txtDirectoryPickerPath",function(){refreshDirectoryBrowser(page,this.value,fileOptions);});var txtCurrentPath=$('#txtDirectoryPickerPath',popup);if(options.path){txtCurrentPath.val(options.path);}
$('form',popup).on('submit',function(){if(options.callback){options.callback($('#txtDirectoryPickerPath',this).val());}
return false;});refreshDirectoryBrowser(page,txtCurrentPath.val());};self.close=function(){$('#popupDirectoryPicker',page).popup("close");};};})(window,document,jQuery);(function($,document,window){var currentProfile;var currentSubProfile;var isSubProfileNew;var allText=Globalize.translate('LabelAll');function loadProfile(page){Dashboard.showLoadingMsg();var promise1=getProfile();var promise2=ApiClient.getUsers();$.when(promise1,promise2).done(function(response1,response2){currentProfile=response1[0];renderProfile(page,currentProfile,response2[0]);Dashboard.hideLoadingMsg();});}
function getProfile(){var id=getParameterByName('id');var url=id?'Dlna/Profiles/'+id:'Dlna/Profiles/Default';return ApiClient.getJSON(ApiClient.getUrl(url));}
function renderProfile(page,profile,users){$('#txtName',page).val(profile.Name);$('.chkMediaType',page).each(function(){this.checked=(profile.SupportedMediaTypes||'').split(',').indexOf(this.getAttribute('data-value'))!=-1;}).checkboxradio('refresh');$('#chkEnableAlbumArtInDidl',page).checked(profile.EnableAlbumArtInDidl).checkboxradio('refresh');$('#chkEnableSingleImageLimit',page).checked(profile.EnableSingleAlbumArtLimit).checkboxradio('refresh');renderXmlDocumentAttributes(page,profile.XmlRootAttributes||[]);var idInfo=profile.Identification||{};renderIdentificationHeaders(page,idInfo.Headers||[]);renderSubtitleProfiles(page,profile.SubtitleProfiles||[]);$('#txtInfoFriendlyName',page).val(profile.FriendlyName||'');$('#txtInfoModelName',page).val(profile.ModelName||'');$('#txtInfoModelNumber',page).val(profile.ModelNumber||'');$('#txtInfoModelDescription',page).val(profile.ModelDescription||'');$('#txtInfoModelUrl',page).val(profile.ModelUrl||'');$('#txtInfoManufacturer',page).val(profile.Manufacturer||'');$('#txtInfoManufacturerUrl',page).val(profile.ManufacturerUrl||'');$('#txtInfoSerialNumber',page).val(profile.SerialNumber||'');$('#txtIdFriendlyName',page).val(idInfo.FriendlyName||'');$('#txtIdModelName',page).val(idInfo.ModelName||'');$('#txtIdModelNumber',page).val(idInfo.ModelNumber||'');$('#txtIdModelDescription',page).val(idInfo.ModelDescription||'');$('#txtIdModelUrl',page).val(idInfo.ModelUrl||'');$('#txtIdManufacturer',page).val(idInfo.Manufacturer||'');$('#txtIdManufacturerUrl',page).val(idInfo.ManufacturerUrl||'');$('#txtIdSerialNumber',page).val(idInfo.SerialNumber||'');$('#txtIdDeviceDescription',page).val(idInfo.DeviceDescription||'');$('#txtAlbumArtPn',page).val(profile.AlbumArtPn||'');$('#txtAlbumArtMaxWidth',page).val(profile.MaxAlbumArtWidth||'');$('#txtAlbumArtMaxHeight',page).val(profile.MaxAlbumArtHeight||'');$('#txtIconMaxWidth',page).val(profile.MaxIconWidth||'');$('#txtIconMaxHeight',page).val(profile.MaxIconHeight||'');$('#chkIgnoreTranscodeByteRangeRequests',page).checked(profile.IgnoreTranscodeByteRangeRequests).checkboxradio('refresh');$('#txtMaxAllowedBitrate',page).val(profile.MaxStreamingBitrate||'');$('#txtMusicStreamingTranscodingBitrate',page).val(profile.MusicStreamingTranscodingBitrate||'');$('#chkRequiresPlainFolders',page).checked(profile.RequiresPlainFolders).checkboxradio('refresh');$('#chkRequiresPlainVideoItems',page).checked(profile.RequiresPlainVideoItems).checkboxradio('refresh');$('#txtProtocolInfo',page).val(profile.ProtocolInfo||'');$('#txtXDlnaCap',page).val(profile.XDlnaCap||'');$('#txtXDlnaDoc',page).val(profile.XDlnaDoc||'');$('#txtSonyAggregationFlags',page).val(profile.SonyAggregationFlags||'');profile.DirectPlayProfiles=(profile.DirectPlayProfiles||[]);profile.TranscodingProfiles=(profile.TranscodingProfiles||[]);profile.ContainerProfiles=(profile.ContainerProfiles||[]);profile.CodecProfiles=(profile.CodecProfiles||[]);profile.ResponseProfiles=(profile.ResponseProfiles||[]);var usersHtml='<option></option>'+users.map(function(u){return'<option value="'+u.Id+'">'+u.Name+'</option>';}).join('');$('#selectUser',page).html(usersHtml).val(profile.UserId||'').selectmenu("refresh");renderSubProfiles(page,profile);}
function renderIdentificationHeaders(page,headers){var index=0;var html='<ul data-role="listview" data-inset="true" data-split-icon="delete">'+headers.map(function(h){var li='<li>';li+='<a href="#">';li+='<div style="font-weight:normal;">'+h.Name+': '+(h.Value||'')+'</div>';li+='<div style="font-weight:normal;">'+(h.Match||'')+'</div>';li+='</a>';li+='<a class="btnDeleteIdentificationHeader" href="#" data-index="'+index+'"></a>';li+='</li>';index++;return li;}).join('')+'</ul>';var elem=$('.httpHeaderIdentificationList',page).html(html).trigger('create');$('.btnDeleteIdentificationHeader',elem).on('click',function(){var itemIndex=parseInt(this.getAttribute('data-index'));currentProfile.Identification.Headers.splice(itemIndex,1);renderIdentificationHeaders(page,currentProfile.Identification.Headers);});}
function editIdentificationHeader(page,header){isSubProfileNew=header==null;header=header||{};currentSubProfile=header;var popup=$('#identificationHeaderPopup',page);$('#txtIdentificationHeaderName',popup).val(header.Name||'');$('#txtIdentificationHeaderValue',popup).val(header.Value||'');$('#selectMatchType',popup).val(header.Match||'Equals').selectmenu('refresh');popup.popup('open');}
function saveIdentificationHeader(page){currentSubProfile.Name=$('#txtIdentificationHeaderName',page).val();currentSubProfile.Value=$('#txtIdentificationHeaderValue',page).val();currentSubProfile.Match=$('#selectMatchType',page).val();if(isSubProfileNew){currentProfile.Identification.Headers.push(currentSubProfile);}
renderIdentificationHeaders(page,currentProfile.Identification.Headers);currentSubProfile=null;$('#identificationHeaderPopup',page).popup('close');}
function renderXmlDocumentAttributes(page,attribute){var index=0;var html='<ul data-role="listview" data-inset="true" data-split-icon="delete">'+attribute.map(function(h){var li='<li>';li+='<a href="#">';li+='<div style="font-weight:normal;">'+h.Name+' = '+(h.Value||'')+'</div>';li+='</a>';li+='<a class="btnDeleteXmlAttribute" href="#" data-index="'+index+'"></a>';li+='</li>';index++;return li;}).join('')+'</ul>';var elem=$('.xmlDocumentAttributeList',page).html(html).trigger('create');$('.btnDeleteXmlAttribute',elem).on('click',function(){var itemIndex=parseInt(this.getAttribute('data-index'));currentProfile.XmlRootAttributes.splice(itemIndex,1);renderXmlDocumentAttributes(page,currentProfile.XmlRootAttributes);});}
function editXmlDocumentAttribute(page,attribute){isSubProfileNew=attribute==null;attribute=attribute||{};currentSubProfile=attribute;var popup=$('#xmlAttributePopup',page);$('#txtXmlAttributeName',popup).val(attribute.Name||'');$('#txtXmlAttributeValue',popup).val(attribute.Value||'');popup.popup('open');}
function saveXmlDocumentAttribute(page){currentSubProfile.Name=$('#txtXmlAttributeName',page).val();currentSubProfile.Value=$('#txtXmlAttributeValue',page).val();if(isSubProfileNew){currentProfile.XmlRootAttributes.push(currentSubProfile);}
renderXmlDocumentAttributes(page,currentProfile.XmlRootAttributes);currentSubProfile=null;$('#xmlAttributePopup',page).popup('close');}
function renderSubtitleProfiles(page,profiles){var index=0;var html='<ul data-role="listview" data-inset="true" data-split-icon="delete">'+profiles.map(function(h){var li='<li>';li+='<a href="#" class="lnkEditSubProfile" data-index="'+index+'">';li+='<div style="font-weight:normal;">'+(h.Format||'')+'</div>';li+='</a>';li+='<a class="btnDeleteProfile" href="#" data-index="'+index+'"></a>';li+='</li>';index++;return li;}).join('')+'</ul>';var elem=$('.subtitleProfileList',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var itemIndex=parseInt(this.getAttribute('data-index'));currentProfile.SubtitleProfiles.splice(itemIndex,1);renderSubtitleProfiles(page,currentProfile.SubtitleProfiles);});$('.lnkEditSubProfile',elem).on('click',function(){var itemIndex=parseInt(this.getAttribute('data-index'));editSubtitleProfile(page,currentProfile.SubtitleProfiles[itemIndex]);});}
function editSubtitleProfile(page,profile){isSubProfileNew=profile==null;profile=profile||{};currentSubProfile=profile;var popup=$('#subtitleProfilePopup',page);$('#txtSubtitleProfileFormat',popup).val(profile.Format||'');$('#selectSubtitleProfileMethod',popup).val(profile.Method||'').selectmenu('refresh');$('#selectSubtitleProfileDidlMode',popup).val(profile.DidlMode||'').selectmenu('refresh');popup.popup('open');}
function saveSubtitleProfile(page){currentSubProfile.Format=$('#txtSubtitleProfileFormat',page).val();currentSubProfile.Method=$('#selectSubtitleProfileMethod',page).val();currentSubProfile.DidlMode=$('#selectSubtitleProfileDidlMode',page).val();if(isSubProfileNew){currentProfile.SubtitleProfiles.push(currentSubProfile);}
renderSubtitleProfiles(page,currentProfile.SubtitleProfiles);currentSubProfile=null;$('#subtitleProfilePopup',page).popup('close');}
function renderSubProfiles(page,profile){renderDirectPlayProfiles(page,profile.DirectPlayProfiles);renderTranscodingProfiles(page,profile.TranscodingProfiles);renderContainerProfiles(page,profile.ContainerProfiles);renderCodecProfiles(page,profile.CodecProfiles);renderResponseProfiles(page,profile.ResponseProfiles);}
function saveDirectPlayProfile(page){currentSubProfile.Type=$('#selectDirectPlayProfileType',page).val();currentSubProfile.Container=$('#txtDirectPlayContainer',page).val();currentSubProfile.AudioCodec=$('#txtDirectPlayAudioCodec',page).val();currentSubProfile.VideoCodec=$('#txtDirectPlayVideoCodec',page).val();if(isSubProfileNew){currentProfile.DirectPlayProfiles.push(currentSubProfile);}
renderSubProfiles(page,currentProfile);currentSubProfile=null;$('#popupEditDirectPlayProfile',page).popup('close');}
function renderDirectPlayProfiles(page,profiles){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var currentType;for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];if(profile.Type!==currentType){html+='<li data-role="list-divider">'+profile.Type+'</li>';currentType=profile.Type;}
html+='<li>';html+='<a data-profileindex="'+i+'" class="lnkEditSubProfile" href="#">';html+='<p>'+Globalize.translate('ValueContainer').replace('{0}',(profile.Container||allText))+'</p>';if(profile.Type=='Video'){html+='<p>'+Globalize.translate('ValueVideoCodec').replace('{0}',(profile.VideoCodec||allText))+'</p>';html+='<p>'+Globalize.translate('ValueAudioCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}else if(profile.Type=='Audio'){html+='<p>'+Globalize.translate('ValueCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}
html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileindex="'+i+'">Delete</a>';html+='</li>';}
html+='</ul>';var elem=$('.directPlayProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var index=this.getAttribute('data-profileindex');deleteDirectPlayProfile(page,index);});$('.lnkEditSubProfile',elem).on('click',function(){var index=parseInt(this.getAttribute('data-profileindex'));editDirectPlayProfile(page,currentProfile.DirectPlayProfiles[index]);});}
function deleteDirectPlayProfile(page,index){currentProfile.DirectPlayProfiles.splice(index,1);renderDirectPlayProfiles(page,currentProfile.DirectPlayProfiles);}
function editDirectPlayProfile(page,directPlayProfile){isSubProfileNew=directPlayProfile==null;directPlayProfile=directPlayProfile||{};currentSubProfile=directPlayProfile;var popup=$('#popupEditDirectPlayProfile',page);$('#selectDirectPlayProfileType',popup).val(directPlayProfile.Type||'Video').selectmenu('refresh').trigger('change');$('#txtDirectPlayContainer',popup).val(directPlayProfile.Container||'');$('#txtDirectPlayAudioCodec',popup).val(directPlayProfile.AudioCodec||'');$('#txtDirectPlayVideoCodec',popup).val(directPlayProfile.VideoCodec||'');popup.popup('open');}
function renderTranscodingProfiles(page,profiles){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var currentType;for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];if(profile.Type!==currentType){html+='<li data-role="list-divider">'+profile.Type+'</li>';currentType=profile.Type;}
html+='<li>';html+='<a data-profileindex="'+i+'" class="lnkEditSubProfile" href="#">';html+='<p>Protocol: '+(profile.Protocol||'Http')+'</p>';html+='<p>'+Globalize.translate('ValueContainer').replace('{0}',(profile.Container||allText))+'</p>';if(profile.Type=='Video'){html+='<p>'+Globalize.translate('ValueVideoCodec').replace('{0}',(profile.VideoCodec||allText))+'</p>';html+='<p>'+Globalize.translate('ValueAudioCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}else if(profile.Type=='Audio'){html+='<p>'+Globalize.translate('ValueCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}
html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileindex="'+i+'">Delete</a>';html+='</li>';}
html+='</ul>';var elem=$('.transcodingProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var index=this.getAttribute('data-profileindex');deleteTranscodingProfile(page,index);});$('.lnkEditSubProfile',elem).on('click',function(){var index=parseInt(this.getAttribute('data-profileindex'));editTranscodingProfile(page,currentProfile.TranscodingProfiles[index]);});}
function editTranscodingProfile(page,transcodingProfile){isSubProfileNew=transcodingProfile==null;transcodingProfile=transcodingProfile||{};currentSubProfile=transcodingProfile;var popup=$('#transcodingProfilePopup',page);$('#selectTranscodingProfileType',popup).val(transcodingProfile.Type||'Video').selectmenu('refresh').trigger('change');$('#txtTranscodingContainer',popup).val(transcodingProfile.Container||'');$('#txtTranscodingAudioCodec',popup).val(transcodingProfile.AudioCodec||'');$('#txtTranscodingVideoCodec',popup).val(transcodingProfile.VideoCodec||'');$('#selectTranscodingProtocol',popup).val(transcodingProfile.Protocol||'Http').selectmenu('refresh');$('#chkEnableMpegtsM2TsMode',popup).checked(transcodingProfile.EnableMpegtsM2TsMode||false).checkboxradio('refresh');$('#chkEstimateContentLength',popup).checked(transcodingProfile.EstimateContentLength||false).checkboxradio('refresh');$('#chkReportByteRangeRequests',popup).checked(transcodingProfile.TranscodeSeekInfo=='Bytes').checkboxradio('refresh');$('.radioTabButton:first',popup).checked(true).checkboxradio('refresh').trigger('change');popup.popup('open');}
function deleteTranscodingProfile(page,index){currentProfile.TranscodingProfiles.splice(index,1);renderTranscodingProfiles(page,currentProfile.TranscodingProfiles);}
function saveTranscodingProfile(page){currentSubProfile.Type=$('#selectTranscodingProfileType',page).val();currentSubProfile.Container=$('#txtTranscodingContainer',page).val();currentSubProfile.AudioCodec=$('#txtTranscodingAudioCodec',page).val();currentSubProfile.VideoCodec=$('#txtTranscodingVideoCodec',page).val();currentSubProfile.Protocol=$('#selectTranscodingProtocol',page).val();currentSubProfile.Context='Streaming';currentSubProfile.EnableMpegtsM2TsMode=$('#chkEnableMpegtsM2TsMode',page).checked();currentSubProfile.EstimateContentLength=$('#chkEstimateContentLength',page).checked();currentSubProfile.TranscodeSeekInfo=$('#chkReportByteRangeRequests',page).checked()?'Bytes':'Auto';if(isSubProfileNew){currentProfile.TranscodingProfiles.push(currentSubProfile);}
renderSubProfiles(page,currentProfile);currentSubProfile=null;$('#transcodingProfilePopup',page).popup('close');}
function renderContainerProfiles(page,profiles){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var currentType;for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];if(profile.Type!==currentType){html+='<li data-role="list-divider">'+profile.Type+'</li>';currentType=profile.Type;}
html+='<li>';html+='<a data-profileindex="'+i+'" class="lnkEditSubProfile" href="#">';html+='<p>'+Globalize.translate('ValueContainer').replace('{0}',(profile.Container||allText))+'</p>';if(profile.Conditions&&profile.Conditions.length){html+='<p>';html+=Globalize.translate('ValueConditions').replace('{0}',profile.Conditions.map(function(c){return c.Property;}).join(', '));html+='</p>';}
html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileindex="'+i+'">Delete</a>';html+='</li>';}
html+='</ul>';var elem=$('.containerProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var index=this.getAttribute('data-profileindex');deleteContainerProfile(page,index);});$('.lnkEditSubProfile',elem).on('click',function(){var index=parseInt(this.getAttribute('data-profileindex'));editContainerProfile(page,currentProfile.ContainerProfiles[index]);});}
function deleteContainerProfile(page,index){currentProfile.ContainerProfiles.splice(index,1);renderContainerProfiles(page,currentProfile.ContainerProfiles);}
function editContainerProfile(page,containerProfile){isSubProfileNew=containerProfile==null;containerProfile=containerProfile||{};currentSubProfile=containerProfile;var popup=$('#containerProfilePopup',page);$('#selectContainerProfileType',popup).val(containerProfile.Type||'Video').selectmenu('refresh').trigger('change');$('#txtContainerProfileContainer',popup).val(containerProfile.Container||'');$('.radioTabButton:first',popup).checked(true).checkboxradio('refresh').trigger('change');popup.popup('open');}
function saveContainerProfile(page){currentSubProfile.Type=$('#selectContainerProfileType',page).val();currentSubProfile.Container=$('#txtContainerProfileContainer',page).val();if(isSubProfileNew){currentProfile.ContainerProfiles.push(currentSubProfile);}
renderSubProfiles(page,currentProfile);currentSubProfile=null;$('#containerProfilePopup',page).popup('close');}
function renderCodecProfiles(page,profiles){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var currentType;for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];var type=profile.Type.replace("VideoAudio","Video Audio");if(type!==currentType){html+='<li data-role="list-divider">'+type+'</li>';currentType=type;}
html+='<li>';html+='<a data-profileindex="'+i+'" class="lnkEditSubProfile" href="#">';html+='<p>'+Globalize.translate('ValueCodec').replace('{0}',(profile.Codec||allText))+'</p>';if(profile.Conditions&&profile.Conditions.length){html+='<p>';html+=Globalize.translate('ValueConditions').replace('{0}',profile.Conditions.map(function(c){return c.Property;}).join(', '));html+='</p>';}
html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileindex="'+i+'">Delete</a>';html+='</li>';}
html+='</ul>';var elem=$('.codecProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var index=this.getAttribute('data-profileindex');deleteCodecProfile(page,index);});$('.lnkEditSubProfile',elem).on('click',function(){var index=parseInt(this.getAttribute('data-profileindex'));editCodecProfile(page,currentProfile.CodecProfiles[index]);});}
function deleteCodecProfile(page,index){currentProfile.CodecProfiles.splice(index,1);renderCodecProfiles(page,currentProfile.CodecProfiles);}
function editCodecProfile(page,codecProfile){isSubProfileNew=codecProfile==null;codecProfile=codecProfile||{};currentSubProfile=codecProfile;var popup=$('#codecProfilePopup',page);$('#selectCodecProfileType',popup).val(codecProfile.Type||'Video').selectmenu('refresh').trigger('change');$('#txtCodecProfileCodec',popup).val(codecProfile.Codec||'');$('.radioTabButton:first',popup).checked(true).checkboxradio('refresh').trigger('change');popup.popup('open');}
function saveCodecProfile(page){currentSubProfile.Type=$('#selectCodecProfileType',page).val();currentSubProfile.Codec=$('#txtCodecProfileCodec',page).val();if(isSubProfileNew){currentProfile.CodecProfiles.push(currentSubProfile);}
renderSubProfiles(page,currentProfile);currentSubProfile=null;$('#codecProfilePopup',page).popup('close');}
function renderResponseProfiles(page,profiles){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var currentType;for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];if(profile.Type!==currentType){html+='<li data-role="list-divider">'+profile.Type+'</li>';currentType=profile.Type;}
html+='<li>';html+='<a data-profileindex="'+i+'" class="lnkEditSubProfile" href="#">';html+='<p>'+Globalize.translate('ValueContainer').replace('{0}',(profile.Container||allText))+'</p>';if(profile.Type=='Video'){html+='<p>'+Globalize.translate('ValueVideoCodec').replace('{0}',(profile.VideoCodec||allText))+'</p>';html+='<p>'+Globalize.translate('ValueAudioCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}else if(profile.Type=='Audio'){html+='<p>'+Globalize.translate('ValueCodec').replace('{0}',(profile.AudioCodec||allText))+'</p>';}
if(profile.Conditions&&profile.Conditions.length){html+='<p>';html+=Globalize.translate('ValueConditions').replace('{0}',profile.Conditions.map(function(c){return c.Property;}).join(', '));html+='</p>';}
html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileindex="'+i+'">Delete</a>';html+='</li>';}
html+='</ul>';var elem=$('.mediaProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var index=this.getAttribute('data-profileindex');deleteResponseProfile(page,index);});$('.lnkEditSubProfile',elem).on('click',function(){var index=parseInt(this.getAttribute('data-profileindex'));editResponseProfile(page,currentProfile.ResponseProfiles[index]);});}
function deleteResponseProfile(page,index){currentProfile.ResponseProfiles.splice(index,1);renderResponseProfiles(page,currentProfile.ResponseProfiles);}
function editResponseProfile(page,responseProfile){isSubProfileNew=responseProfile==null;responseProfile=responseProfile||{};currentSubProfile=responseProfile;var popup=$('#responseProfilePopup',page);$('#selectResponseProfileType',popup).val(responseProfile.Type||'Video').selectmenu('refresh').trigger('change');$('#txtResponseProfileContainer',popup).val(responseProfile.Container||'');$('#txtResponseProfileAudioCodec',popup).val(responseProfile.AudioCodec||'');$('#txtResponseProfileVideoCodec',popup).val(responseProfile.VideoCodec||'');$('.radioTabButton:first',popup).checked(true).checkboxradio('refresh').trigger('change');popup.popup('open');}
function saveResponseProfile(page){currentSubProfile.Type=$('#selectResponseProfileType',page).val();currentSubProfile.Container=$('#txtResponseProfileContainer',page).val();currentSubProfile.AudioCodec=$('#txtResponseProfileAudioCodec',page).val();currentSubProfile.VideoCodec=$('#txtResponseProfileVideoCodec',page).val();if(isSubProfileNew){currentProfile.ResponseProfiles.push(currentSubProfile);}
renderSubProfiles(page,currentProfile);currentSubProfile=null;$('#responseProfilePopup',page).popup('close');}
function saveProfile(page,profile){updateProfile(page,profile);var id=getParameterByName('id');if(id){ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Dlna/Profiles/"+id),data:JSON.stringify(profile),contentType:"application/json"}).done(function(){Dashboard.alert('Settings saved.');});}else{ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Dlna/Profiles"),data:JSON.stringify(profile),contentType:"application/json"}).done(function(){Dashboard.navigate('dlnaprofiles.html');});}
Dashboard.hideLoadingMsg();}
function updateProfile(page,profile){profile.Name=$('#txtName',page).val();profile.EnableAlbumArtInDidl=$('#chkEnableAlbumArtInDidl',page).checked();profile.EnableSingleAlbumArtLimit=$('#chkEnableSingleImageLimit',page).checked();profile.SupportedMediaTypes=$('.chkMediaType:checked',page).get().map(function(c){return c.getAttribute('data-value');}).join(',');profile.Identification=profile.Identification||{};profile.FriendlyName=$('#txtInfoFriendlyName',page).val();profile.ModelName=$('#txtInfoModelName',page).val();profile.ModelNumber=$('#txtInfoModelNumber',page).val();profile.ModelDescription=$('#txtInfoModelDescription',page).val();profile.ModelUrl=$('#txtInfoModelUrl',page).val();profile.Manufacturer=$('#txtInfoManufacturer',page).val();profile.ManufacturerUrl=$('#txtInfoManufacturerUrl',page).val();profile.SerialNumber=$('#txtInfoSerialNumber',page).val();profile.Identification.FriendlyName=$('#txtIdFriendlyName',page).val();profile.Identification.ModelName=$('#txtIdModelName',page).val();profile.Identification.ModelNumber=$('#txtIdModelNumber',page).val();profile.Identification.ModelDescription=$('#txtIdModelDescription',page).val();profile.Identification.ModelUrl=$('#txtIdModelUrl',page).val();profile.Identification.Manufacturer=$('#txtIdManufacturer',page).val();profile.Identification.ManufacturerUrl=$('#txtIdManufacturerUrl',page).val();profile.Identification.SerialNumber=$('#txtIdSerialNumber',page).val();profile.Identification.DeviceDescription=$('#txtIdDeviceDescription',page).val();profile.AlbumArtPn=$('#txtAlbumArtPn',page).val();profile.MaxAlbumArtWidth=$('#txtAlbumArtMaxWidth',page).val();profile.MaxAlbumArtHeight=$('#txtAlbumArtMaxHeight',page).val();profile.MaxIconWidth=$('#txtIconMaxWidth',page).val();profile.MaxIconHeight=$('#txtIconMaxHeight',page).val();profile.RequiresPlainFolders=$('#chkRequiresPlainFolders',page).checked();profile.RequiresPlainVideoItems=$('#chkRequiresPlainVideoItems',page).checked();profile.IgnoreTranscodeByteRangeRequests=$('#chkIgnoreTranscodeByteRangeRequests',page).checked();profile.MaxStreamingBitrate=$('#txtMaxAllowedBitrate',page).val();profile.MusicStreamingTranscodingBitrate=$('#txtMusicStreamingTranscodingBitrate',page).val();profile.ProtocolInfo=$('#txtProtocolInfo',page).val();profile.XDlnaCap=$('#txtXDlnaCap',page).val();profile.XDlnaDoc=$('#txtXDlnaDoc',page).val();profile.SonyAggregationFlags=$('#txtSonyAggregationFlags',page).val();profile.UserId=$('#selectUser',page).val();}
$(document).on('pageinit',"#dlnaProfilePage",function(){var page=this;$('.radioTabButton',page).on('change',function(){var elem=$('.'+this.value,page);elem.siblings('.tabContent').hide();elem.show();});$('#selectDirectPlayProfileType',page).on('change',function(){if(this.value=='Video'){$('#fldDirectPlayVideoCodec',page).show();}else{$('#fldDirectPlayVideoCodec',page).hide();}
if(this.value=='Photo'){$('#fldDirectPlayAudioCodec',page).hide();}else{$('#fldDirectPlayAudioCodec',page).show();}});$('#selectTranscodingProfileType',page).on('change',function(){if(this.value=='Video'){$('#fldTranscodingVideoCodec',page).show();$('#fldTranscodingProtocol',page).show();$('#fldEnableMpegtsM2TsMode',page).show();}else{$('#fldTranscodingVideoCodec',page).hide();$('#fldTranscodingProtocol',page).hide();$('#fldEnableMpegtsM2TsMode',page).hide();}
if(this.value=='Photo'){$('#fldTranscodingAudioCodec',page).hide();$('#fldEstimateContentLength',page).hide();$('#fldReportByteRangeRequests',page).hide();}else{$('#fldTranscodingAudioCodec',page).show();$('#fldEstimateContentLength',page).show();$('#fldReportByteRangeRequests',page).show();}});$('#selectResponseProfileType',page).on('change',function(){if(this.value=='Video'){$('#fldResponseProfileVideoCodec',page).show();}else{$('#fldResponseProfileVideoCodec',page).hide();}
if(this.value=='Photo'){$('#fldResponseProfileAudioCodec',page).hide();}else{$('#fldResponseProfileAudioCodec',page).show();}});$('.btnAddDirectPlayProfile',page).on('click',function(){editDirectPlayProfile(page);});$('.btnAddTranscodingProfile',page).on('click',function(){editTranscodingProfile(page);});$('.btnAddContainerProfile',page).on('click',function(){editContainerProfile(page);});$('.btnAddCodecProfile',page).on('click',function(){editCodecProfile(page);});$('.btnAddResponseProfile',page).on('click',function(){editResponseProfile(page);});$('.btnAddIdentificationHttpHeader',page).on('click',function(){editIdentificationHeader(page);});$('.btnAddXmlDocumentAttribute',page).on('click',function(){editXmlDocumentAttribute(page);});$('.btnAddSubtitleProfile',page).on('click',function(){editSubtitleProfile(page);});}).on('pageshow',"#dlnaProfilePage",function(){var page=this;loadProfile(page);}).on('pagebeforeshow',"#dlnaProfilePage",function(){var page=this;$('.radioTabButton',page).checked(false).checkboxradio('refresh');$('#radioInfo',page).checked(true).checkboxradio('refresh').trigger('change');});window.DlnaProfilePage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;var page=$(form).parents('.page');saveProfile(page,currentProfile);return false;},onDirectPlayFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveDirectPlayProfile(page);return false;},onTranscodingProfileFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveTranscodingProfile(page);return false;},onContainerProfileFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveContainerProfile(page);return false;},onCodecProfileFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveCodecProfile(page);return false;},onResponseProfileFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveResponseProfile(page);return false;},onIdentificationHeaderFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveIdentificationHeader(page);return false;},onXmlAttributeFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveXmlDocumentAttribute(page);return false;},onSubtitleProfileFormSubmit:function(){var form=this;var page=$(form).parents('.page');saveSubtitleProfile(page);return false;}};})(jQuery,document,window);(function($,document,window){function loadProfiles(page){Dashboard.showLoadingMsg();ApiClient.getJSON(ApiClient.getUrl("Dlna/ProfileInfos")).done(function(result){renderProfiles(page,result);Dashboard.hideLoadingMsg();});}
function renderProfiles(page,profiles){renderUserProfiles(page,profiles);renderSystemProfiles(page,profiles);}
function renderUserProfiles(page,profiles){profiles=profiles.filter(function(p){return p.Type=='User';});var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];html+='<li>';html+='<a href="dlnaprofile.html?id='+profile.Id+'">';html+=profile.Name;html+='</a>';html+='<a href="#" data-icon="delete" class="btnDeleteProfile" data-profileid="'+profile.Id+'">'+Globalize.translate('Delete')+'</a>';html+='</li>';}
html+='</ul>';var elem=$('.customProfiles',page).html(html).trigger('create');$('.btnDeleteProfile',elem).on('click',function(){var id=this.getAttribute('data-profileid');deleteProfile(page,id);});}
function renderSystemProfiles(page,profiles){profiles=profiles.filter(function(p){return p.Type=='System';});var html='';html+='<ul data-role="listview" data-inset="true">';for(var i=0,length=profiles.length;i<length;i++){var profile=profiles[i];html+='<li>';html+='<a href="dlnaprofile.html?id='+profile.Id+'">';html+=profile.Name;html+='</a>';html+='</li>';}
html+='</ul>';$('.systemProfiles',page).html(html).trigger('create');}
function deleteProfile(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmProfileDeletion'),Globalize.translate('HeaderConfirmProfileDeletion'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Dlna/Profiles/"+id)}).done(function(){Dashboard.hideLoadingMsg();loadProfiles(page);});}});}
$(document).on('pageshow',"#dlnaProfilesPage",function(){var page=this;loadProfiles(page);});})(jQuery,document,window);(function($,document,window){function loadPage(page,config){$('#chkEnablePlayTo',page).checked(config.EnablePlayTo).checkboxradio("refresh");$('#chkEnableDlnaDebugLogging',page).checked(config.EnableDebugLogging).checkboxradio("refresh");$('#txtClientDiscoveryInterval',page).val(config.ClientDiscoveryIntervalSeconds);Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#dlnaSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getNamedConfiguration("dlna").done(function(config){loadPage(page,config);});});function onSubmit(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("dlna").done(function(config){config.EnablePlayTo=$('#chkEnablePlayTo',form).checked();config.EnableDebugLogging=$('#chkEnableDlnaDebugLogging',form).checked();config.ClientDiscoveryIntervalSeconds=$('#txtClientDiscoveryInterval',form).val();ApiClient.updateNamedConfiguration("dlna",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}
window.DlnaSettingsPage={onSubmit:onSubmit};})(jQuery,document,window);(function($,document,window){function loadPage(page,config,users){$('#chkEnableServer',page).checked(config.EnableServer).checkboxradio("refresh");$('#chkBlastAliveMessages',page).checked(config.BlastAliveMessages).checkboxradio("refresh");$('#txtBlastInterval',page).val(config.BlastAliveMessageIntervalSeconds);$('#chkEnableEnhancedMovies',page).checked(config.EnableEnhancedMovies).checkboxradio("refresh");var usersHtml=users.map(function(u){return'<option value="'+u.Id+'">'+u.Name+'</option>';}).join('');$('#selectUser',page).html(usersHtml).val(config.DefaultUserId||'').selectmenu("refresh");Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#dlnaServerSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getNamedConfiguration("dlna");var promise2=ApiClient.getUsers();$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});});function onSubmit(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("dlna").done(function(config){config.EnableServer=$('#chkEnableServer',form).checked();config.BlastAliveMessages=$('#chkBlastAliveMessages',form).checked();config.BlastAliveMessageIntervalSeconds=$('#txtBlastInterval',form).val();config.DefaultUserId=$('#selectUser',form).val();config.EnableEnhancedMovies=$('#chkEnableEnhancedMovies',form).checked();ApiClient.updateNamedConfiguration("dlna",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}
window.DlnaServerSettingsPage={onSubmit:onSubmit};})(jQuery,document,window);(function($,document,window,FileReader,escape){var currentItem;function updateTabs(page,item){var query=MetadataEditor.getEditQueryString(item);$('#btnEditMetadata',page).attr('href','edititemmetadata.html?'+query);$('#btnEditImages',page).attr('href','edititemimages.html?'+query);}
function reload(page){Dashboard.showLoadingMsg();$('#btnRemoveItems',page).buttonEnabled(false);MetadataEditor.getItemPromise().done(function(item){currentItem=item;LibraryBrowser.renderName(item,$('.itemName',page),true);updateTabs(page,item);reloadTitles(page,item);});}
function getTitleHtml(item){var html='<div style="display:inline-block;margin:5px;vertical-align:top;">';html+='<div style="width:120px;height:180px;">';if(item.ImageTags.Primary){var imgUrl=ApiClient.getScaledImageUrl(item.Id,{type:"Primary",maxWidth:120,maxHeight:180,tag:item.ImageTags.Primary});html+='<img src="'+imgUrl+'" style="max-width:120px;max-height:180px;" />';}
html+='</div>';html+='<div style="text-align:center;margin-top:4px;max-width:100px;overflow:hidden;height: 32px;">'+item.Name+'</div>';if(item.ParentId!=currentItem.Id){html+='<label for="chkRemove'+item.Id+'">'+Globalize.translate("ButtonRemove")+'</label><input id="chkRemove'+item.Id+'" class="chkRemoveItem" type="checkbox" data-itemid="'+item.Id+'" data-mini="true" />';}
html+='</div>';return html;}
function getSearchResultHtml(item){var html='<div style="display:inline-block;margin:3px;vertical-align:top;">';html+='<div style="width:100px;height:150px;">';if(item.PrimaryImageTag){var imgUrl=ApiClient.getScaledImageUrl(item.ItemId,{type:"Primary",maxWidth:100,maxHeight:150,tag:item.PrimaryImageTag});html+='<img src="'+imgUrl+'" style="max-width:100px;max-height:150px;" />';}
html+='</div>';html+='<div style="text-align:center;margin-top:4px;max-width:100px;overflow:hidden;height: 32px;">'+item.Name+'</div>';html+='<label for="chkAdd'+item.ItemId+'">'+Globalize.translate("ButtonAdd")+'</label><input id="chkAdd'+item.ItemId+'" class="chkAddItem" type="checkbox" data-itemid="'+item.ItemId+'" data-mini="true" />';html+='</div>';return html;}
function reloadTitles(page,item){ApiClient.getItems(Dashboard.getCurrentUserId(),{ParentId:item.Id}).done(function(result){$(document).scrollTop(0);var html=result.Items.map(getTitleHtml).join('');var elem=$('.collectionItems',page).html(html).trigger('create');$('.chkRemoveItem',elem).on('change',function(){if($('.chkRemoveItem:checked',elem).length){$('#btnRemoveItems',page).buttonEnabled(true);}else{$('#btnRemoveItems',page).buttonEnabled(false);}});Dashboard.hideLoadingMsg();});}
function showSearchResults(page,searchTerm){ApiClient.getSearchHints({userId:Dashboard.getCurrentUserId(),searchTerm:searchTerm,limit:30,includePeople:false,includeGenres:false,includeStudios:false,includeArtists:false,IncludeItemTypes:"Movie,Series,Game,MusicAlbum,Book"}).done(function(result){renderSearchResults(page,result.SearchHints);});}
function renderSearchResults(page,items){var existingIds=$('.chkRemoveItem',page).get().map(function(c){return c.getAttribute('data-itemid');});var html=items.filter(function(i){return existingIds.indexOf(i.ItemId)==-1;}).map(getSearchResultHtml).join('');var elem=$('.collectionItemSearchResults',page).html(html).trigger('create');$('.chkAddItem',elem).on('change',function(){if($('.chkAddItem:checked',elem).length){$('#btnAddItems',page).buttonEnabled(true);}else{$('#btnAddItems',page).buttonEnabled(false);}});}
function addItemsToCollection(page){var items=$('.chkAddItem:checked',page).get().map(function(c){return c.getAttribute('data-itemid');});if(!items.length){Dashboard.alert(Globalize.translate("MessagePleaseSelectOneItem"));return;}
var url=ApiClient.getUrl("Collections/"+currentItem.Id+"/Items",{Ids:items.join(',')});ApiClient.ajax({type:"POST",url:url}).done(function(){Dashboard.hideLoadingMsg();$('.popupIdentify',page).popup('close');reload(page);});}
function removeItemsFromCollection(page){var items=$('.chkRemoveItem:checked',page).get().map(function(c){return c.getAttribute('data-itemid');});if(!items.length){Dashboard.alert(Globalize.translate("MessagePleaseSelectOneItem"));return;}
var url=ApiClient.getUrl("Collections/"+currentItem.Id+"/Items",{Ids:items.join(',')});ApiClient.ajax({type:"DELETE",url:url}).done(function(){Dashboard.hideLoadingMsg();reload(page);});}
$(document).on('pageinit',"#editCollectionTitlesPage",function(){var page=this;$('.libraryTree',page).on('itemclicked',function(event,data){if(data.id!=currentItem.Id){MetadataEditor.currentItemId=data.id;MetadataEditor.currentItemType=data.itemType;window.location.hash='editItemImagesPage?id='+data.id;reload(page);}});$('#btnAddItem',page).on('click',function(){var popup=$('.popupIdentify',page).popup('open');$('#txtLookupName',popup).val('');$('.collectionItemSearchResults',popup).empty();$('#btnAddItems',popup).buttonEnabled(false);});$('#btnAddItems',page).on('click',function(){addItemsToCollection(page);});$('#btnRemoveItems',page).on('click',function(){removeItemsFromCollection(page);});}).on('pagebeforeshow',"#editCollectionTitlesPage",function(){var page=this;reload(page);$("body").on("popupafteropen.collections",".popupIdentify",function(e){$("#txtLookupName").focus().select();});}).on('pagehide',"#editCollectionTitlesPage",function(){var page=this;currentItem=null;$("body").off("popupafteropen.collections");});window.EditCollectionItemsPage={onSearchFormSubmit:function(){var page=$(this).parents('.page');showSearchResults(page,$('#txtLookupName',page).val());return false;}};})(jQuery,document,window,window.FileReader,escape);(function($,document,window){var currentItem;var currentSearchResult;var metadataEditorInfo;function updateTabs(page,item){var query=MetadataEditor.getEditQueryString(item);$('#btnEditImages',page).attr('href','edititemimages.html?'+query);$('#btnEditSubtitles',page).attr('href','edititemsubtitles.html?'+query);$('#btnEditCollectionTitles',page).attr('href','editcollectionitems.html?'+query);}
function reload(page){unbindItemChanged(page);Dashboard.showLoadingMsg();var promise1=MetadataEditor.getItemPromise();var promise2=MetadataEditor.currentItemId?ApiClient.getJSON(ApiClient.getUrl('Items/'+MetadataEditor.currentItemId+'/MetadataEditor')):{};$.when(promise1,promise2).done(function(response1,response2){var item=response1[0];metadataEditorInfo=response2[0];currentItem=item;if(item.Type=="UserRootFolder"){$('.editPageInnerContent',page).hide();return;}else{$('.editPageInnerContent',page).show();}
var languages=metadataEditorInfo.Cultures;var countries=metadataEditorInfo.Countries;renderContentTypeOptions(page,metadataEditorInfo);loadExternalIds(page,item,metadataEditorInfo.ExternalIdInfos);Dashboard.populateLanguages($('#selectLanguage',page),languages);Dashboard.populateCountries($('#selectCountry',page),countries);LibraryBrowser.renderName(item,$('.itemName',page),true);updateTabs(page,item);setFieldVisibilities(page,item);fillItemInfo(page,item,metadataEditorInfo.ParentalRatingOptions);if(item.Type=="BoxSet"){$('#btnEditCollectionTitles',page).show();}else{$('#btnEditCollectionTitles',page).hide();}
if(item.MediaType=="Video"&&item.LocationType=="FileSystem"&&item.Type!=='TvChannel'){$('#btnEditSubtitles',page).show();}else{$('#btnEditSubtitles',page).hide();}
if(item.MediaType=='Photo'){$('#btnEditImages',page).hide();}else{$('#btnEditImages',page).show();}
if(item.MediaType=="Video"&&item.Type!="Episode"){$('#fldShortOverview',page).show();}else{$('#fldShortOverview',page).hide();}
if(item.MediaType=="Video"&&item.Type!="Episode"){$('#fldTagline',page).show();}else{$('#fldTagline',page).hide();}
Dashboard.getCurrentUser().done(function(user){var moreCommands=LibraryBrowser.getMoreCommands(item,user);if(moreCommands.indexOf('delete')!=-1){$('#fldDelete',page).show();}else{$('#fldDelete',page).hide();}
Dashboard.hideLoadingMsg();bindItemChanged(page);});});}
function renderContentTypeOptions(page,metadataInfo){if(metadataInfo.ContentTypeOptions.length){$('#fldContentType',page).show();}else{$('#fldContentType',page).hide();}
var html=metadataInfo.ContentTypeOptions.map(function(i){return'<option value="'+i.Value+'">'+i.Name+'</option>';}).join('');$('#selectContentType',page).html(html).val(metadataInfo.ContentType||'').selectmenu('refresh');}
function onExternalIdChange(){var formatString=this.getAttribute('data-formatstring');var buttonClass=this.getAttribute('data-buttonclass');if(this.value){$('.'+buttonClass).attr('href',formatString.replace('{0}',this.value));}else{$('.'+buttonClass).attr('href','#');}}
function loadExternalIds(page,item,externalIds){var html='';var providerIds=item.ProviderIds||{};for(var i=0,length=externalIds.length;i<length;i++){var idInfo=externalIds[i];var id="txt1"+idInfo.Key;var buttonId="btnOpen1"+idInfo.Key;var formatString=idInfo.UrlFormatString||'';html+='<div data-role="fieldcontain">';var idLabel=Globalize.translate('LabelDynamicExternalId').replace('{0}',idInfo.Name);html+='<label for="'+id+'">'+idLabel+'</label>';html+='<div style="display: inline-block; width: 80%;">';var value=providerIds[idInfo.Key]||'';html+='<input class="txtExternalId" value="'+value+'" data-providerkey="'+idInfo.Key+'" data-formatstring="'+formatString+'" data-buttonclass="'+buttonId+'" id="'+id+'" />';html+='</div>';if(formatString){html+='<a class="'+buttonId+'" href="#" target="_blank" data-icon="arrow-r" data-inline="true" data-iconpos="notext" data-role="button" style="float: none; width: 1.75em"></a>';}
html+='</div>';}
var elem=$('.externalIds',page).html(html).trigger('create');$('.txtExternalId',elem).on('change',onExternalIdChange).trigger('change');}
function setFieldVisibilities(page,item){if(item.Path&&item.LocationType!='Remote'){$('#fldPath',page).show();}else{$('#fldPath',page).hide();}
if(item.Type=="Series"){$('#fldSeriesRuntime',page).show();}else{$('#fldSeriesRuntime',page).hide();}
if(item.Type=="Series"||item.Type=="Person"){$('#fldEndDate',page).show();}else{$('#fldEndDate',page).hide();}
if(item.Type=="Movie"||item.MediaType=="Game"||item.MediaType=="Trailer"||item.Type=="MusicVideo"){$('#fldBudget',page).show();$('#fldRevenue',page).show();}else{$('#fldBudget',page).hide();$('#fldRevenue',page).hide();}
if(item.Type=="MusicAlbum"){$('#albumAssociationMessage',page).show();}else{$('#albumAssociationMessage',page).hide();}
if(item.MediaType=="Game"){$('#fldPlayers',page).show();}else{$('#fldPlayers',page).hide();}
if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="MusicVideo"||item.Type=="Series"||item.Type=="Game"){$('#fldCriticRating',page).show();$('#fldCriticRatingSummary',page).show();}else{$('#fldCriticRating',page).hide();$('#fldCriticRatingSummary',page).hide();}
if(item.Type=="Movie"){$('#fldAwardSummary',page).show();}else{$('#fldAwardSummary',page).hide();}
if(item.Type=="Movie"||item.Type=="Trailer"){$('#fldMetascore',page).show();}else{$('#fldMetascore',page).hide();}
if(item.Type=="Series"){$('#fldStatus',page).show();$('#fldAirDays',page).show();$('#fldAirTime',page).show();}else{$('#fldStatus',page).hide();$('#fldAirDays',page).hide();$('#fldAirTime',page).hide();}
if(item.MediaType=="Video"&&item.Type!="TvChannel"){$('#fld3dFormat',page).show();}else{$('#fld3dFormat',page).hide();}
if(item.Type=="Audio"){$('#fldAlbumArtist',page).show();}else{$('#fldAlbumArtist',page).hide();}
if(item.Type=="Audio"||item.Type=="MusicVideo"){$('#fldArtist',page).show();$('#fldAlbum',page).show();}else{$('#fldArtist',page).hide();$('#fldAlbum',page).hide();}
if(item.Type=="Episode"){$('#collapsibleDvdEpisodeInfo',page).show();}else{$('#collapsibleDvdEpisodeInfo',page).hide();}
if(item.Type=="Episode"&&item.ParentIndexNumber==0){$('#collapsibleSpecialEpisodeInfo',page).show();}else{$('#collapsibleSpecialEpisodeInfo',page).hide();}
if(item.Type=="Person"||item.Type=="Genre"||item.Type=="Studio"||item.Type=="GameGenre"||item.Type=="MusicGenre"||item.Type=="TvChannel"){$('#fldCommunityRating',page).hide();$('#fldCommunityVoteCount',page).hide();$('#genresCollapsible',page).hide();$('#peopleCollapsible',page).hide();$('#studiosCollapsible',page).hide();if(item.Type=="TvChannel"){$('#fldOfficialRating',page).show();}else{$('#fldOfficialRating',page).hide();}
$('#fldCustomRating',page).hide();}else{$('#fldCommunityRating',page).show();$('#fldCommunityVoteCount',page).show();$('#genresCollapsible',page).show();$('#peopleCollapsible',page).show();$('#studiosCollapsible',page).show();$('#fldOfficialRating',page).show();$('#fldCustomRating',page).show();}
if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="MusicArtist"){$('#countriesCollapsible',page).show();}else{$('#countriesCollapsible',page).hide();}
if(item.Type=="TvChannel"){$('#tagsCollapsible',page).hide();$('#metadataSettingsCollapsible',page).hide();$('#fldPremiereDate',page).hide();$('#fldSortName',page).hide();$('#fldDateAdded',page).hide();$('#fldYear',page).hide();}else{$('#tagsCollapsible',page).show();$('#metadataSettingsCollapsible',page).show();$('#fldPremiereDate',page).show();$('#fldSortName',page).show();$('#fldDateAdded',page).show();$('#fldYear',page).show();}
if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="Series"||item.Type=="Game"||item.Type=="BoxSet"||item.Type=="Person"||item.Type=="Book"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"){$('#btnIdentify',page).show();}else{$('#btnIdentify',page).hide();}
if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="BoxSet"){$('#keywordsCollapsible',page).show();}else{$('#keywordsCollapsible',page).hide();}
if(item.MediaType=="Video"&&item.Type!="TvChannel"){$('#fldSourceType',page).show();}else{$('#fldSourceType',page).hide();}
if(item.Type=="Person"){$('#lblPremiereDate',page).html(Globalize.translate('LabelBirthDate'));$('#lblYear',page).html(Globalize.translate('LabelBirthYear'));$('#lblEndDate',page).html(Globalize.translate('LabelDeathDate'));$('#fldPlaceOfBirth',page).show();}else{$('#lblPremiereDate',page).html(Globalize.translate('LabelReleaseDate'));$('#lblYear',page).html(Globalize.translate('LabelYear'));$('#lblEndDate',page).html(Globalize.translate('LabelEndDate'));$('#fldPlaceOfBirth',page).hide();}
if(item.MediaType=="Video"&&item.Type!="TvChannel"){$('#fldOriginalAspectRatio',page).show();}else{$('#fldOriginalAspectRatio',page).hide();}
if(item.Type=="Audio"||item.Type=="Episode"||item.Type=="Season"){$('#fldIndexNumber',page).show();if(item.Type=="Episode"){$('#lblIndexNumber',page).html(Globalize.translate('LabelEpisodeNumber'));}else if(item.Type=="Season"){$('#lblIndexNumber',page).html(Globalize.translate('LabelSeasonNumber'));}else if(item.Type=="Audio"){$('#lblIndexNumber',page).html(Globalize.translate('LabelTrackNumber'));}else{$('#lblIndexNumber',page).html(Globalize.translate('LabelNumber'));}}else{$('#fldIndexNumber',page).hide();}
if(item.Type=="Audio"||item.Type=="Episode"){$('#fldParentIndexNumber',page).show();if(item.Type=="Episode"){$('#lblParentIndexNumber',page).html(Globalize.translate('LabelSeasonNumber'));}else if(item.Type=="Audio"){$('#lblParentIndexNumber',page).html(Globalize.translate('LabelDiscNumber'));}else{$('#lblParentIndexNumber',page).html(Globalize.translate('LabelParentNumber'));}}else{$('#fldParentIndexNumber',page).hide();}
if(item.Type=="Series"){$('#fldDisplaySpecialsInline',page).show();}else{$('#fldDisplaySpecialsInline',page).hide();}
if(item.Type=="BoxSet"){$('#fldDisplayOrder',page).show();$('#labelDisplayOrder',page).html(Globalize.translate('LabelTitleDisplayOrder'));$('#selectDisplayOrder',page).html('<option value="SortName">'+Globalize.translate('OptionSortName')+'</option><option value="PremiereDate">'+Globalize.translate('OptionReleaseDate')+'</option>').selectmenu('refresh');}else{$('#selectDisplayOrder',page).html('').selectmenu('refresh');$('#fldDisplayOrder',page).hide();}
var displaySettingFields=$('.fldDisplaySetting',page);if(displaySettingFields.filter(function(index){return displaySettingFields[index].style.display!='none';}).length){$('#collapsibleDisplaySettings',page).show();}else{$('#collapsibleDisplaySettings',page).hide();}}
function fillItemInfo(page,item,parentalRatingOptions){var select=$('#selectOfficialRating',page);populateRatings(parentalRatingOptions,select,item.OfficialRating);select.val(item.OfficialRating||"").selectmenu('refresh');select=$('#selectCustomRating',page);populateRatings(parentalRatingOptions,select,item.CustomRating);select.val(item.CustomRating||"").selectmenu('refresh');var selectStatus=$('#selectStatus',page);populateStatus(selectStatus);selectStatus.val(item.Status||"").selectmenu('refresh');$('#select3dFormat',page).val(item.Video3DFormat||"").selectmenu('refresh');$('.chkAirDay',page).each(function(){this.checked=(item.AirDays||[]).indexOf(this.getAttribute('data-day'))!=-1;}).checkboxradio('refresh');populateListView($('#listCountries',page),item.ProductionLocations||[]);populateListView($('#listGenres',page),item.Genres);populatePeople(page,item.People||[]);populateListView($('#listStudios',page),(item.Studios||[]).map(function(element){return element.Name||'';}));populateListView($('#listTags',page),item.Tags);populateListView($('#listKeywords',page),item.Keywords);var lockData=(item.LockData||false);var chkLockData=$("#chkLockData",page).attr('checked',lockData).checkboxradio('refresh');if(chkLockData.checked()){$('#providerSettingsContainer',page).hide();}else{$('#providerSettingsContainer',page).show();}
populateInternetProviderSettings(page,item,item.LockedFields);$("#chkDisplaySpecialsInline",page).checked(item.DisplaySpecialsWithSeasons||false).checkboxradio('refresh');$('#txtPath',page).val(item.Path||'');$('#txtName',page).val(item.Name||"");$('#txtOverview',page).val(item.Overview||"");$('#txtShortOverview',page).val(item.ShortOverview||"");$('#txtTagline',page).val((item.Taglines&&item.Taglines.length?item.Taglines[0]:''));$('#txtSortName',page).val(item.ForcedSortName||"");$('#txtDisplayMediaType',page).val(item.DisplayMediaType||"");$('#txtCommunityRating',page).val(item.CommunityRating||"");$('#txtCommunityVoteCount',page).val(item.VoteCount||"");$('#txtHomePageUrl',page).val(item.HomePageUrl||"");$('#txtAwardSummary',page).val(item.AwardSummary||"");$('#txtMetascore',page).val(item.Metascore||"");$('#txtBudget',page).val(item.Budget||"");$('#txtRevenue',page).val(item.Revenue||"");$('#txtCriticRating',page).val(item.CriticRating||"");$('#txtCriticRatingSummary',page).val(item.CriticRatingSummary||"");$('#txtIndexNumber',page).val(('IndexNumber'in item)?item.IndexNumber:"");$('#txtParentIndexNumber',page).val(('ParentIndexNumber'in item)?item.ParentIndexNumber:"");$('#txtPlayers',page).val(item.Players||"");$('#txtAbsoluteEpisodeNumber',page).val(('AbsoluteEpisodeNumber'in item)?item.AbsoluteEpisodeNumber:"");$('#txtDvdEpisodeNumber',page).val(('DvdEpisodeNumber'in item)?item.DvdEpisodeNumber:"");$('#txtDvdSeasonNumber',page).val(('DvdSeasonNumber'in item)?item.DvdSeasonNumber:"");$('#txtAirsBeforeSeason',page).val(('AirsBeforeSeasonNumber'in item)?item.AirsBeforeSeasonNumber:"");$('#txtAirsAfterSeason',page).val(('AirsAfterSeasonNumber'in item)?item.AirsAfterSeasonNumber:"");$('#txtAirsBeforeEpisode',page).val(('AirsBeforeEpisodeNumber'in item)?item.AirsBeforeEpisodeNumber:"");$('#txtAlbum',page).val(item.Album||"");$('#txtAlbumArtist',page).val((item.AlbumArtists||[]).map(function(a){return a.Name;}).join(';'));$('#selectDisplayOrder',page).val(item.DisplayOrder).selectmenu('refresh');$('#txtArtist',page).val((item.ArtistItems||[]).map(function(a){return a.Name;}).join(';'));var date;if(item.DateCreated){try{date=parseISO8601Date(item.DateCreated,{toLocal:true});$('#txtDateAdded',page).val(date.toISOString().slice(0,10));}catch(e){$('#txtDateAdded',page).val('');}}else{$('#txtDateAdded',page).val('');}
if(item.PremiereDate){try{date=parseISO8601Date(item.PremiereDate,{toLocal:true});$('#txtPremiereDate',page).val(date.toISOString().slice(0,10));}catch(e){$('#txtPremiereDate',page).val('');}}else{$('#txtPremiereDate',page).val('');}
if(item.EndDate){try{date=parseISO8601Date(item.EndDate,{toLocal:true});$('#txtEndDate',page).val(date.toISOString().slice(0,10));}catch(e){$('#txtEndDate',page).val('');}}else{$('#txtEndDate',page).val('');}
$('#txtProductionYear',page).val(item.ProductionYear||"");$('#txtAirTime',page).val(item.AirTime||"");var placeofBirth=item.ProductionLocations&&item.ProductionLocations.length?item.ProductionLocations[0]:'';$('#txtPlaceOfBirth',page).val(placeofBirth);$('#txtOriginalAspectRatio',page).val(item.AspectRatio||"");$('#selectLanguage',page).val(item.PreferredMetadataLanguage||"").selectmenu('refresh');$('#selectCountry',page).val(item.PreferredMetadataCountryCode||"").selectmenu('refresh');if(item.RunTimeTicks){var minutes=item.RunTimeTicks/600000000;$('#txtSeriesRuntime',page).val(Math.round(minutes));}else{$('#txtSeriesRuntime',page).val("");}}
function populatePeople(page,people){var lastType='';var html='';var elem=$('#peopleList',page);for(var i=0,length=people.length;i<length;i++){var person=people[i];var type=person.Type||Globalize.translate('PersonTypePerson');if(type!=lastType){html+='<li data-role="list-divider">'+type+'</li>';lastType=type;}
html+='<li><a class="btnEditPerson" href="#" data-index="'+i+'">';html+='<h3>'+(person.Name||'')+'</h3>';if(person.Role&&person.Role!=lastType){html+='<p>'+(person.Role)+'</p>';}
html+='</a>';html+='<a class="btnDeletePerson" href="#" data-icon="delete" data-index="'+i+'">'+Globalize.translate('Delete')+'</a>';html+='</li>';}
elem.html(html).listview('refresh');$('.btnDeletePerson',elem).on('click',function(){var index=parseInt(this.getAttribute('data-index'));currentItem.People.splice(index,1);populatePeople(page,currentItem.People);});$('.btnEditPerson',elem).on('click',function(){var index=parseInt(this.getAttribute('data-index'));editPerson(page,currentItem.People[index],index);});}
function editPerson(page,person,index){$('#popupEditPerson',page).popup("open");$('#txtPersonName',page).val(person.Name||'');$('#selectPersonType',page).val(person.Type||'').selectmenu('refresh');$('#txtPersonRole',page).val(person.Role||'');if(index==null){index='';}
$("#fldPersonIndex",page).val(index);}
function savePersonInfo(page){$('#popupEditPerson',page).popup("close");var index=$("#fldPersonIndex",page).val();var person;var isNew=true;if(index){isNew=false;index=parseInt(index);person=currentItem.People[index];}else{person={};}
person.Name=$('#txtPersonName',page).val();person.Type=$('#selectPersonType',page).val();person.Role=$('#txtPersonRole',page).val();if(isNew){currentItem.People.push(person);}
populatePeople(page,currentItem.People);}
function populateRatings(allParentalRatings,select,currentValue){var html="";html+="<option value=''></option>";var ratings=[];var i,length,rating;var currentValueFound=false;for(i=0,length=allParentalRatings.length;i<length;i++){rating=allParentalRatings[i];ratings.push({Name:rating.Name,Value:rating.Name});if(rating.Name==currentValue){currentValueFound=true;}}
if(currentValue&&!currentValueFound){ratings.push({Name:currentValue,Value:currentValue});}
for(i=0,length=ratings.length;i<length;i++){rating=ratings[i];html+="<option value='"+rating.Value+"'>"+rating.Name+"</option>";}
select.html(html).selectmenu("refresh");}
function populateStatus(select){var html="";html+="<option value=''></option>";html+="<option value='Continuing'>"+Globalize.translate('OptionContinuing')+"</option>";html+="<option value='Ended'>"+Globalize.translate('OptionEnded')+"</option>";select.html(html).selectmenu("refresh");}
function populateListView(list,items,sortCallback){items=items||[];if(typeof(sortCallback)==='undefined'){items.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase());});}else{items=sortCallback(items);}
var html='';for(var i=0;i<items.length;i++){html+='<li data-mini="true"><a class="data">'+items[i]+'</a><a href="#" onclick="EditItemMetadataPage.removeElementFromListview(this)" class="btnRemoveFromEditorList"></a></li>';}
list.html(html).listview('refresh');}
function editableListViewValues(list){return list.find('a.data').map(function(){return $(this).text();}).get();}
function generateSliders(fields,type){var html='';for(var i=0;i<fields.length;i++){var field=fields[i];var name=field.name;var value=field.value||field.name;html+='<div data-role="fieldcontain">';html+='<label for="lock'+value+'">'+name+'</label>';html+='<select class="selectLockedField" id="lock'+value+'" data-role="slider" data-mini="true">';html+='<option value="'+value+'">'+Globalize.translate('OptionOff')+'</option>';html+='<option value="" selected="selected">'+Globalize.translate('OptionOn')+'</option>';html+='</select>';html+='</div>';}
return html;}
function populateInternetProviderSettings(page,item,lockedFields){var container=$('#providerSettingsContainer',page);lockedFields=lockedFields||new Array();var metadatafields=[{name:Globalize.translate('OptionName'),value:"Name"},{name:Globalize.translate('OptionOverview'),value:"Overview"},{name:Globalize.translate('OptionGenres'),value:"Genres"},{name:Globalize.translate('OptionParentalRating'),value:"OfficialRating"},{name:Globalize.translate('OptionPeople'),value:"Cast"}];if(item.Type=="Person"){metadatafields.push({name:Globalize.translate('OptionBirthLocation'),value:"ProductionLocations"});}else{metadatafields.push({name:Globalize.translate('OptionProductionLocations'),value:"ProductionLocations"});}
if(item.Type=="Series"){metadatafields.push({name:Globalize.translate('OptionRuntime'),value:"Runtime"});}
metadatafields.push({name:Globalize.translate('OptionStudios'),value:"Studios"});metadatafields.push({name:Globalize.translate('OptionTags'),value:"Tags"});metadatafields.push({name:Globalize.translate('OptionKeywords'),value:"Keywords"});metadatafields.push({name:Globalize.translate('OptionImages'),value:"Images"});metadatafields.push({name:Globalize.translate('OptionBackdrops'),value:"Backdrops"});if(item.Type=="Game"){metadatafields.push({name:Globalize.translate('OptionScreenshots'),value:"Screenshots"});}
var html='';html+="<h1>"+Globalize.translate('HeaderFields')+"</h1>";html+="<p>"+Globalize.translate('HeaderFieldsHelp')+"</p>";html+=generateSliders(metadatafields,'Fields');container.html(html).trigger('create');for(var fieldIndex=0;fieldIndex<lockedFields.length;fieldIndex++){var field=lockedFields[fieldIndex];$('#lock'+field).val(field).slider('refresh');}}
function getSelectedAirDays(form){return $('.chkAirDay:checked',form).map(function(){return this.getAttribute('data-day');}).get();}
function onDeleted(id){var elem=$('#'+id)[0];$('.libraryTree').jstree("select_node",elem,true).jstree("delete_node",'#'+id);}
function getAlbumArtists(form){return $('#txtAlbumArtist',form).val().split(';').map(function(a){return{Name:a};});}
function getArtists(form){return $('#txtArtist',form).val().split(';').map(function(a){return{Name:a};});}
function editItemMetadataPage(){var self=this;self.onSubmit=function(){var form=this;var item={Id:currentItem.Id,Name:$('#txtName',form).val(),ForcedSortName:$('#txtSortName',form).val(),DisplayMediaType:$('#txtDisplayMediaType',form).val(),CommunityRating:$('#txtCommunityRating',form).val(),VoteCount:$('#txtCommunityVoteCount',form).val(),HomePageUrl:$('#txtHomePageUrl',form).val(),Budget:$('#txtBudget',form).val(),Revenue:$('#txtRevenue',form).val(),CriticRating:$('#txtCriticRating',form).val(),CriticRatingSummary:$('#txtCriticRatingSummary',form).val(),IndexNumber:$('#txtIndexNumber',form).val()||null,DisplaySpecialsWithSeasons:$('#chkDisplaySpecialsInline',form).checked(),AbsoluteEpisodeNumber:$('#txtAbsoluteEpisodeNumber',form).val(),DvdEpisodeNumber:$('#txtDvdEpisodeNumber',form).val(),DvdSeasonNumber:$('#txtDvdSeasonNumber',form).val(),AirsBeforeSeasonNumber:$('#txtAirsBeforeSeason',form).val(),AirsAfterSeasonNumber:$('#txtAirsAfterSeason',form).val(),AirsBeforeEpisodeNumber:$('#txtAirsBeforeEpisode',form).val(),ParentIndexNumber:$('#txtParentIndexNumber',form).val()||null,DisplayOrder:$('#selectDisplayOrder',form).val(),Players:$('#txtPlayers',form).val(),Album:$('#txtAlbum',form).val(),AlbumArtist:getAlbumArtists(form),ArtistItems:getArtists(form),Metascore:$('#txtMetascore',form).val(),AwardSummary:$('#txtAwardSummary',form).val(),Overview:$('#txtOverview',form).val(),ShortOverview:$('#txtShortOverview',form).val(),Status:$('#selectStatus',form).val(),AirDays:getSelectedAirDays(form),AirTime:$('#txtAirTime',form).val(),Genres:editableListViewValues($("#listGenres",form)),ProductionLocations:editableListViewValues($("#listCountries",form)),Tags:editableListViewValues($("#listTags",form)),Keywords:editableListViewValues($("#listKeywords",form)),Studios:editableListViewValues($("#listStudios",form)).map(function(element){return{Name:element};}),PremiereDate:EditItemMetadataPage.getDateFromForm(form,'#txtPremiereDate','PremiereDate'),DateCreated:EditItemMetadataPage.getDateFromForm(form,'#txtDateAdded','DateCreated'),EndDate:EditItemMetadataPage.getDateFromForm(form,'#txtEndDate','EndDate'),ProductionYear:$('#txtProductionYear',form).val(),AspectRatio:$('#txtOriginalAspectRatio',form).val(),Video3DFormat:$('#select3dFormat',form).val(),OfficialRating:$('#selectOfficialRating',form).val(),CustomRating:$('#selectCustomRating',form).val(),People:currentItem.People,LockData:$("#chkLockData",form).prop('checked'),LockedFields:$('.selectLockedField',form).map(function(){var value=$(this).val();if(value!='')return value;}).get()};item.ProviderIds=$.extend({},currentItem.ProviderIds||{});$('.txtExternalId',form).each(function(){var providerkey=this.getAttribute('data-providerkey');item.ProviderIds[providerkey]=this.value;});item.PreferredMetadataLanguage=$('#selectLanguage',form).val();item.PreferredMetadataCountryCode=$('#selectCountry',form).val();if(currentItem.Type=="Person"){var placeOfBirth=$('#txtPlaceOfBirth',form).val();item.ProductionLocations=placeOfBirth?[placeOfBirth]:[];}
if(currentItem.Type=="Series"){var seriesRuntime=$('#txtSeriesRuntime',form).val();item.RunTimeTicks=seriesRuntime?(seriesRuntime*600000000):null;}
var tagline=$('#txtTagline',form).val();item.Taglines=tagline?[tagline]:[];self.submitUpdatedItem(form,item);return false;};self.submitUpdatedItem=function(form,item){var page=$(form).parents('.page');unbindItemChanged(page);function afterContentTypeUpdated(){Dashboard.alert(Globalize.translate('MessageItemSaved'));MetadataEditor.getItemPromise().done(function(i){page.trigger('itemsaved',[i]);bindItemChanged(page);});}
ApiClient.updateItem(item).done(function(){var newContentType=$('#selectContentType',form).val()||'';if((metadataEditorInfo.ContentType||'')!=newContentType){ApiClient.ajax({url:ApiClient.getUrl('Items/'+item.Id+'/ContentType',{ContentType:newContentType}),type:'POST'}).done(function(){afterContentTypeUpdated();});}else{afterContentTypeUpdated();}});};self.getDateFromForm=function(form,element,property){var val=$(element,form).val();if(!val){return null;}
if(currentItem[property]){var date=parseISO8601Date(currentItem[property],{toLocal:true});var parts=date.toISOString().split('T');if(parts[0].indexOf(val)==0){var iso=parts[1];val+='T'+iso;}}
return val;};self.addElementToEditableListview=function(source,sortCallback){var parent=$(source).parents('*[data-role="editableListviewContainer"]');var input=parent.find('.txtEditableListview, select');var text=input.val();if(text=='')return;var list=parent.find('ul[data-role="listview"]');var items=editableListViewValues(list);items.push(text);populateListView(list,items,sortCallback);};self.setProviderSettingsContainerVisibility=function(source){if(!$(source).prop('checked')){$('#providerSettingsContainer').show();}else{$('#providerSettingsContainer').hide();}};self.removeElementFromListview=function(source){var list=$(source).parents('ul[data-role="listview"]');$(source).parent().remove();list.listview('refresh');};self.onIdentificationFormSubmitted=function(){var page=$(this).parents('.page');searchForIdentificationResults(page);return false;};self.onRefreshFormSubmit=function(){var page=$(this).parents('.page');refreshFromPopupOptions(page);return false;};self.onPersonInfoFormSubmit=function(){var page=$(this).parents('.page');savePersonInfo(page);return false;};self.onIdentificationOptionsSubmit=function(){var page=$(this).parents('.page');submitIdentficationResult(page);return false;};}
window.EditItemMetadataPage=new editItemMetadataPage();function showIdentificationForm(page){var item=currentItem;ApiClient.getJSON(ApiClient.getUrl("Items/"+item.Id+"/ExternalIdInfos")).done(function(idList){var html='';var providerIds=item.ProviderIds||{};for(var i=0,length=idList.length;i<length;i++){var idInfo=idList[i];var id="txtLookup"+idInfo.Key;html+='<div data-role="fieldcontain">';var idLabel=Globalize.translate('LabelDynamicExternalId').replace('{0}',idInfo.Name);html+='<label for="'+id+'">'+idLabel+'</label>';var value=providerIds[idInfo.Key]||'';html+='<input class="txtLookupId" value="'+value+'" data-providerkey="'+idInfo.Key+'" id="'+id+'" data-mini="true" />';html+='</div>';}
$('#txtLookupName',page).val(item.Name);if(item.Type=="Person"||item.Type=="BoxSet"){$('.fldLookupYear',page).hide();$('#txtLookupYear',page).val('');}else{$('.fldLookupYear',page).show();$('#txtLookupYear',page).val(item.ProductionYear);}
$('.identifyProviderIds',page).html(html).trigger('create');$('.identificationHeader',page).html(Globalize.translate('HeaderIdentify'));$('.popupIdentifyForm',page).show();$('.identificationSearchResults',page).hide();$('.identifyOptionsForm',page).hide();$('.btnIdentifyBack',page).hide();$('.popupIdentify',page).popup('open');});}
function searchForIdentificationResults(page){var lookupInfo={ProviderIds:{}};$('.identifyField',page).each(function(){var value=this.value;if(value){if(this.type=='number'){value=parseInt(value);}
lookupInfo[this.getAttribute('data-lookup')]=value;}});var hasId=false;$('.txtLookupId',page).each(function(){var value=this.value;if(value){hasId=true;}
lookupInfo.ProviderIds[this.getAttribute('data-providerkey')]=value;});if(!hasId&&!lookupInfo.Name){Dashboard.alert(Globalize.translate('MessagePleaseEnterNameOrId'));return;}
if(currentItem.GameSystem){lookupInfo.GameSystem=currentItem.GameSystem;}
lookupInfo={SearchInfo:lookupInfo,IncludeDisabledProviders:true};Dashboard.showLoadingMsg();ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Items/RemoteSearch/"+currentItem.Type),data:JSON.stringify(lookupInfo),contentType:"application/json"}).done(function(results){Dashboard.hideLoadingMsg();showIdentificationSearchResults(page,results);});}
function getSearchImageDisplayUrl(url,provider){return ApiClient.getUrl("Items/RemoteSearch/Image",{imageUrl:url,ProviderName:provider});}
function getSearchResultHtml(result,index){var html='';var cssClass="searchImageContainer remoteImageContainer";if(currentItem.Type=="Episode"){cssClass+=" searchBackdropImageContainer";}
else if(currentItem.Type=="MusicAlbum"||currentItem.Type=="MusicArtist"){cssClass+=" searchDiscImageContainer";}
else{cssClass+=" searchPosterImageContainer";}
html+='<div class="'+cssClass+'">';if(result.ImageUrl){var displayUrl=getSearchImageDisplayUrl(result.ImageUrl,result.SearchProviderName);html+='<a href="#" class="searchImage" data-index="'+index+'" style="background-image:url(\''+displayUrl+'\');">';}else{html+='<a href="#" class="searchImage" data-index="'+index+'" style="background-image:url(\'css/images/items/list/remotesearch.png\');background-position: center center;">';}
html+='</a>';html+='<div class="remoteImageDetails">';html+=result.Name;html+='</div>';html+='<div class="remoteImageDetails">';html+=result.ProductionYear||'&nbsp;';html+='</div>';if(result.GameSystem){html+='<div class="remoteImageDetails">';html+=result.GameSystem;html+='</div>';}
html+='</div>';return html;}
function showIdentificationSearchResults(page,results){$('.popupIdentifyForm',page).hide();$('.identificationSearchResults',page).show();$('.identifyOptionsForm',page).hide();$('.btnIdentifyBack',page).show();var html='';for(var i=0,length=results.length;i<length;i++){var result=results[i];html+=getSearchResultHtml(result,i);}
var elem=$('.identificationSearchResultList',page).html(html).trigger('create');$('.searchImage',elem).on('click',function(){var index=parseInt(this.getAttribute('data-index'));var currentResult=results[index];showIdentifyOptions(page,currentResult);});}
function showIdentifyOptions(page,identifyResult){$('.popupIdentifyForm',page).hide();$('.identificationSearchResults',page).hide();$('.identifyOptionsForm',page).show();$('.btnIdentifyBack',page).show();$('#chkIdentifyReplaceImages',page).checked(true).checkboxradio('refresh');currentSearchResult=identifyResult;var lines=[];lines.push(identifyResult.Name);if(identifyResult.ProductionYear){lines.push(identifyResult.ProductionYear);}
if(identifyResult.GameSystem){lines.push(identifyResult.GameSystem);}
var resultHtml=lines.join('<br/>');if(identifyResult.ImageUrl){var displayUrl=getSearchImageDisplayUrl(identifyResult.ImageUrl,identifyResult.SearchProviderName);resultHtml='<img src="'+displayUrl+'" style="max-height:160px;" /><br/>'+resultHtml;}
$('.selectedSearchResult',page).html(resultHtml);}
function submitIdentficationResult(page){Dashboard.showLoadingMsg();var options={ReplaceAllImages:$('#chkIdentifyReplaceImages',page).checked()};ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Items/RemoteSearch/Apply/"+currentItem.Id,options),data:JSON.stringify(currentSearchResult),contentType:"application/json"}).done(function(){Dashboard.hideLoadingMsg();$('.popupIdentify',page).popup('close');reload(page);});}
function performAdvancedRefresh(page){$('.popupAdvancedRefresh',page).popup('open');$('#selectMetadataRefreshMode',page).val('all').selectmenu('refresh');$('#selectImageRefreshMode',page).val('missing').selectmenu('refresh');}
function performSimpleRefresh(page){refreshWithOptions(page,{Recursive:true,ImageRefreshMode:'FullRefresh',MetadataRefreshMode:'FullRefresh',ReplaceAllMetadata:true});}
function refreshFromPopupOptions(page){var metadataRefreshMode=$('#selectMetadataRefreshMode',page).val();var imageRefreshMode=$('#selectImageRefreshMode',page).val();refreshWithOptions(page,{Recursive:true,ImageRefreshMode:imageRefreshMode=='none'?'None':'FullRefresh',MetadataRefreshMode:metadataRefreshMode=='none'?'None':(metadataRefreshMode=='local'?'ValidationOnly':'FullRefresh'),ReplaceAllImages:imageRefreshMode=='all',ReplaceAllMetadata:metadataRefreshMode=='all'});$('.popupAdvancedRefresh',page).popup('close');}
function refreshWithOptions(page,options){$('#refreshLoading',page).show();ApiClient.refreshItem(currentItem.Id,options);}
function onWebSocketMessageReceived(e,data){var msg=data;if(msg.MessageType==="LibraryChanged"){if(msg.Data.ItemsUpdated.indexOf(currentItem.Id)!=-1){var page=$.mobile.activePage;console.log('Item updated - reloading metadata');reload(page);$('#refreshLoading',page).hide();}}}
function bindItemChanged(page){$(ApiClient).on("websocketmessage",onWebSocketMessageReceived);}
function unbindItemChanged(page){$(ApiClient).off("websocketmessage",onWebSocketMessageReceived);}
$(document).on('pageinit',"#editItemMetadataPage",function(){var page=this;$('.btnRefreshAdvanced',this).on('click',function(){performAdvancedRefresh(page);});$('.btnSimpleRefresh',this).on('click',function(){performSimpleRefresh(page);});$('#btnIdentify',page).on('click',function(){showIdentificationForm(page);});$('.btnIdentifyBack',page).on('click',function(){if($('.identifyOptionsForm',page).is(':visible')){$('.identifyOptionsForm',page).hide();$('.identificationSearchResults',page).show();$('.popupIdentifyForm',page).hide();}else{$('.identificationSearchResults',page).hide();$('.popupIdentifyForm',page).show();$(this).hide();}});$('#btnDelete',this).on('click',function(){LibraryBrowser.deleteItem(currentItem.Id);});$('.libraryTree',page).on('itemclicked',function(event,data){if(data.id!=currentItem.Id){MetadataEditor.currentItemId=data.id;MetadataEditor.currentItemType=data.itemType;window.location.hash='editItemMetadataPage?id='+data.id;reload(page);}});$("#btnAddPerson",page).on('click',function(event,data){editPerson(page,{});});}).on('pagebeforeshow',"#editItemMetadataPage",function(){var page=this;reload(page);$(LibraryBrowser).on('itemdeleting.editor',function(e,itemId){if(currentItem&&currentItem.Id==itemId){if(currentItem.ParentId){Dashboard.navigate('edititemmetadata.html?id='+currentItem.ParentId);}else{Dashboard.navigate('edititemmetadata.html');}}});}).on('pagehide',"#editItemMetadataPage",function(){var page=this;$(LibraryBrowser).off('itemdeleting.editor');unbindItemChanged(page);});})(jQuery,document,window);(function($,document,window,FileReader,escape){var currentItem;var currentFile;var browsableImagePageSize=10;var browsableImageStartIndex=0;var browsableImageType='Primary';var selectedProvider;function updateTabs(page,item){var query=MetadataEditor.getEditQueryString(item);$('#btnEditMetadata',page).attr('href','edititemmetadata.html?'+query);$('#btnEditSubtitles',page).attr('href','edititemsubtitles.html?'+query);$('#btnEditCollectionTitles',page).attr('href','editcollectionitems.html?'+query);}
function getBaseRemoteOptions(){var options={};options.itemId=currentItem.Id;return options;}
function reloadBrowsableImages(page){Dashboard.showLoadingMsg();var options=getBaseRemoteOptions();options.type=browsableImageType;options.startIndex=browsableImageStartIndex;options.limit=browsableImagePageSize;options.IncludeAllLanguages=$('#chkAllLanguages',page).checked();var provider=selectedProvider||'';if(provider){options.ProviderName=provider;}
ApiClient.getAvailableRemoteImages(options).done(function(result){renderRemoteImages(page,currentItem,result,browsableImageType,options.startIndex,options.limit);$('#selectBrowsableImageType',page).val(browsableImageType).selectmenu('refresh');var providersHtml=result.Providers.map(function(p){return'<option value="'+p+'">'+p+'</option>';});$('#selectImageProvider',page).html('<option value="">'+Globalize.translate('LabelAll')+'</option>'+providersHtml).val(provider).selectmenu('refresh');Dashboard.hideLoadingMsg();});}
function renderRemoteImages(page,item,imagesResult,imageType,startIndex,limit){$('.availableImagesPaging',page).html(getPagingHtml(startIndex,limit,imagesResult.TotalRecordCount)).trigger('create');var html='';for(var i=0,length=imagesResult.Images.length;i<length;i++){html+=getRemoteImageHtml(imagesResult.Images[i],imageType);}
$('.availableImagesList',page).html(html).trigger('create');$('.btnNextPage',page).on('click',function(){browsableImageStartIndex+=browsableImagePageSize;reloadBrowsableImages(page);});$('.btnPreviousPage',page).on('click',function(){browsableImageStartIndex-=browsableImagePageSize;reloadBrowsableImages(page);});$('.btnDownloadRemoteImage',page).on('click',function(){downloadRemoteImage(page,this.getAttribute('data-imageurl'),this.getAttribute('data-imagetype'),this.getAttribute('data-imageprovider'));});}
function downloadRemoteImage(page,url,type,provider){var options=getBaseRemoteOptions();options.Type=type;options.ImageUrl=url;options.ProviderName=provider;Dashboard.showLoadingMsg();ApiClient.downloadRemoteImage(options).done(function(){$('.popupDownload',page).popup("close");reload(page);});}
function getDisplayUrl(url){return ApiClient.getUrl("Images/Remote",{imageUrl:url});}
function getRemoteImageHtml(image,imageType){var html='';html+='<div class="remoteImageContainer">';var cssClass="remoteImage";if(imageType=="Backdrop"||imageType=="Art"||imageType=="Thumb"||imageType=="Logo"){cssClass+=" remoteBackdropImage";}
else if(imageType=="Banner"){cssClass+=" remoteBannerImage";}
else if(imageType=="Disc"){cssClass+=" remoteDiscImage";}
else{if(currentItem.Type=="Episode"){cssClass+=" remoteBackdropImage";}
else if(currentItem.Type=="MusicAlbum"||currentItem.Type=="MusicArtist"){cssClass+=" remoteDiscImage";}
else{cssClass+=" remotePosterImage";}}
var displayUrl=getDisplayUrl(image.ThumbnailUrl||image.Url);html+='<a target="_blank" href="'+getDisplayUrl(image.Url)+'" class="'+cssClass+'" style="background-image:url(\''+displayUrl+'\');">';html+='</a>';html+='<div class="remoteImageDetails">';html+=image.ProviderName;html+='</div>';if(image.Width||image.Height||image.Language){html+='<div class="remoteImageDetails">';if(image.Width||image.Height){html+=image.Width+' x '+image.Height;if(image.Language){html+='  '+image.Language;}}else{if(image.Language){html+=image.Language;}}
html+='</div>';}
if(image.CommunityRating!=null){html+='<div class="remoteImageDetails">';if(image.RatingType=="Likes"){html+=image.CommunityRating+(image.CommunityRating==1?" like":" likes");}else{if(image.CommunityRating){html+=image.CommunityRating.toFixed(1);if(image.VoteCount){html+='  '+image.VoteCount+(image.VoteCount==1?" vote":" votes");}}else{html+="Unrated";}}
html+='</div>';}
html+='<div><button class="btnDownloadRemoteImage" data-imageprovider="'+image.ProviderName+'" data-imageurl="'+image.Url+'" data-imagetype="'+image.Type+'" type="button" data-icon="arrow-d" data-mini="true">'+Globalize.translate('ButtonDownload')+'</button></div>';html+='</div>';return html;}
function getPagingHtml(startIndex,limit,totalRecordCount){var html='';var recordsEnd=Math.min(startIndex+limit,totalRecordCount);var showControls=totalRecordCount>limit;html+='<div class="listPaging">';html+='<span style="margin-right: 10px;">';var startAtDisplay=totalRecordCount?startIndex+1:0;html+=startAtDisplay+'-'+recordsEnd+' of '+totalRecordCount;html+='</span>';if(showControls){html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">';html+='<button data-icon="arrow-l" data-iconpos="notext" data-inline="true" data-mini="true" class="btnPreviousPage" '+(startIndex?'':'disabled')+'>'+Globalize.translate('ButtonPreviousPage')+'</button>';html+='<button data-icon="arrow-r" data-iconpos="notext" data-inline="true" data-mini="true" class="btnNextPage" '+(startIndex+limit>totalRecordCount?'disabled':'')+'>'+Globalize.translate('ButtonNextPage')+'</button>';html+='</div>';}
html+='</div>';return html;}
function reload(page){Dashboard.showLoadingMsg();browsableImageStartIndex=0;browsableImageType='Primary';selectedProvider=null;MetadataEditor.getItemPromise().done(function(item){currentItem=item;LibraryBrowser.renderName(item,$('.itemName',page),true);updateTabs(page,item);if(item.Type=="BoxSet"){$('#btnEditCollectionTitles',page).show();}else{$('#btnEditCollectionTitles',page).hide();}
if(item.MediaType=="Video"&&item.LocationType=="FileSystem"&&item.Type!=='TvChannel'){$('#btnEditSubtitles',page).show();}else{$('#btnEditSubtitles',page).hide();}
ApiClient.getRemoteImageProviders(getBaseRemoteOptions()).done(function(providers){if(providers.length){$('.lnkBrowseAllImages',page).removeClass('hide');}else{$('.lnkBrowseAllImages',page).addClass('hide');}
ApiClient.getItemImageInfos(currentItem.Id).done(function(imageInfos){renderStandardImages(page,item,imageInfos,providers);renderBackdrops(page,item,imageInfos,providers);renderScreenshots(page,item,imageInfos,providers);Dashboard.hideLoadingMsg();});});});}
function renderImages(page,item,images,imageProviders,elem){var html='';for(var i=0,length=images.length;i<length;i++){var image=images[i];html+='<div class="editorTile imageEditorTile">';html+='<div style="height:144px;vertical-align:top;background-repeat:no-repeat;background-size:contain;background-image:url(\''+LibraryBrowser.getImageUrl(currentItem,image.ImageType,image.ImageIndex,{height:144})+'\');"></div>';html+='<div>';if(image.ImageType!=="Backdrop"&&image.ImageType!=="Screenshot"){html+='<p>'+image.ImageType+'</p>';}
html+='<p>'+image.Width+' X '+image.Height+'</p>';html+='<p>';if(image.ImageType=="Backdrop"||image.ImageType=="Screenshot"){if(i>0){html+='<button type="button" data-icon="arrow-l" data-mini="true" data-inline="true" data-iconpos="notext" onclick="EditItemImagesPage.moveImage(\''+image.ImageType+'\', '+image.ImageIndex+', '+(i-1)+');" style="margin-bottom:0;">'+Globalize.translate('ButtonMoveLeft')+'</button>';}else{html+='<button type="button" data-icon="arrow-l" data-mini="true" data-inline="true" data-iconpos="notext" style="margin-bottom:0;" disabled>'+Globalize.translate('ButtonMoveLeft')+'</button>';}
if(i<length-1){html+='<button type="button" data-icon="arrow-r" data-mini="true" data-inline="true" data-iconpos="notext" onclick="EditItemImagesPage.moveImage(\''+image.ImageType+'\', '+image.ImageIndex+', '+(i+1)+');" style="margin-bottom:0;">'+Globalize.translate('ButtonMoveRight')+'</button>';}else{html+='<button type="button" data-icon="arrow-r" data-mini="true" data-inline="true" data-iconpos="notext" style="margin-bottom:0;" disabled>'+Globalize.translate('ButtonMoveRight')+'</button>';}}
html+='<button type="button" data-icon="delete" data-mini="true" data-inline="true" data-iconpos="notext" onclick="EditItemImagesPage.deleteImage(\''+image.ImageType+'\', '+(image.ImageIndex!=null?image.ImageIndex:"null")+');" style="margin-bottom:0;">'+Globalize.translate('Delete')+'</button>';if(imageProviders.length){html+='<button type="button" data-icon="cloud" data-mini="true" data-inline="true" data-iconpos="notext" onclick="EditItemImagesPage.showDownloadMenu(\''+image.ImageType+'\');" style="margin-bottom:0;">'+Globalize.translate('ButtonBrowseOnlineImages')+'</button>';}
html+='</p>';html+='</div>';html+='</div>';}
elem.html(html).trigger('create');}
function renderStandardImages(page,item,imageInfos,imageProviders){var images=imageInfos.filter(function(i){return i.ImageType!="Screenshot"&&i.ImageType!="Backdrop"&&i.ImageType!="Chapter";});if(images.length){$('#imagesContainer',page).show();renderImages(page,item,images,imageProviders,$('#images',page));}else{$('#imagesContainer',page).hide();}}
function renderBackdrops(page,item,imageInfos,imageProviders){var images=imageInfos.filter(function(i){return i.ImageType=="Backdrop";}).sort(function(a,b){return a.ImageIndex-b.ImageIndex;});if(images.length){$('#backdropsContainer',page).show();renderImages(page,item,images,imageProviders,$('#backdrops',page));}else{$('#backdropsContainer',page).hide();}}
function renderScreenshots(page,item,imageInfos,imageProviders){var images=imageInfos.filter(function(i){return i.ImageType=="Screenshot";}).sort(function(a,b){return a.ImageIndex-b.ImageIndex;});if(images.length){$('#screenshotsContainer',page).show();renderImages(page,item,images,imageProviders,$('#screenshots',page));}else{$('#screenshotsContainer',page).hide();}}
function onFileReaderError(evt){Dashboard.hideLoadingMsg();switch(evt.target.error.code){case evt.target.error.NOT_FOUND_ERR:Dashboard.showError(Globalize.translate('MessageFileNotFound'));break;case evt.target.error.ABORT_ERR:break;default:Dashboard.showError(Globalize.translate('MessageFileReadError'));break;};}
function setFiles(page,files){var file=files[0];if(!file||!file.type.match('image.*')){$('#imageOutput',page).html('');$('#fldUpload',page).hide();currentFile=null;return;}
currentFile=file;var reader=new FileReader();reader.onerror=onFileReaderError;reader.onloadstart=function(){$('#fldUpload',page).hide();};reader.onabort=function(){Dashboard.hideLoadingMsg();console.log('File read cancelled');};reader.onload=(function(theFile){return function(e){var html=['<img style="max-width:300px;max-height:100px;" src="',e.target.result,'" title="',escape(theFile.name),'"/>'].join('');$('#imageOutput',page).html(html);$('#fldUpload',page).show();};})(file);reader.readAsDataURL(file);}
function processImageChangeResult(page){reload(page);}
function editItemImages(){var self=this;self.onSubmit=function(){var file=currentFile;if(!file){return false;}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){return false;}
Dashboard.showLoadingMsg();var page=$.mobile.activePage;var imageType=$('#selectImageType',page).val();ApiClient.uploadItemImage(currentItem.Id,imageType,file).done(function(){$('#uploadImage',page).val('').trigger('change');$('#popupUpload',page).popup("close");processImageChangeResult(page);});return false;};self.deleteImage=function(type,index){var page=$.mobile.activePage;Dashboard.confirm(Globalize.translate('DeleteImageConfirmation'),Globalize.translate('HeaderDeleteImage'),function(result){if(result){ApiClient.deleteItemImage(currentItem.Id,type,index).done(function(){processImageChangeResult(page);});}});};self.moveImage=function(type,index,newIndex){var page=$.mobile.activePage;ApiClient.updateItemImageIndex(currentItem.Id,type,index,newIndex).done(function(){processImageChangeResult(page);});};self.showDownloadMenu=function(type){browsableImageStartIndex=0;browsableImageType=type;$('.lnkBrowseImages').trigger('click');};}
window.EditItemImagesPage=new editItemImages();$(document).on('pageinit',"#editItemImagesPage",function(){var page=this;$('.libraryTree',page).on('itemclicked',function(event,data){if(data.id!=currentItem.Id){MetadataEditor.currentItemId=data.id;MetadataEditor.currentItemType=data.itemType;window.location.hash='editItemImagesPage?id='+data.id;reload(page);}});$('.lnkBrowseImages',page).on('click',function(){selectedProvider=null;$('.popupDownload',page).popup('open');reloadBrowsableImages(page);});$('#selectBrowsableImageType',page).on('change',function(){browsableImageType=this.value;browsableImageStartIndex=0;selectedProvider=null;reloadBrowsableImages(page);});$('#selectImageProvider',page).on('change',function(){browsableImageStartIndex=0;selectedProvider=this.value;reloadBrowsableImages(page);});$('#chkAllLanguages',page).on('change',function(){browsableImageStartIndex=0;reloadBrowsableImages(page);});}).on('pagebeforeshow',"#editItemImagesPage",function(){var page=this;reload(page);$('#uploadImage',page).on("change",function(){setFiles(page,this.files);});$("#imageDropZone",page).on('dragover',function(e){e.preventDefault();e.originalEvent.dataTransfer.dropEffect='Copy';return false;}).on('drop',function(e){e.preventDefault();setFiles(page,e.originalEvent.dataTransfer.files);return false;});}).on('pagehide',"#editItemImagesPage",function(){var page=this;currentItem=null;$('#uploadImage',page).off("change");$("#imageDropZone",page).off('dragover').off('drop');});})(jQuery,document,window,window.FileReader,escape);(function($,window,document){var currentItem;function updateTabs(page,item){var query=MetadataEditor.getEditQueryString(item);$('#btnEditMetadata',page).attr('href','edititemmetadata.html?'+query);$('#btnEditImages',page).attr('href','edititemimages.html?'+query);}
function showLocalSubtitles(page,index){Dashboard.showLoadingMsg();var popup=$('.popupSubtitleViewer',page).popup('open');$('.subtitleContent',page).html('');var url='Videos/'+currentItem.Id+'/Subtitles/'+index;$.get(ApiClient.getUrl(url)).done(function(result){$('.subtitleContent',page).html(result);Dashboard.hideLoadingMsg();popup.popup('reposition',{});});}
function showRemoteSubtitles(page,id){Dashboard.showLoadingMsg();var popup=$('.popupSubtitleViewer',page).popup('open');$('.subtitleContent',page).html('\nLoading...\n\n\n');var url='Providers/Subtitles/Subtitles/'+id;ApiClient.get(ApiClient.getUrl(url)).done(function(result){$('.subtitleContent',page).html(result);Dashboard.hideLoadingMsg();popup.popup('reposition',{});});}
function downloadRemoteSubtitles(page,id){var url='Items/'+currentItem.Id+'/RemoteSearch/Subtitles/'+id;ApiClient.ajax({type:"POST",url:ApiClient.getUrl(url)}).done(function(){Dashboard.alert(Globalize.translate('MessageDownloadQueued'));});}
function deleteLocalSubtitle(page,index){var msg=Globalize.translate('MessageAreYouSureDeleteSubtitles');Dashboard.confirm(msg,Globalize.translate('HeaderConfirmDeletion'),function(result){if(result){Dashboard.showLoadingMsg();var url='Videos/'+currentItem.Id+'/Subtitles/'+index;ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl(url)}).done(function(){reload(page);});}});}
function fillSubtitleList(page,item){var streams=item.MediaStreams||[];var subs=streams.filter(function(s){return s.Type=='Subtitle';});var html='';if(subs.length){html+='<br/>';html+='<ul data-role="listview" data-split-icon="delete"><li data-role="list-divider">'+Globalize.translate('HeaderCurrentSubtitles')+'</li>';html+=subs.map(function(s){var cssClass=s.Path?'btnViewSubtitles':'';var itemHtml='<li><a class="'+cssClass+'" href="#" data-index="'+s.Index+'">';itemHtml+='<p>'+(s.Language||Globalize.translate('LabelUnknownLanaguage'))+'</p>';if(s.IsDefault||s.IsForced){var atts=[];if(s.IsDefault){atts.push('Default');}
if(s.IsForced){atts.push('Forced');}
itemHtml+='<p>'+atts.join(', ')+'</p>';}
if(s.Path){itemHtml+='<p>'+(s.Path)+'</p>';}
itemHtml+='</a>';if(s.Path){itemHtml+='<a href="#" data-icon="delete" class="btnDelete" data-index="'+s.Index+'">'+Globalize.translate('Delete')+'</a>';}else{itemHtml+='<a href="#" data-icon="delete" style="display:none;" class="btnDelete" data-index="'+s.Index+'">'+Globalize.translate('Delete')+'</a>';}
itemHtml+='</li>';return itemHtml;}).join('');html+='</ul>';}
var elem=$('.subtitleList',page).html(html).trigger('create');$('.btnViewSubtitles',elem).on('click',function(){var index=this.getAttribute('data-index');showLocalSubtitles(page,index);});$('.btnDelete',elem).on('click',function(){var index=this.getAttribute('data-index');deleteLocalSubtitle(page,index);});}
function fillLanguages(page,languages){$('#selectLanguage',page).html(languages.map(function(l){return'<option value="'+l.ThreeLetterISOLanguageName+'">'+l.DisplayName+'</option>';})).selectmenu('refresh');Dashboard.getCurrentUser().done(function(user){var lang=user.Configuration.SubtitleLanguagePreference;if(lang){$('#selectLanguage',page).val(lang).selectmenu('refresh');}});}
function renderSearchResults(page,results){var lastProvider='';var html='';if(!results.length){$('.noSearchResults',page).show();$('.subtitleResults',page).html('');Dashboard.hideLoadingMsg();return;}
$('.noSearchResults',page).hide();html+='<ul data-role="listview">';for(var i=0,length=results.length;i<length;i++){var result=results[i];var provider=result.ProviderName;if(provider!=lastProvider){html+='<li data-role="list-divider">'+provider+'<span class="ui-li-count ui-body-inherit">'+Globalize.translate('HeaderRatingsDownloads')+'</span></li>';lastProvider=provider;}
html+='<li><a class="btnViewSubtitle" href="#" data-subid="'+result.Id+'">';html+='<h3>'+(result.Name)+'</h3>';html+='<p>'+(result.Format)+'</p>';if(result.Comment){html+='<p>'+(result.Comment)+'</p>';}
html+='<div class="ui-li-count">'+(result.CommunityRating||0)+' / '+(result.DownloadCount||0)+'</div>';html+='</a>';html+='<a href="#" class="btnDownload" data-icon="plus" data-subid="'+result.Id+'">'+Globalize.translate('ButtonDownload')+'</a>';html+='</li>';}
html+='</ul>';var elem=$('.subtitleResults',page).html(html).trigger('create');$('.btnViewSubtitle',elem).on('click',function(){var id=this.getAttribute('data-subid');showRemoteSubtitles(page,id);});$('.btnDownload',elem).on('click',function(){var id=this.getAttribute('data-subid');downloadRemoteSubtitles(page,id);});Dashboard.hideLoadingMsg();}
function searchForSubtitles(page,language){Dashboard.showLoadingMsg();var url=ApiClient.getUrl('Items/'+currentItem.Id+'/RemoteSearch/Subtitles/'+language);ApiClient.getJSON(url).done(function(results){renderSearchResults(page,results);});}
function reload(page){$('.noSearchResults',page).hide();MetadataEditor.getItemPromise().done(function(item){currentItem=item;LibraryBrowser.renderName(item,$('.itemName',page),true);updateTabs(page,item);fillSubtitleList(page,item);Dashboard.hideLoadingMsg();});}
function onWebSocketMessageReceived(e,data){var msg=data;if(msg.MessageType==="LibraryChanged"){if(msg.Data.ItemsUpdated.indexOf(currentItem.Id)!=-1){console.log('Item updated - reloading subtitles');reload($.mobile.activePage);}}}
$(document).on('pageinit',"#editItemSubtitlesPage",function(){var page=this;$('.libraryTree',page).on('itemclicked',function(event,data){if(data.id!=currentItem.Id){MetadataEditor.currentItemId=data.id;MetadataEditor.currentItemType=data.itemType;window.location.hash='editItemSubtitlesPage?id='+data.id;reload(page);}});}).on('pagebeforeshow',"#editItemSubtitlesPage",function(){var page=this;$('.subtitleResults',page).empty();Dashboard.showLoadingMsg();reload(page);ApiClient.getCultures().done(function(languages){fillLanguages(page,languages);});$(ApiClient).on("websocketmessage",onWebSocketMessageReceived);}).on('pagehide',"#editItemSubtitlesPage",function(){var page=this;currentItem=null;$(ApiClient).off("websocketmessage",onWebSocketMessageReceived);});window.EditItemSubtitlesPage={onSearchSubmit:function(){var form=this;var lang=$('#selectLanguage',form).val();searchForSubtitles($(form).parents('.page'),lang);return false;}};})(jQuery,window,document);(function($,document,window){function loadPage(page,config){$('#txtMinResumePct',page).val(config.MinResumePct);$('#txtMaxResumePct',page).val(config.MaxResumePct);$('#txtMinResumeDuration',page).val(config.MinResumeDurationSeconds);Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#playbackConfigurationPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});});function playbackConfigurationPage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getServerConfiguration().done(function(config){config.MinResumePct=$('#txtMinResumePct',form).val();config.MaxResumePct=$('#txtMaxResumePct',form).val();config.MinResumeDurationSeconds=$('#txtMinResumeDuration',form).val();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;};}
window.PlaybackConfigurationPage=new playbackConfigurationPage();})(jQuery,document,window);(function($,document,window){function loadPage(page,config){$('#chkMovies',page).checked(config.EnableIntrosForMovies).checkboxradio('refresh');$('#chkEpisodes',page).checked(config.EnableIntrosForEpisodes).checkboxradio('refresh');$('#chkMyMovieTrailers',page).checked(config.EnableIntrosFromMoviesInLibrary).checkboxradio('refresh');$('#chkUpcomingTheaterTrailers',page).checked(config.EnableIntrosFromUpcomingTrailers).checkboxradio('refresh');$('#chkUpcomingDvdTrailers',page).checked(config.EnableIntrosFromUpcomingDvdMovies).checkboxradio('refresh');$('#chkUpcomingStreamingTrailers',page).checked(config.EnableIntrosFromUpcomingStreamingMovies).checkboxradio('refresh');$('#chkUnwatchedOnly',page).checked(!config.EnableIntrosForWatchedContent).checkboxradio('refresh');$('#chkEnableParentalControl',page).checked(config.EnableIntrosParentalControl).checkboxradio('refresh');$('#txtCustomIntrosPath',page).val(config.CustomIntroPath||'');$('#txtNumTrailers',page).val(config.TrailerLimit);Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#cinemaModeConfigurationPage",function(){var page=this;$('#btnSelectCustomIntrosPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtCustomIntrosPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectCustomIntrosPath')});});}).on('pageshow',"#cinemaModeConfigurationPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getNamedConfiguration("cinemamode").done(function(config){loadPage(page,config);});});function cinemaModeConfigurationPage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var form=this;var page=$(form).parents('.page');ApiClient.getNamedConfiguration("cinemamode").done(function(config){config.CustomIntroPath=$('#txtCustomIntrosPath',page).val();config.TrailerLimit=$('#txtNumTrailers',page).val();config.EnableIntrosForMovies=$('#chkMovies',page).checked();config.EnableIntrosForEpisodes=$('#chkEpisodes',page).checked();config.EnableIntrosFromMoviesInLibrary=$('#chkMyMovieTrailers',page).checked();config.EnableIntrosForWatchedContent=!$('#chkUnwatchedOnly',page).checked();config.EnableIntrosParentalControl=$('#chkEnableParentalControl',page).checked();config.EnableIntrosFromUpcomingTrailers=$('#chkUpcomingTheaterTrailers',page).checked();config.EnableIntrosFromUpcomingDvdMovies=$('#chkUpcomingDvdTrailers',page).checked();config.EnableIntrosFromUpcomingStreamingMovies=$('#chkUpcomingStreamingTrailers',page).checked();ApiClient.updateNamedConfiguration("cinemamode",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;};}
window.CinemaModeConfigurationPage=new cinemaModeConfigurationPage();})(jQuery,document,window);(function($,document,window){function loadPage(page,config){$('#chkEnableDebugEncodingLogging',page).checked(config.EnableDebugLogging).checkboxradio('refresh');$('#chkEnableThrottle',page).checked(config.EnableThrottling).checkboxradio('refresh');$('.radioEncodingQuality',page).each(function(){this.checked=config.EncodingQuality==this.value;}).checkboxradio('refresh');$('#txtDownMixAudioBoost',page).val(config.DownMixAudioBoost);$('#txtTranscodingTempPath',page).val(config.TranscodingTempPath||'');Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#encodingSettingsPage",function(){var page=this;$('#btnSelectTranscodingTempPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtTranscodingTempPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectTranscodingPath'),instruction:Globalize.translate('HeaderSelectTranscodingPathHelp')});});}).on('pageshow',"#encodingSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getNamedConfiguration("encoding").done(function(config){loadPage(page,config);});});window.EncodingSettingsPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("encoding").done(function(config){config.EnableDebugLogging=$('#chkEnableDebugEncodingLogging',form).checked();config.EncodingQuality=$('.radioEncodingQuality:checked',form).val();config.DownMixAudioBoost=$('#txtDownMixAudioBoost',form).val();config.TranscodingTempPath=$('#txtTranscodingTempPath',form).val();config.EnableThrottling=$('#chkEnableThrottle',form).checked();ApiClient.updateNamedConfiguration("encoding",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);(function(window,store){function getExternalPlayers(){return JSON.parse(store.getItem('externalplayers')||'[]');}
function getUrl(player,item){return'vlc://http://www.google.com';}
function getCodecLimits(maxBitrate){var maxWidth;if(maxBitrate<=1000000){maxWidth=720;}
else if(maxBitrate<=5000000){maxWidth=1280;}else{maxWidth=1280;}
return{maxVideoAudioChannels:6,maxAudioChannels:2,maxVideoLevel:50,maxWidth:maxWidth,maxSampleRate:48000};}
function canDirectStream(mediaType,mediaSource,maxBitrate){if(!mediaSource.Bitrate||mediaSource.Bitrate>maxBitrate){return false;}
var codecLimits=getCodecLimits(maxBitrate);if(mediaType=="Audio"){return true;}
else if(mediaType=="Video"){var videoStream=mediaSource.MediaStreams.filter(function(s){return s.Type=='Video';})[0];if(!videoStream){return false;}
if(videoStream.Width&&videoStream.Width>codecLimits.maxWidth){return false;}
if(mediaSource.VideoType!='VideoFile'){return false;}
return mediaSource.Protocol=='File';}
throw new Error('Unrecognized MediaType');}
function canPlayAudioStreamDirect(audioStream,isVideo,maxBitrate){var audioCodec=(audioStream.Codec||'').toLowerCase().replace('-','');if(audioCodec.indexOf('aac')==-1&&audioCodec.indexOf('mp3')==-1&&audioCodec.indexOf('mpeg')==-1){return false;}
var codecLimits=getCodecLimits(maxBitrate);var maxChannels=isVideo?codecLimits.maxVideoAudioChannels:codecLimits.maxAudioChannels;if(!audioStream.Channels||audioStream.Channels>maxChannels){return false;}
if(!audioStream.SampleRate||audioStream.SampleRate>codecLimits.maxSampleRate){return false;}
var bitrate=audioStream.BitRate;if(!bitrate){return false;}
if(isVideo){if(audioCodec.indexOf('aac')!=-1&&bitrate>768000){return false;}
if(audioCodec.indexOf('mp3')!=-1||audioCodec.indexOf('mpeg')!=-1){if(bitrate>320000){return false;}}}else{if(bitrate>320000){return false;}}
return true;}
function isSupportedCodec(mediaType,mediaSource){if(mediaType=="Audio"){return false;}
else if(mediaType=="Video"){return mediaSource.MediaStreams.filter(function(m){return m.Type=="Video"&&(m.Codec||'').toLowerCase()=='h264';}).length>0;}
throw new Error('Unrecognized MediaType');}
function getStreamByIndex(streams,type,index){return streams.filter(function(s){return s.Type==type&&s.Index==index;})[0];}
function getMediaSourceInfo(item,maxBitrate,mediaSourceId,audioStreamIndex,subtitleStreamIndex){var sources=item.MediaSources.filter(function(m){m.audioStream=mediaSourceId==m.Id&&audioStreamIndex!=null?getStreamByIndex(m.MediaStreams,'Audio',audioStreamIndex):getStreamByIndex(m.MediaStreams,'Audio',m.DefaultAudioStreamIndex);if(item.MediaType=="Audio"&&!m.audioStream){m.audioStream=m.MediaStreams.filter(function(s){return s.Type=='Audio';})[0];}
m.subtitleStream=mediaSourceId==m.Id&&subtitleStreamIndex!=null?getStreamByIndex(m.MediaStreams,'Subtitle',subtitleStreamIndex):getStreamByIndex(m.MediaStreams,'Subtitle',m.DefaultSubtitleStreamIndex);return!mediaSourceId||m.Id==mediaSourceId;});var source=sources.filter(function(m){var audioStream=m.audioStream;if(!audioStream||!canPlayAudioStreamDirect(audioStream,item.MediaType=='Video',maxBitrate)){return false;}
if(m.subtitleStream&&m.subtitleStream.IsExternal){return false;}
return canDirectStream(item.MediaType,m,maxBitrate,audioStream);})[0];if(source){return{mediaSource:source,isStatic:true,streamContainer:source.Container};}
source=sources.filter(function(m){return isSupportedCodec(item.MediaType,m);})[0];source=source||sources[0];var container=item.MediaType=='Audio'?'mp3':'m3u8';return{mediaSource:source,isStatic:false,streamContainer:container};}
function getStreamInfo(serverAddress,deviceId,item,startPositionTicks,maxBitrate,mediaSourceId,audioStreamIndex,subtitleStreamIndex){var mediaSourceInfo=getMediaSourceInfo(item,maxBitrate,mediaSourceId,audioStreamIndex,subtitleStreamIndex);var url=getStreamUrl(serverAddress,deviceId,item.MediaType,item.Id,mediaSourceInfo,startPositionTicks,maxBitrate);if(mediaSourceInfo.subtitleStream&&mediaSourceInfo.subtitleStream.IsExternal){url+="&SubtitleStreamIndex="+mediaSourceInfo.Index;}
mediaSourceInfo.url=url;return mediaSourceInfo;}
function getStreamUrl(serverAddress,deviceId,mediaType,itemId,mediaSourceInfo,startPositionTicks,maxBitrate){var url;var codecLimits=getCodecLimits(maxBitrate);if(mediaType=='Audio'){url=serverAddress+'/audio/'+itemId+'/stream.'+mediaSourceInfo.streamContainer;url+='?mediasourceid='+mediaSourceInfo.mediaSource.Id;if(mediaSourceInfo.isStatic){url+='&static=true';}else{url+='&maxaudiochannels='+codecLimits.maxAudioChannels;if(startPositionTicks){url+='&startTimeTicks='+startPositionTicks.toString();}
if(maxBitrate){url+='&audiobitrate='+Math.min(maxBitrate,320000).toString();}
url+='&deviceId='+deviceId;}
return url;}
else if(mediaType=='Video'){if(mediaSourceInfo.isStatic){url=serverAddress+'/videos/'+itemId+'/stream.'+mediaSourceInfo.streamContainer+'?static=true';}
else{url=serverAddress+'/videos/'+itemId+'/stream.'+mediaSourceInfo.streamContainer+'?static=false';}
url+='&maxaudiochannels='+codecLimits.maxVideoAudioChannels;if(maxBitrate){var audioRate=320000;url+='&audiobitrate='+audioRate.toString();url+='&videobitrate='+(maxBitrate-audioRate).toString();}
url+='&profile=high';url+='&level=41';url+='&maxwidth='+codecLimits.maxWidth;url+='&videoCodec=h264';url+='&audioCodec=aac';url+='&mediasourceid='+mediaSourceInfo.mediaSource.Id;url+='&deviceId='+deviceId;return url;}
throw new Error('Unrecognized MediaType');}
function getVideoUrl(item){var maxBitrate=AppSettings.maxStreamingBitrate();var info=getStreamInfo(ApiClient.serverAddress(),ApiClient.deviceId(),item,null,maxBitrate);return info.url;}
function getPlayerUrl(item,player){return player.scheme.replace('{0}',getVideoUrl(item));}
function showPostPlayMenu(item,userId){$('.externalPlayerPostPlayFlyout').popup("close").remove();var html='<div data-role="popup" class="externalPlayerPostPlayFlyout" data-history="false" data-theme="a" data-dismissible="false">';html+='<ul data-role="listview" style="min-width: 220px;">';html+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate('HeaderExternalPlayerPlayback')+'</li>';html+='</ul>';html+='<div style="padding:1em;">';var autoMarkWatched=item.RunTimeTicks;if(item.RunTimeTicks&&item.RunTimeTicks>=3000000000){autoMarkWatched=false;html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('LabelMarkAs')+'</legend>';html+='<label for="radioMarkUnwatched">'+Globalize.translate('OptionUnwatched')+'</label>';html+='<input type="radio" id="radioMarkUnwatched" name="radioGroupMarkPlaystate" class="radioPlaystate" />';html+='<label for="radioMarkWatched">'+Globalize.translate('OptionWatched')+'</label>';html+='<input type="radio" id="radioMarkWatched" checked="checked" name="radioGroupMarkPlaystate" class="radioPlaystate" />';html+='<label for="radioMarkInProgress">'+Globalize.translate('OptionInProgress')+'</label>';html+='<input type="radio" id="radioMarkInProgress" name="radioGroupMarkPlaystate" class="radioPlaystate" />';html+='</fieldset>';html+='<br/>';html+='<p style="margin-top: 0;">'+Globalize.translate('LabelResumePoint')+'</p>';html+='<div class="sliderContainer" style="display:block;margin-top:4px;">';html+='<input class="playstateSlider" type="range" step=".001" min="0" max="100" value="0" style="display:none;" data-theme="a" data-highlight="true" />';html+='</div>';html+='<div class="sliderValue" style="text-align:center;margin:2px 0 4px;">0:00:00</div>';html+='<br/>';}
html+='<button type="button" class="btnDone" data-theme="b" data-icon="check">'+Globalize.translate('ButtonImDone')+'</button>';html+='</div>';html+='</div>';$(document.body).append(html);var elem=$('.externalPlayerPostPlayFlyout').popup({}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.radioPlaystate',elem).on('change',function(){if($('#radioMarkInProgress',elem).checked()){$('.playstateSlider',elem).slider('enable');}else{$('.playstateSlider',elem).slider('disable');}}).trigger('change');$('.btnDone',elem).on('click',function(){$('.externalPlayerPostPlayFlyout').popup("close").remove();ApiClient.stopActiveEncodings();if($('#radioMarkInProgress',elem).checked()){var pct=$(".playstateSlider",elem).val();var ticks=item.RunTimeTicks*(Number(pct)*.01);ApiClient.markPlayed(userId,item.Id,new Date());}
else if(autoMarkWatched||$('#radioMarkWatched',elem).checked()){ApiClient.markPlayed(userId,item.Id,new Date());}
else if($('#radioMarkUnwatched',elem).checked()){ApiClient.markUnplayed(userId,item.Id);}});$(".playstateSlider",elem).on("change",function(e){var pct=$(this).val();var time=item.RunTimeTicks*(Number(pct)*.01);var tooltext=Dashboard.getDisplayTime(time);$('.sliderValue',elem).html(tooltext);console.log("slidin",pct,self.currentDurationTicks,time);});}
function closePlayMenu(){$('.externalPlayerFlyout').popup("close").remove();}
function showMenuForItem(item,userId){closePlayMenu();var html='<div data-role="popup" class="externalPlayerFlyout" data-theme="a">';html+='<ul data-role="listview" style="min-width: 200px;">';html+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate('HeaderSelectExternalPlayer')+'</li>';html+='</ul>';html+='<div style="padding:1em;">';html+=getExternalPlayers().map(function(p){return'<a href="'+getPlayerUrl(item,p)+'" data-role="button" data-icon="play" class="btnExternalPlayer">'+p.name+'</a>';}).join('');html+='</div>';html+='</div>';$(document.body).append(html);var elem=$('.externalPlayerFlyout').popup({}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnExternalPlayer',elem).on('click',function(){closePlayMenu();setTimeout(function(){showPostPlayMenu(item,userId);},500);});}
function showPlayMenu(itemId){var userId=Dashboard.getCurrentUserId();ApiClient.getItem(userId,itemId).done(function(item){setTimeout(function(){showMenuForItem(item,userId);},500);});}
window.ExternalPlayer={getUrl:getUrl,getExternalPlayers:getExternalPlayers,showMenu:showPlayMenu};})(window,window.store);(function($,document){function getSections(){return[{name:Globalize.translate('HeaderFavoriteMovies'),types:"Movie",id:"favoriteMovies",shape:'backdrop',preferThumb:true,showTitle:false},{name:Globalize.translate('HeaderFavoriteShows'),types:"Series",id:"favoriteShows",shape:'backdrop',preferThumb:true,showTitle:false},{name:Globalize.translate('HeaderFavoriteEpisodes'),types:"Episode",id:"favoriteEpisode",shape:'backdrop',preferThumb:false,showTitle:true,showParentTitle:true},{name:Globalize.translate('HeaderFavoriteGames'),types:"Game",id:"favoriteGames",shape:'autohome',preferThumb:false,showTitle:true},{name:Globalize.translate('HeaderFavoriteAlbums'),types:"MusicAlbum",id:"favoriteAlbums",shape:'square',preferThumb:false,showTitle:true,overlayText:false,showParentTitle:true}];}
function loadSection(elem,userId,section,isSingleSection){var screenWidth=$(window).width();var options={SortBy:isSingleSection?"SortName":"Random",SortOrder:"Ascending",IncludeItemTypes:section.types,Filters:"IsFavorite",Limit:screenWidth>=1920?10:(screenWidth>=1440?8:6),Recursive:true,Fields:"PrimaryImageAspectRatio,SyncInfo",CollapseBoxSetItems:false,ExcludeLocationTypes:"Virtual"};if(isSingleSection){options.Limit=null;}
ApiClient.getItems(userId,options).done(function(result){var html='';if(result.Items.length){html+='<h1 class="listHeader">'+section.name+'</h1>';html+='<div>';html+=LibraryBrowser.getPosterViewHtml({items:result.Items,preferThumb:section.preferThumb,shape:section.shape,overlayText:section.overlayText!==false,context:'home-favorites',showTitle:section.showTitle,showParentTitle:section.showParentTitle,lazy:true});if(result.TotalRecordCount>result.Items.length){html+='<div class="itemsContainer">';var href="favorites.html?sectionid="+section.id;html+='<a data-role="button" href="'+href+'" data-mini="true" data-inline="true">'+Globalize.translate('ButtonMoreItems')+'</a>';html+='</div>';}
html+='</div>';}
elem=$(elem).html(html).trigger('create').lazyChildren();elem.createCardMenus();});}
function loadSections(page,userId){var sections=getSections();var sectionid=getParameterByName('sectionid');if(sectionid){sections=sections.filter(function(s){return s.id==sectionid;});}
var i,length;var elem=$('.sections',page);if(!elem.html().length){var html='';for(i=0,length=sections.length;i<length;i++){html+='<div class="homePageSection section'+sections[i].id+'"></div>';}
elem.html(html);}
for(i=0,length=sections.length;i<length;i++){var section=sections[i];elem=$('.section'+section.id,page);loadSection(elem,userId,section,sections.length==1);}}
$(document).on('pagebeforeshow',"#favoritesPage",function(){var page=this;var userId=Dashboard.getCurrentUserId();loadSections(page,userId);});})(jQuery,document);(function(window){function processForgotPasswordResult(page,result){if(result.Action=='ContactAdmin'){Dashboard.alert({message:Globalize.translate('MessageContactAdminToResetPassword'),title:Globalize.translate('HeaderForgotPassword')});return;}
if(result.Action=='InNetworkRequired'){Dashboard.alert({message:Globalize.translate('MessageForgotPasswordInNetworkRequired'),title:Globalize.translate('HeaderForgotPassword')});return;}
if(result.Action=='PinCode'){var msg=Globalize.translate('MessageForgotPasswordFileCreated');msg+="<br/>";msg+="<br/>";msg+=result.PinFile;msg+="<br/>";Dashboard.alert({message:msg,title:Globalize.translate('HeaderForgotPassword')});return;}}
function onSubmit(page){ApiClient.ajax({type:'POST',url:ApiClient.getUrl('Users/ForgotPassword'),dataType:'json',data:{EnteredUsername:$('#txtName',page).val()}}).done(function(result){processForgotPasswordResult(page,result);});}
window.ForgotPasswordPage={onSubmit:function(){var page=$(this).parents('.page');onSubmit(page);return false;}};})(window);(function(window){function processForgotPasswordResult(page,result){if(result.Success){var msg=Globalize.translate('MessagePasswordResetForUsers');msg+='<br/>';msg+='<br/>';msg+=result.UsersReset.join('<br/>');Dashboard.alert({message:msg,title:Globalize.translate('HeaderPasswordReset'),callback:function(){window.location='login.html';}});return;}
Dashboard.alert({message:Globalize.translate('MessageInvalidForgotPasswordPin'),title:Globalize.translate('HeaderPasswordReset')});return;}
function onSubmit(page){ApiClient.ajax({type:'POST',url:ApiClient.getUrl('Users/ForgotPassword/Pin'),dataType:'json',data:{Pin:$('#txtPin',page).val()}}).done(function(result){processForgotPasswordResult(page,result);});}
window.ForgotPasswordPinPage={onSubmit:function(){var page=$(this).parents('.page');onSubmit(page);return false;}};})(window);(function($,document){$(document).on('pagebeforeshow',"#gamesRecommendedPage",function(){var parentId=LibraryMenu.getTopParentId();var userId=Dashboard.getCurrentUserId();var page=this;var options={IncludeItemTypes:"Game",Limit:18,Fields:"PrimaryImageAspectRatio",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options)).done(function(items){$('#recentlyAddedItems',page).html(LibraryBrowser.getPosterViewHtml({items:items,transparent:true,borderless:true,shape:'auto',lazy:true})).lazyChildren();});options={SortBy:"DatePlayed",SortOrder:"Descending",MediaTypes:"Game",Limit:18,Recursive:true,Filters:"IsPlayed",Fields:"ItemCounts,AudioInfo,PrimaryImageAspectRatio",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(userId,options).done(function(result){if(result.Items.length){$('#recentlyPlayedSection',page).show();}else{$('#recentlyPlayedSection',page).hide();}
$('#recentlyPlayedItems',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,transparent:true,borderless:true,shape:'auto',lazy:true})).lazyChildren();});});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"GameSystem",Recursive:true,Fields:"DateCreated",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'gamesystems'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);updateFilterControls(page);var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",context:'games',showTitle:true,centerText:true,lazy:true});$('#items',page).html(html).lazyChildren();LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){}
$(document).on('pagebeforeshow',"#gamesystemsPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#gamesystemsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','List');var query={SortBy:"SortName",SortOrder:"Ascending",MediaTypes:"Game",Recursive:true,Fields:"Genres,Studios,PrimaryImageAspectRatio,SortName",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'games'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);var trigger=false;if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'games',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:'games',showTitle:true,showParentTitle:true,centerText:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:'games',showTitle:true,showParentTitle:true,cardLayout:true});}
$('#items',page).html(html).lazyChildren();if(trigger){$('#items',page).trigger('create');}
$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.radioPlayers',page).each(function(){var val=this.getAttribute('data-value');if(val=="all"){this.checked=query.MinPlayers==null;}else{this.checked=query.MinPlayers==val;}}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWith);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#gamesPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.radioPlayers',this).on('click',function(){query.StartIndex=0;var val=this.getAttribute('data-value');query.MinPlayers=val=="all"?null:val;reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#gamesPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#gamesPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",Recursive:true,Fields:"DateCreated,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'gamegenres'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getGameGenres(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'games',showItemCounts:true,centerText:true,lazy:true});$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#gameGenresPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#gameGenresPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#gameGenresPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",MediaTypes:"Game",Recursive:true,Fields:"ItemCounts",StartIndex:0};function getSavedQueryKey(){return'gamestudios'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getStudios(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'games',showItemCounts:true,centerText:true,lazy:true});$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#gameStudiosPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#gameStudiosPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#gameStudiosPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function loadSections(page,user){var userId=user.Id;var i,length;var sectionCount=3;var elem=$('.sections',page);if(!elem.html().length){var html='';for(i=0,length=sectionCount;i<length;i++){html+='<div class="homePageSection section'+i+'"></div>';}
elem.html(html);}
var context='home-latest';var latestMediElem=$('.section0',page);Sections.loadRecentlyAdded(latestMediElem,user,context).done(function(){$('h1',latestMediElem).addClass('firstListHeader');});Sections.loadLatestLiveTvRecordings($(".section1",page),userId);Sections.loadLatestChannelItems($(".section2",page),userId);}
$(document).on('pagebeforeshow',"#homeLatestPage",function(){var page=this;Dashboard.getCurrentUser().done(function(user){loadSections(page,user);});});})(jQuery,document);(function($,document){function getUserViews(userId){var deferred=$.Deferred();ApiClient.getUserViews(userId).done(function(result){var items=result.Items;deferred.resolveWith(null,[items]);});return deferred.promise();}
function createMediaLinks(options){var html="";var items=options.items;for(var i=0,length=items.length;i<length;i++){var item=items[i];var icon;switch(item.CollectionType){case"movies":icon="fa-film";break;case"music":icon="fa-music";break;case"photos":icon="fa-photo";break;case"livetv":case"tvshows":icon="fa-video-camera";break;case"games":icon="fa-gamepad";break;case"trailers":icon="fa-film";break;case"homevideos":icon="fa-video-camera";break;case"musicvideos":icon="fa-video-camera";break;case"books":icon="fa-book";break;case"channels":icon="fa-globe";break;case"playlists":icon="fa-list";break;default:icon="fa-folder-o";break;}
var cssClass="posterItem";cssClass+=' '+options.shape+'PosterItem';if(item.CollectionType){cssClass+=' '+item.CollectionType+'PosterItem';}
var href=item.url||LibraryBrowser.getHref(item,options.context);html+='<a data-itemid="'+item.Id+'" class="'+cssClass+'" href="'+href+'">';var imageCssClass='';html+='<div class="posterItemImage '+imageCssClass+'">';html+='</div>';html+="<div class='posterItemDefaultText posterItemText'>";html+='<i class="fa '+icon+'"></i>';html+='<span>'+item.Name+'</span>';html+="</div>";html+="</a>";}
return html;}
function loadlibraryButtons(elem,userId,index){return getUserViews(userId).done(function(items){var html='<br/>';if(index){html+='<h1 class="listHeader">'+Globalize.translate('HeaderMyMedia')+'</h1>';}
html+='<div>';html+=createMediaLinks({items:items,shape:'myLibrary',showTitle:true,centerText:true});html+='</div>';$(elem).html(html);handleLibraryLinkNavigations(elem);});}
function loadRecentlyAdded(elem,user,context){var options={Limit:24,Fields:"PrimaryImageAspectRatio,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};return ApiClient.getJSON(ApiClient.getUrl('Users/'+user.Id+'/Items/Latest',options)).done(function(items){var html='';if(items.length){html+='<div>';html+='<h1 style="display:inline-block; vertical-align:middle;" class="listHeader">'+Globalize.translate('HeaderLatestMedia')+'</h1>';if(user.Policy.EnableUserPreferenceAccess){html+='<a href="mypreferencesdisplay.html" class="accentButton"><i class="fa fa-pencil"></i>'+Globalize.translate('ButtonEdit')+'</a>';}
html+='</div>';html+='<div class="itemsContainer">';html+=LibraryBrowser.getPosterViewHtml({items:items,preferThumb:true,shape:'backdrop',context:context||'home',showUnplayedIndicator:false,showChildCountIndicator:true,lazy:true,});html+='</div>';}
$(elem).html(html).lazyChildren();$(elem).createCardMenus();});}
function loadLatestChannelMedia(elem,userId){var screenWidth=$(window).width();var options={Limit:screenWidth>=2400?10:(screenWidth>=1600?10:(screenWidth>=1440?8:(screenWidth>=800?7:6))),Fields:"PrimaryImageAspectRatio,SyncInfo",Filters:"IsUnplayed",UserId:userId};return ApiClient.getJSON(ApiClient.getUrl("Channels/Items/Latest",options)).done(function(result){var html='';if(result.Items.length){html+='<h1 class="listHeader">'+Globalize.translate('HeaderLatestChannelMedia')+'</h1>';html+='<div class="itemsContainer">';html+=LibraryBrowser.getPosterViewHtml({items:result.Items,preferThumb:true,shape:'auto',showTitle:true,centerText:true,lazy:true});html+='</div>';}
$(elem).html(html).lazyChildren();$(elem).createCardMenus();});}
function loadLibraryTiles(elem,user,shape,index,autoHideOnMobile,showTitles){if(autoHideOnMobile){$(elem).addClass('hiddenSectionOnMobile');}else{$(elem).removeClass('hiddenSectionOnMobile');}
return getUserViews(user.Id).done(function(items){var html='';if(items.length){var cssClass=index!==0?'listHeader':'listHeader firstListHeader';html+='<div>';html+='<h1 style="display:inline-block; vertical-align:middle;" class="'+cssClass+'">'+Globalize.translate('HeaderMyMedia')+'</h1>';if(user.Policy.EnableUserPreferenceAccess){html+='<a href="mypreferencesdisplay.html" class="accentButton"><i class="fa fa-pencil"></i>'+Globalize.translate('ButtonEdit')+'</a>';}
html+='</div>';html+='<div class="homeTopViews">';html+=LibraryBrowser.getPosterViewHtml({items:items,shape:shape,showTitle:showTitles,centerText:true,lazy:true,autoThumb:true});html+='</div>';}
$(elem).html(html).lazyChildren().createCardMenus();handleLibraryLinkNavigations(elem);});}
function loadResume(elem,userId){var screenWidth=$(window).width();var options={SortBy:"DatePlayed",SortOrder:"Descending",MediaTypes:"Video",Filters:"IsResumable",Limit:screenWidth>=1920?10:(screenWidth>=1600?8:(screenWidth>=1200?9:6)),Recursive:true,Fields:"PrimaryImageAspectRatio,SyncInfo",CollapseBoxSetItems:false,ExcludeLocationTypes:"Virtual",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};return ApiClient.getItems(userId,options).done(function(result){var html='';if(result.Items.length){html+='<h1 class="listHeader">'+Globalize.translate('HeaderResume')+'</h1>';html+='<div>';html+=LibraryBrowser.getPosterViewHtml({items:result.Items,preferThumb:true,shape:'backdrop',overlayText:true,showTitle:true,showParentTitle:true,context:'home',lazy:true});html+='</div>';}
$(elem).html(html).lazyChildren();$(elem).createCardMenus();});}
function handleLibraryLinkNavigations(elem){$('a.posterItem',elem).on('click',function(){var textElem=$('.posterItemText span',this);if(!textElem.length){textElem=$('.posterItemText',this);}
var text=textElem.html();LibraryMenu.setText(text);});}
function loadLatestChannelItems(elem,userId,options){options=$.extend(options||{},{UserId:userId,SupportsLatestItems:true});return ApiClient.getJSON(ApiClient.getUrl("Channels",options)).done(function(result){var channels=result.Items;var channelsHtml=channels.map(function(c){return'<div id="channel'+c.Id+'"></div>';}).join('');$(elem).html(channelsHtml);for(var i=0,length=channels.length;i<length;i++){var channel=channels[i];loadLatestChannelItemsFromChannel(elem,channel,i);}});}
function loadLatestChannelItemsFromChannel(page,channel,index){var screenWidth=$(window).width();var options={Limit:screenWidth>=1600?10:(screenWidth>=1440?5:(screenWidth>=800?6:6)),Fields:"PrimaryImageAspectRatio,SyncInfo",Filters:"IsUnplayed",UserId:Dashboard.getCurrentUserId(),ChannelIds:channel.Id};ApiClient.getJSON(ApiClient.getUrl("Channels/Items/Latest",options)).done(function(result){var html='';if(result.Items.length){var cssClass=index!==0?'listHeader':'listHeader firstListHeader';html+='<div>';var text=Globalize.translate('HeaderLatestFromChannel').replace('{0}',channel.Name);html+='<h1 style="display:inline-block; vertical-align:middle;" class="'+cssClass+'">'+text+'</h1>';html+='<a href="channelitems.html?context=channels&id='+channel.Id+'" data-role="button" data-icon="arrow-r" data-mini="true" data-inline="true" data-iconpos="notext" class="sectionHeaderButton"></a>';html+='</div>';}
html+='<div class="itemsContainer">';html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:'autohome',defaultShape:'square',showTitle:true,centerText:true,context:'channels',lazy:true});html+='</div>';var elem=$('#channel'+channel.Id+'',page).html(html).lazyChildren().trigger('create');$(elem).createCardMenus();});}
function loadLatestLiveTvRecordings(elem,userId,index){return ApiClient.getLiveTvRecordings({userId:userId,limit:5,IsInProgress:false}).done(function(result){var html='';if(result.Items.length){var cssClass=index!==0?'listHeader':'listHeader firstListHeader';html+='<div>';html+='<h1 style="display:inline-block; vertical-align:middle;" class="'+cssClass+'">'+Globalize.translate('HeaderLatestTvRecordings')+'</h1>';html+='<a href="livetvrecordings.html?context=livetv" data-role="button" data-icon="arrow-r" data-mini="true" data-inline="true" data-iconpos="notext" class="sectionHeaderButton"></a>';html+='</div>';}
var screenWidth=$(window).width();html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"autohome",showTitle:true,showParentTitle:true,overlayText:screenWidth>=600,coverImage:true,lazy:true});elem.html(html).lazyChildren().trigger('create');});}
window.Sections={loadRecentlyAdded:loadRecentlyAdded,loadLatestChannelMedia:loadLatestChannelMedia,loadLibraryTiles:loadLibraryTiles,loadResume:loadResume,loadLatestChannelItems:loadLatestChannelItems,loadLatestLiveTvRecordings:loadLatestLiveTvRecordings,loadlibraryButtons:loadlibraryButtons};})(jQuery,document);(function($,document){var defaultFirstSection='smalllibrarytiles-automobile';function getDefaultSection(index){switch(index){case 0:return defaultFirstSection;case 1:return'resume';case 2:return'latestmedia';case 3:return'';default:return'';}}
function loadSection(page,user,displayPreferences,index){var userId=user.Id;var section=displayPreferences.CustomPrefs['home'+index]||getDefaultSection(index);if(section=='folders'){section=defaultFirstSection;}
var showLibraryTileNames=displayPreferences.CustomPrefs.enableLibraryTileNames!='0';var elem=$('.section'+index,page);if(section=='latestmedia'){return Sections.loadRecentlyAdded(elem,user);}
else if(section=='librarytiles'){return Sections.loadLibraryTiles(elem,user,'backdrop',index,false,showLibraryTileNames);}
else if(section=='smalllibrarytiles'){return Sections.loadLibraryTiles(elem,user,'homePageSmallBackdrop',index,false,showLibraryTileNames);}
else if(section=='smalllibrarytiles-automobile'){return Sections.loadLibraryTiles(elem,user,'homePageSmallBackdrop',index,true,showLibraryTileNames);}
else if(section=='librarytiles-automobile'){return Sections.loadLibraryTiles(elem,user,'backdrop',index,true,showLibraryTileNames);}
else if(section=='librarybuttons'){return Sections.loadlibraryButtons(elem,userId,index);}
else if(section=='resume'){return Sections.loadResume(elem,userId);}
else if(section=='latesttvrecordings'){return Sections.loadLatestLiveTvRecordings(elem,userId);}
else if(section=='latestchannelmedia'){return Sections.loadLatestChannelMedia(elem,userId);}else{elem.empty();var deferred=DeferredBuilder.Deferred();deferred.resolve();return deferred.promise();}}
function loadSections(page,user,displayPreferences){var i,length;var sectionCount=4;var elem=$('.sections',page);if(!elem.html().length){var html='';for(i=0,length=sectionCount;i<length;i++){html+='<div class="homePageSection section'+i+'"></div>';}
elem.html(html);}
var promises=[];for(i=0,length=sectionCount;i<length;i++){promises.push(loadSection(page,user,displayPreferences,i));}
return $.when(promises);}
var homePageDismissValue='14';var homePageTourKey='homePageTour';function dismissWelcome(page,userId){ApiClient.getDisplayPreferences('home',userId,'webclient').done(function(result){result.CustomPrefs[homePageTourKey]=homePageDismissValue;ApiClient.updateDisplayPreferences('home',result,userId,'webclient');});}
function showWelcomeIfNeeded(page,displayPreferences){if(displayPreferences.CustomPrefs[homePageTourKey]==homePageDismissValue){$('.welcomeMessage',page).hide();}else{var elem=$('.welcomeMessage',page).show();if(displayPreferences.CustomPrefs[homePageTourKey]){$('.tourHeader',elem).html(Globalize.translate('HeaderWelcomeBack'));$('.tourButtonText',elem).html(Globalize.translate('ButtonTakeTheTourToSeeWhatsNew'));}else{$('.tourHeader',elem).html(Globalize.translate('HeaderWelcomeToProjectWebClient'));$('.tourButtonText',elem).html(Globalize.translate('ButtonTakeTheTour'));}}}
function takeTour(page,userId){$.swipebox([{href:'css/images/tour/web/tourcontent.jpg',title:Globalize.translate('WebClientTourContent')},{href:'css/images/tour/web/tourmovies.jpg',title:Globalize.translate('WebClientTourMovies')},{href:'css/images/tour/web/tourmouseover.jpg',title:Globalize.translate('WebClientTourMouseOver')},{href:'css/images/tour/web/tourtaphold.jpg',title:Globalize.translate('WebClientTourTapHold')},{href:'css/images/tour/web/tourmysync.png',title:Globalize.translate('WebClientTourMySync')},{href:'css/images/tour/web/toureditor.png',title:Globalize.translate('WebClientTourMetadataManager')},{href:'css/images/tour/web/tourplaylist.png',title:Globalize.translate('WebClientTourPlaylists')},{href:'css/images/tour/web/tourcollections.jpg',title:Globalize.translate('WebClientTourCollections')},{href:'css/images/tour/web/tourusersettings1.png',title:Globalize.translate('WebClientTourUserPreferences1')},{href:'css/images/tour/web/tourusersettings2.png',title:Globalize.translate('WebClientTourUserPreferences2')},{href:'css/images/tour/web/tourusersettings3.png',title:Globalize.translate('WebClientTourUserPreferences3')},{href:'css/images/tour/web/tourusersettings4.png',title:Globalize.translate('WebClientTourUserPreferences4')},{href:'css/images/tour/web/tourmobile1.jpg',title:Globalize.translate('WebClientTourMobile1')},{href:'css/images/tour/web/tourmobile2.png',title:Globalize.translate('WebClientTourMobile2')},{href:'css/images/tour/enjoy.jpg',title:Globalize.translate('MessageEnjoyYourStay')}],{afterClose:function(){dismissWelcome(page,userId);$('.welcomeMessage',page).hide();loadConfigureViewsWelcomeMessage(page,userId);},hideBarsDelay:30000});}
function loadConfigureViewsWelcomeMessage(page,userId){Dashboard.getCurrentUser().done(function(user){if(user.Policy.EnableUserPreferenceAccess){$('.btnMyPreferences',page).attr('href','mypreferencesdisplay.html?userId='+userId);setTimeout(function(){$('.popupConfigureViews',page).popup('open');},500);}});}
$(document).on('pageinit',"#indexPage",function(){var page=this;var userId=Dashboard.getCurrentUserId();$('.btnTakeTour',page).on('click',function(){takeTour(page,userId);});}).on('pagebeforeshow',"#indexPage",function(){var page=this;var userId=Dashboard.getCurrentUserId();ApiClient.getDisplayPreferences('home',userId,'webclient').done(function(result){Dashboard.getCurrentUser().done(function(user){loadSections(page,user,result).done(function(){showWelcomeIfNeeded(page,result);});});});});})(jQuery,document);(function($,document,LibraryBrowser){var currentItem;var shape;var _childrenItemsFunction;function getPromise(){var id=getParameterByName('id');if(id){return ApiClient.getItem(Dashboard.getCurrentUserId(),id);}
var name=getParameterByName('genre');if(name){return ApiClient.getGenre(name,Dashboard.getCurrentUserId());}
name=getParameterByName('musicgenre');if(name){return ApiClient.getMusicGenre(name,Dashboard.getCurrentUserId());}
name=getParameterByName('gamegenre');if(name){return ApiClient.getGameGenre(name,Dashboard.getCurrentUserId());}
name=getParameterByName('musicartist');if(name){return ApiClient.getArtist(name,Dashboard.getCurrentUserId());}
else{throw new Error('Invalid request');}}
function reload(page){Dashboard.showLoadingMsg();getPromise().done(function(item){var context=getParameterByName('context');var editQuery='?id='+item.Id;if(context){editQuery+='&context='+context;}
currentItem=item;Backdrops.setBackdrops(page,[item]);renderHeader(page,item,context);var name=item.Name;Dashboard.setPageTitle(name);$('.itemName',page).html(name);renderDetails(page,item,context);renderTabs(page,item,context);$(page).trigger('displayingitem',[{item:item,context:context}]);Dashboard.getCurrentUser().done(function(user){if(MediaController.canPlay(item)){$('.btnPlay',page).show();}else{$('.btnPlay',page).hide();}
if(SyncManager.isAvailable(item,user)){$('.btnSync',page).removeClass('hide');}else{$('.btnSync',page).addClass('hide');}
var editImagesHref=user.Policy.IsAdministrator?'edititemimages.html'+editQuery:null;$('#itemImage',page).html(LibraryBrowser.getDetailImageHtml(item,editImagesHref,true));if(LibraryBrowser.getMoreCommands(item,user).length){$('.btnMoreCommands',page).show();}else{$('.btnMoreCommands',page).show();}});Dashboard.hideLoadingMsg();});}
function renderHeader(page,item,context){$('.itemTabs',page).hide();if(context=="movies"&&item.Type=="Genre"){$('#movieGenreTabs',page).show();}
if(context=="movies"&&item.Type=="Person"){$('#moviePeopleTabs',page).show();}
if(context=="movies"&&item.Type=="Studio"){$('#movieStudioTabs',page).show();}
if(context=="tv"&&item.Type=="Studio"){$('#tvStudioTabs',page).show();}
if(context=="tv"&&item.Type=="Genre"){$('#tvGenreTabs',page).show();}
if(context=="tv"&&item.Type=="Person"){$('#tvPeopleTabs',page).show();}
if(context=="music"&&item.Type=="MusicGenre"){$('#musicGenreTabs',page).show();}
if(context=="music"&&item.Type=="MusicArtist"){$('#artistTabs',page).show();}
if(context=="games"&&item.Type=="GameGenre"){$('#gameGenreTabs',page).show();}
if(context=="games"&&item.Type=="Studio"){$('#gameStudioTabs',page).show();}}
function renderTabs(page,item,context){var html='<fieldset data-role="controlgroup" data-type="horizontal" class="libraryTabs">';html+='<legend></legend>';if(item.MovieCount){html+='<input type="radio" name="ibnItems" id="radioMovies" class="context-movies" value="on">';html+='<label for="radioMovies">'+Globalize.translate('TabMovies')+'</label>';}
if(item.SeriesCount){html+='<input type="radio" name="ibnItems" id="radioShows" class="context-tv" value="on">';html+='<label for="radioShows">'+Globalize.translate('TabSeries')+'</label>';}
if(item.EpisodeCount){html+='<input type="radio" name="ibnItems" id="radioEpisodes" class="context-tv" value="on">';html+='<label for="radioEpisodes">'+Globalize.translate('TabEpisodes')+'</label>';}
if(item.TrailerCount){html+='<input type="radio" name="ibnItems" id="radioTrailers" class="context-movies" value="on">';html+='<label for="radioTrailers">'+Globalize.translate('TabTrailers')+'</label>';}
if(item.GameCount){html+='<input type="radio" name="ibnItems" id="radioGames" class="context-games" value="on">';html+='<label for="radioGames">'+Globalize.translate('TabGames')+'</label>';}
if(item.AlbumCount){html+='<input type="radio" name="ibnItems" id="radioAlbums" class="context-music" value="on">';html+='<label for="radioAlbums">'+Globalize.translate('TabAlbums')+'</label>';}
if(item.SongCount){html+='<input type="radio" name="ibnItems" id="radioSongs" class="context-music" value="on">';html+='<label for="radioSongs">'+Globalize.translate('TabSongs')+'</label>';}
if(item.MusicVideoCount){html+='<input type="radio" name="ibnItems" id="radioMusicVideos" class="context-music" value="on">';html+='<label for="radioMusicVideos">'+Globalize.translate('TabMusicVideos')+'</label>';}
html+='</fieldset>';var elem=$('#itemTabs',page).html(html).trigger('create');bindRadioEvents(page);var selectedRadio=null;if(context){selectedRadio=$('.context-'+context+':first',elem);}
if(selectedRadio&&selectedRadio.length){selectedRadio.attr("checked","checked").checkboxradio("refresh").trigger('click');}else{$('input:first',elem).attr("checked","checked").checkboxradio("refresh").trigger('click');}}
function bindRadioEvents(page){$("#radioMusicVideos",page).on("click",function(){shape="poster";loadItems(page,{MediaTypes:"",IncludeItemTypes:"MusicVideo",PersonTypes:"",ArtistIds:""});});$("#radioMovies",page).on("click",function(){shape="poster";loadItems(page,{MediaTypes:"",IncludeItemTypes:"Movie",PersonTypes:"",ArtistIds:""});});$("#radioShows",page).on("click",function(){shape="poster";loadItems(page,{MediaTypes:"",IncludeItemTypes:"Series",PersonTypes:"",ArtistIds:""});});$("#radioTrailers",page).on("click",function(){shape="poster";loadItems(page,{MediaTypes:"",IncludeItemTypes:"Trailer",PersonTypes:"",ArtistIds:""});});$("#radioGames",page).on("click",function(){shape="poster";loadItems(page,{IncludeItemTypes:"",MediaTypes:"Game",PersonTypes:"",ArtistIds:""});});$("#radioEpisodes",page).on("click",function(){shape="backdrop";loadItems(page,{MediaTypes:"",IncludeItemTypes:"Episode",PersonTypes:"",ArtistIds:""});});$("#radioAlbums",page).on("click",function(){shape="square";loadItems(page,{MediaTypes:"",IncludeItemTypes:"MusicAlbum",PersonTypes:"",ArtistIds:""});});$("#radioSongs",page).on("click",function(){loadItems(page,{MediaTypes:"",IncludeItemTypes:"Audio",PersonTypes:"",ArtistIds:""});});}
function renderDetails(page,item,context){LibraryBrowser.renderOverview($('.itemOverview',page),item);renderUserDataIcons(page,item);LibraryBrowser.renderLinks($('#itemLinks',page),item);LibraryBrowser.renderGenres($('.itemGenres',page),item,context);if(item.Type=="Person"&&item.PremiereDate){try{var birthday=parseISO8601Date(item.PremiereDate,{toLocal:true}).toDateString();$('#itemBirthday',page).show().html(Globalize.translate('BirthDateValue').replace('{0}',birthday));}
catch(err){$('#itemBirthday',page).hide();}}else{$('#itemBirthday',page).hide();}
if(item.Type=="Person"&&item.EndDate){try{var deathday=parseISO8601Date(item.EndDate,{toLocal:true}).toDateString();$('#itemDeathDate',page).show().html(Globalize.translate('DeathDateValue').replace('{0}',deathday));}
catch(err){$('#itemBirthday',page).hide();}}else{}
if(item.Type=="Person"&&item.ProductionLocations&&item.ProductionLocations.length){var gmap='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+item.ProductionLocations[0]+'">'+item.ProductionLocations[0]+'</a>';$('#itemBirthLocation',page).show().html(Globalize.translate('BirthPlaceValue').replace('{0}',gmap)).trigger('create');}else{$('#itemBirthLocation',page).hide();}}
function renderUserDataIcons(page,item){$('.userDataIcons',page).html(LibraryBrowser.getUserDataIconsHtml(item));}
function addCurrentItemToQuery(query){if(currentItem.Type=="Person"){query.PersonIds=currentItem.Id;}
else if(currentItem.Type=="Genre"){query.Genres=currentItem.Name;}
else if(currentItem.Type=="MusicGenre"){query.Genres=currentItem.Name;}
else if(currentItem.Type=="GameGenre"){query.Genres=currentItem.Name;}
else if(currentItem.Type=="Studio"){query.StudioIds=currentItem.Id;}
else if(currentItem.Type=="MusicArtist"){query.ArtistIds=currentItem.Id;}}
function getQuery(options){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"",Recursive:true,Fields:"AudioInfo,SeriesInfo,ParentId,PrimaryImageAspectRatio,SyncInfo",Limit:LibraryBrowser.getDefaultPageSize(),StartIndex:0,CollapseBoxSetItems:false};query=$.extend(query,options||{});if(query.IncludeItemTypes=="Audio"){query.SortBy="AlbumArtist,Album,SortName";}
addCurrentItemToQuery(query);return query;}
function getItemsFunction(options){var query=getQuery(options);return function(index,limit,fields){query.StartIndex=index;query.Limit=limit;query.Fields=fields;return ApiClient.getItems(Dashboard.getCurrentUserId(),query);};}
function loadItems(page,options){Dashboard.showLoadingMsg();_childrenItemsFunction=getItemsFunction(options);var query=getQuery(options);getItemsFunction(options)(options.StartIndex,options.Limit,options.Fields).done(function(result){var html='';if(result.TotalRecordCount>query.Limit){$('.listTopPaging',page).html(LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,true)).trigger('create');$('.viewSettings',page).show();}else{$('.listTopPaging',page).html('');$('.viewSettings',page).hide();}
var screenWidth=$(window).width();if(query.IncludeItemTypes=="Audio"){html=LibraryBrowser.getListViewHtml({items:result.Items,smallIcon:true,playFromHere:true,defaultAction:'playallfromhere'});}
else if(query.IncludeItemTypes=="Movie"||query.IncludeItemTypes=="Trailer"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',showTitle:true,centerText:true});}
else if(query.IncludeItemTypes=="Episode"){html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,showParentTitle:true,overlayText:screenWidth>=600});}
else if(query.IncludeItemTypes=="Series"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'tv'});}
else if(query.IncludeItemTypes=="MusicAlbum"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',playFromHere:true,showTitle:true,showParentTitle:true});}
else{html=LibraryBrowser.getListViewHtml({items:result.Items,smallIcon:true});}
html+=LibraryBrowser.getPagingHtml(query,result.TotalRecordCount);$('#items',page).html(html).trigger('create').lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex=query.StartIndex+query.Limit;loadItems(page,query);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex=query.StartIndex-query.Limit;loadItems(page,query);});$('.selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;loadItems(page,query);});Dashboard.hideLoadingMsg();});}
$(document).on('pageinit',"#itemByNameDetailPage",function(){var page=this;$('.btnPlay',page).on('click',function(){var userdata=currentItem.UserData||{};LibraryBrowser.showPlayMenu(this,currentItem.Id,currentItem.Type,false,"Audio",userdata.PlaybackPositionTicks);});$('.itemsContainer',page).on('playallfromhere',function(e,index){LibraryBrowser.playAllFromHere(_childrenItemsFunction,index);}).on('queueallfromhere',function(e,index){LibraryBrowser.queueAllFromHere(_childrenItemsFunction,index);});$('.btnMoreCommands',page).on('click',function(){var button=this;Dashboard.getCurrentUser().done(function(user){LibraryBrowser.showMoreCommands(button,currentItem.Id,LibraryBrowser.getMoreCommands(currentItem,user));});});$('.btnSync',page).on('click',function(){SyncManager.showMenu({items:[currentItem]});});}).on('pageshow',"#itemByNameDetailPage",function(){var page=this;reload(page);}).on('pagehide',"#itemByNameDetailPage",function(){currentItem=null;});})(jQuery,document,LibraryBrowser);(function($,document,LibraryBrowser,window){var currentItem;function getExternalPlayUrl(item){var providerIds=item.ProviderIds||{};if(item.GameSystem=="Nintendo"&&item.MediaType=="Game"&&providerIds.NesBox&&providerIds.NesBoxRom){return"http://nesbox.com/game/"+providerIds.NesBox+'/rom/'+providerIds.NesBoxRom;}
if(item.GameSystem=="Super Nintendo"&&item.MediaType=="Game"&&providerIds.NesBox&&providerIds.NesBoxRom){return"http://snesbox.com/game/"+providerIds.NesBox+'/rom/'+providerIds.NesBoxRom;}
return null;}
function reload(page){var id=getParameterByName('id');Dashboard.showLoadingMsg();ApiClient.getItem(Dashboard.getCurrentUserId(),id).done(function(item){reloadFromItem(page,item);});}
function reloadFromItem(page,item){currentItem=item;var context=getContext(item);renderHeader(page,item,context);LibraryBrowser.renderName(item,$('.itemName',page),false,context);LibraryBrowser.renderParentName(item,$('.parentName',page),context);Dashboard.getCurrentUser().done(function(user){renderImage(page,item,user);setInitialCollapsibleState(page,item,context,user);renderDetails(page,item,context);LibraryBrowser.renderDetailPageBackdrop(page,item);var externalPlayUrl=getExternalPlayUrl(item);$('.btnPlayExternal',page).attr('href',externalPlayUrl||'#');if(externalPlayUrl){$('.btnPlayExternal',page).removeClass('hide');$('.btnPlay',page).addClass('hide');}
else if(MediaController.canPlay(item)){$('.btnPlay',page).removeClass('hide');$('.btnPlayExternal',page).addClass('hide');}
else{$('.btnPlay',page).addClass('hide');$('.btnPlayExternal',page).addClass('hide');}
if(item.LocalTrailerCount&&item.PlayAccess=='Full'){$('.btnPlayTrailer',page).removeClass('hide');}else{$('.btnPlayTrailer',page).addClass('hide');}
if(SyncManager.isAvailable(item,user)){$('.btnSync',page).removeClass('hide');}else{$('.btnSync',page).addClass('hide');}
if(!item.LocalTrailerCount&&item.RemoteTrailers.length&&item.PlayAccess=='Full'){$('.btnPlayExternalTrailer',page).removeClass('hide').attr('href',item.RemoteTrailers[0].Url);}else{$('.btnPlayExternalTrailer',page).addClass('hide').attr('href','#');}
var groupedVersions=(item.MediaSources||[]).filter(function(g){return g.Type=="Grouping";});if(user.Policy.IsAdministrator&&groupedVersions.length){$('.splitVersionContainer',page).show();}else{$('.splitVersionContainer',page).hide();}
if(LibraryBrowser.getMoreCommands(item,user).length){$('.btnMoreCommands',page).show();}else{$('.btnMoreCommands',page).show();}
if(user.Policy.IsAdministrator){$('.chapterSettingsButton',page).show();}else{$('.chapterSettingsButton',page).hide();}});if(item.LocationType=="Offline"){$('.offlineIndicator',page).show();}
else{$('.offlineIndicator',page).hide();}
var isMissingEpisode=false;if(item.LocationType=="Virtual"&&item.Type=="Episode"){try{if(item.PremiereDate&&(new Date().getTime()>=parseISO8601Date(item.PremiereDate,{toLocal:true}).getTime())){isMissingEpisode=true;}}catch(err){}}
if(isMissingEpisode){$('.missingIndicator',page).show();}
else{$('.missingIndicator',page).hide();}
setPeopleHeader(page,item);$(page).trigger('displayingitem',[{item:item,context:context}]);Dashboard.hideLoadingMsg();}
function renderImage(page,item,user){var imageHref=user.Policy.IsAdministrator&&item.MediaType!='Photo'?"edititemimages.html?id="+item.Id:"";LibraryBrowser.renderDetailImage($('.detailImageContainer',page),item,imageHref);}
function onWebSocketMessage(e,data){var msg=data;var page=$.mobile.activePage;if(msg.MessageType==="UserDataChanged"){if(currentItem&&msg.Data.UserId==Dashboard.getCurrentUserId()){var key=currentItem.UserData.Key;var userData=msg.Data.UserDataList.filter(function(u){return u.Key==key;})[0];if(userData){currentItem.UserData=userData;renderUserDataIcons(page,currentItem);Dashboard.getCurrentUser().done(function(user){renderImage(page,currentItem,user);});}}}}
function setPeopleHeader(page,item){if(item.Type=="Audio"||item.Type=="MusicAlbum"||item.MediaType=="Book"||item.MediaType=="Photo"){$('#peopleHeader',page).html(Globalize.translate('HeaderPeople'));}else{$('#peopleHeader',page).html(Globalize.translate('HeaderCastAndCrew'));}}
function getContext(item){var context=getParameterByName('context');if(context){return context;}
if(item.Type=="Episode"||item.Type=="Series"||item.Type=="Season"){return"tv";}
if(item.Type=="Movie"||item.Type=="Trailer"){return"movies";}
if(item.Type=="Audio"||item.Type=="MusicAlbum"||item.Type=="MusicArtist"||item.Type=="MusicVideo"){return"music";}
if(item.MediaType=="Game"){return"games";}
if(item.Type=="BoxSet"){return"boxsets";}
return"";}
function renderHeader(page,item,context){$('.itemTabs',page).hide();$('.channelHeader',page).hide();var elem;if(context=='home'){elem=$('.homeTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeHome',page).addClass('ui-btn-active');}
else if(context=='home-nextup'){elem=$('.homeTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeNextUp',page).addClass('ui-btn-active');}
else if(context=='home-favorites'){elem=$('.homeTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeFavorites',page).addClass('ui-btn-active');}
else if(context=='home-upcoming'){elem=$('.homeTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeUpcoming',page).addClass('ui-btn-active');}
else if(context=='home-latest'){elem=$('.homeTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeLatest',page).addClass('ui-btn-active');}
else if(context=='photos'||context=='photos-photos'){elem=$('.photoTabs',page).show();$('a',elem).removeClass('ui-btn-active');$('.lnkHomeLatest',page).addClass('ui-btn-active');if(context=='photos-photos'){$('.lnkPhotos',page).addClass('ui-btn-active');}
else if(context=='photos-videos'){$('.lnkVideos',page).addClass('ui-btn-active');}else{$('.lnkPhotoAlbums',page).addClass('ui-btn-active');}}
else if(context=='movies'||context=='movies-trailers'){elem=$('#movieTabs',page).show();$('a',elem).removeClass('ui-btn-active');if(item.Type=='BoxSet'){$('.lnkCollections',page).addClass('ui-btn-active');}
else if(context=='movies-trailers'){$('.lnkMovieTrailers',page).addClass('ui-btn-active');}
else{$('.lnkMovies',page).addClass('ui-btn-active');}}
else if(context=='channels'){elem=$('.channelTabs',page).show();}
else if(item.Type=="MusicAlbum"){$('#albumTabs',page).show();}
else if(item.Type=="MusicVideo"){$('#musicVideoTabs',page).show();}
else if(item.Type=="Audio"){$('#songTabs',page).show();}
else if(item.Type=="ChannelVideoItem"||item.Type=="ChannelAudioItem"||item.Type=="ChannelFolderItem"){$('#channelTabs',page).show();$('.channelHeader',page).show().html('<a href="channelitems.html?id='+item.ChannelId+'">'+item.ChannelName+'</a>').trigger('create');}
else if(item.Type=="BoxSet"){$('#boxsetTabs',page).show();}
else if(item.MediaType=="Game"){$('#gameTabs',page).show();}
else if(item.Type=="GameSystem"){$('#gameSystemTabs',page).show();}
else if(item.Type=="Episode"||item.Type=="Season"||item.Type=="Series"){$('#tvShowsTabs',page).show();}}
function setInitialCollapsibleState(page,item,context,user){$('.collectionItems',page).empty();if(item.IsFolder){if(item.Type=="BoxSet"){$('#childrenCollapsible',page).addClass('hide');}else{$('#childrenCollapsible',page).removeClass('hide');}
renderChildren(page,item,user,context);}
else{$('#childrenCollapsible',page).addClass('hide');}
if(item.MediaSources&&item.MediaSources.length){renderMediaSources(page,item);}
var chapters=item.Chapters||[];if(!chapters.length){$('#scenesCollapsible',page).hide();}else{$('#scenesCollapsible',page).show();renderScenes(page,item,user,3);}
if(!item.SpecialFeatureCount||item.SpecialFeatureCount==0||item.Type=="Series"){$('#specialsCollapsible',page).addClass('hide');}else{$('#specialsCollapsible',page).removeClass('hide');renderSpecials(page,item,user,6);}
if(!item.People||!item.People.length){$('#castCollapsible',page).hide();}else{$('#castCollapsible',page).show();renderCast(page,item,context,6);}
if(item.PartCount&&item.PartCount>1){$('#additionalPartsCollapsible',page).removeClass('hide');renderAdditionalParts(page,item,user);}else{$('#additionalPartsCollapsible',page).addClass('hide');}
$('#themeSongsCollapsible',page).hide();$('#themeVideosCollapsible',page).hide();if(item.Type=="MusicAlbum"){renderMusicVideos(page,item,user);}else{$('#musicVideosCollapsible',page).hide();}
renderThemeMedia(page,item,user);renderCriticReviews(page,item,1);}
function renderDetails(page,item,context){renderSimilarItems(page,item,context);renderSiblingLinks(page,item,context);if(item.Taglines&&item.Taglines.length){$('#itemTagline',page).html(item.Taglines[0]).show();}else{$('#itemTagline',page).hide();}
LibraryBrowser.renderOverview($('.itemOverview',page),item);$('.itemCommunityRating',page).html(LibraryBrowser.getRatingHtml(item));LibraryBrowser.renderBudget($('#itemBudget',page),item);LibraryBrowser.renderRevenue($('#itemRevenue',page),item);LibraryBrowser.renderAwardSummary($('#awardSummary',page),item);$('.itemMiscInfo',page).html(LibraryBrowser.getMiscInfoHtml(item));LibraryBrowser.renderGenres($('.itemGenres',page),item,context);LibraryBrowser.renderStudios($('.itemStudios',page),item,context);renderUserDataIcons(page,item);LibraryBrowser.renderLinks($('.itemExternalLinks',page),item);$('.criticRatingScore',page).html((item.CriticRating||'0')+'%');if(item.CriticRatingSummary){$('#criticRatingSummary',page).show();$('.criticRatingSummaryText',page).html(item.CriticRatingSummary);}else{$('#criticRatingSummary',page).hide();}
renderTags(page,item);renderKeywords(page,item);renderSeriesAirTime(page,item,context);if(item.Players){$('#players',page).show().html(item.Players+' Player');}else{$('#players',page).hide();}
if(item.ArtistItems&&item.ArtistItems.length&&item.Type!="MusicAlbum"){$('#artist',page).show().html(getArtistLinksHtml(item.ArtistItems,context)).trigger('create');}else{$('#artist',page).hide();}
if(item.MediaSources&&item.MediaSources.length&&item.Path){$('.audioVideoMediaInfo',page).removeClass('hide');}else{$('.audioVideoMediaInfo',page).addClass('hide');}
if(item.MediaType=='Photo'){$('.photoInfo',page).removeClass('hide');renderPhotoInfo(page,item);}else{$('.photoInfo',page).addClass('hide');}
renderTabButtons(page,item);}
function renderPhotoInfo(page,item){var html='';var attributes=[];if(item.CameraMake){attributes.push(createAttribute(Globalize.translate('MediaInfoCameraMake'),item.CameraMake));}
if(item.CameraModel){attributes.push(createAttribute(Globalize.translate('MediaInfoCameraModel'),item.CameraModel));}
if(item.Altitude){attributes.push(createAttribute(Globalize.translate('MediaInfoAltitude'),item.Altitude.toFixed(1)));}
if(item.Aperture){attributes.push(createAttribute(Globalize.translate('MediaInfoAperture'),'F'+item.Aperture.toFixed(1)));}
if(item.ExposureTime){var val=1/item.ExposureTime;attributes.push(createAttribute(Globalize.translate('MediaInfoExposureTime'),'1/'+val+' s'));}
if(item.FocalLength){attributes.push(createAttribute(Globalize.translate('MediaInfoFocalLength'),item.FocalLength.toFixed(1)+' mm'));}
if(item.ImageOrientation){attributes.push(createAttribute(Globalize.translate('MediaInfoOrientation'),item.ImageOrientation));}
if(item.IsoSpeedRating){attributes.push(createAttribute(Globalize.translate('MediaInfoIsoSpeedRating'),item.IsoSpeedRating));}
if(item.Latitude){attributes.push(createAttribute(Globalize.translate('MediaInfoLatitude'),item.Latitude.toFixed(1)));}
if(item.Longitude){attributes.push(createAttribute(Globalize.translate('MediaInfoLongitude'),item.Longitude.toFixed(1)));}
if(item.ShutterSpeed){attributes.push(createAttribute(Globalize.translate('MediaInfoShutterSpeed'),item.ShutterSpeed));}
if(item.Software){attributes.push(createAttribute(Globalize.translate('MediaInfoSoftware'),item.Software));}
html+=attributes.join('<br/>');$('.photoInfoContent',page).html(html).trigger('create');}
function renderTabButtons(page,item){var elem=$('.tabDetails',page)[0];var text=elem.textContent||elem.innerText||'';if(text.trim()){$('.detailsSection',page).removeClass('hide');}else{$('.detailsSection',page).addClass('hide');}}
function getArtistLinksHtml(artists,context){var html=[];for(var i=0,length=artists.length;i<length;i++){var artist=artists[i];html.push('<a class="textlink" href="itembynamedetails.html?context='+context+'&id='+artist.Id+'">'+artist.Name+'</a>');}
html=html.join(' / ');if(artists.length==1){return Globalize.translate('ValueArtist',html);}
if(artists.length>1){return Globalize.translate('ValueArtists',html);}
return html;}
function renderSiblingLinks(page,item,context){$('.lnkSibling',page).addClass('hide');if((item.Type!="Episode"&&item.Type!="Season"&&item.Type!="Audio"&&item.Type!="Photo")){return;}
var promise;if(item.Type=="Season"){promise=ApiClient.getSeasons(item.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:item.Id});}
else if(item.Type=="Episode"&&item.SeasonId){promise=ApiClient.getEpisodes(item.SeriesId,{seasonId:item.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:item.Id});}else{promise=ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:item.Id,ParentId:item.ParentId,SortBy:'SortName'});}
context=context||'';promise.done(function(result){var foundExisting=false;for(var i=0,length=result.Items.length;i<length;i++){var curr=result.Items[i];if(curr.Id==item.Id){foundExisting=true;}
else if(!foundExisting){$('.lnkPreviousItem',page).removeClass('hide').attr('href','itemdetails.html?id='+curr.Id+'&context='+context);}
else{$('.lnkNextItem',page).removeClass('hide').attr('href','itemdetails.html?id='+curr.Id+'&context='+context);}}});}
function renderSimilarItems(page,item,context){var promise;var options={userId:Dashboard.getCurrentUserId(),limit:5,fields:"PrimaryImageAspectRatio,UserData,SyncInfo"};if(item.Type=="Movie"){promise=ApiClient.getSimilarMovies(item.Id,options);}
else if(item.Type=="Trailer"||(item.Type=="ChannelVideoItem"&&item.ExtraType=="Trailer")){promise=ApiClient.getSimilarTrailers(item.Id,options);}
else if(item.Type=="MusicAlbum"){options.limit=4;promise=ApiClient.getSimilarAlbums(item.Id,options);}
else if(item.Type=="Series"){promise=ApiClient.getSimilarShows(item.Id,options);}
else if(item.MediaType=="Game"){promise=ApiClient.getSimilarGames(item.Id,options);}else{$('#similarCollapsible',page).hide();return;}
promise.done(function(result){if(!result.Items.length){$('#similarCollapsible',page).hide();return;}
var elem=$('#similarCollapsible',page).show();$('.detailSectionHeader',elem).html(Globalize.translate('HeaderIfYouLikeCheckTheseOut',item.Name));var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:item.Type=="MusicAlbum"?"detailPageSquare":"detailPagePortrait",showParentTitle:item.Type=="MusicAlbum",centerText:item.Type!="MusicAlbum",showTitle:item.Type=="MusicAlbum"||item.Type=="Game",borderless:item.Type=="Game",context:context,overlayText:item.Type!="MusicAlbum"});$('#similarContent',page).html(html).lazyChildren();});}
function renderSeriesAirTime(page,item,context){if(item.Type!="Series"){$('#seriesAirTime',page).hide();return;}
var html='';if(item.AirDays&&item.AirDays.length){html+=item.AirDays.length==7?'daily':item.AirDays.map(function(a){return a+"s";}).join(',');}
if(item.AirTime){html+=' at '+item.AirTime;}
if(item.Studios.length){html+=' on <a class="textlink" href="itembynamedetails.html?context='+context+'&id='+item.Studios[0].Id+'">'+item.Studios[0].Name+'</a>';}
if(html){html=(item.Status=='Ended'?'Aired ':'Airs ')+html;$('#seriesAirTime',page).show().html(html).trigger('create');}else{$('#seriesAirTime',page).hide();}}
function renderTags(page,item){if(item.Tags&&item.Tags.length){var html='';html+='<p>'+Globalize.translate('HeaderTags')+'</p>';for(var i=0,length=item.Tags.length;i<length;i++){html+='<div class="itemTag">'+item.Tags[i]+'</div>';}
$('.itemTags',page).show().html(html);}else{$('.itemTags',page).hide();}}
function renderKeywords(page,item){if(item.Keywords&&item.Keywords.length){var html='';html+='<p>'+Globalize.translate('HeaderPlotKeywords')+'</p>';for(var i=0,length=item.Keywords.length;i<length;i++){html+='<div class="itemTag">'+item.Keywords[i]+'</div>';}
$('.itemKeywords',page).show().html(html);}else{$('.itemKeywords',page).hide();}}
function getEpisodesFunction(seriesId,query){query=$.extend({},query);return function(index,limit,fields){query.StartIndex=index;query.Limit=limit;query.Fields=fields;return ApiClient.getEpisodes(seriesId,query);};}
function getAlbumSongsFunction(query){query=$.extend({},query);return function(index,limit,fields){query.StartIndex=index;query.Limit=limit;query.Fields=fields;return ApiClient.getItems(Dashboard.getCurrentUserId(),query);};}
var _childrenItemsFunction=null;function renderChildren(page,item,user,context){_childrenItemsFunction=null;var fields="ItemCounts,AudioInfo,PrimaryImageAspectRatio,SyncInfo";var query={ParentId:item.Id,Fields:fields};if(item.Type!=="BoxSet"){query.SortBy="SortName";}
var promise;if(item.Type=="Series"){promise=ApiClient.getSeasons(item.Id,{userId:user.Id,Fields:fields});}
else if(item.Type=="Season"){promise=ApiClient.getEpisodes(item.SeriesId,{seasonId:item.Id,userId:user.Id,Fields:fields});_childrenItemsFunction=getEpisodesFunction(item.SeriesId,{seasonId:item.Id,userId:user.Id});}
else if(item.Type=="MusicAlbum"){_childrenItemsFunction=getAlbumSongsFunction(query);}
promise=promise||ApiClient.getItems(Dashboard.getCurrentUserId(),query);promise.done(function(result){var html='';var trigger=false;if(item.Type=="MusicAlbum"){html=LibraryBrowser.getListViewHtml({items:result.Items,smallIcon:true,showIndex:true,index:'disc',showIndexNumber:true,playFromHere:true,defaultAction:'playallfromhere'});trigger=true;}
else if(item.Type=="Series"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"detailPagePortrait",showTitle:false,centerText:true,context:context,overlayText:true});}
else if(item.Type=="Season"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"detailPage169",showTitle:true,displayAsSpecial:item.Type=="Season"&&item.IndexNumber,context:context,playFromHere:true,overlayText:true});}
else if(item.Type=="GameSystem"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:true,centerText:true,context:context});}
var elem=$('.childrenItemsContainer',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
if(item.Type=="BoxSet"){var collectionItemTypes=[{name:Globalize.translate('HeaderMovies'),type:'Movie'},{name:Globalize.translate('HeaderSeries'),type:'Series'},{name:Globalize.translate('HeaderAlbums'),type:'MusicAlbum'},{name:Globalize.translate('HeaderGames'),type:'Game'},{name:Globalize.translate('HeaderBooks'),type:'Book'}];renderCollectionItems(page,collectionItemTypes,result.Items,user,context);}});if(item.Type=="Season"){$('#childrenTitle',page).html(Globalize.translate('HeaderEpisodes'));}
else if(item.Type=="Series"){$('#childrenTitle',page).html(Globalize.translate('HeaderSeasons'));}
else if(item.Type=="MusicAlbum"){$('#childrenTitle',page).html(Globalize.translate('HeaderTracks'));}
else if(item.Type=="GameSystem"){$('#childrenTitle',page).html(Globalize.translate('HeaderGames'));}
else{$('#childrenTitle',page).html(Globalize.translate('HeaderItems'));}}
function renderCollectionItems(page,types,items,user){for(var i=0,length=types.length;i<length;i++){var type=types[i];var typeItems=items.filter(function(curr){return curr.Type==type.type;});if(typeItems.length){renderCollectionItemType(page,type,typeItems,user);}}
var otherType={name:Globalize.translate('HeaderOtherItems')};var otherTypeItems=items.filter(function(curr){return!types.filter(function(t){return t.type==curr.Type;}).length;});if(otherTypeItems.length){renderCollectionItemType(page,otherType,otherTypeItems,user);}
if(!items.length){renderCollectionItemType(page,{name:Globalize.translate('HeaderItems')},items,user);}
$('.collectionItems',page).trigger('create').createCardMenus();}
function renderCollectionItemType(page,type,items,user,context){var html='';html+='<div class="detailSection">';html+='<div class="detailSectionHeader" style="position: relative;">';html+='<span>'+type.name+'</span>';if(user.Policy.IsAdministrator){html+='<a class="detailSectionHeaderButton" href="editcollectionitems.html?id='+currentItem.Id+'" data-role="button" data-icon="edit" data-iconpos="notext" data-inline="true">'+Globalize.translate('ButtonEdit')+'</a>';}
html+='</div>';html+='<div class="detailSectionContent">';var shape=type.type=='MusicAlbum'?'detailPageSquare':'detailPagePortrait';html+=LibraryBrowser.getPosterViewHtml({items:items,shape:shape,showTitle:true,centerText:true,context:context});html+='</div>';html+='</div>';$('.collectionItems',page).append(html);}
function renderUserDataIcons(page,item){$('.userDataIcons',page).html(LibraryBrowser.getUserDataIconsHtml(item));}
function renderCriticReviews(page,item,limit){if(item.Type!="Movie"&&item.Type!="Trailer"&&item.Type!="MusicVideo"){$('#criticReviewsCollapsible',page).hide();return;}
var options={};if(limit){options.limit=limit;}
ApiClient.getCriticReviews(item.Id,options).done(function(result){if(result.TotalRecordCount||item.CriticRatingSummary||item.AwardSummary){$('#criticReviewsCollapsible',page).show();renderCriticReviewsContent(page,result,limit);}else{$('#criticReviewsCollapsible',page).hide();}});}
function renderCriticReviewsContent(page,result,limit){var html='';var reviews=result.Items;for(var i=0,length=reviews.length;i<length;i++){var review=reviews[i];html+='<div class="criticReview">';html+='<div class="reviewScore">';if(review.Score!=null){html+=review.Score;}
else if(review.Likes!=null){if(review.Likes){html+='<img src="css/images/fresh.png" />';}else{html+='<img src="css/images/rotten.png" />';}}
html+='</div>';html+='<div class="reviewCaption">'+review.Caption+'</div>';var vals=[];if(review.ReviewerName){vals.push(review.ReviewerName);}
if(review.Publisher){vals.push(review.Publisher);}
html+='<div class="reviewerName">'+vals.join(', ')+'.';if(review.Date){try{var date=parseISO8601Date(review.Date,{toLocal:true}).toLocaleDateString();html+='<span class="reviewDate">'+date+'</span>';}
catch(error){}}
html+='</div>';if(review.Url){html+='<div class="reviewLink"><a class="textlink" href="'+review.Url+'" target="_blank">'+Globalize.translate('ButtonFullReview')+'</a></div>';}
html+='</div>';}
if(limit&&result.TotalRecordCount>limit){html+='<p style="margin: 0;padding-left: .5em;"><button class="moreCriticReviews" data-inline="true" data-mini="true">'+Globalize.translate('ButtonMoreItems')+'</button></p>';}
$('#criticReviewsContent',page).html(html).trigger('create');}
function renderThemeMedia(page,item){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),item.Id,true).done(function(result){var themeSongs=result.ThemeSongsResult.OwnerId==item.Id?result.ThemeSongsResult.Items:[];var themeVideos=result.ThemeVideosResult.OwnerId==item.Id?result.ThemeVideosResult.Items:[];renderThemeSongs(page,themeSongs);renderThemeVideos(page,themeVideos);$(page).trigger('thememediadownload',[result]);});}
function renderThemeSongs(page,items){if(items.length){$('#themeSongsCollapsible',page).show();var html=LibraryBrowser.getListViewHtml({items:items,smallIcon:true});$('#themeSongsContent',page).html(html).trigger('create');}else{$('#themeSongsCollapsible',page).hide();}}
function renderThemeVideos(page,items,user){if(items.length){$('#themeVideosCollapsible',page).show();$('#themeVideosContent',page).html(getVideosHtml(items,user)).trigger('create');}else{$('#themeVideosCollapsible',page).hide();}}
function renderMusicVideos(page,item,user){ApiClient.getItems(user.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:true,Fields:"DateCreated,SyncInfo",Albums:item.Name}).done(function(result){if(result.Items.length){$('#musicVideosCollapsible',page).show();$('#musicVideosContent',page).html(getVideosHtml(result.Items,user)).trigger('create');}else{$('#musicVideosCollapsible',page).hide();}});}
function renderAdditionalParts(page,item,user){ApiClient.getAdditionalVideoParts(user.Id,item.Id).done(function(result){if(result.Items.length){$('#additionalPartsCollapsible',page).show();$('#additionalPartsContent',page).html(getVideosHtml(result.Items,user)).trigger('create');}else{$('#additionalPartsCollapsible',page).hide();}});}
function renderScenes(page,item,user,limit){var html='';var chapters=item.Chapters||[];for(var i=0,length=chapters.length;i<length;i++){if(limit&&i>=limit){break;}
var chapter=chapters[i];var chapterName=chapter.Name||"Chapter "+i;var onclick=item.PlayAccess=='Full'?' onclick="ItemDetailPage.play('+chapter.StartPositionTicks+');"':'';html+='<a class="card detailPage169Card" href="#play-Chapter-'+i+'"'+onclick+'>';html+='<div class="cardBox">';html+='<div class="cardScalable">';var imgUrl;if(chapter.ImageTag){imgUrl=ApiClient.getScaledImageUrl(item.Id,{maxWidth:210,tag:chapter.ImageTag,type:"Chapter",index:i});}else{imgUrl="css/images/items/list/chapter.png";}
html+='<div class="cardPadder"></div>';html+='<div class="cardContent">';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');"></div>';html+='<div class="cardFooter">';html+='<div class="cardText">'+chapterName+'</div>';html+='<div class="cardText">';html+=Dashboard.getDisplayTime(chapter.StartPositionTicks);html+='</div>';html+="</div>";html+='</div>';html+='</div>';html+='</div>';html+='</a>';}
if(limit&&chapters.length>limit){html+='<p style="margin: 0;padding-left: .5em;"><button class="moreScenes" data-inline="true" data-mini="true">'+Globalize.translate('ButtonMoreItems')+'</button></p>';}
$('#scenesContent',page).html(html).trigger('create');}
function renderMediaSources(page,item){var html=item.MediaSources.map(function(v){return getMediaSourceHtml(item,v);}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');if(item.MediaSources.length>1){html='<br/>'+html;}
$('#mediaInfoContent',page).html(html).trigger('create');}
function getMediaSourceHtml(item,version){var html='';if(version.Name&&item.MediaSources.length>1){html+='<div><span class="mediaInfoAttribute">'+version.Name+'</span></div><br/>';}
for(var i=0,length=version.MediaStreams.length;i<length;i++){var stream=version.MediaStreams[i];if(stream.Type=="Data"){continue;}
html+='<div class="mediaInfoStream">';var displayType=Globalize.translate('MediaInfoStreamType'+stream.Type);html+='<div class="mediaInfoStreamType">'+displayType+'</div>';var attributes=[];if(stream.Language&&stream.Type!="Video"){attributes.push(createAttribute(Globalize.translate('MediaInfoLanguage'),stream.Language));}
if(stream.Codec){attributes.push(createAttribute(Globalize.translate('MediaInfoCodec'),stream.Codec.toUpperCase()));}
if(stream.Profile){attributes.push(createAttribute(Globalize.translate('MediaInfoProfile'),stream.Profile));}
if(stream.Level){attributes.push(createAttribute(Globalize.translate('MediaInfoLevel'),stream.Level));}
if(stream.Width||stream.Height){attributes.push(createAttribute(Globalize.translate('MediaInfoResolution'),stream.Width+'x'+stream.Height));}
if(stream.AspectRatio&&stream.Codec!="mjpeg"){attributes.push(createAttribute(Globalize.translate('MediaInfoAspectRatio'),stream.AspectRatio));}
if(stream.Type=="Video"){if(stream.IsAnamorphic!=null){attributes.push(createAttribute(Globalize.translate('MediaInfoAnamorphic'),(stream.IsAnamorphic?'Yes':'No')));}
attributes.push(createAttribute(Globalize.translate('MediaInfoInterlaced'),(stream.IsInterlaced?'Yes':'No')));}
if(stream.AverageFrameRate||stream.RealFrameRate){attributes.push(createAttribute(Globalize.translate('MediaInfoFramerate'),(stream.AverageFrameRate||stream.RealFrameRate)));}
if(stream.ChannelLayout){attributes.push(createAttribute(Globalize.translate('MediaInfoLayout'),stream.ChannelLayout));}
if(stream.Channels){attributes.push(createAttribute(Globalize.translate('MediaInfoChannels'),stream.Channels+' ch'));}
if(stream.BitRate&&stream.Codec!="mjpeg"){attributes.push(createAttribute(Globalize.translate('MediaInfoBitrate'),(parseInt(stream.BitRate/1024))+' kbps'));}
if(stream.SampleRate){attributes.push(createAttribute(Globalize.translate('MediaInfoSampleRate'),stream.SampleRate+' khz'));}
if(stream.BitDepth){attributes.push(createAttribute(Globalize.translate('MediaInfoBitDepth'),stream.BitDepth+' bit'));}
if(stream.PixelFormat){attributes.push(createAttribute(Globalize.translate('MediaInfoPixelFormat'),stream.PixelFormat));}
if(stream.RefFrames){attributes.push(createAttribute(Globalize.translate('MediaInfoRefFrames'),stream.RefFrames));}
if(stream.KeyFrames){}
if(stream.Type!="Video"){attributes.push(createAttribute(Globalize.translate('MediaInfoDefault'),(stream.IsDefault?'Yes':'No')));}
if(stream.Type=="Subtitle"){attributes.push(createAttribute(Globalize.translate('MediaInfoForced'),(stream.IsForced?'Yes':'No')));attributes.push(createAttribute(Globalize.translate('MediaInfoExternal'),(stream.IsExternal?'Yes':'No')));}
if(stream.Type=="Video"&&version.Timestamp){attributes.push(createAttribute(Globalize.translate('MediaInfoTimestamp'),version.Timestamp));}
if(stream.IsCabac!=null){attributes.push(createAttribute(Globalize.translate('CABAC'),(stream.IsCabac?'Yes':'No')));}
html+=attributes.join('<br/>');html+='</div>';}
if(version.Container){html+='<div><span class="mediaInfoLabel">'+Globalize.translate('MediaInfoContainer')+'</span><span class="mediaInfoAttribute">'+version.Container+'</span></div>';}
if(version.Formats&&version.Formats.length){}
if(version.Path&&version.Protocol!='Http'){html+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate('MediaInfoPath')+'</span><span class="mediaInfoAttribute">'+version.Path+'</span></div>';}
if(version.Size){var size=(version.Size/(1024*1024)).toFixed(0);html+='<div><span class="mediaInfoLabel">'+Globalize.translate('MediaInfoSize')+'</span><span class="mediaInfoAttribute">'+size+' MB</span></div>';}
return html;}
function createAttribute(label,value){return'<span class="mediaInfoLabel">'+label+'</span><span class="mediaInfoAttribute">'+value+'</span>'}
function getVideosHtml(items,user,limit,moreButtonClass){var html='';for(var i=0,length=items.length;i<length;i++){if(limit&&i>=limit){break;}
var item=items[i];var cssClass="card detailPage169Card";var href="itemdetails.html?id="+item.Id;var onclick=item.PlayAccess=='Full'?' onclick="MediaController.play(\''+item.Id+'\'); return false;"':"";html+='<a class="'+cssClass+'" href="'+href+'"'+onclick+'>';html+='<div class="cardBox">';html+='<div class="cardScalable">';var imageTags=item.ImageTags||{};var imgUrl;if(imageTags.Primary){imgUrl=ApiClient.getScaledImageUrl(item.Id,{maxWidth:210,tag:imageTags.Primary,type:"primary"});}else{imgUrl="css/images/items/detail/video.png";}
html+='<div class="cardPadder"></div>';html+='<div class="cardContent">';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');"></div>';html+='<div class="cardFooter">';html+='<div class="cardText">'+item.Name+'</div>';html+='<div class="cardText">';if(item.RunTimeTicks!=""){html+=Dashboard.getDisplayTime(item.RunTimeTicks);}
else{html+="&nbsp;";}
html+='</div>';html+="</div>";html+='</div>';html+='</div>';html+='</div>';html+='</a>';}
if(limit&&items.length>limit){html+='<p style="margin: 0;padding-left: .5em;"><button class="'+moreButtonClass+'" data-inline="true" data-mini="true">'+Globalize.translate('ButtonMoreItems')+'</button></p>';}
return html;}
function renderSpecials(page,item,user,limit){ApiClient.getSpecialFeatures(user.Id,item.Id).done(function(specials){$('#specialsContent',page).html(getVideosHtml(specials,user,limit,"moreSpecials")).trigger('create');});}
function renderCast(page,item,context,limit){var html='';var casts=item.People||[];for(var i=0,length=casts.length;i<length;i++){if(limit&&i>=limit){break;}
var cast=casts[i];html+='<a class="tileItem smallPosterTileItem" href="itembynamedetails.html?context='+context+'&id='+cast.Id+'">';var imgUrl;if(cast.PrimaryImageTag){imgUrl=ApiClient.getScaledImageUrl(cast.Id,{width:100,tag:cast.PrimaryImageTag,type:"primary"});}else{imgUrl="css/images/items/list/person.png";}
html+='<div class="tileImage" style="background-image:url(\''+imgUrl+'\');"></div>';html+='<div class="tileContent">';html+='<p>'+cast.Name+'</p>';var role=cast.Role?Globalize.translate('ValueAsRole',cast.Role):cast.Type;if(role=="GuestStar"){role=Globalize.translate('ValueGuestStar');}
role=role||"";var maxlength=40;if(role.length>maxlength){role=role.substring(0,maxlength-3)+'...';}
html+='<p>'+role+'</p>';html+='</div>';html+='</a>';}
if(limit&&casts.length>limit){html+='<p style="margin: 0;padding-left: .5em;"><button class="morePeople" data-inline="true" data-mini="true">'+Globalize.translate('ButtonMoreItems')+'</button></p>';}
$('#castContent',page).html(html).trigger('create');}
function play(startPosition){MediaController.play({items:[currentItem],startPositionTicks:startPosition});}
function splitVersions(page){var id=getParameterByName('id');Dashboard.confirm("Are you sure you wish to split the media sources into separate items?","Split Media Apart",function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+id+"/AlternateSources")}).done(function(){Dashboard.hideLoadingMsg();reload(page);});}});}
function playTrailer(page){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),currentItem.Id).done(function(trailers){MediaController.play({items:trailers});});}
$(document).on('pageinit',"#itemDetailPage",function(){var page=this;$('.btnPlay',page).on('click',function(){var userdata=currentItem.UserData||{};var mediaType=currentItem.MediaType;if(currentItem.Type=="MusicArtist"||currentItem.Type=="MusicAlbum"){mediaType="Audio";}
LibraryBrowser.showPlayMenu(this,currentItem.Id,currentItem.Type,currentItem.IsFolder,mediaType,userdata.PlaybackPositionTicks);});$('.btnPlayTrailer',page).on('click',function(){playTrailer(page);});$('.btnPlayExternal',page).on('click',function(){ApiClient.markPlayed(Dashboard.getCurrentUserId(),currentItem.Id,new Date());});$('.btnSplitVersions',page).on('click',function(){splitVersions(page);});$('.btnSync',page).on('click',function(){SyncManager.showMenu({items:[currentItem]});});$('.btnMoreCommands',page).on('click',function(){var button=this;Dashboard.getCurrentUser().done(function(user){LibraryBrowser.showMoreCommands(button,currentItem.Id,LibraryBrowser.getMoreCommands(currentItem,user));});});$('.childrenItemsContainer',page).on('playallfromhere',function(e,index){LibraryBrowser.playAllFromHere(_childrenItemsFunction,index);}).on('queueallfromhere',function(e,index){LibraryBrowser.queueAllFromHere(_childrenItemsFunction,index);});}).on('pageshow',"#itemDetailPage",function(){var page=this;$(page).on("click.moreScenes",".moreScenes",function(){Dashboard.getCurrentUser().done(function(user){renderScenes(page,currentItem,user);});}).on("click.morePeople",".morePeople",function(){renderCast(page,currentItem,getContext(currentItem));}).on("click.moreSpecials",".moreSpecials",function(){Dashboard.getCurrentUser().done(function(user){renderSpecials(page,currentItem,user);});}).on("click.moreCriticReviews",".moreCriticReviews",function(){renderCriticReviews(page,currentItem);});reload(page);$(ApiClient).on('websocketmessage',onWebSocketMessage);$(LibraryBrowser).on('itemdeleting.detailpage',function(e,itemId){if(currentItem&&currentItem.Id==itemId){Dashboard.navigate('index.html');}});}).on('pagehide',"#itemDetailPage",function(){$(LibraryBrowser).off('itemdeleting.detailpage');currentItem=null;var page=this;$(page).off("click.moreScenes").off("click.morePeople").off("click.moreSpecials").off("click.moreCriticReviews");$(ApiClient).off('websocketmessage',onWebSocketMessage);});function itemDetailPage(){var self=this;self.play=play;}
window.ItemDetailPage=new itemDetailPage();})(jQuery,document,LibraryBrowser,window);(function($,document){var view="Poster";var query={SortBy:"SortName",SortOrder:"Ascending",Fields:"DateCreated,PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};var currentItem;function reloadItems(page){Dashboard.showLoadingMsg();var userId=Dashboard.getCurrentUserId();var parentItemPromise=query.ParentId?ApiClient.getItem(userId,query.ParentId):ApiClient.getRootFolder(userId);var itemsPromise=ApiClient.getItems(userId,query);$.when(parentItemPromise,itemsPromise).done(function(r1,r2){var item=r1[0];currentItem=item;var result=r2[0];$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var context=getParameterByName('context');if(context=='home'){context='folders';}
var defaultAction=currentItem.Type=='PhotoAlbum'?'photoslideshow':null;if(view=="Backdrop"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,centerText:true,preferBackdrop:true,context:context,defaultAction:defaultAction});}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:true,centerText:true,context:context,defaultAction:defaultAction});}
var elem=$('#items',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getParameterByName('parentId'),query);var name=item.Name;if(item.IndexNumber!=null){name=item.IndexNumber+" - "+name;}
if(item.ParentIndexNumber!=null){name=item.ParentIndexNumber+"."+name;}
$('#itemName',page).html(name);Dashboard.setPageTitle(name);$(page).trigger('displayingitem',[{item:item}]);Dashboard.hideLoadingMsg();});Dashboard.getCurrentUser().done(function(user){if(user.Policy.IsAdministrator&&query.ParentId){$('#editButtonContainer',page).show();}else{$('#editButtonContainer',page).hide();}});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
function startSlideshow(page,index){index+=(query.StartIndex||0);var userId=Dashboard.getCurrentUserId();var localQuery=$.extend({},query);localQuery.StartIndex=0;localQuery.Limit=null;localQuery.MediaTypes="Photo";localQuery.Recursive=true;localQuery.Filters="IsNotFolder";ApiClient.getItems(userId,localQuery).done(function(result){showSlideshow(page,result.Items,index);});}
function showSlideshow(page,items,index){var slideshowItems=items.map(function(item){var imgUrl=ApiClient.getScaledImageUrl(item.Id,{tag:item.ImageTags.Primary,type:'Primary'});return{title:item.Name,href:imgUrl};});index=Math.max(index||0,0);$.swipebox(slideshowItems,{initialIndexOnArray:index,hideBarsDelay:30000});}
$(document).on('pageinit',"#itemListPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getParameterByName('parentId'),view);});$('#btnEdit',page).on('click',function(){Dashboard.navigate("edititemmetadata.html?id="+currentItem.Id);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('.itemsContainer',page).on('photoslideshow',function(e,index){startSlideshow(page,index);});}).on('pageshow',"#itemListPage",function(){var page=this;query.Limit=LibraryBrowser.getDefaultPageSize();query.ParentId=getParameterByName('parentId');query.Filters="";query.SortBy="SortName";query.SortOrder="Ascending";query.StartIndex=0;query.NameStartsWithOrGreater='';var key=getParameterByName('parentId');LibraryBrowser.loadSavedQueryValues(key,query);LibraryBrowser.getSavedViewSetting(key).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});updateFilterControls(page);}).on('pagehide',"#itemListPage",function(){currentItem=null;});})(jQuery,document);(function($,document,window){function showSignIn(page){$('.kidsOptionsLogin',page).fadeIn();$('#txtPinCode',page).val('');$('.btnOptions',page).hide();$('.kidContent',page).hide();}
function validatePin(page){}
function loadContent(page){var options={SortBy:"Random",SortOrder:"Descending",MediaTypes:"Video",Limit:100,Recursive:true,Fields:"PrimaryImageAspectRatio",ExcludeLocationTypes:"Virtual",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){$('.itemsContainer',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"horizontalBackdrop",preferThumb:true,overlayText:true,lazy:true,defaultAction:'play',coverImage:true,enableImageEnhancers:false})).lazyChildren();});}
$(document).on('pageshow',"#kidsPage",function(){var page=this;var userId=Dashboard.getCurrentUserId();$('.kidContent',page).hide();$('.kidsWelcome',page).show();$('.lnkPinCode',page).attr('href','myprofile.html?userId='+userId);$('.btnOptions',page).buttonEnabled(false);$('.kidsOptionsLogin',page).hide();$('.kidsOptions',page).hide();$('.kidsBackdropContainer').css('background-image','url(css/images/kids/bg.jpg)');}).on('pageinit',"#kidsPage",function(){var page=this;$('.btnDismissWelcome',page).on('click',function(){$('.kidsWelcome',page).fadeOut();$('.btnOptions',page).buttonEnabled(true);$('.kidContent',page).show();loadContent(page);});$('.btnOptions',page).on('click',function(){showSignIn(page);});$('.btnCancelPin',page).on('click',function(){$('.kidsOptionsLogin',page).fadeOut();$('.btnOptions',page).show();$('.kidContent',page).show();});});window.KidsPage={onPinSubmit:function(){var page=$(this).parents('.page');if(validatePin(page)){$('.kidsOptionsLogin',page).hide();$('.kidsOptions',page).fadeIn();}else{Dashboard.alert({message:'Invalid pin code entered. Please try again.',title:'Input Error'});}
return false;},onOptionsSubmit:function(){var page=$(this).parents('.page');$('.kidsOptions',page).fadeOut();$('.btnOptions',page).show();$('.kidContent',page).show();return false;}};})(jQuery,document,window);(function($,document,window){var currentConfig;function remove(page,index){Dashboard.confirm(Globalize.translate('MessageConfirmPathSubstitutionDeletion'),Globalize.translate('HeaderConfirmDeletion'),function(result){if(result){ApiClient.getServerConfiguration().done(function(config){config.PathSubstitutions.splice(index,1);ApiClient.updateServerConfiguration(config).done(function(){reload(page);});});}});}
function addSubstitution(page,config){config.PathSubstitutions.push({From:$('#txtFrom',page).val(),To:$('#txtTo',page).val()});}
function reloadPathMappings(page,config){var index=0;var html=config.PathSubstitutions.map(function(map){var mapHtml='<tr>';mapHtml+='<td>';mapHtml+='<button class="btnDeletePath" data-index="'+index+'" data-mini="true" data-inline="true" data-icon="delete" data-iconpos="notext" type="button" style="margin:0 .5em 0 0;">Delete</button>';mapHtml+='</td>';mapHtml+='<td style="vertical-align:middle;">';mapHtml+=map.From;mapHtml+='</td>';mapHtml+='<td style="vertical-align:middle;">';mapHtml+=map.To;mapHtml+='</td>';mapHtml+='</tr>';index++;return mapHtml;});var elem=$('.tbodyPathSubstitutions',page).html(html.join('')).parents('table').table('refresh').trigger('create');$('.btnDeletePath',elem).on('click',function(){remove(page,parseInt(this.getAttribute('data-index')));});if(config.PathSubstitutions.length){$('#tblPaths',page).show();}else{$('#tblPaths',page).hide();}}
function loadPage(page,config){currentConfig=config;reloadPathMappings(page,config);Dashboard.hideLoadingMsg();}
function reload(page){$('#txtFrom',page).val('');$('#txtTo',page).val('');ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});}
$(document).on('pageshow',"#libraryPathMappingPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});}).on('pagehide',"#libraryPathMappingPage",function(){currentConfig=null;});window.LibraryPathMappingPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;var page=$(form).parents('.page');ApiClient.getServerConfiguration().done(function(config){addSubstitution(page,config);ApiClient.updateServerConfiguration(config).done(function(){reload(page);});});return false;}};})(jQuery,document,window);(function($,document,window){var defaultSortBy="SortName";var query={SortBy:defaultSortBy,SortOrder:"Ascending",Recursive:true,Fields:"MediaSources,DateCreated,Settings,Studios",StartIndex:0,IncludeItemTypes:"Movie",IsMissing:false,IsVirtualUnaired:false,Limit:200,CollapseBoxSetItems:false};function getHeaderCells(reportType){switch(reportType){case'Season':{return[{},{name:Globalize.translate('HeaderSeries'),sortField:'SeriesSortName,SortName',type:'Series'},{name:Globalize.translate('HeaderSeason'),sortField:'SortName',type:'Season'},{name:Globalize.translate('HeaderSeasonNumber'),type:'Season Number',sortField:'IndexNumber'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'}];}
case'Series':{return[{},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderNetwork'),sortField:'Studio,SortName',type:'Network'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderYear'),sortField:'ProductionYear,PremiereDate,SortName',type:'Year'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderRuntime'),sortField:'Runtime,SortName',type:'Runtime'},{name:Globalize.translate('HeaderTrailers'),type:'Trailers'},{name:Globalize.translate('HeaderSpecials'),type:'Specials'}];}
case'Game':{return[{},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderGameSystem'),sortField:'GameSystem,SortName',type:'Game System'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,GameSystem,SortName',type:'Release Date'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderPlayers'),type:'Players',sortField:'Players,GameSystem,SortName'},{name:Globalize.translate('HeaderTrailers'),type:'Trailers'}];}
case'Audio':{return[{},{name:Globalize.translate('HeaderAlbumArtist'),sortField:'AlbumArtist,Album,SortName',type:'Album Artist'},{name:Globalize.translate('HeaderAlbum'),type:'Album',sortField:'Album,SortName'},{name:Globalize.translate('HeaderDisc'),type:'Disc'},{name:Globalize.translate('HeaderTrack'),type:'Track'},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderRuntime'),sortField:'Runtime,SortName',type:'Runtime'},{name:Globalize.translate('HeaderAudio'),type:'Audio'},{name:Globalize.translate('HeaderEmbeddedImage'),type:'Embedded Image'}];}
case'Episode':{return[{},{name:Globalize.translate('HeaderSeries'),sortField:'SeriesSortName,SortName',type:'Series'},{name:Globalize.translate('HeaderSeason')},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderRuntime'),sortField:'Runtime,SortName',type:'Runtime'},{name:Globalize.translate('HeaderVideo'),type:'Video'},{name:Globalize.translate('HeaderResolution'),type:'Resolution'},{name:Globalize.translate('HeaderAudio'),type:'Audio'},{name:Globalize.translate('HeaderSubtitles'),type:'Subtitles'}];}
case'BoxSet':{return[{},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderTrailers'),type:'Trailers'}];}
case'Book':{return[{},{name:Globalize.translate('HeaderSeries'),type:'Series'},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'}];}
case'MusicArtist':{return[{},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'}];}
case'MusicAlbum':{return[{},{name:Globalize.translate('HeaderAlbumArtist'),sortField:'AlbumArtist,SortName',type:'Album Artist'},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderRuntime'),sortField:'Runtime,SortName',type:'Runtime'}];}
default:{return[{},{name:Globalize.translate('HeaderName'),sortField:'SortName',type:'Name'},{name:Globalize.translate('HeaderDateAdded'),sortField:'DateCreated,SortName',type:'Date Added'},{name:Globalize.translate('HeaderReleaseDate'),sortField:'ProductionYear,PremiereDate,SortName',type:'Release Date'},{name:Globalize.translate('HeaderParentalRating'),sortField:'OfficialRating,SortName',type:'Parental Rating'},{name:Globalize.translate('HeaderCommunityRating'),sortField:'CommunityRating,SortName',type:'Community Rating'},{name:Globalize.translate('HeaderRuntime'),sortField:'Runtime,SortName',type:'Runtime'},{name:Globalize.translate('HeaderVideo'),type:'Video'},{name:Globalize.translate('HeaderResolution'),type:'Resolution'},{name:Globalize.translate('HeaderAudio'),type:'Audio'},{name:Globalize.translate('HeaderSubtitles'),type:'Subtitles'},{name:Globalize.translate('HeaderTrailers'),type:'Trailers'},{name:Globalize.translate('HeaderSpecials'),type:'Specials'}];}}}
function getDefaultSortOrder(reportType){switch(reportType){case'Season':{return"SeriesSortName,SortName";}
case'Series':{return"SortName";}
case'Game':{return"GameSystem,SortName";}
case'Audio':{return"AlbumArtist,Album,SortName";}
case'Episode':{return"SeriesSortName,SortName";}
case'BoxSet':{return"SortName";}
case'Book':{return"SortName";}
case'MusicArtist':{return"SortName";}
case'MusicAlbum':{return"AlbumArtist,SortName";}
default:{return"SortName";}}}
function getItemCellsHtml(item,headercells){var primaryVersion=(item.MediaSources||[])[0]||{};var mediaStreams=primaryVersion.MediaStreams||[];var videoStream=mediaStreams.filter(function(s){return s.Type=='Video';})[0];var audioStream=mediaStreams.filter(function(s){return s.Type=='Audio';})[0];return headercells.map(function(cell){var html='';html+='<td>';switch(cell.type||cell.name){case'Album Artist':{html+=item.AlbumArtist||'&nbsp;';break;}
case'Album':{html+=item.Album||'&nbsp;';break;}
case'Series':{html+=item.SeriesName||'&nbsp;';break;}
case'Game System':{html+=item.GameSystem||'&nbsp;';break;}
case'Network':{html+=item.Studios.length?item.Studios[0].Name:'&nbsp;';break;}
case'Disc':{html+=item.ParentIndexNumber==null?'':item.ParentIndexNumber;break;}
case'Season Number':case'Track':{html+=item.IndexNumber==null?'':item.IndexNumber;break;}
case'Players':{html+=item.Players||'&nbsp;';break;}
case'Audio':{if(audioStream){var name=(audioStream.Codec||'').toUpperCase();html+=name=='DCA'?(audioStream.Profile||'').toUpperCase():name;}
break;}
case'Video':{if(videoStream){html+=(videoStream.Codec||'').toUpperCase();}
break;}
case'Resolution':{if(videoStream&&videoStream.Width){html+=videoStream.Width+"*"+(videoStream.Height||"-");}
break;}
case'Embedded Image':{if(videoStream){html+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}
break;}
case'Subtitles':{var hasSubtitles=mediaStreams.filter(function(s){return s.Type=='Subtitle';}).length;if(hasSubtitles){html+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}
break;}
case'Runtime':{if(item.RunTimeTicks){html+=Dashboard.getDisplayTime(item.RunTimeTicks);}else{html+='&nbsp;';}
break;}
case'Trailers':{if(item.LocalTrailerCount){html+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}
break;}
case'Specials':{if(item.SpecialFeatureCount){html+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>';}
break;}
case'Season':{if(item.Type=="Episode"){html+=item.ParentIndexNumber==null?'':('Season '+item.ParentIndexNumber);}else{html+='<a href="edititemmetadata.html?id='+item.Id+'">'+LibraryBrowser.getPosterViewDisplayName(item,false,false)+'</a>';}
break;}
case'Name':{html+='<a href="edititemmetadata.html?id='+item.Id+'">'+LibraryBrowser.getPosterViewDisplayName(item,false,false)+'</a>';break;}
case'Community Rating':{html+=item.CommunityRating||'&nbsp;';break;}
case'Parental Rating':{html+=item.OfficialRating||'&nbsp;';break;}
case'Year':case'Release Date':{if(item.PremiereDate&&item.Type!="Series"){try{var date=parseISO8601Date(item.PremiereDate,{toLocal:true});html+=date.toLocaleDateString();}
catch(e){html+='&nbsp;';}}
else if(item.ProductionYear){html+=item.ProductionYear;if(item.Status=="Continuing"){html+="-Present";}
else if(item.EndDate){try{var endYear=parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();if(endYear!=item.ProductionYear){html+="-"+parseISO8601Date(item.EndDate,{toLocal:true}).getFullYear();}}
catch(e){console.log("Error parsing date: "+item.EndDate);}}}else{html+='&nbsp;';}
break;}
case'Date Added':{if(item.DateCreated){try{html+=parseISO8601Date(item.DateCreated,{toLocal:true}).toLocaleDateString();}
catch(e){html+='&nbsp;';}}
break;}
default:{if(item.LockData){html+='<img src="css/images/editor/lock.png" />';}
if(item.IsUnidentified){html+='<div class="libraryReportIndicator"><div class="ui-icon-alert ui-btn-icon-notext"></div></div>';}
if(!item.LocalTrailerCount&&item.Type=="Movie"){html+='<img src="css/images/editor/missingtrailer.png" title="Missing local trailer." />';}
if(!item.ImageTags||!item.ImageTags.Primary){html+='<a href="edititemimages.html?id='+item.Id+'"><img src="css/images/editor/missingprimaryimage.png" title="Missing primary image." /></a>';}
if(!item.BackdropImageTags||!item.BackdropImageTags.length){if(item.Type!=="Episode"&&item.Type!=="Season"&&item.MediaType!=="Audio"&&item.Type!=="TvChannel"&&item.Type!=="MusicAlbum"){html+='<a href="edititemimages.html?id='+item.Id+'"><img src="css/images/editor/missingbackdrop.png" title="Missing backdrop image." /></a>';}}
if(!item.ImageTags||!item.ImageTags.Logo){if(item.Type=="Movie"||item.Type=="Trailer"||item.Type=="Series"||item.Type=="MusicArtist"||item.Type=="BoxSet"){html+='<a href="edititemimages.html?id='+item.Id+'"><img src="css/images/editor/missinglogo.png" title="Missing logo image." /></a>';}}
break;}}
html+='</td>';return html;}).join('');}
function getReportHtml(items,reportType,currentSortField,currentSortDirection){var html='';html+='<table id="tblReport" data-role="table" data-mode="reflow" class="tblLibraryReport stripedTable ui-responsive table-stroke detailTable" style="display:table;">';html+='<thead>';html+='<tr>';var cells=getHeaderCells(reportType);html+=cells.map(function(c){var cellHtml='<th data-priority="'+(c.priority||'persist')+'">';if(c.sortField){cellHtml+='<a class="lnkColumnSort" href="#" data-sortfield="'+c.sortField+'" style="text-decoration:underline;">';}
cellHtml+=(c.name||'&nbsp;');if(c.sortField){cellHtml+='</a>';if(c.sortField==currentSortField){if(currentSortDirection=="Descending"){cellHtml+='<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px">&darr;</span>';}else{cellHtml+='<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px;">&uarr;</span>';}}}
cellHtml+='</th>';return cellHtml;}).join('');html+='</tr>';html+='</thead>';html+='<tbody>';for(var i=0,length=items.length;i<length;i++){var item=items[i];html+='<tr>';html+=getItemCellsHtml(item,cells);html+='</tr>';}
html+='</tbody>';html+='</table>';return html;}
function renderItems(page,result,reportType){$(document).scrollTop(0);$('.listTopPaging',page).html(LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,false,[],false)).trigger('create');updateFilterControls(page);$('.listBottomPaging',page).html(LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,false,[],false)).trigger('create');$('.reportContainer',page).html(getReportHtml(result.Items,reportType,query.SortBy,query.SortOrder)).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});$('.lnkColumnSort',page).on('click',function(){var order=this.getAttribute('data-sortfield');if(query.SortBy==order){if(query.SortOrder=="Descending"){query.SortOrder="Ascending";query.SortBy=defaultSortBy;}else{query.SortOrder="Descending";query.SortBy=order;}}else{query.SortOrder="Ascending";query.SortBy=order;}
query.StartIndex=0;reloadItems(page);});}
function reloadItems(page){var url=ApiClient.getUrl("Items",query);var reportType=$('#selectView',page).val();ApiClient.getJSON(url).done(function(result){renderItems(page,result,reportType);});}
function updateFilterControls(page){$('#selectView').val(query.IncludeItemTypes).selectmenu('refresh');$('.chkVideoTypeFilter',page).each(function(){var filters=","+(query.VideoTypes||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#chk3D',page).checked(query.Is3D==true).checkboxradio('refresh');$('#chkHD',page).checked(query.IsHD==true).checkboxradio('refresh');$('#chkSD',page).checked(query.IsHD==false).checkboxradio('refresh');$('#chkSubtitle',page).checked(query.HasSubtitles==true).checkboxradio('refresh');$('#chkNoSubtitle',page).checked(query.HasSubtitles===false).checkboxradio('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkNoTrailer',page).checked(query.HasTrailer==false).checkboxradio('refresh');$('#chkSpecialFeature',page).checked(query.HasSpecialFeature==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkNoThemeSong',page).checked(query.HasThemeSong==false).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('#chkNoThemeVideo',page).checked(query.HasThemeVideo==false).checkboxradio('refresh');$('#chkIsPlaceHolder',page).checked(query.IsPlaceHolder==true).checkboxradio('refresh');$('#chkMissingRating',page).checked(query.HasOfficialRating==false).checkboxradio('refresh');$('#chkMissingOverview',page).checked(query.HasOverview==false).checkboxradio('refresh');$('#chkYearMismatch',page).checked(query.IsYearMismatched==true).checkboxradio('refresh');$('#chkIsUnidentified',page).checked(query.IsUnidentified==true).checkboxradio('refresh');$('#chkIsLocked',page).checked(query.IsLocked==true).checkboxradio('refresh');$('#chkSpecialEpisode',page).checked(query.ParentIndexNumber==0).checkboxradio('refresh');$('#chkMissingEpisode',page).checked(query.IsMissing==true).checkboxradio('refresh');$('#chkFutureEpisode',page).checked(query.IsUnaired==true).checkboxradio('refresh');}
$(document).on('pageinit',"#libraryReportPage",function(){var page=this;$('#radioBasicFilters',page).on('change',function(){if(this.checked){$('.basicFilters',page).show();$('.advancedFilters',page).hide();}else{$('.basicFilters',page).hide();}});$('#radioAdvancedFilters',page).on('change',function(){if(this.checked){$('.advancedFilters',page).show();$('.basicFilters',page).hide();}else{$('.advancedFilters',page).hide();}});$('#selectView',page).on('change',function(){query.StartIndex=0;query.IncludeItemTypes=this.value;query.SortBy=getDefaultSortOrder(this.value);query.SortOrder="Ascending";reloadItems(page);});$('.chkVideoTypeFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.VideoTypes||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.VideoTypes=filters;reloadItems(page);});$('#chk3D',page).on('change',function(){query.StartIndex=0;query.Is3D=this.checked?true:null;reloadItems(page);});$('#chkHD',page).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?true:null;reloadItems(page);});$('#chkSD',page).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?false:null;reloadItems(page);});$('#chkSubtitle',page).on('change',function(){query.StartIndex=0;query.HasSubtitles=this.checked?true:null;$('#chkNoSubtitle',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkNoSubtitle',page).on('change',function(){query.StartIndex=0;query.HasSubtitles=this.checked?false:null;$('#chkSubtitle',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkTrailer',page).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;$('#chkNoTrailer',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkNoTrailer',page).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?false:null;$('#chkTrailer',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkSpecialFeature',page).on('change',function(){query.StartIndex=0;query.HasSpecialFeature=this.checked?true:null;reloadItems(page);});$('#chkIsPlaceHolder',page).on('change',function(){query.StartIndex=0;query.IsPlaceHolder=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',page).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;$('#chkNoThemeSong',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkNoThemeSong',page).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?false:null;$('#chkThemeSong',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkThemeVideo',page).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;$('#chkNoThemeVideo',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkNoThemeVideo',page).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?false:null;$('#chkThemeVideo',page).checked(false).checkboxradio('refresh');reloadItems(page);});$('#chkMissingOverview',page).on('change',function(){query.StartIndex=0;query.HasOverview=this.checked?false:null;reloadItems(page);});$('#chkMissingRating',page).on('change',function(){query.StartIndex=0;query.HasOfficialRating=this.checked?false:null;reloadItems(page);});$('#chkYearMismatch',page).on('change',function(){query.StartIndex=0;query.IsYearMismatched=this.checked?true:null;reloadItems(page);});$('#chkIsUnidentified',page).on('change',function(){query.StartIndex=0;query.IsUnidentified=this.checked?true:null;reloadItems(page);});$('#chkIsLocked',page).on('change',function(){query.StartIndex=0;query.IsLocked=this.checked?true:null;reloadItems(page);});$('#chkMissingEpisode',page).on('change',function(){query.StartIndex=0;query.IsMissing=this.checked?true:false;reloadItems(page);});$('#chkFutureEpisode',page).on('change',function(){query.StartIndex=0;if(this.checked){query.IsUnaired=true;query.IsVirtualUnaired=null;}else{query.IsUnaired=null;query.IsVirtualUnaired=false;}
reloadItems(page);});$('#chkSpecialEpisode',page).on('change',function(){query.ParentIndexNumber=this.checked?0:null;reloadItems(page);});}).on('pagebeforeshow',"#libraryReportPage",function(){var page=this;query.SortBy=getDefaultSortOrder($('#selectView',page).val());query.SortOrder="Ascending";$('#selectView',page).val(query.IncludeItemTypes).selectmenu('refresh').trigger('change');}).on('pageshow',"#libraryReportPage",function(){updateFilterControls(this);});})(jQuery,document,window);(function($,document,window){function loadPage(page,config){if(config.MergeMetadataAndImagesByName){$('.fldImagesByName',page).hide();}else{$('.fldImagesByName',page).show();}
$('#txtSeasonZeroName',page).val(config.SeasonZeroDisplayName);$('#chkEnableRealtimeMonitor',page).checked(config.EnableRealtimeMonitor).checkboxradio("refresh");$('#txtItemsByNamePath',page).val(config.ItemsByNamePath||'');$('#chkEnableAudioArchiveFiles',page).checked(config.EnableAudioArchiveFiles).checkboxradio("refresh");$('#chkEnableVideoArchiveFiles',page).checked(config.EnableVideoArchiveFiles).checkboxradio("refresh");Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#librarySettingsPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});}).on('pageinit',"#librarySettingsPage",function(){var page=this;$('#btnSelectIBNPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtItemsByNamePath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectImagesByNamePath'),instruction:Globalize.translate('HeaderSelectImagesByNamePathHelp')});});});function librarySettingsPage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getServerConfiguration().done(function(config){config.ItemsByNamePath=$('#txtItemsByNamePath',form).val();config.SeasonZeroDisplayName=$('#txtSeasonZeroName',form).val();config.EnableRealtimeMonitor=$('#chkEnableRealtimeMonitor',form).checked();config.EnableAudioArchiveFiles=$('#chkEnableAudioArchiveFiles',form).checked();config.EnableVideoArchiveFiles=$('#chkEnableVideoArchiveFiles',form).checked();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;};}
window.LibrarySettingsPage=new librarySettingsPage();})(jQuery,document,window);(function($,document){var currentItem;var programs;function renderPrograms(page,result){var html='';var currentIndexValue;var now=new Date();for(var i=0,length=result.Items.length;i<length;i++){var program=result.Items[i];var startDate=parseISO8601Date(program.StartDate,{toLocal:true});var startDateText=LibraryBrowser.getFutureDateText(startDate);var endDate=parseISO8601Date(program.EndDate,{toLocal:true});if(startDateText!=currentIndexValue){html+='<h2 class="detailSectionHeader tvProgramSectionHeader">'+startDateText+'</h2>';currentIndexValue=startDateText;}
html+='<a href="livetvprogram.html?id='+program.Id+'" class="tvProgram">';var cssClass="tvProgramTimeSlot";if(now>=startDate&&now<endDate){cssClass+=" tvProgramCurrentTimeSlot";}
html+='<div class="'+cssClass+'">';html+='<div class="tvProgramTimeSlotInner">'+LiveTvHelpers.getDisplayTime(startDate)+'</div>';html+='</div>';cssClass="tvProgramInfo";if(program.IsKids){cssClass+=" childProgramInfo";}
else if(program.IsSports){cssClass+=" sportsProgramInfo";}
else if(program.IsNews){cssClass+=" newsProgramInfo";}
else if(program.IsMovie){cssClass+=" movieProgramInfo";}
html+='<div data-programid="'+program.Id+'" class="'+cssClass+'">';var name=program.Name;html+='<div class="tvProgramName">'+name+'</div>';html+='<div class="tvProgramTime">';if(program.IsLive){html+='<span class="liveTvProgram">'+Globalize.translate('LabelLiveProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsPremiere){html+='<span class="premiereTvProgram">'+Globalize.translate('LabelPremiereProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsSeries&&!program.IsRepeat){html+='<span class="newTvProgram">'+Globalize.translate('LabelNewProgram')+'&nbsp;&nbsp;</span>';}
var minutes=program.RunTimeTicks/600000000;minutes=Math.round(minutes||1)+' min';if(program.EpisodeTitle){html+=program.EpisodeTitle+'&nbsp;&nbsp;('+minutes+')';}else{html+=minutes;}
if(program.SeriesTimerId){html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';}
else if(program.TimerId){html+='<div class="timerCircle"></div>';}
html+='</div>';html+='</div>';html+='</a>';}
$('#programList',page).html(html).trigger('create').createGuideHoverMenu('.tvProgramInfo');}
function loadPrograms(page){ApiClient.getLiveTvPrograms({ChannelIds:currentItem.Id,UserId:Dashboard.getCurrentUserId()}).done(function(result){renderPrograms(page,result);programs=result.Items;Dashboard.hideLoadingMsg();});}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvChannel(getParameterByName('id'),Dashboard.getCurrentUserId()).done(function(item){currentItem=item;var name=item.Name;$('#itemImage',page).html(LibraryBrowser.getDetailImageHtml(item));Dashboard.setPageTitle(name);$('.itemName',page).html(item.Number+' '+name);$('.userDataIcons',page).html(LibraryBrowser.getUserDataIconsHtml(item));$(page).trigger('displayingitem',[{item:item,context:'livetv'}]);Dashboard.getCurrentUser().done(function(user){if(MediaController.canPlay(item)){$('#playButtonContainer',page).show();}else{$('#playButtonContainer',page).hide();}
if(user.Policy.IsAdministrator&&item.LocationType!=="Offline"){$('#editButtonContainer',page).show();}else{$('#editButtonContainer',page).hide();}});loadPrograms(page);});}
window.LiveTvHelpers={getDaysOfWeek:function(){var days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];return days.map(function(d){return{name:d,value:d};});},getDisplayTime:function(date){if((typeof date).toString().toLowerCase()==='string'){try{date=parseISO8601Date(date,{toLocal:true});}catch(err){return date;}}
var lower=date.toLocaleTimeString().toLowerCase();var hours=date.getHours();var minutes=date.getMinutes();var text;if(lower.indexOf('am')!=-1||lower.indexOf('pm')!=-1){var suffix=hours>11?'pm':'am';hours=(hours%12)||12;text=hours;if(minutes){text+=':';if(minutes<10){text+='0';}
text+=minutes;}
text+=suffix;}else{text=hours+':';if(minutes<10){text+='0';}
text+=minutes;}
return text;},renderMiscProgramInfo:function(elem,obj){var html=[];if(obj.IsSeries&&!obj.IsRepeat){html.push('<span class="newTvProgram">'+Globalize.translate('LabelNewProgram')+'</span>');}
if(obj.IsLive){html.push('<span class="liveTvProgram">'+Globalize.translate('LabelLiveProgram')+'</span>');}
if(obj.ChannelId){html.push('<a class="textlink" href="livetvchannel.html?id='+obj.ChannelId+'">'+obj.ChannelName+'</a>');}
if(obj.IsHD){html.push(Globalize.translate('LabelHDProgram'));}
if(obj.Audio){html.push(obj.Audio);}
html=html.join('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;');if(obj.SeriesTimerId){html+='<a href="livetvseriestimer.html?id='+obj.SeriesTimerId+'" title="'+Globalize.translate('ButtonViewSeriesRecording')+'">';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='</a>';}
else if(obj.TimerId){html+='<a href="livetvtimer.html?id='+obj.TimerId+'">';html+='<div class="timerCircle"></div>';html+='</a>';}
elem.html(html).trigger('create');},renderOriginalAirDate:function(elem,item){var airDate=item.OriginalAirDate;if(airDate&&item.IsRepeat){try{airDate=parseISO8601Date(airDate,{toLocal:true}).toLocaleDateString();}
catch(e){console.log("Error parsing date: "+airDate);}
elem.html(Globalize.translate('ValueOriginalAirDate').replace('{0}',airDate)).show();}else{elem.hide();}}};$(document).on('pageinit',"#liveTvChannelPage",function(){var page=this;$('#btnPlay',page).on('click',function(){var userdata=currentItem.UserData||{};LibraryBrowser.showPlayMenu(this,currentItem.Id,currentItem.Type,false,currentItem.MediaType,userdata.PlaybackPositionTicks);});$('#btnEdit',page).on('click',function(){Dashboard.navigate("edititemmetadata.html?channelid="+currentItem.Id);});}).on('pageshow',"#liveTvChannelPage",function(){var page=this;reload(page);}).on('pagehide',"#liveTvChannelPage",function(){currentItem=null;programs=null;});})(jQuery,document);(function($,document){var query={StartIndex:0,EnableFavoriteSorting:true};function getChannelsHtml(channels){return LibraryBrowser.getPosterViewHtml({items:channels,shape:"smallBackdrop",centerText:true});}
function showLoadingMessage(page){$('.popupLoading',page).popup('open');}
function hideLoadingMessage(page){$('.popupLoading',page).popup('close');}
function renderChannels(page,result){$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(this);var html=getChannelsHtml(result.Items);$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues('movies',query);}
function reloadItems(page){showLoadingMessage(page);ApiClient.getLiveTvChannels(query).done(function(result){renderChannels(page,result);hideLoadingMessage(page);});}
function updateFilterControls(page){$('#chkFavorite',page).checked(query.IsFavorite==true).checkboxradio('refresh');$('#chkLikes',page).checked(query.IsLiked==true).checkboxradio('refresh');$('#chkDislikes',page).checked(query.IsDisliked==true).checkboxradio('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#liveTvChannelsPage",function(){var page=this;$('#chkFavorite',this).on('change',function(){query.StartIndex=0;query.IsFavorite=this.checked?true:null;reloadItems(page);});$('#chkLikes',this).on('change',function(){query.StartIndex=0;query.IsLiked=this.checked?true:null;reloadItems(page);});$('#chkDislikes',this).on('change',function(){query.StartIndex=0;query.IsDisliked=this.checked?true:null;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pageshow',"#liveTvChannelsPage",function(){var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
query.UserId=Dashboard.getCurrentUserId();LibraryBrowser.loadSavedQueryValues('movies',query);reloadItems(page);updateFilterControls(this);});})(jQuery,document);(function($,document){var cellCurationMinutes=30;var cellDurationMs=cellCurationMinutes*60*1000;var msPerDay=86400000;var currentDate;var channelQuery={StartIndex:0,Limit:50,EnableFavoriteSorting:true};var channelsPromise;function showLoadingMessage(page){$('.popupLoading',page).popup('open');}
function hideLoadingMessage(page){$('.popupLoading',page).popup('close');}
function normalizeDateToTimeslot(date){var minutesOffset=date.getMinutes()-cellCurationMinutes;if(minutesOffset>=0){date.setHours(date.getHours(),cellCurationMinutes,0,0);}else{date.setHours(date.getHours(),0,0,0);}
return date;}
function reloadChannels(page){channelsPromise=null;reloadGuide(page);}
function reloadGuide(page){showLoadingMessage(page);channelQuery.userId=Dashboard.getCurrentUserId();channelsPromise=channelsPromise||ApiClient.getLiveTvChannels(channelQuery);var date=currentDate;var nextDay=new Date(date.getTime()+msPerDay-1);console.log(nextDay);channelsPromise.done(function(channelsResult){ApiClient.getLiveTvPrograms({UserId:Dashboard.getCurrentUserId(),MaxStartDate:nextDay.toISOString(),MinEndDate:date.toISOString(),channelIds:channelsResult.Items.map(function(c){return c.Id;}).join(',')}).done(function(programsResult){renderGuide(page,date,channelsResult.Items,programsResult.Items);hideLoadingMessage(page);});var channelPagingHtml=LibraryBrowser.getPagingHtml(channelQuery,channelsResult.TotalRecordCount,false,[10,20,30,50,100]);$('.channelPaging',page).html(channelPagingHtml).trigger('create');$('.btnNextPage',page).on('click',function(){channelQuery.StartIndex+=channelQuery.Limit;reloadChannels(page);});$('.btnPreviousPage',page).on('click',function(){channelQuery.StartIndex-=channelQuery.Limit;reloadChannels(page);});$('.selectPageSize',page).on('change',function(){channelQuery.Limit=parseInt(this.value);channelQuery.StartIndex=0;reloadChannels(page);});});}
function getTimeslotHeadersHtml(startDate,endDateTime){var html='';startDate=new Date(startDate.getTime());html+='<div class="timeslotHeadersInner">'
while(startDate.getTime()<endDateTime){html+='<div class="timeslotHeader">';html+='<div class="timeslotHeaderInner">';html+=LiveTvHelpers.getDisplayTime(startDate);html+='</div>';html+='</div>';startDate.setTime(startDate.getTime()+cellDurationMs);}
html+='</div>';return html;}
function parseDates(program){if(!program.StartDateLocal){try{program.StartDateLocal=parseISO8601Date(program.StartDate,{toLocal:true});}catch(err){}}
if(!program.EndDateLocal){try{program.EndDateLocal=parseISO8601Date(program.EndDate,{toLocal:true});}catch(err){}}
return null;}
function getChannelProgramsHtml(page,date,channel,programs){var html='';var startMs=date.getTime();var endMs=startMs+msPerDay-1;programs=programs.filter(function(curr){return curr.ChannelId==channel.Id;});html+='<div class="channelPrograms">';for(var i=0,length=programs.length;i<length;i++){var program=programs[i];if(program.ChannelId!=channel.Id){continue;}
parseDates(program);if(program.EndDateLocal.getTime()<startMs){continue;}
if(program.StartDateLocal.getTime()>endMs){break;}
var renderStartMs=Math.max(program.StartDateLocal.getTime(),startMs);var startPercent=(program.StartDateLocal.getTime()-startMs)/msPerDay;startPercent*=100;startPercent=Math.max(startPercent,0);var renderEndMs=Math.min(program.EndDateLocal.getTime(),endMs);var endPercent=(renderEndMs-renderStartMs)/msPerDay;endPercent*=100;html+='<div class="programCell" style="left:'+startPercent+'%;width:'+endPercent+'%;">';var cssClass="programCellInner";if(program.IsKids){cssClass+=" childProgramInfo";}else if(program.IsSports){cssClass+=" sportsProgramInfo";}else if(program.IsNews){cssClass+=" newsProgramInfo";}else if(program.IsMovie){cssClass+=" movieProgramInfo";}
else{cssClass+=" plainProgramInfo";}
html+='<a href="livetvprogram.html?id='+program.Id+'" class="'+cssClass+'" data-programid="'+program.Id+'">';html+='<div class="guideProgramName">';html+=program.Name;html+='</div>';html+='<div class="guideProgramTime">';if(program.IsLive){html+='<span class="liveTvProgram">'+Globalize.translate('LabelLiveProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsPremiere){html+='<span class="premiereTvProgram">'+Globalize.translate('LabelPremiereProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsSeries&&!program.IsRepeat){html+='<span class="newTvProgram">'+Globalize.translate('LabelNewProgram')+'&nbsp;&nbsp;</span>';}
html+=LiveTvHelpers.getDisplayTime(program.StartDateLocal);html+=' - ';html+=LiveTvHelpers.getDisplayTime(program.EndDateLocal);if(program.SeriesTimerId){html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';}
else if(program.TimerId){html+='<div class="timerCircle"></div>';}
html+='</div>';html+='</a>';html+='</div>';}
html+='</div>';return html;}
function renderPrograms(page,date,channels,programs){var html=[];for(var i=0,length=channels.length;i<length;i++){html.push(getChannelProgramsHtml(page,date,channels[i],programs));}
$('.programGrid',page).html(html.join('')).scrollTop(0).scrollLeft(0).createGuideHoverMenu('.programCellInner');}
function renderChannelHeaders(page,channels){var html='';for(var i=0,length=channels.length;i<length;i++){var channel=channels[i];html+='<div class="channelHeaderCellContainer">';html+='<div class="channelHeaderCell">';html+='<a class="channelHeaderCellInner" href="livetvchannel.html?id='+channel.Id+'">';html+='<div class="guideChannelInfo">'+channel.Name+'<br/>'+channel.Number+'</div>';if(channel.ImageTags.Primary){var url=ApiClient.getScaledImageUrl(channel.Id,{maxHeight:35,maxWidth:60,tag:channel.ImageTags.Primary,type:"Primary"});html+='<img class="guideChannelImage" src="'+url+'" />';}
html+='</a>';html+='</div>';html+='</div>';}
$('.channelList',page).html(html);}
function renderGuide(page,date,channels,programs){renderChannelHeaders(page,channels);var startDate=date;var endDate=new Date(startDate.getTime()+msPerDay);$('.timeslotHeaders',page).html(getTimeslotHeadersHtml(startDate,endDate));renderPrograms(page,date,channels,programs);}
var gridScrolling=false;var headersScrolling=false;function onProgramGridScroll(page,elem){if(!headersScrolling){gridScrolling=true;var grid=$(elem);$('.timeslotHeaders',page).scrollLeft(grid.scrollLeft());gridScrolling=false;}}
function onTimeslotHeadersScroll(page,elem){if(!gridScrolling){headersScrolling=true;elem=$(elem);$('.programGrid',page).scrollLeft(elem.scrollLeft());headersScrolling=false;}}
function changeDate(page,date){currentDate=normalizeDateToTimeslot(date);reloadGuide(page);var text=LibraryBrowser.getFutureDateText(date);text='<span class="currentDay">'+text.replace(' ',' </span>');$('.currentDate',page).html(text);}
function setDateRange(page,guideInfo){var today=new Date();today.setHours(today.getHours(),0,0,0);var start=parseISO8601Date(guideInfo.StartDate,{toLocal:true});var end=parseISO8601Date(guideInfo.EndDate,{toLocal:true});start.setHours(0,0,0,0);end.setHours(0,0,0,0);if(start.getTime()>=end.getTime()){end.setDate(start.getDate()+1);}
start=new Date(Math.max(today,start));var html='';while(start<=end){html+='<option value="'+start.getTime()+'">'+LibraryBrowser.getFutureDateText(start)+'</option>';start.setDate(start.getDate()+1);start.setHours(0,0,0,0);}
var elem=$('#selectDate',page).html(html).selectmenu('refresh');if(currentDate){elem.val(currentDate.getTime()).selectmenu('refresh');}
var val=elem.val();var date=new Date();if(val){date.setTime(parseInt(val));}
changeDate(page,date);}
$(document).on('pageinit',"#liveTvGuidePage",function(){var page=this;$('.programGrid',page).on('scroll',function(){onProgramGridScroll(page,this);});$('#selectDate',page).on('change',function(){var date=new Date();date.setTime(parseInt(this.value));$('#popupConfig',page).popup('close');setTimeout(function(){changeDate(page,date);},300);});if($.browser.mobile){$('.tvGuide',page).addClass('mobileGuide');}else{$('.tvGuide',page).removeClass('mobileGuide');$('.timeslotHeaders',page).on('scroll',function(){onTimeslotHeadersScroll(page,this);});}}).on('pageshow',"#liveTvGuidePage",function(){var page=this;ApiClient.getLiveTvGuideInfo().done(function(guideInfo){setDateRange(page,guideInfo);});});})(jQuery,document);(function($,document,window){var showOverlayTimeout;var hideOverlayTimeout;var currentPosterItem;function onOverlayMouseOver(){if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout);hideOverlayTimeout=null;}}
function onOverlayMouseOut(){startHideOverlayTimer();}
function getOverlayHtml(item){var html='';html+='<div class="itemOverlayContent">';if(item.EpisodeTitle){html+='<p>';html+=item.EpisodeTitle;html+='</p>';}
html+='<p class="itemMiscInfo miscTvProgramInfo"></p>';html+='<p style="margin: 1.25em 0;">';html+='<span class="itemCommunityRating">';html+=LibraryBrowser.getRatingHtml(item);html+='</span>';html+='<span class="userDataIcons">';html+=LibraryBrowser.getUserDataIconsHtml(item);html+='</span>';html+='</p>';html+='<p class="itemGenres"></p>';html+='<p class="itemOverlayHtml">';html+=(item.Overview||'');html+='</p>';html+='</div>';return html;}
function showOverlay(elem,item){$('.itemFlyout').popup('close').remove();var html='<div data-role="popup" class="itemFlyout" data-theme="b" data-arrow="true" data-history="false">';html+='<div class="ui-bar-b" style="text-align:center;">';html+='<h3 style="margin: .5em 0;padding:0 1em;font-weight:normal;">'+item.Name+'</h3>';html+='</div>';html+='<div style="padding: 0 1em;">';html+=getOverlayHtml(item);html+='</div>';html+='</div>';$('.itemFlyout').popup('close').popup('destroy').remove();$(document.body).append(html);var popup=$('.itemFlyout').on('mouseenter',onOverlayMouseOver).on('mouseleave',onOverlayMouseOut).popup({positionTo:elem}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").off("mouseenter").off("mouseleave").remove();});LibraryBrowser.renderGenres($('.itemGenres',popup),item,'livetv',3);LiveTvHelpers.renderMiscProgramInfo($('.miscTvProgramInfo',popup),item);popup.parents().prev('.ui-popup-screen').remove();currentPosterItem=elem;}
function onProgramClicked(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout);hideOverlayTimeout=null;}
hideOverlay();}
function hideOverlay(){$('.itemFlyout').popup('close').remove();if(currentPosterItem){$(currentPosterItem).off('click.overlay');currentPosterItem=null;}}
function startHideOverlayTimer(){if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout);hideOverlayTimeout=null;}
hideOverlayTimeout=setTimeout(hideOverlay,200);}
function onHoverOut(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
startHideOverlayTimer();}
$.fn.createGuideHoverMenu=function(childSelector){function onShowTimerExpired(elem){var id=elem.getAttribute('data-programid');ApiClient.getLiveTvProgram(id,Dashboard.getCurrentUserId()).done(function(item){showOverlay(elem,item);});}
function onHoverIn(){if(showOverlayTimeout){clearTimeout(showOverlayTimeout);showOverlayTimeout=null;}
if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout);hideOverlayTimeout=null;}
var elem=this;if(currentPosterItem){if(currentPosterItem&&currentPosterItem==elem){return;}else{hideOverlay();}}
showOverlayTimeout=setTimeout(function(){onShowTimerExpired(elem);},1000);}
if(('ontouchstart'in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0)){return this;}
return this.on('mouseenter',childSelector,onHoverIn).on('mouseleave',childSelector,onHoverOut).on('click',childSelector,onProgramClicked);};})(jQuery,document,window);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var currentDate=new Date();currentDate.setHours(0,0,0,0);var query={UserId:Dashboard.getCurrentUserId(),SortBy:"StartDate,SortName",SortOrder:"Ascending",StartIndex:0};function getSavedQueryKey(){return'livetvitems2'+(query.ParentId||'');}
function updateFilterControls(page){$('#selectView',page).val(view).selectmenu('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvPrograms(query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'livetv',showTitle:false,centerText:true,lazy:true,showStartDateIndex:true,overlayText:false,showProgramAirInfo:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'livetv',showTitle:true,showStartDateIndex:true,lazy:true,cardLayout:true,showProgramAirInfo:true});}
var elem=$('.itemsContainer',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
$(document).on('pageinit',"#liveTvItemsPage",function(){var page=this;$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#radioBasicFilters',this).on('change',function(){if(this.checked){$('.basicFilters',page).show();$('.advancedFilters',page).hide();}else{$('.basicFilters',page).hide();}});$('#radioAdvancedFilters',this).on('change',function(){if(this.checked){$('.advancedFilters',page).show();$('.basicFilters',page).hide();}else{$('.advancedFilters',page).hide();}});$('.itemsContainer',page).on('needsrefresh',function(){reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#liveTvItemsPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
query.IsMovie=getParameterByName('type')=='movies'?true:null;query.IsSports=getParameterByName('type')=='sports'?true:null;var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#liveTvItemsPage",function(){var page=this;updateFilterControls(page);});})(jQuery,document);(function($,document){var currentProgram;function renderRecording(page,defaultTimer,program){currentProgram=program;var context='livetv';$('.itemName',page).html(program.Name);$('.itemEpisodeName',page).html(program.EpisodeTitle||'');$('.itemCommunityRating',page).html(LibraryBrowser.getRatingHtml(program));LibraryBrowser.renderGenres($('.itemGenres',page),program,context);LibraryBrowser.renderOverview($('.itemOverview',page),program);$('.itemMiscInfo',page).html(LibraryBrowser.getMiscInfoHtml(program));LiveTvHelpers.renderMiscProgramInfo($('.miscTvProgramInfo',page),program);$('#chkNewOnly',page).checked(defaultTimer.RecordNewOnly).checkboxradio('refresh');$('#chkAllChannels',page).checked(defaultTimer.RecordAnyChannel).checkboxradio('refresh');$('#chkAnyTime',page).checked(defaultTimer.RecordAnyTime).checkboxradio('refresh');$('#txtPrePaddingMinutes',page).val(defaultTimer.PrePaddingSeconds/60);$('#txtPostPaddingMinutes',page).val(defaultTimer.PostPaddingSeconds/60);$('#chkPrePaddingRequired',page).checked(defaultTimer.IsPrePaddingRequired).checkboxradio('refresh');$('#chkPostPaddingRequired',page).checked(defaultTimer.IsPostPaddingRequired).checkboxradio('refresh');if(program.IsSeries){$('#eligibleForSeriesFields',page).show();}else{$('#eligibleForSeriesFields',page).hide();}
selectDays(page,defaultTimer.Days);Dashboard.hideLoadingMsg();}
function reload(page){Dashboard.showLoadingMsg();var programId=getParameterByName('programid');var promise1=ApiClient.getNewLiveTvTimerDefaults({programId:programId});var promise2=ApiClient.getLiveTvProgram(programId,Dashboard.getCurrentUserId());$.when(promise1,promise2).done(function(response1,response2){var defaults=response1[0];var program=response2[0];renderRecording(page,defaults,program);});}
function selectDays(page,days){var daysOfWeek=getDaysOfWeek();for(var i=0,length=daysOfWeek.length;i<length;i++){var day=daysOfWeek[i];$('#chk'+day,page).checked(days.indexOf(day)!=-1).checkboxradio('refresh');}}
function getDaysOfWeek(){return LiveTvHelpers.getDaysOfWeek().map(function(d){return d.value;});}
function getDays(page){var daysOfWeek=getDaysOfWeek();var days=[];for(var i=0,length=daysOfWeek.length;i<length;i++){var day=daysOfWeek[i];if($('#chk'+day,page).checked()){days.push(day);}}
return days;}
function onSubmit(){Dashboard.showLoadingMsg();var form=this;var programId=getParameterByName('programid');ApiClient.getNewLiveTvTimerDefaults({programId:programId}).done(function(item){item.PrePaddingSeconds=$('#txtPrePaddingMinutes',form).val()*60;item.PostPaddingSeconds=$('#txtPostPaddingMinutes',form).val()*60;item.IsPrePaddingRequired=$('#chkPrePaddingRequired',form).checked();item.IsPostPaddingRequired=$('#chkPostPaddingRequired',form).checked();item.RecordNewOnly=$('#chkNewOnly',form).checked();item.RecordAnyChannel=$('#chkAllChannels',form).checked();item.RecordAnyTime=$('#chkAnyTime',form).checked();item.Days=getDays(form);if($('#chkRecordSeries',form).checked()){ApiClient.createLiveTvSeriesTimer(item).done(function(){Dashboard.hideLoadingMsg();Dashboard.navigate('livetvseriestimers.html');});}else{ApiClient.createLiveTvTimer(item).done(function(){Dashboard.hideLoadingMsg();Dashboard.navigate('livetvtimers.html');});}});return false;}
window.LiveTvNewRecordingPage={onSubmit:onSubmit};$(document).on('pageinit',"#liveTvNewRecordingPage",function(){var page=this;$('#chkRecordSeries',page).on('change',function(){if(this.checked){$('#seriesFields',page).show();}else{$('#seriesFields',page).hide();}});$('#btnCancel',page).on('click',function(){var programId=getParameterByName('programid');Dashboard.navigate('livetvprogram.html?id='+programId);});}).on('pagebeforeshow',"#liveTvNewRecordingPage",function(){var page=this;reload(page);}).on('pagehide',"#liveTvNewRecordingPage",function(){currentProgram=null;});})(jQuery,document);(function($,document){var currentItem;function deleteTimer(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmRecordingCancellation'),Globalize.translate('HeaderConfirmRecordingCancellation'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.cancelLiveTvTimer(id).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingCancelled'));reload(page);});}});}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvProgram(getParameterByName('id'),Dashboard.getCurrentUserId()).done(function(item){var context='livetv';currentItem=item;var name=item.Name;$('#itemImage',page).html(LibraryBrowser.getDetailImageHtml(item));Dashboard.setPageTitle(name);$('.itemName',page).html(name);$('.itemEpisodeName',page).html(item.EpisodeTitle||'');$('.itemCommunityRating',page).html(LibraryBrowser.getRatingHtml(item));$('.userDataIcons',page).html(LibraryBrowser.getUserDataIconsHtml(item));LibraryBrowser.renderGenres($('.itemGenres',page),item,context);LibraryBrowser.renderOverview($('.itemOverview',page),item);$('.itemMiscInfo',page).html(LibraryBrowser.getMiscInfoHtml(item));LiveTvHelpers.renderMiscProgramInfo($('.miscTvProgramInfo',page),item);$(page).trigger('displayingitem',[{item:item,context:'livetv'}]);if(item.TimerId){$('#cancelRecordingButtonContainer',page).show();}else{$('#cancelRecordingButtonContainer',page).hide();}
if(!item.TimerId&&!item.SeriesTimerId){$('#recordButtonContainer',page).show();}else{$('#recordButtonContainer',page).hide();}
var startDateLocal=parseISO8601Date(item.StartDate,{toLocal:true});var endDateLocal=parseISO8601Date(item.EndDate,{toLocal:true});var now=new Date();if(now>=startDateLocal&&now<endDateLocal){$('#playButtonContainer',page).show();}else{$('#playButtonContainer',page).hide();}
Dashboard.getCurrentUser().done(function(user){if(user.Policy.IsAdministrator&&item.LocationType!=="Offline"){$('#editButtonContainer',page).show();}else{$('#editButtonContainer',page).hide();}});LiveTvHelpers.renderOriginalAirDate($('.airDate',page),item);Dashboard.hideLoadingMsg();});}
$(document).on('pageinit',"#liveTvProgramPage",function(){var page=this;$('#btnRecord',page).on('click',function(){var id=getParameterByName('id');Dashboard.navigate('livetvnewrecording.html?programid='+id);});$('#btnPlay',page).on('click',function(){ApiClient.getLiveTvChannel(currentItem.ChannelId,Dashboard.getCurrentUserId()).done(function(channel){var userdata=channel.UserData||{};LibraryBrowser.showPlayMenu(this,channel.Id,channel.Type,false,channel.MediaType,userdata.PlaybackPositionTicks);});});$('#btnCancelRecording',page).on('click',function(){deleteTimer(page,currentItem.TimerId);});}).on('pageshow',"#liveTvProgramPage",function(){var page=this;reload(page);}).on('pagehide',"#liveTvProgramPage",function(){currentItem=null;});})(jQuery,document);(function($,document){var currentItem;function deleteRecording(){Dashboard.confirm(Globalize.translate('MessageConfirmRecordingDeletion'),Globalize.translate('HeaderConfirmRecordingDeletion'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.deleteLiveTvRecording(currentItem.Id).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingDeleted'));Dashboard.navigate('livetvrecordings.html');});}});}
function play(){var userdata=currentItem.UserData||{};var mediaType=currentItem.MediaType;LibraryBrowser.showPlayMenu(this,currentItem.Id,currentItem.Type,false,mediaType,userdata.PlaybackPositionTicks);}
function renderRecording(page,item){currentItem=item;var context='livetv';var name=item.Name;$('#itemImage',page).html(LibraryBrowser.getDetailImageHtml(item));Dashboard.setPageTitle(name);$('.itemName',page).html(name);$('.itemEpisodeName',page).html(item.EpisodeTitle||'');$('.itemCommunityRating',page).html(LibraryBrowser.getRatingHtml(item));$('.userDataIcons',page).html(LibraryBrowser.getUserDataIconsHtml(item));LibraryBrowser.renderGenres($('.itemGenres',page),item,context);LibraryBrowser.renderOverview($('.itemOverview',page),item);$('.itemMiscInfo',page).html(LibraryBrowser.getMiscInfoHtml(item));LiveTvHelpers.renderMiscProgramInfo($('.miscTvProgramInfo',page),item);$(page).trigger('displayingitem',[{item:item,context:'livetv'}]);$('.recordingStatus',page).html('Status:&nbsp;&nbsp;&nbsp;'+item.Status);if(MediaController.canPlay(item)){$('#playButtonContainer',page).show();}else{$('#playButtonContainer',page).hide();}
if(item.CanDelete){$('#deleteButtonContainer',page).show();}else{$('#deleteButtonContainer',page).hide();}
LiveTvHelpers.renderOriginalAirDate($('.airDate',page),item);Dashboard.hideLoadingMsg();Dashboard.getCurrentUser().done(function(user){if(SyncManager.isAvailable(item,user)){$('.btnSync',page).removeClass('hide');}else{$('.btnSync',page).addClass('hide');}});}
function reload(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getLiveTvRecording(id,Dashboard.getCurrentUserId()).done(function(result){renderRecording(page,result);});}
$(document).on('pageinit',"#liveTvRecordingPage",function(){var page=this;$('#btnDelete',page).on('click',deleteRecording);$('#btnPlay',page).on('click',play);$('.btnSync',page).on('click',function(){SyncManager.showMenu({items:[currentItem]});});}).on('pagebeforeshow',"#liveTvRecordingPage",function(){var page=this;reload(page);}).on('pagehide',"#liveTvRecordingPage",function(){currentItem=null;});})(jQuery,document);(function($,document){var query={UserId:Dashboard.getCurrentUserId(),StartIndex:0};function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvRecordings(query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getPagingHtml(query,result.TotalRecordCount,true)).trigger('create');updateFilterControls();var screenWidth=$(window).width();html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:true,showParentTitle:true,overlayText:screenWidth>=600,coverImage:true});html+=LibraryBrowser.getPagingHtml(query,result.TotalRecordCount);$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});$('.selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});if(getParameterByName('savequery')!='false'){LibraryBrowser.saveQueryValues('episodes',query);}
Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){}
$(document).on('pageinit',"#liveTvRecordingListPage",function(){var page=this;}).on('pagebeforeshow',"#liveTvRecordingListPage",function(){var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues('episodes',query);var groupId=getParameterByName('groupid');query.GroupId=groupId;reloadItems(page);if(query.GroupId){ApiClient.getLiveTvRecordingGroup(query.GroupId).done(function(group){$('.listName',page).html(group.Name);});}else{$('.listName',page).html(Globalize.translate('HeaderAllRecordings'));}}).on('pageshow',"#liveTvRecordingListPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function getRecordingGroupHtml(group){var html='';html+='<li><a href="livetvrecordinglist.html?groupid='+group.Id+'">';html+='<h3>';html+=group.Name;html+='</h3>';html+='<span class="ui-li-count">'+group.RecordingCount+'</span>';html+='</li>';return html;}
function renderRecordingGroups(page,groups){if(groups.length){$('#recordingGroups',page).show();}else{$('#recordingGroups',page).hide();}
var html='';html+='<ul data-role="listview" data-inset="true">';for(var i=0,length=groups.length;i<length;i++){html+=getRecordingGroupHtml(groups[i]);}
html+='</ul>';$('#recordingGroupItems',page).html(html).trigger('create');Dashboard.hideLoadingMsg();}
function renderRecordings(elem,recordings){var screenWidth=$(window).width();if(recordings.length){elem.show();}else{elem.hide();}
$('.recordingItems',elem).html(LibraryBrowser.getPosterViewHtml({items:recordings,shape:"auto",showTitle:true,showParentTitle:true,overlayText:screenWidth>=600,coverImage:true,lazy:true})).lazyChildren();}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvRecordings({userId:Dashboard.getCurrentUserId(),IsInProgress:true}).done(function(result){renderRecordings($('#activeRecordings',page),result.Items);});ApiClient.getLiveTvRecordings({userId:Dashboard.getCurrentUserId(),limit:12,IsInProgress:false}).done(function(result){renderRecordings($('#latestRecordings',page),result.Items);});ApiClient.getLiveTvRecordingGroups({userId:Dashboard.getCurrentUserId()}).done(function(result){renderRecordingGroups(page,result.Items);});}
$(document).on('pagebeforeshow',"#liveTvRecordingsPage",function(){var page=this;reload(page);});})(jQuery,document);(function(window,$,document){var currentItem;function deleteTimer(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmRecordingCancellation'),Globalize.translate('HeaderConfirmRecordingCancellation'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.cancelLiveTvTimer(id).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingCancelled'));Dashboard.navigate('livetvtimers.html');});}});}
function renderTimer(page,item){var context='livetv';currentItem=item;var programInfo=item.ProgramInfo||{};$('.itemName',page).html(item.Name);$('.itemEpisodeName',page).html(programInfo.EpisodeTitle||'');$('.itemCommunityRating',page).html(LibraryBrowser.getRatingHtml(programInfo));LibraryBrowser.renderGenres($('.itemGenres',page),programInfo,context);LibraryBrowser.renderOverview($('.itemOverview',page),programInfo);if(programInfo.ImageTags&&programInfo.ImageTags.Primary){var imgUrl=ApiClient.getScaledImageUrl(programInfo.Id,{maxWidth:200,maxHeight:200,tag:programInfo.ImageTags.Primary,type:"Primary"});$('.timerPageImageContainer',page).css("display","inline-block").html('<img src="'+imgUrl+'" style="max-width:200px;max-height:200px;" />');}else{$('.timerPageImageContainer',page).hide();}
$('.itemMiscInfo',page).html(LibraryBrowser.getMiscInfoHtml(item));LiveTvHelpers.renderMiscProgramInfo($('.miscTvProgramInfo',page),programInfo);$('#txtPrePaddingMinutes',page).val(item.PrePaddingSeconds/60);$('#txtPostPaddingMinutes',page).val(item.PostPaddingSeconds/60);$('#chkPrePaddingRequired',page).checked(item.IsPrePaddingRequired).checkboxradio('refresh');$('#chkPostPaddingRequired',page).checked(item.IsPostPaddingRequired).checkboxradio('refresh');$('.timerStatus',page).html('Status:&nbsp;&nbsp;&nbsp;'+item.Status);Dashboard.hideLoadingMsg();}
function onSubmit(){Dashboard.showLoadingMsg();var form=this;ApiClient.getLiveTvTimer(currentItem.Id).done(function(item){item.PrePaddingSeconds=$('#txtPrePaddingMinutes',form).val()*60;item.PostPaddingSeconds=$('#txtPostPaddingMinutes',form).val()*60;item.IsPrePaddingRequired=$('#chkPrePaddingRequired',form).checked();item.IsPostPaddingRequired=$('#chkPostPaddingRequired',form).checked();ApiClient.updateLiveTvTimer(item).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingSaved'));});});return false;}
function reload(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getLiveTvTimer(id).done(function(result){renderTimer(page,result);});}
$(document).on('pageinit',"#liveTvTimerPage",function(){var page=this;$('#btnCancelTimer',page).on('click',function(){deleteTimer(page,currentItem.Id);});}).on('pagebeforeshow',"#liveTvTimerPage",function(){var page=this;reload(page);}).on('pagehide',"#liveTvTimerPage",function(){currentItem=null;});function liveTvTimerPage(){var self=this;self.onSubmit=onSubmit;}
window.LiveTvTimerPage=new liveTvTimerPage();})(window,jQuery,document);(function(window,$,document){var currentItem;function deleteTimer(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmRecordingCancellation'),Globalize.translate('HeaderConfirmRecordingCancellation'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.cancelLiveTvTimer(id).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingCancelled'));reload(page);});}});}
function renderTimer(page,item){currentItem=item;$('.itemName',page).html(item.Name);$('#txtPrePaddingMinutes',page).val(item.PrePaddingSeconds/60);$('#txtPostPaddingMinutes',page).val(item.PostPaddingSeconds/60);$('#chkPrePaddingRequired',page).checked(item.IsPrePaddingRequired).checkboxradio('refresh');$('#chkPostPaddingRequired',page).checked(item.IsPostPaddingRequired).checkboxradio('refresh');$('#chkNewOnly',page).checked(item.RecordNewOnly).checkboxradio('refresh');$('#chkAllChannels',page).checked(item.RecordAnyChannel).checkboxradio('refresh');$('#chkAnyTime',page).checked(item.RecordAnyTime).checkboxradio('refresh');var channelHtml='';if(item.RecordAnyChannel){channelHtml+=Globalize.translate('LabelAllChannels');}
else if(item.ChannelId){channelHtml+='<a href="livetvchannel.html?id='+item.ChannelId+'">'+item.ChannelName+'</a>';}
$('.channel',page).html(channelHtml).trigger('create');selectDays(page,item.Days);if(item.RecordAnyTime){$('.time',page).html(Globalize.translate('LabelAnytime')).trigger('create');}
else if(item.ChannelId){$('.time',page).html(LiveTvHelpers.getDisplayTime(item.StartDate)).trigger('create');}
Dashboard.hideLoadingMsg();}
function getDaysOfWeek(){return LiveTvHelpers.getDaysOfWeek().map(function(d){return d.value;});}
function selectDays(page,days){var daysOfWeek=getDaysOfWeek();for(var i=0,length=daysOfWeek.length;i<length;i++){var day=daysOfWeek[i];$('#chk'+day,page).checked(days.indexOf(day)!=-1).checkboxradio('refresh');}}
function getDays(page){var daysOfWeek=getDaysOfWeek();var days=[];for(var i=0,length=daysOfWeek.length;i<length;i++){var day=daysOfWeek[i];if($('#chk'+day,page).checked()){days.push(day);}}
return days;}
function onSubmit(){Dashboard.showLoadingMsg();var form=this;ApiClient.getLiveTvSeriesTimer(currentItem.Id).done(function(item){item.PrePaddingSeconds=$('#txtPrePaddingMinutes',form).val()*60;item.PostPaddingSeconds=$('#txtPostPaddingMinutes',form).val()*60;item.IsPrePaddingRequired=$('#chkPrePaddingRequired',form).checked();item.IsPostPaddingRequired=$('#chkPostPaddingRequired',form).checked();item.RecordNewOnly=$('#chkNewOnly',form).checked();item.RecordAnyChannel=$('#chkAllChannels',form).checked();item.RecordAnyTime=$('#chkAnyTime',form).checked();item.Days=getDays(form);ApiClient.updateLiveTvSeriesTimer(item).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingSaved'));});});return false;}
function renderRecordings(page,result){$('.recordingsTab',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"detailPageSquare",showTitle:true,overlayText:true,coverImage:true}));}
function renderSchedule(page,result){var timers=result.Items;var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var index='';for(var i=0,length=timers.length;i<length;i++){var timer=timers[i];var startDateText=LibraryBrowser.getFutureDateText(parseISO8601Date(timer.StartDate,{toLocal:true}));if(startDateText!=index){html+='<li data-role="list-divider">'+startDateText+'</li>';index=startDateText;}
html+='<li><a href="livetvtimer.html?id='+timer.Id+'">';var program=timer.ProgramInfo||{};var imgUrl;var programImages=program.ImageTags||{};if(programImages.Primary){imgUrl=ApiClient.getScaledImageUrl(program.Id,{height:80,tag:programImages.Primary,type:"Primary"});}else{imgUrl="css/images/items/searchhintsv2/tv.png";}
html+='<img src="css/images/items/searchhintsv2/tv.png" style="display:none;">';html+='<div class="ui-li-thumb" style="background-image:url(\''+imgUrl+'\');width:5em;height:5em;background-repeat:no-repeat;background-position:center center;background-size: cover;"></div>';html+='<h3>';html+=program.EpisodeTitle||timer.Name;html+='</h3>';html+='<p>';if(program.IsLive){html+='<span class="liveTvProgram">'+Globalize.translate('LabelLiveProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsPremiere){html+='<span class="premiereTvProgram">'+Globalize.translate('LabelPremiereProgram')+'&nbsp;&nbsp;</span>';}
else if(program.IsSeries&&!program.IsRepeat){html+='<span class="newTvProgram">'+Globalize.translate('LabelNewProgram')+'&nbsp;&nbsp;</span>';}
html+=LiveTvHelpers.getDisplayTime(timer.StartDate);html+=' - '+LiveTvHelpers.getDisplayTime(timer.EndDate);html+='</p>';if(timer.SeriesTimerId){html+='<div class="ui-li-aside" style="right:0;">';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='</div>';}
html+='</a>';html+='<a data-timerid="'+timer.Id+'" href="#" title="'+Globalize.translate('ButonCancelRecording')+'" class="btnCancelTimer">'+Globalize.translate('ButonCancelRecording')+'</a>';html+='</li>';}
html+='</ul>';var elem=$('.scheduleTab',page).html(html).trigger('create');$('.btnCancelTimer',elem).on('click',function(){deleteTimer(page,this.getAttribute('data-timerid'));});}
function reload(page){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getLiveTvSeriesTimer(id).done(function(result){renderTimer(page,result);});ApiClient.getLiveTvRecordings({userId:Dashboard.getCurrentUserId(),seriesTimerId:id}).done(function(recordingResult){renderRecordings(page,recordingResult);});ApiClient.getLiveTvTimers({seriesTimerId:id}).done(function(timerResult){renderSchedule(page,timerResult);});}
$(document).on('pageinit',"#liveTvSeriesTimerPage",function(){var page=this;$('.radioSeriesTimerTab',page).on('change',function(){$('.tab',page).hide();$('.'+this.value+'Tab',page).show();});}).on('pagebeforeshow',"#liveTvSeriesTimerPage",function(){var page=this;$('.radioProfileTab',page).checked(false).checkboxradio('refresh');$('#radioSettings',page).checked(true).checkboxradio('refresh').trigger('change');reload(page);}).on('pagehide',"#liveTvSeriesTimerPage",function(){currentItem=null;});function liveTvSeriesTimerPage(){var self=this;self.onSubmit=onSubmit;}
window.LiveTvSeriesTimerPage=new liveTvSeriesTimerPage();})(window,jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending"};function deleteSeriesTimer(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmSeriesCancellation'),Globalize.translate('HeaderConfirmSeriesCancellation'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.cancelLiveTvSeriesTimer(id).done(function(){Dashboard.alert(Globalize.translate('MessageSeriesCancelled'));reload(page);});}});}
function renderTimers(page,timers){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderSeriesRecordings')+'</li>';for(var i=0,length=timers.length;i<length;i++){var timer=timers[i];html+='<li><a href="livetvseriestimer.html?id='+timer.Id+'">';html+='<h3>';html+=timer.Name;html+='</h3>';html+='<p>';if(timer.DayPattern){html+=timer.DayPattern;}
else{var days=timer.Days||[];html+=days.join(', ');}
if(timer.RecordAnyTime){html+=' - '+Globalize.translate('LabelAnytime');}else{html+=' - '+LiveTvHelpers.getDisplayTime(timer.StartDate);}
html+='</p>';html+='<p>';if(timer.RecordAnyChannel){html+=Globalize.translate('LabelAllChannels');}
else if(timer.ChannelId){html+=timer.ChannelName;}
html+='</p>';html+='</a>';html+='<a data-seriestimerid="'+timer.Id+'" href="#" title="'+Globalize.translate('ButtonCancelSeries')+'" class="btnCancelSeries">'+Globalize.translate('ButtonCancelSeries')+'</a>';html+='</li>';}
html+='</ul>';var elem=$('#items',page).html(html).trigger('create');$('.btnCancelSeries',elem).on('click',function(){deleteSeriesTimer(page,this.getAttribute('data-seriestimerid'));});Dashboard.hideLoadingMsg();}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvSeriesTimers(query).done(function(result){renderTimers(page,result.Items);});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');}
$(document).on('pagebeforeshow',"#liveTvSeriesTimersPage",function(){var page=this;reload(page);}).on('pageinit',"#liveTvSeriesTimersPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reload(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reload(page);});}).on('pageshow',"#liveTvSeriesTimersPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document,window){function loadPage(page,config,liveTvInfo){if(liveTvInfo.IsEnabled){$('.liveTvSettingsForm',page).show();$('.noLiveTvServices',page).hide();}else{$('.liveTvSettingsForm',page).hide();$('.noLiveTvServices',page).show();}
$('#selectGuideDays',page).val(config.GuideDays||'').selectmenu('refresh');$('#chkMovies',page).checked(config.EnableMovieProviders).checkboxradio("refresh");Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#liveTvSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getNamedConfiguration("livetv");var promise2=ApiClient.getLiveTvInfo();$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});});window.LiveTvSettingsPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("livetv").done(function(config){config.GuideDays=$('#selectGuideDays',form).val()||null;config.EnableMovieProviders=$('#chkMovies',form).checked();ApiClient.updateNamedConfiguration("livetv",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);(function($,document){function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvRecommendedPrograms({userId:Dashboard.getCurrentUserId(),IsAiring:true,limit:18}).done(function(result){var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:true,showParentTitle:true,overlayText:true,coverImage:true,lazy:true});$('.activeProgramItems',page).html(html).lazyChildren();});ApiClient.getLiveTvRecommendedPrograms({userId:Dashboard.getCurrentUserId(),IsAiring:false,HasAired:false,limit:9,IsMovie:false,IsSports:false}).done(function(result){var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:true,showParentTitle:true,overlayText:true,coverImage:true,lazy:true});$('.upcomingProgramItems',page).html(html).lazyChildren();});ApiClient.getLiveTvRecommendedPrograms({userId:Dashboard.getCurrentUserId(),IsAiring:false,HasAired:false,limit:9,IsMovie:true}).done(function(result){var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:false,coverImage:true,overlayText:false,lazy:true});$('.upcomingTvMovieItems',page).html(html).lazyChildren();});ApiClient.getLiveTvRecommendedPrograms({userId:Dashboard.getCurrentUserId(),IsAiring:false,HasAired:false,limit:9,IsSports:true}).done(function(result){var html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",showTitle:false,coverImage:true,overlayText:false,lazy:true});$('.upcomingSportsItems',page).html(html).lazyChildren();});}
$(document).on('pagebeforeshow',"#liveTvSuggestedPage",function(){var page=this;reload(page);});})(jQuery,document);(function($,document,window){function resetTuner(page,id){var message=Globalize.translate('MessageConfirmResetTuner');Dashboard.confirm(message,Globalize.translate('HeaderResetTuner'),function(confirmResult){if(confirmResult){Dashboard.showLoadingMsg();ApiClient.resetLiveTvTuner(id).done(function(){Dashboard.hideLoadingMsg();reload(page);});}});}
function renderTuners(page,tuners){var html='';for(var i=0,length=tuners.length;i<length;i++){var tuner=tuners[i];html+='<tr>';html+='<td>';html+=tuner.Name;html+='</td>';html+='<td>';html+=tuner.SourceType;html+='</td>';html+='<td>';if(tuner.Status=='RecordingTv'){if(tuner.ChannelName){html+='<a href="livetvchannel.html?id='+tuner.ChannelId+'">';html+=Globalize.translate('StatusRecordingProgram').replace('{0}',tuner.ChannelName);html+='</a>';}else{html+=Globalize.translate('StatusRecording');}}
else if(tuner.Status=='LiveTv'){if(tuner.ChannelName){html+='<a href="livetvchannel.html?id='+tuner.ChannelId+'">';html+=Globalize.translate('StatusWatchingProgram').replace('{0}',tuner.ChannelName);html+='</a>';}else{html+=Globalize.translate('StatusWatching');}}
else{html+=tuner.Status;}
html+='</td>';html+='<td>';if(tuner.ProgramName){html+=tuner.ProgramName;}
html+='</td>';html+='<td>';html+=tuner.Clients.join('<br/>');html+='</td>';html+='<td>';html+='<button data-tunerid="'+tuner.Id+'" type="button" data-inline="true" data-icon="refresh" data-mini="true" data-iconpos="notext" class="btnResetTuner organizerButton" title="'+Globalize.translate('ButtonResetTuner')+'">'+Globalize.translate('ButtonResetTuner')+'</button>';html+='</td>';html+='</tr>';}
var elem=$('.tunersResultBody',page).html(html).parents('.tblTuners').table("refresh").trigger('create');$('.btnResetTuner',elem).on('click',function(){var id=this.getAttribute('data-tunerid');resetTuner(page,id);});}
function getServiceHtml(service){var html='';html+='<div>';var serviceUrl=service.HomePageUrl||'#';html+='<p><a href="'+serviceUrl+'" target="_blank">'+service.Name+'</a></p>';var versionHtml=service.Version||'Unknown';if(service.HasUpdateAvailable){versionHtml+=' <a style="margin-left: .25em;" href="'+serviceUrl+'" target="_blank">'+Globalize.translate('LiveTvUpdateAvailable')+'</a>';}
else{versionHtml+='<img src="css/images/checkmarkgreen.png" style="height: 17px; margin-left: 10px; margin-right: 0; position: relative; top: 5px; border-radius:3px;" /> '+Globalize.translate('LabelVersionUpToDate');}
html+='<p>'+versionHtml+'</p>';var status=service.Status;if(service.Status=='Ok'){status='<span style="color:green;">'+status+'</span>';}else{if(service.StatusMessage){status+=' ('+service.StatusMessage+')';}
status='<span style="color:red;">'+status+'</span>';}
html+='<p>'+Globalize.translate('ValueStatus',status)+'</p>';html+='</div>';return html;}
function loadPage(page,liveTvInfo){if(liveTvInfo.IsEnabled){$('.liveTvStatusContent',page).show();$('.noLiveTvServices',page).hide();}else{$('.liveTvStatusContent',page).hide();$('.noLiveTvServices',page).show();}
$('.servicesList',page).html(liveTvInfo.Services.map(getServiceHtml).join('')).trigger('create');var tuners=[];for(var i=0,length=liveTvInfo.Services.length;i<length;i++){for(var j=0,numTuners=liveTvInfo.Services[i].Tuners.length;j<numTuners;j++){tuners.push(liveTvInfo.Services[i].Tuners[j]);}}
renderTuners(page,tuners);Dashboard.hideLoadingMsg();}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvInfo().done(function(liveTvInfo){loadPage(page,liveTvInfo);});}
$(document).on('pageshow',"#liveTvStatusPage",function(){var page=this;reload(page);$('.btnRefreshGuide',page).taskButton({mode:'on',progressElem:$('.refreshGuideProgress',page),lastResultElem:$('.lastRefreshGuideResult',page),taskKey:'RefreshGuide'});}).on('pagehide',"#liveTvStatusPage",function(){var page=this;$('.btnRefreshGuide',page).taskButton({mode:'off'});});})(jQuery,document,window);(function($,document){function deleteTimer(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmRecordingCancellation'),Globalize.translate('HeaderConfirmRecordingCancellation'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.cancelLiveTvTimer(id).done(function(){Dashboard.alert(Globalize.translate('MessageRecordingCancelled'));reload(page);});}});}
function renderTimers(page,timers){var html='';html+='<ul data-role="listview" data-inset="true" data-split-icon="delete">';var index='';for(var i=0,length=timers.length;i<length;i++){var timer=timers[i];var startDateText=LibraryBrowser.getFutureDateText(parseISO8601Date(timer.StartDate,{toLocal:true}));if(startDateText!=index){html+='<li data-role="list-divider">'+startDateText+'</li>';index=startDateText;}
html+='<li><a href="livetvtimer.html?id='+timer.Id+'">';var program=timer.ProgramInfo||{};var imgUrl;if(program.ImageTags&&program.ImageTags.Primary){imgUrl=ApiClient.getScaledImageUrl(program.Id,{height:80,tag:program.ImageTags.Primary,type:"Primary"});}else{imgUrl="css/images/items/searchhintsv2/tv.png";}
html+='<img src="css/images/items/searchhintsv2/tv.png" style="display:none;">';html+='<div class="ui-li-thumb" style="background-image:url(\''+imgUrl+'\');width:5em;height:5em;background-repeat:no-repeat;background-position:center center;background-size: cover;"></div>';html+='<h3>';html+=timer.Name;html+='</h3>';html+='<p>';html+=LiveTvHelpers.getDisplayTime(timer.StartDate);html+=' - '+LiveTvHelpers.getDisplayTime(timer.EndDate);html+='</p>';if(timer.SeriesTimerId){html+='<div class="ui-li-aside" style="right:0;">';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='<div class="timerCircle seriesTimerCircle"></div>';html+='</div>';}
html+='</a>';html+='<a data-timerid="'+timer.Id+'" href="#" title="'+Globalize.translate('ButonCancelRecording')+'" class="btnDeleteTimer">'+Globalize.translate('ButonCancelRecording')+'</a>';html+='</li>';}
html+='</ul>';var elem=$('#items',page).html(html).trigger('create');$('.btnDeleteTimer',elem).on('click',function(){var id=this.getAttribute('data-timerid');deleteTimer(page,id);});Dashboard.hideLoadingMsg();}
function reload(page){Dashboard.showLoadingMsg();ApiClient.getLiveTvTimers().done(function(result){renderTimers(page,result.Items);});}
$(document).on('pagebeforeshow',"#liveTvTimersPage",function(){var page=this;reload(page);});})(jQuery,document);var LoginPage={onPageShow:function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getPublicUsers();promise1.done(function(users){var showManualForm=!users.length;if(showManualForm){LoginPage.showManualForm(page,false,false);}else{LoginPage.showVisualForm(page);LoginPage.loadUserList(users);}
Dashboard.hideLoadingMsg();});ApiClient.getJSON(ApiClient.getUrl('Branding/Configuration')).done(function(options){$('.disclaimer',page).html(options.LoginDisclaimer||'');});},cancelLogin:function(){LoginPage.showVisualForm($.mobile.activePage);},showManualForm:function(page,showCancel,focusPassword){$('.visualLoginForm',page).hide();$('#manualLoginForm',page).show();if(focusPassword){$('#txtManualPassword',page).focus();}else{$('#txtManualName',page).focus();}
if(showCancel){$('.btnCancel',page).show();}else{$('.btnCancel',page).hide();}},showVisualForm:function(page){$('.visualLoginForm',page).show();$('#manualLoginForm',page).hide();},getLastSeenText:function(lastActivityDate){if(!lastActivityDate){return"";}
return"Last seen "+humane_date(lastActivityDate);},getImagePath:function(user){if(!user.PrimaryImageTag){return"css/images/logindefault.png";}
return ApiClient.getUserImageUrl(user.Id,{width:240,tag:user.PrimaryImageTag,type:"Primary"});},authenticateUserByName:function(username,password){Dashboard.showLoadingMsg();ApiClient.authenticateUserByName(username,password).done(function(result){var user=result.User;Dashboard.setCurrentUser(user.Id,result.AccessToken);if(user.Policy.IsAdministrator){window.location="dashboard.html?u="+user.Id+'&t='+result.AccessToken;}else{window.location="index.html?u="+user.Id+'&t='+result.AccessToken;}}).fail(function(){$('#pw','#loginPage').val('');$('#txtManualName','#loginPage').val('');$('#txtManualPassword','#loginPage').val('');Dashboard.hideLoadingMsg();setTimeout(function(){Dashboard.showError(Globalize.translate('MessageInvalidUser'));},300);});},loadUserList:function(users){var html="";var page=$.mobile.activePage;for(var i=0,length=users.length;i<length;i++){var user=users[i];html+='<div class="card squareCard alternateHover bottomPaddedCard"><div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';html+='<a class="cardContent" href="#" data-ajax="false" data-haspw="'+user.HasPassword+'" data-username="'+user.Name+'" data-userid="'+user.Id+'">';var imgUrl;if(user.PrimaryImageTag){imgUrl=ApiClient.getUserImageUrl(user.Id,{width:300,tag:user.PrimaryImageTag,type:"Primary"});html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');"></div>';}
else{var background=LibraryBrowser.getMetroColor(user.Id);imgUrl='css/images/logindefault.png';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');background-color:'+background+';"></div>';}
html+='</a>';html+='</div>';html+='<div class="cardFooter">';html+='<div class="cardText">'+user.Name+'</div>';html+='<div class="cardText">';var lastSeen=LoginPage.getLastSeenText(user.LastActivityDate);if(lastSeen!=""){html+=lastSeen;}
else{html+="&nbsp;";}
html+='</div>';html+='</div>';html+='</div>';html+='</div>';}
var elem=$('#divUsers','#loginPage').html(html);$('a',elem).on('click',function(){var name=this.getAttribute('data-username');var haspw=this.getAttribute('data-haspw');if(haspw=='false'){LoginPage.authenticateUserByName(name,'');}else{$('#txtManualName',page).val(name);$('#txtManualPassword','#loginPage').val('');LoginPage.showManualForm(page,true,true);}});},onManualSubmit:function(){LoginPage.authenticateUserByName($('#txtManualName','#loginPage').val(),$('#txtManualPassword','#loginPage').val());return false;}};$(document).on('pageshow',"#loginPage",LoginPage.onPageShow);(function(){$(document).on('pagebeforeshow',"#logPage",function(){var page=this;var apiClient=ApiClient;apiClient.getJSON(apiClient.getUrl('System/Logs')).done(function(logs){var html='';html+='<ul data-role="listview" data-inset="true">';html+=logs.map(function(log){var logUrl=apiClient.getUrl('System/Logs/Log',{name:log.Name});logUrl+="&api_key="+apiClient.accessToken();var logHtml='<li><a href="'+logUrl+'" target="_blank">';logHtml+='<h3>';logHtml+=log.Name;logHtml+='</h3>';var date=parseISO8601Date(log.DateModified,{toLocal:true});var text=date.toLocaleDateString();text+=' '+LiveTvHelpers.getDisplayTime(date);logHtml+='<p>'+text+'</p>';logHtml+='</li>';return logHtml;}).join('');html+='</ul>';$('.serverLogs',page).html(html).trigger('create');});});})();var MediaLibraryPage={onPageInit:function(){var page=this;$('#selectCollectionType',page).on('change',function(){var index=this.selectedIndex;if(index!=-1){var name=this.options[index].innerHTML.replace('*','').replace('&amp;','&');var value=this.value;$('#txtValue',page).val(name);var folderOption=MediaLibraryPage.getCollectionTypeOptions().filter(function(i){return i.value==value;})[0];$('.collectionTypeFieldDescription',page).html(folderOption.message||'');}});},onPageShow:function(){var page=this;MediaLibraryPage.lastVirtualFolderName="";MediaLibraryPage.reloadLibrary(page);},reloadLibrary:function(page){Dashboard.showLoadingMsg();ApiClient.getVirtualFolders().done(function(result){MediaLibraryPage.reloadVirtualFolders(page,result);});$('#divMediaLibrary',page).show();},shouldRefreshLibraryAfterChanges:function(){return $($.mobile.activePage).is('#mediaLibraryPage');},reloadVirtualFolders:function(page,virtualFolders){if(virtualFolders){MediaLibraryPage.virtualFolders=virtualFolders;}else{virtualFolders=MediaLibraryPage.virtualFolders;}
var html='';var addPathMappingInfo=$(page).is('#mediaLibraryPage');for(var i=0,length=virtualFolders.length;i<length;i++){var virtualFolder=virtualFolders[i];var isCollapsed=MediaLibraryPage.lastVirtualFolderName!=virtualFolder.Name;html+=MediaLibraryPage.getVirtualFolderHtml(virtualFolder,isCollapsed,i,addPathMappingInfo);}
$('#divVirtualFolders',page).html(html).trigger('create');Dashboard.hideLoadingMsg();},changeCollectionType:function(){Dashboard.alert({message:Globalize.translate('HeaderChangeFolderTypeHelp'),title:Globalize.translate('HeaderChangeFolderType')});},getVirtualFolderHtml:function(virtualFolder,isCollapsed,index,addPathMappingInfo){isCollapsed=isCollapsed?"true":"false";var html='<div class="collapsibleVirtualFolder" data-mini="true" data-role="collapsible" data-collapsed="'+isCollapsed+'">';html+='<h3>'+virtualFolder.Name+'</h3>';var typeName=MediaLibraryPage.getCollectionTypeOptions().filter(function(t){return t.value==virtualFolder.CollectionType;})[0];typeName=typeName?typeName.name:Globalize.translate('FolderTypeUnset');html+='<p style="padding-left:.5em;">';html+=Globalize.translate('LabelContentTypeValue').replace('{0}','<b>'+typeName+'</b>');html+='</p><ul class="mediaFolderLocations" data-inset="true" data-role="listview" data-split-icon="minus">';html+='<li data-role="list-divider" class="mediaLocationsHeader">'+Globalize.translate('HeaderMediaLocations');html+='<button type="button" data-icon="plus" data-mini="true" data-iconpos="notext" data-inline="true" onclick="MediaLibraryPage.addMediaLocation('+index+');">'+Globalize.translate('ButtonAdd')+'</button>';html+='</li>';for(var i=0,length=virtualFolder.Locations.length;i<length;i++){var location=virtualFolder.Locations[i];html+='<li>';html+='<a style="font-size:14px;" class="lnkMediaLocation" href="#">'+location+'</a>';html+='<a href="#" data-index="'+i+'" data-folderindex="'+index+'" onclick="MediaLibraryPage.deleteMediaLocation(this);"></a>';html+='</li>';}
html+='</ul>';if(addPathMappingInfo){html+='<div class="fieldDescription" style="margin:.5em 0 1.5em;">'+Globalize.translate('LabelPathSubstitutionHelp')+'</div>';}
html+='<p>';html+='<button type="button" data-inline="true" data-icon="minus" data-folderindex="'+index+'" onclick="MediaLibraryPage.deleteVirtualFolder(this);" data-mini="true">'+Globalize.translate('ButtonRemove')+'</button>';html+='<button type="button" data-inline="true" data-icon="edit" data-folderindex="'+index+'" onclick="MediaLibraryPage.renameVirtualFolder(this);" data-mini="true">'+Globalize.translate('ButtonRename')+'</button>';html+='<button type="button" data-inline="true" data-icon="edit" data-folderindex="'+index+'" onclick="MediaLibraryPage.changeCollectionType(this);" data-mini="true">'+Globalize.translate('ButtonChangeType')+'</button>';html+='</p>';html+='</div>';return html;},addVirtualFolder:function(){$('.collectionTypeFieldDescription').show();MediaLibraryPage.getTextValue(Globalize.translate('HeaderAddMediaFolder'),Globalize.translate('LabelName'),"",true,function(name,type){MediaLibraryPage.lastVirtualFolderName=name;var refreshAfterChange=MediaLibraryPage.shouldRefreshLibraryAfterChanges();ApiClient.addVirtualFolder(name,type,refreshAfterChange).done(MediaLibraryPage.processOperationResult);});},addMediaLocation:function(virtualFolderIndex){MediaLibraryPage.selectDirectory(function(path){if(path){var virtualFolder=MediaLibraryPage.virtualFolders[virtualFolderIndex];MediaLibraryPage.lastVirtualFolderName=virtualFolder.Name;var refreshAfterChange=MediaLibraryPage.shouldRefreshLibraryAfterChanges();ApiClient.addMediaPath(virtualFolder.Name,path,refreshAfterChange).done(MediaLibraryPage.processOperationResult);}});},selectDirectory:function(callback){var picker=new DirectoryBrowser($.mobile.activePage);picker.show({callback:callback});MediaLibraryPage.directoryPicker=picker;},getTextValue:function(header,label,initialValue,showCollectionType,callback){var page=$.mobile.activePage;var popup=$('#popupEnterText',page);$('h3',popup).html(header);$('#lblValue',popup).html(label);$('#txtValue',popup).val(initialValue);if(showCollectionType){$('#fldCollectionType',popup).show();$('#selectCollectionType',popup).attr('required','required').selectmenu('refresh');}else{$('#fldCollectionType',popup).hide();$('#selectCollectionType',popup).removeAttr('required').selectmenu('refresh');}
$('#selectCollectionType',popup).html(MediaLibraryPage.getCollectionTypeOptionsHtml()).val('').selectmenu('refresh');popup.on("popupafterclose",function(){$(this).off("popupafterclose").off("click");$('#textEntryForm',this).off("submit");}).popup("open");$('#textEntryForm',popup).on('submit',function(){if(callback){if(showCollectionType){var collectionType=$('#selectCollectionType',popup).val();if(collectionType=='mixed'){collectionType='';}
callback($('#txtValue',popup).val(),collectionType);}else{callback($('#txtValue',popup).val());}}
return false;});},getCollectionTypeOptionsHtml:function(){return MediaLibraryPage.getCollectionTypeOptions().filter(function(i){return i.isSelectable!==false;}).map(function(i){return'<option value="'+i.value+'">'+i.name+'</option>';}).join("");},getCollectionTypeOptions:function(){return[{name:"",value:""},{name:Globalize.translate('FolderTypeMovies'),value:"movies"},{name:Globalize.translate('FolderTypeMusic'),value:"music"},{name:Globalize.translate('FolderTypeTvShows'),value:"tvshows"},{name:Globalize.translate('FolderTypeBooks'),value:"books",message:Globalize.translate('MessageBookPluginRequired')},{name:Globalize.translate('FolderTypeGames'),value:"games",message:Globalize.translate('MessageGamePluginRequired')},{name:Globalize.translate('FolderTypeHomeVideos'),value:"homevideos"},{name:Globalize.translate('FolderTypeMusicVideos'),value:"musicvideos"},{name:Globalize.translate('FolderTypePhotos'),value:"photos"},{name:Globalize.translate('FolderTypeUnset'),value:"mixed",message:Globalize.translate('MessageUnsetContentHelp')}];},renameVirtualFolder:function(button){var folderIndex=button.getAttribute('data-folderindex');var virtualFolder=MediaLibraryPage.virtualFolders[folderIndex];MediaLibraryPage.lastVirtualFolderName=virtualFolder.Name;$('.collectionTypeFieldDescription').hide();MediaLibraryPage.getTextValue(Globalize.translate('HeaderRenameMediaFolder'),Globalize.translate('LabelNewName'),virtualFolder.Name,false,function(newName){if(virtualFolder.Name!=newName){var refreshAfterChange=MediaLibraryPage.shouldRefreshLibraryAfterChanges();ApiClient.renameVirtualFolder(virtualFolder.Name,newName,refreshAfterChange).done(MediaLibraryPage.processOperationResult);}});},deleteVirtualFolder:function(button){var folderIndex=button.getAttribute('data-folderindex');var virtualFolder=MediaLibraryPage.virtualFolders[folderIndex];var parent=$(button).parents('.collapsibleVirtualFolder');var locations=$('.lnkMediaLocation',parent).map(function(){return this.innerHTML;}).get();var msg=Globalize.translate('MessageAreYouSureYouWishToRemoveMediaFolder');if(locations.length){msg+="<br/><br/>"+Globalize.translate("MessageTheFollowingLocationWillBeRemovedFromLibrary")+"<br/><br/>";msg+=locations.join("<br/>");}
MediaLibraryPage.lastVirtualFolderName=virtualFolder.Name;Dashboard.confirm(msg,Globalize.translate('HeaderRemoveMediaFolder'),function(confirmResult){if(confirmResult){var refreshAfterChange=MediaLibraryPage.shouldRefreshLibraryAfterChanges();ApiClient.removeVirtualFolder(virtualFolder.Name,refreshAfterChange).done(MediaLibraryPage.processOperationResult);}});},deleteMediaLocation:function(button){var folderIndex=button.getAttribute('data-folderindex');var index=parseInt(button.getAttribute('data-index'));var virtualFolder=MediaLibraryPage.virtualFolders[folderIndex];MediaLibraryPage.lastVirtualFolderName=virtualFolder.Name;var location=virtualFolder.Locations[index];Dashboard.confirm(Globalize.translate('MessageConfirmRemoveMediaLocation'),Globalize.translate('HeaderRemoveMediaLocation'),function(confirmResult){if(confirmResult){var refreshAfterChange=MediaLibraryPage.shouldRefreshLibraryAfterChanges();ApiClient.removeMediaPath(virtualFolder.Name,location,refreshAfterChange).done(MediaLibraryPage.processOperationResult);}});},processOperationResult:function(result){Dashboard.hideLoadingMsg();var page=$.mobile.activePage;$('#popupEnterText',page).popup("close");if(MediaLibraryPage.directoryPicker){MediaLibraryPage.directoryPicker.close();MediaLibraryPage.directoryPicker=null;}
MediaLibraryPage.reloadLibrary(page);}};$(document).on('pageinit',".mediaLibraryPage",MediaLibraryPage.onPageInit).on('pageshow',".mediaLibraryPage",MediaLibraryPage.onPageShow);var WizardLibraryPage={next:function(){Dashboard.showLoadingMsg();var apiClient=ApiClient;apiClient.ajax({type:"POST",url:apiClient.getUrl('System/Configuration/MetadataPlugins/Autoset')}).done(function(){Dashboard.hideLoadingMsg();Dashboard.navigate('wizardsettings.html');});}};(function($,document,window){$(document).on('pageshow',"#mediaLibraryPage",function(){var page=this;$('.btnRefresh',page).taskButton({mode:'on',progressElem:$('.refreshProgress',page),lastResultElem:$('.lastRefreshResult',page),taskKey:'RefreshLibrary'});}).on('pagehide',"#mediaLibraryPage",function(){var page=this;$('.btnRefresh',page).taskButton({mode:'off'});});})(jQuery,document,window);var MetadataConfigurationPage={onPageShow:function(){Dashboard.showLoadingMsg();var page=this;var config;var allCultures;var allCountries;ApiClient.getServerConfiguration().done(function(result){config=result;MetadataConfigurationPage.load(page,config,allCultures,allCountries);});ApiClient.getCultures().done(function(result){Dashboard.populateLanguages($('#selectLanguage',page),result);allCultures=result;MetadataConfigurationPage.load(page,config,allCultures,allCountries);});ApiClient.getCountries().done(function(result){Dashboard.populateCountries($('#selectCountry',page),result);allCountries=result;MetadataConfigurationPage.load(page,config,allCultures,allCountries);});},load:function(page,config,allCultures,allCountries){if(!config||!allCultures||!allCountries){return;}
$('#chkEnableInternetProviders',page).checked(config.EnableInternetProviders).checkboxradio("refresh");$('#chkSaveLocal',page).checked(config.SaveLocalMeta).checkboxradio("refresh");$('#selectLanguage',page).val(config.PreferredMetadataLanguage).selectmenu("refresh");$('#selectCountry',page).val(config.MetadataCountryCode).selectmenu("refresh");$('#selectImageSavingConvention',page).val(config.ImageSavingConvention).selectmenu("refresh");Dashboard.hideLoadingMsg();},onSubmit:function(){var form=this;Dashboard.showLoadingMsg();ApiClient.getServerConfiguration().done(function(config){config.ImageSavingConvention=$('#selectImageSavingConvention',form).val();config.EnableInternetProviders=$('#chkEnableInternetProviders',form).checked();config.SaveLocalMeta=$('#chkSaveLocal',form).checked();config.PreferredMetadataLanguage=$('#selectLanguage',form).val();config.MetadataCountryCode=$('#selectCountry',form).val();ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};$(document).on('pageshow',"#metadataConfigurationPage",MetadataConfigurationPage.onPageShow);(function($,document,window){var currentType;function loadTabs(page,tabs){var html='';for(var i=0,length=tabs.length;i<length;i++){var tab=tabs[i];var isChecked=i==0?' selected="selected"':'';html+='<option value="'+tab.type+'"'+isChecked+'>'+Globalize.translate(tab.name)+'</option>';}
$('#selectItemType',page).html(html).selectmenu('refresh').trigger('change');Dashboard.hideLoadingMsg();}
function loadType(page,type){Dashboard.showLoadingMsg();currentType=type;var promise1=ApiClient.getServerConfiguration();var promise2=ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataPlugins"));$.when(promise1,promise2).done(function(response1,response2){var config=response1[0];var metadataPlugins=response2[0];config=config.MetadataOptions.filter(function(c){return c.ItemType==type;})[0];if(config){renderType(page,type,config,metadataPlugins);Dashboard.hideLoadingMsg();}else{ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).done(function(defaultConfig){config=defaultConfig;renderType(page,type,config,metadataPlugins);Dashboard.hideLoadingMsg();});}});}
function setVisibilityOfBackdrops(elem,visible){if(visible){elem.show();$('input',elem).attr('required','required');}else{elem.hide();$('input',elem).attr('required','').removeAttr('required');}}
function renderType(page,type,config,metadataPlugins){var metadataInfo=metadataPlugins.filter(function(f){return type==f.ItemType;})[0];setVisibilityOfBackdrops($('.backdropFields',page),metadataInfo.SupportedImageTypes.indexOf('Backdrop')!=-1);setVisibilityOfBackdrops($('.screenshotFields',page),metadataInfo.SupportedImageTypes.indexOf('Screenshot')!=-1);$('.imageType',page).each(function(){var imageType=this.getAttribute('data-imagetype');if(metadataInfo.SupportedImageTypes.indexOf(imageType)==-1){$(this).hide();}else{$(this).show();}
if(getImageConfig(config,imageType).Limit){$('input',this).checked(true).checkboxradio('refresh');}else{$('input',this).checked(false).checkboxradio('refresh');}});var backdropConfig=getImageConfig(config,'Backdrop');$('#txtMaxBackdrops',page).val(backdropConfig.Limit);$('#txtMinBackdropDownloadWidth',page).val(backdropConfig.MinWidth);var screenshotConfig=getImageConfig(config,'Screenshot');$('#txtMaxScreenshots',page).val(screenshotConfig.Limit);$('#txtMinScreenshotDownloadWidth',page).val(screenshotConfig.MinWidth);renderMetadataLocals(page,type,config,metadataInfo);renderMetadataFetchers(page,type,config,metadataInfo);renderMetadataSavers(page,type,config,metadataInfo);renderImageFetchers(page,type,config,metadataInfo);}
function getImageConfig(config,type){return config.ImageOptions.filter(function(i){return i.Type==type;})[0]||{Type:type,MinWidth:type=='Backdrop'?1280:0,Limit:type=='Backdrop'?3:1};}
function renderImageFetchers(page,type,config,metadataInfo){var plugins=metadataInfo.Plugins.filter(function(p){return p.Type=='ImageFetcher';});var html='';if(!plugins.length){$('.imageFetchers',page).html(html).hide().trigger('create');return;}
var i,length,plugin,id;html+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate('LabelImageFetchers')+'</div>';html+='<div style="display:inline-block;width: 75%;vertical-align:top;">';html+='<div data-role="controlgroup" class="imageFetcherGroup">';for(i=0,length=plugins.length;i<length;i++){plugin=plugins[i];id='chkImageFetcher'+i;var isChecked=config.DisabledImageFetchers.indexOf(plugin.Name)==-1?' checked="checked"':'';html+='<input class="chkImageFetcher" type="checkbox" name="'+id+'" id="'+id+'" data-pluginname="'+plugin.Name+'" data-mini="true"'+isChecked+'>';html+='<label for="'+id+'">'+plugin.Name+'</label>';}
html+='</div>';html+='</div>';if(plugins.length>1){html+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">';for(i=0,length=plugins.length;i<length;i++){html+='<div style="margin:6px 0;">';if(i==0){html+='<button data-inline="true" disabled="disabled" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}else if(i==(plugins.length-1)){html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" disabled="disabled" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}
else{html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}
html+='</div>';}}
html+='</div>';html+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate('LabelImageFetchersHelp')+'</div>';var elem=$('.imageFetchers',page).html(html).show().trigger('create');$('.btnDown',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.imageFetcherGroup .ui-checkbox',page)[index];var insertAfter=$(elemToMove).next('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertAfter(insertAfter);$('.imageFetcherGroup',page).controlgroup('destroy').controlgroup();});$('.btnUp',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.imageFetcherGroup .ui-checkbox',page)[index];var insertBefore=$(elemToMove).prev('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertBefore(insertBefore);$('.imageFetcherGroup',page).controlgroup('destroy').controlgroup();});}
function renderMetadataSavers(page,type,config,metadataInfo){var plugins=metadataInfo.Plugins.filter(function(p){return p.Type=='MetadataSaver';});var html='';if(!plugins.length){$('.metadataSavers',page).html(html).hide().trigger('create');return;}
html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('LabelMetadataSavers')+'</legend>';for(var i=0,length=plugins.length;i<length;i++){var plugin=plugins[i];var id='chkMetadataSaver'+i;var isChecked=config.DisabledMetadataSavers.indexOf(plugin.Name)==-1?' checked="checked"':'';html+='<input class="chkMetadataSaver" type="checkbox" name="'+id+'" id="'+id+'" data-mini="true"'+isChecked+' data-pluginname="'+plugin.Name+'">';html+='<label for="'+id+'">'+plugin.Name+'</label>';}
html+='</fieldset>';html+='<div class="fieldDescription">'+Globalize.translate('LabelMetadataSaversHelp')+'</div>';$('.metadataSavers',page).html(html).show().trigger('create');}
function renderMetadataFetchers(page,type,config,metadataInfo){var plugins=metadataInfo.Plugins.filter(function(p){return p.Type=='MetadataFetcher';});var html='';if(!plugins.length){$('.metadataFetchers',page).html(html).hide().trigger('create');return;}
var i,length,plugin,id;html+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate('LabelMetadataDownloaders')+'</div>';html+='<div style="display:inline-block;width: 75%;vertical-align:top;">';html+='<div data-role="controlgroup" class="metadataFetcherGroup">';for(i=0,length=plugins.length;i<length;i++){plugin=plugins[i];id='chkMetadataFetcher'+i;var isChecked=config.DisabledMetadataFetchers.indexOf(plugin.Name)==-1?' checked="checked"':'';html+='<input class="chkMetadataFetcher" type="checkbox" name="'+id+'" id="'+id+'" data-pluginname="'+plugin.Name+'" data-mini="true"'+isChecked+'>';html+='<label for="'+id+'">'+plugin.Name+'</label>';}
html+='</div>';html+='</div>';if(plugins.length>1){html+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">';for(i=0,length=plugins.length;i<length;i++){html+='<div style="margin:6px 0;">';if(i==0){html+='<button data-inline="true" disabled="disabled" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}else if(i==(plugins.length-1)){html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" disabled="disabled" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}
else{html+='<button data-inline="true" class="btnUp" data-pluginindex="'+i+'" type="button" data-icon="arrow-u" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonUp')+'</button>';html+='<button data-inline="true" class="btnDown" data-pluginindex="'+i+'" type="button" data-icon="arrow-d" data-mini="true" data-iconpos="notext" style="margin: 0 1px;">'+Globalize.translate('ButtonDown')+'</button>';}
html+='</div>';}}
html+='</div>';html+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate('LabelMetadataDownloadersHelp')+'</div>';var elem=$('.metadataFetchers',page).html(html).show().trigger('create');$('.btnDown',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.metadataFetcherGroup .ui-checkbox',page)[index];var insertAfter=$(elemToMove).next('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertAfter(insertAfter);$('.metadataFetcherGroup',page).controlgroup('destroy').controlgroup();});$('.btnUp',elem).on('click',function(){var index=parseInt(this.getAttribute('data-pluginindex'));var elemToMove=$('.metadataFetcherGroup .ui-checkbox',page)[index];var insertBefore=$(elemToMove).prev('.ui-checkbox')[0];elemToMove.parentNode.removeChild(elemToMove);$(elemToMove).insertBefore(insertBefore);$('.metadataFetcherGroup',page).controlgroup('destroy').controlgroup();});}
function renderMetadataLocals(page,type,config,metadataInfo){var plugins=metadataInfo.Plugins.filter(function(p){return p.Type=='LocalMetadataProvider';});var html='';if(plugins.length<2){$('.metadataReaders',page).html(html).hide().trigger('create');return;}
html+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate('LabelMetadataReaders')+'</div>';html+='<ul data-role="listview" data-inset="true" data-mini="true" style="margin-top:.5em;margin-bottom:.5em;">';for(var i=0,length=plugins.length;i<length;i++){var plugin=plugins[i];html+='<li data-mini="true" class="localReaderOption" data-pluginname="'+plugin.Name+'">';if(i>0){html+='<a href="#" style="font-size:13px;font-weight:normal;">'+plugin.Name+'</a>';html+='<a class="btnLocalReaderUp btnLocalReaderMove" data-pluginindex="'+i+'" href="#" style="font-size:13px;font-weight:normal;" data-icon="arrow-u">'+Globalize.translate('ButtonUp')+'</a>';}
else if(plugins.length>1){html+='<a href="#" style="font-size:13px;font-weight:normal;">'+plugin.Name+'</a>';html+='<a class="btnLocalReaderDown btnLocalReaderMove" data-pluginindex="'+i+'" href="#" style="font-size:13px;font-weight:normal;" data-icon="arrow-d">'+Globalize.translate('ButtonDown')+'</a>';}
else{html+=plugin.Name;}
html+='</li>';}
html+='</ul>';html+='<div class="fieldDescription">'+Globalize.translate('LabelMetadataReadersHelp')+'</div>';$('.metadataReaders',page).html(html).show().trigger('create');}
function loadPage(page){loadTabs(page,[{name:'OptionMovies',type:'Movie'},{name:'OptionCollections',type:'BoxSet'},{name:'OptionSeries',type:'Series'},{name:'OptionSeasons',type:'Season'},{name:'OptionEpisodes',type:'Episode'},{name:'OptionGames',type:'Game'},{name:'OptionGameSystems',type:'GameSystem'},{name:'OptionMusicArtists',type:'MusicArtist'},{name:'OptionMusicAlbums',type:'MusicAlbum'},{name:'OptionMusicVideos',type:'MusicVideo'},{name:'OptionSongs',type:'Audio'},{name:'OptionHomeVideos',type:'Video'},{name:'OptionBooks',type:'Book'},{name:'OptionPeople',type:'Person'}]);}
function saveSettingsIntoConfig(form,config){config.DisabledMetadataSavers=$('.chkMetadataSaver:not(:checked)',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.LocalMetadataReaderOrder=$('.localReaderOption',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.DisabledMetadataFetchers=$('.chkMetadataFetcher:not(:checked)',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.MetadataFetcherOrder=$('.chkMetadataFetcher',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.DisabledImageFetchers=$('.chkImageFetcher:not(:checked)',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.ImageFetcherOrder=$('.chkImageFetcher',form).get().map(function(c){return c.getAttribute('data-pluginname');});config.ImageOptions=$('.imageType:visible input',form).get().map(function(c){return{Type:$(c).parents('.imageType').attr('data-imagetype'),Limit:c.checked?1:0,MinWidth:0};});config.ImageOptions.push({Type:'Backdrop',Limit:$('#txtMaxBackdrops',form).val(),MinWidth:$('#txtMinBackdropDownloadWidth',form).val()});config.ImageOptions.push({Type:'Screenshot',Limit:$('#txtMaxScreenshots',form).val(),MinWidth:$('#txtMinScreenshotDownloadWidth',form).val()});}
function onSubmit(){var form=this;Dashboard.showLoadingMsg();ApiClient.getServerConfiguration().done(function(config){var type=currentType;var metadataOptions=config.MetadataOptions.filter(function(c){return c.ItemType==type;})[0];if(metadataOptions){saveSettingsIntoConfig(form,metadataOptions);ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);}else{ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).done(function(defaultOptions){defaultOptions.ItemType=type;config.MetadataOptions.push(defaultOptions);saveSettingsIntoConfig(form,defaultOptions);ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});}});return false;}
$(document).on('pageinit',"#metadataImagesConfigurationPage",function(){var page=this;$('.metadataReaders',page).on('click','.btnLocalReaderMove',function(){var li=$(this).parents('.localReaderOption');var ul=li.parents('ul');if($(this).hasClass('btnLocalReaderDown')){var next=li.next();li.remove().insertAfter(next);}else{var prev=li.prev();li.remove().insertBefore(prev);}
$('.localReaderOption',ul).each(function(){if($(this).prev('.localReaderOption').length){$('.btnLocalReaderMove',this).addClass('btnLocalReaderUp').removeClass('btnLocalReaderDown').attr('data-icon','arrow-u').removeClass('ui-icon-arrow-d').addClass('ui-icon-arrow-u');}else{$('.btnLocalReaderMove',this).addClass('btnLocalReaderDown').removeClass('btnLocalReaderUp').attr('data-icon','arrow-d').removeClass('ui-icon-arrow-u').addClass('ui-icon-arrow-d');}});ul.listview('destroy').listview({});});$('#selectItemType',page).on('change',function(){loadType(page,this.value);});}).on('pageshow',"#metadataImagesConfigurationPage",function(){Dashboard.showLoadingMsg();var page=this;loadPage(page);});window.MetadataImagesPage={onSubmit:onSubmit};})(jQuery,document,window);(function($,document,window){function loadPage(page,config,languages){$('#chkSubtitlesMovies',page).checked(config.DownloadMovieSubtitles).checkboxradio("refresh");$('#chkSubtitlesEpisodes',page).checked(config.DownloadEpisodeSubtitles).checkboxradio("refresh");$('#chkSkipIfGraphicalSubsPresent',page).checked(config.SkipIfGraphicalSubtitlesPresent).checkboxradio("refresh");$('#chkSkipIfAudioTrackPresent',page).checked(config.SkipIfAudioTrackMatches).checkboxradio("refresh");$('#txtOpenSubtitleUsername',page).val(config.OpenSubtitlesUsername);$('#txtOpenSubtitlePassword',page).val('');populateLanguages(page,config,languages);Dashboard.hideLoadingMsg();}
function populateLanguages(page,config,languages){var html='<div data-role="controlgroup" style="margin:0;">';for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];var id="chkSubtitleLanguage"+i;html+='<label style="font-size:13px;" for="'+id+'">'+culture.DisplayName+'</label>';html+='<input class="chkLang" data-lang="'+culture.ThreeLetterISOLanguageName.toLowerCase()+'" type="checkbox" id="'+id+'" />';}
html+='</div>';$('.downloadLanguages',page).html(html).trigger("create");var langs=config.DownloadLanguages||[];$('.chkLang',page).each(function(){this.checked=langs.indexOf(this.getAttribute('data-lang'))!=-1;}).checkboxradio('refresh');}
$(document).on('pageshow',"#metadataSubtitlesPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getNamedConfiguration("subtitles");var promise2=ApiClient.getCultures();$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});});function metadataSubtitlesPage(){var self=this;self.onSubmit=function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("subtitles").done(function(config){config.DownloadMovieSubtitles=$('#chkSubtitlesMovies',form).checked();config.DownloadEpisodeSubtitles=$('#chkSubtitlesEpisodes',form).checked();config.SkipIfGraphicalSubtitlesPresent=$('#chkSkipIfGraphicalSubsPresent',form).checked();config.SkipIfAudioTrackMatches=$('#chkSkipIfAudioTrackPresent',form).checked();config.OpenSubtitlesUsername=$('#txtOpenSubtitleUsername',form).val();var newPassword=$('#txtOpenSubtitlePassword',form).val();if(newPassword){config.OpenSubtitlesPasswordHash=newPassword;}
config.DownloadLanguages=$('.chkLang:checked',form).get().map(function(c){return c.getAttribute('data-lang');});ApiClient.updateNamedConfiguration("subtitles",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;};}
window.MetadataSubtitlesPage=new metadataSubtitlesPage();})(jQuery,document,window);(function($,document,window){var metadataKey="xbmcmetadata";function loadPage(page,config,users){var html='<option value="" selected="selected"></option>';html+=users.map(function(user){return'<option value="'+user.Id+'">'+user.Name+'</option>';}).join('');$('#selectUser',page).html(html).val(config.UserId||'').selectmenu('refresh');$('#selectReleaseDateFormat',page).val(config.ReleaseDateFormat).selectmenu('refresh');$('#chkSaveImagePaths',page).checked(config.SaveImagePathsInNfo).checkboxradio('refresh');$('#chkEnablePathSubstitution',page).checked(config.EnablePathSubstitution).checkboxradio('refresh');$('#chkEnableExtraThumbs',page).checked(config.EnableExtraThumbsDuplication).checkboxradio('refresh');Dashboard.hideLoadingMsg();}
$(document).on('pageshow',"#metadataNfoPage",function(){Dashboard.showLoadingMsg();var page=this;var promise1=ApiClient.getUsers();var promise2=ApiClient.getNamedConfiguration(metadataKey);$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response2[0],response1[0]);});});window.NfoMetadataPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration(metadataKey).done(function(config){config.UserId=$('#selectUser',form).val()||null;config.ReleaseDateFormat=$('#selectReleaseDateFormat',form).val();config.SaveImagePathsInNfo=$('#chkSaveImagePaths',form).checked();config.EnablePathSubstitution=$('#chkEnablePathSubstitution',form).checked();config.EnableExtraThumbsDuplication=$('#chkEnableExtraThumbs',form).checked();ApiClient.updateNamedConfiguration(metadataKey,config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Thumb','Thumb');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:true,Fields:"DateCreated,SyncInfo,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'moviegenres'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getGenres(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'movies',showItemCounts:true,centerText:true,lazy:true});}
else if(view=="ThumbCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'movies',showItemCounts:true,cardLayout:true,showTitle:true,lazy:true});}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',centerText:true,showItemCounts:true,lazy:true});}
$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');$('#selectView',page).val(view).selectmenu('refresh');}
$(document).on('pageinit',"#movieGenresPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});}).on('pagebeforeshow',"#movieGenresPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#movieGenresPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"BoxSet",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo,CanDelete",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'collections'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();var promise1=ApiClient.getItems(Dashboard.getCurrentUserId(),query);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var result=response1[0];var user=response2[0];$(document).scrollTop(0);var html='';var addiontalButtonsHtml=user.Policy.IsAdministrator?('<button class="btnNewCollection" data-mini="true" data-icon="plus" data-inline="true" data-iconpos="notext">'+Globalize.translate('ButtonNew')+'</button>'):'';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,additionalButtonsHtml:addiontalButtonsHtml})).trigger('create');updateFilterControls(page);var trigger=false;if(result.TotalRecordCount){if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'movies',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:'movies',showTitle:true,centerText:true,lazy:true});}
else if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",context:'movies',showTitle:true,centerText:true,lazy:true,preferThumb:true});}
$('.noItemsMessage',page).hide();}else{$('.noItemsMessage',page).show();}
$('.itemsContainer',page).html(html).lazyChildren();if(trigger){$('.itemsContainer',page).trigger('create');}
$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#boxsetsPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#chkTrailer',this).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',this).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;reloadItems(page);});$('#chkThemeVideo',this).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#boxsetsPage",function(){var page=this;var context=getParameterByName('context');if(context=='movies'){$('.collectionTabs',page).hide();$('.movieTabs',page).show();query.ParentId=null;}else{$('.collectionTabs',page).show();$('.movieTabs',page).hide();query.ParentId=LibraryMenu.getTopParentId();}
var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#boxsetsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function getNewCollectionPanel(createIfNeeded){var panel=$('.newCollectionPanel');if(createIfNeeded&&!panel.length){var html='';html+='<div>';html+='<div data-role="panel" class="newCollectionPanel" data-position="right" data-display="overlay" data-position-fixed="true" data-theme="a">';html+='<form class="newCollectionForm">';html+='<h3>'+Globalize.translate('HeaderAddToCollection')+'</h3>';html+='<div class="fldSelectCollection">';html+='<br />';html+='<label for="selectCollectionToAddTo">'+Globalize.translate('LabelSelectCollection')+'</label>';html+='<select id="selectCollectionToAddTo" data-mini="true"></select>';html+='</div>';html+='<div class="newCollectionInfo">';html+='<br />';html+='<div>';html+='<label for="txtNewCollectionName">'+Globalize.translate('LabelName')+'</label>';html+='<input type="text" id="txtNewCollectionName" required="required" />';html+='<div class="fieldDescription">'+Globalize.translate('NewCollectionNameExample')+'</div>';html+='</div>';html+='<br />';html+='<div>';html+='<label for="chkEnableInternetMetadata">'+Globalize.translate('OptionSearchForInternetMetadata')+'</label>';html+='<input type="checkbox" id="chkEnableInternetMetadata" data-mini="true" />';html+='</div>';html+='</div>';html+='<br />';html+='<p>';html+='<input class="fldSelectedItemIds" type="hidden" />';html+='<button type="submit" data-icon="plus" data-mini="true" data-theme="b">'+Globalize.translate('ButtonSubmit')+'</button>';html+='</p>';html+='</form>';html+='</div>';html+='</div>';panel=$(html).appendTo(document.body).trigger('create').find('.newCollectionPanel');$('#selectCollectionToAddTo',panel).on('change',function(){if(this.value){$('.newCollectionInfo',panel).hide();$('#txtNewCollectionName',panel).removeAttr('required');}else{$('.newCollectionInfo',panel).show();$('#txtNewCollectionName',panel).attr('required','required');}});$('.newCollectionForm',panel).off('submit',BoxSetEditor.onNewCollectionSubmit).on('submit',BoxSetEditor.onNewCollectionSubmit);}
return panel;}
function showCollectionPanel(items){var panel=getNewCollectionPanel(true).panel('toggle');$('.fldSelectedItemIds',panel).val(items.join(','));if(items.length){$('.fldSelectCollection',panel).show();populateCollections(panel);}else{$('.fldSelectCollection',panel).hide();$('#selectCollectionToAddTo',panel).html('').val('').selectmenu('refresh').trigger('change');}}
function populateCollections(panel){var select=$('#selectCollectionToAddTo',panel);$('.newCollectionInfo',panel).hide();var options={Recursive:true,IncludeItemTypes:"BoxSet"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var html='';html+='<option value="">'+Globalize.translate('OptionNewCollection')+'</option>';html+=result.Items.map(function(i){return'<option value="'+i.Id+'">'+i.Name+'</option>';});select.html(html).val('').selectmenu('refresh').trigger('change');});}
$(document).on('pageinit',".collectionEditorPage",function(){var page=this;$(page).on('click','.btnNewCollection',function(){showCollectionPanel([]);});});function redirectToCollection(id){var context=getParameterByName('context');ApiClient.getItem(Dashboard.getCurrentUserId(),id).done(function(item){Dashboard.navigate(LibraryBrowser.getHref(item,context));});}
function createCollection(panel){var url=ApiClient.getUrl("Collections",{Name:$('#txtNewCollectionName',panel).val(),IsLocked:!$('#chkEnableInternetMetadata',panel).checked(),Ids:$('.fldSelectedItemIds',panel).val()||''});ApiClient.ajax({type:"POST",url:url,dataType:"json"}).done(function(result){Dashboard.hideLoadingMsg();var id=result.Id;panel.panel('toggle');redirectToCollection(id);});}
function addToCollection(panel,id){var url=ApiClient.getUrl("Collections/"+id+"/Items",{Ids:$('.fldSelectedItemIds',panel).val()||''});ApiClient.ajax({type:"POST",url:url}).done(function(){Dashboard.hideLoadingMsg();panel.panel('toggle');Dashboard.alert(Globalize.translate('MessageItemsAdded'));});}
window.BoxSetEditor={showPanel:function(items){showCollectionPanel(items);},onNewCollectionSubmit:function(){Dashboard.showLoadingMsg();var panel=getNewCollectionPanel(false);var collectionId=$('#selectCollectionToAddTo',panel).val();if(collectionId){addToCollection(panel,collectionId);}else{createCollection(panel);}
return false;},supportsAddingToCollection:function(item){var invalidTypes=['Person','Genre','MusicGenre','Studio','GameGenre','BoxSet','Playlist','UserView','CollectionFolder','Audio','Episode'];return item.LocationType=='FileSystem'&&!item.CollectionType&&invalidTypes.indexOf(item.Type)==-1&&item.MediaType!='Photo';}};})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,MediaSourceCount,IsUnidentified,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'movies'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();var userId=Dashboard.getCurrentUserId();ApiClient.getItems(userId,query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var trigger=false;if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'movies',lazy:true,overlayText:true,showTitle:false});}
else if(view=="ThumbCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'movies',lazy:true,showTitle:true,cardLayout:true,showYear:true});}
else if(view=="Banner"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"banner",preferBanner:true,context:'movies',lazy:true});}
else if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'movies',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',showTitle:false,centerText:true,lazy:true,overlayText:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',showTitle:true,showYear:true,lazy:true,cardLayout:true});}
else if(view=="Timeline"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',showTitle:true,timeline:true,centerText:true,lazy:true});}
var elem=$('.itemsContainer',page).html(html).lazyChildren();if(trigger){$(elem).trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.chkVideoTypeFilter',page).each(function(){var filters=","+(query.VideoTypes||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#chk3D',page).checked(query.Is3D==true).checkboxradio('refresh');$('#chkHD',page).checked(query.IsHD==true).checkboxradio('refresh');$('#chkSD',page).checked(query.IsHD==false).checkboxradio('refresh');$('#chkSubtitle',page).checked(query.HasSubtitles==true).checkboxradio('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkSpecialFeature',page).checked(query.HasSpecialFeature==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#moviesPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('.chkVideoTypeFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.VideoTypes||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.VideoTypes=filters;reloadItems(page);});$('#chk3D',this).on('change',function(){query.StartIndex=0;query.Is3D=this.checked?true:null;reloadItems(page);});$('#chkHD',this).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?true:null;reloadItems(page);});$('#chkSD',this).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?false:null;reloadItems(page);});$('#chkSubtitle',this).on('change',function(){query.StartIndex=0;query.HasSubtitles=this.checked?true:null;reloadItems(page);});$('#chkTrailer',this).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;reloadItems(page);});$('#chkSpecialFeature',this).on('change',function(){query.StartIndex=0;query.HasSpecialFeature=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',this).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;reloadItems(page);});$('#chkThemeVideo',this).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#radioBasicFilters',this).on('change',function(){if(this.checked){$('.basicFilters',page).show();$('.advancedFilters',page).hide();}else{$('.basicFilters',page).hide();}});$('#radioAdvancedFilters',this).on('change',function(){if(this.checked){$('.advancedFilters',page).show();$('.basicFilters',page).hide();}else{$('.advancedFilters',page).hide();}});$('.itemsContainer',page).on('needsrefresh',function(){reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#moviesPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#moviesPage",function(){var page=this;updateFilterControls(page);filtersLoaded=false;});})(jQuery,document);(function(window){function renderOptions(page,selector,cssClass,items){var elem;if(items.length){elem=$(selector,page).show();}else{elem=$(selector,page).hide();}
var html='';html+='<div data-role="controlgroup">';var index=0;var idPrefix='chk'+selector.substring(1);html+=items.map(function(filter){var itemHtml='';var id=idPrefix+index;itemHtml+='<label for="'+id+'">'+filter+'</label>';itemHtml+='<input id="'+id+'" type="checkbox" data-filter="'+filter+'" data-mini="true" class="'+cssClass+'" />';index++;return itemHtml;}).join('');html+='</div>';$('.filterOptions',elem).html(html).trigger('create');}
function renderFilters(page,result){if(result.Tags){result.Tags.length=Math.min(result.Tags.length,50);}
renderOptions(page,'.genreFilters','chkGenreFilter',result.Genres);renderOptions(page,'.officialRatingFilters','chkOfficialRatingFilter',result.OfficialRatings);renderOptions(page,'.tagFilters','chkTagFilter',result.Tags);renderOptions(page,'.yearFilters','chkYearFilter',result.Years);}
function onFiltersLoaded(page,query,reloadItemsFn){$('.chkGenreFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Genres||"";var delimiter='|';filters=(delimiter+filters).replace(delimiter+filterName,'').substring(1);if(this.checked){filters=filters?(filters+delimiter+filterName):filterName;}
query.StartIndex=0;query.Genres=filters;reloadItemsFn();});$('.chkTagFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Tags||"";var delimiter='|';filters=(delimiter+filters).replace(delimiter+filterName,'').substring(1);if(this.checked){filters=filters?(filters+delimiter+filterName):filterName;}
query.StartIndex=0;query.Tags=filters;reloadItemsFn();});$('.chkYearFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Years||"";var delimiter=',';filters=(delimiter+filters).replace(delimiter+filterName,'').substring(1);if(this.checked){filters=filters?(filters+delimiter+filterName):filterName;}
query.StartIndex=0;query.Years=filters;reloadItemsFn();});$('.chkOfficialRatingFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.OfficialRatings||"";var delimiter='|';filters=(delimiter+filters).replace(delimiter+filterName,'').substring(1);if(this.checked){filters=filters?(filters+delimiter+filterName):filterName;}
query.StartIndex=0;query.OfficialRatings=filters;reloadItemsFn();});}
function loadFilters(page,userId,itemQuery,reloadItemsFn){return ApiClient.getJSON(ApiClient.getUrl('Items/Filters',{UserId:userId,ParentId:itemQuery.ParentId,IncludeItemTypes:itemQuery.IncludeItemTypes})).done(function(result){renderFilters(page,result);onFiltersLoaded(page,itemQuery,reloadItemsFn);});}
function onPageShow(page,query){query.Genres=null;query.Years=null;query.OfficialRatings=null;query.Tags=null;}
window.QueryFilters={loadFilters:loadFilters,onPageShow:onPageShow};})(window);(function($,document){var pageSizeKey='people';var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie,Trailer",Recursive:true,Fields:"DateCreated,ItemCounts",PersonTypes:"",StartIndex:0,Limit:100};function getSavedQueryKey(){return'moviepeople'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getPeople(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,updatePageSizeSetting:false,pageSizeKey:pageSizeKey});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies',showTitle:true,showItemCounts:true,coverImage:true,lazy:true});var elem=$('#items',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkPersonTypeFilter',page).each(function(){var filters=","+(query.PersonTypes||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);}
$(document).on('pageinit',"#moviePeoplePage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.chkPersonTypeFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.PersonTypes||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.PersonTypes=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});}).on('pagebeforeshow',"#moviePeoplePage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize(pageSizeKey,100);if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#moviePeoplePage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function loadLatest(page,userId,parentId){var options={IncludeItemTypes:"Movie",Limit:18,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options)).done(function(items){$('#recentlyAddedItems',page).html(LibraryBrowser.getPosterViewHtml({items:items,lazy:true,shape:'portrait',overlayText:false})).lazyChildren().trigger('create');});}
function getRecommendationHtml(recommendation){var html='';var title='';switch(recommendation.RecommendationType){case'SimilarToRecentlyPlayed':title=Globalize.translate('RecommendationBecauseYouWatched').replace("{0}",recommendation.BaselineItemName);break;case'SimilarToLikedItem':title=Globalize.translate('RecommendationBecauseYouLike').replace("{0}",recommendation.BaselineItemName);break;case'HasDirectorFromRecentlyPlayed':case'HasLikedDirector':title=Globalize.translate('RecommendationDirectedBy').replace("{0}",recommendation.BaselineItemName);break;case'HasActorFromRecentlyPlayed':case'HasLikedActor':title=Globalize.translate('RecommendationStarring').replace("{0}",recommendation.BaselineItemName);break;}
html+='<h1 class="listHeader">'+title+'</h1>';html+='<div>';html+=LibraryBrowser.getPosterViewHtml({items:recommendation.Items,lazy:true,shape:'portrait',overlayText:true});html+='</div>';return html;}
$(document).on('pageinit',"#moviesRecommendedPage",function(){var page=this;$('.recommendations',page).createCardMenus();}).on('pagebeforeshow',"#moviesRecommendedPage",function(){var parentId=LibraryMenu.getTopParentId();var screenWidth=$(window).width();var page=this;var userId=Dashboard.getCurrentUserId();var options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:screenWidth>=1920?6:(screenWidth>=1600?4:3),Recursive:true,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",CollapseBoxSetItems:false,ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(userId,options).done(function(result){if(result.Items.length){$('#resumableSection',page).show();}else{$('#resumableSection',page).hide();}
$('#resumableItems',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,preferThumb:true,shape:'backdrop',overlayText:true,showTitle:true,lazy:true})).lazyChildren().trigger('create');});loadLatest(page,userId,parentId);var url=ApiClient.getUrl("Movies/Recommendations",{userId:userId,categoryLimit:screenWidth>=1200?4:3,ItemLimit:screenWidth>=1920?9:(screenWidth>=1600?8:(screenWidth>=1200?7:6)),Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(url).done(function(recommendations){if(!recommendations.length){$('.noItemsMessage',page).show();$('.recommendations',page).html('');return;}
var html=recommendations.map(getRecommendationHtml).join('');$('.noItemsMessage',page).hide();$('.recommendations',page).html(html).lazyChildren();});});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:true,Fields:"DateCreated,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'moviestudios'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getStudios(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'movies',showItemCounts:true,centerText:true,lazy:true});var elem=$('#items',page).html(html).lazyChildren().trigger('create');$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#movieStudiosPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#movieStudiosPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#movieStudiosPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SortName",SortOrder:"Ascending",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'trailers'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();query.UserId=Dashboard.getCurrentUserId();ApiClient.getJSON(ApiClient.getUrl('Trailers',query)).done(function(result){$(document).scrollTop(0);if(result.Items.length){$('.noItemsMessage',page).hide();}
else{$('.noItemsMessage',page).show();}
var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'movies-trailers',showTitle:false,centerText:true,lazy:true,overlayText:false});var elem=$('.itemsContainer',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.getCurrentUser().done(function(user){if(user.Policy.EnableMediaPlayback&&result.Items.length){$('.btnTrailerReel',page).show();}else{$('.btnTrailerReel',page).hide();}});Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
function playReel(page){$('.popupTrailerReel',page).popup('close');var reelQuery={UserId:Dashboard.getCurrentUserId(),SortBy:'Random',Limit:50,Fields:"MediaSources,Chapters"};if($('#chkUnwatchedOnly',page).checked()){reelQuery.Filters="IsPlayed";}
ApiClient.getJSON(ApiClient.getUrl('Trailers',reelQuery)).done(function(result){MediaController.play({items:result.Items});});}
$(document).on('pageinit',"#movieTrailersPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('.itemsContainer',page).on('needsrefresh',function(){reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('.btnTrailerReel',page).on('click',function(){$('.popupTrailerReel',page).popup('open');});}).on('pagebeforeshow',"#movieTrailersPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#movieTrailersPage",function(){updateFilterControls(this);});window.MovieTrailerPage={onSubmit:function(){var page=$(this).parents('.page');playReel(page);return false;}};})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('PosterCard','PosterCard');var query={SortBy:"AlbumArtist,SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicAlbum",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'musicalbums'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var trigger=false;if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,showParentTitle:true,lazy:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,coverImage:true,showParentTitle:true,lazy:true,cardLayout:true});}
else if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'music',sortBy:query.SortBy});trigger=true;}
else if(view=="Timeline"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,showParentTitle:true,timeline:true,lazy:true});}
var elem=$('#items',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectView',page).val(view).selectmenu('refresh');$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWith);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#musicAlbumsPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',page).on('click',function(){query.SortBy=this.getAttribute('data-sortby');query.StartIndex=0;$('.alphabetPicker',page).alphaClear();query.NameStartsWithOrGreater='';query.AlbumArtistStartsWithOrGreater='';reloadItems(page);});$('.radioSortOrder',page).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');query.StartIndex=0;$('.alphabetPicker',page).alphaClear();query.NameStartsWithOrGreater='';query.AlbumArtistStartsWithOrGreater='';reloadItems(page);});$('.chkStandardFilter',page).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectView',page).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('.alphabetPicker',page).on('alphaselect',function(e,character){if(query.SortBy.indexOf('AlbumArtist')==-1){query.NameStartsWithOrGreater=character;query.AlbumArtistStartsWithOrGreater='';}else{query.AlbumArtistStartsWithOrGreater=character;query.NameStartsWithOrGreater='';}
query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';query.AlbumArtistStartsWithOrGreater='';reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#musicAlbumsPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewKey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewKey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewKey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#musicAlbumsPage",function(){updateFilterControls(this);var updateScheduled=false;function onscreen(){var viewportBottom=$(window).scrollTop()+$(window).height();return($(document).height()-viewportBottom)<100;}
$(window).on('scroll',function(){console.log('load');if(!updateScheduled){setTimeout(function(){if(onscreen()){console.log('load');}
updateScheduled=false;},500);updateScheduled=true;}});});})(jQuery,document);(function($,document){var pageSizeKey='people';var view=LibraryBrowser.getDefaultItemsView('PosterCard','PosterCard');var query={SortBy:"SortName",SortOrder:"Ascending",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,DateCreated,SyncInfo,ItemCounts",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'musicartists'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getAlbumArtists(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true,pageSizeKey:pageSizeKey});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var trigger=false;if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'music',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,coverImage:true,centerText:true,lazy:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,coverImage:true,lazy:true,cardLayout:true,showSongCount:true});}
var elem=$('#items',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#musicAlbumArtistsPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#musicAlbumArtistsPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize(pageSizeKey,100);if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#musicAlbumArtistsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var pageSizeKey='people';var view=LibraryBrowser.getDefaultItemsView('PosterCard','PosterCard');var query={SortBy:"SortName",SortOrder:"Ascending",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,DateCreated,SyncInfo,ItemCounts",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'musicartists'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getArtists(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true,pageSizeKey:pageSizeKey});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var trigger=false;if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'music',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,coverImage:true,centerText:true,lazy:true});}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,coverImage:true,lazy:true,cardLayout:true,showSongCount:true});}
var elem=$('.itemsContainer',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#musicArtistsPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#musicArtistsPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize(pageSizeKey,100);if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#musicArtistsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Audio,MusicVideo",Recursive:true,Fields:"DateCreated,SyncInfo,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'musicgenres'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getMusicGenres(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true})).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'music',showItemCounts:true,centerText:true,lazy:true});$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#musicGenresPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#musicGenresPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#musicGenresPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function itemsPerRow(){var screenWidth=$(window).width();return screenWidth>=1920?9:(screenWidth>=1200?12:(screenWidth>=1000?10:8));}
function loadLatest(page,parentId){var userId=Dashboard.getCurrentUserId();var options={IncludeItemTypes:"Audio",Limit:itemsPerRow(),Fields:"PrimaryImageAspectRatio,SyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options)).done(function(items){$('#recentlyAddedSongs',page).html(LibraryBrowser.getPosterViewHtml({items:items,showUnplayedIndicator:false,showChildCountIndicator:true,shape:"square",showTitle:true,showParentTitle:true,lazy:true,cardLayout:true})).lazyChildren();});}
function loadRecentlyPlayed(page,parentId){var options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:true,Fields:"PrimaryImageAspectRatio,AudioInfo,SyncInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){if(result.Items.length){$('#recentlyPlayed',page).show();}else{$('#recentlyPlayed',page).hide();}
$('#recentlyPlayedSongs',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,showUnplayedIndicator:false,shape:"square",showTitle:true,showParentTitle:true,defaultAction:'play',lazy:true,cardLayout:true})).lazyChildren();});}
function loadFrequentlyPlayed(page,parentId){var options={SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:true,Fields:"PrimaryImageAspectRatio,AudioInfo,SyncInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){if(result.Items.length){$('#topPlayed',page).show();}else{$('#topPlayed',page).hide();}
$('#topPlayedSongs',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,showUnplayedIndicator:false,shape:"square",showTitle:true,showParentTitle:true,defaultAction:'play',lazy:true,cardLayout:true})).lazyChildren();});}
function loadPlaylists(page,parentId){var options={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist",Recursive:true,ParentId:parentId,Fields:"PrimaryImageAspectRatio,SortName,CumulativeRunTimeTicks,CanDelete,SyncInfo",StartIndex:0,Limit:itemsPerRow()};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){var elem;if(result.Items.length){elem=$('#playlists',page).show();}else{elem=$('#playlists',page).hide();}
$('.itemsContainer',elem).html(LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",showTitle:true,lazy:true,defaultAction:'play',coverImage:true,showItemCounts:true,cardLayout:true})).lazyChildren();});}
$(document).on('pagebeforeshow',"#musicRecommendedPage",function(){var parentId=LibraryMenu.getTopParentId();var page=this;loadLatest(page,parentId);loadPlaylists(page,parentId);loadRecentlyPlayed(page,parentId);loadFrequentlyPlayed(page,parentId);});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:true,Fields:"DateCreated,SyncInfo",StartIndex:0};function getSavedQueryKey(){return'musicvideos'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'music',showTitle:true,centerText:true});$('#items',page).html(html).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#musicVideosPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#musicVideosPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);QueryFilters.onPageShow(page,query);reloadItems(page);}).on('pageshow',"#musicVideosPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,window,document){function renderViews(page,user,result){var folderHtml='';folderHtml+='<div data-role="controlgroup">';folderHtml+=result.Items.map(function(i){var currentHtml='';var id='chkGroupFolder'+i.Id;currentHtml+='<label for="'+id+'">'+i.Name+'</label>';var isChecked=user.Configuration.ExcludeFoldersFromGrouping.indexOf(i.Id)==-1;var checkedHtml=isChecked?' checked="checked"':'';currentHtml+='<input class="chkGroupFolder" data-folderid="'+i.Id+'" type="checkbox" id="'+id+'"'+checkedHtml+' />';return currentHtml;}).join('');folderHtml+='</div>';$('.folderGroupList',page).html(folderHtml).trigger('create');}
function renderViewStyles(page,user,result){var folderHtml='';folderHtml+='<div data-role="controlgroup">';folderHtml+=result.map(function(i){var currentHtml='';var id='chkPlainFolder'+i.Id;currentHtml+='<label for="'+id+'">'+i.Name+'</label>';var isChecked=user.Configuration.PlainFolderViews.indexOf(i.Id)==-1;var checkedHtml=isChecked?' checked="checked"':'';currentHtml+='<input class="chkPlainFolder" data-folderid="'+i.Id+'" type="checkbox" id="'+id+'"'+checkedHtml+' />';return currentHtml;}).join('');folderHtml+='</div>';$('.viewStylesList',page).html(folderHtml).trigger('create');if(result.length){$('.viewStylesSection',page).show();}else{$('.viewStylesSection',page).hide();}}
function renderLatestItems(page,user,result){var folderHtml='';folderHtml+='<div data-role="controlgroup">';folderHtml+=result.Items.map(function(i){var currentHtml='';var id='chkIncludeInLatest'+i.Id;currentHtml+='<label for="'+id+'">'+i.Name+'</label>';var isChecked=user.Configuration.LatestItemsExcludes.indexOf(i.Id)==-1;var checkedHtml=isChecked?' checked="checked"':'';currentHtml+='<input class="chkIncludeInLatest" data-folderid="'+i.Id+'" type="checkbox" id="'+id+'"'+checkedHtml+' />';return currentHtml;}).join('');folderHtml+='</div>';$('.latestItemsList',page).html(folderHtml).trigger('create');}
function renderChannels(page,user,result){var folderHtml='';folderHtml+='<div data-role="controlgroup">';folderHtml+=result.Items.map(function(i){var currentHtml='';var id='chkGroupChannel'+i.Id;currentHtml+='<label for="'+id+'">'+i.Name+'</label>';var isChecked=user.Configuration.DisplayChannelsWithinViews.indexOf(i.Id)!=-1;var checkedHtml=isChecked?' checked="checked"':'';currentHtml+='<input class="chkGroupChannel" data-channelid="'+i.Id+'" type="checkbox" id="'+id+'"'+checkedHtml+' />';return currentHtml;}).join('');folderHtml+='</div>';$('.channelGroupList',page).html(folderHtml).trigger('create');}
function renderViewOrder(page,user,result){var html='';html+='<ul data-role="listview" data-inset="true" data-mini="true">';var index=0;html+=result.Items.map(function(view){var currentHtml='';currentHtml+='<li data-mini="true" class="viewItem" data-viewid="'+view.Id+'">';if(index>0){currentHtml+='<a href="#">'+view.Name+'</a>';currentHtml+='<a class="btnViewItemUp btnViewItemMove" href="#" data-icon="arrow-u">'+Globalize.translate('ButtonUp')+'</a>';}
else if(result.Items.length>1){currentHtml+='<a href="#">'+view.Name+'</a>';currentHtml+='<a class="btnViewItemDown btnViewItemMove" href="#" data-icon="arrow-d">'+Globalize.translate('ButtonDown')+'</a>';}
else{currentHtml+=view.Name;}
html+='</li>';index++;return currentHtml;}).join('');html+='</ul>';$('.viewOrderList',page).html(html).trigger('create');}
function loadForm(page,user,hideMsg){$('#chkDisplayMissingEpisodes',page).checked(user.Configuration.DisplayMissingEpisodes||false).checkboxradio("refresh");$('#chkDisplayUnairedEpisodes',page).checked(user.Configuration.DisplayUnairedEpisodes||false).checkboxradio("refresh");$('#chkDisplayTrailersWithinMovieSuggestions',page).checked(user.Configuration.IncludeTrailersInSuggestions||false).checkboxradio("refresh");$('#chkGroupMoviesIntoCollections',page).checked(user.Configuration.GroupMoviesIntoBoxSets||false).checkboxradio("refresh");$('#chkDisplayCollectionView',page).checked(user.Configuration.DisplayCollectionsView||false).checkboxradio("refresh");$('#chkDisplayFolderView',page).checked(user.Configuration.DisplayFoldersView||false).checkboxradio("refresh");$('#chkHidePlayedFromLatest',page).checked(user.Configuration.HidePlayedInLatest||false).checkboxradio("refresh");var promise1=ApiClient.getItems(user.Id,{sortBy:"SortName"});var promise2=ApiClient.getJSON(ApiClient.getUrl("Channels",{UserId:user.Id}));var promise3=ApiClient.getUserViews(user.Id);var promise4=ApiClient.getJSON(ApiClient.getUrl("Users/"+user.Id+"/SpecialViewOptions"));$.when(promise1,promise2,promise3,promise4).done(function(r1,r2,r3,r4){renderViews(page,user,r1[0]);renderLatestItems(page,user,r1[0]);renderChannels(page,user,r2[0]);renderViewOrder(page,user,r3[0]);renderViewStyles(page,user,r4[0]);if(hideMsg!==false){Dashboard.hideLoadingMsg();}});}
function saveUser(page,user){user.Configuration.DisplayMissingEpisodes=$('#chkDisplayMissingEpisodes',page).checked();user.Configuration.DisplayUnairedEpisodes=$('#chkDisplayUnairedEpisodes',page).checked();user.Configuration.GroupMoviesIntoBoxSets=$('#chkGroupMoviesIntoCollections',page).checked();user.Configuration.DisplayCollectionsView=$('#chkDisplayCollectionView',page).checked();user.Configuration.DisplayFoldersView=$('#chkDisplayFolderView',page).checked();user.Configuration.HidePlayedInLatest=$('#chkHidePlayedFromLatest',page).checked();user.Configuration.IncludeTrailersInSuggestions=$('#chkDisplayTrailersWithinMovieSuggestions',page).checked();user.Configuration.LatestItemsExcludes=$(".chkIncludeInLatest:not(:checked)",page).get().map(function(i){return i.getAttribute('data-folderid');});user.Configuration.ExcludeFoldersFromGrouping=$(".chkGroupFolder:not(:checked)",page).get().map(function(i){return i.getAttribute('data-folderid');});user.Configuration.PlainFolderViews=$(".chkPlainFolder:not(:checked)",page).get().map(function(i){return i.getAttribute('data-folderid');});user.Configuration.DisplayChannelsWithinViews=$(".chkGroupChannel:checked",page).get().map(function(i){return i.getAttribute('data-channelid');});user.Configuration.OrderedViews=$(".viewItem",page).get().map(function(i){return i.getAttribute('data-viewid');});ApiClient.updateUserConfiguration(user.Id,user.Configuration).done(function(){Dashboard.alert(Globalize.translate('SettingsSaved'));loadForm(page,user,false);});}
function onSubmit(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();ApiClient.getUser(userId).done(function(user){saveUser(page,user);});return false;}
$(document).on('pageinit',"#displayPreferencesPage",function(){var page=this;$('.viewOrderList',page).on('click','.btnViewItemMove',function(){var li=$(this).parents('.viewItem');var ul=li.parents('ul');if($(this).hasClass('btnViewItemDown')){var next=li.next();li.remove().insertAfter(next);}else{var prev=li.prev();li.remove().insertBefore(prev);}
$('.viewItem',ul).each(function(){if($(this).prev('.viewItem').length){$('.btnViewItemMove',this).addClass('btnViewItemUp').removeClass('btnViewItemDown').attr('data-icon','arrow-u').removeClass('ui-icon-arrow-d').addClass('ui-icon-arrow-u');}else{$('.btnViewItemMove',this).addClass('btnViewItemDown').removeClass('btnViewItemUp').attr('data-icon','arrow-d').removeClass('ui-icon-arrow-u').addClass('ui-icon-arrow-d');}});ul.listview('destroy').listview({});});}).on('pageshow',"#displayPreferencesPage",function(){var page=this;Dashboard.showLoadingMsg();var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();ApiClient.getUser(userId).done(function(user){loadForm(page,user);});}).on('pageshow',".userPreferencesPage",function(){var page=this;var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();$('.lnkDisplayPreferences',page).attr('href','mypreferencesdisplay.html?userId='+userId);$('.lnkLanguagePreferences',page).attr('href','mypreferenceslanguages.html?userId='+userId);$('.lnkWebClientPreferences',page).attr('href','mypreferenceswebclient.html?userId='+userId);$('.lnkMyProfile',page).attr('href','myprofile.html?userId='+userId);});window.DisplayPreferencesPage={onSubmit:onSubmit};})(jQuery,window,document);(function($,window,document){function populateLanguages(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.ThreeLetterISOLanguageName+"'>"+culture.DisplayName+"</option>";}
$(select).html(html).selectmenu("refresh");}
function loadForm(page,user,loggedInUser,allCulturesPromise){allCulturesPromise.done(function(allCultures){populateLanguages($('#selectAudioLanguage',page),allCultures);populateLanguages($('#selectSubtitleLanguage',page),allCultures);$('#selectAudioLanguage',page).val(user.Configuration.AudioLanguagePreference||"").selectmenu("refresh");$('#selectSubtitleLanguage',page).val(user.Configuration.SubtitleLanguagePreference||"").selectmenu("refresh");});$('#selectSubtitlePlaybackMode',page).val(user.Configuration.SubtitleMode||"").selectmenu("refresh").trigger('change');$('#chkPlayDefaultAudioTrack',page).checked(user.Configuration.PlayDefaultAudioTrack||false).checkboxradio("refresh");$('#chkEnableCinemaMode',page).checked(user.Configuration.EnableCinemaMode||false).checkboxradio("refresh");Dashboard.hideLoadingMsg();}
function loadPage(page){Dashboard.showLoadingMsg();var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();var promise1=ApiClient.getUser(userId);var promise2=Dashboard.getCurrentUser();var allCulturesPromise=ApiClient.getCultures();$.when(promise1,promise2).done(function(response1,response2){loadForm(page,response1[0]||response1,response2[0],allCulturesPromise);});ApiClient.getNamedConfiguration("cinemamode").done(function(cinemaConfig){if(cinemaConfig.EnableIntrosForMovies||cinemaConfig.EnableIntrosForEpisodes){$('.cinemaModeOptions',page).show();}else{$('.cinemaModeOptions',page).hide();}});}
function saveUser(page,user){user.Configuration.AudioLanguagePreference=$('#selectAudioLanguage',page).val();user.Configuration.SubtitleLanguagePreference=$('#selectSubtitleLanguage',page).val();user.Configuration.SubtitleMode=$('#selectSubtitlePlaybackMode',page).val();user.Configuration.PlayDefaultAudioTrack=$('#chkPlayDefaultAudioTrack',page).checked();user.Configuration.EnableCinemaMode=$('#chkEnableCinemaMode',page).checked();ApiClient.updateUserConfiguration(user.Id,user.Configuration).done(function(){Dashboard.alert(Globalize.translate('SettingsSaved'));});}
function onSubmit(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();ApiClient.getUser(userId).done(function(result){saveUser(page,result);});return false;}
$(document).on('pageinit',"#languagePreferencesPage",function(){var page=this;$('#selectSubtitlePlaybackMode',page).on('change',function(){$('.subtitlesHelp',page).hide();$('.subtitles'+this.value+'Help',page).show();});}).on('pageshow',"#languagePreferencesPage",function(){var page=this;loadPage(page);});window.LanguagePreferencesPage={onSubmit:onSubmit};})(jQuery,window,document);(function($,window,document){function loadForm(page,userId,displayPreferences){var externalPlayers=JSON.parse(store.getItem('externalplayers')||'[]');$('#selectMaxBitrate',page).val(AppSettings.maxStreamingBitrate()).selectmenu("refresh");$('#selectMaxChromecastBitrate',page).val(AppSettings.maxChromecastBitrate()).selectmenu("refresh");$('.chkExternalPlayer',page).each(function(){var chk=this;chk.checked=externalPlayers.filter(function(p){return p.name==chk.getAttribute('data-name');}).length>0;}).checkboxradio('refresh');$('#selectThemeSong',page).val(store.getItem('enableThemeSongs-'+userId)||'').selectmenu("refresh");$('#selectBackdrop',page).val(store.getItem('enableBackdrops-'+userId)||'').selectmenu("refresh");$('#selectHomeSection1',page).val(displayPreferences.CustomPrefs.home0||'').selectmenu("refresh");$('#selectHomeSection2',page).val(displayPreferences.CustomPrefs.home1||'').selectmenu("refresh");$('#selectHomeSection3',page).val(displayPreferences.CustomPrefs.home2||'').selectmenu("refresh");$('#selectHomeSection4',page).val(displayPreferences.CustomPrefs.home3||'').selectmenu("refresh");$('#chkEnableLibraryTileNames',page).checked(displayPreferences.CustomPrefs.enableLibraryTileNames!='0').checkboxradio("refresh");Dashboard.hideLoadingMsg();}
function saveUser(page,userId,displayPreferences){store.setItem('enableThemeSongs-'+userId,$('#selectThemeSong',page).val());store.setItem('enableBackdrops-'+userId,$('#selectBackdrop',page).val());displayPreferences.CustomPrefs.home0=$('#selectHomeSection1',page).val();displayPreferences.CustomPrefs.home1=$('#selectHomeSection2',page).val();displayPreferences.CustomPrefs.home2=$('#selectHomeSection3',page).val();displayPreferences.CustomPrefs.home3=$('#selectHomeSection4',page).val();displayPreferences.CustomPrefs.enableLibraryTileNames=$('#chkEnableLibraryTileNames',page).checked()?'1':'0';ApiClient.updateDisplayPreferences('home',displayPreferences,userId,'webclient').done(function(){Dashboard.alert(Globalize.translate('SettingsSaved'));});}
function onSubmit(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();var externalPlayers=$('.chkExternalPlayer:checked',page).get().map(function(i){return{name:i.getAttribute('data-name'),scheme:i.getAttribute('data-scheme')};});store.setItem('externalplayers',JSON.stringify(externalPlayers));AppSettings.maxStreamingBitrate($('#selectMaxBitrate',page).val());AppSettings.maxChromecastBitrate($('#selectMaxChromecastBitrate',page).val());var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();ApiClient.getDisplayPreferences('home',userId,'webclient').done(function(result){saveUser(page,userId,result);});return false;}
$(document).on('pageinit',"#webClientPreferencesPage",function(){var page=this;}).on('pagebeforeshow',"#webClientPreferencesPage",function(){var page=this;Dashboard.showLoadingMsg();var userId=getParameterByName('userId')||Dashboard.getCurrentUserId();ApiClient.getDisplayPreferences('home',userId,'webclient').done(function(result){loadForm(page,userId,result);});if($.browser.msie){$('.fldEnableBackdrops',page).hide();}else{$('.fldEnableBackdrops',page).show();}});window.WebClientPreferencesPage={onSubmit:onSubmit};})(jQuery,window,document);(function(window,store){window.AppSettings={maxStreamingBitrate:function(val){if(val!=null){store.setItem('preferredVideoBitrate',val);}
return parseInt(store.getItem('preferredVideoBitrate')||'')||1500000;},maxChromecastBitrate:function(val){if(val!=null){store.setItem('chromecastBitrate',val);}
return parseInt(store.getItem('chromecastBitrate')||'')||3000000;}};})(window,window.store);(function($,document,Dashboard,LibraryBrowser){function notifications(){var self=this;self.getNotificationsSummaryPromise=null;self.total=0;self.getNotificationsSummary=function(){var apiClient=ConnectionManager.currentApiClient();if(!apiClient){return;}
self.getNotificationsSummaryPromise=self.getNotificationsSummaryPromise||apiClient.getNotificationSummary(Dashboard.getCurrentUserId());return self.getNotificationsSummaryPromise;};self.updateNotificationCount=function(){if(!Dashboard.getCurrentUserId()){return;}
var promise=self.getNotificationsSummary();if(!promise){return;}
promise.done(function(summary){var item=$('.btnNotificationsInner').removeClass('levelNormal').removeClass('levelWarning').removeClass('levelError').html(summary.UnreadCount);if(summary.UnreadCount){item.addClass('level'+summary.MaxUnreadNotificationLevel);}});};self.showNotificationsFlyout=function(){var html='<div data-role="panel" data-position="right" data-display="overlay" class="notificationsFlyout" data-position-fixed="true" data-theme="a">';html+='<h1 style="margin: .25em 0;">';html+='<span style="vertical-align:middle;">'+Globalize.translate('HeaderNotifications')+'</span>';html+='<a data-role="button" data-inline="true" data-icon="arrow-r" href="notificationlist.html" data-iconpos="notext" style="vertical-align:middle;margin-left:.5em;">'+Globalize.translate('ButtonViewNotifications')+'</a>';html+='</h1>';html+='<div>';html+='<div class="notificationsFlyoutlist">Loading...';html+='</div>';html+='</div>';html+='</div>';$(document.body).append(html);$('.notificationsFlyout').panel({}).trigger('create').panel("open").on("panelclose",function(){$(this).off("panelclose").remove();});self.isFlyout=true;var startIndex=0;var limit=5;var elem=$('.notificationsFlyoutlist');refreshNotifications(startIndex,limit,elem,null,false).done(function(){self.markNotificationsRead([]);});};self.markNotificationsRead=function(ids,callback){ApiClient.markNotificationsRead(Dashboard.getCurrentUserId(),ids,true).done(function(){self.getNotificationsSummaryPromise=null;self.updateNotificationCount();if(callback){callback();}});};self.showNotificationsList=function(startIndex,limit,elem,btn){refreshNotifications(startIndex,limit,elem,btn,true);};}
function refreshNotifications(startIndex,limit,elem,btn,showPaging){var apiClient=ConnectionManager.currentApiClient();if(apiClient){return apiClient.getNotifications(Dashboard.getCurrentUserId(),{StartIndex:startIndex,Limit:limit}).done(function(result){listUnreadNotifications(result.Notifications,result.TotalRecordCount,startIndex,limit,elem,btn,showPaging);});}}
function listUnreadNotifications(list,totalRecordCount,startIndex,limit,elem,btn,showPaging){if(!totalRecordCount){elem.html('<p style="padding:.5em 1em;">'+Globalize.translate('LabelNoUnreadNotifications')+'</p>');if(btn){btn.hide();}
return;}
Notifications.total=totalRecordCount;if(btn){if(list.filter(function(n){return!n.IsRead;}).length){btn.show();}else{btn.hide();}}
var html='';if(totalRecordCount>limit&&showPaging===true){var query={StartIndex:startIndex,Limit:limit};html+=LibraryBrowser.getPagingHtml(query,totalRecordCount,false,limit,false);}
for(var i=0,length=list.length;i<length;i++){var notification=list[i];html+=getNotificationHtml(notification);}
elem.html(html).trigger('create');}
function getNotificationHtml(notification){var html='';var cssClass=notification.IsRead?"flyoutNotification":"flyoutNotification unreadFlyoutNotification";html+='<div data-notificationid="'+notification.Id+'" class="'+cssClass+'">';html+='<div class="notificationImage">';html+=getImageHtml(notification);html+='</div>';html+='<div class="notificationContent">';html+='<p style="font-size:16px;margin: .5em 0 .5em;" class="notificationName">';if(notification.Url){html+='<a href="'+notification.Url+'" target="_blank" style="text-decoration:none;">'+notification.Name+'</a>';}else{html+=notification.Name;}
html+='</p>';html+='<p class="notificationTime" style="margin: .5em 0;">'+humane_date(notification.Date)+'</p>';if(notification.Description){html+='<p style="margin: .5em 0;max-height:100px;overflow:hidden;text-overflow:ellipsis;">'+notification.Description+'</p>';}
html+='</div>';html+='</div>';return html;}
function getImageHtml(notification){if(notification.Level=="Error"){return'<div class="imgNotification imgNotificationError"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
if(notification.Level=="Warning"){return'<div class="imgNotification imgNotificationWarning"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
return'<div class="imgNotification imgNotificationNormal"><div class="imgNotificationInner imgNotificationIcon"></div></div>';}
window.Notifications=new notifications();$(document).on('headercreated',function(e){if(ConnectionManager.currentApiClient()){$('<a class="headerButton headerButtonRight btnNotifications" href="#" title="Notifications"><div class="btnNotificationsInner">0</div></a>').insertAfter($('.headerSearchButton')).on('click',Notifications.showNotificationsFlyout);Notifications.updateNotificationCount();}});function initializeApiClient(apiClient){$(apiClient).on("websocketmessage",function(e,msg){if(msg.MessageType==="NotificationUpdated"||msg.MessageType==="NotificationAdded"||msg.MessageType==="NotificationsMarkedRead"){Notifications.getNotificationsSummaryPromise=null;Notifications.updateNotificationCount();}});}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});})(jQuery,document,Dashboard,LibraryBrowser);(function($,document,Notifications){$(document).on("pageinit","#notificationsPage",function(){if(!Dashboard.getCurrentUserId())return;var elem=$(".notificationsList");var btn=$(".btnMarkReadContainer");var startIndex=0;var limit=10;Notifications.showNotificationsList(startIndex,limit,elem,btn);elem.on("click",".btnPreviousPage",function(e){e.preventDefault();startIndex=startIndex-limit;if(startIndex<0)startIndex=0;Notifications.showNotificationsList(startIndex,limit,elem,btn);}).on("click",".btnNextPage",function(e){e.preventDefault();startIndex=startIndex+limit;Notifications.showNotificationsList(startIndex,limit,elem,btn);});$(".readOnlyContent").on("click",".btnMarkRead",function(){var ids=$(".notificationsList div").map(function(){return this.getAttribute('data-notificationid');}).get();Notifications.markNotificationsRead(ids,function(){Notifications.showNotificationsList(startIndex,limit,elem,btn);});});});})(jQuery,document,Notifications);(function(){var notificationsConfigurationKey="notifications";function fillItems(elem,items,cssClass,idPrefix,currentList,isEnabledList){var html='<div data-role="controlgroup">';html+=items.map(function(u){var id=idPrefix+u.Id;var isChecked=isEnabledList?currentList.indexOf(u.Id)!=-1:currentList.indexOf(u.Id)==-1;var checkedHtml=isChecked?' checked="checked"':'';return'<label for="'+id+'">'+u.Name+'</label><input class="'+cssClass+'" type="checkbox" data-itemid="'+u.Id+'" id="'+id+'"'+checkedHtml+' />';}).join('');html+='</div>';elem.html(html).trigger('create');}
function reload(page){var type=getParameterByName('type');var promise1=ApiClient.getUsers();var promise2=ApiClient.getNamedConfiguration(notificationsConfigurationKey);var promise3=ApiClient.getJSON(ApiClient.getUrl("Notifications/Types"));var promise4=ApiClient.getJSON(ApiClient.getUrl("Notifications/Services"));$.when(promise1,promise2,promise3,promise4).done(function(response1,response2,response3,response4){var users=response1[0];var notificationOptions=response2[0];var types=response3[0];var services=response4[0];var notificationConfig=notificationOptions.Options.filter(function(n){return n.Type==type;})[0];var typeInfo=types.filter(function(n){return n.Type==type;})[0]||{};if(typeInfo.IsBasedOnUserEvent){$('.monitorUsers',page).show();}else{$('.monitorUsers',page).hide();}
if(typeInfo.Variables.length){$('.tokenHelp',page).show();$('.tokenList',page).html(typeInfo.Variables.map(function(v){return'{'+v+'}';}).join(', '));}else{$('.tokenHelp',page).hide();}
$('.notificationType',page).html(typeInfo.Name||'Unknown Notification');if(!notificationConfig){notificationConfig={DisabledMonitorUsers:[],SendToUsers:[],DisabledServices:[],SendToUserMode:'Admins'};}
fillItems($('.monitorUsersList',page),users,'chkMonitor','chkMonitor',notificationConfig.DisabledMonitorUsers);fillItems($('.sendToUsersList',page),users,'chkSendTo','chkSendTo',notificationConfig.SendToUsers,true);fillItems($('.servicesList',page),services,'chkService','chkService',notificationConfig.DisabledServices);$('#chkEnabled',page).checked(notificationConfig.Enabled||false).checkboxradio('refresh');$('#txtTitle',page).val(notificationConfig.Title||typeInfo.DefaultTitle);$('#selectUsers',page).val(notificationConfig.SendToUserMode).selectmenu('refresh').trigger('change');});}
function save(page){var type=getParameterByName('type');var promise1=ApiClient.getNamedConfiguration(notificationsConfigurationKey);var promise2=ApiClient.getJSON(ApiClient.getUrl("Notifications/Types"));$.when(promise1,promise2).done(function(response1,response2){var notificationOptions=response1[0];var types=response2[0];var notificationConfig=notificationOptions.Options.filter(function(n){return n.Type==type;})[0];if(!notificationConfig){notificationConfig={Type:type};notificationOptions.Options.push(notificationConfig);}
var typeInfo=types.filter(function(n){return n.Type==type;})[0]||{};notificationConfig.Enabled=$('#chkEnabled',page).checked();notificationConfig.Title=$('#txtTitle',page).val();notificationConfig.SendToUserMode=$('#selectUsers',page).val();if(notificationConfig.Title==typeInfo.DefaultTitle){notificationConfig.Title=null;}
notificationConfig.DisabledMonitorUsers=$('.chkMonitor:not(:checked)',page).get().map(function(c){return c.getAttribute('data-itemid');});notificationConfig.SendToUsers=$('.chkSendTo:checked',page).get().map(function(c){return c.getAttribute('data-itemid');});notificationConfig.DisabledServices=$('.chkService:not(:checked)',page).get().map(function(c){return c.getAttribute('data-itemid');});ApiClient.updateNamedConfiguration(notificationsConfigurationKey,notificationOptions).done(function(r){Dashboard.navigate('notificationsettings.html');});});}
$(document).on('pageinit',"#notificationSettingPage",function(){var page=this;$('#selectUsers',page).on('change',function(){if(this.value=='Custom'){$('.selectCustomUsers',page).show();}else{$('.selectCustomUsers',page).hide();}});}).on('pageshow',"#notificationSettingPage",function(){var page=this;reload(page);});window.NotificationSettingPage={onSubmit:function(){var page=$(this).parents('.page');save(page);return false;}};})(jQuery,window);(function(){function reload(page){Dashboard.showLoadingMsg();ApiClient.getJSON(ApiClient.getUrl("Notifications/Types")).done(function(list){var html='<ul data-role="listview" data-inset="true">';var lastCategory="";html+=list.map(function(i){var itemHtml='';if(i.Category!=lastCategory){lastCategory=i.Category;itemHtml+='<li data-role="list-divider">';itemHtml+=i.Category;itemHtml+='</li>';}
itemHtml+='<li>';itemHtml+='<a href="notificationsetting.html?type='+i.Type+'">';itemHtml+='<h3>'+i.Name+'</h3>';if(i.Enabled){itemHtml+='<p style="color:#009F00;">'+Globalize.translate('LabelEnabled')+'</p>';}else{itemHtml+='<p style="color:#cc0000;">'+Globalize.translate('LabelDisabled')+'</p>';}
itemHtml+='</a>';itemHtml+='</li>';return itemHtml;}).join('');html+='</ul>';$('.notificationList',page).html(html).trigger('create');Dashboard.hideLoadingMsg();});}
$(document).on('pageshow',"#notificationSettingsPage",function(){var page=this;reload(page);});})(jQuery,window);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SortName",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary"};function getSavedQueryKey(){return'photos'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:false,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);var defaultAction=query.MediaTypes=='Photo'?'photoslideshow':null;html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"auto",context:getParameterByName('context')||'photos',showTitle:false,centerText:true,lazy:true,defaultAction:defaultAction});var elem=$('#items',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
function setQueryPerContext(page){var context=getParameterByName('context');$('.libraryViewNav a',page).removeClass('ui-btn-active');if(context=='photos-photos'){query.Recursive=true;query.MediaTypes='Photo';$('.lnkPhotos',page).addClass('ui-btn-active');}
else if(context=='photos-videos'){query.Recursive=true;query.MediaTypes='Video';$('.lnkVideos',page).addClass('ui-btn-active');}
else{query.Recursive=false;query.MediaTypes=null;$('.lnkPhotoAlbums',page).addClass('ui-btn-active');}
query.ParentId=getParameterByName('parentId')||LibraryMenu.getTopParentId();}
function startSlideshow(page,index){index+=(query.StartIndex||0);var userId=Dashboard.getCurrentUserId();var localQuery=$.extend({},query);localQuery.StartIndex=0;localQuery.Limit=null;localQuery.MediaTypes="Photo";localQuery.Recursive=true;localQuery.Filters="IsNotFolder";ApiClient.getItems(userId,localQuery).done(function(result){showSlideshow(page,result.Items,index);});}
function showSlideshow(page,items,index){var slideshowItems=items.map(function(item){var imgUrl=ApiClient.getScaledImageUrl(item.Id,{tag:item.ImageTags.Primary,type:'Primary'});return{title:item.Name,href:imgUrl};});index=Math.max(index||0,0);$.swipebox(slideshowItems,{initialIndexOnArray:index,hideBarsDelay:30000});}
$(document).on('pageinit',"#photosPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');query.StartIndex=0;reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');query.StartIndex=0;reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.Filters=filters;query.StartIndex=0;reloadItems(page);});$('#radioBasicFilters',this).on('change',function(){if(this.checked){$('.basicFilters',page).show();$('.advancedFilters',page).hide();}else{$('.basicFilters',page).hide();}});$('#radioAdvancedFilters',this).on('change',function(){if(this.checked){$('.advancedFilters',page).show();$('.basicFilters',page).hide();}else{$('.advancedFilters',page).hide();}});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('.itemsContainer',page).on('photoslideshow',function(e,index){startSlideshow(page,index);});}).on('pagebeforeshow',"#photosPage",function(){var page=this;setQueryPerContext(page);var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewKey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewKey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewKey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#photosPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('PosterCard','PosterCard');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,CumulativeRunTimeTicks,CanDelete,SyncInfo",StartIndex:0};function getSavedQueryKey(){return'playlists2'+(query.ParentId||'');}
function showLoadingMessage(page){$('.popupLoading',page).popup('open');}
function hideLoadingMessage(page){$('.popupLoading',page).popup('close');}
function reloadItems(page){showLoadingMessage(page);var promise1=ApiClient.getItems(Dashboard.getCurrentUserId(),query);var promise2=Dashboard.getCurrentUser();$.when(promise1,promise2).done(function(response1,response2){var result=response1[0];var user=response2[0];$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);var trigger=false;if(result.TotalRecordCount){if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'playlists',sortBy:query.SortBy});trigger=true;}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"square",context:'playlists',showTitle:true,lazy:true,coverImage:true,showItemCounts:true,cardLayout:true});}
$('.noItemsMessage',page).hide();}else{$('.noItemsMessage',page).show();}
$('.itemsContainer',page).html(html).lazyChildren();if(trigger){$('.itemsContainer',page).trigger('create');}
$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);hideLoadingMessage(page);});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#playlistsPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#playlistsPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#playlistsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('List','List');var currentItem;var query={Fields:"PrimaryImageAspectRatio,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'playlists'+(query.ParentId||'');}
function getItemsFunction(itemsQuery){itemsQuery=$.extend({},itemsQuery);itemsQuery.SortBy=null;itemsQuery.SortOrder=null;return function(index,limit,fields){itemsQuery.StartIndex=index;itemsQuery.Limit=limit;itemsQuery.Fields=fields;return ApiClient.getItems(Dashboard.getCurrentUserId(),itemsQuery);};}
var _childrenItemsFunction=null;function reloadItems(page){Dashboard.showLoadingMsg();query.ParentId=getParameterByName('id');query.UserId=Dashboard.getCurrentUserId();var promise1=ApiClient.getJSON(ApiClient.getUrl('Playlists/'+query.ParentId+'/Items',query));var promise2=Dashboard.getCurrentUser();var promise3=ApiClient.getItem(Dashboard.getCurrentUserId(),query.ParentId);$.when(promise1,promise2,promise3).done(function(response1,response2,response3){var result=response1[0];var user=response2[0];var item=response3[0];$('.playlistName',page).html(item.Name);_childrenItemsFunction=getItemsFunction(query);currentItem=item;if(MediaController.canPlay(item)){$('.btnPlay',page).removeClass('hide');}
else{$('.btnPlay',page).addClass('hide');}
if(item.LocalTrailerCount&&item.PlayAccess=='Full'){$('.btnPlayTrailer',page).removeClass('hide');}else{$('.btnPlayTrailer',page).addClass('hide');}
$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);if(result.TotalRecordCount){if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'playlists',sortBy:query.SortBy,showIndex:false,title:item.Name,showRemoveFromPlaylist:true,smallIcon:true,playFromHere:true,defaultAction:'playallfromhere'});}
$('.noItemsMessage',page).hide();}else{$('.noItemsMessage',page).show();}
$('.itemsContainer',page).html(html).trigger('create').lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function removeFromPlaylist(page,ids){ApiClient.ajax({url:ApiClient.getUrl('Playlists/'+currentItem.Id+'/Items',{EntryIds:ids.join(',')}),type:'DELETE'}).done(function(){reloadItems(page);});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#playlistEditorPage",function(){var page=this;$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('.btnPlay',page).on('click',function(){var userdata=currentItem.UserData||{};var mediaType=currentItem.MediaType;if(currentItem.Type=="MusicArtist"||currentItem.Type=="MusicAlbum"){mediaType="Audio";}
LibraryBrowser.showPlayMenu(this,currentItem.Id,currentItem.Type,currentItem.IsFolder,mediaType,userdata.PlaybackPositionTicks);});$('.itemsContainer',page).on('needsrefresh',function(){reloadItems(page);}).on('removefromplaylist',function(e,playlistItemId){removeFromPlaylist(page,[playlistItemId]);}).on('playallfromhere',function(e,index){LibraryBrowser.playAllFromHere(_childrenItemsFunction,index);}).on('queueallfromhere',function(e,index){LibraryBrowser.queueAllFromHere(_childrenItemsFunction,index);});}).on('pagebeforeshow',"#playlistEditorPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);reloadItems(page);}).on('pageshow',"#playlistEditorPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var query={TargetSystems:'Server',IsAdult:false};function reloadList(page){Dashboard.showLoadingMsg();var promise1=ApiClient.getAvailablePlugins(query);var promise2=ApiClient.getInstalledPlugins();$.when(promise1,promise2).done(function(response1,response2){populateList({catalogElement:$('#pluginTiles',page),noItemsElement:$("#noPlugins",page),availablePlugins:response1[0],installedPlugins:response2[0]});});}
function populateList(options){var availablePlugins=options.availablePlugins;var installedPlugins=options.installedPlugins;availablePlugins=availablePlugins.filter(function(p){p.category=p.category||"General";p.categoryDisplayName=Globalize.translate('PluginCategory'+p.category.replace(' ',''));if(options.categories){if(options.categories.indexOf(p.category)==-1){return false;}}
if(options.targetSystem){if(p.targetSystem!=options.targetSystem){return false;}}
return p.type=="UserInstalled";}).sort(function(a,b){var aName=(a.category)+" "+a.name;var bame=(b.category)+" "+b.name;return aName>bame?1:-1;});var pluginhtml='';var currentCategory;for(var i=0,length=availablePlugins.length;i<length;i++){var html='';var plugin=availablePlugins[i];var category=plugin.categoryDisplayName;if(category!=currentCategory){if(options.showCategory!==false){if(currentCategory){html+='<br/>';html+='<br/>';html+='<br/>';}
html+='<div class="detailSectionHeader">'+category+'</div>';}
currentCategory=category;}
var href=plugin.externalUrl?plugin.externalUrl:"addplugin.html?name="+encodeURIComponent(plugin.name)+"&guid="+plugin.guid;if(options.context){href+="&context="+options.context;}
var target=plugin.externalUrl?' target="_blank"':'';html+="<div class='card backdropCard alternateHover bottomPaddedCard'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';html+='<a class="cardContent" href="'+href+'"'+target+'>';if(plugin.thumbImage){html+='<div class="cardImage" style="background-image:url(\''+plugin.thumbImage+'\');">';}else{html+='<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">';}
if(plugin.isPremium){if(plugin.price>0){html+="<div class='premiumBanner'><img src='css/images/supporter/premiumflag.png' /></div>";}else{html+="<div class='premiumBanner'><img src='css/images/supporter/supporterflag.png' /></div>";}}
html+="</div>";html+="</a>";html+="</div>";html+='<div class="cardFooter">';html+="<div class='cardText'>";html+=plugin.name;html+="</div>";if(!plugin.isExternal){html+="<div class='cardText packageReviewText'>";html+=plugin.price>0?"$"+plugin.price.toFixed(2):Globalize.translate('LabelFree');html+=RatingHelpers.getStoreRatingHtml(plugin.avgRating,plugin.id,plugin.name);html+="<span class='storeReviewCount'>";html+=" "+Globalize.translate('LabelNumberReviews').replace("{0}",plugin.totalRatings);html+="</span>";html+="</div>";}
var installedPlugin=plugin.isApp?null:installedPlugins.filter(function(ip){return ip.Id==plugin.guid;})[0];html+="<div class='cardText'>";if(installedPlugin){html+=Globalize.translate('LabelVersionInstalled').replace("{0}",installedPlugin.Version);}else{html+='&nbsp;';}
html+="</div>";html+="</div>";html+="</div>";html+="</div>";pluginhtml+=html;}
if(!availablePlugins.length&&options.noItemsElement){$(options.noItemsElement).hide();}
$(options.catalogElement).html(pluginhtml);Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#pluginCatalogPage",function(){var page=this;$('.chkPremiumFilter',page).on('change',function(){if(this.checked){query.IsPremium=false;}else{query.IsPremium=null;}
reloadList(page);});$('.radioPackageTypes',page).on('change',function(){var val=$('.radioPackageTypes:checked',page).val();query.TargetSystems=val;reloadList(page);});$('#chkAdult',page).on('change',function(){query.IsAdult=this.checked?null:false;reloadList(page);});}).on('pageshow',"#pluginCatalogPage",function(){var page=this;$(".radioPackageTypes",page).each(function(){this.checked=this.value==query.TargetSystems;}).checkboxradio('refresh');$('.chkPremiumFilter',page).each(function(){var filters=query.IsPremium||false;this.checked=filters;}).checkboxradio('refresh');reloadList(page);});window.PluginCatalog={renderCatalog:populateList};})(jQuery,document);(function($,window){function deletePlugin(page,uniqueid,name){var msg=Globalize.translate('UninstallPluginConfirmation').replace("{0}",name);Dashboard.confirm(msg,Globalize.translate('UninstallPluginHeader'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.uninstallPlugin(uniqueid).done(function(){reloadList(page);});}});}
function showNoConfigurationMessage(){Dashboard.alert({message:Globalize.translate('NoPluginConfigurationMessage')});}
function showConnectMessage(){Dashboard.alert({message:Globalize.translate('MessagePluginConfigurationRequiresLocalAccess')});}
function getPluginCardHtml(plugin,pluginConfigurationPages){var configPage=$.grep(pluginConfigurationPages,function(pluginConfigurationPage){return pluginConfigurationPage.PluginId==plugin.Id;})[0];var html='';var isConnectMode=Dashboard.isConnectMode();var configPageUrl=configPage?Dashboard.getConfigurationPageUrl(configPage.Name):null;var href=configPage&&!isConnectMode?configPageUrl:null;html+="<div data-id='"+plugin.Id+"' data-name='"+plugin.Name+"' class='card backdropCard alternateHover bottomPaddedCard'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';if(href){html+='<a class="cardContent" href="'+href+'">';}
else if(!configPageUrl){html+='<div class="cardContent noConfigPluginCard noHoverEffect">';}
else if(isConnectMode){html+='<div class="cardContent connectModePluginCard">';}
else{html+='<div class="cardContent">';}
if(plugin.ImageUrl){html+='<div class="cardImage" style="background-image:url(\''+plugin.ImageUrl+'\');">';}else{html+='<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">';}
html+="</div>";if(href){html+="</a>";}else{html+="</div>";}
html+="</div>";html+='<div class="cardFooter">';html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="btnCardMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 2px 0 0;"></button>';html+="</div>";html+="<div class='cardText'>";html+=plugin.Name;html+="</div>";html+="<div class='cardText'>";html+=plugin.Version;html+="</div>";html+="</div>";html+="</div>";html+="</div>";return html;}
function renderPlugins(page,plugins){ApiClient.getJSON(ApiClient.getUrl("dashboard/configurationpages")+"?pageType=PluginConfiguration").done(function(configPages){populateList(page,plugins,configPages);});}
function populateList(page,plugins,pluginConfigurationPages){plugins=plugins.sort(function(plugin1,plugin2){return(plugin1.Name)>(plugin2.Name)?1:-1;});var html=plugins.map(function(p){return getPluginCardHtml(p,pluginConfigurationPages);}).join('');if(!plugins.length){html+='<div style="padding:5px;">';html+='<p>'+Globalize.translate('MessageNoPluginsInstalled')+'</p>';html+='<p><a href="plugincatalog.html">';html+=Globalize.translate('BrowsePluginCatalogMessage');html+='</a></p>';html+='</div>';$('.installedPlugins',page).html(html).trigger('create');}else{var elem=$('.installedPlugins',page).html(html).trigger('create');$('.noConfigPluginCard',elem).on('click',function(){showNoConfigurationMessage();});$('.connectModePluginCard',elem).on('click',function(){showConnectMessage();});$('.btnCardMenu',elem).on('click',function(){showPluginMenu(page,this);});}
Dashboard.hideLoadingMsg();}
function showPluginMenu(page,elem){var card=$(elem).parents('.card');var id=card.attr('data-id');var name=card.attr('data-name');var configHref=$('.cardContent',card).attr('href');$('.cardMenu',page).popup("close").remove();var html='<div data-role="popup" class="cardMenu tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';if(configHref){html+='<li><a href="'+configHref+'">'+Globalize.translate('ButtonSettings')+'</a></li>';}
html+='<li><a href="#" class="btnDeletePlugin">'+Globalize.translate('ButtonUninstall')+'</a></li>';html+='</ul>';html+='</div>';$(page).append(html);var flyout=$('.cardMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnDeletePlugin',flyout).on('click',function(){$('.cardMenu',page).popup('close');setTimeout(function(){deletePlugin(page,id,name);},300);});}
function reloadList(page){Dashboard.showLoadingMsg();ApiClient.getInstalledPlugins().done(function(plugins){renderPlugins(page,plugins);});}
$(document).on('pageshow',"#pluginsPage",function(){reloadList(this);});window.PluginsPage={renderPlugins:renderPlugins};})(jQuery,window);(function(window,document,$){function sendPlayCommand(options,playType){var sessionId=MediaController.getPlayerInfo().id;var ids=options.ids||options.items.map(function(i){return i.Id;});var remoteOptions={ItemIds:ids.join(','),PlayCommand:playType};if(options.startPositionTicks){remoteOptions.startPositionTicks=options.startPositionTicks;}
ApiClient.sendPlayCommand(sessionId,remoteOptions);}
function sendPlayStateCommand(command,options){var sessionId=MediaController.getPlayerInfo().id;ApiClient.sendPlayStateCommand(sessionId,command,options);}
function remoteControlPlayer(){var self=this;self.name='Remote Control';function sendCommandByName(name,options){var command={Name:name};if(options){command.Arguments=options;}
self.sendCommand(command);}
self.sendCommand=function(command){var sessionId=MediaController.getPlayerInfo().id;ApiClient.sendCommand(sessionId,command);};self.play=function(options){sendPlayCommand(options,'PlayNow');};self.shuffle=function(id){sendPlayCommand({ids:[id]},'PlayShuffle');};self.instantMix=function(id){sendPlayCommand({ids:[id]},'PlayInstantMix');};self.queue=function(options){sendPlayCommand(options,'PlayNext');};self.queueNext=function(options){sendPlayCommand(options,'PlayLast');};self.canQueueMediaType=function(mediaType){return mediaType=='Audio'||mediaType=='Video';};self.stop=function(){sendPlayStateCommand('stop');};self.nextTrack=function(){sendPlayStateCommand('nextTrack');};self.previousTrack=function(){sendPlayStateCommand('previousTrack');};self.seek=function(positionTicks){sendPlayStateCommand('seek',{SeekPositionTicks:positionTicks});};self.pause=function(){sendPlayStateCommand('Pause');};self.unpause=function(){sendPlayStateCommand('Unpause');};self.mute=function(){sendCommandByName('Mute');};self.unMute=function(){sendCommandByName('Unmute');};self.toggleMute=function(){sendCommandByName('ToggleMute');};self.setVolume=function(vol){sendCommandByName('SetVolume',{Volume:vol});};self.volumeUp=function(){sendCommandByName('VolumeUp');};self.volumeDown=function(){sendCommandByName('VolumeDown');};self.toggleFullscreen=function(){sendCommandByName('ToggleFullscreen');};self.setAudioStreamIndex=function(index){sendCommandByName('SetAudioStreamIndex',{Index:index});};self.setSubtitleStreamIndex=function(index){sendCommandByName('SetSubtitleStreamIndex',{Index:index});};self.displayContent=function(options){sendCommandByName('DisplayContent',options);};self.getPlayerState=function(){var deferred=$.Deferred();var apiClient=ConnectionManager.currentApiClient();if(apiClient){apiClient.getSessions().done(function(sessions){var currentTargetId=MediaController.getPlayerInfo().id;var session=sessions.filter(function(s){return s.Id==currentTargetId;})[0];if(session){session=getPlayerState(session);}
deferred.resolveWith(null,[session]);});}else{deferred.resolveWith(null,[{}]);}
return deferred.promise();};self.subscribeToPlayerUpdates=function(){self.isUpdating=true;if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStart","100,800");}};function unsubscribeFromPlayerUpdates(){self.false=true;if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SessionsStop");}}
var playerListenerCount=0;self.beginPlayerUpdates=function(){if(playerListenerCount<=0){playerListenerCount=0;self.subscribeToPlayerUpdates();}
playerListenerCount++;};self.endPlayerUpdates=function(){playerListenerCount--;if(playerListenerCount<=0){unsubscribeFromPlayerUpdates();playerListenerCount=0;}};self.getTargets=function(){var deferred=$.Deferred();var sessionQuery={ControllableByUserId:Dashboard.getCurrentUserId()};var apiClient=ConnectionManager.currentApiClient();if(apiClient){apiClient.getSessions(sessionQuery).done(function(sessions){var targets=sessions.filter(function(s){return s.DeviceId!=apiClient.deviceId();}).map(function(s){return{name:s.DeviceName,deviceName:s.DeviceName,id:s.Id,playerName:self.name,appName:s.Client,playableMediaTypes:s.PlayableMediaTypes,isLocalPlayer:false,supportedCommands:s.SupportedCommands};});deferred.resolveWith(null,[targets]);}).fail(function(){deferred.reject();});}else{deferred.resolveWith(null,[]);}
return deferred.promise();};}
var player=new remoteControlPlayer();MediaController.registerPlayer(player);function getPlayerState(session){return session;}
function firePlaybackEvent(name,session){$(player).trigger(name,[getPlayerState(session)]);}
function onWebSocketConnectionChange(){if(player.isUpdating){player.subscribeToPlayerUpdates();}}
function onWebSocketMessageReceived(e,msg){var apiClient=this;if(msg.MessageType==="Sessions"){var currentTargetId=MediaController.getPlayerInfo().id;var session=msg.Data.filter(function(s){return s.Id==currentTargetId;})[0];if(session){firePlaybackEvent('playstatechange',session);}}
else if(msg.MessageType==="SessionEnded"){console.log("Server reports another session ended");if(MediaController.getPlayerInfo().id==msg.Data.Id){MediaController.setDefaultPlayerActive();}}
else if(msg.MessageType==="PlaybackStart"){if(msg.Data.DeviceId!=apiClient.deviceId()){if(MediaController.getPlayerInfo().id==msg.Data.Id){firePlaybackEvent('playbackstart',msg.Data);}}}
else if(msg.MessageType==="PlaybackStopped"){if(msg.Data.DeviceId!=apiClient.deviceId()){if(MediaController.getPlayerInfo().id==msg.Data.Id){firePlaybackEvent('playbackstop',msg.Data);}}}}
function initializeApiClient(apiClient){$(apiClient).on("websocketmessage",onWebSocketMessageReceived).on("websocketopen",onWebSocketConnectionChange);}
$(ConnectionManager).on('apiclientcreated',function(e,apiClient){initializeApiClient(apiClient);});})(window,document,jQuery);var ScheduledTaskPage={onPageShow:function(){ScheduledTaskPage.refreshScheduledTask();},refreshScheduledTask:function(){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getScheduledTask(id).done(ScheduledTaskPage.loadScheduledTask);},loadScheduledTask:function(task){var page=$.mobile.activePage;$('.taskName',page).html(task.Name);$('#pTaskDescription',page).html(task.Description);ScheduledTaskPage.loadTaskTriggers(task);Dashboard.hideLoadingMsg();},loadTaskTriggers:function(task){var html='';html+='<li data-role="list-divider"><h3>'+Globalize.translate('HeaderTaskTriggers')+'</h3></li>';for(var i=0,length=task.Triggers.length;i<length;i++){var trigger=task.Triggers[i];html+='<li>';html+='<a href="#">';html+='<h3>';html+=ScheduledTaskPage.getTriggerFriendlyName(trigger);html+='</h3>';if(trigger.MaxRuntimeMs){html+='<p>';var hours=trigger.MaxRuntimeMs/3600000;if(hours==1){html+=Globalize.translate('ValueTimeLimitSingleHour');}else{html+=Globalize.translate('ValueTimeLimitMultiHour',hours);}
html+='</p>';}
html+='</a>';html+='<a href="#" onclick="ScheduledTaskPage.confirmDeleteTrigger('+i+');">';html+=Globalize.translate('Delete');html+='</a>';html+='</li>';}
$('#ulTaskTriggers',$.mobile.activePage).html(html).listview('refresh');},getTriggerFriendlyName:function(trigger){if(trigger.Type=='DailyTrigger'){return'Daily at '+ScheduledTaskPage.getDisplayTime(trigger.TimeOfDayTicks);}
if(trigger.Type=='WeeklyTrigger'){return trigger.DayOfWeek+'s at '+ScheduledTaskPage.getDisplayTime(trigger.TimeOfDayTicks);}
if(trigger.Type=='SystemEventTrigger'){if(trigger.SystemEvent=='WakeFromSleep'){return'On wake from sleep';}}
if(trigger.Type=='IntervalTrigger'){var hours=trigger.IntervalTicks/36000000000;if(hours==.25){return"Every 15 minutes";}
if(hours==.5){return"Every 30 minutes";}
if(hours==.75){return"Every 45 minutes";}
if(hours==1){return"Every hour";}
return'Every '+hours+' hours';}
if(trigger.Type=='StartupTrigger'){return'On application startup';}
return trigger.Type;},getDisplayTime:function(ticks){var hours=ticks/36000000000;if(hours<1){hours=0;}
hours=Math.floor(hours);ticks-=(hours*36000000000);var minutes=Math.floor((ticks/600000000));var suffix="am";if(hours>11){suffix="pm";}
hours=hours%12;if(hours==0){hours=12;}
if(minutes<10){minutes='0'+minutes;}
return hours+':'+minutes+' '+suffix;},showAddTriggerPopup:function(){var page=$.mobile.activePage;$('#selectTriggerType',page).val('DailyTrigger').trigger('change').selectmenu('refresh');$('#popupAddTrigger',page).on("popupafteropen",function(){$('#addTriggerForm input:first',this).focus();}).popup("open").on("popupafterclose",function(){$('#addTriggerForm',page).off("submit");$(this).off("popupafterclose");});},onSubmit:function(){ScheduledTaskPage.addTrigger();return false;},addTrigger:function(){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getScheduledTask(id).done(function(task){task.Triggers.push(ScheduledTaskPage.getTriggerToAdd());ApiClient.updateScheduledTaskTriggers(task.Id,task.Triggers).done(function(){$('#popupAddTrigger').popup('close');ScheduledTaskPage.refreshScheduledTask();});});},confirmDeleteTrigger:function(index){Dashboard.confirm(Globalize.translate('MessageDeleteTaskTrigger'),Globalize.translate('HeaderDeleteTaskTrigger'),function(result){if(result){ScheduledTaskPage.deleteTrigger(index);}});},deleteTrigger:function(index){Dashboard.showLoadingMsg();var id=getParameterByName('id');ApiClient.getScheduledTask(id).done(function(task){task.Triggers.remove(index);ApiClient.updateScheduledTaskTriggers(task.Id,task.Triggers).done(function(){ScheduledTaskPage.refreshScheduledTask();});});},refreshTriggerFields:function(triggerType){var page=$.mobile.activePage;if(triggerType=='DailyTrigger'){$('#fldTimeOfDay',page).show();$('#fldDayOfWeek',page).hide();$('#fldSelectSystemEvent',page).hide();$('#fldSelectInterval',page).hide();$('#txtTimeOfDay',page).attr('required','required');}
else if(triggerType=='WeeklyTrigger'){$('#fldTimeOfDay',page).show();$('#fldDayOfWeek',page).show();$('#fldSelectSystemEvent',page).hide();$('#fldSelectInterval',page).hide();$('#txtTimeOfDay',page).attr('required','required');}
else if(triggerType=='SystemEventTrigger'){$('#fldTimeOfDay',page).hide();$('#fldDayOfWeek',page).hide();$('#fldSelectSystemEvent',page).show();$('#fldSelectInterval',page).hide();$('#txtTimeOfDay',page).removeAttr('required');}
else if(triggerType=='IntervalTrigger'){$('#fldTimeOfDay',page).hide();$('#fldDayOfWeek',page).hide();$('#fldSelectSystemEvent',page).hide();$('#fldSelectInterval',page).show();$('#txtTimeOfDay',page).removeAttr('required');}
else if(triggerType=='StartupTrigger'){$('#fldTimeOfDay',page).hide();$('#fldDayOfWeek',page).hide();$('#fldSelectSystemEvent',page).hide();$('#fldSelectInterval',page).hide();$('#txtTimeOfDay',page).removeAttr('required');}},getTriggerToAdd:function(){var page=$.mobile.activePage;var trigger={Type:$('#selectTriggerType',page).val()};if(trigger.Type=='DailyTrigger'){trigger.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($('#txtTimeOfDay',page).val());}
else if(trigger.Type=='WeeklyTrigger'){trigger.DayOfWeek=$('#selectDayOfWeek',page).val();trigger.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($('#txtTimeOfDay',page).val());}
else if(trigger.Type=='SystemEventTrigger'){trigger.SystemEvent=$('#selectSystemEvent',page).val();}
else if(trigger.Type=='IntervalTrigger'){trigger.IntervalTicks=$('#selectInterval',page).val();}
var timeLimit=$('#txtTimeLimit',page).val()||'0';timeLimit=parseFloat(timeLimit)*3600000;trigger.MaxRuntimeMs=timeLimit||null;return trigger;},getTimeOfDayTicks:function(val){var vals=val.split(':');var hours=vals[0];var minutes=vals[1];var ticks=hours*60*60*1000*10000;ticks+=minutes*60*1000*10000;return ticks;}};$(document).on('pageshow',"#scheduledTaskPage",ScheduledTaskPage.onPageShow);(function($,document,window){function reloadList(page){ApiClient.getScheduledTasks({isHidden:false}).done(function(tasks){populateList(page,tasks);Dashboard.hideLoadingMsg();});}
function populateList(page,tasks){tasks=tasks.sort(function(a,b){a=a.Category+" "+a.Name;b=b.Category+" "+b.Name;if(a==b){return 0;}
if(a<b){return-1;}
return 1;});var html="";html+='<ul data-role="listview" data-inset="true" data-auto-enhanced="false" data-split-icon="Play">';var currentCategory;for(var i=0,length=tasks.length;i<length;i++){var task=tasks[i];if(task.Category!=currentCategory){currentCategory=task.Category;html+="<li data-role='list-divider'>"+currentCategory+"</li>";}
html+="<li title='"+task.Description+"'>";html+="<a href='scheduledtask.html?id="+task.Id+"'>";html+="<h3>"+task.Name+"</h3>";html+="<p id='"+task.Id+"'>"+getTaskProgressHtml(task)+"</p>";if(task.State=="Idle"){html+="<a id='btnTask"+task.Id+"' class='btnStartTask' href='#' data-taskid='"+task.Id+"' data-icon='play'>"+Globalize.translate('ButtonStart')+"</a>";}
else if(task.State=="Running"){html+="<a id='btnTask"+task.Id+"' class='btnStopTask' href='#' data-taskid='"+task.Id+"' data-icon='stop'>"+Globalize.translate('ButtonStop')+"</a>";}else{html+="<a id='btnTask"+task.Id+"' class='btnStartTask' href='#' data-taskid='"+task.Id+"' data-icon='play' style='display:none;'>"+Globalize.translate('ButtonStart')+"</a>";}
html+="</a>";html+="</li>";}
html+="</ul>";$('#divScheduledTasks',page).html(html).trigger('create');}
function getTaskProgressHtml(task){var html='';if(task.State=="Idle"){if(task.LastExecutionResult){html+=Globalize.translate('LabelScheduledTaskLastRan').replace("{0}",humane_date(task.LastExecutionResult.EndTimeUtc)).replace("{1}",humane_elapsed(task.LastExecutionResult.StartTimeUtc,task.LastExecutionResult.EndTimeUtc));if(task.LastExecutionResult.Status=="Failed"){html+=" <span style='color:#FF0000;'>"+Globalize.translate('LabelFailed')+"</span>";}
else if(task.LastExecutionResult.Status=="Cancelled"){html+=" <span style='color:#0026FF;'>"+Globalize.translate('LabelCancelled')+"</span>";}
else if(task.LastExecutionResult.Status=="Aborted"){html+=" <span style='color:#FF0000;'>"+Globalize.translate('LabelAbortedByServerShutdown')+"</span>";}}}
else if(task.State=="Running"){var progress=(task.CurrentProgressPercentage||0).toFixed(1);html+='<progress max="100" value="'+progress+'" title="'+progress+'%">';html+=''+progress+'%';html+='</progress>';html+="<span style='color:#009F00;margin-left:5px;'>"+progress+"%</span>";}else{html+="<span style='color:#FF0000;'>"+Globalize.translate('LabelStopping')+"</span>";}
return html;}
function onWebSocketMessage(e,msg){if(msg.MessageType=="ScheduledTasksInfo"){var tasks=msg.Data;var page=$.mobile.activePage;updateTasks(page,tasks);}}
function updateTasks(page,tasks){for(var i=0,length=tasks.length;i<length;i++){var task=tasks[i];$('#'+task.Id,page).html(getTaskProgressHtml(task));var btnTask=$('#btnTask'+task.Id,page);updateTaskButton(btnTask,task.State);}}
function updateTaskButton(btnTask,state){var elem;if(state=="Idle"){elem=btnTask.addClass('btnStartTask').removeClass('btnStopTask').show().data("icon","play").attr("title",Globalize.translate('ButtonStart'));elem.removeClass('ui-icon-stop').addClass('ui-icon-play');}
else if(state=="Running"){elem=btnTask.addClass('btnStopTask').removeClass('btnStartTask').show().data("icon","stop").attr("title",Globalize.translate('ButtonStop'));elem.removeClass('ui-icon-play').addClass('ui-icon-stop');}else{elem=btnTask.addClass('btnStartTask').removeClass('btnStopTask').hide().data("icon","play").attr("title",Globalize.translate('ButtonStart'));elem.removeClass('ui-icon-stop').addClass('ui-icon-play');}}
function onWebSocketConnectionOpen(){startInterval();reloadList($.mobile.activePage);}
function startInterval(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000");}}
function stopInterval(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop");}}
$(document).on('pageshow',"#scheduledTasksPage",function(){var page=this;Dashboard.showLoadingMsg();startInterval();reloadList(page);$(ApiClient).on("websocketmessage",onWebSocketMessage).on("websocketopen",onWebSocketConnectionOpen);$('#divScheduledTasks',page).on('click','.btnStartTask',function(){var button=this;var id=button.getAttribute('data-taskid');ApiClient.startScheduledTask(id).done(function(){updateTaskButton($(button),"Running");reloadList(page);});}).on('click','.btnStopTask',function(){var button=this;var id=button.getAttribute('data-taskid');ApiClient.stopScheduledTask(id).done(function(){updateTaskButton($(button),"");reloadList(page);});});}).on('pagehide',"#scheduledTasksPage",function(){var page=this;$(ApiClient).off("websocketmessage",onWebSocketMessage).off("websocketopen",onWebSocketConnectionOpen);stopInterval();$('#divScheduledTasks',page).off('click','.btnStartTask').off('click','.btnStopTask');});})(jQuery,document,window);(function($,document,window,clearTimeout,setTimeout){var searchHintTimeout;function clearSearchHintTimeout(){if(searchHintTimeout){clearTimeout(searchHintTimeout);searchHintTimeout=null;}}
function updateSearchHints(page,searchTerm){if(!searchTerm){$('#searchHints',page).empty();clearSearchHintTimeout();return;}
clearSearchHintTimeout();searchHintTimeout=setTimeout(function(){requestSearchHints(page,searchTerm);},100);}
function requestSearchHints(page,searchTerm){var currentTimeout=searchHintTimeout;ApiClient.getSearchHints({userId:Dashboard.getCurrentUserId(),searchTerm:searchTerm,limit:10}).done(function(result){if(currentTimeout!=searchHintTimeout){return;}
renderSearchHintResult(page,result.SearchHints);});}
function preg_quote(str,delimiter){return(str+'').replace(new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\'+(delimiter||'')+'-]','g'),'\\$&');}
function getHintDisplayName(data,term){var regexp=new RegExp("("+preg_quote(term)+")",'gi');return data.replace(regexp,"<b>$1</b>");}
function getAdditionalTextLines(hint){if(hint.Type=="Audio"){return[[hint.AlbumArtist,hint.Album].join(" - ")];}
else if(hint.Type=="MusicAlbum"){return[hint.AlbumArtist];}
else if(hint.Type=="MusicArtist"){return[Globalize.translate('LabelArtist')];}
else if(hint.Type=="Movie"){return[Globalize.translate('LabelMovie')];}
else if(hint.Type=="MusicVideo"){return[Globalize.translate('LabelMusicVideo')];}
else if(hint.Type=="Episode"){return[Globalize.translate('LabelEpisode')];}
else if(hint.Type=="Series"){return[Globalize.translate('LabelSeries')];}
else if(hint.Type=="BoxSet"){return[Globalize.translate('LabelCollection')];}
return[hint.Type];}
function getSearchHintHtml(hint){var html='';html+='<a class="searchHint" href="'+LibraryBrowser.getHref(hint,null,'')+'">';var imgUrl;if(hint.PrimaryImageTag){hint.ImageTags={Primary:hint.PrimaryImageTag};imgUrl=ApiClient.getImageUrl(hint.ItemId,{type:"Primary",maxWidth:150,maxHeight:150,tag:hint.PrimaryImageTag});}
else if(hint.MediaType=="Game"){imgUrl="css/images/items/searchhintsv2/game.png";}
else if(hint.Type=="Episode"||hint.Type=="Season"||hint.Type=="Series"){imgUrl="css/images/items/searchhintsv2/tv.png";}
else if(hint.Type=="Audio"||hint.Type=="MusicAlbum"||hint.Type=="MusicArtist"){imgUrl="css/images/items/searchhintsv2/music.png";}
else if(hint.Type=="Person"){imgUrl="css/images/items/searchhintsv2/person.png";}
else{imgUrl="css/images/items/searchhintsv2/film.png";}
html+='<img class="searchHintImage" src="'+imgUrl+'" />';html+='<div class="searchHintContent"><div class="searchHintContentInner">';html+='<div class="searchHintName">'+getHintDisplayName(hint.Name,hint.MatchedTerm)+'</div>';if(hint.Type=="Audio"){html+='<div class="searchHintSecondaryText">'+[hint.AlbumArtist,hint.Album].join(" - ")+'</div>';}
else if(hint.Type=="MusicAlbum"){html+='<div class="searchHintSecondaryText">'+hint.AlbumArtist+'</div>';}
else if(hint.Type=="MusicArtist"){html+='<div class="searchHintSecondaryText">'+Globalize.translate('LabelArtist')+'</div>';}
else if(hint.Type=="Movie"){html+='<div class="searchHintSecondaryText">'+Globalize.translate('LabelMovie')+'</div>';}
else if(hint.Type=="MusicVideo"){html+='<div class="searchHintSecondaryText">'+Globalize.translate('LabelMusicVideo')+'</div>';}
else if(hint.Type=="Episode"){html+='<div class="searchHintSecondaryText">'+Globalize.translate('LabelEpisode')+'</div>';}
else if(hint.Type=="Series"){html+='<div class="searchHintSecondaryText">'+Globalize.translate('LabelSeries')+'</div>';}
else{html+='<div class="searchHintSecondaryText">'+(hint.Type)+'</div>';}
var text;if(hint.EpisodeCount){text=hint.EpisodeCount==1?"1 Episode":hint.EpisodeCount+" Episodes";html+='<div class="searchHintSecondaryText">'+text+'</div>';}
else if(hint.SongCount){text=hint.SongCount==1?"1 Song":hint.SongCount+" Songs";html+='<div class="searchHintSecondaryText">'+text+'</div>';}
else if(hint.ProductionYear&&hint.MediaType!="Audio"&&hint.Type!="Episode"){html+='<div class="searchHintSecondaryText">'+hint.ProductionYear+'</div>';}
else if(hint.RunTimeTicks){html+='<div class="searchHintSecondaryText">'+Dashboard.getDisplayTime(hint.RunTimeTicks)+'</div>';}
html+='</div></div>';html+='</a>';return html;}
function renderSearchHintResult(page,hints){var html='';for(var i=0,length=hints.length;i<length;i++){html+=getSearchHintHtml(hints[i]);}
$('#searchHints',page).html(html);}
function getSearchPanel(page){var panel=$('#searchPanel',page);if(!panel.length){var html='';html+='<div data-role="panel" id="searchPanel" class="searchPanel" data-position="right" data-display="overlay" data-position-fixed="true" data-theme="b">';html+='<h3>';html+=Globalize.translate('HeaderSearch');html+='</h3>';html+='<input id="txtSearch" class="txtSearch" type="search" data-theme="a" />';html+='<div id="searchHints" class="searchHints"></div>';html+='</div>';$(page).append(html);panel=$('#searchPanel',page).panel({}).trigger('create');$('#txtSearch',panel).on("keyup",function(e){if(e.keyCode==40){var first=$('.searchHint',panel)[0];if(first){first.focus();}
return false;}}).on("keyup",function(e){if(e.keyCode!=40){var value=this.value;updateSearchHints(panel,value);}});$('#searchHints',page).on("keydown",'.searchHint',function(e){if(e.keyCode==40){var next=$(this).next()[0];if(next){next.focus();}
return false;}
if(e.keyCode==38){var prev=$(this).prev()[0];if(prev){prev.focus();}else{$('#txtSearch',page)[0].focus();}
return false;}});}
return panel;}
function search(){var self=this;self.showSearchPanel=function(page){var panel=getSearchPanel(page);$(panel).panel('toggle');$('#txtSearch').focus();};}
window.Search=new search();function renderSearchResultsInOverlay(elem,hints){hints=hints.map(function(i){i.Id=i.ItemId;i.ImageTags={};i.UserData={};if(i.PrimaryImageTag){i.ImageTags.Primary=i.PrimaryImageTag;}
return i;});var html=LibraryBrowser.getPosterViewHtml({items:hints,shape:"square",lazy:true,overlayText:false,showTitle:true,coverImage:true,centerImage:true,textLines:getAdditionalTextLines});$('.itemsContainer',elem).html(html).lazyChildren();}
function requestSearchHintsForOverlay(elem,searchTerm){var currentTimeout=searchHintTimeout;ApiClient.getSearchHints({userId:Dashboard.getCurrentUserId(),searchTerm:searchTerm,limit:30}).done(function(result){if(currentTimeout!=searchHintTimeout){return;}
renderSearchResultsInOverlay(elem,result.SearchHints);});}
function updateSearchOverlay(elem,searchTerm){if(!searchTerm){$('.itemsContainer',elem).empty();clearSearchHintTimeout();return;}
clearSearchHintTimeout();searchHintTimeout=setTimeout(function(){requestSearchHintsForOverlay(elem,searchTerm);},100);}
function getSearchOverlay(createIfNeeded){var elem=$('.searchResultsOverlay');if(createIfNeeded&&!elem.length){var html='<div class="searchResultsOverlay ui-page-theme-b">';html+='<div class="searchResultsContainer"><div class="itemsContainer"></div></div></div>';elem=$(html).appendTo(document.body).hide().trigger('create');elem.createCardMenus();}
return elem;}
function onHeaderSearchChange(val){if(val){$('.btnCloseSearch').show();updateSearchOverlay(getSearchOverlay(true).fadeIn('fast'),val);$(document.body).addClass('bodyWithPopupOpen');}else{$('.btnCloseSearch').hide();updateSearchOverlay(getSearchOverlay(false).fadeOut('fast'),val);$(document.body).removeClass('bodyWithPopupOpen');}}
function bindSearchEvents(){$('.headerSearchInput').on("keyup",function(e){if(e.keyCode==40){return false;}else{onHeaderSearchChange(this.value);}}).on("search",function(e){if(!this.value){onHeaderSearchChange('');}});$('.btnCloseSearch').on('click',closeSearchOverlay);$('.viewMenuSearchForm').on('submit',function(){return false;});}
function closeSearchOverlay(){$('.headerSearchInput').val('');onHeaderSearchChange('');}
$(document).on('pagehide',".libraryPage",function(){$('#txtSearch',this).val('');$('#searchHints',this).empty();}).on('pagecontainerbeforehide',closeSearchOverlay);$(document).on('headercreated',function(){bindSearchEvents();});})(jQuery,document,window,clearTimeout,setTimeout);(function(){function connectToServer(page,server){Dashboard.showLoadingMsg();ConnectionManager.connectToServer(server).done(function(result){Dashboard.hideLoadingMsg();switch(result.State){case MediaBrowser.ConnectionState.SignedIn:{var apiClient=result.ApiClient;Dashboard.serverAddress(apiClient.serverAddress());Dashboard.setCurrentUser(apiClient.getCurrentUserId(),apiClient.accessToken());window.location='index.html';}
break;default:showServerConnectionFailure();break;}});}
function showServerConnectionFailure(){setTimeout(function(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")});},300);}
function getServerHtml(server){var html='';var cssClass="card squareCard bottomPaddedCard";html+="<div data-id='"+server.Id+"' data-connectserverid='"+(server.ConnectServerId||'')+"' class='"+cssClass+"'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var href="#";html+='<a class="cardContent lnkServer" data-serverid="'+server.Id+'" href="'+href+'">';var imgUrl='css/images/server.png';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');">';html+="</div>";html+="</a>";html+="</div>";html+='<div class="cardFooter">';html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="btnServerMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 2px 0 0;"></button>';html+="</div>";html+='<div class="cardText" style="margin-right: 30px; padding: 11px 0 10px;">';html+=server.Name;html+="</div>";html+="</div>";html+="</div>";html+="</div>";return html;}
function renderServers(page,servers){if(servers.length){$('.noServersMessage',page).hide();}else{$('.noServersMessage',page).show();}
var html='';html+=servers.map(getServerHtml).join('');var elem=$('.serverList',page).html(html).trigger('create');$('.lnkServer',elem).on('click',function(){var id=this.getAttribute('data-serverid');var server=servers.filter(function(s){return s.Id==id;})[0];connectToServer(page,server);});$('.btnServerMenu',elem).on('click',function(){showServerMenu(this);});}
function showGeneralError(){setTimeout(function(){Dashboard.hideLoadingMsg();Dashboard.alert({message:Globalize.translate('DefaultErrorMessage')});},300);}
function acceptInvitation(page,id){Dashboard.showLoadingMsg();ConnectionManager.acceptServer(id).done(function(){Dashboard.hideLoadingMsg();loadPage(page);}).fail(function(){showGeneralError();});}
function deleteServer(page,id){Dashboard.showLoadingMsg();ConnectionManager.deleteServer(id).done(function(){Dashboard.hideLoadingMsg();loadPage(page);}).fail(function(){showGeneralError();});}
function rejectInvitation(page,id){Dashboard.showLoadingMsg();ConnectionManager.rejectServer(id).done(function(){Dashboard.hideLoadingMsg();loadPage(page);}).fail(function(){showGeneralError();});}
function showServerMenu(elem){var card=$(elem).parents('.card');var page=$(elem).parents('.page');var id=card.attr('data-id');var connectserverid=card.attr('data-connectserverid');$('.serverMenu',page).popup("close").remove();var html='<div data-role="popup" class="serverMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';html+='<li><a href="#" class="btnDelete" data-connectserverid="'+connectserverid+'">'+Globalize.translate('ButtonDelete')+'</a></li>';html+='</ul>';html+='</div>';page.append(html);var flyout=$('.serverMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnDelete',flyout).on('click',function(){deleteServer(page,this.getAttribute('data-connectserverid'));$('.serverMenu',page).popup("close").remove();});}
function showPendingInviteMenu(elem){var card=$(elem).parents('.card');var page=$(elem).parents('.page');var id=card.attr('data-id');$('.inviteMenu',page).popup("close").remove();var html='<div data-role="popup" class="inviteMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';html+='<li><a href="#" class="btnAccept" data-id="'+id+'">'+Globalize.translate('ButtonAccept')+'</a></li>';html+='<li><a href="#" class="btnReject" data-id="'+id+'">'+Globalize.translate('ButtonReject')+'</a></li>';html+='</ul>';html+='</div>';page.append(html);var flyout=$('.inviteMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnAccept',flyout).on('click',function(){acceptInvitation(page,this.getAttribute('data-id'));$('.inviteMenu',page).popup("close").remove();});$('.btnReject',flyout).on('click',function(){rejectInvitation(page,this.getAttribute('data-id'));$('.inviteMenu',page).popup("close").remove();});}
function getPendingInviteHtml(invite){var html='';var cssClass="card squareCard alternateHover bottomPaddedCard";html+="<div data-id='"+invite.Id+"' class='"+cssClass+"'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var href="#";html+='<a class="cardContent" href="'+href+'">';var imgUrl='css/images/server.png';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');">';html+="</div>";html+="</a>";html+="</div>";html+='<div class="cardFooter">';html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="btnInviteMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 2px 0 0;"></button>';html+="</div>";html+='<div class="cardText" style="margin-right: 30px; padding: 11px 0 10px;">';html+=invite.Name;html+="</div>";html+="</div>";html+="</div>";html+="</div>";return html;}
function renderInvitations(page,list){if(list.length){$('.invitationSection',page).show();}else{$('.invitationSection',page).hide();}
var html=list.map(getPendingInviteHtml).join('');var elem=$('.invitationList',page).html(html).trigger('create');$('.btnInviteMenu',elem).on('click',function(){showPendingInviteMenu(this);});}
function loadInvitations(page){ConnectionManager.getUserInvitations().done(function(list){renderInvitations(page,list);});}
function loadPage(page){Dashboard.showLoadingMsg();ConnectionManager.getAvailableServers().done(function(servers){renderServers(page,servers);Dashboard.hideLoadingMsg();});loadInvitations(page);}
$(document).on('pageshow',"#selectServerPage",function(){var page=this;loadPage(page);});window.SelectServerPage={onServerAddressEntrySubmit:function(){Dashboard.showLoadingMsg();var form=this;var page=$(form).parents('.page');return false;}};})();(function($,document){function revoke(page,key){Dashboard.confirm(Globalize.translate('MessageConfirmRevokeApiKey'),Globalize.translate('HeaderConfirmRevokeApiKey'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl('Auth/Keys/'+key)}).done(function(){loadData(page);});}});}
function renderKeys(page,keys,users){var rows=keys.map(function(item){var html='';html+='<tr>';html+='<td>';html+='<button data-token="'+item.AccessToken+'" class="btnRevoke" data-mini="true" title="'+Globalize.translate('ButtonRevoke')+'" style="margin:0;">'+Globalize.translate('ButtonRevoke')+'</button>';html+='</td>';html+='<td style="vertical-align:middle;">';html+=(item.AccessToken);html+='</td>';html+='<td style="vertical-align:middle;">';html+=(item.AppName||'');html+='</td>';html+='<td style="vertical-align:middle;">';html+=(item.DeviceName||'');html+='</td>';html+='<td style="vertical-align:middle;">';var user=users.filter(function(u){return u.Id==item.UserId;})[0];if(user){html+=user.Name;}
html+='</td>';html+='<td style="vertical-align:middle;">';var date=parseISO8601Date(item.DateCreated,{toLocal:true});html+=date.toLocaleDateString()+' '+LiveTvHelpers.getDisplayTime(date);html+='</td>';html+='</tr>';return html;}).join('');var elem=$('.resultBody',page).html(rows).parents('.tblApiKeys').table("refresh").trigger('create');$('.btnRevoke',elem).on('click',function(){revoke(page,this.getAttribute('data-token'));});Dashboard.hideLoadingMsg();}
function loadData(page){Dashboard.showLoadingMsg();ApiClient.getUsers().done(function(users){ApiClient.getJSON(ApiClient.getUrl('Auth/Keys')).done(function(result){renderKeys(page,result.Items,users);});});}
$(document).on('pageinit',"#serverSecurityPage",function(){var page=this;$('.btnNewKey',page).on('click',function(){$('.newKeyPanel',page).panel('toggle');$('#txtAppName',page).val('').focus();});}).on('pageshow',"#serverSecurityPage",function(){var page=this;loadData(page);});window.ServerSecurityPage={onSubmit:function(e){var form=this;var page=$(form).parents('.page');Dashboard.showLoadingMsg();ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Auth/Keys/',{App:$('#txtAppName',form).val()})}).done(function(){$('.newKeyPanel',page).panel('close');loadData(page);});return false;}};})(jQuery,document);(function($,document){var defaultSortBy="Album,SortName";var query={SortBy:defaultSortBy,SortOrder:"Ascending",IncludeItemTypes:"Audio",Recursive:true,Fields:"AudioInfo,ParentId,SyncInfo",Limit:200,StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'songs'+(query.ParentId||'');}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',this).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html+=LibraryBrowser.getListViewHtml({items:result.Items,smallIcon:true,showIndex:true,defaultAction:'play'});var elem=$('#items',page).html(html).trigger('create').lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});$('.lnkColumnSort',page).on('click',function(){var order=this.getAttribute('data-sortfield');if(query.SortBy==order){if(query.SortOrder=="Descending"){query.SortOrder="Ascending";query.SortBy=defaultSortBy;}else{query.SortOrder="Descending";query.SortBy=order;}}else{query.SortOrder="Ascending";query.SortBy=order;}
query.StartIndex=0;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#songsPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');query.StartIndex=0;reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');query.StartIndex=0;reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#songsPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);QueryFilters.onPageShow(page,query);reloadItems(page);}).on('pageshow',"#songsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document,window){function loadPage(page,config){$('#txtRemoteClientBitrateLimit',page).val((config.RemoteClientBitrateLimit/1000000)||'');Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#streamingSettingsPage",function(){var page=this;$('#btnSelectTranscodingTempPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtTranscodingTempPath',page).val(path);}
picker.close();},header:Globalize.translate('HeaderSelectTranscodingPath'),instruction:Globalize.translate('HeaderSelectTranscodingPathHelp')});});}).on('pageshow',"#streamingSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getServerConfiguration().done(function(config){loadPage(page,config);});});window.StreamingSettingsPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getServerConfiguration().done(function(config){config.RemoteClientBitrateLimit=parseInt(parseFloat(($('#txtRemoteClientBitrateLimit',form).val()||'0'))*1000000);ApiClient.updateServerConfiguration(config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);var SupporterKeyPage={onPageShow:function(){SupporterKeyPage.load(this);},load:function(page){Dashboard.showLoadingMsg();ApiClient.getPluginSecurityInfo().done(function(info){$('#txtSupporterKey',page).val(info.SupporterKey);if(info.SupporterKey&&!info.IsMBSupporter){$('#txtSupporterKey',page).addClass("invalidEntry");$('.notSupporter',page).show();}else{$('#txtSupporterKey',page).removeClass("invalidEntry");$('.notSupporter',page).hide();}
Dashboard.hideLoadingMsg();});},updateSupporterKey:function(){Dashboard.showLoadingMsg();var form=this;var key=$('#txtSupporterKey',form).val();var info={SupporterKey:key};ApiClient.updatePluginSecurityInfo(info).done(function(){Dashboard.resetPluginSecurityInfo();Dashboard.hideLoadingMsg();if(key){Dashboard.alert({message:Globalize.translate('MessageKeyUpdated'),title:Globalize.translate('HeaderConfirmation')});}else{Dashboard.alert({message:Globalize.translate('MessageKeyRemoved'),title:Globalize.translate('HeaderConfirmation')});}
var page=$(form).parents('.page');SupporterKeyPage.load(page);});return false;},linkSupporterKeys:function(){Dashboard.showLoadingMsg();var form=this;var email=$('#txtNewEmail',form).val();var newkey=$('#txtNewKey',form).val();var oldkey=$('#txtOldKey',form).val();var info={email:email,newkey:newkey,oldkey:oldkey};var url="http://mb3admin.com/admin/service/supporter/linkKeys";console.log(url);$.post(url,info).done(function(res){var result=JSON.parse(res);Dashboard.hideLoadingMsg();if(result.Success){Dashboard.alert(Globalize.translate('MessageKeysLinked'));}else{Dashboard.showError(result.ErrorMessage);}
console.log(result);});return false;},retrieveSupporterKey:function(){Dashboard.showLoadingMsg();var form=this;var email=$('#txtEmail',form).val();var url="http://mb3admin.com/admin/service/supporter/retrievekey?email="+email;console.log(url);$.post(url).done(function(res){var result=JSON.parse(res);Dashboard.hideLoadingMsg();if(result.Success){Dashboard.alert(Globalize.translate('MessageKeyEmailedTo').replace("{0}",email));}else{Dashboard.showError(result.ErrorMessage);}
console.log(result);});return false;}};$(document).on('pageshow',"#supporterKeyPage",SupporterKeyPage.onPageShow);(function(){var connectSupporterInfo;function showAddUserForm(page){$('.popupAddUser',page).popup('open');$('#selectUserToAdd',page).html(connectSupporterInfo.EligibleUsers.map(function(u){return'<option value="'+u.ConnectUserId+'">'+u.Name+'</option>';}).join('')).selectmenu('refresh');}
function addUser(page,id){Dashboard.showLoadingMsg();ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Connect/Supporters',{Id:id})}).done(function(){$('.popupAddUser',page).popup('close');loadConnectSupporters(page);});}
function removeUser(page,id){Dashboard.confirm(Globalize.translate('MessageConfirmRemoveConnectSupporter'),Globalize.translate('HeaderConfirmRemoveUser'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl('Connect/Supporters',{Id:id})}).done(function(){loadConnectSupporters(page);});}});}
function getUserHtml(user){var html='';html+='<li>';html+='<a href="#">';var imgUrl=user.ImageUrl||'css/images/userflyoutdefault.png';html+='<img src="'+imgUrl+'" />';html+='<h3>';html+=(user.DisplayName||user.Name);html+='</h3>';html+='<p>';html+=user.Email;html+='</p>';html+='</a>';html+='<a href="#" data-icon="delete" class="btnRemoveUser" data-id="'+user.Id+'">';html+='</a>';html+='</li>';return html;}
function renderUsers(page,result){$('.linkSupporterKeyMessage',page).html(Globalize.translate('MessageLinkYourSupporterKey',result.MaxUsers));var html='';if(result.Users.length){html+='<ul data-role="listview" data-inset="true">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderUsers');html+=result.Users.map(getUserHtml).join('');html+='</ul>';}
var elem=$('.supporters',page).html(html).trigger('create');$('.btnRemoveUser',elem).on('click',function(){removeUser(page,this.getAttribute('data-id'));});}
function loadConnectSupporters(page){Dashboard.showLoadingMsg();Dashboard.suppressAjaxErrors=true;ApiClient.ajax({type:"GET",url:ApiClient.getUrl('Connect/Supporters'),dataType:"json"}).done(function(result){connectSupporterInfo=result;renderUsers(page,result);Dashboard.hideLoadingMsg();}).fail(function(){$('.supporters',page).html('<p>'+Globalize.translate('MessageErrorLoadingSupporterInfo')+'</p>');}).always(function(){Dashboard.suppressAjaxErrors=false;});}
$(document).on('pageinit',"#supporterKeyPage",function(){var page=this;$('#btnAddConnectUser',page).on('click',function(){showAddUserForm(page);});}).on('pageshow',"#supporterKeyPage",function(){var page=this;loadConnectSupporters(page);});window.SupporterKeyPage.onAddConnectUserSubmit=function(){var page=$(this).parents('.page');var id=$('#selectUserToAdd',page).val();addUser(page,id);return false;};})();(function(){function addRecurringFields(period,page){$("<input type='hidden' name='a3' class='pprecurring' />").attr('value',$('#donateAmt',page).val()).appendTo("#payPalSupporterForm",page);$("<input type='hidden' name='p3' value='1' class='pprecurring' />").appendTo("#payPalSupporterForm",page);$("<input type='hidden' name='t3' value='"+period+"' class='pprecurring' />").appendTo("#payPalSupporterForm",page);$("<input type='hidden' name='src' value='1' class='pprecurring' />").appendTo("#payPalSupporterForm",page);$("<input type='hidden' name='sra' value='1' class='pprecurring' />").appendTo("#payPalSupporterForm",page);$('#ppCmd',page).val('_xclick-subscriptions');$('#payPalSupporterForm',page).trigger('create');console.log($('#payPalSupporterForm',page).html());}
function removeRecurringFields(page){$('.pprecurring',page).remove();$('#ppCmd',page).val('_xclick');}
function setItemNumber(page,itemNumber){$('#ppItemNo',page).val(itemNumber);}
function getDonationType(page){return $(".radioDonationType:checked",page).val();}
var lifeTimeAmount=69.99;var dailyAmount=1;var monthlyAmount=4.99;var yearlyAmount=35.99;function getDonationAmount(page){var type=getDonationType(page);if(type=='once'){return $("#selectOneTimeDonationAmount",page).val();}
if(type=='yearly'){return yearlyAmount;}
if(type=='monthly'){return monthlyAmount;}
if(type=='daily'){return dailyAmount;}
return lifeTimeAmount;}
function updateSavedDonationAmount(page){$("#donateAmt",page).val(getDonationAmount(page));}
function loadUserInfo(page){ApiClient.getJSON(ApiClient.getUrl('System/SupporterInfo')).done(function(info){$('.hfPlanType',page).val(info.PlanType||'');$('.hfIsActive',page).val(info.IsActiveSupporter.toString());$('.radioDonationType',page).checked(false).checkboxradio('refresh');if(info.PlanType=='Lifetime'&&info.IsActiveSupporter){$('#radioOneTimeDonation',page).checked(true).checkboxradio('refresh');}else{$('#radioLifetimeSupporter',page).checked(true).checkboxradio('refresh');}
$('.radioDonationType:checked',page).trigger('change');if(info.IsActiveSupporter||info.IsExpiredSupporter){$('.currentPlanInfo',page).show();}else{$('.currentPlanInfo',page).hide();}
if(info.IsActiveSupporter&&info.PlanType=='Lifetime'){$('.planSummary',page).html(Globalize.translate('MessageYouHaveALifetimeMembership')).css('color','green');}
else if(info.IsActiveSupporter){$('.planSummary',page).html(Globalize.translate('MessageYouHaveAnActiveRecurringMembership').replace('{0}',info.PlanType)).css('color','green');}
else if(info.IsExpiredSupporter){var expirationDate=info.ExpirationDate?parseISO8601Date(info.ExpirationDate,{toLocal:true}):new Date();expirationDate=expirationDate.toLocaleDateString();$('.planSummary',page).html(Globalize.translate('MessageSupporterMembershipExpiredOn').replace('{0}',expirationDate)).css('color','red');}});}
$(document).on('pageinit',"#supporterPage",function(){var page=this;$('.radioDonationType',page).on('change',function(){var donationType=getDonationType(page);updateSavedDonationAmount(page);if(donationType=='once'){$('.fldOneTimeDonationAmount',page).show();removeRecurringFields(page);setItemNumber(page,'MBDonation');$('#oneTimeDescription').show();}
else if(donationType=='yearly'){$('.fldOneTimeDonationAmount',page).hide();addRecurringFields('Y',page);setItemNumber(page,'MBSClubYearly');$('#oneTimeDescription').hide();}
else if(donationType=='monthly'){$('.fldOneTimeDonationAmount',page).hide();addRecurringFields('M',page);setItemNumber(page,'MBSClubMonthly');$('#oneTimeDescription').hide();}
else if(donationType=='daily'){$('.fldOneTimeDonationAmount',page).hide();addRecurringFields('D',page);setItemNumber(page,'MBSClubDaily');$('#oneTimeDescription').hide();}
else{$('.fldOneTimeDonationAmount',page).hide();removeRecurringFields(page);setItemNumber(page,'MBSupporter');$('#oneTimeDescription').hide();}});$('#selectOneTimeDonationAmount',page).on('change',function(){updateSavedDonationAmount(page);});}).on('pageshow',"#supporterPage",function(){var page=this;$('.lifetimeAmount',page).html('$'+lifeTimeAmount);$('.monthlyAmount',page).html('$'+monthlyAmount);$('.dailyAmount',page).html('$'+dailyAmount);$('.yearlyAmount',page).html('$'+yearlyAmount);$('#paypalReturnUrl',page).val(ApiClient.getUrl("supporterkey.html"));$('.radioDonationType',page).trigger('change');$('.benefits',page).html(Globalize.translate('HeaderSupporterBenefit','<a href="http://emby.media/donate" target="_blank">','</a>')).trigger('create');loadUserInfo(page);});window.SupporterPage={onSubmit:function(){var form=this;var page=$(form).parents('.page');if($('.hfIsActive',page).val()=='true'){var currentPlanType=$('.hfPlanType',page).val();if(currentPlanType!='Lifetime'){alert(Globalize.translate('MessageChangeRecurringPlanConfirm'));}}}};})();(function(){function cancelJob(page,id){$('.jobMenu',page).on("popupafterclose.deleteuser",function(){$(this).off('popupafterclose.deleteuser');var msg=Globalize.translate('CancelSyncJobConfirmation');Dashboard.confirm(msg,Globalize.translate('HeaderCancelSyncJob'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.ajax({url:ApiClient.getUrl('Sync/Jobs/'+id),type:'DELETE'}).done(function(){reloadData(page);});}});}).popup('close');}
function getSyncJobHtml(page,job,cardBoxCssClass,syncJobPage){var html='';html+="<div class='card squareCard' data-id='"+job.Id+"' data-status='"+job.Status+"'>";html+='<div class="'+cardBoxCssClass+'">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';syncJobPage+='?id='+job.Id;html+='<a class="cardContent" href="'+syncJobPage+'">';var imgUrl;var style='';if(job.PrimaryImageItemId){imgUrl=ApiClient.getScaledImageUrl(job.PrimaryImageItemId,{type:"Primary",width:400,tag:job.PrimaryImageTag});style="background-position:center center;";}else{style="background-color:#38c;background-position:center center;";imgUrl="css/images/items/detail/video.png";}
html+='<div class="cardImage coveredCardImage lazy" data-src="'+imgUrl+'" style="'+style+'">';if(job.Progress&&job.Progress<100){html+='<div class="cardFooter">';html+="<div class='cardText cardProgress'>";html+='<progress class="itemProgressBar" min="0" max="100" value="'+job.Progress+'"></progress>';html+="</div>";html+="</div>";}
html+="</div>";var opacity='.85';var background='rgba(204,51,51,'+opacity+')';var text=Globalize.translate('SyncJobStatus'+job.Status);if(job.Status=='Completed'){background='rgba(82, 181, 75, '+opacity+')';}
else if(job.Status=='CompletedWithError'){}
else if(job.Status=='Queued'){background='rgba(51, 136, 204, '+opacity+')';}
else if(job.Status=='ReadyToTransfer'){background='rgba(51, 136, 204, '+opacity+')';}
else if(job.Status=='Transferring'){background='rgba(72, 0, 255, '+opacity+')';}
else if(job.Status=='Converting'){background='rgba(255, 106, 0, '+opacity+')';}
html+='<div class="syncStatusBanner" style="background-color:'+background+';position:absolute;top:0;right:0;padding:.5em .5em; text-align:left;color: #fff; font-weight: 500; text-transform:uppercase; border-bottom-left-radius: 3px;">';html+=text;html+='</div>';html+="</a>";html+="</div>";html+='<div class="cardFooter">';var textLines=[];if(job.ParentName){textLines.push(job.ParentName);}
textLines.push(job.Name);if(job.ItemCount==1){textLines.push(Globalize.translate('ValueItemCount',job.ItemCount));}else{textLines.push(Globalize.translate('ValueItemCountPlural',job.ItemCount));}
if(!job.ParentName){textLines.push('&nbsp;');}
html+='<div class="cardText" style="text-align:right; position:absolute; bottom:5px; right: 5px;">';html+='<button class="btnJobMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 0 0 0;"></button>';html+="</div>";for(var i=0,length=textLines.length;i<length;i++){html+="<div class='cardText' style='margin-right:30px;'>";html+=textLines[i];html+="</div>";}
html+="</div>";html+="</div>";html+="</div>";return html;}
function loadData(page,jobs){var html='';var lastTargetName='';var cardBoxCssClass='cardBox visualCardBox';var syncJobPage='syncjob.html';if($(page).hasClass('mySyncPage')){syncJobPage='mysyncjob.html';}
for(var i=0,length=jobs.length;i<length;i++){var job=jobs[i];var targetName=job.TargetName||'Unknown';if(targetName!=lastTargetName){if(lastTargetName){html+='<br/>';html+='<br/>';html+='<br/>';}
lastTargetName=targetName;html+='<div class="detailSectionHeader">';html+='<div style="display:inline-block;vertical-align:middle;">'+targetName+'</div>';html+='</div>';}
html+=getSyncJobHtml(page,job,cardBoxCssClass,syncJobPage);}
var elem=$('.syncActivity',page).html(html).trigger('create');$(".lazy",elem).unveil(200);$('.btnJobMenu',elem).on('click',function(){showJobMenu(this);});if(!jobs.length){elem.html('<div style="padding:1em .25em;">'+Globalize.translate('MessageNoSyncJobsFound')+'</div>');}}
function showJobMenu(elem){var card=$(elem).parents('.card');var page=$(elem).parents('.page');var id=card.attr('data-id');var status=card.attr('data-status');$('.jobMenu',page).popup("close").remove();var html='<div data-role="popup" class="jobMenu tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';if(status=='Cancelled'){html+='<li data-icon="delete"><a href="#" class="btnCancelJob" data-id="'+id+'">'+Globalize.translate('ButtonDelete')+'</a></li>';}else{html+='<li data-icon="delete"><a href="#" class="btnCancelJob" data-id="'+id+'">'+Globalize.translate('ButtonCancel')+'</a></li>';}
html+='</ul>';html+='</div>';page.append(html);var flyout=$('.jobMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnCancelJob',flyout).on('click',function(){cancelJob(page,this.getAttribute('data-id'));});}
function reloadData(page){Dashboard.showLoadingMsg();var options={};Dashboard.getCurrentUser().done(function(user){if($(page).hasClass('mySyncPage')){options.UserId=Dashboard.getCurrentUserId();}
ApiClient.getJSON(ApiClient.getUrl('Sync/Jobs',options)).done(function(response){loadData(page,response.Items);Dashboard.hideLoadingMsg();});});}
function onWebSocketMessage(e,msg){var page=$.mobile.activePage;if(msg.MessageType=="SyncJobs"){loadData(page,msg.Data);}}
function startListening(page){var startParams="0,1500";if($(page).hasClass('mySyncPage')){startParams+=","+Dashboard.getCurrentUserId();}
if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SyncJobsStart",startParams);}}
function stopListening(){if(ApiClient.isWebSocketOpen()){ApiClient.sendWebSocketMessage("SyncJobsStop","");}}
$(document).on('pageshow',".syncActivityPage",function(){var page=this;Dashboard.getPluginSecurityInfo().done(function(pluginSecurityInfo){if(pluginSecurityInfo.IsMBSupporter){$('.syncPromotion',page).hide();}else{$('.syncPromotion',page).show();}});reloadData(page);$('.btnSync',page).taskButton({mode:'on',progressElem:$('.syncProgress',page),taskKey:'SyncPrepare'});startListening(page);$(ApiClient).on("websocketmessage.syncactivity",onWebSocketMessage);}).on('pagehide',".syncActivityPage",function(){var page=this;$('.btnSync',page).taskButton({mode:'off'});stopListening();$(ApiClient).off(".syncactivity");});})();(function($,document,window){function loadPage(page,config){$('#txtSyncTempPath',page).val(config.TemporaryPath||'');$('#txtUploadSpeedLimit',page).val((config.UploadSpeedLimitBytes/1000000)||'');$('#txtCpuCoreLimit',page).val(config.TranscodingCpuCoreLimit);$('#chkEnableFullSpeedConversion',page).checked(config.EnableFullSpeedTranscoding).checkboxradio('refresh');Dashboard.hideLoadingMsg();}
$(document).on('pageinit',"#syncSettingsPage",function(){var page=this;$('#btnSelectSyncTempPath',page).on("click.selectDirectory",function(){var picker=new DirectoryBrowser(page);picker.show({callback:function(path){if(path){$('#txtSyncTempPath',page).val(path);}
picker.close();}});});}).on('pageshow',"#syncSettingsPage",function(){Dashboard.showLoadingMsg();var page=this;ApiClient.getNamedConfiguration("sync").done(function(config){loadPage(page,config);});});window.SyncSettingsPage={onSubmit:function(){Dashboard.showLoadingMsg();var form=this;ApiClient.getNamedConfiguration("sync").done(function(config){config.TemporaryPath=$('#txtSyncTempPath',form).val();config.UploadSpeedLimitBytes=parseInt(parseFloat(($('#txtUploadSpeedLimit',form).val()||'0'))*1000000);config.TranscodingCpuCoreLimit=parseInt($('#txtCpuCoreLimit',form).val());config.EnableFullSpeedTranscoding=$('#chkEnableFullSpeedConversion',form).checked();ApiClient.updateNamedConfiguration("sync",config).done(Dashboard.processServerConfigurationUpdateResult);});return false;}};})(jQuery,document,window);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Poster','Poster');var query={SortBy:"SeriesSortName,SortName",SortOrder:"Ascending",IncludeItemTypes:"Episode",Recursive:true,Fields:"PrimaryImageAspectRatio,MediaSourceCount,IsUnidentified,UserData,SyncInfo",StartIndex:0,IsMissing:false,IsVirtualUnaired:false,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'episodes'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false,addSelectionButton:true});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls();var trigger=false;if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'tv',sortBy:query.SortBy});trigger=true;}
else if(view=="Poster"){html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,showParentTitle:true,overlayText:true,lazy:true,context:'tv'});}
else if(view=="PosterCard"){html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,showParentTitle:true,lazy:true,context:'tv',cardLayout:true});}
var elem=$('.itemsContainer',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.toLowerCase().indexOf(','+filterName.toLowerCase())!=-1;}).checkboxradio('refresh');$('.chkVideoTypeFilter',page).each(function(){var filters=","+(query.VideoTypes||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#chkHD',page).checked(query.IsHD==true).checkboxradio('refresh');$('#chkSD',page).checked(query.IsHD==false).checkboxradio('refresh');$('#chkSubtitle',page).checked(query.HasSubtitles==true).checkboxradio('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('#chkSpecialFeature',page).checked(query.ParentIndexNumber==0).checkboxradio('refresh');$('#chkMissingEpisode',page).checked(query.IsMissing==true).checkboxradio('refresh');$('#chkFutureEpisode',page).checked(query.IsUnaired==true).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#episodesPage",function(){var page=this;$('.radioSortBy',this).on('click',function(){query.StartIndex=0;query.SortBy=this.getAttribute('data-sortby');reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.StartIndex=0;query.SortOrder=this.getAttribute('data-sortorder');reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.chkVideoTypeFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.VideoTypes||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.VideoTypes=filters;reloadItems(page);});$('#chkSubtitle',this).on('change',function(){query.StartIndex=0;query.HasSubtitles=this.checked?true:null;reloadItems(page);});$('#chkTrailer',this).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',this).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;reloadItems(page);});$('#chkThemeVideo',this).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;reloadItems(page);});$('#chkSpecialFeature',this).on('change',function(){query.ParentIndexNumber=this.checked?0:null;reloadItems(page);});$('#chkMissingEpisode',this).on('change',function(){query.StartIndex=0;query.IsMissing=this.checked?true:false;reloadItems(page);});$('#chkFutureEpisode',this).on('change',function(){query.StartIndex=0;if(this.checked){query.IsUnaired=true;query.IsVirtualUnaired=null;}else{query.IsUnaired=null;query.IsVirtualUnaired=false;}
reloadItems(page);});$('#chkHD',this).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?true:null;reloadItems(page);});$('#chkSD',this).on('change',function(){query.StartIndex=0;query.IsHD=this.checked?false:null;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('.itemsContainer',page).on('needsrefresh',function(){reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;reloadItems(page);LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#episodesPage",function(){var page=this;query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);var filters=getParameterByName('filters');if(filters){query.Filters=filters;}
var sortby=getParameterByName('sortby');if(sortby){query.SortBy=sortby;}
var sortorder=getParameterByName('sortorder');if(sortorder){query.SortOrder=sortorder;}
LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#episodesPage",function(){updateFilterControls(this);});})(jQuery,document);(function(document,$){var currentOwnerId;var currentThemeIds=[];function playThemeSongs(items,ownerId){var player=getPlayer();if(items.length&&player.isDefaultPlayer&&player.canAutoPlayAudio()){if(!currentOwnerId&&player.isPlaying()){return;}
currentThemeIds=items.map(function(i){return i.Id;});currentOwnerId=ownerId;player.play({items:items});}else{currentOwnerId=null;}}
function onPlayItem(item){if(currentThemeIds.indexOf(item.Id)==-1){currentOwnerId=null;}}
function enabled(){var userId=Dashboard.getCurrentUserId();var val=store.getItem('enableThemeSongs-'+userId);return val=='1'||(val!='0'&&!$.browser.mobile);}
function getPlayer(){return MediaController.getCurrentPlayer();}
$(document).on('thememediadownload',".libraryPage",function(e,themeMediaResult){if(!enabled()){return;}
var ownerId=themeMediaResult.ThemeSongsResult.OwnerId;if(ownerId!=currentOwnerId){playThemeSongs(themeMediaResult.ThemeSongsResult.Items,ownerId);}});})(document,jQuery);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Thumb','Thumb');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series",Recursive:true,Fields:"DateCreated,SyncInfo,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'tvgenres'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getGenres(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'tv',showItemCounts:true,centerText:true,lazy:true});}
else if(view=="ThumbCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'tv',showItemCounts:true,cardLayout:true,showTitle:true,lazy:true});}
else if(view=="Poster"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'tv',centerText:true,showItemCounts:true,lazy:true});}
$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});$('.selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');$('#selectView',page).val(view).selectmenu('refresh');}
$(document).on('pageinit',"#tvGenresPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});}).on('pagebeforeshow',"#tvGenresPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewkey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewkey,query);LibraryBrowser.getSavedViewSetting(viewkey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#tvGenresPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){$(document).on('pagebeforeshow',"#tvNextUpPage",function(){var userId=Dashboard.getCurrentUserId();var parentId=LibraryMenu.getTopParentId();var page=this;var options={IncludeItemTypes:"Episode",Limit:30,Fields:"PrimaryImageAspectRatio,SyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getJSON(ApiClient.getUrl('Users/'+userId+'/Items/Latest',options)).done(function(items){$('#latestEpisodes',page).html(LibraryBrowser.getPosterViewHtml({items:items,shape:"backdrop",preferThumb:true,inheritThumb:false,showParentTitle:false,showUnplayedIndicator:false,showChildCountIndicator:true,overlayText:true,lazy:true})).lazyChildren();});});})(jQuery,document);(function($,document){var pageSizeKey='people';var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series,Episode",Recursive:true,Fields:"DateCreated,ItemCounts",PersonTypes:"",StartIndex:0,Limit:100};function getSavedQueryKey(){return'tvpeople'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getPeople(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'tv',showTitle:true,showItemCounts:true,coverImage:true,lazy:true});var elem=$('#items',page).html(html).lazyChildren();$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.chkPersonTypeFilter',page).each(function(){var filters=","+(query.PersonTypes||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWithOrGreater);}
$(document).on('pageinit',"#tvPeoplePage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('.chkPersonTypeFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.PersonTypes||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.PersonTypes=filters;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});}).on('pagebeforeshow',"#tvPeoplePage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize(pageSizeKey,100);if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#tvPeoplePage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){function reload(page){var query={Limit:24,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:Dashboard.getCurrentUserId(),ExcludeLocationTypes:"Virtual",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};query.ParentId=LibraryMenu.getTopParentId();var context='';if(query.ParentId){$('.scopedLibraryViewNav',page).show();$('.globalNav',page).hide();$('.scopedContent',page).show();context='tv';$('.nextUpHeader',page).removeClass('firstListHeader');loadResume(page);}else{$('.scopedLibraryViewNav',page).hide();$('.globalNav',page).show();$('.scopedContent',page).hide();$('.nextUpHeader',page).addClass('firstListHeader');}
loadNextUp(page,context||'home-nextup');}
function loadNextUp(page,context){var query={Limit:24,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:Dashboard.getCurrentUserId(),ExcludeLocationTypes:"Virtual",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};query.ParentId=LibraryMenu.getTopParentId();ApiClient.getNextUpEpisodes(query).done(function(result){if(result.Items.length){$('.noNextUpItems',page).hide();}else{$('.noNextUpItems',page).show();}
$('#nextUpItems',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,showParentTitle:true,overlayText:false,context:context,lazy:true,preferThumb:true})).lazyChildren();});}
function loadResume(page){var parentId=LibraryMenu.getTopParentId();var options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Episode",Filters:"IsResumable",Limit:6,Recursive:true,Fields:"PrimaryImageAspectRatio,SeriesInfo,UserData,SyncInfo",ExcludeLocationTypes:"Virtual",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(Dashboard.getCurrentUserId(),options).done(function(result){if(result.Items.length){$('#resumableSection',page).show();}else{$('#resumableSection',page).hide();$('.nextUpHeader',page).addClass('firstListHeader');}
$('#resumableItems',page).html(LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:true,showParentTitle:true,overlayText:true,lazy:true,context:'tv'})).lazyChildren();});}
$(document).on('pagebeforeshow',"#tvRecommendedPage",function(){var page=this;reload(page);});})(jQuery,document);(function($,document){var view=LibraryBrowser.getDefaultItemsView('Thumb','Thumb');var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series",Recursive:true,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};function getSavedQueryKey(){return'tvshows'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getItems(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';var trigger=false;var pagingHtml=LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false});$('.listTopPaging',page).html(pagingHtml).trigger('create');updateFilterControls(page);if(view=="Thumb"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'tv',lazy:true});}
else if(view=="ThumbCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",preferThumb:true,context:'tv',lazy:true,cardLayout:true,showTitle:true,showSeriesYear:true});}
else if(view=="Banner"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"banner",preferBanner:true,context:'tv',lazy:true});}
else if(view=="List"){html=LibraryBrowser.getListViewHtml({items:result.Items,context:'tv',sortBy:query.SortBy});trigger=true;}
else if(view=="PosterCard"){html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'tv',showTitle:true,showYear:true,lazy:true,cardLayout:true});}
else{html=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"portrait",context:'tv',showTitle:false,centerText:true,lazy:true});}
var elem=$('#items',page).html(html).lazyChildren();if(trigger){elem.trigger('create');}
$(pagingHtml).appendTo(elem).trigger('create');$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.radioSortBy',page).each(function(){this.checked=(query.SortBy||'').toLowerCase()==this.getAttribute('data-sortby').toLowerCase();}).checkboxradio('refresh');$('.radioSortOrder',page).each(function(){this.checked=(query.SortOrder||'').toLowerCase()==this.getAttribute('data-sortorder').toLowerCase();}).checkboxradio('refresh');$('.chkStatus',page).each(function(){var filters=","+(query.SeriesStatus||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('.chkAirDays',page).each(function(){var filters=","+(query.AirDays||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectView',page).val(view).selectmenu('refresh');$('#chkTrailer',page).checked(query.HasTrailer==true).checkboxradio('refresh');$('#chkThemeSong',page).checked(query.HasThemeSong==true).checkboxradio('refresh');$('#chkThemeVideo',page).checked(query.HasThemeVideo==true).checkboxradio('refresh');$('#chkSpecialFeature',page).checked(query.HasSpecialFeature==true).checkboxradio('refresh');$('.alphabetPicker',page).alphaValue(query.NameStartsWith);$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
var filtersLoaded;function reloadFiltersIfNeeded(page){if(!filtersLoaded){filtersLoaded=true;QueryFilters.loadFilters(page,Dashboard.getCurrentUserId(),query,function(){reloadItems(page);});}}
$(document).on('pageinit',"#tvShowsPage",function(){var page=this;$('.viewPanel',page).on('panelopen',function(){reloadFiltersIfNeeded(page);});$('.radioSortBy',this).on('click',function(){query.SortBy=this.getAttribute('data-sortby');query.StartIndex=0;reloadItems(page);});$('.radioSortOrder',this).on('click',function(){query.SortOrder=this.getAttribute('data-sortorder');query.StartIndex=0;reloadItems(page);});$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.Filters=filters;query.StartIndex=0;reloadItems(page);});$('.chkStatus',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.SeriesStatus||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.SeriesStatus=filters;query.StartIndex=0;reloadItems(page);});$('.chkAirDays',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.AirDays||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.AirDays=filters;query.StartIndex=0;reloadItems(page);});$('#selectView',this).on('change',function(){view=this.value;if(view=="Timeline"){query.SortBy="PremiereDate";query.SortOrder="Descending";query.StartIndex=0;$('#radioPremiereDate',page)[0].click();}else{reloadItems(page);}
LibraryBrowser.saveViewSetting(getSavedQueryKey(),view);});$('#chkTrailer',this).on('change',function(){query.StartIndex=0;query.HasTrailer=this.checked?true:null;reloadItems(page);});$('#chkThemeSong',this).on('change',function(){query.StartIndex=0;query.HasThemeSong=this.checked?true:null;reloadItems(page);});$('#chkSpecialFeature',this).on('change',function(){query.StartIndex=0;query.HasSpecialFeature=this.checked?true:null;reloadItems(page);});$('#chkThemeVideo',this).on('change',function(){query.StartIndex=0;query.HasThemeVideo=this.checked?true:null;reloadItems(page);});$('.alphabetPicker',this).on('alphaselect',function(e,character){query.NameStartsWithOrGreater=character;query.StartIndex=0;reloadItems(page);}).on('alphaclear',function(e){query.NameStartsWithOrGreater='';reloadItems(page);});$('#radioBasicFilters',this).on('change',function(){if(this.checked){$('.basicFilters',page).show();$('.advancedFilters',page).hide();}else{$('.basicFilters',page).hide();}});$('#radioAdvancedFilters',this).on('change',function(){if(this.checked){$('.advancedFilters',page).show();$('.basicFilters',page).hide();}else{$('.advancedFilters',page).hide();}});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#tvShowsPage",function(){query.ParentId=LibraryMenu.getTopParentId();var page=this;var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
var viewKey=getSavedQueryKey();LibraryBrowser.loadSavedQueryValues(viewKey,query);QueryFilters.onPageShow(page,query);LibraryBrowser.getSavedViewSetting(viewKey).done(function(val){if(val){$('#selectView',page).val(val).selectmenu('refresh').trigger('change');}else{reloadItems(page);}});}).on('pageshow',"#tvShowsPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){var query={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series",Recursive:true,Fields:"DateCreated,ItemCounts",StartIndex:0};function getSavedQueryKey(){return'tvstudios'+(query.ParentId||'');}
function reloadItems(page){Dashboard.showLoadingMsg();ApiClient.getStudios(Dashboard.getCurrentUserId(),query).done(function(result){$(document).scrollTop(0);var html='';$('.listTopPaging',page).html(LibraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:true,showLimit:false})).trigger('create');updateFilterControls(page);html+=LibraryBrowser.getPosterViewHtml({items:result.Items,shape:"backdrop",showTitle:false,context:'tv',preferThumb:true,showItemCounts:true,centerText:true,lazy:true});$('#items',page).html(html).lazyChildren();$('.btnNextPage',page).on('click',function(){query.StartIndex+=query.Limit;reloadItems(page);});$('.btnPreviousPage',page).on('click',function(){query.StartIndex-=query.Limit;reloadItems(page);});LibraryBrowser.saveQueryValues(getSavedQueryKey(),query);Dashboard.hideLoadingMsg();});}
function updateFilterControls(page){$('.chkStandardFilter',page).each(function(){var filters=","+(query.Filters||"");var filterName=this.getAttribute('data-filter');this.checked=filters.indexOf(','+filterName)!=-1;}).checkboxradio('refresh');$('#selectPageSize',page).val(query.Limit).selectmenu('refresh');}
$(document).on('pageinit',"#tvStudiosPage",function(){var page=this;$('.chkStandardFilter',this).on('change',function(){var filterName=this.getAttribute('data-filter');var filters=query.Filters||"";filters=(','+filters).replace(','+filterName,'').substring(1);if(this.checked){filters=filters?(filters+','+filterName):filterName;}
query.StartIndex=0;query.Filters=filters;reloadItems(page);});$('#selectPageSize',page).on('change',function(){query.Limit=parseInt(this.value);query.StartIndex=0;reloadItems(page);});}).on('pagebeforeshow',"#tvStudiosPage",function(){query.ParentId=LibraryMenu.getTopParentId();var limit=LibraryBrowser.getDefaultPageSize();if(limit!=query.Limit){query.Limit=limit;query.StartIndex=0;}
LibraryBrowser.loadSavedQueryValues(getSavedQueryKey(),query);reloadItems(this);}).on('pageshow',"#tvStudiosPage",function(){updateFilterControls(this);});})(jQuery,document);(function($,document){$(document).on('pagebeforeshow',"#tvUpcomingPage",function(){var page=this;var query={Limit:40,Fields:"AirTime,UserData,SeriesStudio,SyncInfo",UserId:Dashboard.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};query.ParentId=LibraryMenu.getTopParentId();var context='';if(query.ParentId){$('.scopedLibraryViewNav',page).show();$('.globalNav',page).hide();context='tv';}else{$('.scopedLibraryViewNav',page).hide();$('.globalNav',page).show();}
ApiClient.getJSON(ApiClient.getUrl("Shows/Upcoming",query)).done(function(result){var items=result.Items;if(items.length){$('.noItemsMessage',page).hide();}else{$('.noItemsMessage',page).show();}
$('#upcomingItems',page).html(LibraryBrowser.getPosterViewHtml({items:items,showLocationTypeIndicator:false,shape:"backdrop",showTitle:true,showPremiereDate:true,showPremiereDateIndex:true,preferThumb:true,context:context||'home-upcoming',lazy:true,})).lazyChildren();});});})(jQuery,document);(function($,window,document){var currentUser;function loadUser(page,user){currentUser=user;if(user.Policy.IsDisabled){$('.disabledUserBanner',page).show();}else{$('.disabledUserBanner',page).hide();}
if(user.ConnectLinkType=='Guest'){$('#fldConnectInfo',page).hide();$('#txtUserName',page).prop("disabled","disabled");}else{$('#txtUserName',page).prop("disabled","").removeAttr('disabled');$('#fldConnectInfo',page).show();}
$('.lnkEditUserPreferences',page).attr('href','mypreferencesdisplay.html?userId='+user.Id);Dashboard.setPageTitle(user.Name);$('#txtUserName',page).val(user.Name);$('#txtConnectUserName',page).val(currentUser.ConnectUserName);$('#chkIsAdmin',page).checked(user.Policy.IsAdministrator).checkboxradio("refresh");$('#chkDisabled',page).checked(user.Policy.IsDisabled).checkboxradio("refresh");$('#chkIsHidden',page).checked(user.Policy.IsHidden).checkboxradio("refresh");$('#chkRemoteControlSharedDevices',page).checked(user.Policy.EnableSharedDeviceControl).checkboxradio("refresh");$('#chkEnableRemoteControlOtherUsers',page).checked(user.Policy.EnableRemoteControlOfOtherUsers).checkboxradio("refresh");$('#chkEnableDownloading',page).checked(user.Policy.EnableContentDownloading).checkboxradio("refresh");$('#chkManageLiveTv',page).checked(user.Policy.EnableLiveTvManagement).checkboxradio("refresh");$('#chkEnableLiveTvAccess',page).checked(user.Policy.EnableLiveTvAccess).checkboxradio("refresh");$('#chkEnableContentDeletion',page).checked(user.Policy.EnableContentDeletion).checkboxradio("refresh");$('#chkDisableUserPreferences',page).checked((!user.Policy.EnableUserPreferenceAccess)).checkboxradio("refresh");$('#chkEnableMediaPlayback',page).checked(user.Policy.EnableMediaPlayback).checkboxradio("refresh");$('#chkEnableAudioPlaybackTranscoding',page).checked(user.Policy.EnableAudioPlaybackTranscoding).checkboxradio("refresh");$('#chkEnableVideoPlaybackTranscoding',page).checked(user.Policy.EnableVideoPlaybackTranscoding).checkboxradio("refresh");$('#chkEnableSync',page).checked(user.Policy.EnableSync).checkboxradio("refresh");$('#chkEnableSyncTranscoding',page).checked(user.Policy.EnableSyncTranscoding).checkboxradio("refresh");Dashboard.hideLoadingMsg();}
function onSaveComplete(page,user){Dashboard.hideLoadingMsg();var currentConnectUsername=currentUser.ConnectUserName||'';var enteredConnectUsername=$('#txtConnectUserName',page).val();if(currentConnectUsername==enteredConnectUsername){Dashboard.alert(Globalize.translate('SettingsSaved'));}else{ConnectHelper.updateUserInfo(user,$('#txtConnectUserName',page).val(),function(){loadData(page);});}}
function saveUser(user,page){user.Name=$('#txtUserName',page).val();user.Policy.IsAdministrator=$('#chkIsAdmin',page).checked();user.Policy.IsHidden=$('#chkIsHidden',page).checked();user.Policy.IsDisabled=$('#chkDisabled',page).checked();user.Policy.EnableRemoteControlOfOtherUsers=$('#chkEnableRemoteControlOtherUsers',page).checked();user.Policy.EnableLiveTvManagement=$('#chkManageLiveTv',page).checked();user.Policy.EnableLiveTvAccess=$('#chkEnableLiveTvAccess',page).checked();user.Policy.EnableContentDeletion=$('#chkEnableContentDeletion',page).checked();user.Policy.EnableUserPreferenceAccess=!$('#chkDisableUserPreferences',page).checked();user.Policy.EnableSharedDeviceControl=$('#chkRemoteControlSharedDevices',page).checked();user.Policy.EnableMediaPlayback=$('#chkEnableMediaPlayback',page).checked();user.Policy.EnableAudioPlaybackTranscoding=$('#chkEnableAudioPlaybackTranscoding',page).checked();user.Policy.EnableVideoPlaybackTranscoding=$('#chkEnableVideoPlaybackTranscoding',page).checked();user.Policy.EnableContentDownloading=$('#chkEnableDownloading',page).checked();user.Policy.EnableSync=$('#chkEnableSync',page).checked();user.Policy.EnableSyncTranscoding=$('#chkEnableSyncTranscoding',page).checked();ApiClient.updateUser(user).done(function(){ApiClient.updateUserPolicy(user.Id,user.Policy).done(function(){onSaveComplete(page,user);});});}
function editUserPage(){var self=this;self.onSubmit=function(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();getUser().done(function(result){saveUser(result,page);});return false;};}
function getUser(){var userId=getParameterByName("userId");return ApiClient.getUser(userId);}
function loadData(page){Dashboard.showLoadingMsg();getUser().done(function(user){loadUser(page,user);});}
window.EditUserPage=new editUserPage();$(document).on('pagebeforeshow',"#editUserPage",function(){var page=this;loadData(page);});})(jQuery,window,document);(function(){window.ConnectHelper={updateUserInfo:function(user,newConnectUsername,actionCallback,noActionCallback){var currentConnectUsername=user.ConnectUserName||'';var enteredConnectUsername=newConnectUsername;var linkUrl=ApiClient.getUrl('Users/'+user.Id+'/Connect/Link');if(currentConnectUsername&&!enteredConnectUsername){ApiClient.ajax({type:"DELETE",url:linkUrl}).done(function(){Dashboard.alert({message:Globalize.translate('MessageEmbyAccontRemoved'),title:Globalize.translate('HeaderEmbyAccountRemoved'),callback:actionCallback});});}
else if(currentConnectUsername!=enteredConnectUsername){ApiClient.ajax({type:"POST",url:linkUrl,data:{ConnectUsername:enteredConnectUsername},dataType:'json'}).done(function(result){var msgKey=result.IsPending?'MessagePendingEmbyAccountAdded':'MessageEmbyAccountAdded';Dashboard.alert({message:Globalize.translate(msgKey),title:Globalize.translate('HeaderEmbyAccountAdded'),callback:actionCallback});});}else{if(noActionCallback){noActionCallback();}}}};})();(function($,window,document){function loadMediaFolders(page,mediaFolders){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderLibraries')+'</legend>';for(var i=0,length=mediaFolders.length;i<length;i++){var folder=mediaFolders[i];var id='mediaFolder'+i;var checkedAttribute=' checked="checked"';html+='<input class="chkFolder" data-id="'+folder.Id+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+folder.Name+'</label>';}
html+='</fieldset>';$('.folderAccess',page).html(html).trigger('create');$('#chkEnableAllFolders',page).checked(true).checkboxradio('refresh').trigger('change');}
function loadChannels(page,channels){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderChannels')+'</legend>';for(var i=0,length=channels.length;i<length;i++){var folder=channels[i];var id='channels'+i;var checkedAttribute=' checked="checked"';html+='<input class="chkChannel" data-id="'+folder.Id+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+folder.Name+'</label>';}
html+='</fieldset>';$('.channelAccess',page).show().html(html).trigger('create');if(channels.length){$('.channelAccessContainer',page).show();}else{$('.channelAccessContainer',page).hide();}
$('#chkEnableAllChannels',page).checked(true).checkboxradio('refresh').trigger('change');}
function loadUser(page){$('#txtUserName',page).val('');Dashboard.showLoadingMsg();var promise4=ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:false}));var promise5=ApiClient.getJSON(ApiClient.getUrl("Channels"));$.when(promise4,promise5).done(function(response4,response5){loadMediaFolders(page,response4[0].Items);loadChannels(page,response5[0].Items);Dashboard.hideLoadingMsg();});}
function saveUser(page){var name=$('#txtUserName',page).val();ApiClient.createUser(name).done(function(user){user.Policy.EnableAllFolders=$('#chkEnableAllFolders',page).checked();user.Policy.EnabledFolders=user.Policy.EnableAllFolders?[]:$('.chkFolder:checked',page).map(function(){return this.getAttribute('data-id');}).get();user.Policy.EnableAllChannels=$('#chkEnableAllChannels',page).checked();user.Policy.EnabledChannels=user.Policy.EnableAllChannels?[]:$('.chkChannel:checked',page).map(function(){return this.getAttribute('data-id');}).get();ApiClient.updateUserPolicy(user.Id,user.Policy).done(function(){Dashboard.navigate("useredit.html?userId="+user.Id);});});}
function newUserPage(){var self=this;self.onSubmit=function(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();saveUser(page);return false;};}
function loadData(page){loadUser(page);}
window.NewUserPage=new newUserPage();$(document).on('pageinit',"#newUserPage",function(){var page=this;$('#chkEnableAllChannels',page).on('change',function(){if(this.checked){$('.channelAccessListContainer',page).hide();}else{$('.channelAccessListContainer',page).show();}});$('#chkEnableAllFolders',page).on('change',function(){if(this.checked){$('.folderAccessListContainer',page).hide();}else{$('.folderAccessListContainer',page).show();}});}).on('pageshow',"#newUserPage",function(){var page=this;loadData(page);});})(jQuery,window,document);(function($,window,document,FileReader){var currentFile;function reloadUser(page){var userId=getParameterByName("userId");Dashboard.showLoadingMsg();ApiClient.getUser(userId).done(function(user){$('.username',page).html(user.Name);$('#uploadUserImage',page).val('').trigger('change');Dashboard.setPageTitle(user.Name);var imageUrl;if(user.PrimaryImageTag){imageUrl=ApiClient.getUserImageUrl(user.Id,{height:200,tag:user.PrimaryImageTag,type:"Primary"});}else{imageUrl="css/images/logindefault.png";}
$('#fldImage',page).show().html('').html("<img width='140px' src='"+imageUrl+"' />");if(user.ConnectLinkType=='Guest'){$('.newImageForm',page).hide();$('#btnDeleteImage',page).hide();$('.connectMessage',page).show();}
else if(user.PrimaryImageTag){$('#btnDeleteImage',page).show();$('#headerUploadNewImage',page).show();$('.newImageForm',page).show();$('.connectMessage',page).hide();}else{$('.newImageForm',page).show();$('#btnDeleteImage',page).hide();$('#headerUploadNewImage',page).show();$('.connectMessage',page).hide();}
Dashboard.hideLoadingMsg();});}
function processImageChangeResult(){Dashboard.hideLoadingMsg();var page=$.mobile.activePage;reloadUser(page);}
function onFileReaderError(evt){Dashboard.hideLoadingMsg();switch(evt.target.error.code){case evt.target.error.NOT_FOUND_ERR:Dashboard.showError(Globalize.translate('FileNotFound'));break;case evt.target.error.NOT_READABLE_ERR:Dashboard.showError(Globalize.translate('FileReadError'));break;case evt.target.error.ABORT_ERR:break;default:Dashboard.showError(Globalize.translate('FileReadError'));};}
function onFileReaderOnloadStart(evt){$('#fldUpload',$.mobile.activePage).hide();}
function onFileReaderAbort(evt){Dashboard.hideLoadingMsg();Dashboard.showError(Globalize.translate('FileReadCancelled'));}
function setFiles(page,files){var file=files[0];if(!file||!file.type.match('image.*')){$('#userImageOutput',page).html('');$('#fldUpload',page).hide();currentFile=null;return;}
currentFile=file;var reader=new FileReader();reader.onerror=onFileReaderError;reader.onloadstart=onFileReaderOnloadStart;reader.onabort=onFileReaderAbort;reader.onload=(function(theFile){return function(e){var html=['<img style="max-width:500px;max-height:200px;" src="',e.target.result,'" title="',escape(theFile.name),'"/>'].join('');$('#userImageOutput',page).html(html);$('#fldUpload',page).show();};})(file);reader.readAsDataURL(file);}
function onImageDrop(e){e.preventDefault();setFiles($.mobile.activePage,e.originalEvent.dataTransfer.files);return false;}
function onImageDragOver(e){e.preventDefault();e.originalEvent.dataTransfer.dropEffect='Copy';return false;}
function myProfilePage(){var self=this;self.onImageSubmit=function(){var file=currentFile;if(!file){return false;}
if(file.type!="image/png"&&file.type!="image/jpeg"&&file.type!="image/jpeg"){return false;}
Dashboard.showLoadingMsg();var userId=getParameterByName("userId");ApiClient.uploadUserImage(userId,'Primary',file).done(processImageChangeResult);return false;};self.onFileUploadChange=function(fileUpload){setFiles($.mobile.activePage,fileUpload.files);};}
window.MyProfilePage=new myProfilePage();$(document).on('pageinit',"#userImagePage",function(){var page=this;reloadUser(page);$("#userImageDropZone",page).on('dragover',onImageDragOver).on('drop',onImageDrop);$('#btnDeleteImage',page).on('click',function(){Dashboard.confirm(Globalize.translate('DeleteImageConfirmation'),Globalize.translate('DeleteImage'),function(result){if(result){Dashboard.showLoadingMsg();var userId=getParameterByName("userId");ApiClient.deleteUserImage(userId,"primary").done(processImageChangeResult);}});});});})(jQuery,window,document,window.FileReader);(function($,document,window){function loadUser(page){var userid=getParameterByName("userId");ApiClient.getUser(userid).done(function(user){Dashboard.setPageTitle(user.Name);if(user.ConnectLinkType=='Guest'){$('.localAccessSection',page).hide();$('.passwordSection',page).hide();}
else if(user.HasConfiguredPassword){$('#btnResetPassword',page).show();$('#fldCurrentPassword',page).show();$('.localAccessSection',page).show();$('.passwordSection',page).show();}else{$('#btnResetPassword',page).hide();$('#fldCurrentPassword',page).hide();$('.localAccessSection',page).hide();$('.passwordSection',page).show();}
if(user.HasConfiguredEasyPassword){$('#txtEasyPassword',page).val('').attr('placeholder','******');$('#btnResetEasyPassword',page).show();}else{$('#txtEasyPassword',page).val('').attr('placeholder','');$('#btnResetEasyPassword',page).hide();}
$('#chkEnableLocalEasyPassword',page).checked(user.Configuration.EnableLocalPassword).checkboxradio('refresh');});$('#txtCurrentPassword',page).val('');$('#txtNewPassword',page).val('');$('#txtNewPasswordConfirm',page).val('');}
function saveEasyPassword(page){var userId=getParameterByName("userId");var easyPassword=$('#txtEasyPassword',page).val();if(easyPassword){ApiClient.updateEasyPassword(userId,easyPassword).done(function(){onEasyPasswordSaved(page,userId);});}else{onEasyPasswordSaved(page,userId);}}
function onEasyPasswordSaved(page,userId){ApiClient.getUser(userId).done(function(user){user.Configuration.EnableLocalPassword=$('#chkEnableLocalEasyPassword',page).checked();ApiClient.updateUserConfiguration(user.Id,user.Configuration).done(function(){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('MessageSettingsSaved'));loadUser(page);});});}
function savePassword(page){var userId=getParameterByName("userId");var currentPassword=$('#txtCurrentPassword',page).val();var newPassword=$('#txtNewPassword',page).val();ApiClient.updateUserPassword(userId,currentPassword,newPassword).done(function(){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('PasswordSaved'));loadUser(page);});}
function updatePasswordPage(){var self=this;self.onSubmit=function(){var page=$.mobile.activePage;if($('#txtNewPassword',page).val()!=$('#txtNewPasswordConfirm',page).val()){Dashboard.showError(Globalize.translate('PasswordMatchError'));}else{Dashboard.showLoadingMsg();savePassword(page);}
return false;};self.onLocalAccessSubmit=function(){var page=$.mobile.activePage;Dashboard.showLoadingMsg();saveEasyPassword(page);return false;};self.resetPassword=function(){var msg=Globalize.translate('PasswordResetConfirmation');var page=$.mobile.activePage;Dashboard.confirm(msg,Globalize.translate('PasswordResetHeader'),function(result){if(result){var userId=getParameterByName("userId");Dashboard.showLoadingMsg();ApiClient.resetUserPassword(userId).done(function(){Dashboard.hideLoadingMsg();Dashboard.alert({message:Globalize.translate('PasswordResetComplete'),title:Globalize.translate('PasswordResetHeader')});loadUser(page);});}});};self.resetEasyPassword=function(){var msg=Globalize.translate('PinCodeResetConfirmation');var page=$.mobile.activePage;Dashboard.confirm(msg,Globalize.translate('HeaderPinCodeReset'),function(result){if(result){var userId=getParameterByName("userId");Dashboard.showLoadingMsg();ApiClient.resetEasyPassword(userId).done(function(){Dashboard.hideLoadingMsg();Dashboard.alert({message:Globalize.translate('PinCodeResetComplete'),title:Globalize.translate('HeaderPinCodeReset')});loadUser(page);});}});};}
window.UpdatePasswordPage=new updatePasswordPage();$(document).on('pageshow',".userPasswordPage",function(){var page=this;loadUser(page);});})(jQuery,document,window);(function($,window,document){function loadUser(page,user){Dashboard.setPageTitle(user.Name);if(user.ConnectLinkType=='Guest'){$('.connectMessage',page).show();}
else{$('.connectMessage',page).hide();}
Dashboard.hideLoadingMsg();}
function loadData(page){Dashboard.showLoadingMsg();var userId=getParameterByName("userId");ApiClient.getUser(userId).done(function(user){loadUser(page,user);});}
$(document).on('pagebeforeshow',"#userPasswordPage",function(){var page=this;loadData(page);});})(jQuery,window,document);(function(document,window,$){function renderLibrarySharingList(page,result){var folderHtml='';folderHtml+='<div data-role="controlgroup">';folderHtml+=result.Items.map(function(i){var currentHtml='';var id='chkShareFolder'+i.Id;currentHtml+='<label for="'+id+'">'+i.Name+'</label>';var isChecked=true;var checkedHtml=isChecked?' checked="checked"':'';currentHtml+='<input data-mini="true" class="chkShareFolder" data-folderid="'+i.Id+'" type="checkbox" id="'+id+'"'+checkedHtml+' />';return currentHtml;}).join('');folderHtml+='</div>';$('.librarySharingList',page).html(folderHtml).trigger('create');}
function deleteUser(page,id){$('.userMenu',page).on("popupafterclose.deleteuser",function(){$(this).off('popupafterclose.deleteuser');var msg=Globalize.translate('DeleteUserConfirmation');Dashboard.confirm(msg,Globalize.translate('DeleteUser'),function(result){if(result){Dashboard.showLoadingMsg();ApiClient.deleteUser(id).done(function(){loadData(page);});}});}).popup('close');}
function showUserMenu(elem){var card=$(elem).parents('.card');var page=$(elem).parents('.page');var userId=card.attr('data-userid');$('.userMenu',page).popup("close").remove();var html='<div data-role="popup" class="userMenu tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';html+='<li><a href="useredit.html?userid='+userId+'">'+Globalize.translate('ButtonOpen')+'</a></li>';html+='<li><a href="userlibraryaccess.html?userid='+userId+'">'+Globalize.translate('ButtonLibraryAccess')+'</a></li>';html+='<li><a href="userparentalcontrol.html?userid='+userId+'">'+Globalize.translate('ButtonParentalControl')+'</a></li>';html+='<li><a href="#" class="btnDeleteUser" data-userid="'+userId+'">'+Globalize.translate('ButtonDelete')+'</a></li>';html+='</ul>';html+='</div>';page.append(html);var flyout=$('.userMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnDeleteUser',flyout).on('click',function(){deleteUser(page,this.getAttribute('data-userid'));});}
function getUserHtml(user,addConnectIndicator){var html='';var cssClass="card squareCard alternateHover bottomPaddedCard";if(user.Policy.IsDisabled){cssClass+=' grayscale';}
html+="<div data-userid='"+user.Id+"' class='"+cssClass+"'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var href="useredit.html?userId="+user.Id+"";html+='<a class="cardContent" href="'+href+'">';var imgUrl;if(user.PrimaryImageTag){imgUrl=ApiClient.getUserImageUrl(user.Id,{width:300,tag:user.PrimaryImageTag,type:"Primary"});}else{imgUrl='css/images/userflyoutdefault.png';}
var imageClass='cardImage';if(user.Policy.IsDisabled){imageClass+=' disabledUser';}
html+='<div class="'+imageClass+'" style="background-image:url(\''+imgUrl+'\');">';if(user.ConnectUserId&&addConnectIndicator){html+='<div class="playedIndicator" title="'+Globalize.translate('TooltipLinkedToEmbyConnect')+'"><div class="ui-icon-cloud ui-btn-icon-notext"></div></div>';}
html+="</div>";html+="</a>";html+="</div>";html+='<div class="cardFooter">';html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="btnUserMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 2px 0 0;"></button>';html+="</div>";html+='<div class="cardText" style="margin-right: 30px; padding: 11px 0 10px;">';html+=user.Name;html+="</div>";html+="</div>";html+="</div>";html+="</div>";return html;}
function getUserSectionHtml(users,addConnectIndicator){var html='';html+=users.map(function(u){return getUserHtml(u,addConnectIndicator);}).join('');return html;}
function renderUsersIntoElement(elem,users,addConnectIndicator){var html=getUserSectionHtml(users,addConnectIndicator);elem.html(html).trigger('create');$('.btnUserMenu',elem).on('click',function(){showUserMenu(this);});}
function renderUsers(page,users){renderUsersIntoElement($('.localUsers',page),users.filter(function(u){return u.ConnectLinkType!='Guest';}),true);renderUsersIntoElement($('.connectUsers',page),users.filter(function(u){return u.ConnectLinkType=='Guest';}));}
function showPendingUserMenu(elem){var card=$(elem).parents('.card');var page=$(elem).parents('.page');var id=card.attr('data-id');$('.userMenu',page).popup("close").remove();var html='<div data-role="popup" class="userMenu tapHoldMenu" data-theme="a">';html+='<ul data-role="listview" style="min-width: 180px;">';html+='<li data-role="list-divider">'+Globalize.translate('HeaderMenu')+'</li>';html+='<li><a href="#" class="btnDelete" data-id="'+id+'">'+Globalize.translate('ButtonCancel')+'</a></li>';html+='</ul>';html+='</div>';page.append(html);var flyout=$('.userMenu',page).popup({positionTo:elem||"window"}).trigger('create').popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove();});$('.btnDelete',flyout).on('click',function(){cancelAuthorization(page,this.getAttribute('data-id'));$('.userMenu',page).popup("close").remove();});}
function getPendingUserHtml(user){var html='';var cssClass="card squareCard alternateHover bottomPaddedCard";html+="<div data-id='"+user.Id+"' class='"+cssClass+"'>";html+='<div class="cardBox visualCardBox">';html+='<div class="cardScalable">';html+='<div class="cardPadder"></div>';var href="#";html+='<a class="cardContent" href="'+href+'">';var imgUrl=user.ImageUrl||'css/images/userflyoutdefault.png';html+='<div class="cardImage" style="background-image:url(\''+imgUrl+'\');">';html+="</div>";html+="</a>";html+="</div>";html+='<div class="cardFooter">';html+='<div class="cardText" style="text-align:right; float:right;">';html+='<button class="btnUserMenu" type="button" data-inline="true" data-iconpos="notext" data-icon="ellipsis-v" style="margin: 2px 0 0;"></button>';html+="</div>";html+='<div class="cardText" style="margin-right: 30px; padding: 11px 0 10px;">';html+=user.UserName;html+="</div>";html+="</div>";html+="</div>";html+="</div>";return html;}
function renderPendingGuests(page,users){if(users.length){$('.sectionPendingGuests',page).show();}else{$('.sectionPendingGuests',page).hide();}
var html=users.map(getPendingUserHtml).join('');var elem=$('.pending',page).html(html).trigger('create');$('.btnUserMenu',elem).on('click',function(){showPendingUserMenu(this);});}
function cancelAuthorization(page,id){Dashboard.showLoadingMsg();ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl('Connect/Pending',{Id:id})}).done(function(){loadData(page);});}
function loadData(page){Dashboard.showLoadingMsg();ApiClient.getUsers().done(function(users){renderUsers(page,users);Dashboard.hideLoadingMsg();});ApiClient.getJSON(ApiClient.getUrl('Connect/Pending')).done(function(pending){renderPendingGuests(page,pending);});ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:false})).done(function(result){renderLibrarySharingList(page,result);});}
function inviteUser(page){Dashboard.showLoadingMsg();ApiClient.getJSON(ApiClient.getUrl("Channels",{})).done(function(channelsResult){var shareExcludes=$(".chkShareFolder:checked",page).get().map(function(i){return i.getAttribute('data-folderid');});ApiClient.ajax({type:"POST",url:ApiClient.getUrl('Connect/Invite'),dataType:'json',data:{ConnectUsername:$('#txtConnectUsername',page).val(),EnabledLibraries:shareExcludes.join(','),SendingUserId:Dashboard.getCurrentUserId(),EnableLiveTv:false}}).done(function(result){$('#popupInvite').popup('close');Dashboard.hideLoadingMsg();showNewUserInviteMessage(page,result);});});}
function showNewUserInviteMessage(page,result){if(!result.IsNewUserInvitation&&!result.IsPending){loadData(page);return;}
var message=result.IsNewUserInvitation?Globalize.translate('MessageInvitationSentToNewUser',result.GuestDisplayName):Globalize.translate('MessageInvitationSentToUser',result.GuestDisplayName);setTimeout(function(){Dashboard.alert({message:message,title:Globalize.translate('HeaderInvitationSent'),callback:function(){loadData(page);}});},300);}
function showInvitePopup(page){Dashboard.getCurrentUser().done(function(user){if(user.ConnectUserId){$('#popupInvite',page).popup('open');$('#txtConnectUsername',page).val('');}else{var msg=Globalize.translate('MessageConnectAccountRequiredToInviteGuest');msg+='<br/>';msg+='<br/>';msg+='<a href="useredit.html?userId='+user.Id+'">'+Globalize.translate('ButtonLinkMyEmbyAccount')+'</a>';msg+='<br/>';Dashboard.alert({message:msg,title:Globalize.translate('HeaderInviteGuest')});}});}
$(document).on('pageinit',"#userProfilesPage",function(){var page=this;$('.btnInvite',page).on('click',function(){showInvitePopup(page);});}).on('pagebeforeshow',"#userProfilesPage",function(){var page=this;loadData(page);});window.UserProfilesPage={onSubmit:function(){var form=this;var page=$(form).parents('.page');inviteUser(page);return false;}};})(document,window,jQuery);(function($,window,document){function populateRatings(allParentalRatings,page){var html="";html+="<option value=''></option>";var ratings=[];var i,length,rating;for(i=0,length=allParentalRatings.length;i<length;i++){rating=allParentalRatings[i];if(ratings.length){var lastRating=ratings[ratings.length-1];if(lastRating.Value===rating.Value){lastRating.Name+="/"+rating.Name;continue;}}
ratings.push({Name:rating.Name,Value:rating.Value});}
for(i=0,length=ratings.length;i<length;i++){rating=ratings[i];html+="<option value='"+rating.Value+"'>"+rating.Name+"</option>";}
$('#selectMaxParentalRating',page).html(html).selectmenu("refresh");}
function loadUnratedItems(page,user){var items=[{name:Globalize.translate('OptionBlockBooks'),value:'Book'},{name:Globalize.translate('OptionBlockGames'),value:'Game'},{name:Globalize.translate('OptionBlockChannelContent'),value:'ChannelContent'},{name:Globalize.translate('OptionBlockLiveTvChannels'),value:'LiveTvChannel'},{name:Globalize.translate('OptionBlockLiveTvPrograms'),value:'LiveTvProgram'},{name:Globalize.translate('OptionBlockMovies'),value:'Movie'},{name:Globalize.translate('OptionBlockMusic'),value:'Music'},{name:Globalize.translate('OptionBlockTrailers'),value:'Trailer'},{name:Globalize.translate('OptionBlockTvShows'),value:'Series'},{name:Globalize.translate('OptionBlockOthers'),value:'Other'}];var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderBlockItemsWithNoRating')+'</legend>';for(var i=0,length=items.length;i<length;i++){var item=items[i];var id='unratedItem'+i;var checkedAttribute=user.Policy.BlockUnratedItems.indexOf(item.value)!=-1?' checked="checked"':'';html+='<input class="chkUnratedItem" data-itemtype="'+item.value+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+item.name+'</label>';}
html+='</fieldset>';$('.blockUnratedItems',page).html(html).trigger('create');}
function loadUser(page,user,allParentalRatings){Dashboard.setPageTitle(user.Name);loadUnratedItems(page,user);loadBlockedTags(page,user.Policy.BlockedTags);populateRatings(allParentalRatings,page);var ratingValue="";if(user.Policy.MaxParentalRating){for(var i=0,length=allParentalRatings.length;i<length;i++){var rating=allParentalRatings[i];if(user.Policy.MaxParentalRating>=rating.Value){ratingValue=rating.Value;}}}
$('#selectMaxParentalRating',page).val(ratingValue).selectmenu("refresh");if(user.Policy.IsAdministrator){$('.accessScheduleSection',page).hide();}else{$('.accessScheduleSection',page).show();}
renderAccessSchedule(page,user.Policy.AccessSchedules||[]);Dashboard.hideLoadingMsg();}
function loadBlockedTags(page,tags){var html='<ul data-role="listview" data-inset="true" data-split-icon="delete">'+tags.map(function(h){var li='<li>';li+='<a href="#">';li+='<div style="font-weight:normal;">'+h+'</div>';li+='</a>';li+='<a class="blockedTag btnDeleteTag" href="#" data-tag="'+h+'"></a>';li+='</li>';return li;}).join('')+'</ul>';var elem=$('.blockedTags',page).html(html).trigger('create');$('.btnDeleteTag',elem).on('click',function(){var tag=this.getAttribute('data-tag');var newTags=tags.filter(function(t){return t!=tag;});loadBlockedTags(page,newTags);});}
function deleteAccessSchedule(page,schedules,index){schedules.splice(index,1);renderAccessSchedule(page,schedules);}
function renderAccessSchedule(page,schedules){var html='<ul data-role="listview" data-inset="true" data-split-icon="minus">';var index=0;html+=schedules.map(function(a){var itemHtml='';itemHtml+='<li class="liSchedule" data-day="'+a.DayOfWeek+'" data-start="'+a.StartHour+'" data-end="'+a.EndHour+'">';itemHtml+='<a href="#">';itemHtml+='<h3>'+Globalize.translate('Option'+a.DayOfWeek)+'</h3>';itemHtml+='<p>'+getDisplayTime(a.StartHour)+' - '+getDisplayTime(a.EndHour)+'</p>';itemHtml+='</a>';itemHtml+='<a href="#" data-icon="delete" class="btnDelete" data-index="'+index+'">';itemHtml+='</a>';itemHtml+='</li>';index++;return itemHtml;}).join('');html+='</ul>';var elem=$('.accessScheduleList',page).html(html).trigger('create');$('.btnDelete',elem).on('click',function(){deleteAccessSchedule(page,schedules,parseInt(this.getAttribute('data-index')));});}
function onSaveComplete(page){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('SettingsSaved'));}
function saveUser(user,page){user.Policy.MaxParentalRating=$('#selectMaxParentalRating',page).val()||null;user.Policy.BlockUnratedItems=$('.chkUnratedItem:checked',page).map(function(){return this.getAttribute('data-itemtype');}).get();user.Policy.AccessSchedules=getSchedulesFromPage(page);user.Policy.BlockedTags=getBlockedTagsFromPage(page);ApiClient.updateUserPolicy(user.Id,user.Policy).done(function(){onSaveComplete(page);});}
window.UserParentalControlPage={onSubmit:function(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();var userId=getParameterByName("userId");ApiClient.getUser(userId).done(function(result){saveUser(result,page);});return false;},onScheduleFormSubmit:function(){var page=$(this).parents('.page');saveSchedule(page);return false;},onBlockedTagFormSubmit:function(){var page=$(this).parents('.page');saveBlockedTag(page);return false;}};function getDisplayTime(hours){var minutes=0;var pct=hours%1;if(pct){minutes=parseInt(pct*60);}
return new Date(2000,1,1,hours,minutes,0,0).toLocaleTimeString();}
function populateHours(page){var html='';for(var i=0;i<24;i++){html+='<option value="'+i+'">'+getDisplayTime(i)+'</option>';}
html+='<option value="24">'+getDisplayTime(0)+'</option>';$('#selectStart',page).html(html).selectmenu('refresh');$('#selectEnd',page).html(html).selectmenu('refresh');}
function showSchedulePopup(page,schedule,index){schedule=schedule||{};$('#popupSchedule',page).popup('open');$('#fldScheduleIndex',page).val(index);$('#selectDay',page).val(schedule.DayOfWeek||'Sunday').selectmenu('refresh');$('#selectStart',page).val(schedule.StartHour||0).selectmenu('refresh');$('#selectEnd',page).val(schedule.EndHour||0).selectmenu('refresh');}
function saveSchedule(page){var schedule={DayOfWeek:$('#selectDay',page).val(),StartHour:$('#selectStart',page).val(),EndHour:$('#selectEnd',page).val()};if(parseFloat(schedule.StartHour)>=parseFloat(schedule.EndHour)){alert(Globalize.translate('ErrorMessageStartHourGreaterThanEnd'));return;}
var schedules=getSchedulesFromPage(page);var index=parseInt($('#fldScheduleIndex',page).val());if(index==-1){index=schedules.length;}
schedules[index]=schedule;renderAccessSchedule(page,schedules);$('#popupSchedule',page).popup('close');}
function saveBlockedTag(page){var tag=$('#txtBlockedTag',page).val();var tags=getBlockedTagsFromPage(page);if(tags.indexOf(tag)==-1){tags.push(tag);loadBlockedTags(page,tags);}
$('#popupBlockedTag',page).popup('close');}
function getSchedulesFromPage(page){return $('.liSchedule',page).map(function(){return{DayOfWeek:this.getAttribute('data-day'),StartHour:this.getAttribute('data-start'),EndHour:this.getAttribute('data-end')};}).get();}
function getBlockedTagsFromPage(page){return $('.blockedTag',page).map(function(){return this.getAttribute('data-tag');}).get();}
function showBlockedTagPopup(page){$('#popupBlockedTag',page).popup('open');$('#txtBlockedTag',page).val('').focus();}
$(document).on('pageinit',"#userParentalControlPage",function(){var page=this;$('.btnAddSchedule',page).on('click',function(){showSchedulePopup(page,{},-1);});$('.btnAddBlockedTag',page).on('click',function(){showBlockedTagPopup(page);});populateHours(page);}).on('pageshow',"#userParentalControlPage",function(){var page=this;Dashboard.showLoadingMsg();var userId=getParameterByName("userId");var promise1;if(!userId){var deferred=$.Deferred();deferred.resolveWith(null,[{Configuration:{}}]);promise1=deferred.promise();}else{promise1=ApiClient.getUser(userId);}
var promise2=ApiClient.getParentalRatings();$.when(promise1,promise2).done(function(response1,response2){loadUser(page,response1[0]||response1,response2[0]);});});})(jQuery,window,document);(function($,window,document){function loadMediaFolders(page,user,mediaFolders){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderLibraries')+'</legend>';for(var i=0,length=mediaFolders.length;i<length;i++){var folder=mediaFolders[i];var id='mediaFolder'+i;var isChecked=user.Policy.EnableAllFolders||user.Policy.EnabledFolders.indexOf(folder.Id)!=-1;var checkedAttribute=isChecked?' checked="checked"':'';html+='<input class="chkFolder" data-id="'+folder.Id+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+folder.Name+'</label>';}
html+='</fieldset>';$('.folderAccess',page).html(html).trigger('create');$('#chkEnableAllFolders',page).checked(user.Policy.EnableAllFolders).checkboxradio('refresh').trigger('change');}
function loadChannels(page,user,channels){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderChannels')+'</legend>';for(var i=0,length=channels.length;i<length;i++){var folder=channels[i];var id='channels'+i;var isChecked=user.Policy.EnableAllChannels||user.Policy.EnabledChannels.indexOf(folder.Id)!=-1;var checkedAttribute=isChecked?' checked="checked"':'';html+='<input class="chkChannel" data-id="'+folder.Id+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+folder.Name+'</label>';}
html+='</fieldset>';$('.channelAccess',page).show().html(html).trigger('create');if(channels.length){$('.channelAccessContainer',page).show();}else{$('.channelAccessContainer',page).hide();}
$('#chkEnableAllChannels',page).checked(user.Policy.EnableAllChannels).checkboxradio('refresh').trigger('change');}
function loadDevices(page,user,devices){var html='';html+='<fieldset data-role="controlgroup">';html+='<legend>'+Globalize.translate('HeaderDevices')+'</legend>';for(var i=0,length=devices.length;i<length;i++){var device=devices[i];var id='device'+i;var checkedAttribute=user.Policy.EnableAllDevices||user.Policy.EnabledDevices.indexOf(device.Id)!=-1?' checked="checked"':'';html+='<input class="chkDevice" data-id="'+device.Id+'" type="checkbox" id="'+id+'"'+checkedAttribute+' />';html+='<label for="'+id+'">'+device.Name;html+='<br/><span style="font-weight:normal;font-size: 90%;">'+device.AppName+'</span>';html+='</label>';}
html+='</fieldset>';$('.deviceAccess',page).show().html(html).trigger('create');$('#chkEnableAllDevices',page).checked(user.Policy.EnableAllDevices).checkboxradio('refresh').trigger('change');}
function loadUser(page,user,loggedInUser,mediaFolders,channels,devices){$(page).trigger('userloaded',[user]);Dashboard.setPageTitle(user.Name);loadChannels(page,user,channels);loadMediaFolders(page,user,mediaFolders);loadDevices(page,user,devices);Dashboard.hideLoadingMsg();}
function onSaveComplete(page){Dashboard.hideLoadingMsg();Dashboard.alert(Globalize.translate('SettingsSaved'));}
function saveUser(user,page){user.Policy.EnableAllFolders=$('#chkEnableAllFolders',page).checked();user.Policy.EnabledFolders=user.Policy.EnableAllFolders?[]:$('.chkFolder:checked',page).map(function(){return this.getAttribute('data-id');}).get();user.Policy.EnableAllChannels=$('#chkEnableAllChannels',page).checked();user.Policy.EnabledChannels=user.Policy.EnableAllChannels?[]:$('.chkChannel:checked',page).map(function(){return this.getAttribute('data-id');}).get();user.Policy.EnableAllDevices=$('#chkEnableAllDevices',page).checked();user.Policy.EnabledDevices=user.Policy.EnableAllDevices?[]:$('.chkDevice:checked',page).map(function(){return this.getAttribute('data-id');}).get();ApiClient.updateUserPolicy(user.Id,user.Policy).done(function(){onSaveComplete(page);});}
window.LibraryAccessPage={onSubmit:function(){var page=$(this).parents('.page');Dashboard.showLoadingMsg();var userId=getParameterByName("userId");ApiClient.getUser(userId).done(function(result){saveUser(result,page);});return false;}};$(document).on('pageinit',"#userLibraryAccessPage",function(){var page=this;$('#chkEnableAllDevices',page).on('change',function(){if(this.checked){$('.deviceAccessListContainer',page).hide();}else{$('.deviceAccessListContainer',page).show();}});$('#chkEnableAllChannels',page).on('change',function(){if(this.checked){$('.channelAccessListContainer',page).hide();}else{$('.channelAccessListContainer',page).show();}});$('#chkEnableAllFolders',page).on('change',function(){if(this.checked){$('.folderAccessListContainer',page).hide();}else{$('.folderAccessListContainer',page).show();}});}).on('pageshow',"#userLibraryAccessPage",function(){var page=this;Dashboard.showLoadingMsg();var userId=getParameterByName("userId");var promise1;if(!userId){var deferred=$.Deferred();deferred.resolveWith(null,[{Configuration:{}}]);promise1=deferred.promise();}else{promise1=ApiClient.getUser(userId);}
var promise2=Dashboard.getCurrentUser();var promise4=ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:false}));var promise5=ApiClient.getJSON(ApiClient.getUrl("Channels"));var promise6=ApiClient.getJSON(ApiClient.getUrl('Devices',{SupportsPersistentIdentifier:true}));$.when(promise1,promise2,promise4,promise5,promise6).done(function(response1,response2,response4,response5,response6){loadUser(page,response1[0]||response1,response2[0],response4[0].Items,response5[0].Items,response6[0].Items);});});})(jQuery,window,document);(function(window,$){function onSubmit(page){if($('#chkAccept',page).checked()){Dashboard.navigate('wizardfinish.html');}else{Dashboard.alert({message:Globalize.translate('MessagePleaseAcceptTermsOfServiceBeforeContinuing'),title:''});}}
window.WizardAgreementPage={onSubmit:function(){var page=$(this).parents('.page');onSubmit(page);return false;}};})(window,jQuery);var WizardFinishPage={onFinish:function(){ApiClient.ajax({url:ApiClient.getUrl('Startup/Complete'),type:'POST'}).done(function(){Dashboard.navigate('dashboard.html');});}};(function($,document){$(document).on('pageinit',"#wizardServicePage",function(){var page=this;$('#btnNextPage',page).on('click',function(){Dashboard.navigate('wizardagreement.html');});});})(jQuery,document,window);(function(window,$){function loadPage(page,config,languageOptions){$('#selectLocalizationLanguage',page).html(languageOptions.map(function(l){return'<option value="'+l.Value+'">'+l.Name+'</option>';})).val(config.UICulture).selectmenu('refresh');Dashboard.hideLoadingMsg();}
function save(page){Dashboard.showLoadingMsg();var apiClient=ApiClient;apiClient.getJSON(apiClient.getUrl('Startup/Configuration')).done(function(config){config.UICulture=$('#selectLocalizationLanguage',page).val();apiClient.ajax({type:'POST',data:config,url:apiClient.getUrl('Startup/Configuration')}).done(function(){Dashboard.navigate('wizarduser.html');});});}
$(document).on('pageshow',"#wizardStartPage",function(){Dashboard.showLoadingMsg();var page=this;var apiClient=ApiClient;var promise1=apiClient.getJSON(apiClient.getUrl('Startup/Configuration'));var promise2=apiClient.getJSON(apiClient.getUrl("Localization/Options"));$.when(promise1,promise2).done(function(response1,response2){loadPage(page,response1[0],response2[0]);});});window.WizardStartPage={onSubmit:function(){save($(this).parents('.page'));return false;}};})(window,jQuery);(function($,document){function save(page){Dashboard.showLoadingMsg();var apiClient=ApiClient;apiClient.getJSON(apiClient.getUrl('Startup/Configuration')).done(function(config){config.PreferredMetadataLanguage=$('#selectLanguage',page).val();config.MetadataCountryCode=$('#selectCountry',page).val();config.SaveLocalMeta=$('#chkSaveLocalMetadata',page).checked();config.EnableInternetProviders=$('#chkEnableInternetProviders',page).checked();apiClient.ajax({type:'POST',data:config,url:apiClient.getUrl('Startup/Configuration')}).done(function(){navigateToNextPage();});});}
function reloadData(page,config,cultures,countries){Dashboard.populateLanguages($('#selectLanguage',page),cultures);Dashboard.populateCountries($('#selectCountry',page),countries);$('#selectLanguage',page).val(config.PreferredMetadataLanguage).selectmenu("refresh");$('#selectCountry',page).val(config.MetadataCountryCode).selectmenu("refresh");Dashboard.hideLoadingMsg();}
function reload(page){Dashboard.showLoadingMsg();var apiClient=ApiClient;var promise1=apiClient.getJSON(apiClient.getUrl('Startup/Configuration'));var promise2=apiClient.getCultures();var promise3=apiClient.getCountries();$.when(promise1,promise2,promise3).done(function(response1,response2,response3){reloadData(page,response1[0],response2[0],response3[0]);});}
function navigateToNextPage(){var apiClient=ApiClient;apiClient.getJSON(apiClient.getUrl('Startup/Info')).done(function(info){if(info.SupportsRunningAsService){Dashboard.navigate('wizardservice.html');}else{Dashboard.navigate('wizardagreement.html');}});}
$(document).on('pageshow',"#wizardSettingsPage",function(){var page=this;reload(page);});window.WizardSettingsPage={onSubmit:function(){var form=this;save(form);return false;}};})(jQuery,document,window);(function($,document,window){function getApiClient(){return ApiClient;}
function onUpdateUserComplete(result){Dashboard.hideLoadingMsg();if(result.UserLinkResult){var msgKey=result.UserLinkResult.IsPending?'MessagePendingEmbyAccountAdded':'MessageEmbyAccountAdded';Dashboard.alert({message:Globalize.translate(msgKey),title:Globalize.translate('HeaderEmbyAccountAdded'),callback:function(){Dashboard.navigate('wizardlibrary.html');}});}else{Dashboard.navigate('wizardlibrary.html');}}
function submit(form){Dashboard.showLoadingMsg();var apiClient=getApiClient();apiClient.ajax({type:'POST',data:{Name:$('#txtUsername',form).val(),ConnectUserName:$('#txtConnectUserName',form).val()},url:apiClient.getUrl('Startup/User'),dataType:'json'}).done(onUpdateUserComplete);}
function wizardUserPage(){var self=this;self.onSubmit=function(){var form=this;submit(form);return false;};}
$(document).on('pageshow',"#wizardUserPage",function(){Dashboard.showLoadingMsg();var page=this;var apiClient=getApiClient();apiClient.getJSON(apiClient.getUrl('Startup/User')).done(function(user){$('#txtUsername',page).val(user.Name);$('#txtConnectUserName',page).val(user.ConnectUserName);Dashboard.hideLoadingMsg();});});window.WizardUserPage=new wizardUserPage();})(jQuery,document,window);